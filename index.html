<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38375283">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2023/11/22/23967223/sam-altman-returns-ceo-open-ai"
              >Sam Back at OpenAI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-22 @ 06:06:54</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38375283"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38375239">
          <h3>
            <a
              class="item"
              href="https://twitter.com/openai/status/1727206187077370115"
              >We have reached an agreement in principle for Sam to return to
              OpenAI as CEO</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-22 @ 06:01:45</span
              ><span class="points-container"
                >Points: <span class="points">555</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38375239"
                  >Comments</a
                ><span class="descendants">: 438</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38373586">
          <h3>
            <a
              class="item"
              href="https://www.boristhebrave.com/2023/11/19/how-does-cave-glade-generator-work/"
              >How does Cave/Glade Generator Work</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-22 @ 01:50:41</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38373586"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38373191">
          <h3>
            <a
              class="item"
              href="https://www.ftc.gov/news-events/news/press-releases/2023/11/ftc-authorizes-compulsory-process-ai-related-products-services"
              >FTC authorizes compulsory process for AI-related products and
              services</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-22 @ 01:06:17</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38373191"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38372687">
          <h3>
            <a
              class="item"
              href="https://news.utexas.edu/2023/11/21/bacteria-store-memories-and-pass-them-on-for-generations/"
              >Bacteria store memories and pass them on for generations</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-22 @ 00:20:40</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38372687"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38371808">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/in-the-guts-second-brain-key-agents-of-health-emerge-20231121"
              >In the gut's 'second brain,' key agents of health emerge</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 23:03:10</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38371808"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38371361">
          <h3>
            <a
              class="item"
              href="https://insiderockstarnorth.blogspot.com/2023/11/why-does-moon-change-size-when-you.html"
              >Why does the moon change size when you snipe it in GTA?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 22:30:50</span
              ><span class="points-container"
                >Points: <span class="points">863</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38371361"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38371307">
          <h3>
            <a
              class="item"
              href="https://twitter.com/xenadu02/status/1495693475584557056"
              >I tested four NVMe SSDs from four vendors – half lose FLUSH'd
              data on power loss</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 22:26:09</span
              ><span class="points-container"
                >Points: <span class="points">153</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38371307"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38371126">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2311.09234"
              >Genetic Algorithms for Evolution of QWOP Gaits</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 22:13:51</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38371126"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38370308">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/hadrius/jobs/oNDf5nM-founding-engineer"
              >Hadrius (YC W23) is hiring a founding engineer to automate SEC
              compliance</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 21:17:43</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38370252">
          <h3>
            <a
              class="item"
              href="https://twitter.com/OpenAI/status/1727065166188274145"
              >ChatGPT with voice is now available to all free users</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 21:14:03</span
              ><span class="points-container"
                >Points: <span class="points">288</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38370252"
                  >Comments</a
                ><span class="descendants">: 143</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38370203">
          <h3>
            <a
              class="item"
              href="https://www.cnu.org/publicsquare/2023/11/13/children-left-behind-suburbia-need-better-community-design"
              >Children, left behind by suburbia, need better community
              design</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 21:11:23</span
              ><span class="points-container"
                >Points: <span class="points">253</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38370203"
                  >Comments</a
                ><span class="descendants">: 234</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38369433">
          <h3>
            <a class="item" href="https://glandium.org/blog/?p=4346"
              >I kind of killed Mercurial at Mozilla</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 20:16:01</span
              ><span class="points-container"
                >Points: <span class="points">213</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38369433"
                  >Comments</a
                ><span class="descendants">: 153</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38368570">
          <h3>
            <a class="item" href="https://github.com/NeumTry/NeumAI"
              >Show HN: Neum AI – Open-source large-scale RAG framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 19:20:29</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38368570"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
            <div class="text">
              <p>
                We documented our approach in an HN post (<a
                  href="https://news.ycombinator.com/item?id=37824547"
                  >https://news.ycombinator.com/item?id=37824547</a
                >) a couple weeks ago. Today, we are open sourcing the framework
                we have developed.
              </p>
              <p>
                The framework focuses on RAG data pipelines and provides scale,
                reliability, and data synchronization capabilities out of the
                box.
              </p>
              <p>
                For those newer to RAG, it is a technique to provide context to
                Large Language Models. It consists of grabbing pieces of
                information (i.e. pieces of news articles, papers, descriptions,
                etc.) and incorporating them into prompts to help contextualize
                the responses. The technique goes one level deeper in finding
                the right pieces of information to incorporate. The search for
                relevant information is done through the use of vector
                embeddings and vector databases.
              </p>
              <p>
                Those pieces of news articles, papers, etc. are transformed into
                a vector embedding that represents the semantic meaning of the
                information. These vector representations are organized into
                indexes where we can quickly search for the pieces of
                information that most closely resembles (from a semantic
                perspective) a given question or query. For example, if I take
                news articles from this year, vectorize them, and add them to an
                index, I can quickly search for pieces of information about the
                US elections.
              </p>
              <p>To help achieve this, the Neum AI framework features:</p>
              <p>
                Starting with built-in data connectors for common data sources,
                embedding services and vector stores, the framework provides
                modularity to build data pipelines to your specification.
              </p>
              <p>
                The connectors support pre-processing capabilities to define
                loading, chunking and selecting strategies to optimize content
                to be embedded. This also includes extracting metadata that is
                going to be associated to a given vector.
              </p>
              <p>
                The generated pipelines support large scale jobs through a high
                throughput distributed architecture. The connectors allow you to
                parallelize tasks like downloading documents, processing them,
                generating embedding and ingesting data into the vector DB.
              </p>
              <p>
                For data sources that might be continuously changing, the
                framework supports data scheduling and synchronization. This
                includes delta syncs where only new data is pulled.
              </p>
              <p>
                Once data is transformed into a vector database, the framework
                supports querying of the data including hybrid search using the
                available metadata added during pre-processing. As part of the
                querying process, the framework provides capabilities to capture
                feedback on retrieved data as well as run evaluations against
                different pipeline configurations.
              </p>
              <p>
                Try it out and if interested in chatting more about this shoot
                us an email founders@tryneum.com
              </p>
            </div>
          </section>
        </section>
        <section id="38368287">
          <h3>
            <a
              class="item"
              href="https://stability.ai/news/stable-video-diffusion-open-ai-video-model"
              >Stable Video Diffusion</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 19:01:29</span
              ><span class="points-container"
                >Points: <span class="points">1083</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38368287"
                  >Comments</a
                ><span class="descendants">: 238</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38366830">
          <h3>
            <a class="item" href="https://github.com/PKU-YuanGroup/Video-LLaVA"
              >Video-LLaVA</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 17:31:11</span
              ><span class="points-container"
                >Points: <span class="points">201</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38366830"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38366729">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/finance/currencies/binance-ceo-changpeng-zhao-step-down-plead-guilty-01f72a40"
              >Binance founder Changpeng Zhao agrees to step down, plead
              guilty</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 17:20:43</span
              ><span class="points-container"
                >Points: <span class="points">583</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38366729"
                  >Comments</a
                ><span class="descendants">: 390</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38366536">
          <h3>
            <a
              class="item"
              href="https://sourcegraph.com/blog/zoekt-creating-internal-tools-at-google"
              >Code Search at Google: Han-Wen and Zoekt</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 17:10:44</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38366536"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38366295">
          <h3>
            <a
              class="item"
              href="https://www.scu.edu/ethics/focus-areas/business-ethics/resources/seven-signs-of-ethical-collapse/"
              >Seven signs of ethical collapse (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 16:55:50</span
              ><span class="points-container"
                >Points: <span class="points">329</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38366295"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38365638">
          <h3>
            <a class="item" href="https://pickcode.io"
              >Show HN: New visual language for teaching kids to code</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 16:16:38</span
              ><span class="points-container"
                >Points: <span class="points">374</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38365638"
                  >Comments</a
                ><span class="descendants">: 153</span></span
              >
            </h4>
            <div class="text">
              <p>
                On the site, you can do tutorials to make chatbots, animated
                drawings, and 2D games. We have a full Intro to Pickcode course,
                as well as an Intro to Python course where you make regular
                console programs with a regular text editor. There are 30 or so
                free lessons accessible with an account, and the rest are
                paywalled for $5/month.
              </p>
              <p>
                For professional programmers, the editor is probably pretty
                frustrating to use (no vim keybindings!), but I hope it’s at
                least interesting to play with from a UI perspective. If you
                have kids aged 10-14, I’d love any feedback you have from trying
                it out with them. I love talking to users, reach out at
                charlie@pickcode.io!
              </p>
            </div>
          </section>
        </section>
        <section id="38364179">
          <h3>
            <a
              class="item"
              href="https://resobscura.substack.com/p/margaret-mead-technocracy-and-the"
              >Margaret Mead, technocracy, and the origins of AI's ideological
              divide</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 14:37:04</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38364179"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38363698">
          <h3>
            <a class="item" href="https://wiki.csswg.org/ideas/mistakes"
              >Mistakes in the Design of CSS (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 14:02:15</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38363698"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38362363">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/articles/nasa-james-webb-space-telescope-greg-robinson-images-11657137487"
              >The NASA engineer who made the James Webb Space Telescope work
              (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 11:45:11</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38362363"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38362348">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/travel/2023/nov/21/people-dance-on-tables-welcome-to-belgrades-kafana-pub-culture"
              >Belgrade's kafana pub culture</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 11:43:10</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38362348"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38362271">
          <h3>
            <a class="item" href="https://makepixelsdance.github.io/"
              >Make Pixels Dance: High-Dynamic Video Generation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 11:32:18</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38362271"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38360260">
          <h3>
            <a class="item" href="https://www.fluentsearch.net/"
              >Fluent Search</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 06:52:32</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38360260"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38357226">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-11-phosphorous-outskirts-milky.html"
              >Phosphorous discovered in outskirts of the Milky Way</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 00:48:34</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38357226"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38357205">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-11-brightest-disturbed-earth-atmosphere-year.html"
              >Brightest flash ever disturbed Earth's atmosphere last year</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-21 @ 00:46:58</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38357205"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38351797">
          <h3>
            <a
              class="item"
              href="https://questdb.io/blog/solving-duplicate-data-performant-deduplication/"
              >Solving duplicate data with performant deduplication</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 18:08:34</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38351797"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38343398">
          <h3>
            <a
              class="item"
              href="https://blog.nelhage.com/2010/02/a-very-subtle-bug/"
              >A very subtle bug (2010)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 06:30:45</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38343398"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
