<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37144985">
          <h3>
            <a
              class="item"
              href="https://htmx.org/posts/2023-06-06-htmx-github-accelerator/"
              >Htmx is part of the GitHub Accelerator</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-16 @ 10:19:32</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37144985"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37144894">
          <h3>
            <a
              class="item"
              href="https://thraxil.org/users/anders/posts/2023/08/05/on-to-elixir"
              >On to Elixir</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-16 @ 10:04:25</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37144894"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37144601">
          <h3>
            <a
              class="item"
              href="https://maryrosecook.com/blog/post/is-this-a-good-book-for-me-now"
              >Is this a good book for me, now?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-16 @ 09:23:27</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37144601"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37143837">
          <h3>
            <a class="item" href="https://matt-rickard.com/why-tailwind-css-won"
              >Why Tailwind CSS Won</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-16 @ 07:27:47</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37143837"
                  >Comments</a
                ><span class="descendants">: 163</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37142890">
          <h3>
            <a
              class="item"
              href="https://vitalik.eth.limo/general/2023/08/16/communitynotes.html"
              >What do I think about Community Notes?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-16 @ 04:28:18</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37142890"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37142426">
          <h3>
            <a
              class="item"
              href="https://krebsonsecurity.com/2023/08/diligere-equity-invest-are-new-firms-of-u-k-con-man/"
              >Diligere, Equity-Invest Are New Firms of U.K. Con Man</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-16 @ 03:06:18</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37142426"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37142388">
          <h3>
            <a class="item" href="https://www.netmaker.io/"
              >NetMaker: Connect Everything with a WireGuard VPN</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-16 @ 03:00:40</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37142388"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37142293">
          <h3>
            <a
              class="item"
              href="https://rustylife.github.io/2023/08/15/futex-crash.html"
              >Debugging a Futex Crash</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-16 @ 02:44:49</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37142293"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37141463">
          <h3>
            <a
              class="item"
              href="https://www.oryxspioenkop.com/2023/08/putting-down-pen-reflecting-on-oryxs.html"
              >Putting Down the Pen: Reflecting on Oryxâ€™s Journey</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-16 @ 01:01:24</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37141463"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37140998">
          <h3>
            <a class="item" href="https://opensanctuary.org/"
              >The Open Sanctuary Project</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-16 @ 00:02:20</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37140998"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37140883">
          <h3>
            <a
              class="item"
              href="https://jarvispowered.com/you-dont-hate-jira-you-hate-your-manager/"
              >Jira canâ€™t stop people from using it incorrectly</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 23:46:12</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37140883"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37140681">
          <h3>
            <a class="item" href="https://toyrus.ngrok.io/~ted/pawpaws/"
              >Ted's Notes on Pawpaws (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 23:26:02</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37140681"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37140159">
          <h3>
            <a
              class="item"
              href="https://www.moderncsv.com/modern-csv-2-is-now-available/"
              >Modern CSV version 2</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 22:35:09</span
              ><span class="points-container"
                >Points: <span class="points">260</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37140159"
                  >Comments</a
                ><span class="descendants">: 116</span></span
              >
            </h4>
            <div class="text">
              <p>
                Modern CSV is a tabular file editor/viewer for Windows, Mac, and
                Linux. I developed it out of frustration with how spreadsheet
                programs handle CSV files. Plain text editors, on the other job,
                do a poor job of handling columns. With Modern CSV, I attempt to
                combine the best of both worlds.
              </p>
              <p>
                With version 2, you can expect to see an improved UI/UX, better
                performance, more useful features, updated documentation, and
                for Mac users, native Apple Silicon support.
              </p>
              <p>
                If you haven't tried it yet, give it a shot and let me know what
                you think!
              </p>
            </div>
          </section>
        </section>
        <section id="37140013">
          <h3>
            <a class="item" href="https://finbarr.ca/how-is-llama-cpp-possible/"
              >How Is LLaMa.cpp Possible?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 22:18:17</span
              ><span class="points-container"
                >Points: <span class="points">527</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37140013"
                  >Comments</a
                ><span class="descendants">: 176</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37138807">
          <h3>
            <a
              class="item"
              href="https://langdev.stackexchange.com/questions/2692/how-should-i-read-type-system-notation"
              >How should I read type system notation?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 20:15:27</span
              ><span class="points-container"
                >Points: <span class="points">290</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37138807"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37138681">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/tech-policy/2023/08/isps-complain-that-listing-every-fee-is-too-hard-urge-fcc-to-scrap-new-rule/"
              >ISPs complain that listing every fee is too hard, urge FCC to
              scrap new rule</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 20:05:43</span
              ><span class="points-container"
                >Points: <span class="points">423</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37138681"
                  >Comments</a
                ><span class="descendants">: 315</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37138672">
          <h3>
            <a
              class="item"
              href="https://nonint.com/2022/05/30/my-deep-learning-rig/"
              >My deep learning rig (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 20:05:06</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37138672"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37136898">
          <h3>
            <a class="item" href="https://github.com/varunshenoy/opendream"
              >Opendream: A layer-based UI for Stable Diffusion</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 17:38:10</span
              ><span class="points-container"
                >Points: <span class="points">409</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37136898"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37134950">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/article/protein-disrupts-cells-energy-centers-may-be-culprit-chronic-fatigue-syndrome"
              >A protein that disrupts cellsâ€™ energy centers may be a culprit in
              CFS/ME</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 15:11:29</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37134950"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37133908">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/23830432/imac-twenty-five-years-ago-saved-apple"
              >How the iMac Saved Apple</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 13:41:38</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37133908"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37133128">
          <h3>
            <a class="item" href="https://www.lottielab.com/"
              >Show HN: Lottielab â€“ Create product animations in the browser
              easily</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 12:28:20</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37133128"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
            <div class="text">
              Hi HN! Today we are releasing Lottielab, a web-based animation
              tool, to the public as an open beta. The main tool for editing and
              exporting Lottie animations today is Adobe After Effects, a
              30-year-old visual effects tool thatâ€™s not fit for this purpose,
              has a steep learning curve, and requires a patchwork of
              error-prone plugins. With Lottielab, we are aiming to reduce the
              friction of creating and editing product animations by providing
              an easy-to-use editor with out-of-the-box support for import and
              export of the Lottie format and many others. Feel free to play
              around with the tool and let me know what you think - I'm here to
              answer your questions. Happy animating!
            </div>
          </section>
        </section>
        <section id="37133054">
          <h3>
            <a class="item" href="https://opentf.org/">The OpenTF Manifesto</a>
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 12:19:33</span
              ><span class="points-container"
                >Points: <span class="points">567</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37133054"
                  >Comments</a
                ><span class="descendants">: 320</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37132325">
          <h3>
            <a
              class="item"
              href="https://lajollabridge.com/Articles/EveningClubBridgeDecline.htm"
              >Evening Club Bridge Is Dying (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 10:50:24</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37132325"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37131812">
          <h3>
            <a
              class="item"
              href="https://pluralistic.net/2023/08/14/hidden-worlds/#making-the-invisible-visible-and-beautiful"
              >Open Circuits: The Inner Beauty of Electronic Components</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 09:20:15</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37131812"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37131027">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=5kxRi34PqWo"
              >Love Notes to Newton [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 06:57:26</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37131027"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37130988">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=P1ZDOGDMNLM"
              >Circle Evolves C++ [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 06:51:08</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37130988"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37130331">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-08-antiferromagnets-memory.html"
              >New way to read data in antiferromagnets unlocks their use as
              computer memory</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 04:51:41</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37130331"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37130200">
          <h3>
            <a class="item" href="https://rtheunissen.github.io/bst/"
              >Exploring the design space of binary search trees</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 04:28:43</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37130200"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
            <div class="text">
              <p>
                The more I read about binary search trees, the more I thought
                about them, and so down the rabbit hole I went. When you read
                everything you can find about a topic for several years,
                eventually you develop a deep enough understanding to compose
                new ideas from different sources.
              </p>
              <p>
                This project is the result of many rejected ideas and countless
                experiments. I tried my best to distill everything I consider
                important enough to keep, and will continue to develop other
                ideas as they come along. I had no intention to implement
                anything other than weight-balanced strategies to support
                positional access, but when I read about rank-balanced trees I
                knew I had to take on the challenge to implement them.
              </p>
              <p>
                I've been in contact with various authors along the way,
                specifically Bob Tarjan and Salvador Roura, but have otherwise
                not received any feedback yet. Implementing all the algorithms
                was incredibly hard work, by far the hardest work I've ever
                done, so I hope that others may find value in their
                presentation.
              </p>
              <p>
                There is still so much work that could be done, but there comes
                a time when working on something alone begins to yield
                diminishing returns. I hope to continue this project as an
                open-source collaborative effort, so please feel free to ask
                questions or suggest changes, however small.
              </p>
              <p>
                [1]
                <a href="https://github.com/php-ds/ext-ds"
                  >https://github.com/php-ds/ext-ds</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="37129921">
          <h3>
            <a
              class="item"
              href="https://www.cs.utexas.edu/~eunsol/courses/data/bitter_lesson.pdf"
              >The Bitter Lesson (2019) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 03:44:34</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37129921"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37128935">
          <h3>
            <a class="item" href="https://github.com/scotws/265SXB-Guide"
              >A most very unofficial guide to the W65C265SXB</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 01:12:10</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37128935"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
