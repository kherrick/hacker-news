<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37603905">
          <h3>
            <a
              class="item"
              href="https://blog.kagi.com/unlimited-searches-for-10"
              >Unlimited Kagi searches for $10 per month</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 20:32:53</span
              ><span class="points-container"
                >Points: <span class="points">404</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37603905"
                  >Comments</a
                ><span class="descendants">: 221</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37603769">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/business/autos-transportation/volvo-end-diesel-car-production-by-early-2024-2023-09-19/"
              >Volvo to cease production of diesel cars in a few months</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 20:24:24</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37603769"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37603748">
          <h3>
            <a class="item" href="https://github.com/hexagonal-sun/ampkt"
              >AMPKT – Amateur radio packet explorer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 20:23:23</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37603748"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37603554">
          <h3>
            <a
              class="item"
              href="https://rachelbythebay.com/w/2023/09/21/hurricane/"
              >A customer stuck due to a hurricane who needed SSH</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 20:09:31</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37603554"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37603467">
          <h3>
            <a
              class="item"
              href="https://www.esper.io/blog/android-14-adds-support-for-using-your-smartphone-as-a-webcam"
              >Android 14 adds support for using your smartphone as a webcam</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 20:04:31</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37603467"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37603331">
          <h3>
            <a
              class="item"
              href="https://developer.apple.com/documentation/contacts/cnlabelcontactrelationyoungercousinmotherssiblingsdaughterorfatherssistersdaughter"
              >LabelContactRelationYoungerCousinMothersSiblingsDaughterOrFathersSistersDaughter</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 19:56:21</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37603331"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37602923">
          <h3>
            <a
              class="item"
              href="https://marvinh.dev/blog/speeding-up-javascript-ecosystem-part-6/"
              >Speeding up the JavaScript ecosystem – Polyfills gone rogue</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 19:31:24</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37602923"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37602798">
          <h3>
            <a
              class="item"
              href="https://notes.eatonphil.com/2023-09-21-how-do-databases-execute-expressions.html"
              >How do databases execute expressions?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 19:24:14</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37602798"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37602759">
          <h3>
            <a
              class="item"
              href="https://news.artnet.com/art-world/ancient-tools-monkeys-2237820"
              >Ancient tools thought to be made by humans were made by monkeys:
              archaeologists</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 19:21:47</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37602759"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37602239">
          <h3>
            <a
              class="item"
              href="https://webbtelescope.org/contents/news-releases/2023/news-2023-113"
              >NASA’s Webb finds carbon source on surface of Jupiter’s moon
              Europa</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 18:52:54</span
              ><span class="points-container"
                >Points: <span class="points">204</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37602239"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37601526">
          <h3>
            <a
              class="item"
              href="https://srcd.onlinelibrary.wiley.com/doi/full/10.1111/cdep.12442"
              >Developmental costs associated with early maternal withdrawal
              (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 18:06:27</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37601526"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37600852">
          <h3>
            <a class="item" href="https://blog.isosceles.com/the-webp-0day/"
              >The WebP 0day</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 17:21:39</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37600852"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37600542">
          <h3>
            <a class="item" href="https://onesignal.com/careers/4264311006"
              >OneSignal (YC S11), email and push notification platform, is
              hiring engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 17:00:48</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37599873">
          <h3>
            <a
              class="item"
              href="https://jxnl.github.io/instructor/blog/2023/09/17/rag-is-more-than-just-embedding-search/"
              >RAG is more than just embedding search</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 16:18:02</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37599873"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37599542">
          <h3>
            <a
              class="item"
              href="https://medicalxpress.com/news/2023-09-poisoning-death-iq-loss-thought.html"
              >Lead poisoning causes more death, IQ loss than thought: study</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 15:55:20</span
              ><span class="points-container"
                >Points: <span class="points">266</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37599542"
                  >Comments</a
                ><span class="descendants">: 245</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37599510">
          <h3>
            <a class="item" href="https://matrix.org/blog/2023/09/matrix-2-0/"
              >Matrix 2.0: The Future of Matrix</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 15:53:24</span
              ><span class="points-container"
                >Points: <span class="points">376</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37599510"
                  >Comments</a
                ><span class="descendants">: 170</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37599312">
          <h3>
            <a
              class="item"
              href="https://www.franckgoddio.org/projects/sunken-civilizations/heracleion/"
              >Sunken temple and sanctuary from ancient Egypt</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 15:40:28</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37599312"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37598604">
          <h3>
            <a
              class="item"
              href="https://www.scientificamerican.com/article/wines-true-origins-are-finally-revealed/"
              >A genetic study has revised the narrative about how wine grapes
              spread</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 14:57:49</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37598604"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37597201">
          <h3>
            <a class="item" href="https://github.com/memgraph/odin"
              >Show HN: Odin – the integration of LLMs with Obsidian note
              taking</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 13:18:58</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37597201"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37596755">
          <h3>
            <a
              class="item"
              href="https://www.theatlantic.com/ideas/archive/2023/09/airlines-banks-mileage-programs/675374/"
              >Airlines make more money from mileage programs than from flying
              planes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 12:40:58</span
              ><span class="points-container"
                >Points: <span class="points">330</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37596755"
                  >Comments</a
                ><span class="descendants">: 386</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37596497">
          <h3>
            <a
              class="item"
              href="https://www.splunk.com/en_us/blog/leadership/splunk-and-cisco-unite-to-accelerate-digital-resilience-as-one-of-the-leading-global-software-companies.html"
              >Cisco Acquires Splunk</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 12:15:19</span
              ><span class="points-container"
                >Points: <span class="points">733</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37596497"
                  >Comments</a
                ><span class="descendants">: 406</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37596253">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=37596253"
              >Launch HN: Loops (YC W22) – Email for SaaS Companies</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 11:48:51</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37596253"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
            <div class="text">
              <a href="https://loops.so">https://loops.so</a>), a platform aimed
              at simplifying the email experience for SaaS companies. We support
              creating and sending marketing, product, and transactional email.
              <p>
                Email is important but painful to manage. If you've ever dealt
                with the frustration of coding emails by hand, testing them
                across multiple clients, or integrating them into various SaaS
                tools, you might find our approach interesting.
              </p>
              <p>
                We make it simple to design and send email to your users either
                manually in the app, via API or triggered via an integration. We
                offer unlimited team seats, so your product team can help align
                copy, your marketing team can send newsletters, your revenue
                team can work on dunning and your engineers can have a solid API
                to help orchestrate the sends.
              </p>
              <p>
                Most of our competitors use email editors that are licensed from
                a third party. Our editor is built from the ground up on the
                Lexical text editor from Meta, extended beyond just text nodes.
                It supports mobile editing and dark mode, and it autosaves your
                changes.
              </p>
              <p>
                Our REST API is straightforward, and we have integrations with
                tools like Segment and Census. Documentation is available at
                <a href="https://loops.so/docs">https://loops.so/docs</a>. On
                our homepage, right under the fold, we list endpoints and sample
                payloads.
              </p>
              <p>
                One issue we've worked hard to address is email compatibility
                across devices and platforms. It's a problem full of edge cases
                that we've mitigated by extending MJML, a markup language
                designed for responsive email, to be even more compliant across
                different platforms. We don't think you should have to code and
                test your emails. Email copy shouldn't live in your codebase.
              </p>
              <p>
                If you're concerned about spam, we are too. We educate our users
                on CAN-SPAM rules and automatically add compliant footers to
                emails. We actively monitor to ensure our platform isn't used
                for spam, and we do not allow cold sales emails.
              </p>
              <p>
                Our pricing is upfront and available on our website. You can try
                the platform for free without a credit card. We launched
                publicly a week ago. We're really interested in any technical
                feedback you have, as we aim to make this tool as
                developer-friendly as possible.
              </p>
              <p>Looking forward to hearing your thoughts!</p>
            </div>
          </section>
        </section>
        <section id="37595240">
          <h3>
            <a
              class="item"
              href="https://stackoverflow.com/questions/146159/is-fortran-easier-to-optimize-than-c-for-heavy-calculations"
              >Is Fortran easier to optimize than C for heavy calculations?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 09:26:46</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37595240"
                  >Comments</a
                ><span class="descendants">: 89</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37594658">
          <h3>
            <a
              class="item"
              href="https://interactions.acm.org/archive/view/september-october-2023/requiem-for-an-interface"
              >Requiem for an Interface</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 08:12:44</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37594658"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37594365">
          <h3>
            <a
              class="item"
              href="https://www.undeadly.org/cgi?action=article;sid=20230921073556"
              >OpenBSD/ARM64 on Hetzner Cloud</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 07:36:31</span
              ><span class="points-container"
                >Points: <span class="points">219</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37594365"
                  >Comments</a
                ><span class="descendants">: 124</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37594302">
          <h3>
            <a
              class="item"
              href="https://service-manual.nhs.uk/content/numbers-measurements-dates-time"
              >Designing content for people who struggle with numbers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 07:28:04</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37594302"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37583197">
          <h3>
            <a class="item" href="https://antonz.org/sql-join/"
              >SQL Join Flavors</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 12:09:49</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37583197"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37583147">
          <h3>
            <a
              class="item"
              href="https://laplab.me/posts/inside-new-query-engine-of-mongodb/"
              >MongoDB’s new query engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 12:04:56</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37583147"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37583022">
          <h3>
            <a
              class="item"
              href="https://lakesare.brick.do/lean-coq-isabel-and-their-proof-trees-yjnd2O2RgxwV"
              >Lean, Coq and other proof assistants: Visualising proofs as
              trees</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 11:48:19</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37583022"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
            <div class="text">
              <p>
                If you're aware of any tools I might have missed, please @ me in
                the comments. I aimed to cover every one I could find.
              </p>
            </div>
          </section>
        </section>
        <section id="37581145">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/09/18/lhc_infrastructure_monitoring/"
              >CERN swaps out databases to feed its petabyte-a-day habit</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 06:46:48</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37581145"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
