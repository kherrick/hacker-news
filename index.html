<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42902936">
          <h3><a class="item" href="https://rlhfbook.com/">RLHF Book</a></h3>
          <section>
            <h4>
              <span>2025-02-01 @ 22:11:45</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42902936"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42902691">
          <h3>
            <a class="item" href="https://lumon-industries.com/"
              >Macrodata Refinement</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-01 @ 21:46:16</span
              ><span class="points-container"
                >Points: <span class="points">178</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42902691"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42902624">
          <h3>
            <a
              class="item"
              href="https://cosmosmagazine.com/science/chemistry/improved-fridge-technology/"
              >New thermogalvanic tech paves way for more efficient fridges</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-01 @ 21:39:03</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42902624"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42902395">
          <h3>
            <a
              class="item"
              href="https://alisdair.mcdiarmid.org/kill-sticky-headers/"
              >A bookmarklet to kill sticky headers (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-01 @ 21:12:37</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42902395"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42902385">
          <h3>
            <a
              class="item"
              href="https://annas-archive.org/blog/ai-copyright.html"
              >Copyright reform is necessary for national security</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-01 @ 21:11:50</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42902385"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42902267">
          <h3>
            <a class="item" href="https://grnh.se/83c3fffa7us"
              >MindsDB (YC W20) Is Hiring an Office Manager in SF</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-01 @ 21:00:34</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42901897">
          <h3>
            <a
              class="item"
              href="https://mastodon.de/@ErikUden/113930010311998246"
              >Oracle Cloud deleting active user accounts without possibility
              for data recovery</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-01 @ 20:24:57</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42901897"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42901616">
          <h3>
            <a
              class="item"
              href="https://www.jtolio.com/2025/02/py3-pygame-miyoo-a30/"
              >Python 3, Pygame, and Debian Bookworm on the Miyoo A30</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-01 @ 19:57:37</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42901616"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42901184">
          <h3>
            <a
              class="item"
              href="https://www.righto.com/2025/02/origin-of-mainframe-term.html"
              >The origin and unexpected evolution of the word "mainframe"</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-01 @ 19:11:26</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42901184"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42901182">
          <h3>
            <a
              class="item"
              href="https://www.audiomisc.co.uk/YouTube/SpotTheDifference.html"
              >YouTube audio quality – How good does it get? (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-01 @ 19:11:12</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42901182"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42899713">
          <h3>
            <a class="item" href="https://github.com/kspalaiologos/bzip3"
              >Bzip3: A spiritual successor to BZip2</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-01 @ 16:46:01</span
              ><span class="points-container"
                >Points: <span class="points">181</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42899713"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42899703">
          <h3>
            <a
              class="item"
              href="https://www.swift.org/blog/the-next-chapter-in-swift-build-technologies/"
              >Apple is open sourcing Swift Build</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-01 @ 16:44:53</span
              ><span class="points-container"
                >Points: <span class="points">367</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42899703"
                  >Comments</a
                ><span class="descendants">: 142</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42899679">
          <h3>
            <a
              class="item"
              href="https://uwaterloo.ca/news/media/smart-fabric-heats-under-sun"
              >Smart fabric heats up under the sun</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-01 @ 16:41:53</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42899679"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42899400">
          <h3>
            <a class="item" href="https://github.com/suwi-lanji/auto-commit"
              >Have Gemini stage and write commit messages for you</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-01 @ 16:06:33</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42899400"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42898201">
          <h3>
            <a class="item" href="https://meha.ai"
              >Show HN: We're building a desktop app for browser agents</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-01 @ 13:41:19</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42898201"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
            <div class="text">
              <p>
                This is Jared and Art. We met on HN and started building
                together.
              </p>
              <p>
                Over the last few months we've been thinking a lot about how AI
                agents are going to impact the future. We want agents to be
                something that's actually useful for normal people as well as
                the 10x'ers. This lead us to building Meha over the last few
                months, our first swing at our vision! We saw OpenAI release
                Operators then we said f*k it let's post.
              </p>
              <p>
                Meha is a desktop app that uses your Chrome browser to execute
                tasks in the background. It controls your installed Chrome
                browser and uses LLMs with playwright to plan and execute
                actions to accomplish your task. You get to see each planning
                step the bot is doing and have access to its long term memory.
              </p>
              <p>
                Meha also uses its own file system and can export files for
                download. Another thing we've been focused on in multi-agent
                workflows and Meha can run many bots at the same time. One of
                the reasons why we can ship this for free in the mean time is
                because of how cheap the agents are. But we are planning to have
                a Pro version for power users. We prefer not to raise since
                we're against VC funding.
              </p>
              <p>
                We have been influenced by a lot of concepts in probabilistic
                robotics and RL to develop a fairly robust 'agentic' framework.
                As well as an algorithm for efficiently converting/compressing
                large html pages into a semantic format. If you're interested we
                will open source this asap in an SDK (will work with all OpenAI
                API spec LLMs and with llama.cpp) let us know.
              </p>
              <p>
                We're currently in beta and working on figuring out what this
                product will become and super stoked! Let us know what you
                think. To get access to Meha we have links on our discord to
                download (Both MacOS and Windows is available). Please give us
                all the feedback/criticism (even if you hate AI).
              </p>
              <p>Link to Meha: <a href="https://meha.ai">https://meha.ai</a></p>
            </div>
          </section>
        </section>
        <section id="42897746">
          <h3>
            <a class="item" href="https://orhun.dev/ratzilla/demo/">Ratzilla</a>
          </h3>
          <section>
            <h4>
              <span>2025-02-01 @ 12:03:51</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42897746"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42897696">
          <h3>
            <a
              class="item"
              href="https://www.theatlantic.com/health/archive/2025/01/cdc-dei-scientific-data/681531/"
              >CDC data are disappearing</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-01 @ 11:52:18</span
              ><span class="points-container"
                >Points: <span class="points">420</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42897696"
                  >Comments</a
                ><span class="descendants">: 330</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42897662">
          <h3>
            <a class="item" href="https://www.talknotes.tech/"
              >Show HN: TalkNotes – A site that turns your ideas into tasks</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-01 @ 11:43:33</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42897662"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
            <div class="text">
              <p>
                I created TalkNotes few weeks ago and it started getting
                traction in hours. It quickly went from 0 -&gt; $700 revenue
                with One time payment and I decided to remove the one time
                payment, the line went straight down but since then it rising
                little by little and has now reached $150 MRR. I'm stoked since
                this is one of my best projects.
              </p>
              <p>
                The idea is to speak freely into a microphone about anything on
                your mind—meetings, emails, tasks—and let AI help organize it
                all. It turns your thoughts into a structured to-do list, notes,
                flashcards, and more. I created it because spending 15 minutes
                every day setting up traditional productivity apps is a waste of
                time. I thought it might resonate with others looking for a
                similar solution.
              </p>
              <p>
                There's a fair bit of churn since I think with something like
                this users either love it or never end up using it. I could
                probably add some more retention strategies like reminders and
                other productivity tools integration like Google Calendar, and
                more...
              </p>
              <p>
                If this sounds interesting, I’d love to hear your thoughts or
                suggestions. Feel free to share how you currently manage your
                daily tasks—always keen to learn from this community.
              </p>
              <p>
                Here's the link if you want to have a look:
                <a href="http://talknotes.tech">http://talknotes.tech</a>
              </p>
            </div>
          </section>
        </section>
        <section id="42897120">
          <h3>
            <a
              class="item"
              href="https://phiresky.github.io/blog/2025/visualizing-all-books-in-isbn-space/"
              >Visualizing all books of the world in ISBN-Space</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-01 @ 09:27:06</span
              ><span class="points-container"
                >Points: <span class="points">314</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42897120"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42895228">
          <h3>
            <a class="item" href="https://zookeys.pensoft.net/article/139335/"
              >A new supergiant Bathynomus species discovered in Vietnam</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-01 @ 02:58:51</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42895228"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42894660">
          <h3>
            <a class="item" href="https://douglasrumbaugh.com/post/eqn-mathml/"
              >Using eqn for static website equation generation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-01 @ 01:23:44</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42894660"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42893196">
          <h3>
            <a
              class="item"
              href="https://news.liverpool.ac.uk/2025/01/31/discovery-of-collagen-in-fossil-bone-could-unlock-new-insights-into-dinosaurs/"
              >Discovery of collagen in fossil bone could unlock new insights
              into dinosaurs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-31 @ 22:42:30</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42893196"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42884099">
          <h3>
            <a class="item" href="https://lwn.net/Articles/1005332/"
              >A mouseless tale: trying for a keyboard-driven desktop</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-31 @ 02:04:14</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42884099"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42881367">
          <h3>
            <a
              class="item"
              href="https://www.404media.co/archivists-work-to-identify-and-save-the-thousands-of-datasets-disappearing-from-data-gov/"
              >Archivists work to save disappearing data.gov datasets</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-30 @ 19:40:33</span
              ><span class="points-container"
                >Points: <span class="points">299</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42881367"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42877910">
          <h3>
            <a
              class="item"
              href="https://www.sfgate.com/bayarea/article/bay-area-death-cult-zizian-murders-20064333.php"
              >String of recent killings linked to Bay Area rationalist 'death
              cult'</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-30 @ 14:21:20</span
              ><span class="points-container"
                >Points: <span class="points">243</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42877910"
                  >Comments</a
                ><span class="descendants">: 284</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42865611">
          <h3>
            <a
              class="item"
              href="https://fuzzix.org/enhancing-midi-hardware-with-perl"
              >Enhancing your MIDI devices with Perl</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-29 @ 14:59:23</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42865611"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42859564">
          <h3>
            <a class="item" href="https://conroy.org/blogging-on-paper"
              >Blogging on Paper (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-28 @ 23:33:08</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42859564"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42859412">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2412.18862"
              >3D scene reconstruction in adverse weather conditions via
              Gaussian splatting</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-28 @ 23:14:03</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42859412"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42858029">
          <h3>
            <a class="item" href="https://www.trevortraynor.com/newsstands"
              >Newsstands, 2012-2019</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-28 @ 21:08:17</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42858029"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42849774">
          <h3>
            <a
              class="item"
              href="https://www.openmymind.net/In-Zig-Whats-a-Writer/"
              >In Zig, what's a writer?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-28 @ 07:26:01</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42849774"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
