<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40444168">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-024-01463-0"
              >AlphaFold3 – why did Nature publish it without its code?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 18:15:43</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40444168"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40444121">
          <h3>
            <a class="item" href="https://tryclojure.org/">Try Clojure</a>
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 18:11:34</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40444121"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40443927">
          <h3>
            <a class="item" href="https://github.com/nucleuscloud/neosync"
              >Show HN: Neosync – Open-Source Data Anonymization for Postgres
              and MySQL</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 17:53:45</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40443927"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.github.com/nucleuscloud/neosync"
                >https://www.github.com/nucleuscloud/neosync</a
              >). Neosync is an open source platform that helps developers
              anonymize production data, generate synthetic data and sync it
              across their environments for better testing, debugging and
              developer experience.
              <p>
                Most developers and teams have some version of a database seed
                script that creates some mock data for their local and stage
                databases. The problem is that production data is messy and it’s
                very difficult to replicate that with mock data. This causes two
                big problems for developers.
              </p>
              <p>
                The first problem is that features seem to work locally/stage
                but have bugs and edge cases in production because the seed data
                you used to develop against was not representative of production
                data.
              </p>
              <p>
                The second problem we saw was that debugging production errors
                would take a long time and would often resurface. When we see a
                bug in production, the first thing we want to do is reproduce it
                locally, but if we can’t reproduce the state of the data
                locally, then we’re kind of flying blind.
              </p>
              <p>
                Working directly with production data would solve both of these
                problems but most teams can’t because of: (1) privacy/security
                issues and (2) scale. So we set out to solve these two problems
                with Neosync.
              </p>
              <p>
                We solve the privacy and security problem using anonymization
                and synthetic data. We have 40+ pre-built transformers (or you
                can write your own in code) that can anonymize PII or sensitive
                data so that it’s safe to use locally. Additionally, you can
                generate synthetic data from scratch that fits your existing
                schema across your database.
              </p>
              <p>
                The second problem is scale. Some production databases are too
                big to fit locally or just have more data than you need. Also,
                in some cases, you may want to debug a certain customer’s data
                and you only want their data. We solve this with subsetting. You
                can pass in a SQL query to filter your table(s) and Neosync will
                handle all of the heavy lifting including referential integrity.
              </p>
              <p>
                At the core of Neosync does three things: (1) It streams data
                from a source to one or multiple destination databases. We never
                store your sensitive data. (2) While that data is being
                streamed, we transform it. You define which schemas and tables
                you want to sync and at the column level, select a transformer
                that defines how you want to anonymize the data or generate
                synthetic data. (3) We subset your data based on your filters.
              </p>
              <p>
                We do all of this while handling referential integrity. Whether
                you have primary keys, foreign keys, unique constraints,
                circular dependencies (within a table and across tables),
                sequences and more, Neosync preserves those references.
              </p>
              <p>
                We also ship with APIs, a Terraform provider, a CLI and Github
                action that you can use to hydrate a CI database.
              </p>
              <p>
                Neosync is an open source project written in Go and Typescript
                and can be run on Docker Compose, Bare Metal, or Kubernetes via
                Helm. You can also use our hosted platform or managed platform
                that you can deploy in your VPC. We also have a hosted platform
                with a generous free tier -
                <a href="https://neosync.dev">https://neosync.dev</a>
              </p>
              <p>
                Here's a brief loom demo:
                <a
                  href="https://www.loom.com/share/ac21378d01cd4d848cf723e4960e8338?sid=2faf613c-92be-44fa-9278-c8087e777356"
                  >https://www.loom.com/share/ac21378d01cd4d848cf723e4960e8338?...</a
                >
              </p>
              <p>We'd love any feedback you have!</p>
            </div>
          </section>
        </section>
        <section id="40443920">
          <h3>
            <a class="item" href="https://github.com/onecodex/rust-bfield"
              >Show HN: B-field, a novel probabilistic key-value data structure
              (`rust-bfield`)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 17:53:16</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40443920"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <p>
                The B-field allows you to compactly store data using only a few
                bytes per key-value pair. We've successfully utilized it in
                genomics to associate billions of "k-mers" with taxonomic
                identifiers while maintaining an efficient memory footprint. But
                the data structure is also useful beyond computational biology,
                particularly where you have large unique key domains and
                constrained value ranges.
              </p>
              <p>
                Available under an Apache 2 license. We hope it proves useful,
                and we're happy to answer any questions!
              </p>
            </div>
          </section>
        </section>
        <section id="40443907">
          <h3>
            <a
              class="item"
              href="https://twitter.com/DanPriceSeattle/status/1791299631558823954"
              >One-third of Amazon warehouse workers are on food stamps or
              Medicaid</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 17:52:21</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40443907"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40443302">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/opinion/articles/2024-05-22/citi-missed-a-fat-finger"
              >Citi Missed a Fat Finger</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 17:01:40</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40443302"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40443276">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/trieve/jobs/LN9ucK7-sales-engineer-at-trieve-w24"
              >Trieve (YC W24) Is Hiring a Sales Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 17:00:03</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40442595">
          <h3>
            <a class="item" href="https://string.spiel.com/"
              >Pluckable Strings</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 16:05:06</span
              ><span class="points-container"
                >Points: <span class="points">244</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40442595"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40442587">
          <h3>
            <a
              class="item"
              href="https://textualvariations.substack.com/p/fury-fx-furiosa"
              >Fury Road's Practical FX Myth</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 16:04:37</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40442587"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40441093">
          <h3>
            <a class="item" href="https://github.com/ohbarye/pbt"
              >Show HN: PBT – A property-based testing library for Ruby</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 13:58:25</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40441093"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
            <div class="text">
              <p>
                I introduce a property-based testing tool for Ruby. Ruby's ease
                of test-writing and rich ecosystem are widely acclaimed.
                However, property-based testing is not as widely used as in
                other languages such as Haskell or Elixir, and I think this is
                because there is no de facto testing tool.
              </p>
              <p>
                This gem currently not only has the basic functionality of
                stateless property-based testing but also has the following
                features:
              </p>
              <p>
                - Support verbose mode that allows you to see its shrinking
                procedure and algorithms.
              </p>
              <p>
                - Support several concurrency/parallel executions of each test.
                As of now, Ractor/Thread/Process are available. (The default is
                sequential, considering benchmark results and actual use cases)
              </p>
              <p>Happy hacking!</p>
            </div>
          </section>
        </section>
        <section id="40440971">
          <h3>
            <a class="item" href="https://github.com/srush/Tensor-Puzzles"
              >Tensor Puzzles</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 13:48:09</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40440971"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40440854">
          <h3>
            <a class="item" href="https://www.gatesnotes.com/Brave-New-Words"
              >Sal Khan is pioneering innovation in education again</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 13:39:53</span
              ><span class="points-container"
                >Points: <span class="points">190</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40440854"
                  >Comments</a
                ><span class="descendants">: 225</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40440841">
          <h3>
            <a
              class="item"
              href="https://thephd.dev/just-put-raii-in-c-bro-please-bro-just-one-more-destructor-bro-cmon-im-good-for-it"
              >Why Not Just Do Simple C++ RAII in C?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 13:38:51</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40440841"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40440662">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-024-01487-6"
              >Mars rover mission will use pioneering nuclear power source</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 13:24:45</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40440662"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40438434">
          <h3>
            <a class="item" href="https://wuffs.org/WindEmu/index.html"
              >Psion 5mx Emulator</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 07:56:43</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40438434"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40436796">
          <h3>
            <a
              class="item"
              href="https://steveblank.com/2024/05/16/secret-history-when-kodak-went-to-war-with-polaroid/"
              >When Kodak and Polaroid went to war</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 02:36:11</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40436796"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40435771">
          <h3>
            <a
              class="item"
              href="https://stevelosh.com/blog/2018/08/a-road-to-common-lisp/"
              >A Road to Common Lisp (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-21 @ 23:59:39</span
              ><span class="points-container"
                >Points: <span class="points">209</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40435771"
                  >Comments</a
                ><span class="descendants">: 118</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40435076">
          <h3>
            <a
              class="item"
              href="https://devblogs.microsoft.com/oldnewthing/20190301-00/?p=101076"
              >How to compare two packed bitfields without having to unpack each
              field (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-21 @ 22:53:32</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40435076"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40434290">
          <h3>
            <a
              class="item"
              href="http://fpgacomputing.blogspot.com/2013/11/the-stanford-startup-and-mit-startup.html"
              >The Stanford Startup and the MIT Startup (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-21 @ 21:35:35</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40434290"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40433511">
          <h3>
            <a class="item" href="https://enterprise.wikimedia.com/"
              >Wikimedia Enterprise – APIs for LLMs, AI Training, and More</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-21 @ 20:32:30</span
              ><span class="points-container"
                >Points: <span class="points">209</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40433511"
                  >Comments</a
                ><span class="descendants">: 137</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40432834">
          <h3>
            <a class="item" href="https://breckyunits.com/scrollsets.html"
              >Storing knowledge in a single long plain text file</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-21 @ 19:36:36</span
              ><span class="points-container"
                >Points: <span class="points">286</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40432834"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40432688">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2024/05/gordon-bell-an-architect-of-our-digital-age-dies-at-age-89/"
              >Gordon Bell has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-21 @ 19:23:59</span
              ><span class="points-container"
                >Points: <span class="points">1188</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40432688"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40432102">
          <h3>
            <a
              class="item"
              href="https://tjaart.substack.com/p/the-curious-case-of-the-missing-period"
              >The curious case of the missing period</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-21 @ 18:35:13</span
              ><span class="points-container"
                >Points: <span class="points">478</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40432102"
                  >Comments</a
                ><span class="descendants">: 170</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40431835">
          <h3>
            <a class="item" href="https://amber-lang.com/"
              >Amber: Programming language compiled to Bash</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-21 @ 18:15:27</span
              ><span class="points-container"
                >Points: <span class="points">347</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40431835"
                  >Comments</a
                ><span class="descendants">: 260</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40431210">
          <h3>
            <a
              class="item"
              href="https://win-vector.com/2024/05/21/i-want-flexible-queries-not-rag/"
              >I want flexible queries, not RAG</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-21 @ 17:19:46</span
              ><span class="points-container"
                >Points: <span class="points">221</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40431210"
                  >Comments</a
                ><span class="descendants">: 145</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40430868">
          <h3>
            <a
              class="item"
              href="https://www.allanschore.com/pdf/SchoreIMHJTrauma01.pdf"
              >The Effects of Early Relational Trauma (2001) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-21 @ 16:52:46</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40430868"
                  >Comments</a
                ><span class="descendants">: 136</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40429878">
          <h3>
            <a class="item" href="https://kotsoft.github.io/"
              >Fast real time fluid simulator based on MPM algorithm</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-21 @ 15:41:04</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40429878"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40429581">
          <h3>
            <a
              class="item"
              href="https://fraser.stlouisfed.org/title/business-booms-depressions-since-1775-145"
              >Business Booms and Depressions Since 1775 (1943)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-21 @ 15:19:00</span
              ><span class="points-container"
                >Points: <span class="points">243</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40429581"
                  >Comments</a
                ><span class="descendants">: 221</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40425394">
          <h3>
            <a class="item" href="https://pldb.io/posts/ageAtCreation.html"
              >The Ages of Programming Language Creators</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-21 @ 08:05:13</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40425394"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40414187">
          <h3>
            <a
              class="item"
              href="https://www.chiark.greenend.org.uk/~sgtatham/algorithms/cbtree.html"
              >Counted B-Trees (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-20 @ 11:01:55</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40414187"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
