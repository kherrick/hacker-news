<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="46458029">
          <h3>
            <a class="item" href="https://www.doc.ic.ac.uk/~ajd/Cycling/"
              >Cycling Game (Mini Neural Net Demo)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 21:10:31</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46458029"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46457912">
          <h3>
            <a class="item" href="https://automatewithtasker.com/"
              >Show HN: Tasker – An open-source desktop agent for browser and OS
              automation</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 20:53:23</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46457912"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
            <div class="text">
              <p>
                I recently got married, promptly had a bit of a meltdown, and
                decided to lock myself in a room and build for a while.
              </p>
              <p>
                At the same time, I was trying to outbound sell for my startup
                and kept running into the same problem: I wanted an automation
                tool that could actually use my computer like a person. Click
                through UIs, copy/paste between apps, handle messy workflows —
                not just APIs and webhooks.
              </p>
              <p>
                I couldn’t find anything that felt: - consumer-friendly
                (non-technical) - local-first - flexible enough for real-world,
                UI-driven tasks
              </p>
              <p>
                So I challenged myself to see how far I could get building an
                open-source, desktop automation app powered by AI. That’s
                Tasker.
              </p>
              <p>
                I’ve been using it daily for ~2–3 weeks for sales workflows, and
                my father has been using it to help generate estimates for his
                HVAC business. It’s still early (still needs to expand to
                general OS), but it’s already replaced a lot of manual work for
                us in browser.
              </p>
              <p>
                One thing that’s become very clear: a cloud/deployable version
                that can run on cron or be triggered via HTTP would unlock a lot
                of use cases. I’m not totally sure where this goes next, but I
                wanted to share it early and get feedback.
              </p>
              <p>
                Would love thoughts on: - What workflows you’d actually trust
                something like this with - Desktop vs cloud tradeoffs - Where
                this breaks down in practice - Whether this feels useful or just
                scary
              </p>
              <p>Repo and docs are linked on the site.</p>
            </div>
          </section>
        </section>
        <section id="46457784">
          <h3>
            <a
              class="item"
              href="https://henry.codes/writing/a-website-to-destroy-all-websites/"
              >A website to destroy all websites</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 20:36:46</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46457784"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46457770">
          <h3>
            <a
              class="item"
              href="https://www.pcgamer.com/software/linux/im-brave-enough-to-say-it-linux-is-good-now-and-if-you-want-to-feel-like-you-actually-own-your-pc-make-2026-the-year-of-linux-on-your-desktop/"
              >Linux is good now; to feel like you actually own your PC, put
              Linux on it</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 20:35:11</span
              ><span class="points-container"
                >Points: <span class="points">181</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46457770"
                  >Comments</a
                ><span class="descendants">: 133</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46457240">
          <h3>
            <a
              class="item"
              href="https://kuber.studio/blog/Reflections/Prompting-People"
              >Prompting People</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 19:33:53</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46457240"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46457027">
          <h3>
            <a
              class="item"
              href="https://www.jeffgeerling.com/blog/2025/dells-version-dgx-spark-fixes-pain-points"
              >Dell's version of the DGX Spark fixes pain points</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 19:11:53</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46457027"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46456797">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/2025/12/31/europe/finland-estonia-undersea-cable-ship-detained-intl"
              >Finland detains ship and its crew after critical undersea cable
              damaged</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 18:46:07</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46456797"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46456682">
          <h3>
            <a class="item" href="https://lethain.com/agents-coordinators/"
              >Building an internal agent: Code-driven vs. LLM-driven
              workflows</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 18:34:25</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46456682"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46456543">
          <h3>
            <a
              class="item"
              href="https://ocw.mit.edu/courses/18-098-street-fighting-mathematics-january-iap-2008/pages/readings/"
              >Street-Fighting Mathematics (2008)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 18:20:38</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46456543"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46456387">
          <h3>
            <a
              class="item"
              href="https://blog.gdeltproject.org/gemini-as-indiana-jones-how-gemini-3-0-deciphered-the-mystery-of-a-nuremberg-chronicle-leafs-500-year-old-roundels/"
              >Gemini 3.0 Deciphered the Mystery of a Nuremberg Chronicle
              Leaf's</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 18:08:48</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46456387"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46456215">
          <h3>
            <a
              class="item"
              href="https://johnnysswlab.com/memory-subsystem-optimizations/"
              >Memory Subsystem Optimizations</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 17:52:30</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46456215"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46455872">
          <h3>
            <a class="item" href="https://ciechanow.ski/cameras-and-lenses/"
              >Cameras and Lenses (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 17:18:01</span
              ><span class="points-container"
                >Points: <span class="points">283</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46455872"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46455053">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/video-games/playstation/playstation-5-rom-keys-leaked-jailbreaking-could-be-made-easier-with-bootrom-codes"
              >Sony PS5 ROM keys leaked – jailbreaking could be made easier with
              BootROM codes</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 15:57:39</span
              ><span class="points-container"
                >Points: <span class="points">211</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46455053"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46454977">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2026-01-01/byd-sells-4-6-million-vehicles-in-2025-meets-revised-sales-goal"
              >BYD Sells 4.6M Vehicles in 2025, Meets Revised Sales Goal</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 15:49:42</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46454977"
                  >Comments</a
                ><span class="descendants">: 112</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46454968">
          <h3>
            <a
              class="item"
              href="https://centamori.com/index.php?slug=hierarchical-navigable-small-world-hnsw-php&amp;lang=en"
              >Implementing HNSW (Hierarchical Navigable Small World) Vector
              Search in PHP</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 15:48:31</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46454968"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46454958">
          <h3>
            <a class="item" href="https://github.com/fsmunoz/datastar-cl"
              >Common Lisp SDK for the Datastar Hypermedia Framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 15:47:17</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46454958"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46454693">
          <h3>
            <a
              class="item"
              href="https://openworkers.com/introducing-openworkers"
              >Show HN: OpenWorkers – Self-hosted Cloudflare workers in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 15:09:06</span
              ><span class="points-container"
                >Points: <span class="points">304</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46454693"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
            <div class="text">
              <p>
                OpenWorkers lets you run untrusted JS in V8 isolates on your own
                infrastructure. Same DX as Cloudflare Workers, no vendor
                lock-in.
              </p>
              <p>
                What works today: fetch, KV, Postgres bindings, S3/R2, cron
                scheduling, crypto.subtle.
              </p>
              <p>Self-hosting is a single docker-compose file + Postgres.</p>
              <p>
                Would love feedback on the architecture and what feature you'd
                want next.
              </p>
            </div>
          </section>
        </section>
        <section id="46454587">
          <h3>
            <a
              class="item"
              href="https://zekcrates.quarto.pub/deep-learning-library/"
              >Build a Deep Learning Library</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 14:53:50</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46454587"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46454470">
          <h3>
            <a
              class="item"
              href="https://mkennedy.codes/posts/python-numbers-every-programmer-should-know/"
              >Python numbers every programmer should know</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 14:39:23</span
              ><span class="points-container"
                >Points: <span class="points">209</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46454470"
                  >Comments</a
                ><span class="descendants">: 96</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46454413">
          <h3>
            <a class="item" href="https://danwang.co/2025-letter/"
              >2025 Letter</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 14:32:12</span
              ><span class="points-container"
                >Points: <span class="points">204</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46454413"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46454274">
          <h3>
            <a
              class="item"
              href="https://www.starwars.com/news/mythic-discovery-within-the-inner-reaches-of-outer-space-joseph-campbell-meets-george-lucas-part-i"
              >Joseph Campbell Meets George Lucas – Part I (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 14:12:42</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46454274"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46453950">
          <h3>
            <a
              class="item"
              href="https://developer.apple.com/support/alternative-browser-engines-jp/"
              >iOS allows alternative browser engines in Japan</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 13:30:45</span
              ><span class="points-container"
                >Points: <span class="points">306</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46453950"
                  >Comments</a
                ><span class="descendants">: 210</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46453204">
          <h3>
            <a
              class="item"
              href="https://media.ccc.de/v/39c3-bluetooth-headphone-jacking-a-key-to-your-phone"
              >Bluetooth Headphone Jacking: A Key to Your Phone [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 11:17:18</span
              ><span class="points-container"
                >Points: <span class="points">390</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46453204"
                  >Comments</a
                ><span class="descendants">: 123</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46453114">
          <h3>
            <a
              class="item"
              href="https://takes.jamesomalley.co.uk/p/this-might-be-oversharing"
              >I rebooted my social life</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 11:01:38</span
              ><span class="points-container"
                >Points: <span class="points">280</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46453114"
                  >Comments</a
                ><span class="descendants">: 213</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46452916">
          <h3>
            <a class="item" href="https://www.wario.style"
              >Show HN: Wario Synth – Turn any song into Game Boy version</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 10:25:53</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46452916"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
            <div class="text">
              <p>
                Emulates Nintendo's Sharp LR35902 sound hardware: 2 pulse waves
                for melody/harmony, 1 wave channel for bass, 1 noise for
                percussion.
              </p>
              <p>
                Finds MIDI sources, parses tracks, maps to GB roles,
                resynthesizes with Web Audio. Everything runs client-side.
              </p>
              <p>
                Site:
                <a href="https://www.wario.style">https://www.wario.style</a>
              </p>
              <p>
                Open source:
                <a href="https://github.com/b1rdmania/motif"
                  >https://github.com/b1rdmania/motif</a
                >
              </p>
              <p>Hobby project, non commercial, so please don't sue me.</p>
            </div>
          </section>
        </section>
        <section id="46448527">
          <h3>
            <a
              class="item"
              href="https://bcantrill.dtrace.org/2025/12/31/love-your-customers/"
              >Love your customers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-31 @ 21:27:32</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46448527"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46430815">
          <h3>
            <a class="item" href="https://github.com/quickemu-project/quickemu"
              >Quickemu: Quickly create and run optimised Windows, macOS and
              Linux VMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-30 @ 08:19:08</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46430815"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46411930">
          <h3>
            <a
              class="item"
              href="https://media.ccc.de/v/39c3-all-my-deutschlandtickets-gone-fraud-at-an-industrial-scale"
              >All my Deutschlandtickets gone: Fraud at an industrial scale
              [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-28 @ 15:54:02</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46411930"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46402059">
          <h3>
            <a class="item" href="https://github.com/allmonday/pydantic-resolve"
              >How to construct complex data declaratively and progressively?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-27 @ 14:25:43</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46402059"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46392095">
          <h3>
            <a class="item" href="https://zelang-dev.github.io/c-events/"
              >C-events, yet another event loop, simpler, smaller, faster,
              safer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-26 @ 14:06:47</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46392095"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2026/index.md"
              >2026</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
