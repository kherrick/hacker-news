<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38714674">
          <h3>
            <a class="item" href="https://support.apple.com/en-gb/HT213465"
              >iMessage Key Verification</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 22:46:35</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38714674"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38714607">
          <h3>
            <a
              class="item"
              href="https://www.panoptica.app/research/7-ways-to-escape-a-container"
              >How to Escape a Container</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 22:40:14</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38714607"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38713927">
          <h3>
            <a class="item" href="https://zoo.dev/blog/introducing-text-to-cad"
              >Text-to-CAD</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 21:32:53</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38713927"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38713578">
          <h3>
            <a
              class="item"
              href="https://jobs.ashbyhq.com/TigerEye/1dc43727-c2f8-4528-a5ac-7a875001f14f"
              >TigerEye (YC S22) is hiring an experienced front end engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 21:00:33</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38713167">
          <h3>
            <a class="item" href="https://www.sixdegreesofwikipedia.com/"
              >Six Degrees of Wikipedia</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 20:26:43</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38713167"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38712883">
          <h3>
            <a class="item" href="https://lockedinspace.com/posts/002.html"
              >Lessons on building business value</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 19:57:48</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38712883"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38712802">
          <h3>
            <a
              class="item"
              href="https://openpipe.ai/blog/mistral-7b-fine-tune-optimized"
              >Mistral 7B Fine-Tune Optimized</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 19:50:24</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38712802"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38712326">
          <h3>
            <a
              class="item"
              href="https://www.righto.com/2023/12/HP-silicon-on-sapphire-phi-chip.html"
              >The transparent chip inside a vintage Hewlett-Packard floppy
              drive</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 19:05:11</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38712326"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38711494">
          <h3>
            <a class="item" href="https://blog.notryan.com/009.txt"
              >100 Lines of C, in a Closet (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 17:55:22</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38711494"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38711278">
          <h3>
            <a
              class="item"
              href="https://www.robkhenderson.com/p/the-machiavellian-maze"
              >The Machiavellian Maze</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 17:38:23</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38711278"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38710709">
          <h3>
            <a class="item" href="https://lwn.net/Articles/884875/"
              >Uniting the Linux random-number devices (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 16:53:05</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38710709"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38710600">
          <h3>
            <a class="item" href="https://github.com/quack-ai/companion"
              >Show HN: Quack Companion – VSCode extension for OSS contribution
              assistance</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 16:43:10</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38710600"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/quack-ai/companion"
                >https://github.com/quack-ai/companion</a
              >), a tool designed to bridge the gap between project maintainers
              and contributors in open-source software (OSS).
              <p>
                If you've ever contributed to OSS, you're familiar with the
                challenge: diving into a new codebase, aligning with
                maintainers' expectations, and making meaningful contributions
                can be daunting. For maintainers, managing a flood of
                contributions and providing guidance while maintaining quality
                is overwhelming. As a contributor to PyTorch &amp; an OSS
                author, I’ve been on both sides over the years. This challenged
                me to become a better engineer &amp; team player, seeking ways
                to facilitate smooth collaborative software development.
              </p>
              <p>
                This is where Quack steps in, as your AI companion for software
                team alignment. For developers, it's like having a seasoned
                mentor guiding you through the intricacies of a new codebase,
                offering live in-line hints based on the project’s guidelines to
                craft high-quality pull requests. For maintainers, it’s a
                practical toolset to identify and address workflow
                inefficiencies and align contributions effectively with project
                objectives.
              </p>
              <p>
                As code generation gets commoditized, aligning these diverse
                efforts becomes critical if you wish to convert individual
                productivity boosts into team velocity. Quack AI is here to
                solve this alignment, and make collaborative software
                development scale without losing any efficiency.
              </p>
              <p>
                We're committed to keeping the service accessible and free for
                OSS communities while we plan to generate revenue from the
                enterprise suite. The platform (React, Next JS), the IDE
                extension (VSCode) and the backend API (Python, FastAPI) are
                licensed under Apache 2.0. You can find a short demo here [1]
                and the GitHub project here [2].
              </p>
              <p>Our roadmap includes:</p>
              <p>
                * offering autocompletion and code chat in the IDE, making the
                contribution process even more intuitive and seamless;
              </p>
              <p>
                * finalizing the transition of the community version to hostable
                OSS models;
              </p>
              <p>
                * identifying ambiguities or unspecified aspects of a given
                project’s guidelines;
              </p>
              <p>
                * developing a Fitbit-like feature for your software development
                productivity to identify bottlenecks in your workflow.
              </p>
              <p>
                This is still the early days, but we've seen how sharing a
                "public design doc" with the community can significantly improve
                the outcome! How was your experience of managing inbound as
                maintainers? What were your personal hacks to mitigate those
                challenges? We'd love to hear about how it has impacted your
                developer life or if you have any feedback about the above.
              </p>
              <p>Cheers!</p>
              <p>
                [1] Demo video:
                <a href="https://dub.sh/quack-demo"
                  >https://dub.sh/quack-demo</a
                >
              </p>
              <p>
                [2] Open Source repo:
                <a href="https://github.com/quack-ai/companion"
                  >https://github.com/quack-ai/companion</a
                >
              </p>
              <p>
                Our documentation:
                <a href="https://docs.quackai.com/"
                  >https://docs.quackai.com/</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="38710387">
          <h3>
            <a
              class="item"
              href="https://questdb.io/blog/building-faster-hash-table-high-performance-sql-joins/"
              >Building a faster hash table for high performance SQL joins</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 16:26:35</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38710387"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38710030">
          <h3>
            <a class="item" href="https://wireflow.co"
              >Wireflow – free, online, open source tool for creating user-flow
              prototypes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 15:55:07</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38710030"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38709319">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2023/12/19/24008426/volkswagen-audi-porsche-tesla-nacs-ev-charging-plug"
              >Volkswagen, Porsche, and Audi say they will use Tesla's EV
              charging plug</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 14:56:26</span
              ><span class="points-container"
                >Points: <span class="points">279</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38709319"
                  >Comments</a
                ><span class="descendants">: 451</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38709172">
          <h3>
            <a
              class="item"
              href="https://eu.getdot.ai/share/c80139c9-13f4-4db4-88f6-6e058ba31ad4?org_id=getdot.ai"
              >Hacker News Activity Analysis with GPT-4 Agent</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 14:42:08</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38709172"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.getdot.ai">https://www.getdot.ai</a>) that
              lets data teams enable everyone in their org to self-serve on
              governed data. We thought we'd demo it using the tried and true
              method of "show Hacker News stuff about itself".
              <p>
                For this analysis, we used the BigQuery dataset of HN (<a
                  href="https://console.cloud.google.com/marketplace/product/y-combinator/hacker-news"
                  >https://console.cloud.google.com/marketplace/product/y-combi...</a
                >). We created one more table to pre-calculate yearly retention.
                And of course, a lot of the heavy lifting is done by OpenAI's
                GPT-4 models and the fantastic plotly library for visualization.
              </p>
              <p>
                Let us know what other things you'd like to see about Hacker
                News data in the comments, and try our best to share the
                answers!
              </p>
            </div>
          </section>
        </section>
        <section id="38708743">
          <h3>
            <a class="item" href="https://blar.do/how-i-work/">How I Work</a>
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 13:59:59</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38708743"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38708730">
          <h3>
            <a class="item" href="https://github.com/johnma2006/mamba-minimal"
              >Implementation of Mamba in one file of PyTorch</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 13:58:51</span
              ><span class="points-container"
                >Points: <span class="points">317</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38708730"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38708606">
          <h3>
            <a class="item" href="https://nathan.ho.name/posts/acoustic-sounds/"
              >Making synthesized sounds more acoustic</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 13:48:09</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38708606"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38708585">
          <h3>
            <a class="item" href="https://github.com/SJTU-IPADS/PowerInfer"
              >High-Speed Large Language Model Serving on PCs with
              Consumer-Grade GPUs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 13:46:08</span
              ><span class="points-container"
                >Points: <span class="points">259</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38708585"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38708185">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/tech-industry/quantum-computing/ibm-demonstrates-useful-quantum-computing-within-133-qubit-heron-announces-entry-into-quantum-centric-supercomputing-era"
              >IBM demonstrates 133-qubit Heron</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 13:05:53</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38708185"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38707980">
          <h3>
            <a
              class="item"
              href="https://www.latimes.com/california/story/2023-11-21/la-me-bowling-revolution"
              >String pinsetters are upending bowling</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 12:43:33</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38707980"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38706951">
          <h3>
            <a
              class="item"
              href="https://victorguyard.com/projects/createxcapstone"
              >Creating a Disc Golf picker upper</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 09:51:03</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38706951"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38702276">
          <h3>
            <a
              class="item"
              href="https://www.switchyardmag.com/issue-1/bulgarianfrontier"
              >The Closing of the Bulgarian Frontier</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-19 @ 21:59:39</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38702276"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38701327">
          <h3>
            <a
              class="item"
              href="https://www.alexmolas.com/2023/11/30/conditioning-is-grouping-by.html"
              >Conditioning Is Grouping By</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-19 @ 20:49:26</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38701327"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38700779">
          <h3>
            <a
              class="item"
              href="http://blog.pamelafox.org/2023/12/my-failed-attempt-at-using-closet-as.html"
              >My failed attempt at using a closet as an office</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-19 @ 20:05:37</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38700779"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38699010">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=mK2WUDIY4hk"
              >Dyalog '18: Rectangles All the Way Down (2018) [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-19 @ 17:57:48</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38699010"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38694051">
          <h3>
            <a
              class="item"
              href="https://www.tokyodev.com/articles/all-code-is-technical-debt"
              >All code is technical debt</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-19 @ 10:46:47</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38694051"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38693984">
          <h3>
            <a class="item" href="https://neumannspace.com/neumann-drive/"
              >Neumann Drive: A Pulsed Cathodic Arc Thruster for Spacecrafts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-19 @ 10:33:19</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38693984"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38693421">
          <h3>
            <a class="item" href="https://lisa.sunder.net/"
              >Lisa Emulator Project</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-19 @ 09:06:33</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38693421"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
