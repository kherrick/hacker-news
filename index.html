<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40713389">
          <h3>
            <a
              class="item"
              href="https://epochai.org/blog/will-we-run-out-of-data-limits-of-llm-scaling-based-on-human-generated-data"
              >Will We Run Out of Data? Limits of LLM Scaling Based on
              Human-Generated Data</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 02:04:52</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40713389"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40712720">
          <h3>
            <a
              class="item"
              href="https://www.gingerbill.org/article/2024/06/17/go-iterator-design/"
              >The upcoming iterator design for Go 1.23</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 00:15:03</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40712720"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40712020">
          <h3>
            <a class="item" href="https://github.com/kitsunyan/intel-undervolt"
              >Intel-undervolt: CPU undervolting and throttling configuration
              tool for Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 22:44:44</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40712020"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40711835">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/2024/06/15/intel-details-skymont/"
              >Intel details Skymont</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 22:24:47</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40711835"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40711780">
          <h3>
            <a
              class="item"
              href="https://www.biography.com/history-culture/a44577392/tsutomu-yamaguchi-hiroshima-and-nagasaki-bombing-survivor"
              >Tsutomu Yamaguchi – A man who survived both atomic bombings
              (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 22:19:38</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40711780"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40711661">
          <h3>
            <a
              class="item"
              href="https://olano.dev/blog/a-note-on-essential-complexity"
              >A Note on Essential Complexity</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 22:08:19</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40711661"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40711600">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2024-06-17/google-deepmind-shifts-from-research-lab-to-ai-product-factory"
              >Google DeepMind shifts from research lab to AI product factory</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 22:02:59</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40711600"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40711484">
          <h3>
            <a
              class="item"
              href="https://redwoodresearch.substack.com/p/getting-50-sota-on-arc-agi-with-gpt"
              >Getting 50% (SoTA) on Arc-AGI with GPT-4o</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 21:51:14</span
              ><span class="points-container"
                >Points: <span class="points">173</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40711484"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40711447">
          <h3>
            <a class="item" href="https://cohere.com/blog/multi-step-tool-use"
              >LLM that can call multiple tool APIs with one request</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 21:47:34</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40711447"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40711284">
          <h3>
            <a
              class="item"
              href="https://news.asu.edu/20240617-science-and-technology-asu-study-points-origin-cumulative-culture-human-evolution"
              >Humans began to rapidly accumulate technological knowledge 600k
              years ago</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 21:28:50</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40711284"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40711086">
          <h3>
            <a class="item" href="https://j3s.sh/thought/stop-using-fandom.html"
              >“Attention assault” on Fandom</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 21:08:11</span
              ><span class="points-container"
                >Points: <span class="points">300</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40711086"
                  >Comments</a
                ><span class="descendants">: 143</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40711008">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/suiteness/jobs/DIrk9Sf-front-end-engineer"
              >Suiteness (YC S16) Is Hiring for TypeScript/Qwik</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 21:00:14</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40710417">
          <h3>
            <a
              class="item"
              href="https://www.bizjournals.com/sanfrancisco/inno/stories/news/2024/04/15/sam-altman-y-combinator-board-chair.html"
              >Sam Altman is not on YC's board. So why claim to be its chair?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 20:04:19</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40710417"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40710397">
          <h3>
            <a
              class="item"
              href="https://www.thrillingtalesofoldvideogames.com/blog/ms-pac-man-disappear-pac-mom"
              >Where did you go, Ms. Pac-Man?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 20:02:34</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40710397"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40710201">
          <h3>
            <a
              class="item"
              href="https://usmannkhan.com/bug%20reports/2024/06/17/sei-bug-report.html"
              >Sei pays out $2M bug bounty</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 19:49:10</span
              ><span class="points-container"
                >Points: <span class="points">198</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40710201"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40710154">
          <h3>
            <a class="item" href="https://github.com/AgentOps-AI/tokencost"
              >Show HN: Token price calculator for 400+ LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 19:44:53</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40710154"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
            <div class="text">
              <p>
                Tokencost works by counting the number of tokens in prompt and
                completion messages and multiplying that number by the
                corresponding model cost. Under the hood, it’s really just a
                simple cost dictionary and some utility functions for getting
                the prices right. It also accounts for different tokenizers and
                float precision errors.
              </p>
              <p>
                Surprisingly, most model providers don't actually report how
                much you spend until your bills arrive. We built Tokencost
                internally at AgentOps to help users track agent spend, and we
                decided to open source it to help developers avoid nasty bills.
              </p>
            </div>
          </section>
        </section>
        <section id="40710138">
          <h3>
            <a class="item" href="https://www.threadquilt.com"
              >Show HN: ThreadQuilt: AI-Free Thread Aggregator</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 19:43:13</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40710138"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
            <div class="text">
              <p>
                I've been working on a project called ThreadQuilt, and I'm
                excited to share it with you all. ThreadQuilt is a community
                discussion aggregator that brings together the best threads from
                various forums and platforms into one convenient place. Whether
                you're interested in programming, tech trends, or just want to
                stay updated on niche topics, ThreadQuilt helps you find and
                follow the most relevant conversations without the clutter of
                AI-generated content. It's all about real human discussions,
                curated for quality and relevance.
              </p>
              <p>
                I built ThreadQuilt because I was tired of wading through
                endless noise to find meaningful discussions. With ThreadQuilt,
                you get a cleaner, more focused experience that highlights the
                best parts of the web's conversations. Check it out and let me
                know what you think! Your feedback would mean the world to me as
                I continue to improve and expand the site. Happy threading!
              </p>
            </div>
          </section>
        </section>
        <section id="40708476">
          <h3>
            <a
              class="item"
              href="https://github.com/nicanorflavier/spf-dkim-dmarc-simplified"
              >Understanding SPF, DKIM, and DMARC: A Simple Guide</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 17:35:20</span
              ><span class="points-container"
                >Points: <span class="points">254</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40708476"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40707558">
          <h3>
            <a
              class="item"
              href="https://www.ftc.gov/news-events/news/press-releases/2024/06/ftc-takes-action-against-adobe-executives-hiding-fees-preventing-consumers-easily-cancelling"
              >FTC sues Adobe for hiding fees and inhibiting cancellations</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 16:29:53</span
              ><span class="points-container"
                >Points: <span class="points">1728</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40707558"
                  >Comments</a
                ><span class="descendants">: 579</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40705574">
          <h3>
            <a
              class="item"
              href="https://twitter.com/Khode_Erfan/status/1802331845633212554"
              >Lindroid</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 13:46:04</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40705574"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40705522">
          <h3>
            <a
              class="item"
              href="https://www.bigmessowires.com/2017/12/07/fpga-based-disk-controller-for-apple-ii/"
              >FPGA-Based Disk Controller for the Apple II</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 13:40:15</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40705522"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40705222">
          <h3>
            <a class="item" href="https://howtoware.co/wyldcard"
              >Trading cards with e-ink displays (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 13:04:29</span
              ><span class="points-container"
                >Points: <span class="points">360</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40705222"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40704594">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/tech-industry/optical-pcie-70-connection-hits-a-blazing-128-gts"
              >Optical PCIe 7.0 connection hits 128 GT/s</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 11:42:08</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40704594"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40704179">
          <h3>
            <a
              class="item"
              href="https://futhark-lang.org/blog/2024-06-17-automap.html"
              >NumPy-style broadcasting in Futhark</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 10:38:34</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40704179"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40703554">
          <h3>
            <a class="item" href="https://skarnet.org/software/nsss/"
              >Nsss: A secure NSS-like implementation for static linking</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 08:42:03</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40703554"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40703335">
          <h3>
            <a class="item" href="https://benjaminnoble.org/blog/short-talk"
              >A long guide to giving a short academic talk (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 08:04:36</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40703335"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40698451">
          <h3>
            <a
              class="item"
              href="https://hakaimagazine.com/features/a-step-forward-in-stingray-science/"
              >A Step Forward in Stingray Science</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-16 @ 16:56:05</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40698451"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40698415">
          <h3>
            <a
              class="item"
              href="https://www.noemamag.com/the-unending-allure-of-high-mountains/"
              >The unending allure of high mountains</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-16 @ 16:50:48</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40698415"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40694284">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/articles/cv223z15mpmo"
              >Are animals conscious? New research</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-16 @ 02:36:03</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40694284"
                  >Comments</a
                ><span class="descendants">: 215</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40692333">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/science/article/2024/jun/15/london-underground-quantum-compass-gps-subatomic-instrument-locations"
              >London Underground hosts tests for 'quantum compass' that could
              replace GPS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-15 @ 20:03:27</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40692333"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
