<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39102021">
          <h3>
            <a
              class="item"
              href="https://viewfromthewing.com/boeing-whistleblower-production-line-has-enormous-volume-of-defects-bolts-on-max-9-werent-installed/"
              >Boeing Whistleblower: Max 9 Production Line Has "Enormous Volume
              of Defects"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 11:28:54</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39102021"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39101828">
          <h3>
            <a
              class="item"
              href="https://leebriggs.co.uk/blog/2019/02/07/why-are-we-templating-yaml"
              >Why the fuck are we templating YAML? (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 10:58:41</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39101828"
                  >Comments</a
                ><span class="descendants">: 150</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39101682">
          <h3>
            <a
              class="item"
              href="https://qdrant.tech/blog/series-a-funding-round/"
              >Qdrant, the Vector Search Database, raised $28M in a Series A
              round</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 10:34:38</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39101682"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39101471">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=tcnN7yWCPGM"
              >Sonic: Towards a Sea-of-Nodes Inlining Compiler for Smalltalk in
              Smalltalk [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 09:57:52</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39101471"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39101165">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/articles/make-coffee-moka-pot"
              >The Humble Brilliance of Italy's Moka Coffee Pot</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 09:13:08</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39101165"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39100308">
          <h3><a class="item" href="https://ohmyz.sh/">Oh My Zsh</a></h3>
          <section>
            <h4>
              <span>2024-01-23 @ 06:47:53</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39100308"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39099980">
          <h3>
            <a class="item" href="https://github.com/rajnandan1/kener"
              >Show HN: Built a self hosted clean status page and batteries</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 05:36:07</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39099980"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
            <div class="text">
              Status pages have been the way they have seen the mid 2010s. There
              are few new ones but they are paid. So I decided to build this
              using svelte + sveltekit. It has all the necessary features. Few
              are yet to be built. Do check it out
            </div>
          </section>
        </section>
        <section id="39099065">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39099065"
              >Tell HN: Hacker News now supports IPv6</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 03:00:15</span
              ><span class="points-container"
                >Points: <span class="points">426</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39099065"
                  >Comments</a
                ><span class="descendants">: 212</span></span
              >
            </h4>
            <div class="text">
              <p></p>
              <pre><code>  $ host news.ycombinator.com
  news.ycombinator.com has address 209.216.230.207
  news.ycombinator.com has IPv6 address 2606:7100:1:67::26
</code></pre>
              Both IP addresses share the same ASN (M5 Computer Security):
              <a href="https://bgp.he.net/ip/209.216.230.207"
                >https://bgp.he.net/ip/209.216.230.207</a
              >
              <a href="https://bgp.he.net/ip/2606:7100:1:67::26"
                >https://bgp.he.net/ip/2606:7100:1:67::26</a
              >
              <p>
                The raw IP address correctly redirects to HN:
                <a href="http://[2606:7100:1:67::26]"
                  >http://[2606:7100:1:67::26]</a
                >
              </p>
              <p>
                Good job so far! Please don't pull a Reddit and turn it off
                again.
              </p>
            </div>
          </section>
        </section>
        <section id="39098803">
          <h3>
            <a
              class="item"
              href="https://zverok.substack.com/p/the-end-of-useless-ruby-sugar-on"
              >The end of "Useless Ruby sugar": On intuitions and evolutions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 02:28:02</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39098803"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39098603">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/01/22/science/space/arno-a-penzias-dead.html"
              >Arno A. Penzias, 90, Dies; Nobel Physicist Confirmed Big Bang
              Theory</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 02:05:46</span
              ><span class="points-container"
                >Points: <span class="points">203</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39098603"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39098253">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-01-efficiency-asymmetry-scientists-fundamental-cooling.html"
              >Scientists report asymmetry between heating and cooling</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 01:27:20</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39098253"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39098133">
          <h3>
            <a class="item" href="https://github.com/viraniaman94/sendenv"
              >Show HN: Sendenv, a CLI tool to share environment variables</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 01:17:29</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39098133"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
            <div class="text">
              <p>
                Its currently in alpha obviously, but the core functionality
                works (I have tested sending vaults from a Macbook Air M1 to a
                ubuntu ec2 instance). I have a lot of follow up ideas to make
                this better, but wanted the community's feedback before I invest
                more time on this.
              </p>
              <p>Thanks for reading!</p>
            </div>
          </section>
        </section>
        <section id="39097976">
          <h3>
            <a
              class="item"
              href="https://ryanbrewer.dev/posts/announcing-svm.html"
              >SaberVM</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 01:03:56</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39097976"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39097681">
          <h3>
            <a
              class="item"
              href="https://www.matheusmoreira.com/articles/self-contained-lone-lisp-applications"
              >Self-contained Linux applications with lone Lisp</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 00:34:07</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39097681"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39097502">
          <h3>
            <a class="item" href="https://github.com/stas00/ml-engineering"
              >ML Engineering Online Book</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 00:14:26</span
              ><span class="points-container"
                >Points: <span class="points">266</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39097502"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39097314">
          <h3>
            <a class="item" href="https://konecipv4.cz/en/"
              >Czech republic sets IPv4 end date</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-22 @ 23:56:07</span
              ><span class="points-container"
                >Points: <span class="points">320</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39097314"
                  >Comments</a
                ><span class="descendants">: 285</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39096138">
          <h3>
            <a class="item" href="https://vimeo.com/802502826"
              >Zag Smalltalk (2022) [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-22 @ 22:04:31</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39096138"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39095337">
          <h3>
            <a class="item" href="https://winlator.org/"
              >Winlator: Android app that lets you to run Windows apps with
              Wine</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-22 @ 20:57:27</span
              ><span class="points-container"
                >Points: <span class="points">297</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39095337"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39094181">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39094181"
              >Ask HN: Is Apple's R1 a Discrete GPU?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-22 @ 19:30:21</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39094181"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
            <div class="text">
              <p>The confirmed details of the R1 chip are scant:</p>
              <p>
                - It does a lot of image processing and sensor data integration:
                "the brand-new R1 chip processes input from 12 cameras, five
                sensors, and six microphones to ensure that content feels like
                it is appearing right in front of the user's eyes, in real time.
                R1 streams new images to the displays within 12 milliseconds"[0]
              </p>
              <p>
                - It has substantial memory bandwidth: "256GB/s memory
                bandwidth"[1]
              </p>
              <p>
                - It uses special, high bandwidth memory: "To support R1’s
                high-speed processing, SK hynix has developed the custom
                1-gigabit DRAM. The new DRAM is known to have increased the
                number of input and output pins by eightfold to minimize delays.
                Such chips are also called Low Latency Wide IO. According to
                experts, the new chip also appears to have been designed using a
                special packaging method – Fan-Out Wafer Level Packaging – to be
                attached to the R1 chipset as a single unit […]"[2]
              </p>
              <p>
                - This is subjective, but: Apple shows it as being roughly the
                same size as the M2 processor in the Vision Pro marketing[3],
                indicating it's a peer to the M2. Now, that may mean nothing,
                but based on my experience with Apple kremlinology they are not
                arbitrary about stuff like that.
              </p>
              <p>
                So I see all this and get major GPU vibes. But I'm just some guy
                on a the internet, so what do I know?
              </p>
              <p>
                0:
                https://www.macrumors.com/2023/06/05/apple-reveals-vision-pro-headset/
              </p>
              <p>1: https://www.apple.com/apple-vision-pro/specs/</p>
              <p>2: https://9to5mac.com/2023/07/11/vision-pro-performance/</p>
              <p>3: https://www.apple.com/apple-vision-pro/</p>
            </div>
          </section>
        </section>
        <section id="39093927">
          <h3>
            <a
              class="item"
              href="https://huggingface.co/spaces/Synanthropic/reading-analog-gauge"
              >Show HN: Simply Reading Analog Gauges – GPT4, CogVLM Can't</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-22 @ 19:11:26</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39093927"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39093682">
          <h3>
            <a class="item" href="https://www.noemamag.com/feral-intelligence/"
              >Feral Minds</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-22 @ 18:56:08</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39093682"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39092863">
          <h3>
            <a class="item" href="https://pketh.org/building-offline.html"
              >The building blocks of offline support</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-22 @ 18:00:38</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39092863"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39092505">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gaming/2024/01/modder-recreates-game-boy-advance-games-using-the-audio-from-crash-sounds/"
              >Modder re-creates Game Boy Advance games using the audio from
              crash sounds</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-22 @ 17:39:13</span
              ><span class="points-container"
                >Points: <span class="points">503</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39092505"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39091867">
          <h3>
            <a class="item" href="https://www.hillelwayne.com/post/randomness/"
              >An RNG that runs in your brain</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-22 @ 17:00:44</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39091867"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39087373">
          <h3>
            <a class="item" href="https://iter.ca/post/rust-skip-borrowck/"
              >Turning off Rust's borrow checker completely (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-22 @ 08:01:35</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39087373"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39086334">
          <h3>
            <a class="item" href="https://iter.ca/post/gh-sig-pwn/"
              >Forging signed commits on GitHub</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-22 @ 04:49:26</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39086334"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39084177">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=5TPBesaSkZ8"
              >Reverse Engineering the TouchBar Screen and MIPI DSI Primer
              [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-21 @ 23:33:53</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39084177"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39083928">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=7RXWXYboUjA"
              >Can You Live Code a Church Organ? [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-21 @ 22:54:53</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39083928"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39081876">
          <h3>
            <a
              class="item"
              href="https://bitbytebit.substack.com/p/the-size-of-your-backlog-is-inversely"
              >Backlog size is inversely proportional to how often we talk to
              customers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-21 @ 19:18:00</span
              ><span class="points-container"
                >Points: <span class="points">274</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39081876"
                  >Comments</a
                ><span class="descendants">: 122</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39074159">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/articles/the-sweet-sacredness-of-edible-prayers"
              >Tiny Baroque Prints Once Served as Edible Prayers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-21 @ 00:31:20</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39074159"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
