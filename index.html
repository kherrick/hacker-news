<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44927222">
          <h3>
            <a
              class="item"
              href="https://aimode.substack.com/p/ai-apps-are-like-music"
              >AI apps are like music</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-16 @ 21:59:28</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44927222"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44926965">
          <h3>
            <a class="item" href="https://www.bbc.com/news/health-26888280"
              >Living with Williams Syndrome, the 'opposite of autism' (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-16 @ 21:12:40</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44926965"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44926758">
          <h3>
            <a
              class="item"
              href="https://victorwynne.com/processor-trace-instrument/"
              >Apple's new Processor Trace instrument is incredible</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-16 @ 20:42:28</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44926758"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44926414">
          <h3>
            <a class="item" href="https://dyna.org/"
              >Dyna – Logic Programming for Machine Learning</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-16 @ 19:50:15</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44926414"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44925966">
          <h3>
            <a
              class="item"
              href="https://torrentfreak.com/pirate-library-operator-arrested-study-canceled-for-330k-members-250814/"
              >Pirate Library Operator Arrested, Study Canceled for 330K
              Members</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-16 @ 18:50:07</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44925966"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44925853">
          <h3>
            <a
              class="item"
              href="https://github.com/Robert-van-Engelen/tinylisp"
              >A Lisp in 99LOC</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-16 @ 18:37:17</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44925853"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44925847">
          <h3>
            <a class="item" href="https://www.openpa.net/hp-ux_office.html"
              >Office on HP-UX and Unix</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-16 @ 18:36:46</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44925847"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44925597">
          <h3>
            <a class="item" href="https://github.com/superstarryeyes/lue"
              >Show HN: Lue – Terminal eBook Reader with Text-to-Speech</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-16 @ 18:00:33</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44925597"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
            <div class="text">
              <p>Hello,</p>
              <p>Just went live on GitHub with this project.</p>
              <p>
                I really enjoy listening to my eBooks as audiobooks but was
                frustrated by the available options. Converting books into
                audiobooks with scripts is tedious, and most tools stumble over
                footnotes, headers, or formatting. I wanted something simple:
                just throw a book at it, and it starts reading immediately
                without any clicking or loading.
              </p>
              <p>
                I also wanted it to be customizable and modular because new,
                better TTS engines are released all the time. For this initial
                release, I settled on Edge and Kokoro because they’re both fast
                (real-time) and good quality. I’ve already made modules for
                Kitten TTS, Gemini and a few others, and they work too. So I
                hope this setup is future-proof.
              </p>
              <p>Here’s what Lue supports:</p>
              <p>
                Multi-format: EPUB, PDF, TXT, DOCX, HTML, RTF, and Markdown.
              </p>
              <p>
                Modular TTS system: Default Edge TTS (online) and Kokoro TTS
                (offline/local), with an architecture to add more models.
              </p>
              <p>
                Rich terminal UI: Full keyboard and mouse support, customizable
                color themes, smooth scrolling.
              </p>
              <p>
                Smart persistence: Automatically saves reading progress across
                sessions.
              </p>
              <p>
                Cross-platform &amp; multilingual: macOS, Linux, Windows,
                supporting 100+ languages.
              </p>
              <p>
                I’d love feedback on both usability and the TTS experience. Are
                there any features you wish it had?
              </p>
            </div>
          </section>
        </section>
        <section id="44925476">
          <h3>
            <a
              class="item"
              href="https://chatgpt.com/g/g-67ec3b78892481918c89067962526695-monday"
              >Monday – A personality experiment</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-16 @ 17:46:32</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44925476"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44925466">
          <h3>
            <a
              class="item"
              href="https://smallcultfollowing.com/babysteps/blog/2025/03/10/rust-2025-intro/"
              >Rust in 2025: Targeting foundational software</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-16 @ 17:45:00</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44925466"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44925380">
          <h3>
            <a
              class="item"
              href="https://derwiki.medium.com/do-things-that-dont-scale-and-then-don-t-scale-9fd2cd7e2156"
              >Do things that don't scale, and then don't scale</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-16 @ 17:33:08</span
              ><span class="points-container"
                >Points: <span class="points">296</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44925380"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44925123">
          <h3>
            <a
              class="item"
              href="https://gonzoml.substack.com/p/tversky-neural-networks"
              >Tversky Neural Networks</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-16 @ 16:59:51</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44925123"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44924461">
          <h3>
            <a class="item" href="https://progress.openai.com"
              >OpenAI Progress</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-16 @ 15:47:12</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44924461"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44924055">
          <h3>
            <a
              class="item"
              href="https://voidfox.com/blog/payment_processor_fun_2025_making_your_own_msp/"
              >Making Your Own Merchant Service Provider</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-16 @ 15:01:20</span
              ><span class="points-container"
                >Points: <span class="points">218</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44924055"
                  >Comments</a
                ><span class="descendants">: 142</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44923962">
          <h3>
            <a
              class="item"
              href="https://www.energy-reporters.com/environment/97-battery-recycling-breakthrough-princeton-nuenergy-opens-first-u-s-commercial-facility-cutting-costs-38-and-slashing-environmental-impact/"
              >Princeton NuEnergy's battery recycling tech recovers 97% of
              lithium-ion material</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-16 @ 14:49:49</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44923962"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44923465">
          <h3>
            <a class="item" href="https://pudding.cool/2025/08/onions/"
              >Dicing an Onion, the Mathematically Optimal Way</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-16 @ 13:54:19</span
              ><span class="points-container"
                >Points: <span class="points">170</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44923465"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44922571">
          <h3>
            <a
              class="item"
              href="https://www.kcl.ac.uk/news/toothpaste-made-from-hair-provides-natural-root-to-repair-teeth"
              >Toothpaste made with keratin may protect and repair damaged
              teeth: study</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-16 @ 12:13:12</span
              ><span class="points-container"
                >Points: <span class="points">284</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44922571"
                  >Comments</a
                ><span class="descendants">: 155</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44922484">
          <h3>
            <a
              class="item"
              href="https://www.ashbyhq.com/careers?utm_source=hn&amp;ashby_jid=579e9d03-0724-482b-a42a-8e5e80d73405"
              >Ashby (YC W19) Is Hiring Design Engineers in AMER and EMEA</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-16 @ 12:00:59</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44922020">
          <h3>
            <a
              class="item"
              href="https://qouteall.fun/qouteall-blog/2025/Traps%20to%20Developers"
              >Traps to Developers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-16 @ 10:34:35</span
              ><span class="points-container"
                >Points: <span class="points">163</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44922020"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44921609">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Pfeilstorch"
              >Pfeilstorch</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-16 @ 09:07:49</span
              ><span class="points-container"
                >Points: <span class="points">172</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44921609"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44921137">
          <h3>
            <a
              class="item"
              href="https://www.seangoedecke.com/good-system-design/"
              >Good system design</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-16 @ 07:38:46</span
              ><span class="points-container"
                >Points: <span class="points">688</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44921137"
                  >Comments</a
                ><span class="descendants">: 315</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44919891">
          <h3>
            <a class="item" href="https://putty.software/"
              >PuTTY has a new website</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-16 @ 03:35:06</span
              ><span class="points-container"
                >Points: <span class="points">442</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44919891"
                  >Comments</a
                ><span class="descendants">: 230</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44901485">
          <h3>
            <a
              class="item"
              href="https://www.token.security/blog/why-remediation-is-the-hardest-problem-in-nhi-security"
              >Remediation the hardest problem in Non-Human Identity Security</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-14 @ 15:21:47</span
              ><span class="points-container"
                >Points: <span class="points">3</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44901485"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44899516">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/article/single-lock-hair-could-rewrite-what-we-know-about-inca-record-keeping"
              >A single lock of hair could rewrite what we know about Inca
              record-keeping</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-14 @ 12:17:18</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44899516"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44898560">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/how-randomness-improves-algorithms-20230403/"
              >How randomness improves algorithms (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-14 @ 09:43:53</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44898560"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44897255">
          <h3>
            <a
              class="item"
              href="https://hudsonreview.com/2025/08/james-baldwins-apotheosis/"
              >James Baldwin's Apotheosis</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-14 @ 06:14:34</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44897255"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44893118">
          <h3>
            <a
              class="item"
              href="https://www.troyhunt.com/that-16-billion-password-story-aka-data-troll/"
              >That 16 Billion Password Story (AKA "Data Troll")</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-13 @ 20:01:21</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44893118"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44889163">
          <h3>
            <a
              class="item"
              href="https://gautiersblog.blogspot.com/2025/07/writing-bzip2-encoder-in-ada-from.html"
              >Writing a competitive BZip2 encoder in Ada from scratch in a few
              days – part 2</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-13 @ 14:47:01</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44889163"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44886202">
          <h3>
            <a class="item" href="https://raft.github.io/"
              >The Raft Consensus Algorithm (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-13 @ 09:09:34</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44886202"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44884077">
          <h3>
            <a
              class="item"
              href="https://nikodunk.com/2025-06-10-diy-serverless-(coreos-+-dokploy)"
              >Dokploy is the sweet spot between PaaS and EC2</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-13 @ 02:24:18</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44884077"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
