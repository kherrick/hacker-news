<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36366179">
          <h3>
            <a class="item" href="https://github.com/andrewrk/poop"
              >Poop: Performance Optimizer Observation Platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-17 @ 01:17:12</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36366179"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36366137">
          <h3>
            <a
              class="item"
              href="https://e360.yale.edu/digest/groundwater-depletion-earths-axis"
              >Humans have pumped enough groundwater to change the tilt of the
              Earth</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-17 @ 01:10:53</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36366137"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36366106">
          <h3>
            <a class="item" href="https://waivek.github.io/website/tooltip.html"
              >Smart Guy Productivity Pitfalls (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-17 @ 01:07:00</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36366106"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36366062">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36366062"
              >Generally Intelligent (YC S17) Is Hiring a Chief of Staff</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-17 @ 01:01:48</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
            <div class="text">
              <a
                href="https://jobs.lever.co/generallyintelligent/f5d04435-cfb5-4e3a-9269-8c5bda3ede50?lever-origin=applied&amp;lever-source%5B%5D=Y%20Combinator"
                >https://jobs.lever.co/generallyintelligent/f5d04435-cfb5-4e3...</a
              >
              <p>
                Generally Intelligent is an AI research company working directly
                on building human-level general machine intelligence that can
                learn naturally in the way humans do. Our mission is to
                understand the fundamentals of learning and build safe, humane
                machine intelligence.
              </p>
              <p>
                We are looking for a stellar Chief of Staff who will work
                closely with our CEO, Kanjun Qiu, and CTO, Josh Albrecht, as we
                scale the company. Kanjun herself started her career as the
                Chief of Staff at Dropbox, scaling the company from 200 to 1300
                people.
              </p>
              <p>
                This is a high-trust role with enormous growth potential. Your
                job is to do whatever it takes to make Generally Intelligent
                successful. Your work will cut across strategic initiatives and
                tactical execution with both internal and external folks.
              </p>
              <p>
                You are • A fast learner • Gets stuff done • Can take on big
                projects and move them forward with little oversight • Deep
                belief that AI today is a historical moment, like the Industrial
                Revolution or early Internet • Strong writing skills • Enjoy
                talking to people / working through others • Interest in
                building an AI community around Generally Intelligent
              </p>
              <p>
                Some backgrounds that could be a fit • Experience as a founder •
                Experience in BizOps (business operations) at a startup •
                Experience in strategy consulting (e.g. McKinsey, BCG), in
                addition to at a startup • Experience as an engineer or product
                manager with a desire to move to the business side • Studied
                quantitative fields like math, computer science, physics, or
                computational biology
              </p>
            </div>
          </section>
        </section>
        <section id="36366002">
          <h3>
            <a
              class="item"
              href="https://lwn.net/SubscriberLink/934692/5046d466490d9220/"
              >Merging bcachefs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-17 @ 00:53:19</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36366002"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36365819">
          <h3>
            <a
              class="item"
              href="https://www.jasoncolavito.com/the-case-of-the-false-quotes.html"
              >Ancient astronaut theorists faked a Hindu nuclear explosion
              (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-17 @ 00:29:11</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36365819"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36365511">
          <h3>
            <a class="item" href="https://propbox.co"
              >Show HN: 77 Year old launches SaaS platform today. Seeks
              feedback</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-16 @ 23:45:25</span
              ><span class="points-container"
                >Points: <span class="points">219</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36365511"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
            <div class="text">
              Richard Montgomery (rm@propbox.co). I believe PropBox is the first
              advertising platform to facilitate a home seller and buyer to
              directly negotiate and close real estate transactions within the
              platform and zero commissions entirely online. Looking for
              feedback to continuously improve the product.
            </div>
          </section>
        </section>
        <section id="36365455">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/features/2023-06-15/how-huawei-got-caught-spying-and-lost-a-200-million-5g-contract"
              >A Huawei bid turned into a hunt for a corporate mole</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-16 @ 23:36:57</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36365455"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36364182">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36364182"
              >Ask HN: What do you put in a “in case of death” file?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-16 @ 21:30:27</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36364182"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
            <div class="text">
              <p></p>
              <pre><code>  - Will
  - Living trust
  - Power of attorney
  - Life insurance policy
  - Birth certificate
  - Marriage license
  - Bank and credit card accounts
  - Loan documents
  - Automobile titles
  - Property deeds
  - Copies of keys to automobiles, safe deposit boxes, etc.
  - Account and device passwords</code></pre>
            </div>
          </section>
        </section>
        <section id="36363110">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/us-news/2023/jun/16/louisiana-drivers-license-hack-cyber-attack"
              >Every Louisiana driver's license holder exposed in cyberattack</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-16 @ 20:09:46</span
              ><span class="points-container"
                >Points: <span class="points">154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36363110"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36362225">
          <h3>
            <a
              class="item"
              href="https://www.jetpack.io/blog/why-did-nix-adopt-flakes/"
              >Why did Nix adopt Flakes?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-16 @ 19:12:14</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36362225"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36362042">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/06/16/us/daniel-ellsberg-dead.html"
              >Daniel Ellsberg has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-16 @ 19:01:47</span
              ><span class="points-container"
                >Points: <span class="points">528</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36362042"
                  >Comments</a
                ><span class="descendants">: 203</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36361906">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/deep-learning-computational-cost"
              >Deep Learning’s Diminishing Returns (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-16 @ 18:54:44</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36361906"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36361510">
          <h3>
            <a
              class="item"
              href="https://www.techspot.com/news/99102-european-union-votes-bring-back-replaceable-phone-batteries.html"
              >European Union votes to bring back replaceable phone batteries</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-16 @ 18:32:06</span
              ><span class="points-container"
                >Points: <span class="points">487</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36361510"
                  >Comments</a
                ><span class="descendants">: 413</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36360980">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=10845832"
              >John Carmack on shorter work weeks (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-16 @ 18:02:31</span
              ><span class="points-container"
                >Points: <span class="points">191</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36360980"
                  >Comments</a
                ><span class="descendants">: 304</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36360789">
          <h3>
            <a class="item" href="https://novel.sh/"
              >Show HN: I made an open-source Notion-style WYSYWIG editor</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-16 @ 17:49:38</span
              ><span class="points-container"
                >Points: <span class="points">189</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36360789"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36360018">
          <h3>
            <a class="item" href="http://gyroflow.xyz/"
              >Gyroflow: An open source advanced gyro-based video stabilization
              tool</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-16 @ 17:01:36</span
              ><span class="points-container"
                >Points: <span class="points">213</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36360018"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36359925">
          <h3>
            <a class="item" href="https://github.com/sharkdp/hexyl"
              >Hexyl: A command-line hex viewer with colorized output</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-16 @ 16:56:21</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36359925"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36359798">
          <h3>
            <a
              class="item"
              href="https://www.bitsaboutmoney.com/archive/requiem-for-a-bank-loan/"
              >Requiem for a bank loan</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-16 @ 16:49:56</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36359798"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36359652">
          <h3>
            <a class="item" href="https://www.hackingwithswift.com/100/swiftui"
              >100 Days of SwiftUI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-16 @ 16:43:26</span
              ><span class="points-container"
                >Points: <span class="points">172</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36359652"
                  >Comments</a
                ><span class="descendants">: 89</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36359296">
          <h3>
            <a
              class="item"
              href="https://ilga.gov/legislation/fulltext.asp?DocName=&amp;SessionId=112&amp;GA=103&amp;DocTypeId=HB&amp;DocNum=3902&amp;GAID=17&amp;LegID=149171&amp;SpecSess=&amp;Session="
              >Illinois prohibits weapons, facial recognition on police
              drones</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-16 @ 16:24:20</span
              ><span class="points-container"
                >Points: <span class="points">410</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36359296"
                  >Comments</a
                ><span class="descendants">: 227</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36358754">
          <h3>
            <a
              class="item"
              href="http://www.jdawiseman.com/books/pricing-money/Pricing_Money_JDAWiseman.html"
              >Pricing Money: A beginner's guide to money, bonds, futures and
              swaps</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-16 @ 15:54:25</span
              ><span class="points-container"
                >Points: <span class="points">513</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36358754"
                  >Comments</a
                ><span class="descendants">: 162</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36358672">
          <h3>
            <a
              class="item"
              href="https://www.earth.com/news/breakthrough-surges-of-cosmic-radiation-from-space-directly-linked-to-earthquakes/"
              >Surges of cosmic radiation from space directly linked to
              earthquakes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-16 @ 15:49:34</span
              ><span class="points-container"
                >Points: <span class="points">315</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36358672"
                  >Comments</a
                ><span class="descendants">: 189</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36356876">
          <h3>
            <a class="item" href="https://www.marginalia.nu/log/83_full_time/"
              >Full Time</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-16 @ 14:13:03</span
              ><span class="points-container"
                >Points: <span class="points">793</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36356876"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36356288">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/future/article/20230613-onkalo-has-finland-found-the-answer-to-spent-nuclear-fuel-waste-by-burying-it"
              >Finland's plan to bury spent nuclear fuel for 100k years</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-16 @ 13:31:13</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36356288"
                  >Comments</a
                ><span class="descendants">: 158</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36353865">
          <h3>
            <a
              class="item"
              href="https://susam.net/blog/control-escape-meta-tricks.html"
              >Control, escape, and meta tricks</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-16 @ 09:37:26</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36353865"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36347229">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=XKC-4Tosdd8"
              >The long story of how neural nets got to where they are
              [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-15 @ 22:00:20</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36347229"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36339800">
          <h3>
            <a
              class="item"
              href="http://mis-misinformation.blogspot.com/2020/06/creating-positive-lab-culture.html"
              >Creating a positive lab culture (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-15 @ 12:58:00</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36339800"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36339322">
          <h3>
            <a
              class="item"
              href="https://scholarsarchive.byu.edu/cgi/viewcontent.cgi?article=1038&amp;context=joni"
              >Decentralization and Centralization in Sociocratic Organizations
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-15 @ 12:10:14</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36339322"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36334675">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/2023/06/26/remembering-robert-gottlieb-editor-extraordinaire"
              >Remembering Robert Gottlieb, editor extraordinaire</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-15 @ 00:06:07</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36334675"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
