<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37591242">
          <h3>
            <a
              class="item"
              href="https://kianpak.com/i-will-not-play-baldurs-gate-3/"
              >Baldurs Gate 3 comes out on Mac tomorrow. I will not play it</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 23:04:28</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37591242"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37590881">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2309.06565"
              >Meticulous: An FPGA-Based Main Memory Emulator for System
              Software Studies</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 22:14:37</span
              ><span class="points-container"
                >Points: <span class="points">3</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37590881"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37590544">
          <h3>
            <a
              class="item"
              href="https://www.adityabaradwaj.com/part-2-the-fat-finger/"
              >Alameda lost tens of millions because of a fat fingering
              mistake</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 21:35:40</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37590544"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37588526">
          <h3>
            <a class="item" href="https://harlequin.sh/"
              >Harlequin: DuckDB IDE for the terminal</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 19:02:43</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37588526"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37588374">
          <h3>
            <a
              class="item"
              href="https://frame.work/nl/en/blog/we-are-not-sustainable"
              >We Are Not Sustainable</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 18:52:42</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37588374"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37588286">
          <h3>
            <a
              class="item"
              href="https://github.com/Airsequel/Airsequel-Sheet-Music"
              >Show HN: Sheet Music Management App</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 18:47:36</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37588286"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37587791">
          <h3>
            <a
              class="item"
              href="https://news.liverpool.ac.uk/2023/09/20/archaeologists-discover-worlds-oldest-wooden-structure/"
              >Archaeologists discover oldest wooden structure</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 18:18:14</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37587791"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37587506">
          <h3>
            <a class="item" href="https://strada.hotwired.dev/"
              >Strada – Create fully native controls, driven by your web app</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 18:00:26</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37587506"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37587043">
          <h3>
            <a
              class="item"
              href="https://popey.com/blog/2023/09/monitor-bandwidth-usage-with-bandwhich/"
              >Monitor bandwidth usage with bandwhich (and build a snap package
              of it)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 17:29:20</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37587043"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37586681">
          <h3>
            <a class="item" href="https://manapool.com/"
              >Show HN: Mana Pool – Market for Magic Cards</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 17:01:14</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37586681"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
            <div class="text">
              <p>
                Like my last one, this project comes from one of my life's
                passions. I have played Magic: The Gathering for 30 years.
              </p>
              <p>
                My co-founders and I think Magic deserves its own market, and
                this thinking will lead to dozens of ways to make a great app.
                We consider what we have an MVP, and we are all going to
                MagicCon this weekend in Las Vegas to walk around in our Mana
                Pool shirts and talk to people about the future.
              </p>
              <p>
                If HN likes the site, I would appreciate you crashing it before
                we head out tomorrow night!
              </p>
              <p><a href="https://manapool.com/">https://manapool.com/</a></p>
            </div>
          </section>
        </section>
        <section id="37586580">
          <h3>
            <a
              class="item"
              href="https://changelog.com/posts/xml-better-than-yaml"
              >XML is better than YAML</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 16:52:18</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37586580"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37586518">
          <h3>
            <a class="item" href="https://github.com/goldsborough/clang-expand"
              >Clang-expand: Expand function invocations into current scope</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 16:48:01</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37586518"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37586264">
          <h3>
            <a
              class="item"
              href="https://www.tri.global/news/toyota-research-institute-unveils-breakthrough-teaching-robots-new-behaviors"
              >Toyota Research claims breakthrough in teaching robots new
              behaviors</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 16:30:14</span
              ><span class="points-container"
                >Points: <span class="points">172</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37586264"
                  >Comments</a
                ><span class="descendants">: 124</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37585869">
          <h3>
            <a class="item" href="https://www.booklet.group/"
              >Show HN: Booklet – Async forums as an alternative to chat</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 16:02:28</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37585869"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
            <div class="text">
              <p>
                Booklet updates classic internet forums and email groups to have
                a modern UI and high polish. It organizes communications into
                threads, and summarizes activities into a neat email newsletter
                - so members can stay updated without having to stay logged in.
                The async format promotes deeper discussions, while also
                increasing engagement by making conversations easy to follow.
              </p>
              <p>
                My goal is to make communications more asynchronous - so that I
                can get back to work, instead of slacking all day. Most early
                communities have been hobby groups, but my goal is to mature
                Booklet into a tool that sits alongside Slack in companies.
              </p>
              <p>Try it out, and let me know what you think!</p>
            </div>
          </section>
        </section>
        <section id="37584399">
          <h3>
            <a
              class="item"
              href="http://www.cs.cmu.edu/~wkw/humour/carproblems.txt"
              >Car allergic to vanilla ice cream (2000)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 14:14:12</span
              ><span class="points-container"
                >Points: <span class="points">1034</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37584399"
                  >Comments</a
                ><span class="descendants">: 345</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37584134">
          <h3>
            <a
              class="item"
              href="https://github.com/mig4ng/ublock-origin-filters"
              >My uBlock Origin filters to remove distractions</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 13:53:31</span
              ><span class="points-container"
                >Points: <span class="points">353</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37584134"
                  >Comments</a
                ><span class="descendants">: 147</span></span
              >
            </h4>
            <div class="text">
              <p>
                I am pretty ruthless removing distractions from my life (e.g. no
                Instagram, Facebook, TikTok), but some tools I'd like to keep
                using some parts of it. E.g. Twitter/X, I dislike the feed but I
                like reading some threads that are shared here or on blog posts.
                Same for YouTube, I enjoy some videos but I do not want
                recommendations when I finish the video I was watching.
              </p>
              <p>
                Feel free to suggest more, open issues, pull requests or send me
                an email :)
              </p>
            </div>
          </section>
        </section>
        <section id="37584049">
          <h3>
            <a class="item" href="https://electric-sql.com/"
              >Show HN: ElectricSQL, Postgres to SQLite active-active sync for
              local-first apps</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 13:46:55</span
              ><span class="points-container"
                >Points: <span class="points">426</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37584049"
                  >Comments</a
                ><span class="descendants">: 121</span></span
              >
            </h4>
            <div class="text">
              <p>
                We're really excited to be sharing ElectricSQL with you today.
                It's an open source, local-first sync layer that can be used to
                build reactive, realtime, offline-capable apps directly on
                Postgres with two way active-active sync to SQLite (including
                with WASM in the browser).
              </p>
              <p>
                Electric comprises a sync layer (built with Elixir) placed in
                front of your Postgres database and a type safe client that
                allows you to bidirectionally sync data from your Postgres to
                local SQLite databases. This sync is CRDT-based, resilient to
                conflicting edits from multiple nodes at the same time, and
                works after being offline for extended periods.
              </p>
              <p>Some good links to get started:</p>
              <p>
                - website:
                <a href="https://electric-sql.com">https://electric-sql.com</a>
              </p>
              <p>
                - docs:
                <a href="https://electric-sql.com/docs"
                  >https://electric-sql.com/docs</a
                >
              </p>
              <p>
                - code:
                <a href="https://github.com/electric-sql/electric"
                  >https://github.com/electric-sql/electric</a
                >
              </p>
              <p>
                - introducing post:
                <a
                  href="https://electric-sql.com/blog/2023/09/20/introducing-electricsql-v0.6"
                  >https://electric-sql.com/blog/2023/09/20/introducing-electri...</a
                >
              </p>
              <p>You can also see some demo applications:</p>
              <p>
                - Linear clone:
                <a href="https://linear-lite.electric-sql.com"
                  >https://linear-lite.electric-sql.com</a
                >
              </p>
              <p>
                - Realtime demo:
                <a href="https://electric-sql.com/docs/intro/multi-user"
                  >https://electric-sql.com/docs/intro/multi-user</a
                >
              </p>
              <p>
                - Conflict-free offline:
                <a href="https://electric-sql.com/docs/intro/offline"
                  >https://electric-sql.com/docs/intro/offline</a
                >
              </p>
              <p>
                The Electric team actually includes two of the inventors of
                CRDTs, Marc Shapiro and Nuno Preguiça, and a number of their
                collaborators who've pioneered a lot of tech underpinning
                local-first software. We are privileged to be building on their
                research and delighted to be surfacing so much work in a product
                you can now try out.
              </p>
            </div>
          </section>
        </section>
        <section id="37583593">
          <h3>
            <a class="item" href="https://jakobs.dev/solving-mnist-with-gzip/"
              >78% MNIST accuracy using GZIP in under 10 lines of code</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 13:00:35</span
              ><span class="points-container"
                >Points: <span class="points">272</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37583593"
                  >Comments</a
                ><span class="descendants">: 108</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37583234">
          <h3>
            <a class="item" href="https://xeiaso.net/blog/gokrazy"
              >Gokrazy is cool</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 12:14:43</span
              ><span class="points-container"
                >Points: <span class="points">198</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37583234"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37583219">
          <h3>
            <a class="item" href="https://github.com/kantord/SeaGOAT"
              >Show HN: SeaGOAT – local, “AI-based” grep for semantic code
              search</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 12:13:09</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37583219"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37583136">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2309.04827"
              >Neurons in Large Language Models: Dead, N-Gram, Positional</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 12:03:42</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37583136"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37583116">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/stellar-sleep/jobs/Ubd4rCS-senior-staff-software-engineer"
              >Stellar Sleep (YC S23) Is Hiring a Senior/ Staff SWE in San
              Francisco</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 12:00:53</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37580556">
          <h3>
            <a
              class="item"
              href="https://www.iaea.org/newscenter/news/how-to-control-insect-pests-using-radiation"
              >Insect pests and radiation: SIT, inherited sterility, biological
              control</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 05:06:38</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37580556"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37580498">
          <h3>
            <a
              class="item"
              href="https://dralun.wordpress.com/2023/02/17/the-health-risks-of-travel-in-early-modern-britain/"
              >Health risks of travel in early-modern Britain</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 04:53:20</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37580498"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37579337">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-09-leonardo-da-vinci-trees.html"
              >New study disproves Leonardo da Vinci's 'rule of trees'</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 01:23:52</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37579337"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37578948">
          <h3>
            <a
              class="item"
              href="https://denniscooperblog.com/the-unknowable-presents-secretly-encoded/"
              >The unknowable presents, secretly encoded</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 00:26:36</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37578948"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37578935">
          <h3>
            <a
              class="item"
              href="https://jhiblog.org/2023/09/06/marin-mersenne-on-the-consolation-of-sad-music/"
              >Marin Mersenne on the Consolation of Sad Music</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 00:24:10</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37578935"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37576079">
          <h3>
            <a
              class="item"
              href="https://stephen.fm/how-to-evaluate-a-product-roadmap/"
              >How-To Evaluate a Product Roadmap, for Engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 20:30:16</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37576079"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37562593">
          <h3>
            <a
              class="item"
              href="https://andydote.co.uk/2023/09/19/tracing-is-better/"
              >Tracing: Structured logging, but better</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-18 @ 21:52:28</span
              ><span class="points-container"
                >Points: <span class="points">190</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37562593"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37559499">
          <h3>
            <a class="item" href="https://hllmn.net/blog/2023-09-18_h1x-net/"
              >Exploring the Halo 1 System Link Protocol</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-18 @ 17:53:05</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37559499"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
