<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36246398">
          <h3>
            <a
              class="item"
              href="https://old.reddit.com/r/redditisfun/comments/144gmfq/rif_will_shut_down_on_june_30_2023_in_response_to/"
              >Reddit is Fun will shut down on June 30th in response to Reddit
              API changes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 18:26:02</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36246398"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36246309">
          <h3>
            <a
              class="item"
              href="https://frame.work/blog/framework-laptop-16-deep-dive---180w-power-adapter"
              >Framework Laptop 16 Deep Dive: 180W Power Adapter</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 18:19:53</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36246309"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36246274">
          <h3>
            <a
              class="item"
              href="https://www.cablelabs.com/news/docsis-4-0-certification-available"
              >Docsis 4.0 Certification Available</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 18:17:49</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36246274"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36246106">
          <h3>
            <a
              class="item"
              href="https://www.nationalgeographic.com/environment/article/seaweed-fastest-least-expensive-tool-climate-change"
              >Could seaweed be the 'fastest and least expensive' tool to fight
              climate change?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 18:06:55</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36246106"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36245786">
          <h3>
            <a
              class="item"
              href="https://engineering.desmos.com/articles/pratt-parser/"
              >Desmos uses Pratt Parsers (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 17:46:48</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36245786"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36245435">
          <h3>
            <a
              class="item"
              href="https://old.reddit.com/r/apolloapp/comments/144f6xm/apollo_will_close_down_on_june_30th_reddits/"
              >Apollo will close down on June 30th</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 17:22:27</span
              ><span class="points-container"
                >Points: <span class="points">1060</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36245435"
                  >Comments</a
                ><span class="descendants">: 448</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36245408">
          <h3>
            <a
              class="item"
              href="https://bikerglen.com/blog/fuel-gauge-ac-motor-pid-loop/"
              >Cracking Open and Controlling a 747 Fuel Gauge</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 17:21:17</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36245408"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36245102">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/aviator/jobs/svf18r9-senior-software-engineer-founding-team"
              >Aviator (YC S21) is hiring senior engineers who are passionate
              about DX</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 17:00:41</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36244886">
          <h3>
            <a class="item" href="https://www.tremor.so/changelog"
              >Show HN: Tremor 3.0 – The open-source library to build dashboards
              fast</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 16:48:00</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36244886"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
            <div class="text">
              <p>
                ◆ Global theming via tailwind.config.js ◆ An out-of-the-box dark
                mode ◆ A new Tremor CLI helping you set up projects faster
              </p>
            </div>
          </section>
        </section>
        <section id="36244399">
          <h3>
            <a class="item" href="https://49travel.vercel.app/"
              >Travel across Germany with the 49 Euro ticket</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 16:18:25</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36244399"
                  >Comments</a
                ><span class="descendants">: 163</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36244269">
          <h3>
            <a
              class="item"
              href="https://www.sciencedirect.com/science/article/abs/pii/S0304389421010888"
              >Presence of airborne microplastics in human lung tissue</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 16:10:49</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36244269"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36243955">
          <h3>
            <a
              class="item"
              href="https://9to5mac.com/2023/06/08/ios-17-link-tracking-protection/"
              >iOS 17 automatically removes tracking parameters from links you
              click on</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 15:51:29</span
              ><span class="points-container"
                >Points: <span class="points">388</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36243955"
                  >Comments</a
                ><span class="descendants">: 129</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36243951">
          <h3>
            <a
              class="item"
              href="https://www.kolide.com/blog/ai-browser-extensions-are-a-security-nightmare"
              >AI browser extensions are a security nightmare</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 15:51:22</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36243951"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36243926">
          <h3>
            <a class="item" href="https://databasediagram.com"
              >Show HN: Databasediagram.com – Private, Text to
              Entity-Relationship Diagram Tool</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 15:49:06</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36243926"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36243738">
          <h3>
            <a
              class="item"
              href="https://www.medien.ifi.lmu.de/pubdb/publications/pub/mai2017mum/mai2017mum.pdf"
              >The paper that came up with Apple Vision Pro's outward-facing
              display [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 15:39:47</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36243738"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36242914">
          <h3>
            <a
              class="item"
              href="https://twitter.com/goodside/status/1666598580319035392"
              >Weird GPT-4 behavior for the specific string “ davidjl”</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 14:56:22</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36242914"
                  >Comments</a
                ><span class="descendants">: 121</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36242125">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36242125"
              >Launch HN: Infield (YC W20) – Safer, faster dependency
              upgrades</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 14:07:49</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36242125"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
            <div class="text">
              <a href="https://infield.ai">https://infield.ai</a>). Infield
              makes it clear which open source dependencies you should upgrade
              next, and how to do so safely. We do this by using a LLM to read
              every changelog.
              <p>
                Here’s a short demo video:
                <a href="https://www.youtube.com/watch?v=diCGmtMUeRU"
                  >https://www.youtube.com/watch?v=diCGmtMUeRU</a
                >
              </p>
              <p>
                We’re launching today with support for Ruby packages. If you’ve
                ever run `bundle outdated` or upgraded a Rails app, Infield is
                for you. You can try it on your own project at
                <a href="https://app.infield.ai/hn">https://app.infield.ai/hn</a
                >. Upload your Gemfile and Gemfile.lock (no email/name/cc
                required) and we’ll show you Infield on your code.
              </p>
              <p>
                I (Steve) have been building open source software and commercial
                web apps for more than a decade. I spent the last year
                personally upgrading Rails apps by hand for companies in order
                to research this problem. I'm convinced that every company is
                re-inventing the wheel and doing by hand a bunch of toilsome
                work that can be done with software.
              </p>
              <p>
                As one example, I was working as a consultant upgrading an app
                to Rails 7. This company was using the attr_encrypted gem to
                encrypt information at the database level. Rails 7 brings
                built-in support for encryption in a way that's incompatible
                with this gem. Having hit this same problem at two other
                companies I already knew how to handle the migration; but if I
                hadn’t, they could have risked their most sensitive customer
                data (this is what you tend to encrypt). After that project I
                started building a personal database of "upgrade experiences"
                and before long felt sure we could make useful software.
              </p>
              <p>
                The time-consuming part of package upgrades is not coding—it’s
                mostly risk assessment, research, and project planning. If I’m
                on a maintenance rotation and have half a day to pay down some
                technical debt, which package upgrades should I look at? I might
                end up spending that time trying to upgrade something only to
                get blocked and give up. Worse, many breaking changes are subtle
                and won’t be caught by CI. I’ve brought down production only to
                find an issue was buried in a changelog I didn’t read!
              </p>
              <p>
                Infield scans all of your dependencies to prioritize upgrades
                based on effort (how much work is this? Is it risky?) and impact
                (will upgrading fix a security issue? will it get me onto a
                supported branch?). We can do this because we use GPT to read
                the changelog for every package you rely on. Changelogs are
                broken apart into discrete changes and classified according to
                the keepachangelog.com standard. Then a human expert reviews the
                output. We can spend more time researching each package than you
                because we’re going to re-use this work for every future
                customer doing the same upgrade.
              </p>
              <p>
                Sometimes you want to do a complex upgrade like Rails that might
                be blocked on other packages being upgraded first. For this case
                we run an optimization based on the PubGrub algorithm to solve
                for a suggested target version of all your dependencies that
                will be compatible with the next version of Rails. We group and
                order these blockers into an "Upgrade path" you can follow.
              </p>
              <p>
                Most of the existing work in this space is security monitoring
                software like Dependabot or Snyk. These tools are primarily sold
                to security teams to let you know about CVEs that affect your
                dependencies. They’re reactive, a way to let developers know
                when they need to upgrade something but not how to do it. Our
                goal with Infield is to make it so easy to keep dependencies up
                to date that you’re always on the latest versions.
              </p>
              <p>
                Infield is $60/mo/repo and we’re launching today with support
                for Ruby. Javascript and Python are probably next, but we’re
                very interested to hear which language you feel this pain in
                most acutely. Ruby is first since the consolidation around Rails
                allows us to really nail the experience for a focused set of
                packages.
              </p>
              <p>
                You can try Infield on your own codebase at
                <a href="https://app.infield.ai/hn">https://app.infield.ai/hn</a
                >. With the paid plan we’ll hook into your codebase to
                continuously scan your dependencies as you merge PRs. That works
                via a Github app, or you can use our CLI tool to send us just
                the files we need as part of your CI pipeline.
              </p>
              <p>
                Please give it a try and comments are welcome! We’d love to hear
                everything you hate (or love, or just think) about dependency
                management and how we can make it better!
              </p>
            </div>
          </section>
        </section>
        <section id="36241768">
          <h3>
            <a class="item" href="https://brr.fyi/posts/the-last-egg"
              >The Last Egg</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 13:43:54</span
              ><span class="points-container"
                >Points: <span class="points">229</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36241768"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36240325">
          <h3>
            <a
              class="item"
              href="https://www.the-scientist.com/news-opinion/nanoplastic-ingestion-causes-neurological-deficits-71152"
              >Nanoplastic Ingestion Causes Neurological Deficits</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 11:52:11</span
              ><span class="points-container"
                >Points: <span class="points">227</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36240325"
                  >Comments</a
                ><span class="descendants">: 240</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36239195">
          <h3>
            <a
              class="item"
              href="https://guix.gnu.org/blog/2023/from-development-environments-to-continuous-integrationthe-ultimate-guide-to-software-development-with-guix/"
              >The guide to software development with Guix</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 09:20:36</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36239195"
                  >Comments</a
                ><span class="descendants">: 105</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36239175">
          <h3>
            <a class="item" href="https://github.com/rxi/fe"
              >fe: A tiny, embeddable language implemented in ANSI C</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 09:17:43</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36239175"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36238342">
          <h3>
            <a
              class="item"
              href="https://vivaldi.com/blog/vivaldi-on-android-6-1/"
              >Vivaldi on Android bypasses restrictions to let users access Bing
              Chat</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 07:12:14</span
              ><span class="points-container"
                >Points: <span class="points">215</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36238342"
                  >Comments</a
                ><span class="descendants">: 127</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36238222">
          <h3>
            <a
              class="item"
              href="https://blogs.bl.uk/digitisedmanuscripts/2013/09/knight-v-snail.html"
              >Knight vs. Snail (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 06:56:04</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36238222"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36237979">
          <h3>
            <a
              class="item"
              href="https://www.figma.com/community/file/1248375255495415511/Apple-Design-Resources-–-iOS-17-and-iPadOS-17"
              >Official Apple Design Resources for Figma – iOS 17 and iPadOS
              17</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 06:22:12</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36237979"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36237731">
          <h3>
            <a class="item" href="http://www.bricklin.com/visicalc.htm"
              >The History of VisiCalc</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 05:48:58</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36237731"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36237332">
          <h3>
            <a
              class="item"
              href="https://blog.tomayac.com/2023/06/07/web-apps-on-macos-sonoma-14-beta/"
              >Web Apps on macOS Sonoma 14 Beta</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 04:47:27</span
              ><span class="points-container"
                >Points: <span class="points">166</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36237332"
                  >Comments</a
                ><span class="descendants">: 121</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36235232">
          <h3>
            <a
              class="item"
              href="https://www.laphamsquarterly.org/roundtable/oldest-maps-world"
              >The Oldest Maps in the World</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-07 @ 23:42:40</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36235232"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36229524">
          <h3>
            <a
              class="item"
              href="https://handbooks.clerky.com/startup-incorporation"
              >Startup Incorporation for Founders: A new handbook</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-07 @ 16:52:52</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36229524"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36225945">
          <h3>
            <a
              class="item"
              href="https://blog.fogus.me/2023/06/02/languages-zoo/"
              >Languages Zoo</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-07 @ 12:28:57</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36225945"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36223257">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/science/2023/06/the-real-culprit-behind-the-1871-vandalism-of-the-paleozoic-museum-in-central-park/"
              >The culprit behind the 1871 vandalism of the Paleozoic Museum</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-07 @ 05:36:37</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36223257"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
