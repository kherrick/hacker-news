<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42500475">
          <h3>
            <a
              class="item"
              href="https://events.ccc.de/congress/2024/infos/index.html"
              >38th Chaos Communication Congress</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-24 @ 08:15:49</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42500475"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42500209">
          <h3>
            <a
              class="item"
              href="https://www.nsa.gov/Press-Room/News-Highlights/Article/Article/3946210/new-exhibits-at-the-national-cryptologic-museum-unlock-your-curiosity/"
              >National Cryptologic Museum (NSA/CSS) New Temporary Exhibit on
              Project Stargate</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-24 @ 07:12:38</span
              ><span class="points-container"
                >Points: <span class="points">3</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42500209"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42499599">
          <h3>
            <a class="item" href="https://www.philipzucker.com/overload_bool/"
              >Symbolic Execution by Overloading __bool__</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-24 @ 03:48:11</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42499599"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42499567">
          <h3>
            <a
              class="item"
              href="https://mathstodon.xyz/@johncarlosbaez/113703444230936435"
              >The number pi has an evil twin</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-24 @ 03:41:22</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42499567"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42499332">
          <h3>
            <a class="item" href="https://sakana.ai/asal/"
              >Automating the Search for Artificial Life with Foundation
              Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-24 @ 02:47:47</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42499332"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42498982">
          <h3>
            <a
              class="item"
              href="https://www.rfleury.com/p/demystifying-debuggers-part-2-the"
              >Demystifying Debuggers, Part 2: The Anatomy of a Running
              Program</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-24 @ 01:33:31</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42498982"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42498648">
          <h3>
            <a
              class="item"
              href="https://www.digikey.com/en/maker/projects/a-step-by-step-guide-to-build-a-low-cost-drone-using-esp32/8afccd0690574bcebfa0d2ad6fd0a391"
              >Build a Low-Cost Drone Using ESP32</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-24 @ 00:20:39</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42498648"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42498634">
          <h3>
            <a
              class="item"
              href="https://blog.mlc.ai/2023/08/09/Making-AMD-GPUs-competitive-for-LLM-inference"
              >Making AMD GPUs competitive for LLM inference (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-24 @ 00:17:18</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42498634"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42498514">
          <h3>
            <a
              class="item"
              href="https://onlinelibrary.wiley.com/doi/10.1002/spe.3296"
              >Parsing millions of URLs per Second (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 23:48:08</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42498514"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42498462">
          <h3>
            <a
              class="item"
              href="https://seangeiger.substack.com/p/why-are-cancer-guidelines-stuck-in"
              >Why are cancer guidelines stuck in PDFs?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 23:36:37</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42498462"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42497173">
          <h3>
            <a class="item" href="https://github.com/isledecomp/isle"
              >Show HN: Complete decompilation of Lego Island</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 20:03:37</span
              ><span class="points-container"
                >Points: <span class="points">176</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42497173"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42497148">
          <h3>
            <a class="item" href="https://manx-docs.org/about.php"
              >Manx – a catalog of manuals for old computers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 19:59:57</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42497148"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42497093">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=JfZxOuc9Qwk"
              >What happened to the world's largest tube TV? [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 19:49:34</span
              ><span class="points-container"
                >Points: <span class="points">454</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42497093"
                  >Comments</a
                ><span class="descendants">: 218</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42496955">
          <h3>
            <a
              class="item"
              href="https://interconnected.org/home/2024/12/23/jailbreaking"
              >Narrative Jailbreaking for Fun and Profit</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 19:28:06</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42496955"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42496436">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42496436"
              >OneText (YC W23) Is Hiring a Founding Growth Marketer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 18:20:08</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
            <div class="text">
              <a
                href="https://www.ycombinator.com/companies/onetext/jobs/YtuWnpc-founding-growth-marketer-for-onetext-yc-fintech-marketing-co-with-3x-year-year-growth"
                >https://www.ycombinator.com/companies/onetext/jobs/YtuWnpc-f...</a
              >
              <p>
                Sitting at the intersection of marketing, AI and payments, we're
                changing the face of payments, one text at a time.
              </p>
              <p>
                We're hiring a founding growth marketer to help make shopping as
                effortless as paying with your hotel room number.
              </p>
              <p>
                Innovated, scrappy and relentless marketers are invited to
                apply.
              </p>
            </div>
          </section>
        </section>
        <section id="42495936">
          <h3>
            <a
              class="item"
              href="https://www.goodfire.ai/papers/mapping-latent-spaces-llama/"
              >Show HN: Llama 3.3 70B Sparse Autoencoders with API access</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 17:18:17</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42495936"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42495077">
          <h3>
            <a
              class="item"
              href="https://blog.fogus.me/2024/12/23/the-best-things-and-stuff-of-2024/"
              >Fogus: Things and Stuff of 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 15:30:35</span
              ><span class="points-container"
                >Points: <span class="points">237</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42495077"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42494997">
          <h3>
            <a class="item" href="https://keypub.sh/"
              >Show HN: Keypub.sh – OAuth for the terminal using SSH keys</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 15:19:08</span
              ><span class="points-container"
                >Points: <span class="points">170</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42494997"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
            <div class="text">
              <p>
                - No installation needed - works with existing SSH setup -
                Privacy-focused: users control what email info is shared -
                Simple email verification process - Free public service -
                Perfect for CLI app developers who don't want to build user
                verification
              </p>
              <p>Try it with: `$ ssh keypub.sh about`</p>
              <p>
                Source code:
                <a href="https://github.com/skariel/keypub"
                  >https://github.com/skariel/keypub</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="42494090">
          <h3>
            <a class="item" href="https://ploum.net/2024-12-23-julius-en.html"
              >My Colleague Julius</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 13:03:59</span
              ><span class="points-container"
                >Points: <span class="points">287</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42494090"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42494067">
          <h3>
            <a
              class="item"
              href="https://newsroom.lexmark.com/2024-12-23-Xerox-to-Acquire-Lexmark"
              >Xerox to acquire Lexmark</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 12:57:45</span
              ><span class="points-container"
                >Points: <span class="points">219</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42494067"
                  >Comments</a
                ><span class="descendants">: 195</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42493464">
          <h3>
            <a
              class="item"
              href="https://xenaproject.wordpress.com/2024/12/22/can-ai-do-maths-yet-thoughts-from-a-mathematician/"
              >Can AI do maths yet? Thoughts from a mathematician</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 10:50:30</span
              ><span class="points-container"
                >Points: <span class="points">309</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42493464"
                  >Comments</a
                ><span class="descendants">: 268</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42492508">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42492508"
              >Ask HN: Programmers who don't use autocomplete/LSP, how do you do
              it?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 07:23:28</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42492508"
                  >Comments</a
                ><span class="descendants">: 167</span></span
              >
            </h4>
            <div class="text">
              <p>
                So to the devs who don't use these tools, how do you do it? Do
                you just remember every type and field in a codebase? What does
                your flow look like?
              </p>
              <p>
                One example is that I cannot live without the language server
                go-to-definition feature. What do you do if you need to look up
                the definition/implementation of some function which is in some
                other file?
              </p>
            </div>
          </section>
        </section>
        <section id="42491979">
          <h3>
            <a
              class="item"
              href="https://agr.wa.gov/about-wsda/news-and-media-relations/news-releases?article=41658"
              >WSDA, USDA announce eradication of northern giant hornet from the
              United States</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 05:16:27</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42491979"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42486356">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/immersive/d41586-024-04050-5/index.html"
              >AI Decodes the Calls of the Wild</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-22 @ 14:01:06</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42486356"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42486248">
          <h3>
            <a
              class="item"
              href="https://nautil.us/the-sean-carrolls-explain-the-universe-1171296/"
              >The Sean Carrolls Explain the Universe</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-22 @ 13:43:53</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42486248"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42486100">
          <h3>
            <a class="item" href="https://npflared.thomas-cogez.fr/"
              >Show HN: Npflared serveless private NPM registry that you can
              host for free</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-22 @ 13:16:38</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42486100"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              Free and open source, npflared is a serveless private npm registry
              that you can self-host in order to distribute private packages for
              you and your team
            </div>
          </section>
        </section>
        <section id="42486020">
          <h3>
            <a
              class="item"
              href="https://www.economist.com/interactive/christmas-specials/2024/12/21/the-chart-of-everything"
              >A chart that shows everything that has ever existed</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-22 @ 12:53:05</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42486020"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42485797">
          <h3>
            <a
              class="item"
              href="https://classicalstudies.org/sites/default/files/documents/Gagarin.pdf"
              >Telling Stories in Athenian Law [pdf] (2002)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-22 @ 11:49:18</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42485797"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42485489">
          <h3>
            <a class="item" href="https://github.com/sarimabbas/authortrail"
              >Show HN: AuthorTrail – Browse files you've touched in a Git
              repo</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-22 @ 10:18:57</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42485489"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <p>
                AuthorTrail is a locally running web UI that you can point to
                any Git repo. It will then look for all the files you have ever
                touched. This can be useful for large repos with lots of
                activity, where you want to remind yourself how you did
                something in the past. For example, I am using it to remind
                myself how I wrote an obscure unit test, without needing to
                browse my older PRs.
              </p>
              <p>Feedback welcome!</p>
            </div>
          </section>
        </section>
        <section id="42479510">
          <h3>
            <a
              class="item"
              href="https://ryelang.org/cookbook/working-with/spreadsheets/"
              >Spreadsheets 1/3 – Rye Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-21 @ 13:23:24</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42479510"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
