<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42316091">
          <h3>
            <a
              class="item"
              href="https://linuxjournal.rubdos.be/ljarchive/LJ/298/12538.html"
              >Linux TCP So_reuseport: Usage and Implementation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-04 @ 10:13:40</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42316091"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42315946">
          <h3>
            <a
              class="item"
              href="https://tej.as/blog/how-to-grow-professional-relationships-tjs-model"
              >How to Grow Professional Relationships</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-04 @ 09:42:02</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42315946"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42315364">
          <h3>
            <a
              class="item"
              href="https://blocksandfiles.com/2024/12/02/pinecone-integrates-ai-inferencing-with-its-vector-database/"
              >Pinecone integrates AI inferencing with vector database</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-04 @ 07:52:14</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42315364"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42314700">
          <h3>
            <a class="item" href="https://www.openttd.org/"
              >OpenTTD is an open source simulation game based upon Transport
              Tycoon Deluxe</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-04 @ 05:29:25</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42314700"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42314547">
          <h3>
            <a class="item" href="https://walzr.com/IMG_0001/">IMG_0001</a>
          </h3>
          <section>
            <h4>
              <span>2024-12-04 @ 04:46:12</span
              ><span class="points-container"
                >Points: <span class="points">699</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42314547"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42314340">
          <h3>
            <a class="item" href="https://ppc.web.cern.ch/"
              >A particle physics course for high-school students</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-04 @ 03:49:37</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42314340"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42314212">
          <h3>
            <a class="item" href="https://github.com/athina-ai/rag-cookbooks"
              >Show HN: Open-Source Colab Notebooks to Implement Advanced RAG
              Techniques</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-04 @ 03:19:39</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42314212"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
            <div class="text">
              <p>
                Weâ€™ve seen developers spend a lot of time implementing advanced
                RAG techniques from scratch.
              </p>
              <p>
                While these techniques are essential for improving performance,
                their implementation requires a lot of effort and testing!
              </p>
              <p>
                To help with this process, our team (Athina AI) has released
                Open-Source Advanced RAG Cookbooks.
              </p>
              <p>
                This is a collection of ready-to-run Google Colab notebooks
                featuring the most commonly implemented techniques.
              </p>
              <p>
                Please show us some love by starring the repo if you find this
                useful!
              </p>
            </div>
          </section>
        </section>
        <section id="42314024">
          <h3>
            <a class="item" href="https://emacsconf.org/2024/"
              >EmacsConf 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-04 @ 02:42:07</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42314024"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42313507">
          <h3>
            <a
              class="item"
              href="https://blog.infected.systems/posts/2024-12-01-no-nat-november/"
              >No Nat November: My Month Without IPv4</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-04 @ 01:03:44</span
              ><span class="points-container"
                >Points: <span class="points">150</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42313507"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42312301">
          <h3>
            <a
              class="item"
              href="https://www.phoenixframework.org/blog/phoenix-liveview-1.0-released?release=1.0"
              >Phoenix LiveView 1.0.0 is here</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-03 @ 22:28:47</span
              ><span class="points-container"
                >Points: <span class="points">527</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42312301"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42312277">
          <h3>
            <a
              class="item"
              href="https://astral.sh/blog/python-build-standalone"
              >A new home for Python-build-standalone</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-03 @ 22:26:08</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42312277"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42312121">
          <h3>
            <a class="item" href="https://www.armaansahni.com/game/"
              >My son (9 yrs old) used plain JavaScript to make a game, and
              wants your feedback</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-03 @ 22:08:16</span
              ><span class="points-container"
                >Points: <span class="points">618</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42312121"
                  >Comments</a
                ><span class="descendants">: 290</span></span
              >
            </h4>
            <div class="text">
              <p>
                Recently, we had a breakthrough where he learned how to leverage
                Google Gemini as a learning tool (not to write code for him, but
                as a better search and as a coding teacher). This leveled him up
                big time and he decided to make his own game.
              </p>
              <p>
                Game link here:
                <a href="https://www.armaansahni.com/game/"
                  >https://www.armaansahni.com/game/</a
                >
              </p>
              <p>
                He's coded all the HTML, CSS &amp; JS by hand in VSCode. He's
                made the animated graphics on his own using a web based sprite
                editor called Piskel.
              </p>
              <p>
                For the game, I provided hints along the way and Gemini has
                helped him with syntax. View source to see the code. He's
                excited to share with the community.
              </p>
              <p>
                He also wrote a blog post about how he made this game:
                <a
                  href="https://www.armaansahni.com/how-i-coded-a-game-using-ai/"
                  >https://www.armaansahni.com/how-i-coded-a-game-using-ai/</a
                >
                (he independently figured out how to leverage Gemini effectively
                and writes about it here).
              </p>
              <p>
                Regarding the blog post - We had a discussion about who the
                target audience is (ie not 9 year olds!), what they would be
                interested in learning about and the general outline. He then
                dictated his words into the computer (which gets around spelling
                issues), and he went through multiple rounds of feedback from
                his parents (improving clarity, punctuation, etc). In other
                words, its his words &amp; thoughts but he had help along the
                way!
              </p>
              <p>
                NOTE: both parents are programmers, who provided valuable
                guidance through his coding journey.
              </p>
            </div>
          </section>
        </section>
        <section id="42311912">
          <h3>
            <a
              class="item"
              href="https://insideevs.com/news/742893/porsche-macan-electric-ev-recall-headlights/"
              >The Porsche Macan EV is being recalled because its headlights are
              too bright</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-03 @ 21:47:08</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42311912"
                  >Comments</a
                ><span class="descendants">: 186</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42311828">
          <h3>
            <a
              class="item"
              href="https://kevindavid.org/code/2024/03/20/chrome-os-flex-proxmox.html"
              >Creating a Proxmox or QEMU ChromeOS Flex VM</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-03 @ 21:38:46</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42311828"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42311069">
          <h3>
            <a class="item" href="https://egoless.engineering"
              >Egoless Engineering</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-03 @ 20:38:23</span
              ><span class="points-container"
                >Points: <span class="points">552</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42311069"
                  >Comments</a
                ><span class="descendants">: 208</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42311031">
          <h3>
            <a class="item" href="https://github.com/keyvank/30cc"
              >Show HN: My C compiler compiled itself</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-03 @ 20:35:24</span
              ><span class="points-container"
                >Points: <span class="points">180</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42311031"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
            <div class="text">
              One of the most challenging projects of my life :)
            </div>
          </section>
        </section>
        <section id="42310683">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/12/03/arts/stephen-king-maine-radio-stations.html"
              >Stephen King to shut down his 3 radio stations in Maine</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-03 @ 20:06:40</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42310683"
                  >Comments</a
                ><span class="descendants">: 144</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42309790">
          <h3>
            <a class="item" href="https://www.thetubecomputer.com/"
              >The Tube Computer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-03 @ 18:54:00</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42309790"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42309429">
          <h3>
            <a
              class="item"
              href="https://www.ftc.gov/news-events/news/press-releases/2024/12/ftc-takes-action-against-gravy-analytics-venntel-unlawfully-selling-location-data-tracking-consumers"
              >FTC takes action against Gravy Analytics, Venntel for selling
              location data</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-03 @ 18:25:40</span
              ><span class="points-container"
                >Points: <span class="points">173</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42309429"
                  >Comments</a
                ><span class="descendants">: 130</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42308590">
          <h3>
            <a
              class="item"
              href="https://www.phoronix.com/review/intel-arc-b580-battlemage#google_vignette"
              >Intel announces Arc B-series "Battlemage" discrete graphics with
              Linux support</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-03 @ 17:19:37</span
              ><span class="points-container"
                >Points: <span class="points">424</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42308590"
                  >Comments</a
                ><span class="descendants">: 624</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42308051">
          <h3>
            <a class="item" href="https://skia-canvas.org/"
              >Skia Canvas: Browserless implementation of the HTML Canvas
              drawing API for node</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-03 @ 16:34:18</span
              ><span class="points-container"
                >Points: <span class="points">244</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42308051"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42305831">
          <h3>
            <a
              class="item"
              href="https://krebsonsecurity.com/2024/12/why-phishers-love-new-tlds-like-shop-top-and-xyz/"
              >Phishers Love New TLDs Like .shop, .top and .xyz</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-03 @ 13:30:40</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42305831"
                  >Comments</a
                ><span class="descendants">: 166</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42305348">
          <h3>
            <a
              class="item"
              href="https://blog.erodriguez.de/dependency-management-fatigue-or-why-i-forever-ditched-react-for-go-htmx-templ/"
              >Dependency management fatigue, or why I ditched React for
              Go+HTMX+Templ</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-03 @ 12:16:33</span
              ><span class="points-container"
                >Points: <span class="points">241</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42305348"
                  >Comments</a
                ><span class="descendants">: 228</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42280323">
          <h3>
            <a
              class="item"
              href="https://mariakonnikova.substack.com/p/gratitude-despite-the-odds"
              >Gratitude despite the odds</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-30 @ 08:16:24</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42280323"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42278003">
          <h3>
            <a
              class="item"
              href="https://gendignoux.com/blog/2024/11/18/rust-rayon-optimized.html"
              >Making a parallel Rust workload 10x faster with (or without)
              Rayon</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-29 @ 23:22:16</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42278003"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42275609">
          <h3>
            <a
              class="item"
              href="https://lucvandonkersgoed.com/2024/11/16/making-aws-news-stupid-fast-with-smart-caching/"
              >Making AWS News stupid fast with smart caching</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-29 @ 17:52:48</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42275609"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42275036">
          <h3>
            <a
              class="item"
              href="https://ryanbrewer.dev/posts/getting-started-category-theory.html"
              >Getting Started with Category Theory</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-29 @ 16:44:02</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42275036"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42274266">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2411.18464"
              >Approximating Mathematical Constants Using Minecraft</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-29 @ 14:53:59</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42274266"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42272524">
          <h3>
            <a class="item" href="https://github.com/glojurelang/glojure"
              >Glojure: Clojure interpreter hosted on Go, with extensible
              interop support</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-29 @ 09:29:56</span
              ><span class="points-container"
                >Points: <span class="points">163</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42272524"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42253868">
          <h3>
            <a
              class="item"
              href="https://underjord.io/voice-activity-detection-elixir-membrane.html"
              >Voice Activity Detection in Elixir with Membran</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-27 @ 07:37:11</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42253868"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
