<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44157378">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2411.00782"
              >TradExpert: Revolutionizing Trading with Mixture of Expert
              LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-02 @ 10:25:51</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44157378"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44157365">
          <h3>
            <a
              class="item"
              href="https://www.newsweek.com/computer-science-popular-college-major-has-one-highest-unemployment-rates-2076514"
              >Computer science has one of the highest unemployment rates</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-02 @ 10:23:08</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44157365"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44157177">
          <h3>
            <a class="item" href="https://github.com/kanbn/kan"
              >Kan.bn – An open-source alterative to Trello</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-02 @ 09:47:48</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44157177"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44157086">
          <h3>
            <a class="item" href="https://github.com/artnitolog/awesome-arxiv"
              >Awesome-ArXiv: curated tools for discovering and working with
              ArXiv papers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-02 @ 09:29:02</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44157086"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44157077">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2505.24760"
              >ReasoningGym: Reasoning Environments for RL with Verifiable
              Rewards</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-02 @ 09:27:26</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44157077"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44156935">
          <h3>
            <a
              class="item"
              href="https://betterthanrandom.substack.com/p/if-you-are-useful-it-doesnt-mean"
              >If you are useful, it doesn't mean you are valued</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-02 @ 08:59:37</span
              ><span class="points-container"
                >Points: <span class="points">165</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44156935"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44156467">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=44156467"
              >Show HN: System Prompt Learning – LLMs Learn Problem-Solving from
              Experience</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-02 @ 07:29:02</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44156467"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
            <div class="text">
              <p>
                The basic idea: instead of using static system prompts, the LLM
                builds up a database of strategies that actually work for
                different problem types. When you give it a new problem, it
                selects the most relevant strategies, applies them, then
                evaluates how well they worked and refines them.
              </p>
              <p>
                For example, after seeing enough word problems, it learned this
                strategy:
              </p>
              <p>1) Read carefully and identify unknowns,</p>
              <p>2) Define variables with units,</p>
              <p>3) Write equations,</p>
              <p>4) Solve step-by-step,</p>
              <p>5) Verify the answer.</p>
              <p>
                All strategies are stored as human-readable JSON that you can
                inspect and edit.
              </p>
              <p>
                I tested it on math benchmarks and saw decent improvements -
                8.6% better on Arena Hard, 6.67% on AIME24. After 500 queries,
                the system had created 129 strategies and refined 97 of them.
              </p>
              <p>
                The implementation is an open-source plugin for optillm (our
                inference optimization proxy). It works with any
                OpenAI-compatible API - you just add "spl-" to your model name.
                Has two modes: inference-only (uses existing strategies) and
                learning mode (creates and refines strategies).
              </p>
              <p>
                What's interesting is that it bridges the gap between the
                sophisticated system prompts that production AI uses and the
                basic prompts most of us work with. Your model literally gets
                better at the types of problems you throw at it.
              </p>
              <p>
                Built it because I noticed ChatGPT, Claude etc. have incredibly
                detailed system prompts with problem-solving frameworks, but
                most developers use basic prompts and miss out on those
                performance gains. The approach is inspired by Andrej Karpathy's
                tweet about a "third paradigm" for LLM learning beyond just
                pretraining and fine-tuning:
                <a href="https://x.com/karpathy/status/1921368644069765486"
                  >https://x.com/karpathy/status/1921368644069765486</a
                >
              </p>
              <p>
                The strategies are completely transparent - you can see exactly
                what the system learned and why it's making certain decisions.
                No black box learning.
              </p>
              <p>
                <a
                  href="https://github.com/codelion/optillm/tree/main/optillm/plugins/spl"
                  >https://github.com/codelion/optillm/tree/main/optillm/plugin...</a
                >
              </p>
              <p>
                Would love feedback on the approach. Has anyone else
                experimented with LLMs learning from their own experience?
              </p>
            </div>
          </section>
        </section>
        <section id="44156239">
          <h3>
            <a class="item" href="https://tmuxai.dev/tmux-cheat-sheet/"
              >Show HN: Yet another tmux cheat sheet</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-02 @ 06:30:30</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44156239"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44156092">
          <h3>
            <a
              class="item"
              href="https://blog.jim-nielsen.com/2025/is-it-javascript/"
              >Is It JavaScript?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-02 @ 05:45:25</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44156092"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44155746">
          <h3>
            <a
              class="item"
              href="https://www.jeetmehta.com/posts/thrive-in-obscurity"
              >How to post when no one is reading</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-02 @ 04:01:00</span
              ><span class="points-container"
                >Points: <span class="points">218</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44155746"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44155635">
          <h3>
            <a class="item" href="https://github.com/howerj/lfsr-vhdl"
              >LFSR CPU Running Forth</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-02 @ 03:35:07</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44155635"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44155391">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/how-can-ai-researchers-save-energy-by-going-backward-20250530/"
              >How can AI researchers save energy? By going backward</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-02 @ 02:29:45</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44155391"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44155247">
          <h3>
            <a
              class="item"
              href="https://esoteric.codes/blog/published-for-the-first-time-the-original-intercal72-compiler-code"
              >The Princeton INTERCAL Compiler's source code</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-02 @ 01:54:33</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44155247"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44155069">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2505.22610"
              >TPDE: A Fast Adaptable Compiler Back-End Framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-02 @ 01:17:54</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44155069"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44154511">
          <h3>
            <a class="item" href="https://github.com/oliverkwebb/moonphase"
              >Show HN: Moon Phase Algorithms for C, Lua, Awk, JavaScript,
              etc.</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-01 @ 23:22:32</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44154511"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44154032">
          <h3>
            <a
              class="item"
              href="https://animationobsessive.substack.com/p/the-visual-world-of-samurai-jack"
              >The Visual World of 'Samurai Jack'</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-01 @ 21:57:35</span
              ><span class="points-container"
                >Points: <span class="points">369</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44154032"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44153738">
          <h3><a class="item" href="https://librivox.org/">LibriVox</a></h3>
          <section>
            <h4>
              <span>2025-06-01 @ 21:02:58</span
              ><span class="points-container"
                >Points: <span class="points">175</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44153738"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44153732">
          <h3>
            <a
              class="item"
              href="https://notsocommonthoughts.com/blog/ai-and-judgement/"
              >The Rise of Judgement over Technical Skill</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-01 @ 21:02:17</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44153732"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44150803">
          <h3>
            <a class="item" href="https://stefan-gloor.ch/yomani-hack"
              >Root shell on a credit card terminal</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-01 @ 13:42:49</span
              ><span class="points-container"
                >Points: <span class="points">726</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44150803"
                  >Comments</a
                ><span class="descendants">: 204</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44149718">
          <h3>
            <a
              class="item"
              href="https://www.pushing-pixels.org/2025/05/20/cinematography-of-andor-interview-with-christophe-nuyens.html"
              >Cinematography of “Andor”</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-01 @ 09:44:04</span
              ><span class="points-container"
                >Points: <span class="points">389</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44149718"
                  >Comments</a
                ><span class="descendants">: 353</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44147945">
          <h3>
            <a class="item" href="https://overreacted.io/progressive-json/"
              >Progressive JSON</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-01 @ 00:58:00</span
              ><span class="points-container"
                >Points: <span class="points">525</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44147945"
                  >Comments</a
                ><span class="descendants">: 209</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44142955">
          <h3>
            <a
              class="item"
              href="https://utcc.utoronto.ca/~cks/space/blog/unix/POSIXAllowsZeroInode"
              >In POSIX, you can theoretically use inode zero</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-31 @ 08:57:12</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44142955"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44142650">
          <h3>
            <a class="item" href="https://github.com/ROCm/hip"
              >Hip: C++ Heterogeneous-Compute Interface for Portability</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-31 @ 07:37:21</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44142650"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44142359">
          <h3>
            <a
              class="item"
              href="https://nibblestew.blogspot.com/2025/05/writing-your-own-c-standard-library.html"
              >Writing your own C++ standard library part 2</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-31 @ 06:46:41</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44142359"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44142259">
          <h3>
            <a
              class="item"
              href="https://milofultz.com/2025-05-27-i-made-a-chair.html"
              >I made a chair</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-31 @ 06:24:01</span
              ><span class="points-container"
                >Points: <span class="points">176</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44142259"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44131324">
          <h3>
            <a
              class="item"
              href="https://www.galois.com/articles/what-works-and-doesnt-selling-formal-methods"
              >What works (and doesn't) selling formal methods</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 23:21:48</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44131324"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44131194">
          <h3>
            <a class="item" href="https://coincidence.games/zach-attack/"
              >The Zach Attack Scratch 'N Solve Puzzle Pack</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 22:58:08</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44131194"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44129480">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/global/2019/apr/21/why-did-the-chicken-cross-the-globe-french-sailor-guirec-soudee-monique"
              >A man who sailed round the world with a chicken (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 19:38:09</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44129480"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44125793">
          <h3>
            <a class="item" href="https://www.heidisql.com/forum.php?t=44068"
              >HeidiSQL Available Also for Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 13:16:00</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44125793"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44125334">
          <h3>
            <a class="item" href="https://easytier.cn/en/"
              >EasyTier – P2P mesh VPN written in Rust using Tokio</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 12:25:19</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44125334"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
