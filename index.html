<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44773690">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=NxiKlnUtyio"
              >Parsing Without ASTs and Optimizing with Sea of Nodes [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-03 @ 02:52:09</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44773690"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44772997">
          <h3>
            <a class="item" href="https://github.com/schuyler4/voltpeek"
              >Show HN: Voltpeek – Vim-inspired oscilloscope software</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-03 @ 00:29:22</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44772997"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              This is software for my headless, PC based oscilloscope, which is
              controlled entirely via commands similar to the Vim text editor. I
              built this because I liked the idea of headless oscilloscopes; I
              always have my laptop around when I’m working on electronics
              anyway, and it’s very convenient to save images of captured
              waveforms. However, I found the software for off the shelf models
              to be annoying and cumbersome to work with. In my experience, this
              holds true both when opening the software and connecting to an
              attached oscilloscope, and when adjusting the scope settings using
              menus and buttons. I have also built my own oscilloscope hardware
              for use with Voltpeek. The specs are nothing to write home about
              (7.5MHz BW, 62.5MS/s), but they should be adequate for some basic
              debugging and measurement tasks.
            </div>
          </section>
        </section>
        <section id="44772917">
          <h3>
            <a
              class="item"
              href="https://www.reachablecode.com/2025/07/31/c26-reflections-adventures-compile-time-uml/"
              >C++26 Reflections adventures and compile-time UML</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-03 @ 00:12:15</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44772917"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44772249">
          <h3>
            <a
              class="item"
              href="https://mitchhorowitz.substack.com/p/the-crisis-of-professional-skepticism"
              >The Crisis of Professional Skepticism</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-02 @ 22:37:01</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44772249"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44772177">
          <h3>
            <a class="item" href="https://github.com/WICG/html-in-canvas"
              >HTML-in-Canvas</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-02 @ 22:26:47</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44772177"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44771808">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2025/08/02/lina-khan-points-to-figma-ipo-as-vindication-for-ma-scrutiny/"
              >Lina Khan points to Figma IPO as vindication of M&amp;amp;A
              scrutiny</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-02 @ 21:39:42</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44771808"
                  >Comments</a
                ><span class="descendants">: 120</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44769231">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/great-question/jobs/ONBQUqe-vp-of-engineering"
              >Great Question (YC W21) Is Hiring a VP of Engineering (Remote)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-02 @ 17:00:36</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44769039">
          <h3>
            <a class="item" href="https://www.telotrucks.com/">Telo MT1</a>
          </h3>
          <section>
            <h4>
              <span>2025-08-02 @ 16:40:51</span
              ><span class="points-container"
                >Points: <span class="points">466</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44769039"
                  >Comments</a
                ><span class="descendants">: 433</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44768714">
          <h3>
            <a class="item" href="https://github.com/andrewarrow/starchive"
              >Browser extension and local backend that automatically archives
              YouTube videos</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-02 @ 16:03:31</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44768714"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44768513">
          <h3>
            <a
              class="item"
              href="https://news.cornell.edu/stories/2025/07/hiding-secret-codes-light-protects-against-fake-videos"
              >Hiding secret codes in light protects against fake videos</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-02 @ 15:40:27</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44768513"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44767959">
          <h3>
            <a
              class="item"
              href="https://jpcamara.com/2025/08/02/the-o-in-ruby-regex.html"
              >The /o in Ruby regex stands for "oh the humanity "</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-02 @ 14:37:51</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44767959"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44767775">
          <h3>
            <a class="item" href="https://andreinwald.github.io/browser-llm/"
              >Show HN: WebGPU enables local LLM in the browser – demo site with
              AI chat</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-02 @ 14:09:12</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44767775"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
            <div class="text">
              <p>
                Demo, similar to ChatGPT
                <a href="https://andreinwald.github.io/browser-llm/"
                  >https://andreinwald.github.io/browser-llm/</a
                >
              </p>
              <p>
                Code
                <a href="https://github.com/andreinwald/browser-llm"
                  >https://github.com/andreinwald/browser-llm</a
                >
              </p>
              <p>
                - No need to use your OPENAI_API_KEY - its local model that runs
                on your device
              </p>
              <p>- No network requests to any API</p>
              <p>- No need to install any program</p>
              <p>
                - No need to download files on your device (model is cached in
                browser)
              </p>
              <p>
                - Site will ask before downloading large files (llm model) to
                browser cache
              </p>
              <p>
                - Hosted on Github Pages from this repo - secure, because you
                see what you are running
              </p>
            </div>
          </section>
        </section>
        <section id="44767555">
          <h3>
            <a
              class="item"
              href="https://eatonphil.com/2025-art-of-multiprocessor-programming.html"
              >The Art of Multiprocessor Programming 2nd Edition Book Club</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-02 @ 13:43:10</span
              ><span class="points-container"
                >Points: <span class="points">240</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44767555"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44767433">
          <h3>
            <a class="item" href="https://forums.anandtech.com/"
              >Anandtech.com now redirects to its forums</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-02 @ 13:27:25</span
              ><span class="points-container"
                >Points: <span class="points">176</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44767433"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44767304">
          <h3>
            <a class="item" href="https://github.com/hugoj0s3/NaturalCron"
              >Show HN: NaturalCron – Human-Readable Scheduling for .NET (With
              Fluent Builder)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-02 @ 13:09:06</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44767304"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
            <div class="text">
              <p>
                I built NaturalCron because I was tired of writing and debugging
                CRON syntax like:
              </p>
              <p><i>/5 </i> * * 5</p>
              <p>Now you can write something human-readable in .NET:</p>
              <p>
                var expression = new NaturalCronExpression("every 5 minutes on
                friday");
              </p>
              <p>Or use a Fluent Builder for strong typing and IDE support:</p>
              <p>
                var expression = NaturalCronExpressionBuilder
                .Every().Minutes(5) .On(DayOfWeek.Friday) .Build();
              </p>
              <p>
                Great for: - Code-based scheduling in .NET apps - Overriding
                schedules from configs or databases - Displaying easy-to-read
                rules in UIs
              </p>
              <p>
                NuGet:
                <a href="https://www.nuget.org/packages/NaturalCron"
                  >https://www.nuget.org/packages/NaturalCron</a
                >
                GitHub:
                <a href="https://github.com/hugoj0s3/NaturalCron"
                  >https://github.com/hugoj0s3/NaturalCron</a
                >
              </p>
              <p>
                Would love your feedback on syntax, builder design, and what
                features you'd like to see next!
              </p>
            </div>
          </section>
        </section>
        <section id="44766962">
          <h3>
            <a
              class="item"
              href="https://www.apmreports.org/episode/2019/08/22/whats-wrong-how-schools-teach-reading"
              >At a Loss for Words: A flawed idea is teaching kids to be poor
              readers (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-02 @ 12:12:27</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44766962"
                  >Comments</a
                ><span class="descendants">: 108</span></span
              >
            </h4>
            <div class="text">
              <a href="https://features.apmreports.org/sold-a-story/"
                >https://features.apmreports.org/sold-a-story/</a
              >
            </div>
          </section>
        </section>
        <section id="44766758">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2025/07/31/technology/ai-researchers-nba-stars.html"
              >A.I. researchers are negotiating $250M pay packages</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-02 @ 11:34:39</span
              ><span class="points-container"
                >Points: <span class="points">205</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44766758"
                  >Comments</a
                ><span class="descendants">: 355</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44766718">
          <h3>
            <a
              class="item"
              href="https://alexharri.com/blog/icelandic-name-declension-trie"
              >Compressing Icelandic name declension patterns into a 3.27 kB
              trie</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-02 @ 11:28:33</span
              ><span class="points-container"
                >Points: <span class="points">203</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44766718"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44766508">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/2025/07/21/ai-is-about-to-solve-loneliness-thats-a-problem"
              >We may not like what we become if A.I. solves loneliness</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-02 @ 10:52:36</span
              ><span class="points-container"
                >Points: <span class="points">375</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44766508"
                  >Comments</a
                ><span class="descendants">: 758</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44749387">
          <h3>
            <a
              class="item"
              href="https://danieltan.weblog.lol/2025/07/the-big-oops-in-type-systems-this-problem-extends-to-fp-as-well"
              >The Big Oops in type systems: This problem extends to FP as
              well</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 19:49:35</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44749387"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44746621">
          <h3>
            <a
              class="item"
              href="https://blog.puzzmo.com/posts/2025/07/30/six-weeks-of-claude-code/"
              >6 weeks of Claude Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 15:25:49</span
              ><span class="points-container"
                >Points: <span class="points">316</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44746621"
                  >Comments</a
                ><span class="descendants">: 328</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44746583">
          <h3>
            <a
              class="item"
              href="https://pixieditor.net/blog/2025/07/30/20-release/"
              >PixiEditor 2.0 – A FOSS universal 2D graphics editor</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 15:21:31</span
              ><span class="points-container"
                >Points: <span class="points">185</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44746583"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44745727">
          <h3>
            <a class="item" href="https://github.com/ImperialCollegeLondon/FLT"
              >Ongoing Lean formalisation of the proof of Fermat's Last
              Theorem</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 13:59:41</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44745727"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
            <div class="text">
              <a
                href="https://github.com/ImperialCollegeLondon/FLT/blob/main/GENERAL.md"
                >https://github.com/ImperialCollegeLondon/FLT/blob/main/GENER...</a
              >
            </div>
          </section>
        </section>
        <section id="44742373">
          <h3>
            <a class="item" href="https://github.com/Topping1/L1BSR-GUI"
              >Super-resolution of Sentinel-2 images (10M –&amp;gt; 5M)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 04:43:26</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44742373"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44741078">
          <h3>
            <a class="item" href="https://www.sierra-remote.com/"
              >Remote hosting for your telescope</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-31 @ 00:23:34</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44741078"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44739998">
          <h3>
            <a
              class="item"
              href="https://www.tahabouhsine.com/nmn/assets/deep_learning_two_point_o_point_one.pdf"
              >Neural networks that learn non-linearity without activation
              functions [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-30 @ 21:59:23</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44739998"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44736025">
          <h3>
            <a
              class="item"
              href="https://www.helsinkitimes.fi/finland/finland-news/domestic/27539-helsinki-records-zero-traffic-deaths-for-full-year.html"
              >Helsinki records zero traffic deaths for full year</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-30 @ 16:08:02</span
              ><span class="points-container"
                >Points: <span class="points">544</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44736025"
                  >Comments</a
                ><span class="descendants">: 298</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44735059">
          <h3>
            <a class="item" href="https://github.com/google/langextract"
              >LangExtract: Python library for extracting structured data from
              language models</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-30 @ 14:56:46</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44735059"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44734450">
          <h3>
            <a class="item" href="https://github.com/froggey/Mezzano"
              >Mezzano, an operating system written in Common Lisp</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-30 @ 14:09:40</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44734450"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44730544">
          <h3>
            <a class="item" href="https://keygenmusic.tk"
              >Online Collection of Keygen Music</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-30 @ 02:53:10</span
              ><span class="points-container"
                >Points: <span class="points">229</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44730544"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
