<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40380639">
          <h3>
            <a
              class="item"
              href="https://aftermath.site/google-ai-search-god-no-why"
              >I Don't Want to Spend My One Precious Life Dealing with Google's
              AI Search</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 17:02:40</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40380639"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40380596">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/reflex/jobs/6kHXK7x-software-engineer"
              >Reflex (YC W23) Is Hiring Software Engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 17:00:11</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40380499">
          <h3>
            <a
              class="item"
              href="https://theprogressplaybook.com/2024/04/17/in-numbers-americas-dramatic-shift-from-gas-power-plants-to-batteries/"
              >America's dramatic shift from gas power plants to batteries</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 16:51:37</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40380499"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40380158">
          <h3>
            <a
              class="item"
              href="https://future.mozilla.org/news/llamafiles-for-embeddings-in-local-rag-applications/"
              >Using Llamafiles for Embeddings in Local RAG Applications</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 16:20:03</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40380158"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40379996">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Mummy_brown"
              >Mummy Brown</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 16:05:48</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40379996"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40379982">
          <h3>
            <a
              class="item"
              href="https://blog.playcanvas.com/build-webgpu-apps-today-with-playcanvas/"
              >Build WebGPU Apps Today with PlayCanvas</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 16:04:47</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40379982"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40379599">
          <h3>
            <a class="item" href="https://www.sabrina.dev/p/chatgpt4o-vs-math"
              >ChatGPT-4o vs. Math</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 15:30:49</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40379599"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40379488">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s43247-024-01379-7"
              >Egypt's pyramids may have been built on a long-lost branch of the
              Nile</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 15:20:45</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40379488"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40379480">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2024/5/15/24156519/intel-thunderbolt-share-app"
              >Intel's Thunderbolt Share lets two PCs control each other over a
              USB cable</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 15:19:53</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40379480"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40379325">
          <h3>
            <a
              class="item"
              href="https://mynews4.com/news/local/nevada-parents-accused-of-abuse-file-civil-lawsuit-against-texas-hospital-take-care-of-maya-trending-netflix-documentary-wrongfully-accused-shaken-baby-syndrome"
              >Nevada parents wrongfully accused of child abuse file lawsuit
              against hospital</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 15:07:37</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40379325"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40379028">
          <h3>
            <a
              class="item"
              href="https://www.techdirt.com/2024/05/16/report-sprint-t-mobile-merger-immediately-killed-wireless-price-competition-in-u-s/"
              >Sprint, T-Mobile Merger Killed Wireless Price Competition in
              U.S.</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 14:38:40</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40379028"
                  >Comments</a
                ><span class="descendants">: 111</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40378983">
          <h3>
            <a
              class="item"
              href="https://easel.hackclub.com/orpheus-finds-easel"
              >Show HN: I'm 17 and wrote a guide on how to build your own
              programming language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 14:34:24</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40378983"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
            <div class="text">
              <p>
                A while ago, I asked myself the question, “How exactly do
                programming languages work behind the scenes?” It seemed really
                daunting until I went to a half hour workshop at a high school
                hackathon about writing a tree-walk interpreter and realized
                that getting started was actually super fun.
              </p>
              <p>
                This guide is designed in the vein of that - to get people,
                especially teenagers, started on learning how to build a
                programming language in a literal weekend by actually shipping
                one. It’s a stepping stone for learning the big things -
                compilers, optimizations for performance, etc. It’s very
                inspired by Crafting Interpreters and why’s poignant guide, but
                meant to be approachable in a weekend.
              </p>
              <p>
                Some backstory on me: A year ago I finished high school early
                and joined Hack Club full-time to build projects like this. I’ve
                been programming since COVID, and learned how to code primarily
                by shipping things that seemed daunting to me and taking
                inspiration from people taking the time to break down various
                topics online.
              </p>
              <p>
                Give it a try and take it out for a spin! Constructive feedback
                is also really appreciated.
              </p>
              <p>
                It’s open source on GitHub at
                <a href="https://github.com/hackclub/easel"
                  >https://github.com/hackclub/easel</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="40378904">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-024-00644-1"
              >The spy who flunked it: Kurt Gödel's forgotten part in the
              atom-bomb story</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 14:27:52</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40378904"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40378791">
          <h3>
            <a class="item" href="https://www.d3indepth.com/">D3 in Depth</a>
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 14:18:07</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40378791"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40378499">
          <h3>
            <a class="item" href="https://github.com/likejazz/llama3.np"
              >Llama3.np: pure NumPy implementation of Llama3</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 13:53:22</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40378499"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40378127">
          <h3>
            <a
              class="item"
              href="https://www.openstreetmap.org/user/StephaneP/diary/390290"
              >You thought OpenStreetMap uses WGS84? No it doesn't (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 13:24:02</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40378127"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40377685">
          <h3>
            <a class="item" href="https://www.fstar-lang.org/"
              >F* – A Proof-Oriented Programming Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 12:47:07</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40377685"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40376775">
          <h3>
            <a
              class="item"
              href="https://pok.acm.org/meetings/foils/McGrew18paper.pdf"
              >Forgotten APL Influences (2016) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 10:19:01</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40376775"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40375641">
          <h3>
            <a
              class="item"
              href="https://thefoggiest.dev/2024/05/16/my-sony-hb-f1xv"
              >My Sony HB-F1XV</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 06:03:07</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40375641"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40375341">
          <h3>
            <a class="item" href="https://graydon2.dreamwidth.org/312681.html"
              >Some notes on Rust, mutable aliasing and formal verification</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 05:01:53</span
              ><span class="points-container"
                >Points: <span class="points">289</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40375341"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40375178">
          <h3>
            <a
              class="item"
              href="https://blogs.sciencemag.org/pipeline/archives/2019/11/21/the-higher-states-of-bromine"
              >Things I won't work with: the higher states of bromine (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 04:24:02</span
              ><span class="points-container"
                >Points: <span class="points">323</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40375178"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40374879">
          <h3>
            <a
              class="item"
              href="https://thecentercolumn.com/2020/01/17/earths-rotation-limits-ibis-performance-to-6-3-stops/"
              >Earth rotation limits in-body image stabilization to 6.3 stops
              (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 03:17:08</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40374879"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40371650">
          <h3>
            <a
              class="item"
              href="https://www.straightdope.com/21341781/in-medicine-what-s-the-difference-between-an-ectomy-an-ostomy-and-an-otomy"
              >What’s the difference between an -ectomy, an -ostomy, and an
              -otomy? (1986)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 20:01:37</span
              ><span class="points-container"
                >Points: <span class="points">232</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40371650"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40371612">
          <h3>
            <a
              class="item"
              href="https://github.com/ggerganov/llama.cpp/pull/7154"
              >New exponent functions that make SiLU and SoftMax 2x faster, at
              full accuracy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 19:57:01</span
              ><span class="points-container"
                >Points: <span class="points">361</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40371612"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40369467">
          <h3>
            <a
              class="item"
              href="https://jepsen.io/analyses/datomic-pro-1.0.7075"
              >Jepsen: Datomic Pro 1.0.7075</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 16:57:30</span
              ><span class="points-container"
                >Points: <span class="points">365</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40369467"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40365248">
          <h3>
            <a
              class="item"
              href="https://fgiesen.wordpress.com/2016/08/07/why-do-cpus-have-multiple-cache-levels/"
              >Why do CPUs have multiple cache levels? (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 10:58:44</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40365248"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40364989">
          <h3>
            <a
              class="item"
              href="https://blog.axantum.com/2024/05/localizing-net-console-or-desktop.html"
              >Localization in .NET console and desktop apps</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 10:08:04</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40364989"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40364108">
          <h3>
            <a
              class="item"
              href="https://www.ft.com/content/6d846a93-030a-4106-b045-d74a216493b0"
              >Raspberry Pi prepares for London listing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 07:36:36</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40364108"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40363788">
          <h3>
            <a
              class="item"
              href="https://www.scottaaronson.com/democritus/lec17.html"
              >PHYS771 Lecture 17: Fun with the Anthropic Principle (2006)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 06:39:24</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40363788"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40363057">
          <h3>
            <a
              class="item"
              href="https://www.blog.jonathannolan.net/p/how-to-measure-the-impact-of-zoning"
              >Measuring the impact of zoning on housing in a city</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 04:17:33</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40363057"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
