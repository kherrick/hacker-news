<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38531761">
          <h3>
            <a
              class="item"
              href="https://www.ualberta.ca/folio/2023/11/innovative-light-switch-could-cut-house-wiring-costs-in-half.html"
              >Innovative wireless light switch could cut house wiring costs in
              half</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 15:06:26</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38531761"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38531720">
          <h3>
            <a
              class="item"
              href="https://blog.beeper.com/p/how-beeper-mini-works"
              >How Beeper Mini Works</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 15:04:11</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38531720"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38531621">
          <h3>
            <a
              class="item"
              href="https://www.forbes.com/sites/samabuelsamid/2023/11/30/our-next-energy-dual-chemistry-battery-achieves-over-600-mile-range/"
              >BMW EV achieves 1000km in range using Dual-Chemistry batteries</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 14:57:38</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38531621"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38531604">
          <h3>
            <a class="item" href="https://how-did-i-get-here.net/"
              >Show HN: How did YOUR computer reach my server?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 14:56:25</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38531604"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38531235">
          <h3>
            <a
              class="item"
              href="https://www.mountaindew.com/wp-content/uploads/2023/11/MTN-DEW-RAID-QA.pdf"
              >Mtn Dew using AI to find logos on twitch streams and reward
              streamers [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 14:35:12</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38531235"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38531181">
          <h3>
            <a class="item" href="https://termshark.io/"
              >Termshark – A terminal UI for tshark, inspired by Wireshark</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 14:32:12</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38531181"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38531174">
          <h3>
            <a
              class="item"
              href="https://modern-sql.com/blog/2023-12/curious-case-aggregation-query"
              >The Curious Case of the Aggregation Query</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 14:31:25</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38531174"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38531104">
          <h3>
            <a
              class="item"
              href="https://www.brycewray.com/posts/2023/11/firefox-brink/"
              >Firefox on the Brink?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 14:24:52</span
              ><span class="points-container"
                >Points: <span class="points">177</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38531104"
                  >Comments</a
                ><span class="descendants">: 246</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38530948">
          <h3>
            <a class="item" href="https://yutongbai.com/lvm.html"
              >Predict the next frame. Results of training a transformer on
              "visual sentences"</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 14:14:21</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38530948"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38530940">
          <h3>
            <a
              class="item"
              href="https://www.livescience.com/space/the-sun/impossible-orange-auroras-spotted-in-uk-after-solar-storm-slams-into-earth"
              >'Impossible' orange auroras spotted in UK after solar storm slams
              into Earth</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 14:13:48</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38530940"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38530885">
          <h3>
            <a
              class="item"
              href="https://social.hackerspace.pl/@q3k/111528162462505087"
              >Polish trains lock up when serviced in third-party workshops</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 14:10:12</span
              ><span class="points-container"
                >Points: <span class="points">232</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38530885"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38530880">
          <h3>
            <a
              class="item"
              href="https://www.schneier.com/blog/archives/2023/12/the-internet-enabled-mass-surveillance-ai-will-enable-mass-spying.html"
              >AI will enable mass spying</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 14:09:44</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38530880"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38530852">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2023-12-05/meta-ibm-create-industrywide-ai-alliance-to-share-technology"
              >Meta, IBM Create Industrywide AI Alliance to Share Technology</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 14:06:51</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38530852"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38530795">
          <h3>
            <a
              class="item"
              href="https://slate.com/technology/2023/12/ai-mass-spying-internet-surveillance.html"
              >The Internet Enabled Mass Surveillance. A.I. Will Enable Mass
              Spying</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 14:02:45</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38530795"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38530597">
          <h3>
            <a
              class="item"
              href="https://tube.jeena.net/w/nivehRx8J7ZwujfS2oCoPC"
              >My Fediverse use – I'm hosting everything myself – PeerTube,
              Mastodon and Lemmy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 13:46:53</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38530597"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38530565">
          <h3>
            <a class="item" href="https://github.com/nst/bfps"
              >A Brainfuck interpreter written in PostScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 13:43:24</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38530565"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38530466">
          <h3>
            <a
              class="item"
              href="https://academic.oup.com/pnasnexus/article/2/12/pgad385/7457939"
              >Toxic comments are associated with reduced volunteer editors on
              Wikipedia</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 13:33:30</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38530466"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38530343">
          <h3>
            <a class="item" href="https://github.com/SuperDuperDB/superduperdb"
              >Show HN: SuperDuperDB – Open-source framework for integrating AI
              with databases</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 13:20:10</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38530343"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
            <div class="text">
              <p>
                Today we are officially launching SuperDuperDB, an open-source
                framework for integrating AI directly with major databases,
                including streaming inference, scalable model training, and
                vector search, with release of v0.1. on GitHub and on
                ProductHunt.
              </p>
              <p>
                SuperDuperDB is not a database. It transforms your favorite
                database into an AI development and deployment environment
                (𝘮𝘢𝘬𝘪𝘯𝘨 𝘪𝘵 𝘴𝘶𝘱𝘦𝘳-𝘥𝘶𝘱𝘦𝘳).
              </p>
              <p>
                SuperDuperDB eliminates complex MLOps pipelines, specialized
                vector databases - and the need to migrate and duplicate data by
                integrating AI at the data's source, directly on top of your
                existing data infrastructure. This massively simplifies building
                and managing AI applications.
              </p>
              <p>
                SuperDuperDB provides a simple Python interface, but allows
                experts to drill down to any level of implementation detail such
                as models weights or training details.
              </p>
              <p>
                Today’s release comes with the full integration of major SQL
                databases as well as further MongoDB support: PostgreSQL, MySQL,
                SQLite, DuckDB, Snowflake, BigQuery, ClickHouse, DataFusion,
                Druid, Impala, MSSQL, Oracle, pandas, Polars, PySpark, and
                Trino.
              </p>
              <p>
                Currently Supported AI: Any model from PyTorch, Sklearn,
                HuggingFace as well as AI APIs such as OpenAI, Anthrophic,
                Cohere.
              </p>
              <p>
                A few useful links: - Our website:
                <a href="https://superduperdb.com">https://superduperdb.com</a>
                - Getting started docs:
                <a
                  href="https://docs.superduperdb.com/docs/category/get-started/"
                  >https://docs.superduperdb.com/docs/category/get-started/</a
                >
                - Our repo on Github:
                <a href="https://github.com/SuperDuperDB/superduperdb"
                  >https://github.com/SuperDuperDB/superduperdb</a
                >
              </p>
              <p>
                Check the uses-cases that we have already implemented here
                <a href="https://docs.superduperdb.com/docs/category/use-cases"
                  >https://docs.superduperdb.com/docs/category/use-cases</a
                >
                as well as apps built by the community here
                <a
                  href="https://github.com/SuperDuperDB/superduper-community-apps"
                  >https://github.com/SuperDuperDB/superduper-community-apps</a
                >
                and try all of them with Jupyter your browser
                <a href="https://demo.superduperdb.com/"
                  >https://demo.superduperdb.com/</a
                >
              </p>
              <p>
                For more information about SuperDuperDB and why we believe it is
                much needed, read the blog post
                <a
                  href="https://docs.superduperdb.com/blog/superduperdb-the-open-source-framework-for-bringing-ai-to-your-datastore/"
                  >https://docs.superduperdb.com/blog/superduperdb-the-open-sou...</a
                >
              </p>
              <p>We are keen to hear your feedback!</p>
              <p>All the best, Timo</p>
            </div>
          </section>
        </section>
        <section id="38530207">
          <h3>
            <a
              class="item"
              href="https://twitter.com/hbouammar/status/1731970658278469714"
              >Sorry, but a new prompt for GPT-4 is not a paper</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 13:06:03</span
              ><span class="points-container"
                >Points: <span class="points">150</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38530207"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38529977">
          <h3>
            <a
              class="item"
              href="https://www.britannica.com/story/the-time-julius-caesar-was-captured-by-pirates"
              >The Time Julius Caesar Was Captured by Pirates</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 12:32:16</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38529977"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38529784">
          <h3>
            <a
              class="item"
              href="https://jobs.lever.co/givecampus/44af3199-546a-404a-95fd-a097ef37e915"
              >GiveCampus (YC S15) Is Hiring Engineers who care about
              education</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 12:00:32</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38527965">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2023/12/04/23andme-confirms-hackers-stole-ancestry-data-on-6-9-million-users/"
              >23andMe confirms hackers stole ancestry data on 6.9M users</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 07:19:10</span
              ><span class="points-container"
                >Points: <span class="points">331</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38527965"
                  >Comments</a
                ><span class="descendants">: 180</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38526948">
          <h3>
            <a class="item" href="https://github.com/rage-rb/rage"
              >Rage: Fast web framework compatible with Rails</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 04:00:28</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38526948"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38526877">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-12-theory-einstein-gravity-quantum-mechanics.html"
              >New theory claims to unite Einstein's gravity with quantum
              mechanics</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 03:47:22</span
              ><span class="points-container"
                >Points: <span class="points">244</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38526877"
                  >Comments</a
                ><span class="descendants">: 136</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38525978">
          <h3>
            <a
              class="item"
              href="https://www.mayer.cool/writings/I-Hacked-Magic-the-Gathering/"
              >I hacked Magic the Gathering: Arena for a 100% win rate</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 01:49:15</span
              ><span class="points-container"
                >Points: <span class="points">429</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38525978"
                  >Comments</a
                ><span class="descendants">: 140</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38516879">
          <h3>
            <a class="item" href="https://corecursive.com/vue-with-evan-you/"
              >From 486 to Vue.js: Evan You's Full-Time Gamble on Open Source</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-04 @ 13:21:49</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38516879"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38516475">
          <h3>
            <a
              class="item"
              href="https://books.lib.uoguelph.ca/languagesofmedia/chapter/chapter-7-public-interventions/"
              >The Languages of Media – Advertising Techniques</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-04 @ 12:32:12</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38516475"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38516038">
          <h3>
            <a class="item" href="https://alexlenail.me/NN-SVG/AlexNet.html"
              >NN-SVG</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-04 @ 11:35:13</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38516038"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38515387">
          <h3>
            <a class="item" href="https://blog.matthen.com"
              >Maths and science animations (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-04 @ 09:41:45</span
              ><span class="points-container"
                >Points: <span class="points">174</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38515387"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38515211">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41586-023-06757-3"
              >Human mobility networks reveal increased segregation in large
              cities</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-04 @ 09:13:17</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38515211"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
