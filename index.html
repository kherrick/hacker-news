<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40842082">
          <h3>
            <a
              class="item"
              href="https://earthobservatory.nasa.gov/images/92071/richat-structure"
              >Richat Structure</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 02:29:28</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40842082"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40841980">
          <h3>
            <a class="item" href="https://www.pipes.digital/docs"
              >Pipes: A spiritual successor to Yahoo Pipes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 02:03:37</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40841980"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40841649">
          <h3>
            <a
              class="item"
              href="https://grugq.substack.com/p/userland-rootkits-are-lame"
              >Userland rootkits are lame (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 00:47:45</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40841649"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40841502">
          <h3>
            <a
              class="item"
              href="https://tylerneylon.com/a/mind_model/mind_model.html"
              >A Model of a Mind</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 00:15:19</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40841502"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40841355">
          <h3>
            <a class="item" href="http://www.jjj.de/fxt/#fxtbook"
              >Matters Computational [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-30 @ 23:40:07</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40841355"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40840488">
          <h3>
            <a
              class="item"
              href="https://omid.dev/2024/07/01/chaos-engineering-in-frontend-development/"
              >Chaos Engineering in Front End Development: Enhancing Application
              Resilience</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-30 @ 21:20:45</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40840488"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40840396">
          <h3>
            <a
              class="item"
              href="https://www.alvarorevuelta.com/posts/fft-polynomials"
              >Convolutions, Fast Fourier Transform and polynomials (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-30 @ 21:08:43</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40840396"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40839830">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2406.09490"
              >Newswire: A large-scale structured database of a century of
              historical news</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-30 @ 19:58:46</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40839830"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40839418">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Postzegelcode"
              >Postzegelcode</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-30 @ 19:17:42</span
              ><span class="points-container"
                >Points: <span class="points">181</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40839418"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40839208">
          <h3>
            <a
              class="item"
              href="https://tulach.cc/writing-gui-apps-for-windows-is-painful/"
              >Writing GUI apps for Windows is painful</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-30 @ 18:53:18</span
              ><span class="points-container"
                >Points: <span class="points">207</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40839208"
                  >Comments</a
                ><span class="descendants">: 264</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40838945">
          <h3>
            <a
              class="item"
              href="https://www.thepythoncodingstack.com/p/python-diffusion-simulation-demo-turtle"
              >A simplified Python simulation of diffusion</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-30 @ 18:24:34</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40838945"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40838635">
          <h3>
            <a class="item" href="https://justine.lol/endian.html"
              >The Byte Order Fiasco (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-30 @ 17:42:02</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40838635"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40838327">
          <h3>
            <a
              class="item"
              href="https://bitmovin.com/careers/senior-solutions-engineer-us-7504149002"
              >Bitmovin (YC S15) is hiring video solution architects in the
              US</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-30 @ 17:00:14</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40838167">
          <h3>
            <a
              class="item"
              href="https://dillan.org/articles/how-to-get-root-access-to-your-sleep-number-bed"
              >How to get root access to your Sleep Number bed</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-30 @ 16:38:08</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40838167"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40837610">
          <h3>
            <a class="item" href="https://github.com/poundifdef/SmoothMQ"
              >Show HN: Drop-in SQS replacement based on SQLite</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-30 @ 15:11:08</span
              ><span class="points-container"
                >Points: <span class="points">448</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40837610"
                  >Comments</a
                ><span class="descendants">: 118</span></span
              >
            </h4>
            <div class="text">
              <p>
                I wrote this because I wanted a queue with all the bells and
                whistles - searching, scheduling into the future, observability,
                and rate limiting - all the things that many modern task queue
                systems have.
              </p>
              <p>
                But I didn't want to rewrite my app, which was already using
                SQS. And I was frustrated that many of the best solutions out
                there (BullMQ, Oban, Sidekiq) were language-specific.
              </p>
              <p>
                So I made an SQS-compatible replacement. All you have to do is
                replace the endpoint using AWS' native library in your language
                of choice.
              </p>
              <p>
                For example, the queue works with Celery - you just change the
                connection string. From there, you can see all of your messages
                and their status, which is hard today in the SQS console (and
                flower doesn't support SQS.)
              </p>
              <p>
                It is written to be pluggable. The queue implementation uses
                SQLite, but I've been experimenting with RocksDB as a backend
                and you could even write one that uses Postgres. Similarly, you
                could implement multiple protocols (AMQP, PubSub, etc) on top of
                the underlying queue. I started with SQS because it is simple
                and I use it a lot.
              </p>
              <p>
                It is written to be as easy to deploy as possible - a single go
                binary. I'm working on adding distributed and autoscale
                functionality as the next layer.
              </p>
              <p>
                Today I have search, observability (via prometheus), unlimited
                message sizes, and the ability to schedule messages arbitrarily
                in the future.
              </p>
              <p>
                In terms of monetization, the goal is to just have a hosted
                queue system. I believe this can be cheaper than SQS without
                sacrificing performance. Just as Backblaze and Minio have had
                success competing in the S3 space, I wanted to take a crack at
                queues.
              </p>
              <p>I'd love your feedback!</p>
            </div>
          </section>
        </section>
        <section id="40837420">
          <h3>
            <a class="item" href="https://silentsignal.github.io/BelowMI/"
              >Below MI – IBM i for hackers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-30 @ 14:43:54</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40837420"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40837411">
          <h3>
            <a class="item" href="https://mental-reverb.com/blog.php?id=29"
              >The weirdest QNX bug I've encountered (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-30 @ 14:42:03</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40837411"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40835588">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2024/06/29/mit-robotics-pioneer-rodney-brooks-thinks-people-are-vastly-overestimating-generative-ai/"
              >Rodney Brooks on limitations of generative AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-30 @ 07:02:26</span
              ><span class="points-container"
                >Points: <span class="points">163</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40835588"
                  >Comments</a
                ><span class="descendants">: 150</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40835223">
          <h3>
            <a
              class="item"
              href="https://10maurycy10.github.io/misc/the_physics_of_flight/"
              >The physics of airplane flight</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-30 @ 04:54:17</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40835223"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40834440">
          <h3>
            <a
              class="item"
              href="https://blog.trailofbits.com/2018/10/26/the-good-the-bad-and-the-weird/"
              >The good, the bad, and the weird (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-30 @ 01:07:13</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40834440"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40834012">
          <h3>
            <a
              class="item"
              href="https://www.swissinfo.ch/eng/life-aging/swiss-broadcasting-corporation-to-pull-plug-on-fm-radio/81956760"
              >Swiss Broadcasting Corporation to pull plug on FM radio</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-29 @ 23:27:02</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40834012"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40833960">
          <h3>
            <a class="item" href="https://jcs.org/2024/05/29/x1usb"
              >Adding a USB port to the ThinkPad X1 Nano (the hard way)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-29 @ 23:17:53</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40833960"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40831964">
          <h3>
            <a
              class="item"
              href="https://minimaxir.com/2024/06/pokemon-embeddings/"
              >The super effectiveness of Pokémon embeddings using only raw JSON
              and images</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-29 @ 17:03:53</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40831964"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40831904">
          <h3>
            <a class="item" href="https://pickcode.io"
              >Show HN: Pickcode – Free online code editor for kids</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-29 @ 16:56:51</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40831904"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
            <div class="text">
              <a href="https://news.ycombinator.com/item?id=38365638"
                >https://news.ycombinator.com/item?id=38365638</a
              >), but we've improved things quite a bit so I thought it was
              worth posting again. This is a bit of 1.0 release after a long
              year of working on the company full time!
              <p>
                Pickcode is basically Replit-lite, for kids. The editor is
                simple: text editor + output console + big green button to run
                your code. We support Python, HTML/CSS/JS, Java, and our
                block/text hybrid language, Pickcode VL. We're partners on
                code.org's Hour of Code, and hundreds of thousands of students
                have tried our free stuff through them.
              </p>
              <p>
                An account for individual kids is totally free, and we offer
                some free Python and Pickcode VL lessons to get them started. We
                make money by selling licenses to schools for better customer
                support and roster/lesson management features.
              </p>
              <p>You can use this demo account I made to try out the editor:</p>
              <p></p>
              <pre><code>  email: demo@student.pickcode.io
  pw: Demo1234
</code></pre>
              (Don't clobber other people's work, and what you put in the demo
              account is public so be nice)
            </div>
          </section>
        </section>
        <section id="40830395">
          <h3>
            <a
              class="item"
              href="https://www.typography.com/blog/text-for-proofing-fonts"
              >Text for Proofing Fonts (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-29 @ 13:34:55</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40830395"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40829494">
          <h3>
            <a class="item" href="https://github.com/mifi/lossless-cut"
              >LosslessCut: The Swiss army knife of lossless video/audio
              editing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-29 @ 11:18:37</span
              ><span class="points-container"
                >Points: <span class="points">259</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40829494"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40828754">
          <h3>
            <a
              class="item"
              href="https://textiles-lab.github.io/publications/2023-knitout-semantics/"
              >Semantics and scheduling for machine knitting compilers (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-29 @ 08:42:02</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40828754"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40822532">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/smart-news/these-stunning-butterflies-flew-2600-miles-across-the-atlantic-ocean-without-stopping-180984602/"
              >Butterflies flew 2,600 miles across the Atlantic without
              stopping</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-28 @ 16:57:13</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40822532"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40820022">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2406.19108"
              >Computational Life: How self-replicating programs emerge from
              simple interaction</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-28 @ 12:36:00</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40820022"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40816349">
          <h3>
            <a
              class="item"
              href="https://blog.supermechanical.com/2024/06/27/debugging-hardware-is-hard/"
              >Debugging hardware is hard</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-27 @ 23:35:10</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40816349"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
