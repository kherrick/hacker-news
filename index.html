<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38796078">
          <h3>
            <a
              class="item"
              href="https://cfenollosa.com/blog/after-self-hosting-my-email-for-twenty-three-years-i-have-thrown-in-the-towel-the-oligopoly-has-won.html"
              >After self-hosting email for 23 years I have thrown in the towel
              (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-28 @ 17:44:27</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38796078"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38795516">
          <h3>
            <a
              class="item"
              href="https://x.com/ArjunMahadevan/status/1737555905900658815?s=20"
              >Doola a "Business-in-a-Box" (YC S20) Is Hiring a CPA</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-28 @ 17:01:07</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38795376">
          <h3>
            <a class="item" href="https://www.slitaz.org/en/about/"
              >SliTaz GNU/Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-28 @ 16:50:13</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38795376"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38795308">
          <h3>
            <a
              class="item"
              href="https://lunduke.locals.com/post/5053290/mozilla-2023-annual-report-ceo-pay-skyrockets-while-firefox-marketshare-nosedives"
              >Mozilla '23 Ann. Report: CEO pay skyrockets while Firefox
              Marketshare nosedives</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-28 @ 16:44:34</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38795308"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38795290">
          <h3>
            <a
              class="item"
              href="https://www.engadget.com/xiaomi-says-its-su7-ev-can-outperform-porsche-and-has-more-tech-than-tesla-095637762.html"
              >Details on Xiaomi EV</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-28 @ 16:43:06</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38795290"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38795009">
          <h3>
            <a
              class="item"
              href="https://www.courtlistener.com/docket/68117049/the-new-york-times-company-v-microsoft-corporation"
              >The New York Times Company vs. Microsoft Corporation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-28 @ 16:21:45</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38795009"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38794757">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2312.10049"
              >Knowledge Graph Reasoning Based on Attention GCN</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-28 @ 16:02:24</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38794757"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38794733">
          <h3>
            <a class="item" href="https://anytype.io/"
              >Show HN: Anytype – local-first, P2P knowledge management</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-28 @ 16:00:21</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38794733"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
            <div class="text">
              <p>
                Anytype fulfils the seven ideals of local first software from
                here -
                <a href="https://www.inkandswitch.com/local-first/"
                  >https://www.inkandswitch.com/local-first/</a
                >
                , our team felt these things are important to all of us:
              </p>
              <p>
                • No spinners: your work at your fingertips. Anytype keeps the
                primary copy of each space on the local device. Data
                synchronization with other devices happens quietly in the
                background - allowing you to operate with your data at your
                fingertips.
              </p>
              <p>
                • Your work is not trapped on one device. Users can easily work
                on different devices. Each device keeps data in local storage,
                synchronisation between devices happens in the background using
                CRDTs to resolve conflicts.
              </p>
              <p>
                • The network is optional. Everything works offline. Data
                synchronization need not necessarily go via the Internet:
                AnySync allows users to sync data via local WiFi networks.
                Still, there is a role for the network - it works as additional
                backup, helps with peer discovery and especially solves the
                closed-laptop problem (you made changes on laptop, when your
                phone was offline, the changes can either sync when both devices
                are online or via backup node).
              </p>
              <p>
                • Seamless collaboration with your colleagues. Achieving this
                goal is one of the biggest challenges in realizing local-first
                software, but we believe with CRDTs it's possible. AnySync
                supports it &amp; we will release multiplayer version soon.
              </p>
              <p>
                • The Long Now. Because you have a local-first application, you
                can use it on your computer even if the software author
                disappears. This is also strengthened by open data standards and
                open code.
              </p>
              <p>
                • Security and privacy by default. AnySync uses end-to-end
                encryption so that backup nodes store encrypted data that they
                cannot read. Conflict resolution happens on-device. The keys are
                controlled by users.
              </p>
              <p>
                • You retain ultimate ownership and control. Users control
                encryption keys; there is no central registry of users (we don’t
                ask even your email). We added an option to self-host your
                backup to support full autonomy of users from the network.
              </p>
            </div>
          </section>
        </section>
        <section id="38794625">
          <h3>
            <a class="item" href="https://github.com/hunar4321/particle-life"
              >Particle Life</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-28 @ 15:52:17</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38794625"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38794190">
          <h3>
            <a class="item" href="https://vocabminer.com/"
              >Show HN: Vocab Miner – find new words in Spanish from texts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-28 @ 15:17:37</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38794190"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38794068">
          <h3>
            <a
              class="item"
              href="https://www.fda.gov/inspections-compliance-enforcement-and-criminal-investigations/warning-letters/amazoncom-inc-662503-12202023"
              >Amazon receives FDA warning letter for supplements with
              undeclared ingredients</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-28 @ 15:07:24</span
              ><span class="points-container"
                >Points: <span class="points">275</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38794068"
                  >Comments</a
                ><span class="descendants">: 194</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38793414">
          <h3>
            <a
              class="item"
              href="https://www.howtogeek.com/the-best-reason-to-use-firefox-is-sync-that-actually-works/"
              >The Most Compelling Reason to Use Firefox Is Sync That Works</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-28 @ 13:46:08</span
              ><span class="points-container"
                >Points: <span class="points">364</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38793414"
                  >Comments</a
                ><span class="descendants">: 258</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38793249">
          <h3>
            <a class="item" href="https://www.gregegan.net/FOUNDATIONS/"
              >Foundations – Greg Egan</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-28 @ 13:28:10</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38793249"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38793206">
          <h3>
            <a
              class="item"
              href="https://dubroy.com/blog/cold-blooded-software/"
              >Cold-blooded software</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-28 @ 13:22:56</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38793206"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38792753">
          <h3>
            <a class="item" href="https://loderunnerwebgame.com/game/"
              >Lode Runner (HTML5 Remake)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-28 @ 12:24:06</span
              ><span class="points-container"
                >Points: <span class="points">170</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38792753"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38792631">
          <h3>
            <a
              class="item"
              href="https://hardmath123.github.io/xkcd-random.html"
              >How random is xkcd? (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-28 @ 12:06:47</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38792631"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38792446">
          <h3>
            <a
              class="item"
              href="https://blogsystem5.substack.com/p/the-ides-we-had-30-years-ago-and"
              >IDEs we had 30 years ago</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-28 @ 11:38:57</span
              ><span class="points-container"
                >Points: <span class="points">278</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38792446"
                  >Comments</a
                ><span class="descendants">: 242</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38790854">
          <h3>
            <a class="item" href="https://taoshu.in/net/outlook-delist.html"
              >Outlook/Hotmail is no longer blocking my mail server</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-28 @ 07:06:03</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38790854"
                  >Comments</a
                ><span class="descendants">: 178</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38790597">
          <h3>
            <a
              class="item"
              href="https://andreasjhkarlsson.github.io//jekyll/update/2023/12/27/4-billion-if-statements.html"
              >4B If Statements</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-28 @ 06:11:31</span
              ><span class="points-container"
                >Points: <span class="points">880</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38790597"
                  >Comments</a
                ><span class="descendants">: 323</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38790255">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/tech-policy/2023/12/ny-times-sues-open-ai-microsoft-over-copyright-infringement/"
              >NY Times copyright suit wants OpenAI to delete all GPT
              instances</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-28 @ 05:07:07</span
              ><span class="points-container"
                >Points: <span class="points">400</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38790255"
                  >Comments</a
                ><span class="descendants">: 666</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38789958">
          <h3>
            <a
              class="item"
              href="https://github.com/martinmimigames/little-file-explorer"
              >Little File Explorer – File Manager for Android 1.0 and above</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-28 @ 04:11:13</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38789958"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38786046">
          <h3>
            <a
              class="item"
              href="https://www.historytoday.com/archive/miscellanies/medieval-icelandic-feasts"
              >Medieval Icelandic Feasts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 20:08:28</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38786046"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38785468">
          <h3>
            <a
              class="item"
              href="https://www.eia.gov/todayinenergy/detail.php?id=61106"
              >First new U.S. nuclear reactor since 2016 is now in operation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 19:19:37</span
              ><span class="points-container"
                >Points: <span class="points">798</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38785468"
                  >Comments</a
                ><span class="descendants">: 786</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38783870">
          <h3>
            <a class="item" href="https://www.youtube.com/shorts/j1b4whvmIOc"
              >Chinese villagers capture video of falling Long March rocket
              booster</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 16:56:18</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38783870"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38782806">
          <h3>
            <a
              class="item"
              href="https://reactionwheel.net/2019/01/schumpeter-on-strategy.html"
              >Schumpeter on Strategy (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 15:19:47</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38782806"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38782039">
          <h3>
            <a
              class="item"
              href="https://blog.glyphdrawing.club/ascii-art-from-a-commodity-into-an-obscurity/"
              >ASCII Art: From a Commodity into an Obscurity</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 14:12:06</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38782039"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38781351">
          <h3>
            <a class="item" href="https://codersatwork.com/"
              >Coders at Work: Reflections on the Craft of Programming (2009)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 12:30:35</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38781351"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38780433">
          <h3>
            <a class="item" href="https://zserge.com/posts/small-web/"
              >Poor Man's Web</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 09:30:47</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38780433"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38779706">
          <h3>
            <a
              class="item"
              href="https://blog.frost.kiwi/GLSL-noise-and-radial-gradient/"
              >How to (and how not to) fix color banding</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 06:54:23</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38779706"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38779059">
          <h3>
            <a
              class="item"
              href="https://www.lesswrong.com/posts/PBRWb2Em5SNeWYwwB/humans-are-not-automatically-strategic"
              >Humans are not automatically strategic (2010)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 04:18:47</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38779059"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
