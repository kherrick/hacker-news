<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="35605602">
          <h3>
            <a
              class="item"
              href="https://www.vulture.com/article/dracula-movie-performances-ranked.html"
              >Draculas, Ranked</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-17 @ 19:46:52</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35605602"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35605412">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/worklife/article/20230413-home-coworking-spaces-with-friends"
              >Coworking from Home</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-17 @ 19:34:14</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35605412"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35605106">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/2023/04/24/crooks-mistaken-bet-on-encrypted-phones"
              >Crooks’ Mistaken Bet on Encrypted Phones</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-17 @ 19:09:43</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35605106"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35604715">
          <h3>
            <a
              class="item"
              href="https://github.com/empath-nirvana/magic-happens"
              >Show HN: Magic Happens – let ChatGPT manage your Kubernetes
              cluster</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-17 @ 18:39:22</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35604715"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
            <div class="text">
              <p>Some descriptions to try:</p>
              <p>
                * install a redis namespace with a redis cluster and a service
                in it * create an argocd application in the argocd namespace to
                install velero. * write a python script that lists all ec2
                instances in us-east-1, and run it as a k8s job with the aws
                credentials already saved in the default namespace..
              </p>
              <p>
                a somewhat longer description that also worked: given the
                following spec: --- kind: MagicHappens apiVersion:
                gptmagic.io/v1 metadata: name: foo spec: description: this is a
                freeform description field that will be sent to chatgpt to
                generate kubernetes resources dryRun: false --- Can you create
                more magic happens resources, each of which describes an argocd
                application that needs to be created to install a helm chart for
                one of the standard cluster addons that need to be installed on
                a cluster for it to be production ready. The description should
                be be freeform text like the following: "Create an argocd
                application in the argocd namespace to install istio from the
                helm chart with all the defaults" or "Create an argocd
                application in the argocd namespace to install prometheus and
                grafana, with an ingress enabled for grafana". Be very thorough
                and included as many apps that might be needed for a prod ready
                cluster using industry standard CNCF projects if possible.
              </p>
              <p>
                (this produces a list of additional resources for the operator,
                which the operator then goes on to create argocd applications
                for -- it also left comments with instructions on one of the
                resources for how configure it to work with your cloud provider
              </p>
              <p>
                something to note is that since you can run arbitrary containers
                with arbitrary commands, and chatgpt can write arbitrary code,
                you don't have to limit yourself to k8s stuff.. if you've got
                saas credentials on the cluster, you can just tell it to run a
                python script as a job to do whatever you want.
              </p>
              <p>
                Since most people are cowards, there's a dryRun field that
                defaults to true, so it only attaches the spec to the object.
              </p>
              <p>It is <i>scary</i> how well this works.</p>
            </div>
          </section>
        </section>
        <section id="35604544">
          <h3>
            <a
              class="item"
              href="https://jalopnik.com/starchase-guardian-hx-nypd-vehicle-gps-tracker-police-1850327888"
              >NYPD Can Now Shoot GPS Trackers at Your Car</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-17 @ 18:26:41</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35604544"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35604002">
          <h3>
            <a
              class="item"
              href="https://stackoverflow.blog/2023/04/17/community-is-the-future-of-ai/"
              >Community Is the Future of AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-17 @ 17:43:29</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35604002"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35603973">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Neobuthus_factorio"
              >Neobuthus Factorio</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-17 @ 17:41:06</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35603973"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35603819">
          <h3>
            <a class="item" href="https://www.printablesearch.com"
              >New 3D Printable Search Engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-17 @ 17:30:32</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35603819"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35603756">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/openai-ceo-sam-altman-the-age-of-giant-ai-models-is-already-over/"
              >OpenAI’s CEO says the age of giant AI models is already over</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-17 @ 17:25:04</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35603756"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35603511">
          <h3>
            <a class="item" href="https://github.com/xnuinside/codegraph"
              >Codegraph – static code analyzator / code diagramer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-17 @ 17:02:08</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35603511"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35603491">
          <h3>
            <a class="item" href="https://jobs.lever.co/buildzoom"
              >BuildZoom (YC W13) Is hiring a Principal Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-17 @ 17:00:51</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35603457">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/04/17/amazon_annual_shareholder_letter_aws/"
              >AWS staff spending ‘much of their time ’optimizing customers'
              clouds'</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-17 @ 16:57:54</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35603457"
                  >Comments</a
                ><span class="descendants">: 120</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35603376">
          <h3>
            <a
              class="item"
              href="https://finance.yahoo.com/news/vw-rivian-nissan-bmw-lose-140645246.html"
              >VW, Rivian, Nissan, BMW lose access to U.S. EV tax credits</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-17 @ 16:52:09</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35603376"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35603181">
          <h3>
            <a class="item" href="https://lethain.com/forty-year-career/"
              >A Forty-Year Career</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-17 @ 16:37:41</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35603181"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35602983">
          <h3>
            <a
              class="item"
              href="https://questdb.io/blog/inner-workings-distributed-databases/"
              >The Inner Workings of Distributed Databases</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-17 @ 16:23:03</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35602983"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35601958">
          <h3>
            <a
              class="item"
              href="https://www.hillelwayne.com/post/graphing-tla/"
              >Breaking the limits of TLA+ model checking</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-17 @ 15:11:03</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35601958"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35600860">
          <h3>
            <a class="item" href="https://www.together.xyz/blog/redpajama"
              >RedPajama: Reproduction of Llama with Friendly License</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-17 @ 14:05:09</span
              ><span class="points-container"
                >Points: <span class="points">418</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35600860"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35599884">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/04/17/opinion_column/"
              >Firmware is on shaky ground – let's see what it's made of</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-17 @ 12:49:12</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35599884"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35599363">
          <h3>
            <a
              class="item"
              href="https://animaomnium.github.io/keep-stuff-linkable/"
              >Keep stuff linkable</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-17 @ 11:47:06</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35599363"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35599315">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2023/04/17/ios-17-will-reportedly-set-the-stage-for-sideloading-apps-on-iphone/"
              >iOS 17 will reportedly set the stage for sideloading apps on
              iPhone</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-17 @ 11:40:39</span
              ><span class="points-container"
                >Points: <span class="points">295</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35599315"
                  >Comments</a
                ><span class="descendants">: 465</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35598281">
          <h3>
            <a class="item" href="https://minigpt-4.github.io/">MiniGPT-4</a>
          </h3>
          <section>
            <h4>
              <span>2023-04-17 @ 08:56:07</span
              ><span class="points-container"
                >Points: <span class="points">743</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35598281"
                  >Comments</a
                ><span class="descendants">: 240</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35597994">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/features/2023-04-13/america-s-smallest-bank-is-kentland-federal-savings-and-loan"
              >There are no fees at America’s smallest bank</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-17 @ 08:08:24</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35597994"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35597854">
          <h3>
            <a
              class="item"
              href="https://www.undeadly.org/cgi?action=article;sid=20230417074903"
              >OpenBSD: Malloc leak detection available in -current</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-17 @ 07:49:48</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35597854"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35597346">
          <h3>
            <a
              class="item"
              href="https://rkoutnik.com/2016/04/21/implementers-solvers-and-finders.html"
              >Implementers, Solvers, and Finders</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-17 @ 06:16:33</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35597346"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35596231">
          <h3>
            <a
              class="item"
              href="https://www.kite.org/about-kites/history-of-kites/"
              >History of Kites</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-17 @ 02:26:48</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35596231"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35596107">
          <h3>
            <a
              class="item"
              href="https://www.sciencedirect.com/science/article/pii/B9780123735539000377"
              >Dolphin Bow-Riding (2009)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-17 @ 02:06:43</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35596107"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35594853">
          <h3>
            <a
              class="item"
              href="https://lcamtuf.substack.com/p/the-basics-of-decoupling-capacitors"
              >The basics of decoupling capacitors</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-16 @ 22:34:07</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35594853"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35587981">
          <h3>
            <a
              class="item"
              href="https://utcc.utoronto.ca/~cks/space/blog/tech/OpenSSHVersusSSH"
              >OpenSSH versus SSH</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-16 @ 07:19:56</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35587981"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35583525">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/interactive/2023/04/14/arts/design/tres-riches-heures-calendar.html"
              >Searching for Lost Time in the World’s Most Beautiful Calendar</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-15 @ 19:00:43</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35583525"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35580061">
          <h3>
            <a class="item" href="https://geometry-central.net/"
              >Geometry Central: library of data structures, algorithms for
              geometry processing</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-15 @ 12:34:30</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35580061"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
