<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43971716">
          <h3>
            <a
              class="item"
              href="https://www.openwall.com/lists/oss-security/2025/05/12/1"
              >Multiple Security Issues in GNU Screen</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-13 @ 11:28:49</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43971716"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43971464">
          <h3>
            <a
              class="item"
              href="https://twitter.com/ID_AA_Carmack/status/1922100771392520710"
              >The world could run on older hardware if software optimization
              was a priority</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-13 @ 10:31:09</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43971464"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43970959">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2025/05/13/nextcloud_play_store_complaint/"
              >Nextcloud cries foul over Google Play Store app rejection</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-13 @ 09:02:02</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43970959"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43970837">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=43970837"
              >Ask HN: How are you acquiring your first hundred users?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-13 @ 08:41:25</span
              ><span class="points-container"
                >Points: <span class="points">162</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43970837"
                  >Comments</a
                ><span class="descendants">: 105</span></span
              >
            </h4>
            <div class="text">
              <p>
                What we are currently doing: 1) Cold outreach to power users -
                to convert them into affiliates. 2) Cold outreach to individuals
                who have target ICP communities. 3) SEO for more long term (not
                for the first 500)
              </p>
            </div>
          </section>
        </section>
        <section id="43970800">
          <h3>
            <a
              class="item"
              href="https://zylinski.se/posts/a-programming-language-for-me/"
              >A programming language made for me</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-13 @ 08:35:11</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43970800"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43970637">
          <h3>
            <a
              class="item"
              href="https://erratique.ch/writings/anti-personnel-computing"
              >Anti-Personnel Computing (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-13 @ 08:06:59</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43970637"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43970363">
          <h3>
            <a
              class="item"
              href="https://admiralcloudberg.medium.com/trial-by-fire-the-crash-of-aeroflot-flight-1492-ee61cebcf6ec"
              >Trial by Fire: The crash of Aeroflot flight 1492</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-13 @ 07:12:54</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43970363"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43969827">
          <h3>
            <a class="item" href="https://github.com/mozilla-firefox/firefox"
              >Mozilla Firefox â€“ Official GitHub repo</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-13 @ 05:23:10</span
              ><span class="points-container"
                >Points: <span class="points">560</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43969827"
                  >Comments</a
                ><span class="descendants">: 313</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43969442">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2502.07864"
              >TransMLA: Multi-head latent attention is all you need</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-13 @ 03:29:47</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43969442"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43968897">
          <h3>
            <a class="item" href="https://github.com/apple/ml-fastvlm"
              >FastVLM: Efficient vision encoding for vision language models</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-13 @ 01:16:02</span
              ><span class="points-container"
                >Points: <span class="points">292</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43968897"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43968141">
          <h3>
            <a
              class="item"
              href="https://github.com/meshula/LabMidi/blob/main/LabMuse/imuse-technical.md"
              >Understanding LucasArts' iMUSE System</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-12 @ 22:41:30</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43968141"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43966843">
          <h3>
            <a
              class="item"
              href="https://www.lanl.gov/media/publications/1663/0125-qa-jason-pruet"
              >A conversation about AI for science with Jason Pruet</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-12 @ 19:52:40</span
              ><span class="points-container"
                >Points: <span class="points">153</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43966843"
                  >Comments</a
                ><span class="descendants">: 136</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43966089">
          <h3>
            <a class="item" href="https://wts.dev/posts/tcc-who/"
              >Can you trust that permission pop-up on macOS?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-12 @ 18:26:44</span
              ><span class="points-container"
                >Points: <span class="points">318</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43966089"
                  >Comments</a
                ><span class="descendants">: 212</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43965608">
          <h3>
            <a class="item" href="https://openai.com/index/healthbench/"
              >HealthBench â€“ An evaluation for AI systems and human health</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-12 @ 17:42:37</span
              ><span class="points-container"
                >Points: <span class="points">160</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43965608"
                  >Comments</a
                ><span class="descendants">: 134</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43964827">
          <h3>
            <a
              class="item"
              href="https://bcantrill.dtrace.org/2025/05/11/rip-usenix-atc/"
              >RIP Usenix ATC</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-12 @ 16:29:05</span
              ><span class="points-container"
                >Points: <span class="points">176</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43964827"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43964505">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=43964505"
              >Launch HN: ParaQuery (YC X25) â€“ GPU Accelerated Spark/SQL</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-12 @ 16:01:31</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43964505"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
            <div class="text">
              <a href="https://paraquery.com">https://paraquery.com</a>), a
              fully-managed, GPU-accelerated Spark + SQL solution. We deliver
              BigQuery's ease of use (or easier) while being significantly more
              cost-efficient and performant.
              <p>
                Here's a short demo video demonstrating ParaQuery (vs. BigQuery)
                on a simple ETL job:
                <a href="https://www.youtube.com/watch?v=uu379YnccGU"
                  >https://www.youtube.com/watch?v=uu379YnccGU</a
                >
              </p>
              <p>
                It's well known that GPUs are very good for many SQL and
                dataframe tasks, at least by researchers and GPU companies like
                NVIDIA. So much so that, in 2018, NVIDIA launched the RAPIDS
                program and the Spark-RAPIDS plugin (<a
                  href="https://github.com/NVIDIA/spark-rapids"
                  >https://github.com/NVIDIA/spark-rapids</a
                >). I actually found out because, at the time, I was trying to
                craft a CUDA-based lambda calculus interpreterâ€¦one of several
                ideas I didn't manage to implement, haha.
              </p>
              <p>
                There seems to be a perception among at least some engineers
                that GPUs are only good for AI, graphics, and maybe image
                processing (maybe! someone actually told me they thought GPUs
                are bad for image processing!) Traditional data processing
                doesnâ€™t come to mind. But actually GPUs are good for this as
                well!
              </p>
              <p>
                At a high level, big data processing is a high-throughput,
                massively parallel workload. GPUs are a type of hardware
                specialized for this, are highly programmable, and (now) happen
                to be highly available on the cloud! Even better, GPU
                <i>memory</i> is tuned for bandwidth over raw latency, which
                only improves their throughput capabilities compared to a CPU.
                And by just playing with cloud cost calculators for a couple of
                minutes, it's clear that GPUs are cost-effective even on the
                major clouds.
              </p>
              <p>
                To be honest, I thought using GPUs for SQL processing would have
                taken off by now, but it hasn't. So, just over a year ago, I
                started working on actually deploying a cloud-based data
                platform powered by GPUs (i.e. Spark-RAPIDS), spurred by a
                friend-of-a-friend(-of-a-friend) who happened to have BigQuery
                cost concerns at his startup. After getting a proof of concept
                done and a letter of intent... well, nothing happened! Even
                after over half a year. But then, something magical did happen:
                their cloud credits ran out!
              </p>
              <p>
                And now, they're saving over 60% off of their BigQuery bill by
                using ParaQuery, while also being 2x faster -- with zero data
                migration needed (courtesy of Spark's GCS connector). By the
                way, I'm not sure about other people's experiences but... we're
                pretty far from being IO-bound (to the surprise of many
                engineers I've spoken to).
              </p>
              <p>
                I think that the future of high-throughput compute is computing
                on high-throughput hardware. If you think so too, or you have
                scaling data challenges, you can sign up here:
                <a href="https://paraquery.com/waitlist"
                  >https://paraquery.com/waitlist</a
                >. Sorry for the waitlist, but we're not ready for a self-serve
                experience just yetâ€”it would front-load significant engineering
                and hardware cost. But weâ€™ll get there, so stay tuned!
              </p>
              <p>
                Thanks for reading! What have your experiences been with huge
                ETL / processing loads? Was cost or performance an issue? And
                what do you think about GPU acceleration (GPGPU)? Did you think
                GPUs were simply expensive? Would love to just talk about tech
                here!
              </p>
            </div>
          </section>
        </section>
        <section id="43964136">
          <h3>
            <a class="item" href="https://arslan.io/2025/05/12/barbican-estate/"
              >The Barbican</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-12 @ 15:28:38</span
              ><span class="points-container"
                >Points: <span class="points">599</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43964136"
                  >Comments</a
                ><span class="descendants">: 225</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43963397">
          <h3>
            <a
              class="item"
              href="https://www.core77.com/posts/136773/Reviving-a-Modular-Cargo-Bike-Design-from-the-1930s"
              >Reviving a modular cargo bike design from the 1930s</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-12 @ 14:29:33</span
              ><span class="points-container"
                >Points: <span class="points">205</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43963397"
                  >Comments</a
                ><span class="descendants">: 165</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43962770">
          <h3>
            <a class="item" href="https://bugs.ruby-lang.org/issues/21311"
              >Ruby 3.5 Feature: Namespace on read</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-12 @ 13:39:34</span
              ><span class="points-container"
                >Points: <span class="points">212</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43962770"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43962148">
          <h3>
            <a
              class="item"
              href="https://news.utexas.edu/2025/05/05/university-of-texas-led-team-solves-a-big-problem-for-fusion-energy/"
              >University of Texas-led team solves a big problem for fusion
              energy</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-12 @ 12:21:33</span
              ><span class="points-container"
                >Points: <span class="points">262</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43962148"
                  >Comments</a
                ><span class="descendants">: 172</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43961908">
          <h3>
            <a class="item" href="https://www.comaps.app/news/2025-05-12/3/"
              >A community-led fork of Organic Maps</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-12 @ 11:40:24</span
              ><span class="points-container"
                >Points: <span class="points">313</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43961908"
                  >Comments</a
                ><span class="descendants">: 198</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43958562">
          <h3>
            <a
              class="item"
              href="https://computer.rip/2025-05-11-air-traffic-control.html"
              >Air Traffic Control</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-12 @ 00:39:22</span
              ><span class="points-container"
                >Points: <span class="points">203</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43958562"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43957140">
          <h3>
            <a class="item" href="https://www.why.is/svar.php?id=5513"
              >Why are coffee stains darker at the edges?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-11 @ 21:03:09</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43957140"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43944007">
          <h3>
            <a
              class="item"
              href="https://alvinng4.github.io/grav_sim/5_steps_to_n_body_simulation/"
              >Writing N-body gravity simulations code in Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-10 @ 08:10:18</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43944007"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43943942">
          <h3>
            <a
              class="item"
              href="https://www.ctrl-alt-test.fr/2025/15-years-of-shader-minification/"
              >15 Years of Shader Minification</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-10 @ 07:51:30</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43943942"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43943666">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/features/2025-05-09/microsoft-s-hacker-hunters-inside-the-secretive-mstic-unit"
              >The Microsoft unit working to thwart hackers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-10 @ 06:42:50</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43943666"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43937151">
          <h3>
            <a class="item" href="https://www.alephic.com/company/writing"
              >Alephic Writing Style Guide</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-09 @ 14:25:26</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43937151"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43936661">
          <h3>
            <a class="item" href="https://css-tricks.com/revisiting-image-maps/"
              >Revisiting Image Maps</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-09 @ 13:44:04</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43936661"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43934869">
          <h3>
            <a
              class="item"
              href="https://serd.es/2025/05/08/Switch-project-pt1.html"
              >Open Hardware Ethernet Switch project, part 1</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-09 @ 08:34:56</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43934869"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43934682">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-025-01246-1"
              >How to avoid P hacking</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-09 @ 07:53:54</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43934682"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
