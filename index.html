<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42874885">
          <h3>
            <a
              class="item"
              href="https://lcamtuf.substack.com/p/pcbs-ground-planes-and-you"
              >PCBs, copper pours, ground planes, and you</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-30 @ 04:33:25</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42874885"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42874605">
          <h3>
            <a
              class="item"
              href="https://matklad.github.io/2022/10/06/hard-mode-rust.html"
              >Hard Mode Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-30 @ 03:46:29</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42874605"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42874301">
          <h3>
            <a
              class="item"
              href="https://www.mediaite.com/news/breaking-commercial-jet-collides-with-police-chopper-near-reagan-airport/"
              >Commercial jet collides with Black Hawk helicopter near Reagan
              airport</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-30 @ 02:56:45</span
              ><span class="points-container"
                >Points: <span class="points">318</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42874301"
                  >Comments</a
                ><span class="descendants">: 253</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42873825">
          <h3>
            <a class="item" href="https://mahaloz.re/dec-progress-2024"
              >Decompiling 2024: A Year of Resurgance in Decompilation
              Research</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-30 @ 01:48:17</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42873825"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42873532">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42873532"
              >Etleap (YC W13) Is Hiring a Senior Software Engineer (SF)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-30 @ 01:02:03</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
            <div class="text">
              <p>San Francisco (in person)</p>
              <p>
                At Etleap, we’re redefining how data teams build and manage data
                pipelines. Our no-code/low-code ETL platform allows seamless
                integration of data from any source — whether databases,
                applications, or files — into lakehouses like Snowflake,
                Databricks, and Redshift. With pipelines that "just work" and
                features like advanced data transformation using dbt Core and
                end-to-end pipeline observability, we’re focused on making
                robust data pipelines accessible to everyone.
              </p>
              <p>
                We are looking to add senior engineers to our core engineering
                team to build the infrastructure that modern data teams depend
                on to create and operate their analytics infrastructure! It
                shouldn’t take a CS degree to build great data pipelines, and
                abstracting away the difficult parts is our mission.
              </p>
              <p>What you are going to do:</p>
              <p>
                - Solve challenging engineering problems related to the
                performance and robustness of distributed systems infrastructure
                - Come up with novel ideas on how to make complex data
                technology user-friendly, and then turn those ideas into
                software - Collaborate on the design and development of the next
                generation of ETL/ELT infrastructure that prioritizes
                user-friendliness and flexibility
              </p>
              <p>What we want to see in you:</p>
              <p>
                - 5+ years of experience as a backend software engineer, with a
                focus on distributed systems and data infrastructure - You are
                drawn to and have experience solving challenging engineering
                problems - Mastery in Java and a passion for building scalable,
                reliable systems - You thrive in a fast-paced startup
                environment - You’re down to earth and fun to be around. This is
                an absolute must! - Based in or willing to relocate to San
                Francisco
              </p>
              <p>Big plus if you have the following:</p>
              <p>
                - Experience in a startup environment where you’ve helped build
                infrastructure from the ground up. - Familiarity with AWS
                services like S3, EMR, and technologies like Terraform and
                Docker. - Know the ins and outs of current big data frameworks
                like Spark or Flink, but this is not an absolute requirement -
                you’re a quick learner!
              </p>
              <p>
                This role is open to individuals based in or willing to relocate
                to San Francisco
              </p>
              <p>To apply, send your resume to jobs@etleap.com</p>
            </div>
          </section>
        </section>
        <section id="42873476">
          <h3>
            <a class="item" href="https://jslegend.itch.io/duck-hunter"
              >Classic Duck Hunt game made in JavaScript and Kaplay</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-30 @ 00:53:21</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42873476"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42873312">
          <h3>
            <a
              class="item"
              href="https://github.com/mathesar-foundation/mathesar"
              >Mathesar – an intutive spreadsheet-like interface to Postgres
              data</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-30 @ 00:31:53</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42873312"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42873153">
          <h3>
            <a
              class="item"
              href="https://github.com/marketplace/actions/feed-to-bluesky"
              >Blueskyfeedbot: Post RSS Feeds to Bluesky via GitHub Actions</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-30 @ 00:12:49</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42873153"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42872548">
          <h3>
            <a
              class="item"
              href="https://resobscura.substack.com/p/when-the-sackler-brothers-studied"
              >When the Sackler brothers studied LSD</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-29 @ 23:12:01</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42872548"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42872276">
          <h3>
            <a class="item" href="https://www.henrikkarlsson.xyz/p/start-a-blog"
              >Advice for a friend who wants to start a blog</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-29 @ 22:45:14</span
              ><span class="points-container"
                >Points: <span class="points">166</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42872276"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42871743">
          <h3>
            <a
              class="item"
              href="https://thenewstack.io/from-c-to-clojure-new-language-promises-best-of-both/"
              >From C++ to Clojure: Jank language promises best of both</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-29 @ 21:56:11</span
              ><span class="points-container"
                >Points: <span class="points">154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42871743"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42871371">
          <h3>
            <a
              class="item"
              href="https://www.wiz.io/blog/wiz-research-uncovers-exposed-deepseek-database-leak"
              >Exposed DeepSeek database leaking sensitive information,
              including chat history</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-29 @ 21:25:36</span
              ><span class="points-container"
                >Points: <span class="points">544</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42871371"
                  >Comments</a
                ><span class="descendants">: 355</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42871143">
          <h3>
            <a
              class="item"
              href="https://www.chriis.dev/opinion/parsing-pdfs-in-elixir-using-rust"
              >Parsing PDFs (and more) in Elixir using Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-29 @ 21:05:28</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42871143"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42871040">
          <h3>
            <a class="item" href="https://github.com/houmain/keymapper"
              >Keymapper: A cross-platform context-aware key remapper</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-29 @ 20:55:49</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42871040"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42870690">
          <h3>
            <a
              class="item"
              href="https://wiki.c2.com/?SovietShoeFactoryPrinciple"
              >Soviet Shoe Factory Principle</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-29 @ 20:26:01</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42870690"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42870171">
          <h3>
            <a class="item" href="https://airflow.app/"
              >Airflow – Stream media files directly from macOS to AirPlay
              devices</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-29 @ 19:47:51</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42870171"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42868770">
          <h3>
            <a class="item" href="https://github.com/Om-Alve/smolGPT"
              >SmolGPT: A minimal PyTorch implementation for training a small
              LLM from scratch</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-29 @ 18:09:19</span
              ><span class="points-container"
                >Points: <span class="points">277</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42868770"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42868464">
          <h3>
            <a
              class="item"
              href="https://vetmed.illinois.edu/i-tick/2019/08/09/iceman-lyme-mummy-tattle-the-tick-blog/"
              >Ötzi the Lyme Mummy (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-29 @ 17:49:16</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42868464"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42868390">
          <h3>
            <a
              class="item"
              href="https://arcprize.org/blog/r1-zero-r1-results-analysis"
              >An analysis of DeepSeek's R1-Zero and R1</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-29 @ 17:44:45</span
              ><span class="points-container"
                >Points: <span class="points">518</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42868390"
                  >Comments</a
                ><span class="descendants">: 199</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42867657">
          <h3>
            <a class="item" href="https://www.instantdb.com/essays/pg_upgrade"
              >A major Postgres upgrade with zero downtime</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-29 @ 16:57:59</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42867657"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42866572">
          <h3>
            <a
              class="item"
              href="https://ebpf.foundation/case-study-bytedance-uses-ebpf-to-enhance-networking-performance/"
              >Case Study: ByteDance Uses eBPF to Enhance Networking
              Performance</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-29 @ 15:58:20</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42866572"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42864272">
          <h3>
            <a
              class="item"
              href="https://cneos.jpl.nasa.gov/sentry/details.html#?des=2024%20YR4"
              >Asteroid Impact on Earth 2032 with Probability 1% and 8Mt
              Energy</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-29 @ 12:47:17</span
              ><span class="points-container"
                >Points: <span class="points">317</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42864272"
                  >Comments</a
                ><span class="descendants">: 241</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42862873">
          <h3>
            <a
              class="item"
              href="https://utcc.utoronto.ca/~cks/space/blog/spam/WellPreparedPhishSpammer"
              >We got hit by an alarmingly well-prepared phish spammer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-29 @ 08:43:34</span
              ><span class="points-container"
                >Points: <span class="points">176</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42862873"
                  >Comments</a
                ><span class="descendants">: 112</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42862246">
          <h3>
            <a
              class="item"
              href="https://ohdoylerules.com/workflows/why-i-still-like-sublime-text-in-2025/"
              >I still like Sublime Text</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-29 @ 06:43:43</span
              ><span class="points-container"
                >Points: <span class="points">1032</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42862246"
                  >Comments</a
                ><span class="descendants">: 533</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42861475">
          <h3>
            <a
              class="item"
              href="https://www.ft.com/content/a0dfedd1-5255-4fa9-8ccc-1fe01de87ea6"
              >OpenAI says it has evidence DeepSeek used its model to train
              competitor</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-29 @ 04:21:20</span
              ><span class="points-container"
                >Points: <span class="points">574</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42861475"
                  >Comments</a
                ><span class="descendants">: 1355</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42854291">
          <h3>
            <a
              class="item"
              href="https://andrewchilds.com/posts/building-a-t1d-smartwatch-from-scratch"
              >Building a T1D smartwatch for my son from scratch</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-28 @ 16:33:32</span
              ><span class="points-container"
                >Points: <span class="points">321</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42854291"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42835424">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2025-01-edges-images.html"
              >Detecting edges of images at the speed of light</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-26 @ 23:28:13</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42835424"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42834325">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42834325"
              >Show HN: TinyJs React like framework in 35 lines of code</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-26 @ 21:28:23</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42834325"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
            <div class="text">
              <p>
                I end up creating a simple App to illustrate how to use the new
                createState function and custom components in a React like
                manner. Here's the code for it -
                <a href="https://github.com/victorqribeiro/tinyapp"
                  >https://github.com/victorqribeiro/tinyapp</a
                >
              </p>
              <p>
                Here's the PR for the createState function -
                <a href="https://github.com/victorqribeiro/TinyJS/pull/9"
                  >https://github.com/victorqribeiro/TinyJS/pull/9</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="42830948">
          <h3>
            <a
              class="item"
              href="https://codeinsecurity.wordpress.com/2025/01/25/proper-decoupling-practices-and-why-you-should-leave-100nf-behind/"
              >Proper decoupling capacitor practices, and why you should leave
              100nF behind</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-26 @ 16:00:50</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42830948"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42830478">
          <h3>
            <a
              class="item"
              href="https://components.one/posts/gamer-and-nihilist-product-hunt"
              >Analysis of 76,882 Product Hunt Products, from 2014 – 2021</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-26 @ 14:59:26</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42830478"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
