<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41766954">
          <h3>
            <a class="item" href="https://xkcd.com/1172/"
              >Every change breaks someone's workflow</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 15:24:49</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41766954"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41766610">
          <h3>
            <a
              class="item"
              href="https://www.bleepingcomputer.com/news/security/atandt-verizon-reportedly-hacked-to-target-us-govt-wiretapping-platform/"
              >AT&amp;amp;T, Verizon reportedly hacked to target US govt
              wiretapping platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 14:53:33</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41766610"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41766515">
          <h3>
            <a
              class="item"
              href="https://blog.appsignal.com/2024/10/07/whats-new-in-ruby-on-rails-8.html"
              >What's New in Ruby on Rails 8</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 14:45:12</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41766515"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41766293">
          <h3>
            <a
              class="item"
              href="https://www.dreamsongs.com/RiseOfWorseIsBetter.html"
              >The Rise of Worse Is Better (1991)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 14:22:45</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41766293"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41766216">
          <h3>
            <a class="item" href="https://github.com/thorfdbg/rkrm-dos"
              >An RKRM-style reference of AmigaDOS/dos.library</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 14:13:46</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41766216"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41766144">
          <h3>
            <a class="item" href="https://github.com/THUDM/LongWriter"
              >Longwriter – Increase llama3.1 output to 10k words</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 14:05:05</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41766144"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41766035">
          <h3>
            <a
              class="item"
              href="https://docs.python.org/3.13/whatsnew/3.13.html"
              >Python 3.13.0 Is Released</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 13:53:47</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41766035"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41765904">
          <h3>
            <a
              class="item"
              href="https://carstenfuehrmann.org/lectures/computability-10.pdf"
              >Abacus Machines [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 13:39:23</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41765904"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41765734">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/2024/10/14/silicon-valley-the-new-lobbying-monster"
              >Silicon Valley, the New Lobbying Monster</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 13:21:54</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41765734"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41765716">
          <h3>
            <a
              class="item"
              href="https://www.da.vidbuchanan.co.uk/blog/dram-emfi.html"
              >Can You Get Root with Only a Cigarette Lighter?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 13:20:19</span
              ><span class="points-container"
                >Points: <span class="points">175</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41765716"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41765580">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/fukushima-reactor"
              >Fukushima Reactor: TEPCO robot aims to extract nuclear fuel</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 13:01:09</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41765580"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41765459">
          <h3>
            <a
              class="item"
              href="https://torrentfreak.com/isps-betrayed-over-pirate-site-blocking-threats-the-reckoning-will-be-invisible-241005/"
              >New Italian Law Threatens ISPs with Prison over Piracy Reporting
              Failures</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 12:44:40</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41765459"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41765435">
          <h3>
            <a
              class="item"
              href="https://docs.hetzner.com/storage/object-storage/"
              >Hetzner Object Storage</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 12:41:50</span
              ><span class="points-container"
                >Points: <span class="points">196</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41765435"
                  >Comments</a
                ><span class="descendants">: 122</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41765409">
          <h3>
            <a class="item" href="https://github.com/archiewood/gosql"
              >GoSQL: A query engine in 319 LoC</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 12:39:15</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41765409"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41765395">
          <h3>
            <a class="item" href="https://serverlessai.dev/"
              >Show HN: ServerlessAI – Build, scale, and monetize AI apps
              without back end</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 12:37:38</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41765395"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
            <div class="text">
              <p>
                I’ve always loved building frontend-only apps—those you can
                prototype over a weekend, host for free on GitHub Pages, and
                scale to millions of users. Unfortunately, AI-enabled apps
                complicate things, as exposing your OpenAI key to the world is
                obviously a no-go. This also means mobile developers often have
                to run their own servers.
              </p>
              <p>
                That’s why I built ServerlessAI, an API gateway that lets you
                securely call multiple AI providers directly from client side
                using OpenAI-compatible APIs. You can authenticate users through
                any identity provider, like Google or Apple, and set per-user
                request or spending quotas. You can also define an allowlist for
                endpoints and models. To monetize, you can apply different
                quotas for various user tiers.
              </p>
              <p>
                To start, I recommend checking out our tutorials, where we walk
                you through building a complete, deployment-ready AI app in 5
                minutes. We’ve got tutorials for React, Next.js, and iOS:
                <a href="https://serverlessai.dev/docs/tutorials/"
                  >https://serverlessai.dev/docs/tutorials/</a
                >
              </p>
              <p>
                Our long term vision is to offer the best toolkit for AI
                developers at every stage of their project’s lifecycle. If
                OpenAI / Anthropic / etc are AWS, we want to be the Supabase /
                Upstash / etc. We are building optional out-of-box tools for
                authentication and payment management, so you can roll out your
                prototype faster. In the future, we want to provide the best
                prompt engineering tools for fine-tuning, A/B testing, and
                backtesting, as well as the best observability tools.
              </p>
              <p>We’d love to hear your feedback. Thanks for stopping by!</p>
            </div>
          </section>
        </section>
        <section id="41765334">
          <h3>
            <a
              class="item"
              href="https://www.npr.org/sections/goats-and-soda/2024/10/05/g-s1-6411/electronics-public-health-waste-ghana-phones-computers"
              >Photos of an e-waste dumping ground</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 12:30:07</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41765334"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41765138">
          <h3>
            <a
              class="item"
              href="https://jobs.ashbyhq.com/permitflow?departmentId=d33195eb-8978-4439-abc6-5a8a072de808"
              >PermitFlow (YC W22) Is Hiring Senior/Staff Engineers in NYC</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 12:00:14</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41764635">
          <h3>
            <a
              class="item"
              href="https://chromewebstore.google.com/detail/aria-devtools/dneemiigcbbgbdjlcdjjnianlikimpck"
              >Show HN: Visualization of website accessibility tree</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 10:38:36</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41764635"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
            <div class="text">
              <p>
                I've spend two months delivering a tool that is easy to
                understand and helps catching accessibility issues on my apps. A
                few years later it's pretty popular despite being mostly
                abandoned.
              </p>
              <p>
                I will be happy to work on this further but honestly lost my
                enthusiasm some time ago. I'd love to get in touch with some
                company in the accessibility testing space and discuss how to
                improve it.
              </p>
            </div>
          </section>
        </section>
        <section id="41764486">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/this-homemade-ai-drone-software-finds-bodies-when-search-and-rescue-teams-cant/"
              >Homemade AI Drone Software Finds People When Search and Rescue
              Teams Can't</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 10:12:42</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41764486"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41764283">
          <h3>
            <a
              class="item"
              href="https://www.nobelprize.org/prizes/medicine/2024/summary/"
              >The Nobel Prize in Physiology or Medicine 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 09:37:09</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41764283"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41762468">
          <h3>
            <a class="item" href="https://aarol.dev/posts/go-contentlength/"
              >How do HTTP servers figure out Content-Length?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 03:18:04</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41762468"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41761986">
          <h3>
            <a
              class="item"
              href="https://www.scattered-thoughts.net/writing/smolderingly-fast-btrees/"
              >Fast B-Trees</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-07 @ 01:42:57</span
              ><span class="points-container"
                >Points: <span class="points">193</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41761986"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41760697">
          <h3>
            <a class="item" href="https://sq.io"
              >Sq.io: jq for databases and more</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-06 @ 22:02:34</span
              ><span class="points-container"
                >Points: <span class="points">526</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41760697"
                  >Comments</a
                ><span class="descendants">: 108</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41759112">
          <h3>
            <a
              class="item"
              href="https://arnaud-carre.github.io/2024-10-06-vpternlogd/"
              >AVX Bitwise ternary logic instruction busted</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-06 @ 18:38:26</span
              ><span class="points-container"
                >Points: <span class="points">292</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41759112"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41757722">
          <h3>
            <a
              class="item"
              href="https://www.openculture.com/2024/09/the-medieval-masterpiece-the-book-of-kells-is-now-digitized-and-available-online.html"
              >The Book of Kells, now digitized and available online</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-06 @ 15:19:15</span
              ><span class="points-container"
                >Points: <span class="points">384</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41757722"
                  >Comments</a
                ><span class="descendants">: 96</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41756484">
          <h3>
            <a
              class="item"
              href="https://pncnmnp.github.io/blogs/typewriter-uncle-sam.html"
              >We'll buy back your Typewriter for Uncle Sam</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-06 @ 11:55:15</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41756484"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41748519">
          <h3>
            <a class="item" href="https://github.com/cepa/aegir-gps-tracker"
              >Show HN: I built a Iridium/LTE satellite GPS tracker and took it
              to the Arctic</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-05 @ 08:36:31</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41748519"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41734672">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/science/2024/10/ants-fungus-agriculture-traced-back-to-dinosaur-killing-impact/"
              >Ants learned to farm fungi during a mass extinction</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-03 @ 20:32:38</span
              ><span class="points-container"
                >Points: <span class="points">190</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41734672"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41732068">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41732068"
              >Show HN: I have published a mobile HN client to have coffee chat
              with HN users</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-03 @ 16:13:44</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41732068"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
            <div class="text">
              <p>
                There was already a guy who made a website for this, but I
                wanted to do it in mobile to practice WebRTC(technology behind
                the audio chat) and have some fun.
              </p>
              <p>
                I haven't spent too much time in terms of the general
                functionality as a HN client but can upgrade it if there are
                enough users enjoying the app.
              </p>
              <p>You can download the apps via the links below;</p>
              <p>
                IOS:
                <a
                  href="https://apps.apple.com/tr/app/betternews-coffee-chat/id6504711182"
                  >https://apps.apple.com/tr/app/betternews-coffee-chat/id65047...</a
                >
              </p>
              <p>Android:</p>
              <p>
                As you might have known, Android requires the app to be tested
                in a closed beta with at least 20 people So you can follow these
                steps to be a part of it and download;
              </p>
              <p>
                1 - join the group
                <a href="https://groups.google.com/g/betternews"
                  >https://groups.google.com/g/betternews</a
                >
              </p>
              <p>2 - download the app and enjoy</p>
              <p>
                <a
                  href="https://play.google.com/store/apps/details?id=com.apps.betternews"
                  >https://play.google.com/store/apps/details?id=com.apps.bette...</a
                >
                or
                <a
                  href="https://play.google.com/apps/testing/com.apps.betternews"
                  >https://play.google.com/apps/testing/com.apps.betternews</a
                >
              </p>
              <p>
                Feel free to contact me if you have any questions;
                <a href="http://www.x.com/canergly"
                  >http://www.x.com/canergly</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="41729765">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/hubble-space-telescope-re-invention"
              >NASA Made the Hubble Telescope to Be Remade</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-03 @ 11:49:56</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41729765"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
