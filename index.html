<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41645970">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/articles/cn5zx2zx5xvo"
              >Europe's deadly floods are glimpse of future climate</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-25 @ 11:01:05</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41645970"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41645804">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-09-sweet-machine-reveals-factors-successful.html"
              >Machine learning reveals factors for successful crowdfunding</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-25 @ 10:31:00</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41645804"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41645736">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2024/09/24/openai-rolls-out-advanced-voice-mode-with-more-voices-and-a-new-look/"
              >OpenAI rolls out Advanced Voice Mode with more voices and a new
              look</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-25 @ 10:22:00</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41645736"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41645320">
          <h3>
            <a
              class="item"
              href="https://vivaldi.com/blog/social-web-foundation-launches-supported-by-vivaldi/"
              >Social Web Foundation launches, supported by Vivaldi</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-25 @ 09:00:15</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41645320"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41643810">
          <h3>
            <a class="item" href="https://fred.org.nz/"
              >FRED: New Zealand open-access and crowdsource database of fossil
              records</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-25 @ 04:52:56</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41643810"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41643690">
          <h3>
            <a class="item" href="https://tamulaitis.lt/project/dialrhea/"
              >Doom on a modified rotary phone</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-25 @ 04:29:07</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41643690"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41642969">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=YSgTQzHYeLU"
              >Insights after 11 years with Datomic [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-25 @ 02:05:12</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41642969"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41642487">
          <h3>
            <a class="item" href="https://hack-gpon.org/"
              >Hack GPON – how to access, change and edit fibre ONTs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-25 @ 00:41:05</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41642487"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41642151">
          <h3>
            <a class="item" href="https://github.com/cozis/blogtech"
              >Show HN: Hosting my website using my C web server</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-24 @ 23:39:30</span
              ><span class="points-container"
                >Points: <span class="points">207</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41642151"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41641274">
          <h3>
            <a
              class="item"
              href="https://journals.plos.org/plosmedicine/article?id=10.1371/journal.pmed.0020124"
              >Why Most Published Research Findings Are False (2005)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-24 @ 21:45:50</span
              ><span class="points-container"
                >Points: <span class="points">180</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41641274"
                  >Comments</a
                ><span class="descendants">: 199</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41640845">
          <h3>
            <a
              class="item"
              href="https://www.seroundtable.com/google-cache-dead-38112.html"
              >Google Cache is fully dead</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-24 @ 20:59:53</span
              ><span class="points-container"
                >Points: <span class="points">300</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41640845"
                  >Comments</a
                ><span class="descendants">: 160</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41640812">
          <h3>
            <a
              class="item"
              href="https://github.com/okhat/blog/blob/main/2024.09.impact.md"
              >On Impactful AI Research</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-24 @ 20:56:29</span
              ><span class="points-container"
                >Points: <span class="points">194</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41640812"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41640005">
          <h3>
            <a
              class="item"
              href="https://new.mta.info/article/beyond-route-introducing-granular-mta-bus-speed-data"
              >Beyond the route: Introducing granular MTA bus speed data</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-24 @ 19:26:03</span
              ><span class="points-container"
                >Points: <span class="points">184</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41640005"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41639980">
          <h3>
            <a
              class="item"
              href="https://www.lrb.co.uk/the-paper/v46/n18/rosemary-hill/at-the-musee-des-arts-decoratifs"
              >Death of the Department Store</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-24 @ 19:23:41</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41639980"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41638581">
          <h3>
            <a class="item" href="https://ijc8.me/2024/08/26/gsoc-difflogic/"
              >GSoC'24: Differentiable Logic for Interactive Systems and
              Generative Music</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-24 @ 17:02:24</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41638581"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41638199">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41638199"
              >Launch HN: Modern Realty (YC S24) – AI Real Estate Agent for Home
              Buyers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-24 @ 16:23:35</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41638199"
                  >Comments</a
                ><span class="descendants">: 265</span></span
              >
            </h4>
            <div class="text">
              <a href="https://modernrealty.io">https://modernrealty.io</a>).
              Modern Realty is an AI-powered real estate buying experience that
              helps you purchase homes without relying on a traditional realtor.
              Demo:
              <a href="https://youtu.be/VhsWSVn5blA"
                >https://youtu.be/VhsWSVn5blA</a
              >
              <p>
                Our mission at Modern Realty is to make home buying easier,
                faster, and far more enjoyable. We interpret real estate data,
                giving you an edge on other home buyers.
              </p>
              <p>
                Since 2024, there has been a growing need for innovative
                solutions in real estate, especially with tools like Zillow
                making it easier than ever for buyers to find the right house at
                the right price. However, the process still requires an agent,
                even though buyers are doing most of the work themselves. Modern
                Realty changes this by offering an AI self-service solution.
              </p>
              <p>
                Raymond and Raffi came face-to-face with this technology's
                potential while working on AI at Google and handling
                billion-dollar asset transactions as an attorney, respectively.
                The AI tools we've built guide users through every step of the
                home-buying process, from scheduling showings to making offers,
                all without the need for a traditional agent.
              </p>
              <p>
                Before we expand further, this summer we've built our core AI
                real estate agent, which can handle everything from disclosure
                summaries to competitive market analyses. You can see our
                platform in action at
                <a href="https://modernrealty.io">https://modernrealty.io</a>.
                We're particularly proud of our offer generation tool, which
                creates offers that are then reviewed by an attorney at no
                additional cost.
              </p>
              <p>
                We're excited to be launching here on HN and would love to hear
                what you think! If you're in the market for a new home or just
                curious about the future of real estate, visit our website or
                schedule a call with us to get started.
              </p>
            </div>
          </section>
        </section>
        <section id="41637550">
          <h3>
            <a class="item" href="https://www.usevelvet.com"
              >Show HN: Velvet – Store OpenAI requests in your own DB</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-24 @ 15:25:52</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41637550"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.usevelvet.com">https://www.usevelvet.com</a
              >).
              <p>
                Velvet proxies OpenAI calls and stores the requests and
                responses in your PostgreSQL database. That way, you can analyze
                logs with SQL (instead of a clunky UI). You can also set headers
                to add caching and metadata (for analysis).
              </p>
              <p>
                Backstory: We started by building some more general AI data
                tools (like a text-to-SQL editor). We were frustrated by the
                lack of basic LLM infrastructure, so ended up pivoting to focus
                on the tooling we wanted. So many existing apps, like Helicone,
                were hard to use as power users. We just wanted a database.
              </p>
              <p>
                Scale: We’ve already warehoused 50m requests for customers, and
                have optimized the platform for scale and latency. We’ve built
                the proxy on Cloudflare Workers, and latency is nominal. We’ve
                built some “yak shaving” features that were really complex such
                as decomposing OpenAI Batch API requests so you can track each
                log individually. One of our early customers (<a
                  href="https://usefind.ai/"
                  >https://usefind.ai/</a
                >) makes millions of OpenAI requests per day, up to 1500
                requests per second.
              </p>
              <p>
                Vision: We’re trying to build development tools that have as
                little UI as possible, that can be controlled entirely with
                headers and code. We also want to blend cloud and on-prem for
                the best of both worlds — allowing for both automatic updates
                and complete data ownership.
              </p>
              <p>Here are some things you can do with Velvet logs:</p>
              <p>- Observe requests, responses, and latency</p>
              <p>- Analyze costs by metadata, such as user ID</p>
              <p>- Track batch progress and speed</p>
              <p>- Evaluate model changes</p>
              <p>- Export datasets for fine-tuning of gpt-4o-mini</p>
              <p>
                (this video shows how to do each of those:
                <a href="https://www.youtube.com/watch?v=KaFkRi5ESi8"
                  >https://www.youtube.com/watch?v=KaFkRi5ESi8</a
                >)
              </p>
              <p>--</p>
              <p>
                To see how it works, try chatting with our demo app that you can
                use without logging in:
                <a href="https://www.usevelvet.com/sandbox"
                  >https://www.usevelvet.com/sandbox</a
                >
              </p>
              <p>
                Setting up your own proxy is 2 lines of code and takes ~5 mins.
              </p>
              <p>Try it out and let us know what you think!</p>
            </div>
          </section>
        </section>
        <section id="41635592">
          <h3>
            <a class="item" href="https://openfreemap.org/"
              >Show HN: OpenFreeMap – Open-Source Map Hosting</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-24 @ 11:59:22</span
              ><span class="points-container"
                >Points: <span class="points">754</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41635592"
                  >Comments</a
                ><span class="descendants">: 208</span></span
              >
            </h4>
            <div class="text">
              <p>
                After 9 years of running my own OpenStreetMap tile server infra
                for MapHub (<a
                  href="https://news.ycombinator.com/item?id=11389989"
                  >https://news.ycombinator.com/item?id=11389989</a
                >), I've open-sourced it and launched OpenFreeMap.
              </p>
              <p>
                You can either self-host or use our public instance. Everything
                is open-source, including the full production setup — there’s no
                'open-core' model here. Check out the repo (<a
                  href="https://github.com/hyperknot/openfreemap"
                  >https://github.com/hyperknot/openfreemap</a
                >). The map data comes from OpenStreetMap.
              </p>
              <p>
                I also provide weekly full planet downloads both in Btrfs and
                MBTiles formats.
              </p>
              <p>
                I aim to cover the running costs of the public instance through
                donations.
              </p>
              <p>Looking forwards for your feedback.</p>
            </div>
          </section>
        </section>
        <section id="41633551">
          <h3>
            <a
              class="item"
              href="https://ideas.lego.com/projects/10a3239f-4562-4d23-ba8e-f4fc94eef5c7"
              >Working Turing Machine</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-24 @ 06:12:45</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41633551"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41617174">
          <h3>
            <a
              class="item"
              href="https://thereader.mitpress.mit.edu/how-we-sort-the-world-gregory-murphy-on-the-psychology-of-categories/"
              >How We Sort the World</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-22 @ 14:07:05</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41617174"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41615910">
          <h3>
            <a
              class="item"
              href="https://geoawesome.com/avoidance-mapping-what-it-is-where-it-fits-in-the-cartography-cube/"
              >Avoidance Mapping: What It Is and Where It Fits in the
              Cartography Cube</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-22 @ 09:43:18</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41615910"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41610995">
          <h3>
            <a
              class="item"
              href="https://www.uninformativ.de/blog/postings/2024-09-21/0/POSTING-en.html"
              >Mkfs.fat on Linux vs. OS/2 2.1</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 16:33:55</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41610995"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41609254">
          <h3>
            <a class="item" href="https://github.com/tildearrow/furnace"
              >Furnace – the biggest multi-system chiptune tracker ever made</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 11:18:30</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41609254"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41606932">
          <h3>
            <a
              class="item"
              href="https://interconnected.org/home/2024/09/20/filtered"
              >Filtered for home robots, fast and slow</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 02:11:02</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41606932"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41606694">
          <h3>
            <a
              class="item"
              href="http://www.vintagecalculators.com/html/busicom_141-pf_and_intel_4004.html"
              >The Calculator that spawned the Microprocessor (2009)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-21 @ 00:59:03</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41606694"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41604950">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41604950"
              >Ask HN: Platform for 11 year old to create video games?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 19:39:45</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41604950"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
            <div class="text">
              <p>
                Does anyone know what’s out there that would work for them in
                this case? FWIW I don’t know Lua but anything with JavaScript or
                Python built in would make it easy for me to help them. Thanks
                in advance!
              </p>
            </div>
          </section>
        </section>
        <section id="41602473">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-09-understudied-protein-blobs-global-effects.html"
              >Understudied protein blobs have global effects on cell
              biochemistry</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 14:41:03</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41602473"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41601517">
          <h3>
            <a
              class="item"
              href="https://www.ethanepperly.com/index.php/2024/07/02/neat-randomized-algorithms-randdiag-for-rapidly-diagonalizing-normal-matrices/"
              >Neat Randomized Algorithms: RandDiag for Rapidly Diagonalizing
              Normal Matrices</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 12:53:48</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41601517"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41601148">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/article/nasa-spacecraft-probe-possibility-life-europa-s-salty-ocean"
              >NASA spacecraft to probe possibility of life in Europa's salty
              ocean</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 12:02:44</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41601148"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41598414">
          <h3>
            <a
              class="item"
              href="https://engelsbergideas.com/reviews/a-little-history-of-the-anchovy/"
              >A Little History of the Anchovy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-20 @ 03:02:20</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41598414"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
