<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40790214">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/blog-post/and-now-xylitol"
              >And Now Xylitol</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-25 @ 16:03:38</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40790214"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40790057">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/world/article/2024/jun/25/chinas-change-6-lunar-probe-returns-world-first-samples-from-far-side-of-the-moon"
              >Chang'e 6 lunar sample return mission returns with samples from
              moon's far side</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-25 @ 15:48:29</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40790057"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40789919">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/2024/06/25/testing-amds-giant-mi300x/"
              >Testing AMD's Giant MI300X</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-25 @ 15:36:09</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40789919"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40789672">
          <h3>
            <a class="item" href="https://flipdisc.io/http://localhost:4321/"
              >Show HN: I built a large JavaScript powered flipdisc display.
              Here's a guide</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-25 @ 15:14:08</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40789672"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40789353">
          <h3>
            <a
              class="item"
              href="https://dotenvx.com/blog/2024/06/24/dotenvx-next-generation-config-management.html"
              >From Dotenv to Dotenvx: Next Generation Config Management</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-25 @ 14:49:28</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40789353"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40789191">
          <h3>
            <a
              class="item"
              href="https://rarehistoricalphotos.com/vintage-wooden-homes-on-wheels/"
              >Vintage Wooden Homes on Wheels: Photos of Mobile Living from
              Early 20th Century</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-25 @ 14:36:29</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40789191"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40788648">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40788648"
              >Show HN: Triplit – Open-source syncing database that runs on
              server and client</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-25 @ 13:53:05</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40788648"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.triplit.dev">https://www.triplit.dev</a>).
              Triplit is an open-source database (<a
                href="https://github.com/aspen-cloud/triplit"
                >https://github.com/aspen-cloud/triplit</a
              >) that combines a server-side database, client-side cache, and a
              sync engine into one cohesive product. You can try it out with a
              new project by running:
              <p></p>
              <pre><code>  (npm|bun|yarn) create triplit-app
</code></pre>
              As a team, we’ve worked on several projects that aspired to the
              user experience of Linear or Superhuman, where every interaction
              feels instant like a native app while still having the
              collaborative and syncing features we expect from the web.
              Delivering this level of UX was incredibly challenging. In each
              app we built, we had to implement a local caching strategy, keep
              the cache up to date with optimistic writes, individually handle
              retries and rollbacks from failures, and do a lot of codegen to
              get Typescript to work properly. This was spread across multiple
              libraries and infrastructure providers and required constant
              maintenance.
              <p>
                We finally decided to build the system we always wanted. Triplit
                enables your app to work offline and sync in real-time over
                websockets with an enjoyable developer experience.
              </p>
              <p>
                Triplit lets you (1) define your schema in Typescript and simply
                push to the server without writing migration files; (2) write
                queries that automatically update in real-time to both remote
                changes from the server and optimistic local mutations on the
                client—with complete Typescript types; (3) run the whole stack
                locally without having to run a bunch of Docker containers.
              </p>
              <p>
                One interesting challenge of building a system like this is
                enabling partial replication and incremental query evaluation.
                In order to make loading times as fast as possible, Triplit will
                only fetch the minimal required data from the server to fulfill
                a specific query and then send granular updates to that client.
                This differs from other systems which either sync all of a
                user’s data (too slow for web apps) or repeatedly fetch the
                query to simulate a subscription (which bogs down your database
                and network bandwidth).
              </p>
              <p>
                If you’re familiar with the complexity of cache-invalidation and
                syncing, you’ll know that Triplit is operating firmly in the
                distributed systems space. We did a lot of research and settled
                on a local first approach that uses a fairly simple CRDT
                (conflict-free replicated data type) that allows each client to
                work offline and guarantees that they will converge to a
                consistent state when syncing. It works by treating each
                attribute of an entity as a last writer wins register. Compared
                to more complex strategies, this approach ends up being faster
                and doesn’t require additional logic to handle conflicting edits
                between concurrent writers. It’s similar to the strategy Figma
                uses for their collaborative editor.
              </p>
              <p>
                You can add Triplit to an existing project by installing the
                client NPM package. You may self-host the Triplit Server or pay
                us to manage an instance for you. One cool part is that whether
                you choose to self-host or deploy on Triplit Cloud, you can
                still use our Dashboard to configure your database or
                interactively manage your data in the Triplit Console, a
                spreadsheet-like GUI.
              </p>
              <p>
                In the future, we plan to add APIs for authentication, file
                uploads, and presence to create a Supabase/Firebase-like
                experience.
              </p>
              <p>
                You can get started by going to
                <a href="https://triplit.dev">https://triplit.dev</a> or find us
                on Github
                <a href="https://github.com/aspen-cloud/triplit"
                  >https://github.com/aspen-cloud/triplit</a
                >. Thanks for checking us out and we are looking forward to your
                feedback in the comments!
              </p>
            </div>
          </section>
        </section>
        <section id="40788049">
          <h3>
            <a class="item" href="https://www.hiranmay.xyz/blog/complex-systems"
              >Why we must seek a widely-applicable Science of Systems.</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-25 @ 13:01:12</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40788049"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40787276">
          <h3>
            <a
              class="item"
              href="https://diekmann.uk/blog/2024-06-25-statically-known-undefined-behaviour.html"
              >How GCC and Clang handle statically known undefined behaviour</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-25 @ 11:44:17</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40787276"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40783777">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-06-biodegradable-barley-plastic.html"
              >Researchers invent 100% biodegradable 'barley plastic'</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-25 @ 02:34:37</span
              ><span class="points-container"
                >Points: <span class="points">176</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40783777"
                  >Comments</a
                ><span class="descendants">: 134</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40783742">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-06-titan-strong-erode-coastlines-lakes.html"
              >Wave activity on Titan strong enough to erode the coastlines of
              lakes and seas</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-25 @ 02:29:54</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40783742"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40783598">
          <h3>
            <a
              class="item"
              href="https://shraiwi.github.io/read.html?md=blog/simd-fast-esp32s3.md"
              >SIMD-accelerated computer vision on a $2 microcontroller</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-25 @ 02:10:40</span
              ><span class="points-container"
                >Points: <span class="points">242</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40783598"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40783485">
          <h3>
            <a class="item" href="https://github.com/dojoe/Twonkie"
              >Twonkie: A USB-PD sniffer/injector/sink based on Google's Twinkie
              open hardware</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-25 @ 01:55:22</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40783485"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40783229">
          <h3>
            <a
              class="item"
              href="https://www.ifixit.com/News/96998/from-0-10-to-8-10-microsoft-puts-repair-front-and-center"
              >From 0/10 to 8/10: Microsoft Puts Repair Front and Center</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-25 @ 01:19:55</span
              ><span class="points-container"
                >Points: <span class="points">201</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40783229"
                  >Comments</a
                ><span class="descendants">: 124</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40782791">
          <h3>
            <a
              class="item"
              href="https://commoncog.com/c/cases/aw-jones-hedge-fund/"
              >The First Hedge Fund</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-25 @ 00:23:02</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40782791"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40782130">
          <h3>
            <a
              class="item"
              href="https://www.nbcnews.com/politics/justice-department/julian-assange-reached-plea-deal-us-allowing-go-free-rcna158695"
              >Julian Assange has reached a plea deal with the U.S., allowing
              him to go free</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-24 @ 23:10:07</span
              ><span class="points-container"
                >Points: <span class="points">2120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40782130"
                  >Comments</a
                ><span class="descendants">: 1029</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40781894">
          <h3>
            <a class="item" href="https://github.com/JFryy/qq"
              >Show HN: Qq: like jq, but can transcode between many formats</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-24 @ 22:44:30</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40781894"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
            <div class="text">
              qq is jq inspired interoperable config format transcoder with
              interactive querying. It features an optional interactive editor
              with autocomplete for structured data. And supports inputs and
              outputs for json, xml, ini, toml, yaml, hcl, tf, and csv to
              varying degrees of capability.
            </div>
          </section>
        </section>
        <section id="40781838">
          <h3>
            <a
              class="item"
              href="https://www.folklore.org/Round_Rects_Are_Everywhere.html"
              >Round Rects Are Everywhere</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-24 @ 22:38:31</span
              ><span class="points-container"
                >Points: <span class="points">361</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40781838"
                  >Comments</a
                ><span class="descendants">: 148</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40780908">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/2024/07/01/the-sun-ra-arkestras-maestro-hits-one-hundred"
              >The Sun Ra Arkestra's Maestro Hits One Hundred</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-24 @ 21:17:02</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40780908"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40780712">
          <h3>
            <a
              class="item"
              href="https://jobs.lever.co/FinleyTechnologies/ef9b46ab-6c97-4401-b7d1-8535c262f246"
              >Finley (YC W21) is hiring our first Sales Ops team member (SF,
              NY, Remote)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-24 @ 21:00:35</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40780696">
          <h3>
            <a
              class="item"
              href="https://xeiaso.net/blog/2024/fixing-rss-mailcap/"
              >MIME, RSS, and Existential Torment</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-24 @ 20:59:28</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40780696"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40779785">
          <h3>
            <a
              class="item"
              href="https://www.plough.com/en/topics/culture/literature/the-case-for-not-sanitizing-fairy-tales"
              >The case for not sanitising fairy tales</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-24 @ 19:35:52</span
              ><span class="points-container"
                >Points: <span class="points">243</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40779785"
                  >Comments</a
                ><span class="descendants">: 258</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40778594">
          <h3>
            <a
              class="item"
              href="https://letsencrypt.org/2024/06/24/ntpd-rs-deployment.html"
              >More Memory Safety for Let's Encrypt: Deploying ntpd-rs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-24 @ 17:23:28</span
              ><span class="points-container"
                >Points: <span class="points">283</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40778594"
                  >Comments</a
                ><span class="descendants">: 142</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40773056">
          <h3>
            <a
              class="item"
              href="https://slate.com/life/2024/06/doctors-teachers-dissatisfaction-tracking-charting-jobs.html"
              >The Triumph of Counting and Scripting</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-24 @ 06:29:39</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40773056"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40772955">
          <h3>
            <a
              class="item"
              href="https://holtwick.de/en/blog/localfirst-resilient-sync"
              >Resilient Sync for Local First</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-24 @ 05:58:41</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40772955"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40772831">
          <h3>
            <a
              class="item"
              href="https://reasonableapproximation.net/2019/05/05/hindley-milner.html"
              >A reckless introduction to Hindley-Milner type inference
              (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-24 @ 05:24:44</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40772831"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40769882">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=sv58aPvIonw"
              >Porting Python to a $3 smartwatch [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-23 @ 19:20:53</span
              ><span class="points-container"
                >Points: <span class="points">189</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40769882"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40765999">
          <h3>
            <a
              class="item"
              href="https://tailscale.com/blog/remembering-the-lan"
              >Remembering the LAN (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-23 @ 09:26:56</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40765999"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40765005">
          <h3>
            <a
              class="item"
              href="https://unix.stackexchange.com/questions/128985/why-not-parse-ls-and-what-to-do-instead"
              >Why not parse `ls` and what to do instead</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-23 @ 05:24:20</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40765005"
                  >Comments</a
                ><span class="descendants">: 120</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40749157">
          <h3>
            <a
              class="item"
              href="https://www.ornl.gov/news/quantum-chemistry-and-simulation-help-characterize-coordination-complex-elusive-element-61"
              >Quantum chemistry helps characterize coordination complex of
              elusive Element 61</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-21 @ 13:00:51</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40749157"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
