<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42172281">
          <h3>
            <a
              class="item"
              href="https://www.cbsnews.com/news/bhutan-emigration-crisis-60-minutes/"
              >Bhutan, after prioritizing happiness, now faces an existential
              crisis</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-18 @ 13:53:07</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42172281"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42172081">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2024/11/18/who_me/"
              >Undergrad thought he had mastered Unix in weeks. Then he
              discovered rm -RF</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-18 @ 13:22:16</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42172081"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42171924">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/lifestyle/careers/dermatology-jobs-salary-young-doctors-174cfe53"
              >$500k Pay, Easy Hours: How Dermatology Became the 'It' Job in
              Medicine</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-18 @ 12:56:25</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42171924"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42171311">
          <h3>
            <a class="item" href="https://github.com/DocumindHQ/documind"
              >Show HN: Documind – Open-source AI tool to turn documents into
              structured data</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-18 @ 10:51:14</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42171311"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
            <div class="text">
              <p>What it does:</p>
              <p>
                - Extracts specific data from PDFs based on your custom schema -
                Returns clean, structured JSON that's ready to use - Works with
                just a PDF link + your schema definition
              </p>
              <p>Just run npm install documind to get started.</p>
            </div>
          </section>
        </section>
        <section id="42171164">
          <h3>
            <a
              class="item"
              href="https://michaels.world/2023/11/i-was-banned-from-the-hcaptcha-accessibility-account-for-not-being-blind/"
              >I was banned from the hCaptcha accessibility account for not
              being blind</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-18 @ 10:13:28</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42171164"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42171051">
          <h3>
            <a class="item" href="https://nirvanalan.github.io/projects/GA/"
              >GaussianAnything: Interactive Point Cloud Latent Diffusion for 3D
              Generation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-18 @ 09:46:13</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42171051"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42171043">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2411.10440"
              >LLaVA-O1: Let Vision Language Models Reason Step-by-Step</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-18 @ 09:44:54</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42171043"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42170740">
          <h3>
            <a
              class="item"
              href="https://maxbo.me/a-html-file-is-all-you-need.html"
              >Reactive HTML Notebooks</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-18 @ 08:33:32</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42170740"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42170552">
          <h3>
            <a class="item" href="https://www.arp242.net/best-practices.html"
              >Against Best Practices</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-18 @ 07:45:03</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42170552"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42170423">
          <h3>
            <a
              class="item"
              href="https://texdraft.github.io/fortran/fortran.html"
              >Fortran II Hypersource</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-18 @ 07:10:35</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42170423"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42169998">
          <h3>
            <a class="item" href="https://ondsel.com/blog/goodbye/"
              >We are shutting down Ondsel</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-18 @ 05:40:58</span
              ><span class="points-container"
                >Points: <span class="points">251</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42169998"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42169363">
          <h3>
            <a class="item" href="https://smoores.dev/post/phonetic_matching/"
              >Phonetic Matching</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-18 @ 03:02:11</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42169363"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42168997">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2210.00714"
              >It's time to replace TCP in the datacenter (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-18 @ 01:42:41</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42168997"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42168652">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/alan-filion-torswats-guilty-plea-federal-charges-swatting/"
              >Teen behind hundreds of swatting attacks pleads guilty to federal
              charges</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-18 @ 00:39:34</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42168652"
                  >Comments</a
                ><span class="descendants">: 155</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42168576">
          <h3>
            <a class="item" href="https://nrk.neocities.org/articles/chibihash"
              >ChibiHash: Small, Fast 64 bit hash function</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-18 @ 00:23:00</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42168576"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42168503">
          <h3>
            <a class="item" href="https://museumofbadart.org/"
              >Museum of Bad Art</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-18 @ 00:09:20</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42168503"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42168491">
          <h3>
            <a
              class="item"
              href="https://apps.apple.com/gb/app/islet-diabetes/id6453168642"
              >Show HN: The App I Built to Help Manage My Diabetes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-18 @ 00:07:55</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42168491"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
            <div class="text">
              <p>
                I’m Joshua, a student, and I’m excited (and a little nervous) to
                share something deeply personal that I’ve been working on:
                Islet, my diabetes management app powered by GPT-4o-mini. It’s
                now on the App Store, but I want to be upfront—it’s still very
                much in its early stages, with a lot more to go.
              </p>
              <p>
                I was diagnosed with Type 1 diabetes while rowing competitively,
                and that moment changed everything. It wasn’t just the practical
                challenges of managing insulin, carb counts, and blood sugars;
                it fundamentally shifted how I see myself and the world. It
                forced me to slow down, prioritise my health, and take control
                in ways I never had to before. My outlook on life became more
                focused on resilience, adaptability, and finding solutions to
                problems that truly matter.
              </p>
              <p>
                This app started as a pet project over the summer, a way to see
                what I could create using ChatGPT and explore the potential of
                LLMs to help with real-world challenges. At first, it was just
                about making my own diabetes management easier—understanding
                patterns in blood sugars, planning meals, and adjusting
                routines. But as I worked on it, I realised it could do more.
              </p>
              <p>
                Right now, Islet offers personalised meal suggestions, tracks
                activity, and provides basic insights based on the data you
                enter. It’s far from complete. Even so, the process of building
                Islet has already taught me so much about how powerful AI can be
                in creating personal, meaningful tools.
              </p>
              <p>
                This project is deeply tied to how my diagnosis changed me. It’s
                about more than managing diabetes, it’s about showing how
                anyone, even a student experimenting over the summer, can use AI
                to potentially solve real, personal problems. I believe tools
                like LLMs have the power to democratise solutions for all,
                making life just a bit easier for all of us.
              </p>
              <p>
                If you’re curious, you can check it out here:
                <a
                  href="https://apps.apple.com/gb/app/islet-diabetes/id6453168642"
                  >https://apps.apple.com/gb/app/islet-diabetes/id6453168642</a
                >. I’d love to hear your thoughts what works, what doesn’t, and
                what features you think would make it better. Your input could
                help shape the next steps for Islet.
              </p>
              <p>Thanks for reading !</p>
              <p>joshua</p>
            </div>
          </section>
        </section>
        <section id="42168423">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/business/autos/the-withering-dream-of-a-cheap-american-electric-car-ad7e1113"
              >The withering dream of a cheap American electric car</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-17 @ 23:52:36</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42168423"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42168166">
          <h3>
            <a class="item" href="https://github.com/trynova/nova"
              >Show HN: Nova JavaScript Engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-17 @ 23:07:25</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42168166"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
            <div class="text">
              <p>
                1. All data allocated on the JavaScript heap is placed into a
                type-specific vector. Numbers go into the numbers vector,
                strings into the strings vector, and so on.
              </p>
              <p>
                2. All heap references are type-discriminated indexes: A heap
                number is identified by its discriminant value and the index to
                which it points to in the numbers vector.
              </p>
              <p>
                3. Objects are also split up into object kind -specific vectors.
                Ordinary objects go into one vector, Arrays go into another,
                DataViews into yet another, and so on.
              </p>
              <p>
                4. Unordinary objects' heap data does not contain ordinary
                object data but instead they contain an optional index to the
                ordinary objects vector.
              </p>
              <p>
                5. Objects are aggressively split into parts to avoid common
                use-cases having to reading parts that are known to be unused.
              </p>
              <p>
                If this sounds interesting, I've written a few blog posts on the
                internals of Nova over in our blog, you can jump into that here:
                <a
                  href="https://trynova.dev/blog/what-is-the-nova-javascript-engine"
                  >https://trynova.dev/blog/what-is-the-nova-javascript-engine</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="42167763">
          <h3>
            <a
              class="item"
              href="https://news.mit.edu/2024/solar-powered-desalination-system-requires-no-extra-batteries-1008"
              >Solar-powered desalination system requires no extra batteries</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-17 @ 22:06:25</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42167763"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42167633">
          <h3>
            <a
              class="item"
              href="https://naehrdine.blogspot.com/2024/11/reverse-engineering-ios-18-inactivity.html"
              >Reverse Engineering iOS 18 Inactivity Reboot</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-17 @ 21:50:26</span
              ><span class="points-container"
                >Points: <span class="points">407</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42167633"
                  >Comments</a
                ><span class="descendants">: 123</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42167388">
          <h3>
            <a
              class="item"
              href="https://littlebearlabs.io/perspectives/electron-spins-a-special-case-of-chromium-mods"
              >Electron Spins: a special case of Chromium mods</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-17 @ 21:20:19</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42167388"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42166948">
          <h3>
            <a
              class="item"
              href="https://fleetwood.dev/posts/you-could-have-designed-SOTA-positional-encoding"
              >You could have designed state of the art positional encoding</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-17 @ 20:31:26</span
              ><span class="points-container"
                >Points: <span class="points">157</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42166948"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42165759">
          <h3>
            <a class="item" href="https://github.com/joexbayer/c-web-modules"
              >Show HN: A dynamic C (Hot reloading) module-based Web
              Framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-17 @ 18:12:14</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42165759"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42165397">
          <h3>
            <a
              class="item"
              href="https://rishimehta.xyz/2024/11/17/alphaproofs-greatest-hits.html"
              >AlphaProof's Greatest Hits</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-17 @ 17:20:45</span
              ><span class="points-container"
                >Points: <span class="points">217</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42165397"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42163591">
          <h3>
            <a class="item" href="https://github.com/NVIDIA/garak"
              >Garak, LLM Vulnerability Scanner</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-17 @ 11:37:45</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42163591"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42162878">
          <h3>
            <a
              class="item"
              href="https://bitfieldconsulting.com/posts/constraints"
              >Constraints in Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-17 @ 08:44:29</span
              ><span class="points-container"
                >Points: <span class="points">199</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42162878"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42142485">
          <h3>
            <a class="item" href="https://garten.salat.dev/fake-shaders3.html"
              >Faking Shaders III: Tixyland</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-14 @ 23:39:52</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42142485"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42128831">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41586-024-08072-x"
              >Mapping the Ionosphere with Phones</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-13 @ 18:59:52</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42128831"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42127609">
          <h3>
            <a
              class="item"
              href="https://rkp.science/an-alternative-construction-of-shannon-entropy/"
              >An alternative construction of Shannon entropy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-13 @ 16:45:13</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42127609"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
