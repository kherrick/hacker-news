<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40636844">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/newsroom/2024/06/introducing-apple-intelligence-for-iphone-ipad-and-mac/"
              >Introducing Apple Intelligence, the personal intelligence
              system</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 18:48:47</span
              ><span class="points-container"
                >Points: <span class="points">181</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40636844"
                  >Comments</a
                ><span class="descendants">: 144</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40636581">
          <h3>
            <a class="item" href="https://files.catbox.moe/gtwa1g.PNG"
              >YouTube starts requiring login to watch videos</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 18:29:58</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40636502">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2024/06/10/apple-is-launching-its-own-password-manager-app/"
              >Apple is launching its own password manager app</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 18:23:05</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40636502"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40636331">
          <h3>
            <a
              class="item"
              href="https://9to5mac.com/2024/06/09/apple-blocks-pc-emulator-utm-app-store/"
              >Apple blocks PC emulator in iOS App Store and third-party app
              stores</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 18:07:24</span
              ><span class="points-container"
                >Points: <span class="points">190</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40636331"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40635959">
          <h3>
            <a
              class="item"
              href="https://openai.com/index/openai-welcomes-cfo-cpo/"
              >OpenAI Welcomes Sarah Friar (CFO) and Kevin Weil (CPO)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 17:34:38</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40635959"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40635834">
          <h3>
            <a
              class="item"
              href="https://github.com/iv-org/invidious/issues/4734"
              >Google has been blocking Invidious with error "This helps protect
              our community"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 17:22:46</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40635834"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40635789">
          <h3>
            <a
              class="item"
              href="https://daily.jstor.org/how-two-rebel-physicists-changed-quantum-theory/"
              >How Two Rebel Physicists Changed Quantum Theory</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 17:18:43</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40635789"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40635697">
          <h3>
            <a class="item" href="https://github.com/visrealm/pico9918"
              >pico9918: A replacement TMS9918A/TMS9929A VDP using a Raspberry
              Pi Pico</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 17:09:52</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40635697"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40635628">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/brainbase/jobs/W62qIfA-founding-head-of-product"
              >Brainbase (YC W24) Is Hiring Head of Product</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 17:01:58</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40635512">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41561-024-01457-7"
              >Evidence for transient morning water frost on the Tharsis
              volcanoes of Mars</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 16:52:57</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40635512"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40635397">
          <h3>
            <a
              class="item"
              href="https://www.csun.io/2024/06/08/probabilistic-tic-tac-toe.html"
              >Show HN: Probabilistic Tic-Tac-Toe</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 16:40:05</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40635397"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40634823">
          <h3>
            <a class="item" href="https://chaos.social/@scy/112591102162587559"
              >XScreenSaver is available on Android. Google requires a privacy
              policy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 15:46:14</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40634823"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40634774">
          <h3>
            <a
              class="item"
              href="https://www.otherbranch.com/blog/why-triplebyte-failed"
              >Why Triplebyte Failed</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 15:42:33</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40634774"
                  >Comments</a
                ><span class="descendants">: 124</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40634465">
          <h3>
            <a
              class="item"
              href="https://www.japantimes.co.jp/business/2024/06/08/evangelion-anime-production-company-bankrupt/"
              >Gainax, known for 'Evangelion' anime production, goes bankrupt</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 15:09:22</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40634465"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40634042">
          <h3><a class="item" href="https://23words.com">23words.com</a></h3>
          <section>
            <h4>
              <span>2024-06-10 @ 14:30:27</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40634042"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40633902">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2406.04912"
              >Mexican Computers: A Brief Technical and Historical Overview</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 14:14:24</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40633902"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40633773">
          <h3>
            <a class="item" href="https://github.com/squaredtechnologies/thread"
              >Show HN: Thread – AI-powered Jupyter Notebook built using
              React</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 13:59:22</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40633773"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
            <div class="text">
              <a href="https://thread.dev/">https://thread.dev/</a>) an
              open-source Jupyter Notebook that has a bunch of AI features built
              in. The easiest way to think of Thread is if the chat interface of
              OpenAI code interpreter was fused into a Jupyter Notebook
              development environment where you could still edit code or re-run
              cells. To check it out, you can see a video demo here:
              <a href="https://www.youtube.com/watch?v=Jq1_eoO6w-c"
                >https://www.youtube.com/watch?v=Jq1_eoO6w-c</a
              >
              <p>
                We initially got the idea when building Vizly (<a
                  href="https://vizly.fyi/"
                  >https://vizly.fyi/</a
                >) a tool that lets non-technical users ask questions from their
                data. While Vizly is powerful at performing data
                transformations, as engineers, we often felt that natural
                language didn't give us enough freedom to edit the code that was
                generated or to explore the data further for ourselves. That is
                what gave us the inspiration to start Thread.
              </p>
              <p>
                We made Thread a pip package (`pip install thread-dev`) because
                we wanted to make Thread as easily accessible as possible. While
                there are a lot of notebooks that improve on the notebook
                development experience, they are often cloud hosted tools that
                are hard to access as an individual contributor unless your
                company has signed an enterprise agreement.
              </p>
              <p>
                With Thread, we are hoping to bring the power of LLMs to the
                local notebook development environment while blending the
                editing experience that you can get in a cloud hosted notebook.
                We have many ideas on the roadmap but instead of building in a
                vacuum (which we have made the mistake of before) our hope was
                to get some initial feedback to see if others are as interested
                in a tool like this as we are.
              </p>
              <p>Would love to hear your feedback and see what you think!</p>
            </div>
          </section>
        </section>
        <section id="40632773">
          <h3>
            <a class="item" href="https://at.hn"
              >Show HN: Markdown HN profiles at {user}.at.hn</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 12:19:46</span
              ><span class="points-container"
                >Points: <span class="points">380</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40632773"
                  >Comments</a
                ><span class="descendants">: 128</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/padolsey/at.hn"
                >https://github.com/padolsey/at.hn</a
              >
            </div>
          </section>
        </section>
        <section id="40632745">
          <h3>
            <a
              class="item"
              href="https://blog.haschek.at/2024/leaving-a-digital-legacy.html"
              >Sending Emails to my three-year-old</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 12:14:56</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40632745"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40632533">
          <h3>
            <a class="item" href="https://github.com/potahtml/mpa-archive"
              >Show HN: Crawl a modern website to a zip, serve the website from
              the zip</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 11:47:00</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40632533"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40631558">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/the-mythical-non-roboticist"
              >The Mythical Non-Roboticist: Wouldn't it be great if everyone
              could do robotics?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 09:02:22</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40631558"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40631439">
          <h3>
            <a
              class="item"
              href="https://github.com/WebKit/WebKit/commit/84ae355619354ee1bfa7daaa1fc95565a6726be3"
              >WebKit fix: Quirk news.ycombinator to skip TextAutoSizing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 08:38:42</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40631439"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40630699">
          <h3>
            <a
              class="item"
              href="https://people.freebsd.org/~gallatin/talks/OpenFest2023.pdf"
              >The Magical Mystery Merge Or Why we run FreeBSD-current at
              Netflix (2023) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 06:10:11</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40630699"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40627563">
          <h3>
            <a
              class="item"
              href="https://www.modular.com/blog/deep-dive-into-ownership-in-mojo"
              >Deep Dive into Ownership in Mojo</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 20:57:15</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40627563"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40626807">
          <h3>
            <a class="item" href="https://marian42.de/article/orrery/"
              >Designing a Lego orrery</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 19:23:08</span
              ><span class="points-container"
                >Points: <span class="points">575</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40626807"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40623497">
          <h3>
            <a
              class="item"
              href="https://censorbib.nymity.ch/pdf/Almutairi2024a.pdf"
              >Fingerprinting VPNs with Custom Router Firmware [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 10:40:27</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40623497"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40622671">
          <h3>
            <a class="item" href="https://obsolescence.dev/pidp10.html"
              >PiDP-10 – a modern replica of the PDP-10</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 07:31:41</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40622671"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40622209">
          <h3>
            <a class="item" href="https://www.scratchapixel.com/index.html"
              >Scratchapixel 4.0, Learn Computer Graphics Programming</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 05:14:51</span
              ><span class="points-container"
                >Points: <span class="points">187</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40622209"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40619311">
          <h3>
            <a
              class="item"
              href="https://www.post-gazette.com/sports/pirates/2017/08/31/baseball-infield-dirt-mix-prices-duraedge-pnc-park-wrigley-field-duraedge-slippery-rock-soil-pennsylvania/stories/201708310111"
              >Western Pennsylvania dirt is used in the infields of most MLB
              stadiums (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-08 @ 18:12:09</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40619311"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40616752">
          <h3>
            <a
              class="item"
              href="https://www.thepythoncodingstack.com/p/bytes-python-built-in-unicode-utf-8-encoding"
              >`Bytes`: The Lesser-Known Python Built-In Sequence</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-08 @ 10:56:52</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40616752"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
