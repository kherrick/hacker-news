<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="35558539">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/kraftful/jobs/"
              >Kraftful (YC S19) Hiring Back End Eng to Build an AI Co-Pilot for
              Product Folks</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 17:02:14</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35558522">
          <h3>
            <a
              class="item"
              href="https://www.latent.space/p/segment-anything-roboflow#details"
              >Segment Anything Model and the Hard Problems of Computer
              Vision</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 17:01:24</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35558522"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35557630">
          <h3>
            <a
              class="item"
              href="https://nypost.com/2023/04/13/mary-quant-designer-who-invented-the-miniskirt-dead-at-93/"
              >Mary Quant, ‘60s designer who invented the miniskirt, dead at
              93</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 16:07:45</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35557630"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35557583">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/04/13/world/documents-leak-leaker-identity.html"
              >Leader of Online Group Where Secret Documents Leaked Is Air
              National Guardsman</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 16:05:14</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35557583"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35557256">
          <h3>
            <a
              class="item"
              href="https://twitter.com/cyrilzakka/status/1646532570597982208"
              >OpenAI API keys leaking through app binaries</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 15:47:25</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35557256"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35557103">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/technology/european-data-protection-board-discussing-ai-policy-thursday-meeting-2023-04-13/"
              >European privacy watchdog creates ChatGPT task force</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 15:38:01</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35557103"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35556899">
          <h3>
            <a
              class="item"
              href="https://www.zerohedge.com/political/joe-rogan-issues-warning-after-ai-generated-version-his-podcast-surfaces"
              >Joe Rogan Issues Warning After AI-Generated Version of His
              Podcast Surfaces</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 15:25:23</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35556899"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35556110">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/weather/2023/04/07/california-extreme-winter-storms-snow-climate/"
              >The science behind California's wet winter, in maps</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 14:35:14</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35556110"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35555799">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/04/13/reveal_all_recommendation_algorithms/"
              >It's time to reveal all recommendation algorithms – by law if
              necessary</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 14:15:47</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35555799"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35555525">
          <h3>
            <a
              class="item"
              href="https://missionlocal.org/2023/04/bob-lee-killing-arrest-made-san-francisco/"
              >Arrest made in SF killing of Bob Lee – alleged killer also worked
              in tech</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 13:56:25</span
              ><span class="points-container"
                >Points: <span class="points">581</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35555525"
                  >Comments</a
                ><span class="descendants">: 673</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35555481">
          <h3>
            <a
              class="item"
              href="https://sqrtminusone.xyz/posts/2023-04-13-emacs/"
              >916 Days of Emacs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 13:53:20</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35555481"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35555475">
          <h3>
            <a
              class="item"
              href="https://amitp.blogspot.com/2023/04/mac-keyboard-with-hidutil.html"
              >Mac Keyboard with Hidutil</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 13:53:11</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35555475"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35555432">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/a-new-approach-to-computation-reimagines-artificial-intelligence-20230413/"
              >A New Approach to Computation Reimagines Artificial
              Intelligence</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 13:50:04</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35555432"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35555274">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-023-01040-x"
              >Ageing studies in five animals suggests how to reverse decline</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 13:39:21</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35555274"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35555263">
          <h3>
            <a
              class="item"
              href="https://supabase.com/blog/supabase-auth-sso-pkce"
              >Supabase Auth: SSO, Mobile, and Server-Side Support</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 13:38:28</span
              ><span class="points-container"
                >Points: <span class="points">174</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35555263"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35554815">
          <h3>
            <a
              class="item"
              href="https://engineering.fb.com/2023/04/13/security/whatsapp-key-transparency/"
              >Deploying key transparency at WhatsApp</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 13:06:46</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35554815"
                  >Comments</a
                ><span class="descendants">: 124</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35554460">
          <h3>
            <a
              class="item"
              href="https://aws.amazon.com/blogs/aws/amazon-codewhisperer-free-for-individual-use-is-now-generally-available/"
              >Amazon CodeWhisperer, Free for Individual Use, Is Now Generally
              Available</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 12:38:09</span
              ><span class="points-container"
                >Points: <span class="points">204</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35554460"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35554413">
          <h3>
            <a
              class="item"
              href="https://github.blog/2023-04-12-github-accelerator-our-first-cohort-and-whats-next/"
              >GitHub Accelerator: our first cohort and what’s next</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 12:33:46</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35554413"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35554276">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/world/2023/apr/13/south-korea-to-give-490-allowance-to-reclusive-youths-to-help-them-leave-the-house"
              >South Korea to give $490 allowance to reclusive youths to help
              them leave house</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 12:18:57</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35554276"
                  >Comments</a
                ><span class="descendants">: 136</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35554270">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/newsroom/2023/04/apple-will-use-100-percent-recycled-cobalt-in-batteries-by-2025/"
              >Apple will use 100 percent recycled cobalt in batteries by
              2025</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 12:18:32</span
              ><span class="points-container"
                >Points: <span class="points">366</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35554270"
                  >Comments</a
                ><span class="descendants">: 201</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35553337">
          <h3>
            <a
              class="item"
              href="https://torrentfreak.com/youtube-dl-hosting-ban-paves-the-way-to-privatized-censorship-230411/"
              >YouTube-DL Hosting Ban Paves the Way to Privatized Censorship</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 10:19:39</span
              ><span class="points-container"
                >Points: <span class="points">414</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35553337"
                  >Comments</a
                ><span class="descendants">: 162</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35552393">
          <h3>
            <a class="item" href="https://www.howacarworks.com/video-course"
              >The art of auto engineering</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 08:02:39</span
              ><span class="points-container"
                >Points: <span class="points">414</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35552393"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35552378">
          <h3>
            <a
              class="item"
              href="https://www.nvidia.com/en-us/geforce/news/rtx-remix-runtime-open-source-download/"
              >Nvidia RTX Remix Runtime Open Source Available Now</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 08:00:13</span
              ><span class="points-container"
                >Points: <span class="points">235</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35552378"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35551870">
          <h3>
            <a
              class="item"
              href="https://www.esa.int/ESA_Multimedia/Transmissions/2023/04/Jupiter_Icy_Moons_Explorer_live_launch"
              >ESA – Jupiter Icy Moons Explorer: Live Launch</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 06:37:25</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35551870"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35551830">
          <h3>
            <a
              class="item"
              href="https://www.redhat.com/sysadmin/speed-containers-podman-raspberry-pi"
              >We achieved a 6-fold increase in Podman startup speed</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 06:31:42</span
              ><span class="points-container"
                >Points: <span class="points">293</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35551830"
                  >Comments</a
                ><span class="descendants">: 127</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35550567">
          <h3>
            <a
              class="item"
              href="https://www.ethanrosenthal.com/2023/04/10/nn-vs-ann/"
              >Do you need a vector database?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-13 @ 03:31:02</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35550567"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35543668">
          <h3>
            <a class="item" href="https://www.phind.com"
              >Show HN: GPT-4-powered web searches for developers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-12 @ 17:44:08</span
              ><span class="points-container"
                >Points: <span class="points">1249</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35543668"
                  >Comments</a
                ><span class="descendants">: 384</span></span
              >
            </h4>
            <div class="text">
              <p>
                Today we’re launching GPT-4 answers on Phind.com, a
                developer-focused search engine that uses generative AI to
                browse the web and answer technical questions, complete with
                code examples and detailed explanations. Unlike vanilla GPT-4,
                Phind feeds in relevant websites and technical documentation,
                reducing the model’s hallucination and keeping it up-to-date. To
                use it, simply enable the “Expert” toggle before doing a search.
              </p>
              <p>
                GPT-4 is making a night-and-day difference in terms of answer
                quality. For a question like “How can I RLHF a LLaMa model”,
                Phind in Expert mode delivers a step-by-step guide complete with
                citations (<a
                  href="https://phind.com/search?cache=0fecf96b-0ac9-4b65-893d-8ea5708db222"
                  >https://phind.com/search?cache=0fecf96b-0ac9-4b65-893d-8ea57...</a
                >) while Phind in default mode meanders a bit and answers the
                question very generally (<a
                  href="https://phind.com/search?cache=dd1fe16f-b101-4cc8-8089-ac56defb228d"
                  >https://phind.com/search?cache=dd1fe16f-b101-4cc8-8089-ac56d...</a
                >).
              </p>
              <p>
                GPT-4 is significantly more concise and “systematic” in its
                answers than our default model. It generates step-by-step
                instructions over 90% of the time, while our default model does
                not.
              </p>
              <p>
                We’re particularly focused on ML developers, as Phind can answer
                questions about many recent ML libraries, papers, and
                technologies that ChatGPT simply cannot. Even with ChatGPT’s
                alpha browsing mode, Phind answers technical questions faster
                and in more detail.
              </p>
              <p>
                For example, Phind running on “Expert” GPT-4 mode can concisely
                and correctly tell you how to run an Alpaca model using
                llama.cpp: (<a
                  href="https://phind.com/search?cache=0132c27e-c876-4f87-a0e1-cc48f07ccc20"
                  >https://phind.com/search?cache=0132c27e-c876-4f87-a0e1-cc48f...</a
                >). In contrast, ChatGPT-4 hallucinates and writes a make
                function for a fictional llama.cpp.
              </p>
              <p>
                We still have a long way to go and would love to hear your
                feedback.
              </p>
            </div>
          </section>
        </section>
        <section id="35539255">
          <h3>
            <a class="item" href="https://ianthehenry.com/posts/why-janet/"
              >Why Janet?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-12 @ 13:25:10</span
              ><span class="points-container"
                >Points: <span class="points">340</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35539255"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35537662">
          <h3>
            <a
              class="item"
              href="https://fermatslibrary.com/s/the-education-of-a-computer"
              >The Education of a Computer (1952)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-12 @ 10:55:44</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35537662"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35535404">
          <h3>
            <a
              class="item"
              href="https://ciobaca.substack.com/p/pedagogical-downsides-of-haskell"
              >Pedagogical Downsides of Haskell</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-12 @ 05:32:30</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35535404"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
