<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="35825399">
          <h3>
            <a class="item" href="https://docs.modular.com/mojo/"
              >Mojo: The usability of Python with the performance of C</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-05 @ 05:04:42</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35825399"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35824932">
          <h3>
            <a
              class="item"
              href="https://blogs.nvidia.com/blog/2023/04/28/sabrina-koumoin/"
              >Cracking the Code: Creating Opportunities for Women in Tech</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-05 @ 03:36:11</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35824932"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35824320">
          <h3>
            <a class="item" href="https://publiccode.eu/en/"
              >Public Money, Public Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-05 @ 01:37:39</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35824320"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35824173">
          <h3>
            <a
              class="item"
              href="https://blog.plover.com/lang/anagram-scoring.html"
              >I found the best anagram in English (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-05 @ 01:10:09</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35824173"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35824115">
          <h3>
            <a
              class="item"
              href="https://www.mayer.cool/writings/Heisting-20-Million-in-Magic-Cards/"
              >Heisting $20M of Magic: The Gathering Cards in a Single
              Request</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-05 @ 01:00:07</span
              ><span class="points-container"
                >Points: <span class="points">205</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35824115"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35823070">
          <h3>
            <a
              class="item"
              href="https://ai.googleblog.com/2023/05/mammut-simple-vision-encoder-text.html"
              >MaMMUT: A simple vision-encoder text-decoder architecture for
              multimodal tasks</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-04 @ 22:40:16</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35823070"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35823051">
          <h3>
            <a
              class="item"
              href="https://www.westinghousenuclear.com/energy-systems/ap300-smr"
              >Westinghouse AP300 Small Module Reactor</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-04 @ 22:38:16</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35823051"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35821748">
          <h3>
            <a class="item" href="https://github.com/piercefreeman/gpt-json"
              >Show HN: GPT-JSON – Structured and typehinted GPT responses in
              Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-04 @ 20:39:57</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35821748"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
            <div class="text">
              <p>
                There's been some positive movement in this space, like with
                jsonformer (<a href="https://github.com/1rgs/jsonformer"
                  >https://github.com/1rgs/jsonformer</a
                >) the other day. But nothing that was plug and play with GPT.
              </p>
              <p>
                This library consolidates the separate logic that I built across
                5 different projects. It lets you prompt the model for how it
                should return fields, inject variable prompts, handle common
                formatting errors, then cast to pydantic when you're done for
                typehinting and validation in your IDE. If you're able to play
                around with it, let me know what you think.
              </p>
            </div>
          </section>
        </section>
        <section id="35821695">
          <h3>
            <a
              class="item"
              href="https://www.pinecone.io/learn/langchain-retrieval-augmentation/"
              >Fixing Hallucination with Knowledge Bases</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-04 @ 20:34:40</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35821695"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35821128">
          <h3>
            <a
              class="item"
              href="https://www.woodtv.com/news/kent-county/americas-first-high-volume-pfas-annihilator-is-up-and-running-in-west-michigan/"
              >America’s first high-volume ‘PFAS Annihilator’ is up and running
              in W. Michigan</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-04 @ 19:47:56</span
              ><span class="points-container"
                >Points: <span class="points">235</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35821128"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35820931">
          <h3>
            <a
              class="item"
              href="https://blog.scottlogic.com/2023/05/04/langchain-mini.html"
              >Re-implementing LangChain in 100 lines of code</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-04 @ 19:33:12</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35820931"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35820368">
          <h3>
            <a
              class="item"
              href="https://chaos.social/@jonty/110307532009155432"
              >So this guy is now S3. All of S3</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-04 @ 18:54:56</span
              ><span class="points-container"
                >Points: <span class="points">472</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35820368"
                  >Comments</a
                ><span class="descendants">: 295</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35820289">
          <h3>
            <a class="item" href="https://pynecone.io/"
              >Pynecone – Performant, customizable web apps in pure Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-04 @ 18:49:09</span
              ><span class="points-container"
                >Points: <span class="points">184</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35820289"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35819990">
          <h3>
            <a
              class="item"
              href="https://deno.com/blog/roll-your-own-javascript-runtime-pt3"
              >Roll your own JavaScript runtime, pt. 3</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-04 @ 18:28:50</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35819990"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35818616">
          <h3>
            <a class="item" href="https://replit.com/careers"
              >Replit (YC W18) Is Hiring Engineers and Designers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-04 @ 17:00:47</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35817708">
          <h3>
            <a
              class="item"
              href="https://www.eumetsat.int/features/discover-first-images-mtg-i1"
              >The First Image from EUMETSAT’s Newest Satellite</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-04 @ 16:09:21</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35817708"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35816900">
          <h3>
            <a class="item" href="https://openjdk.org/jeps/450"
              >JEP 450: Compact Object Headers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-04 @ 15:25:07</span
              ><span class="points-container"
                >Points: <span class="points">184</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35816900"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35816457">
          <h3>
            <a class="item" href="https://www.hypertune.com/"
              >Show HN: Hypertune – Visual, functional, statically-typed
              configuration language</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-04 @ 15:01:47</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35816457"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
            <div class="text">
              <p>
                It's like a CMS but instead of only letting you set static
                content, you can insert arbitrary logic from the UI, including
                A/B tests and ML "loops".
              </p>
              <p>
                I previously built a landing page optimization tool that let
                marketers define variants of their headline, CTA, cover image,
                etc, then used a genetic algorithm to find the best combination
                of them. They used my Chrome extension to define changes on DOM
                elements based on their unique CSS selector. But this broke when
                the underlying page changed and didn't work with sites that used
                CSS modules. Developers hated it.
              </p>
              <p>I took a step back.</p>
              <p>
                The problem I was trying to solve was making the page
                configurable by marketers in a way that developers liked. I
                decided to solve it from first principles and this led to
                Hypertune.
              </p>
              <p>
                Here's how it works. You define a strongly typed configuration
                schema in GraphQL, e.g.
              </p>
              <p></p>
              <pre><code>  type Query {
    page(language: Language!, deviceType: DeviceType!): Page!
  }

  type Page {
    headline: String!
    imageUrl: String!
    showPromotion: Boolean!
    benefits: [String!]!
  }

  enum Language { English, French, Spanish }

  enum DeviceType { Desktop, Mobile, Tablet }
</code></pre>
              Then marketers can configure these fields from the UI using our
              visual, functional, statically-typed language. The language UI is
              <i>type-directed</i> so we only show expression options that
              satisfy the required type of the hole in the logic tree. So for
              the "headline" field, you can insert a String expression or an If
              / Else expression that returns a String. If you insert the latter,
              more holes appear. This means marketers don't need to know any
              syntax and can't get into invalid states. They can use arguments
              you define in the schema like "language" and "deviceType", and
              drop A/B tests and contextual multi-armed bandits anywhere in
              their logic. We overlay live counts on the logic tree UI so they
              can see how often different branches are called.
              <p>
                You get the config via our SDK which fetches your logic tree
                once on initialization (from our CDN) then evaluates it locally
                so you can get flags or content with different arguments (e.g.
                for different users) immediately with no network latency. So you
                can use the SDK on your backend without adding extra latency to
                every request, or on the frontend without blocking renders. The
                SDK includes a command line tool that auto-generates code for
                end-to-end type-safety based on your schema. You can also query
                your config via the GraphQL API.
              </p>
              <p>
                If you use the SDK, you can also embed a build-time snapshot of
                your logic tree in your app bundle. The SDK initializes from
                this instantly then fetches the latest logic from the server. So
                it'll still work in the unlikely event the CDN is down. And on
                the frontend, you can evaluate flags, content, A/B tests,
                personalization logic, etc, instantly on page load without any
                network latency, which makes it compatible with static Jamstack
                sites.
              </p>
              <p>
                I started building this for landing pages but realized it could
                be used for configuring feature flags, in-app content,
                translations, onboarding flows, permissions, rules, limits,
                magic numbers, pricing plans, backend services, cron jobs, etc,
                as it's all just "code configuration".
              </p>
              <p>
                This configuration is usually hardcoded, sprawled across json or
                yaml files, or in separate platforms for feature flags, content
                management, A/B testing, pricing plans, etc. So if a PM wants to
                A/B test new onboarding content, they need a developer to write
                glue code that stitches their A/B testing tool with their CMS
                for that specific test, then wait for a code deployment. And at
                that point, it may not be worth the effort.
              </p>
              <p>
                The general problem with having separate platforms is that all
                this configuration naturally overlaps. Feature flags and content
                management overlap with A/B testing and analytics. Pricing plans
                overlap with feature flags. Keeping them separate leads to
                inflexibility and duplication and requires hacky glue code,
                which defeats the purpose of configuration.
              </p>
              <p>
                I think the solution is a flexible, type-safe code configuration
                platform with a strongly typed schema, type-safe SDKs and APIs,
                and a visual, functional, statically-typed language with
                analytics, A/B testing and ML built in. I think this solves the
                problem with having separate platforms, but also results in a
                better solution for individual use cases and makes new use cases
                possible.
              </p>
              <p>
                For example, compared specifically to other feature flag
                platforms, you get auto-generated type-safe code to catch flag
                typos and errors at compile-time (instead of run-time), code
                completion and "find all references" in your IDE (no figuring
                out if a flag is in kebab-case or camelCase), type-safe enum
                flags you can exhaustively switch on, type-safe object and list
                flags, and a type-safe logic UI. You pass context arguments like
                userId, email, etc, in a type-safe way too with compiler errors
                if you miss or misspell one. To clean up a flag, you remove it
                from your query, re-run code generation and fix all the type
                errors to remove all references. The full programming language
                under the hood means there are no limits on your flag logic
                (you're not locked into basic disjunctive normal form). You can
                embed a build-time snapshot of your flag logic in your app
                bundle for guaranteed, instant initialization with no network
                latency (and keep this up to date with a commit webhook). And
                all your flags are versioned together in a single Git history
                for instant rollbacks to known good states (no figuring out what
                combination of flag changes caused an incident).
              </p>
              <p>
                There are other flexible configuration languages like Dhall
                (discussed here:
                <a href="https://news.ycombinator.com/item?id=32102203"
                  >https://news.ycombinator.com/item?id=32102203</a
                >), Jsonnet (discussed here:
                <a href="https://news.ycombinator.com/item?id=19656821"
                  >https://news.ycombinator.com/item?id=19656821</a
                >) and Cue (discussed here:
                <a href="https://news.ycombinator.com/item?id=20847943"
                  >https://news.ycombinator.com/item?id=20847943</a
                >). But they lack a UI for nontechnical users, can't be updated
                at run-time and don't support analytics, A/B testing and ML.
              </p>
              <p>
                I was actually going to start with a basic language that had
                primitives (Boolean, Int, String), a Comparison expression and
                an If / Else. Then users could implement the logic for each
                field in the schema separately.
              </p>
              <p>
                But then I realized they might want to share logic for a group
                of fields at the object level, e.g. instead of repeating "if
                (deviceType == Mobile) { primitiveA } else { primitiveB }" for
                each primitive field separately, they could have the logic once
                at the Page level: "if (deviceType == Mobile) { pageObjectA }
                else { pageObjectB }". I also needed to represent field
                arguments like "deviceType" in the language. And I realized
                users may want to define other variables to reuse bits of logic,
                like a specific "benefit" which appears in different variations
                of the "benefits" list.
              </p>
              <p>
                So at this point, it made sense to build a full, functional
                language with Object expressions (that have a type defined in
                the schema) and Function, Variable and Application expressions
                (to implement the lambda calculus). Then all the configuration
                can be represented as a single Object with the root Query type
                from the schema, e.g.
              </p>
              <p></p>
              <pre><code>  Query {
    page: f({ deviceType }) =&gt;
      switch (true) {
        case (deviceType == DeviceType.Mobile) =&gt;
          Page {
            headline: f({}) =&gt; "Headline A"
            imageUrl: f({}) =&gt; "Image A"
            showPromotion: f({}) =&gt; true
            benefits: f({}) =&gt; ["Ben", "efits", "A"]
          }
        default =&gt;
          Page {
            headline: f({}) =&gt; "Headline B"
            imageUrl: f({}) =&gt; "Image B"
            showPromotion: f({}) =&gt; false
            benefits: f({}) =&gt; ["Ben", "efits", "B"]
          }
      }
  }
</code></pre>
              So each schema field is implemented by a Function that takes a
              single Object parameter (a dictionary of field argument name =&gt;
              value). I needed to evaluate this logic tree given a GraphQL query
              that looks like:
              <p></p>
              <pre><code>  query {
    page(deviceType: Mobile) {
      headline
      showPromotion
    }
  }
</code></pre>
              So I built an interpreter that recursively selects the queried
              parts of the logic tree, evaluating the Functions for each query
              field with the given arguments. It ignores fields that aren't in
              the query so the logic tree can grow large without affecting query
              performance.
              <p>
                The interpreter is used by the SDK, to evaluate logic locally,
                and on our CDN edge server that hosts the GraphQL API. The
                response for the example above would be:
              </p>
              <p></p>
              <pre><code>  {
    "__typename": "Query",
    "page": {
      "__typename": "Page",
      "headline": "Headline A",
      "showPromotion": true
    }
  }
</code></pre>
              Developers were concerned about using the SDK on the frontend as
              it could leak sensitive configuration logic, like lists of user
              IDs, to the browser.
              <p>
                To solve this, I modified the interpreter to support "partial
                evaluation". This is where it takes a GraphQL query that only
                provides some of the required field arguments and then partially
                evaluates the logic tree as much as possible. Any logic which
                can't be evaluated is left intact.
              </p>
              <p>
                The SDK can leverage this at initialization time by passing
                already known arguments (e.g. the user ID) in its initialization
                query so that sensitive logic (like lists of user IDs) are
                evaluated (and eliminated) on the server. The rest of the logic
                is evaluated locally by the SDK when client code calls its
                methods with the remaining arguments. This also minimizes the
                payload size sent to the client and means less logic needs to be
                evaluated locally, which improves both page load and render
                performance.
              </p>
              <p>
                The interpreter also keeps a count of expression evaluations as
                well as events for A/B tests and ML loops, which are flushed
                back to Hypertune in the background to overlay live analytics on
                the logic tree UI.
              </p>
              <p>
                It's been a challenge to build a simple UI given there's a full
                functional language under the hood. For example, I needed to
                build a way for users to convert any expression into a variable
                in one click. Under the hood, to make expression X a variable,
                we wrap the parent of X in a Function that takes a single
                parameter, then wrap that Function in an Application that passes
                X as an argument. Then we replace X in the Function body with a
                reference to the parameter. So we go from:
              </p>
              <p></p>
              <pre><code>  if (X) {
    Y
  } else {
    Z
  }
</code></pre>
              to
              <p></p>
              <pre><code>  ((paramX) =&gt;
    if (paramX) {
      Y
    } else {
      Z
    }
  )(X)
</code></pre>
              So a variable is just an Application argument that can be
              referenced in the called Function's body. And once we have a
              variable, we can reference it in more than one place in the
              Function body. To undo this, users can "drop" a variable in one
              click which replaces all its references with a copy of its value.
              <p>
                Converting X into a variable gets more tricky if the parent of X
                is a Function itself which defines parameters referenced inside
                of X. In this case, when we make X a variable, we lift it
                outside of this Function. But then it doesn't have access to the
                Function's parameters anymore. So we automatically convert X
                into a Function itself which takes the parameters it needs. Then
                we call this new Function where we originally had X, passing in
                the original parameters. There are more interesting details
                about how we lift variables to higher scopes in one click but
                that's for another post.
              </p>
              <p>
                Thanks for reading this far! I'm glad I got to share Hypertune
                with you. I'm curious about what use case appeals to you the
                most. Is it type-safe feature flags, in-app content management,
                A/B testing static Jamstack sites, managing permissions, pricing
                plans or something else? Please let me know any thoughts or
                questions!
              </p>
            </div>
          </section>
        </section>
        <section id="35816361">
          <h3>
            <a
              class="item"
              href="https://github.com/erikw/vim-keybindings-everywhere-the-ultimate-list"
              >Vim Keybindings Everywhere – The Ultimate List</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-04 @ 14:55:46</span
              ><span class="points-container"
                >Points: <span class="points">203</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35816361"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35813322">
          <h3>
            <a
              class="item"
              href="https://www.semianalysis.com/p/google-we-have-no-moat-and-neither"
              >Google “We have no moat, and neither does OpenAI”</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-04 @ 10:19:13</span
              ><span class="points-container"
                >Points: <span class="points">1604</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35813322"
                  >Comments</a
                ><span class="descendants">: 766</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35804263">
          <h3>
            <a
              class="item"
              href="https://www.nplusonemag.com/issue-45/the-intellectual-situation/the-new-new-reading-environment/"
              >The New New Reading Environment</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-03 @ 16:22:05</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35804263"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35801611">
          <h3>
            <a
              class="item"
              href="https://taylor.town/constructive-lifestyle-design"
              >Lifestyle design from first principles</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-03 @ 12:34:39</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35801611"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35801318">
          <h3>
            <a
              class="item"
              href="https://antigonejournal.com/2023/02/colour-synaesthesia-homer/"
              >What Colour Are Odysseus’ Words? Traces of Synaesthesia in
              Homeric Scholarship</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-03 @ 12:04:48</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35801318"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35801302">
          <h3>
            <a class="item" href="https://verdagon.dev/blog/first-100k-lines"
              >How to Survive Your Project's First 100k Lines</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-03 @ 12:03:18</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35801302"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35800935">
          <h3>
            <a
              class="item"
              href="https://robertfortner.posthaven.com/rest-in-peas-the-unrecognized-death-of-speech"
              >Rest in Peas: The Unrecognized Death of Speech Recognition
              (2010)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-03 @ 11:19:15</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35800935"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35800788">
          <h3>
            <a
              class="item"
              href="https://astronomy.com/news/2020/10/the-forgotten-rescue-of-the-salyut-7-space-station"
              >The rescue of the Salyut 7 space station</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-03 @ 11:01:24</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35800788"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35800380">
          <h3>
            <a
              class="item"
              href="https://0110.be/posts/Electronic_Music_and_the_NeXTcube_-_Running_MAX_on_the_IRCAM_Musical_Workstation"
              >Electronic Music and the NeXTcube – Running Max on the Ircam
              Musical Workstation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-03 @ 10:18:04</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35800380"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35800157">
          <h3>
            <a
              class="item"
              href="https://papl.cs.brown.edu/2018/func-as-data.html#%28part._.A_.Little_.Calculus%29"
              >A Little Calculus</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-03 @ 09:47:13</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35800157"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35800109">
          <h3>
            <a class="item" href="https://cstack.github.io/db_tutorial/"
              >Writing a SQLite Clone from Scratch in C</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-03 @ 09:40:42</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35800109"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35798746">
          <h3>
            <a
              class="item"
              href="https://theorangeduck.com/page/cubic-interpolation-quaternions"
              >Cubic Interpolation of Quaternion</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-03 @ 06:27:05</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35798746"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
