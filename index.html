<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36938785">
          <h3>
            <a
              class="item"
              href="https://www.ft.com/content/1f873dd5-df8f-4cfc-bb21-ef83ed11fb4d"
              >SEC asked Coinbase to halt trading for everything except Bitcoin
              (FT)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 04:23:33</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36938785"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36938221">
          <h3>
            <a
              class="item"
              href="https://www.sequoiacap.com/article/ai-paradox-perspective/"
              >AI and the Frontier Paradox</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 02:37:33</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36938221"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36937713">
          <h3>
            <a class="item" href="https://conduit.rs/"
              >Conduit: Simple, fast and reliable chat server powered by
              Matrix</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 00:51:31</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36937713"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36937658">
          <h3>
            <a class="item" href="https://rachelbythebay.com/fun/som/"
              >The Screwed-O-Meter</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 00:43:27</span
              ><span class="points-container"
                >Points: <span class="points">178</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36937658"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36937593">
          <h3>
            <a class="item" href="https://mousefix.org/">Mac Mouse Fix</a>
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 00:34:25</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36937593"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36937571">
          <h3>
            <a
              class="item"
              href="https://computer.rip/2023-07-29-Free-Public-WiFi.html"
              >Free Public WiFi</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 00:30:43</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36937571"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36937480">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-023-02403-0"
              >AI search of Neanderthal proteins resurrects ‘extinct’
              antibiotics</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-31 @ 00:16:58</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36937480"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36937047">
          <h3>
            <a
              class="item"
              href="https://security.googleblog.com/2023/07/the-ups-and-downs-of-0-days-year-in.html"
              >A Year in Review of 0-days Exploited In-the-Wild in 2022</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 23:21:13</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36937047"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36936797">
          <h3>
            <a class="item" href="https://pyflo.net"
              >Show HN: Pyflo – a free, interactive guide to learning Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 22:49:17</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36936797"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
            <div class="text">
              <a href="https://pyflo.net">https://pyflo.net</a> is a free,
              interactive guide to learning Python
              <p>
                Hi Everyone, I am a CS educator who has taught a variety of
                university courses, including many on introductory Python
                programming. Over the past few years, I've written down a number
                of Python programming lessons and has culminated into Pyflo.net.
                This tool is a completely free, introductory guide to learning
                Python. It is more-or-less an intro programming textbook, but
                with a few twists, including:
              </p>
              <p>
                * It is totally free. You don't even have to give me your email
                to use it
              </p>
              <p>* The lessons are short and modularized</p>
              <p>
                * It's interactive, containing embedded questions that provide
                instant feedback throughout.
              </p>
              <p>
                My hope is that this can be a useful resource for those looking
                to learn Python. Feel free to use yourself, or share with those
                you think would be interested.
              </p>
              <p>Feedback is very much welcome and appreciated.</p>
            </div>
          </section>
        </section>
        <section id="36936498">
          <h3>
            <a
              class="item"
              href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4249026/"
              >Microbial Odor Profile of Polyester and Cotton Clothes After a
              Fitness Session</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 22:07:35</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36936498"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36936474">
          <h3>
            <a class="item" href="https://jaredkrinke.itch.io/sic-1"
              >Show HN: Single-Instruction (Subleq) Programming Game</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 22:04:51</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36936474"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36936008">
          <h3>
            <a
              class="item"
              href="https://e360.yale.edu/digest/idaho-beavers-stream-drought-fire"
              >Banished to a Remote Idaho Valley, Beavers Created a Lush
              Wetland</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 21:10:08</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36936008"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36935281">
          <h3>
            <a class="item" href="https://macgui.com/news/article.php?t=443"
              >HFS Origins: The Turbo File System (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 19:57:17</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36935281"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36935055">
          <h3>
            <a
              class="item"
              href="https://blog.dornea.nu/2023/07/30/documentation-as-code-for-cloud-plantuml/"
              >Documentation as Code for Cloud Using PlantUML</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 19:34:32</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36935055"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36935041">
          <h3>
            <a
              class="item"
              href="https://www.bitecode.dev/p/whats-up-python-the-gil-removed-a"
              >What's up, Python? The GIL removed, a new compiler, optparse
              deprecated</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 19:32:21</span
              ><span class="points-container"
                >Points: <span class="points">246</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36935041"
                  >Comments</a
                ><span class="descendants">: 160</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36934391">
          <h3>
            <a class="item" href="https://youareatlas.com/"
              >You Are Atlas, You Hold Up the Sky</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 18:28:20</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36934391"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36934135">
          <h3>
            <a
              class="item"
              href="https://charity.wtf/2019/09/08/reasons-not-to-be-a-manager/"
              >Reasons Not to Be a Manager (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 18:06:27</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36934135"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36934052">
          <h3>
            <a class="item" href="https://pboyd.io/posts/securing-a-linux-vm/"
              >The Reluctant Sysadmin's Guide to Securing a Linux Server</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 17:59:13</span
              ><span class="points-container"
                >Points: <span class="points">201</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36934052"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36934029">
          <h3>
            <a
              class="item"
              href="https://askmisterwizard.com/2019/LinuxAirCombat/LinuxAirCombat.htm"
              >Linux Air Combat: free, lightweight and open-source combat flight
              simulator</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 17:57:29</span
              ><span class="points-container"
                >Points: <span class="points">276</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36934029"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36933603">
          <h3>
            <a class="item" href="https://sfcompute.org/"
              >Show HN: San Francisco Compute – 512 H100s at &amp;lt;$2/hr for
              research and startups</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 17:25:24</span
              ><span class="points-container"
                >Points: <span class="points">536</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36933603"
                  >Comments</a
                ><span class="descendants">: 143</span></span
              >
            </h4>
            <div class="text">
              <p>
                Big labs like OpenAI and Deepmind have big clusters that support
                this kind of bursty allocation for their researchers, but
                startups so far have had to get very small clusters on very long
                term contracts, wait months of lead time, and try to keep them
                busy all the time.
              </p>
              <p>
                Our goal is to make it about 10-20x cheaper to do an AI startup
                than it is right now. Stable Diffusion only costs about $100k to
                train -- in theory every YC company could get up to that scale.
                It's just that no cloud provider in the world will give you
                $100k of compute for just a couple weeks, so startups have to
                raise 20x that much to buy a whole year of compute.
              </p>
              <p>
                Once the cluster is online, we're going to be pretty much the
                only option for startups to do big training runs like that on.
              </p>
            </div>
          </section>
        </section>
        <section id="36933452">
          <h3>
            <a class="item" href="https://github.com/khoj-ai/khoj"
              >Show HN: Khoj – Chat offline with your second brain using Llama
              2</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 17:14:22</span
              ><span class="points-container"
                >Points: <span class="points">342</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36933452"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
            <div class="text">
              <p>
                Once we made Khoj search incremental, I completely stopped using
                the default incremental search (C-s) in Emacs. Since then Khoj
                has grown to support more content types, deeper integrations and
                chat (using ChatGPT). With Llama 2 released last week, chat
                models are finally good and easy enough to use on consumer
                hardware for the chat with docs scenario.
              </p>
              <p>
                Khoj is a desktop application to search and chat with your
                personal notes, documents and images. It is accessible from
                within Emacs, Obsidian or your Web browser. It works with
                org-mode, markdown, pdf, jpeg files and notion, github
                repositories. It is open-source and can work without internet
                access (e.g on a plane).
              </p>
              <p>
                Our chat feature allows you to extract answers and create
                content from your existing knowledge base. Example:
                <i
                  >"What was that book Trillian mentioned at Zaphod's birthday
                  last week"</i
                >. We personally use the chat feature regularly to find links,
                names and addresses (especially on mobile) and collate content
                across multiple, messy notes. It works online or offline: you
                can chat without internet using Llama 2 or with internet using
                GPT3.5+ depending on your requirements.
              </p>
              <p>
                Our search feature lets you quickly find relevant notes,
                documents or images using natural language. It does not use the
                internet. Example: Search for
                <i>"bought flowers at grocery store"</i> will find notes about
                <i>"roses at wholefoods"</i>.
              </p>
              <p>Quickstart:</p>
              <p></p>
              <pre><code>  pip install khoj-assistant &amp;&amp; khoj
</code></pre>
              See
              <a href="https://docs.khoj.dev/#/setup"
                >https://docs.khoj.dev/#/setup</a
              >
              for detailed instructions
              <p>
                We also have desktop apps (in beta) at
                <a href="https://github.com/khoj-ai/khoj/releases/tag/0.10.0"
                  >https://github.com/khoj-ai/khoj/releases/tag/0.10.0</a
                >
                if you want to try them out.
              </p>
              <p>
                Please do try out Khoj and let us know if it works for your use
                cases? <i>Looking forward to the feedback!</i>
              </p>
            </div>
          </section>
        </section>
        <section id="36933276">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/mutable-ai/jobs"
              >Mutable.ai (YC W22) Is Hiring Engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 17:00:32</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36933209">
          <h3>
            <a
              class="item"
              href="https://www.feynmanlectures.caltech.edu/messenger.html"
              >Feynman's Messenger Lectures (1964)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 16:55:30</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36933209"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36933028">
          <h3>
            <a
              class="item"
              href="https://www.openwall.com/lists/musl/2023/05/02/1"
              >Musl 1.2.4 adds TCP DNS fallback</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 16:39:16</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36933028"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36932537">
          <h3>
            <a class="item" href="https://zapier.com/resources/guides/apis"
              >An Introduction to APIs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 15:54:35</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36932537"
                  >Comments</a
                ><span class="descendants">: 89</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36932524">
          <h3>
            <a
              class="item"
              href="https://shkspr.mobi/blog/2019/07/i-feel-hopeless-rejected-and-a-burden-on-society-one-week-of-empathy-training/"
              >I feel hopeless, rejected, and a burden – One week of empathy
              training (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 15:53:36</span
              ><span class="points-container"
                >Points: <span class="points">345</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36932524"
                  >Comments</a
                ><span class="descendants">: 217</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36929096">
          <h3>
            <a class="item" href="https://github.com/grassmunk/Chicago95"
              >Chicago95 – Windows 95 Theme for Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 08:28:57</span
              ><span class="points-container"
                >Points: <span class="points">245</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36929096"
                  >Comments</a
                ><span class="descendants">: 157</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36927785">
          <h3>
            <a
              class="item"
              href="https://www.sol20.org/articles/img/CUTS_PE_Mar_76.pdf"
              >Computer Users Tape System (1976) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 04:24:14</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36927785"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36927760">
          <h3>
            <a
              class="item"
              href="https://www.newstatesman.com/culture/books/2023/07/simone-de-beauvoir-art-of-loss-ali-smith"
              >Simone de Beauvoir and the art of loss</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 04:17:41</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36927760"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36910920">
          <h3>
            <a
              class="item"
              href="https://www.science.org/doi/10.1126/sciadv.adg3377"
              >Insights into the genetic histories and lifeways of Machu
              Picchu’s occupants</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-28 @ 18:14:14</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36910920"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
