<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44547538">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2501.06623"
              >Nuclear Explosion for Carbon Sequestration</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 04:33:44</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44547538"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44547089">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/culture/photo-booth/earths-poet-of-scale"
              >Edward Burtynsky's monumental chronicle of the human impact on
              the planet</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 02:47:00</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44547089"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44546640">
          <h3>
            <a
              class="item"
              href="https://wiomoc.de/misc/posts/hacking_coroutines_into_c.html"
              >Hacking Coroutines into C</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 01:12:37</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44546640"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44545949">
          <h3>
            <a class="item" href="https://kristoff.it/blog/zig-new-async-io/"
              >Zig's New Async I/O</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 23:03:41</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44545949"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44545858">
          <h3>
            <a
              class="item"
              href="https://www.medrxiv.org/content/10.1101/2025.06.20.25329961v1"
              >Light exposure at night predicts incidence of cardiovascular
              diseases</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 22:48:14</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44545858"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44544862">
          <h3>
            <a class="item" href="https://github.com/aeron-io/aeron"
              >Aeron: Efficient reliable UDP unicast, UDP multicast, and IPC
              message transport</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 20:25:18</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44544862"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44544266">
          <h3>
            <a class="item" href="https://0x44.xyz/blog/web-request-blocking/"
              >Bypassing Google's big anti-adblock update</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 19:06:09</span
              ><span class="points-container"
                >Points: <span class="points">626</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44544266"
                  >Comments</a
                ><span class="descendants">: 538</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44543913">
          <h3>
            <a class="item" href="https://github.com/jtang613/GhidrAssistMCP"
              >A better Ghidra MCP server â€“ GhidrAssistMCP</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 18:21:33</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44543913"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44543865">
          <h3>
            <a class="item" href="https://ellsberg.substack.com/p/free-speech"
              >Supreme Court's ruling practically wipes out free speech for sex
              writing online</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 18:14:37</span
              ><span class="points-container"
                >Points: <span class="points">567</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44543865"
                  >Comments</a
                ><span class="descendants">: 734</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44543638">
          <h3>
            <a class="item" href="https://langfa.st/"
              >Show HN: I made a JSFiddle-style playground to test and share
              prompts fast</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 17:41:44</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44543638"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
            <div class="text">
              <p>
                Prompt testing should be simple and straightforward. All I
                wanted was a simple way to test prompts with variables and
                jinja2 templates across different models, ideally somthing I
                could open during a call, run few tests, and share results with
                my team. But every tool I tried hit me with a clunky UI,
                required login and API keys, or forced a lengthy setup process.
              </p>
              <p>And that's not all.</p>
              <p>
                Then came the pricing. The last quote I got for one of the tools
                on the market was $6,000/year for a team of 16 people in a
                use-it-or-loose-it way. For a tool we use maybe 2â€“3 times per
                sprint. Thatâ€™s just ridiculous!
              </p>
              <p>
                IMO, it should be something more like JSFiddle. A simple prompt
                playground that does not require you to signup, does not require
                API keys, and let's experiment instantly, i.e. you just enter a
                browser URL and start working. Like JSFiddle has. And mainly,
                something that costs me nothing if I'm or my team is not using
                it.
              </p>
              <p>
                Eventually I gave up looking for solution and decided to build
                it by myself.
              </p>
              <p>
                Here it is: <a href="https://langfa.st">https://langfa.st</a>
              </p>
              <p>
                Help me find what's wrong or missing or does not work from you
                perspctive.
              </p>
              <p>
                P.S. I did not put any limits or restrictions yet, so test it
                wisely. Don't make me broke, please.
              </p>
            </div>
          </section>
        </section>
        <section id="44543508">
          <h3>
            <a class="item" href="https://github.com/MoonshotAI/Kimi-K2"
              >Kimi K2 is a state-of-the-art mixture-of-experts (MoE) language
              model</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 17:26:24</span
              ><span class="points-container"
                >Points: <span class="points">325</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44543508"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44543240">
          <h3>
            <a
              class="item"
              href="https://inventwithpython.com/blog/lost-av-chapter.html"
              >Lost Chapter of Automate the Boring Stuff: Audio, Video, and
              Webcams in Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 16:45:45</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44543240"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44543150">
          <h3>
            <a
              class="item"
              href="https://skyandtelescope.org/astronomy-news/proposed-noaa-budget-kills-program-to-prevent-satellite-collisions/"
              >Proposed NOAA Budget Kills Program Designed to Prevent Satellite
              Collisions</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 16:31:03</span
              ><span class="points-container"
                >Points: <span class="points">335</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44543150"
                  >Comments</a
                ><span class="descendants">: 195</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44542880">
          <h3>
            <a
              class="item"
              href="https://atomic14.substack.com/p/vibe-coding-a-pcb-surprisingly-good"
              >Vibe-Coding a PCB â€“ surprisingly good</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 15:47:26</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44542880"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44542578">
          <h3>
            <a class="item" href="https://www.designarena.ai/"
              >Show HN: DesignArena â€“ crowdsourced benchmark for AI-generated
              UI/UX</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 15:07:46</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44542578"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.designarena.ai/vote"
                >https://www.designarena.ai/vote</a
              >
              <p>
                /vote: Your prompt will be answered by four random, anonymous
                models. You pick the one you prefer and crown the winner,
                tournament-style.
              </p>
              <p>
                /leaderboard: See the current winning models, as dictated by
                voter preferences.
              </p>
              <p>
                /play: Iterate quickly by seeing four models respond to the same
                input and pressing space to regenerate the results you donâ€™t
                lock-in.
              </p>
              <p>
                We were especially impressed with the quality of DeepSeek and
                Grok, and variance between categories (To judge by the results
                so far, OpenAI is very good for game dev, but seems to suck
                everywhere else).
              </p>
              <p>
                Weâ€™ve learned a lot, and are curious to hear your comments and
                questions. Excited to make this better!
              </p>
            </div>
          </section>
        </section>
        <section id="44541576">
          <h3>
            <a
              class="item"
              href="https://nautil.us/is-this-new-swim-stroke-the-fastest-yet-235511/"
              >The fish kick may be the fastest subsurface swim stroke yet
              (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 12:25:28</span
              ><span class="points-container"
                >Points: <span class="points">208</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44541576"
                  >Comments</a
                ><span class="descendants">: 139</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44541565">
          <h3>
            <a
              class="item"
              href="https://jollygoodsw.wordpress.com/2025/03/13/working-through-writing-a-c-compiler/"
              >Working through 'Writing A C Compiler'</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 12:23:33</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44541565"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44540402">
          <h3>
            <a
              class="item"
              href="https://blog.decryption.net.au/posts/macpaint.html"
              >MacPaint Art from the Mid-80s Still Looks Great Today</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 08:45:15</span
              ><span class="points-container"
                >Points: <span class="points">861</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44540402"
                  >Comments</a
                ><span class="descendants">: 178</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44540241">
          <h3>
            <a class="item" href="https://jsdate.wtf"
              >New Date("wtf") â€“ How well do you know JavaScript's Date
              class?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 08:14:02</span
              ><span class="points-container"
                >Points: <span class="points">317</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44540241"
                  >Comments</a
                ><span class="descendants">: 182</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44539879">
          <h3>
            <a
              class="item"
              href="https://patchstack.com/articles/critical-malware-found-in-gravityforms-official-plugin-site/"
              >Malware found in official gravityforms plugin indicating supply
              chain breach</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 06:41:59</span
              ><span class="points-container"
                >Points: <span class="points">212</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44539879"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44533044">
          <h3>
            <a class="item" href="https://timsh.org/claude-inside-docker/"
              >Switching to Claude Code and VSCode Inside Docker</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-11 @ 15:11:24</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44533044"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44529274">
          <h3>
            <a
              class="item"
              href="http://bannalia.blogspot.com/2025/07/maps-on-chains.html"
              >C++: Maps on Chains</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-11 @ 07:27:47</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44529274"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44527739">
          <h3>
            <a
              class="item"
              href="https://github.com/dsekz/chrome-x-browser-validation-header"
              >Chrome's hidden X-Browser-Validation header reverse engineered</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-11 @ 02:00:10</span
              ><span class="points-container"
                >Points: <span class="points">150</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44527739"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44520218">
          <h3>
            <a
              class="item"
              href="https://thetechenabler.substack.com/p/programming-affordance-when-a-languages"
              >Programming Affordances That Invite Mistakes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-10 @ 12:26:32</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44520218"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44520000">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=kVApsFUeuEA"
              >HNSW as abstract data structure: video intro to Redis vector
              sets</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-10 @ 11:59:35</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44520000"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44515210">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2025-06-plastic-carbon-dioxide-electricity.html"
              >Two-step system makes plastic from carbon dioxide, water and
              electricity</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-09 @ 22:10:37</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44515210"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44508580">
          <h3>
            <a
              class="item"
              href="https://www.gutenberg.org/files/32032/32032-h/32032-h.htm"
              >Second Variety, by Philip K. Dick (1953)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-09 @ 11:14:14</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44508580"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44507931">
          <h3>
            <a class="item" href="https://github.com/renoise/pattrns"
              >Experimental imperative-style music sequence generator engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-09 @ 09:33:57</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44507931"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44507799">
          <h3>
            <a
              class="item"
              href="https://erisa.dev/exposing-a-web-service-with-cloudflare-tunnel/"
              >Exposing a web service with Cloudflare Tunnel (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-09 @ 09:08:34</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44507799"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44507405">
          <h3>
            <a
              class="item"
              href="https://www.lelanthran.com/chap13/content.html"
              >Parse, Don't Validate (For C)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-09 @ 08:07:23</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44507405"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
