<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40953563">
          <h3>
            <a class="item" href="https://www.stemfie.org/"
              >STEMFIE, a 3D-printable construction set toy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-13 @ 12:01:37</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40953563"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40953559">
          <h3>
            <a class="item" href="https://grnh.se/d034f1ba5us"
              >Substack (YC W18) is hiring machine learning engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-13 @ 12:01:00</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40953268">
          <h3>
            <a
              class="item"
              href="https://www2.dmst.aueb.gr/dds/blog/20131211/index.html"
              >The Birth of Standard Error (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-13 @ 10:55:52</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40953268"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40952650">
          <h3>
            <a
              class="item"
              href="https://kottke.org/16/08/for-the-colonel-it-was-fingerlickin-bad"
              >For the Colonel, It Was Finger-Lickin’ Bad (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-13 @ 08:30:34</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40952650"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40952509">
          <h3>
            <a class="item" href="https://cssgridgenerator.io/"
              >Show HN: I made a drag and drop CSS grid generator</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-13 @ 07:44:09</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40952509"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40952248">
          <h3>
            <a class="item" href="https://webcontainers.io/"
              >WebContainers: Dev environments. In your web app</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-13 @ 06:31:05</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40952248"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40952182">
          <h3>
            <a class="item" href="https://github.com/AnswerDotAI/gpu.cpp"
              >gpu.cpp: A lightweight library for portable low-level GPU
              computation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-13 @ 06:12:35</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40952182"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40951877">
          <h3>
            <a class="item" href="https://lyonsden.net/wireless-tank-mouse/"
              >Wireless Amiga Tank Mouse</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-13 @ 04:58:33</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40951877"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40951800">
          <h3>
            <a class="item" href="http://timhulsizer.com/cwords/cintro.html"
              >Introduction to Calvin and Hobbes: Sunday Pages 1985-1995
              (2001)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-13 @ 04:37:02</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40951800"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40951732">
          <h3>
            <a
              class="item"
              href="https://www.noemamag.com/the-phantom-haunting-history/"
              >The Phantoms Haunting History</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-13 @ 04:18:17</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40951732"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40950584">
          <h3>
            <a class="item" href="https://fev.al/posts/work-journal/"
              >Use a work journal</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-13 @ 00:05:23</span
              ><span class="points-container"
                >Points: <span class="points">652</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40950584"
                  >Comments</a
                ><span class="descendants">: 188</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40950235">
          <h3>
            <a class="item" href="https://craftinginterpreters.com/"
              >Crafting Interpreters</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-12 @ 23:00:25</span
              ><span class="points-container"
                >Points: <span class="points">316</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40950235"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40949943">
          <h3>
            <a
              class="item"
              href="https://lichess.org/@/revoof/blog/optimizing-the-tablebase-server/MetV0ZQd"
              >Optimizing the Lichess Tablebase Server</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-12 @ 22:14:07</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40949943"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40949021">
          <h3>
            <a
              class="item"
              href="https://9elements.com/blog/responsive-bar-charts-in-html-and-css/"
              >Responsive bar charts in HTML and CSS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-12 @ 20:17:40</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40949021"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40948806">
          <h3>
            <a
              class="item"
              href="https://labs.quansight.org/blog/free-threaded-python-rollout"
              >Free-threaded CPython is ready to experiment with</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-12 @ 19:52:52</span
              ><span class="points-container"
                >Points: <span class="points">409</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40948806"
                  >Comments</a
                ><span class="descendants">: 278</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40948566">
          <h3>
            <a class="item" href="https://github.com/clarkmcc/cel-rust"
              >Common Expression Language interpreter written in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-12 @ 19:19:31</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40948566"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40948353">
          <h3>
            <a
              class="item"
              href="https://www.mattkeeter.com/blog/2024-07-12-interpreter/"
              >Beating the Compiler</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-12 @ 18:54:17</span
              ><span class="points-container"
                >Points: <span class="points">157</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40948353"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40948202">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/what-could-explain-the-gallium-anomaly-20240712/"
              >What could explain the gallium anomaly?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-12 @ 18:35:08</span
              ><span class="points-container"
                >Points: <span class="points">177</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40948202"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40947415">
          <h3>
            <a class="item" href="https://github.com/DropbaseHQ/dropbase"
              >Show HN: Dropbase AI – A Prompt-Based Python Web App Builder</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-12 @ 17:08:19</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40947415"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
            <div class="text">
              <p>Dropbase is an AI-based Python web app builder.</p>
              <p>
                To build this, we had to make significant changes from our
                original launch:
                <a href="https://news.ycombinator.com/item?id=38534920"
                  >https://news.ycombinator.com/item?id=38534920</a
                >. Now, any web app can be entirely defined using just two
                files: `properties.json` for the UI and `main.py` for the
                backend logic, which makes it significantly easier for GPT to
                work with.
              </p>
              <p>
                In the latest version, developers can use natural language
                prompts to build apps. But instead of generating a black-box app
                or promising an AI software engineer we just generate simple
                Python code that is easily interpreted by our internal web
                framework. This allows developers to:
              </p>
              <p>
                (1) See and understand the generated app code. We regenerate the
                `main.py` file and highlight changes in a diff viewer, allowing
                developers to understand what exactly was changed.
              </p>
              <p>
                (2) Edit the app code: Developers can correct any errors,
                occasional hallucinations, or edit code to handle specific use
                cases. Once they like the code, they can commit changes and
                immediately preview the app.
              </p>
              <p>
                Incidentally, if you’ve tried Anthropic’s Artifacts to create
                “apps”, our experience will feel familiar. Dropbase AI is like
                Claude Artifacts, but for fully functional apps: you can connect
                to your database, make external API calls, and deploy to
                servers.
              </p>
              <p>
                Our goal is to create a universal, prompt-based app builder
                that’s highly customizable. Code should always be accessible and
                developers should be in control. We believe most apps will be
                built or prototyped this way, and we're taking the first steps
                towards that goal.
              </p>
              <p>
                A fun fact is that model improvements were critical here: we
                could not achieve the consistent results we needed with any LLM
                prior to GPT-4o and Claude 3.5 Sonnet. In the future, we’ll
                allow users to modify the code to call their local GPT/LLM
                deployment via Ollama, rather than relying on OpenAI or
                Anthropic calls.
              </p>
              <p>
                If you’re building admin panels, database editors, back-office
                tools, billing/customer dashboards, and internal dev tools that
                can fetch data and trigger actions across any database,
                internal/external service or API, please give Dropbase a shot!
              </p>
              <p>We're excited to get your thoughts and questions!</p>
              <p>Demos:</p>
              <p>
                - Here’s a demo video:
                <a href="https://youtu.be/RaxHOjhy3hY"
                  >https://youtu.be/RaxHOjhy3hY</a
                >
              </p>
              <p>
                - We also introduced Charts (beta) in this version based on
                suggestions from cjohnson318 in our previous HN post:
                <a href="https://youtu.be/YWtdD7THTxE"
                  >https://youtu.be/YWtdD7THTxE</a
                >
              </p>
              <p>Useful links:</p>
              <p>
                - Repo here:
                <a href="https://github.com/DropbaseHQ/dropbase"
                  >https://github.com/DropbaseHQ/dropbase</a
                >. To setup locally, follow the quickstart guide in our docs
              </p>
              <p>
                - Docs:
                <a href="https://docs.dropbase.io">https://docs.dropbase.io</a>
              </p>
              <p>
                - Homepage:
                <a href="https://dropbase.io">https://dropbase.io</a>
              </p>
            </div>
          </section>
        </section>
        <section id="40947277">
          <h3>
            <a class="item" href="https://github.com/lldap/lldap"
              >lldap: Light LDAP Implementation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-12 @ 16:54:24</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40947277"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40947170">
          <h3>
            <a
              class="item"
              href="http://blog.mattstuchlik.com/2024/07/12/summing-integers-fast.html"
              >Summing ASCII encoded integers on Haswell at almost the speed of
              memcpy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-12 @ 16:42:37</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40947170"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40946033">
          <h3>
            <a class="item" href="https://github.com/taubyte/tau"
              >Tau: Open-source PaaS – A self-hosted Vercel / Netlify /
              Cloudflare alternative</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-12 @ 14:41:22</span
              ><span class="points-container"
                >Points: <span class="points">433</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40946033"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40945846">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2407.08447"
              >WildGaussians: 3D Gaussian Splatting in the Wild</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-12 @ 14:22:25</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40945846"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40944505">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2024/07/12/att-phone-records-stolen-data-breach/"
              >AT&amp;amp;T says criminals stole phone records of 'nearly all'
              customers in data breach</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-12 @ 11:17:54</span
              ><span class="points-container"
                >Points: <span class="points">852</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40944505"
                  >Comments</a
                ><span class="descendants">: 702</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40940241">
          <h3>
            <a class="item" href="https://mazzo.li/posts/value-speculation.html"
              >Beating the L1 cache with value speculation (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-11 @ 20:17:58</span
              ><span class="points-container"
                >Points: <span class="points">212</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40940241"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40925767">
          <h3>
            <a class="item" href="https://gaussiantracer.github.io/"
              >3D Gaussian Ray Tracing: Fast Tracing of Particle Scenes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-10 @ 11:30:37</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40925767"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40923096">
          <h3>
            <a class="item" href="https://crocotile3d.com/"
              >Crocotile3D low poly modelling tool</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-10 @ 02:05:05</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40923096"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40919160">
          <h3>
            <a class="item" href="https://github.com/flujoo/gm"
              >Show HN: Create Music with R</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-09 @ 18:15:31</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40919160"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40916326">
          <h3>
            <a class="item" href="https://github.com/bitwhip/bitwhip"
              >Show HN: 30ms latency screen sharing in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-09 @ 14:07:09</span
              ><span class="points-container"
                >Points: <span class="points">230</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40916326"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40906583">
          <h3>
            <a
              class="item"
              href="https://spaceraccoon.dev/universal-code-execution-browser-extensions/"
              >Universal Code Execution by Chaining Messages in Browser
              Extensions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 16:05:11</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40906583"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
