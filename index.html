<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36121253">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/laser-communications"
              >NASA's Laser Link Boasts Record-Breaking 200 Gbps Speed</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 04:54:21</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36121253"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36120972">
          <h3>
            <a class="item" href="https://tech.davis-hansson.com/p/clickbait/"
              >I gave commit rights to someone I didn't know (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 03:55:41</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36120972"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36120659">
          <h3>
            <a class="item" href="https://blainehansen.me/post/macro-ts/"
              >Macro-ts: TypeScript compiler with typesafe syntactic macros
              (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 02:56:11</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36120659"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36120531">
          <h3>
            <a
              class="item"
              href="https://pubs.geoscienceworld.org/geophysics/article-abstract/88/3/F29/622154/HDF5eis-A-storage-and-input-output-solution-for?redirectedFrom=fulltext"
              >HDF5eis: Storage IO solution for big multidimensional time series
              sensor data</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 02:32:07</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36120531"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36120484">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/2023/06/05/how-to-hire-a-pop-star-for-your-private-party"
              >How to hire a pop star for your private party</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 02:22:01</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36120484"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36119920">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2305.17743"
              >A chiral aperiodic monotile</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 00:47:32</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36119920"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36119102">
          <h3>
            <a
              class="item"
              href="https://ignore.pl/you_can_serve_static_data_over_http.html"
              >You can serve static data over HTTP</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 22:59:24</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36119102"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36119042">
          <h3>
            <a
              class="item"
              href="https://block21m.substack.com/p/most-bitcoin-inscriptions-belong-d6d"
              >Most Bitcoin Inscriptions belong to a single person</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 22:50:59</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36119042"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36118990">
          <h3>
            <a class="item" href="https://bigcapital.ly"
              >An open-source alternative to QuickBooks</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 22:44:09</span
              ><span class="points-container"
                >Points: <span class="points">258</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36118990"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36118913">
          <h3>
            <a class="item" href="https://raku-advent.blog/2022/12/20/sigils/"
              >Sigils are underappreciated (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 22:35:10</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36118913"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36118856">
          <h3>
            <a
              class="item"
              href="https://status.internetnz.nz/incidents/gq1c6slz3198"
              >DNSSEC KSK rollover breaks DNS resolution for .nz domains</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 22:29:38</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36118856"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36118707">
          <h3>
            <a
              class="item"
              href="https://twitter.com/wondermeg_/status/1662454909353033730"
              >HBO Max new Captcha system</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 22:10:46</span
              ><span class="points-container"
                >Points: <span class="points">443</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36118707"
                  >Comments</a
                ><span class="descendants">: 179</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36118470">
          <h3>
            <a class="item" href="https://mslivo.itch.io/setris"
              >Setris – Tetris with Sand Physics</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 21:44:32</span
              ><span class="points-container"
                >Points: <span class="points">205</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36118470"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36118074">
          <h3>
            <a
              class="item"
              href="https://deep-ivy-ltd.breezy.hr/p/055a500d0e8701-ml-research-engineer?ref=upstract.com"
              >Ivy (YC W23) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 21:01:13</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36117950">
          <h3>
            <a
              class="item"
              href="https://austinhenley.com/blog/superoptimizer.html"
              >My first superoptimizer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 20:47:30</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36117950"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36117558">
          <h3>
            <a
              class="item"
              href="https://www.interactions.org///press-release/lhc-experiments-see-first-evidence-rare-higgs-boson-decay"
              >LHC experiments see first evidence of a rare Higgs boson decay</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 20:10:36</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36117558"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36117037">
          <h3>
            <a class="item" href="https://minigdx.github.io/tiny/"
              >Show HN: Tiny – A 2D Game Engine in Kotlin Working with Lua</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 19:19:17</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36117037"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
            <div class="text">
              <p>
                The engine was created using Kotlin Multiplatform and can run on
                a JVM and JS. Funny things: Games can be created using the
                programming language Lua.
              </p>
              <p>
                Tiny is designed to help you create and test your ideas quickly
                and effectively. Not only can you run your games on your desktop
                computer, but you can also export them for the web, making it
                easy to share your creations with others.
              </p>
              <p>
                You can create games easily with the hot reload, small API and
                Lua, which is very easy to learn.
              </p>
              <p>
                If you want to test a game idea, to try to create your first
                game or just have fun, give it a try to Tiny.
              </p>
            </div>
          </section>
        </section>
        <section id="36116387">
          <h3>
            <a
              class="item"
              href="https://www.fastcompany.com/90893969/metaverse-was-never-alive-in-first-place"
              >The metaverse was never alive in the first place</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 18:09:09</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36116387"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36114896">
          <h3>
            <a
              class="item"
              href="https://www.catholicnewsagency.com/news/254032/wikipedia-had-the-wrong-vatican-city-flag-for-years-now-incorrect-flags-are-everywhere"
              >Wikipedia had wrong Vatican flag for years – now incorrect flags
              are everywhere</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 15:29:58</span
              ><span class="points-container"
                >Points: <span class="points">274</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36114896"
                  >Comments</a
                ><span class="descendants">: 120</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36114775">
          <h3>
            <a
              class="item"
              href="https://www.rheinmetall.com/en/media/news-watch/news/2023/mai/2023-05-16-rheinmetall-launches-first-pilot-project-for-innovative-curb-stone-chargers"
              >Rheinmetall pilot project for curb stone chargers for EVs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 15:14:52</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36114775"
                  >Comments</a
                ><span class="descendants">: 125</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36114562">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Johari_window"
              >The Johari Window</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 14:52:14</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36114562"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36113444">
          <h3>
            <a
              class="item"
              href="https://medium.com/onebigthought/the-ux-research-reckoning-is-here-c63710ea4084"
              >The UX Research Reckoning is Here</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 12:50:41</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36113444"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36112815">
          <h3>
            <a
              class="item"
              href="https://techxplore.com/news/2023-05-harvest-abundant-energy-thin-air.html"
              >Research on harvesting electricity from humidity in the air</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 11:12:58</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36112815"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36112053">
          <h3>
            <a
              class="item"
              href="https://fasterthanli.me/articles/a-terminal-case-of-linux"
              >A terminal case of Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 08:51:42</span
              ><span class="points-container"
                >Points: <span class="points">171</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36112053"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36110833">
          <h3>
            <a class="item" href="https://one-from-nippon.ghost.io/dagashiya/"
              >A peek inside Japan's largest “Dagashi” store</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 05:01:25</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36110833"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36110578">
          <h3>
            <a
              class="item"
              href="https://www.nybooks.com/articles/2023/06/08/unwanted-thoughts-index-of-prohibited-books-vose/"
              >Unwanted Thoughts: a new history of the Index of Prohibited
              Books</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-29 @ 04:14:00</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36110578"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36105603">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/articles/cash-only-movement-apple-pay-paper-money-3814f75a"
              >Pro-cash movement warns that people could be losing more than
              they bargained for</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-28 @ 16:39:07</span
              ><span class="points-container"
                >Points: <span class="points">361</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36105603"
                  >Comments</a
                ><span class="descendants">: 533</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36104055">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2023/5/28/23738957/youtube-videos-24-hours-blank-screen"
              >The odd appeal of absurdly long YouTube videos</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-28 @ 14:01:50</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36104055"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36103240">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/1954/06/05/tenzing-of-everest"
              >The First Sherpa to Climb to the Top of Mt. Everest (1954)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-28 @ 11:54:18</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36103240"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36101004">
          <h3>
            <a
              class="item"
              href="https://archive.org/details/1999_Game_Developers_Conference_Audio"
              >1999 Game Developers Conference (GDC) Recordings Archive</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-28 @ 04:01:00</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36101004"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
