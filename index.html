<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="46386009">
          <h3>
            <a
              class="item"
              href="https://cyata.ai/blog/langgrinch-langchain-core-cve-2025-68664/"
              >All I Want for Xmas Is Your Secrets: LangGrinch Hits LangChain
              (CVE-2025-68664)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-25 @ 18:06:44</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46386009"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46385600">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/clearspace/jobs/5LtM86I-founding-network-engineer-at-clearspace"
              >Clearspace (YC W23) Is Hiring a Founding Network Engineer (VPN
              and Proxy)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-25 @ 17:01:29</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46385308">
          <h3>
            <a
              class="item"
              href="https://www.deepsouthventures.com/i-sell-onions-on-the-internet/"
              >I sell onions on the Internet (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-25 @ 16:24:45</span
              ><span class="points-container"
                >Points: <span class="points">267</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46385308"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46384919">
          <h3>
            <a
              class="item"
              href="https://case.edu/news/new-study-shows-alzheimers-disease-can-be-reversed-achieve-full-neurological-recovery-not-just-prevented-or-slowed-animal-models"
              >Alzheimer’s disease can be reversed in animal models: Study</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-25 @ 15:22:36</span
              ><span class="points-container"
                >Points: <span class="points">349</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46384919"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46384565">
          <h3>
            <a
              class="item"
              href="https://daniel.lawrence.lu/blog/2024-12-01-asahi-linux-with-sway-on-the-macbook-air-m2/"
              >Asahi Linux with Sway on the MacBook Air M2</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-25 @ 14:20:29</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46384565"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46384167">
          <h3>
            <a
              class="item"
              href="https://fidget-spinner.github.io/posts/no-longer-sorry.html"
              >Python 3.15’s interpreter for Windows x86-64 should hopefully be
              15% faster</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-25 @ 13:02:46</span
              ><span class="points-container"
                >Points: <span class="points">247</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46384167"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46383675">
          <h3>
            <a
              class="item"
              href="https://github.com/mattermost/mattermost/issues/34271"
              >Mattermost restricted access to old messages after 10000 limit is
              reached</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-25 @ 11:03:59</span
              ><span class="points-container"
                >Points: <span class="points">313</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46383675"
                  >Comments</a
                ><span class="descendants">: 186</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46383552">
          <h3>
            <a
              class="item"
              href="https://www.bbc.co.uk/news/articles/cdxwllqz1l0o"
              >We invited a man into our home at Christmas and he stayed with us
              for 45 years</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-25 @ 10:35:34</span
              ><span class="points-container"
                >Points: <span class="points">767</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46383552"
                  >Comments</a
                ><span class="descendants">: 183</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46383233">
          <h3>
            <a class="item" href="https://algassert.com/post/2503"
              >Quantum Error Correction Goes FOOM</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-25 @ 09:18:15</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46383233"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46383139">
          <h3>
            <a
              class="item"
              href="https://0l.de/blog/2015/01/bachelor-thesis-abstract/"
              >Self-referencing Page Tables for the x86-Architecture</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-25 @ 08:58:23</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46383139"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46382011">
          <h3>
            <a
              class="item"
              href="https://www.ruby-lang.org/en/news/2025/12/25/ruby-4-0-0-released/"
              >Ruby 4.0.0</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-25 @ 04:13:00</span
              ><span class="points-container"
                >Points: <span class="points">628</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46382011"
                  >Comments</a
                ><span class="descendants">: 140</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46380758">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=oYU2hAbx_Fc"
              >Who Watches the Waymos? I do [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-25 @ 00:10:12</span
              ><span class="points-container"
                >Points: <span class="points">248</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46380758"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
            <div class="text">
              <a href="https://x.com/fulligin/status/2003925653113184498"
                >https://x.com/fulligin/status/2003925653113184498</a
              >
              <p>
                <a
                  href="https://xcancel.com/fulligin/status/2003925653113184498"
                  >https://xcancel.com/fulligin/status/2003925653113184498</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="46380399">
          <h3>
            <a
              class="item"
              href="https://github.com/hkjarral/Asterisk-AI-Voice-Agent"
              >Asterisk AI Voice Agent</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-24 @ 23:25:37</span
              ><span class="points-container"
                >Points: <span class="points">176</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46380399"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46380168">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=46380168"
              >Tell HN: Merry Christmas</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-24 @ 22:56:00</span
              ><span class="points-container"
                >Points: <span class="points">1787</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46380168"
                  >Comments</a
                ><span class="descendants">: 391</span></span
              >
            </h4>
            <div class="text">
              <p>
                Merry Christmas to everyone. I hope you get some rest and can
                spend time with people who are dear to you and get to focus on
                what's important rather than getting lost in stressing about
                everything having to be perfect.
              </p>
              <p>
                Also much love to everyone who cannot spend their Christmas with
                dear people.
              </p>
              <p>
                To make sure this post meets the relevancy criteria, here is a
                Wikipedia article about some Christmas (more precisely advent)
                tradition which I personally really like:
                <a href="https://en.wikipedia.org/wiki/Christmas_market"
                  >https://en.wikipedia.org/wiki/Christmas_market</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="46380075">
          <h3>
            <a class="item" href="https://git.dec05eba.com/phoenix/about/"
              >Phoenix: A modern X server written from scratch in Zig</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-24 @ 22:43:53</span
              ><span class="points-container"
                >Points: <span class="points">593</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46380075"
                  >Comments</a
                ><span class="descendants">: 345</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46379145">
          <h3>
            <a class="item" href="https://evan.widloski.com/posts/spinners/"
              >Show HN: Lamp Carousel – DIY kinetic sculpture powered by lamp
              heat</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-24 @ 20:56:53</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46379145"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
            <div class="text">
              <p>
                There are a variety of shapes that work, but generally
                bigger+lighter spinners are better. Also incandescent bulbs are
                the best, but LEDs work too.
              </p>
              <p>
                They remind me of candle carousels I would see at my
                grandparents' house during Christmas. Let me know what you
                think!
              </p>
            </div>
          </section>
        </section>
        <section id="46378554">
          <h3>
            <a class="item" href="https://github.com/antonmedv/textarea"
              >Show HN: Minimalist editor that lives in browser, stores
              everything in the URL</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-24 @ 19:42:25</span
              ><span class="points-container"
                >Points: <span class="points">413</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46378554"
                  >Comments</a
                ><span class="descendants">: 153</span></span
              >
            </h4>
            <div class="text">
              <p>What it does:</p>
              <p>Single HTML file, no deps, 111 loc</p>
              <p>Notes live in the URL hash (shareable links!)</p>
              <p>Auto-compressed with CompressionStream</p>
              <p>Plain-text editor (contenteditable)</p>
              <p>History support</p>
              <p>Page title from first # heading</p>
              <p>Respects light/dark mode</p>
              <p>No storage, cookies, or tracking</p>
              <p>The entire app is the page source.</p>
              <p><a href="https://textarea.my/">https://textarea.my/</a></p>
            </div>
          </section>
        </section>
        <section id="46377862">
          <h3>
            <a
              class="item"
              href="https://www.ipaidia.gr/wp-content/uploads/2020/12/117-2020-fabrice-bellard.pdf"
              >Fabrice Bellard: Biography (2009) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-24 @ 18:17:47</span
              ><span class="points-container"
                >Points: <span class="points">332</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46377862"
                  >Comments</a
                ><span class="descendants">: 112</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46377597">
          <h3>
            <a class="item" href="https://github.com/VibiumDev/vibium"
              >Show HN: Vibium – Browser automation for AI and humans, by
              Selenium's creator</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-24 @ 17:49:02</span
              ><span class="points-container"
                >Points: <span class="points">393</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46377597"
                  >Comments</a
                ><span class="descendants">: 112</span></span
              >
            </h4>
            <div class="text">
              i started the selenium project 21 years ago. vibium is what i'd
              build if i started over today with ai agents in mind. go binary
              under the hood (handles browser, bidi, mcp) but devs never see it.
              just npm install vibium. python/java coming. for claude code:
              claude mcp add vibium -- npx -y vibium v1 ships today. ama.
            </div>
          </section>
        </section>
        <section id="46367224">
          <h3>
            <a
              class="item"
              href="https://github.com/bellard/mquickjs/blob/main/README.md"
              >Fabrice Bellard Releases MicroQuickJS</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-23 @ 17:33:42</span
              ><span class="points-container"
                >Points: <span class="points">1424</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46367224"
                  >Comments</a
                ><span class="descendants">: 536</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46357362">
          <h3>
            <a
              class="item"
              href="https://etc.octavore.com/2025/12/archiving-git-branches-as-tags/"
              >Archiving Git Branches as Tags</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-22 @ 18:52:50</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46357362"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46352588">
          <h3>
            <a
              class="item"
              href="https://thedailywtf.com/articles/The_Inner-Platform_Effect"
              >The Inner-Platform Effect (2006)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-22 @ 09:34:28</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46352588"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46351666">
          <h3>
            <a
              class="item"
              href="https://blog.miguelgrinberg.com/post/csrf-protection-without-tokens-or-hidden-form-fields"
              >CSRF protection without tokens or hidden form fields</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-22 @ 05:38:33</span
              ><span class="points-container"
                >Points: <span class="points">281</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46351666"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46336577">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/news/press-room/the-entire-new-yorker-archive-is-now-fully-digitized"
              >The entire New Yorker archive is now digitized</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-20 @ 14:49:39</span
              ><span class="points-container"
                >Points: <span class="points">231</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46336577"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46330732">
          <h3>
            <a class="item" href="https://github.com/NVIDIA/cuda-tile"
              >CUDA Tile Open Sourced</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-19 @ 20:49:54</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46330732"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46327191">
          <h3>
            <a class="item" href="https://coe.psu.ac.th/ad/explore/"
              >Show HN: Exploring Mathematics with Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-19 @ 15:55:30</span
              ><span class="points-container"
                >Points: <span class="points">201</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46327191"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46320249">
          <h3>
            <a
              class="item"
              href="https://douira.dev/assets/document/douira-master-thesis.pdf"
              >Geometric Algorithms for Translucency Sorting in Minecraft
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-18 @ 23:25:46</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46320249"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46319382">
          <h3>
            <a
              class="item"
              href="https://www.openculture.com/2017/12/the-first-photographs-of-snowflakes.html"
              >The First Photographs of Snowflakes Discover the Groundbreaking
              Microphotography</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-18 @ 21:58:50</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46319382"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46315658">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=46315658"
              >Ask HN: How do I bridge the gap between PhD and SWE
              experiences?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-18 @ 17:20:23</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46315658"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
            <div class="text">
              <p>
                I’m now at a point where I want to merge my scientific
                background with my engineering experience. However, I’m finding
                a "missing middle" in the job market. I don't ever see a
                position that requires and values deep expertise in both.
              </p>
              <p>
                I enjoy development, but I feel like my scientific training is
                going to waste. For those who have successfully merged these two
                paths:
              </p>
              <p>
                Did you find a "unicorn" role, or did you create one within a
                company?
              </p>
              <p>
                How do you market yourself when your two halves feel like they
                belong to different resumes?
              </p>
            </div>
          </section>
        </section>
        <section id="46315583">
          <h3>
            <a
              class="item"
              href="https://joannabregan.substack.com/p/toys-with-the-highest-play-time-and"
              >Toys with the highest play-time and lowest clean-up-time</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-18 @ 17:14:50</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46315583"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
