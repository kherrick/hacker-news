<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38634562">
          <h3>
            <a class="item" href="https://github.com/hbakri/django-ninja-crud"
              >Show HN: Django Ninja CRUD – Rethinking CRUD Operations in
              Django</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-13 @ 21:43:23</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38634562"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <p>
                Key aspects: - Declarative, intuitive CRUD operations. - Modular
                approach with composition-over-inheritance. - Enhanced testing
                capabilities for robust applications.
              </p>
              <p>
                The tool is designed to transform Django development workflows,
                improving efficiency and maintainability.
              </p>
              <p>
                Read more about the development, features and roadmap here:
                <a
                  href="https://medium.com/@hbakri/introducing-django-ninja-crud-ee937bd2ea65"
                  >https://medium.com/@hbakri/introducing-django-ninja-crud-ee9...</a
                >
              </p>
              <p>
                GitHub Repository:
                <a href="https://github.com/hbakri/django-ninja-crud"
                  >https://github.com/hbakri/django-ninja-crud</a
                >
              </p>
              <p>
                I'm eager to hear your feedback and hope it adds value to your
                Django projects!
              </p>
            </div>
          </section>
        </section>
        <section id="38634490">
          <h3>
            <a class="item" href="https://huggingface.co/microsoft/phi-2"
              >Phi-2</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-13 @ 21:36:53</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38634490"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38634218">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2312.06937"
              >Can a Transformer Represent a Kalman Filter?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-13 @ 21:15:27</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38634218"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38634213">
          <h3>
            <a
              class="item"
              href="https://www.abc.net.au/news/2023-12-13/engineered-stone-ban-discussed-at-ministers-meeting/103224362"
              >Australia to Ban Engineered Stone</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-13 @ 21:14:15</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38634213"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38634164">
          <h3>
            <a
              class="item"
              href="https://www.allthingsdistributed.com/2023/11/tech-predictions-for-2024-and-beyond.html"
              >Tech Predictions for 2024 and Beyond Dr. Werner Vogels, CTO,
              Amazon.com</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-13 @ 21:09:13</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38634164"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38634068">
          <h3>
            <a
              class="item"
              href="https://jobs.lever.co/prelay/832af523-bf6c-4fe0-8b9a-29084543a923"
              >Prelay (YC W20) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-13 @ 21:00:27</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38634020">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=38634020"
              >Ask HN: Best resources on abstracting and dealing with
              complexity</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-13 @ 20:56:26</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38634020"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
            <div class="text">
              What would be your recommendations on resources that teach on how
              to abstract away and cope with complexity and hierarchy in
              technical domains?
            </div>
          </section>
        </section>
        <section id="38633926">
          <h3>
            <a class="item" href="https://jawj.github.io/fliptiles/"
              >Play Othello in your web browser (made with Mithril)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-13 @ 20:48:34</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38633926"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38633715">
          <h3>
            <a
              class="item"
              href="https://twitter.com/ID_AA_Carmack/status/1734993768980402467"
              >Quest 2 is outselling Quest 3</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-13 @ 20:27:56</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38633715"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38632970">
          <h3>
            <a class="item" href="https://github.com/rochus-keller/CspChan"
              >Show HN: A pure C89 implementation of Go channels, with blocking
              selects</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-13 @ 19:31:44</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38632970"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38632966">
          <h3>
            <a
              class="item"
              href="https://www.bitsaboutmoney.com/archive/the-long-shadow-of-checks/"
              >The Long Shadow of Checks</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-13 @ 19:31:25</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38632966"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38632827">
          <h3>
            <a
              class="item"
              href="https://a16z.com/announcing-our-latest-open-source-ai-grants/"
              >2nd Batch of the A16Z Open Source AI Grant</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-13 @ 19:24:17</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38632827"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38632492">
          <h3>
            <a class="item" href="https://smerf-3d.github.io/"
              >SMERF: Streamable Memory Efficient Radiance Fields</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-13 @ 19:03:13</span
              ><span class="points-container"
                >Points: <span class="points">237</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38632492"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
            <div class="text">
              <p>
                Over the last few months, my collaborators and I have put
                together a new, real-time method that makes NeRF models
                accessible from smartphones, laptops, and low-power desktops,
                and we think we’ve done a pretty stellar job! SMERF, as we like
                to call it, distills a large, high quality NeRF into a
                real-time, streaming-ready representation that’s easily deployed
                to devices as small as a smartphone via the web browser.
              </p>
              <p>
                On top of that, our models look great! Compared to other
                real-time methods, SMERF has higher accuracy than ever before.
                On large multi-room scenes, SMERF renders are nearly
                indistinguishable from state-of-the-art offline models like
                Zip-NeRF and a solid leap ahead of other approaches.
              </p>
              <p>
                The best part: you can try it out yourself! Check out our
                project website for demos and more.
              </p>
              <p>
                If you have any questions or feedback, don’t hesitate to reach
                out by email (smerf@google.com) or Twitter (@duck).
              </p>
            </div>
          </section>
        </section>
        <section id="38632250">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/future/article/20231212-the-sound-that-warns-a-tornado-is-coming"
              >Low-frequency sound can reveal that a tornado is on its way</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-13 @ 18:49:23</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38632250"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38631647">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/news/2023/dec/12/my-doomed-career-as-a-north-korean-novelist"
              >My doomed career as a North Korean novelist</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-13 @ 18:16:01</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38631647"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38629859">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/2023/12/18/all-the-carcinogens-we-cannot-see"
              >Carcinogens that don’t create cancer cells but rouse them</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-13 @ 16:38:17</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38629859"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38629626">
          <h3>
            <a
              class="item"
              href="https://ubuntu.com/blog/ubuntu-performance-engineering-with-frame-pointers-by-default"
              >Ubuntu 24.04 LTS will enable frame pointers by default</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-13 @ 16:23:01</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38629626"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38629539">
          <h3>
            <a class="item" href="https://github.com/ofek/pyapp"
              >Show HN: PyApp – runtime installer for Python applications</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-13 @ 16:17:08</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38629539"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38628489">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/2023/12/12/cortex-a57-nintendo-switchs-cpu/"
              >Cortex A57, Nintendo Switch's CPU</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-13 @ 15:11:26</span
              ><span class="points-container"
                >Points: <span class="points">159</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38628489"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38628417">
          <h3>
            <a
              class="item"
              href="https://cloud.google.com/blog/products/ai-machine-learning/imagen-2-on-vertex-ai-is-now-generally-available"
              >Google Imagen 2</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-13 @ 15:07:05</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38628417"
                  >Comments</a
                ><span class="descendants">: 142</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38628184">
          <h3>
            <a
              class="item"
              href="https://owehrens.com/whisper-nvidia-rtx-4090-vs-m1pro-with-mlx/"
              >Whisper: Nvidia RTX 4090 vs. M1 Pro with MLX</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-13 @ 14:52:36</span
              ><span class="points-container"
                >Points: <span class="points">307</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38628184"
                  >Comments</a
                ><span class="descendants">: 133</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38627864">
          <h3>
            <a
              class="item"
              href="https://people.ece.ubc.ca/sasha/papers/eurosys16-final29.pdf"
              >The Linux Scheduler: A Decade of Wasted Cores (2016) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-13 @ 14:31:27</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38627864"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38627821">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/q-a-with-co-creator-of-the-6502-processor"
              >Q&amp;amp;A With Bill Mensch, co-creator of the 6502</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-13 @ 14:28:09</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38627821"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38627674">
          <h3>
            <a
              class="item"
              href="https://quinnkeast.com/writing/its-weird-how-design-systems-are-so-rote-yet-so-difficult"
              >It's weird how design systems are so rote, yet so difficult</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-13 @ 14:17:19</span
              ><span class="points-container"
                >Points: <span class="points">115</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38627674"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38627114">
          <h3>
            <a
              class="item"
              href="https://english.elpais.com/science-tech/2023-12-12/the-origin-of-mysterious-green-ghosts-in-the-sky-has-been-discovered.html"
              >Origin of mysterious green 'ghosts' in the sky has been
              discovered</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-13 @ 13:36:43</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38627114"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38621270">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/technology/space/us-agency-will-not-reinstate-900-mln-subsidy-spacex-starlink-unit-2023-12-13/"
              >US agency will not reinstate $900M subsidy for Starlink</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-13 @ 01:05:34</span
              ><span class="points-container"
                >Points: <span class="points">174</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38621270"
                  >Comments</a
                ><span class="descendants">: 494</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38614054">
          <h3>
            <a
              class="item"
              href="https://wheybags.com/dungeons_and_directories/"
              >Dungeons and Directories, an exploration game in your file
              explorer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-12 @ 16:08:06</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38614054"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38612680">
          <h3>
            <a class="item" href="https://aods.cryingpotato.com"
              >Show HN: Advent of Distributed Systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-12 @ 14:38:13</span
              ><span class="points-container"
                >Points: <span class="points">229</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38612680"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
            <div class="text">
              <a href="https://aods.cryingpotato.com/"
                >https://aods.cryingpotato.com/</a
              >) where you can work through the Fly.io distributed systems
              challenges (<a href="https://fly.io/dist-sys/1/"
                >https://fly.io/dist-sys/1/</a
              >) directly in your browser. Running challenges like this directly
              in the browser has often been the best way for me to get the
              activation energy to start them since it bypasses all the annoying
              dev environment setup that has to happen as a precursor to working
              on it.
              <p>
                The coding environment was built with another project I'm
                working on called Cannon (<a
                  href="https://cannon.cryingpotato.com/"
                  >https://cannon.cryingpotato.com/</a
                >) that aims to let you embed codeblocks of any language in your
                browser. Right now the Go environment runs on a Modal backend
                using their sandbox, but I'm hoping to use the excellent work
                done on Hackpad (<a
                  href="https://github.com/hack-pad/hackpad/tree/main"
                  >https://github.com/hack-pad/hackpad/tree/main</a
                >) to run the whole thing in your browser, with no network calls
                necessary, soon.
              </p>
              <p>Let me know what you think - week 3 is coming out soon!</p>
            </div>
          </section>
        </section>
        <section id="38611422">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-023-03975-7"
              >'Biocomputer' combines lab-grown brain tissue with electronic
              hardware</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-12 @ 12:41:58</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38611422"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38610090">
          <h3>
            <a
              class="item"
              href="https://www.bafta.org/media-centre/transcripts/screenwriters-lecture-charlie-kaufman"
              >Screenwriters' Lecture: Charlie Kaufman (2011)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-12 @ 06:03:37</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38610090"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
