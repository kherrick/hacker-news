<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="35955062">
          <h3>
            <a
              class="item"
              href="https://www.amygoodchild.com/blog/computer-art-50s-and-60s"
              >Early Computer Art in the 50s and 60s</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 21:57:52</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35955062"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35954481">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2305.06161"
              >StarCoder and StarCoderBase: 15.5B parameter models with 8K
              context length</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 21:06:05</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35954481"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35954422">
          <h3>
            <a
              class="item"
              href="https://www.kaspersky.com/blog/fake-trezor-hardware-crypto-wallet/48155/"
              >Kaspersky: Case study: fake hardware cryptowallet (Trezor)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 21:01:20</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35954422"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35954420">
          <h3>
            <a
              class="item"
              href="https://deep-ivy-ltd.breezy.hr/p/055a500d0e8701-ml-research-engineer"
              >Ivy (YC W23) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 21:01:01</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35954325">
          <h3>
            <a class="item" href="https://clic.epfl.ch/news/49"
              >EPFL cancels Stallman's lecture citing “the situation regarding”
              his persona</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 20:52:09</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35954325"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35954259">
          <h3>
            <a
              class="item"
              href="http://www.janromme.com/2023/05/ChaptGPT-transaltion-of-Akkadian-texts.html"
              >Translating Akkadian clay tablets with ChatGPT?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 20:46:28</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35954259"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35954208">
          <h3>
            <a
              class="item"
              href="https://www.nih.gov/news-events/news-releases/clinical-trial-mrna-universal-influenza-vaccine-candidate-begins"
              >Clinical trial of mRNA universal influenza vaccine candidate
              begins</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 20:42:54</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35954208"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35953286">
          <h3>
            <a class="item" href="https://openprocessing.org/sketch/1575230/"
              >random(random(random(random())))</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 19:23:54</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35953286"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35952206">
          <h3>
            <a class="item" href="https://github.com/SysSec-KAIST/LTESniffer"
              >LTESniffer – An Open-Source LTE Downlink/Uplink Eavesdropper</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 18:08:55</span
              ><span class="points-container"
                >Points: <span class="points">165</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35952206"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35951867">
          <h3>
            <a
              class="item"
              href="https://forum.rvspace.org/t/unlocking-new-possibilities-starfive-visionfive-2-sbc-now-supports-tianocore-edk-ii-uefi/2779"
              >StarFive VisionFive 2 SBC Now Supports TianoCore EDK II (UEFI)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 17:47:12</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35951867"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35951703">
          <h3>
            <a class="item" href="https://www.openlayer.com/?ref=hn"
              >Show HN: Openlayer – Test, fix, and improve your ML models</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 17:35:24</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35951703"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
            <div class="text">
              <a href="http://openlayer.com/">http://openlayer.com/</a>
              <p>
                Openlayer is an ML testing, evaluation, and observability
                platform designed to help teams pinpoint and resolve issues in
                their models.
              </p>
              <p>
                We were ML engineers experiencing the struggle that goes into
                properly evaluating models, making them robust to the myriad of
                unexpected edge cases they encounter in production, and
                understanding the reasons behind their mistakes. It was like
                playing an endless game of whack-a-mole with Jupyter notebooks
                and CSV files — fix one issue and another pops up. This
                shouldn’t be the case. Error analysis is vital to establishing
                guardrails for AI and ensuring fairness across model
                predictions.
              </p>
              <p>
                Traditional software testing platforms are designed for
                deterministic systems, where a given input produces an expected
                output. Since ML models are probabilistic, testing them reliably
                has been a challenge. What sets Openlayer apart from other
                companies in the space is our end-to-end approach to tackling
                both pre- and post-deployment stages of the ML pipeline. This
                "shift-left" approach emphasizes the importance of thorough
                validation before you ship, rather than relying solely on
                monitoring after you deploy. Having a strong evaluation process
                pre-ship means fewer bugs for your users, shorter and more
                efficient dev-cycles, and lower chances of getting into a PR
                disaster or having to recall a model.
              </p>
              <p>
                Openlayer provides ML teams and individuals with a suite of
                powerful tools to understand models and data beyond your typical
                metrics. The platform offers insights about the quality of your
                training and validation sets, the performance of your model
                across subpopulations of your data, and much more. Each of these
                insights can be turned into a “goal.” As you commit new versions
                of your models and data, you can see how your model progresses
                towards these goals, as you guard against regressions you may
                have otherwise not picked up on and continually raise the bar.
              </p>
              <p>Here's a quick rundown of the Openlayer workflow:</p>
              <p>
                1. Add a hook in your training / data ingestion pipeline to
                upload your data and model predictions to Openlayer via our API
              </p>
              <p>
                2. Explore insights about your models and data and create goals
                around them [1]
              </p>
              <p>
                3. Diagnose issues with the help of our platform, using powerful
                tools like explainability (e.g. SHAP values) to get actionable
                recommendations on how to improve
              </p>
              <p>
                4. Track the progress over time towards your goals with our UI
                and API and create new ones to keep improving
              </p>
              <p>
                We've got a free sandbox for you to try out the platform today!
                You can sign up here:
                <a href="https://app.openlayer.com/"
                  >https://app.openlayer.com/</a
                >. We are also soon adding support for even more ML tasks, so
                please reach out if your use case is not supported and we can
                add you to a waitlist.
              </p>
              <p>
                Give Openlayer a spin and join us in revolutionizing ML
                development for greater efficiency and success. Let us know what
                you think, or if you have any questions about Openlayer or model
                evaluation in general.
              </p>
              <p>
                [1] A quick run-down of the categories of goals you can track:
              </p>
              <p>
                - <i>Integrity</i> goals measure the quality of your validation
                and training sets
              </p>
              <p>
                - <i>Consistency</i> goals guard against drift between your
                datasets
              </p>
              <p>
                - <i>Performance</i> goals evaluate your model's performance
                across subpopulations of the data
              </p>
              <p>
                - <i>Robustness</i> goals stress-test your model using synthetic
                data to uncover edge cases
              </p>
              <p>
                - <i>Fairness</i> goals help you understand biases in your model
                on sensitive populations
              </p>
            </div>
          </section>
        </section>
        <section id="35951126">
          <h3>
            <a class="item" href="https://www.sortabase.com/"
              >Show HN: Sortabase, a collaborative, visual database builder for
              communities</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 16:53:18</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35951126"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
            <div class="text">
              <p>
                The fields of each database are defined by its moderators using
                a no-code drag-n-drop interface, and the resulting database is
                easy to search, filter, sort, and contribute to.
              </p>
              <p>
                The platform is 100% free to use - take a look, and feedback is
                appreciated!
              </p>
            </div>
          </section>
        </section>
        <section id="35950836">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/business/2023/05/15/irs-free-file/"
              >IRS tests free e-filing system that could compete with tax prep
              giants</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 16:31:29</span
              ><span class="points-container"
                >Points: <span class="points">669</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35950836"
                  >Comments</a
                ><span class="descendants">: 327</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35950716">
          <h3>
            <a class="item" href="https://dynomight.net/procrastination/"
              >Taxonomy of Procrastination</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 16:23:18</span
              ><span class="points-container"
                >Points: <span class="points">214</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35950716"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35950094">
          <h3>
            <a class="item" href="https://www.thisworddoesnotexist.com/"
              >This Word Does Not Exist</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 15:44:01</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35950094"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35949368">
          <h3>
            <a
              class="item"
              href="https://www.infoq.com/news/2023/05/gcc13-c2x-features/"
              >GCC 13 Supports New C2x Features, Including Nullptr, Enhanced
              Enumerations</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 15:06:10</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35949368"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35949317">
          <h3>
            <a class="item" href="https://www.lobbyfacts.eu/"
              >LobbyFacts – Exposing lobbying in European institutions</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 15:02:42</span
              ><span class="points-container"
                >Points: <span class="points">296</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35949317"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35948742">
          <h3>
            <a
              class="item"
              href="https://twitter.com/jlowin/status/1658117052425543682"
              >Anthropic's 100k context is now available in the web UI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 14:29:50</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35948742"
                  >Comments</a
                ><span class="descendants">: 148</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35948462">
          <h3>
            <a class="item" href="https://github.com/toverainc/willow"
              >Show HN: Willow – Open-source privacy-focused voice assistant
              hardware</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 14:13:35</span
              ><span class="points-container"
                >Points: <span class="points">421</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35948462"
                  >Comments</a
                ><span class="descendants">: 108</span></span
              >
            </h4>
            <div class="text">
              <p>
                I love Home Assistant and I've always thought the ESP BOX[0]
                hardware is cool. I finally got around to starting a project to
                use the ESP BOX hardware with Home Assistant and other
                platforms. Why?
              </p>
              <p>
                - It's actually "Alexa/Echo competitive". Wake word detection,
                voice activity detection, echo cancellation, automatic gain
                control, and high quality audio for $50 means with Willow and
                the support of Home Assistant there are no compromises on looks,
                quality, accuracy, speed, and cost.
              </p>
              <p>
                - It's cheap. With a touch LCD display, dual microphones,
                speaker, enclosure, buttons, etc it can be bought today for $50
                all-in.
              </p>
              <p>
                - It's ready to go. Take it out of the box, flash with Willow,
                put it somewhere.
              </p>
              <p>
                - It's not creepy. Voice is either sent to a self-hosted
                inference server or commands are recognized locally on the ESP
                BOX.
              </p>
              <p>
                - It doesn't hassle or try to sell you. If I hear "Did you
                know?" one more time from Alexa I think I'm going to lose it.
              </p>
              <p>- It's open source.</p>
              <p>
                - It's capable. This is the first "release" of Willow and I
                don't think we've even begun scratching the surface of what the
                hardware and software components are capable of.
              </p>
              <p>
                - It can integrate with anything. Simple on the wire format -
                speech output text is sent via HTTP POST to whatever URI you
                configure. Send it anywhere, and do anything!
              </p>
              <p>
                - It still does cool maker stuff. With 16 GPIOs exposed on the
                back of the enclosure there are all kinds of interesting
                possibilities.
              </p>
              <p>
                This is the first (and VERY early) release but we're really
                interested to hear what HN thinks!
              </p>
              <p>
                [0] -
                <a href="https://github.com/espressif/esp-box"
                  >https://github.com/espressif/esp-box</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="35948268">
          <h3>
            <a class="item" href="http://wiki.c2.com"
              >Come back, c2.com, we still need you</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 14:01:53</span
              ><span class="points-container"
                >Points: <span class="points">290</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35948268"
                  >Comments</a
                ><span class="descendants">: 111</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35946955">
          <h3>
            <a
              class="item"
              href="https://github.com/chathub-dev/chathub/blob/main/README.md"
              >Show HN: Use ChatGPT, Bing, Bard and Claude in One App</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 12:11:32</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35946955"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35946078">
          <h3>
            <a class="item" href="https://github.com/zwegner/x86-sat"
              >Basic SAT model of x86 instructions using Z3, autogenerated from
              Intel docs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 10:35:28</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35946078"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35944159">
          <h3>
            <a class="item" href="https://warms.maxbittker.repl.co/"
              >Pixpaint</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-15 @ 05:23:13</span
              ><span class="points-container"
                >Points: <span class="points">238</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35944159"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35939171">
          <h3>
            <a
              class="item"
              href="http://theprogrammersparadox.blogspot.com/2023/04/software-development-ethics.html"
              >Software Development Ethics</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-14 @ 16:32:52</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35939171"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35937554">
          <h3>
            <a class="item" href="https://hpbn.co/"
              >High Performance Browser Networking</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-14 @ 12:47:47</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35937554"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35937220">
          <h3>
            <a class="item" href="https://maskray.me/blog/2023-05-08-assemblers"
              >Assemblers: Popular assemblers and their architecture-specific
              differences</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-14 @ 11:36:48</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35937220"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35936915">
          <h3>
            <a
              class="item"
              href="https://byrnehobart.medium.com/writing-good-career-move-terrible-career-ad672663ea3b"
              >Writing: Good career move, terrible career</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-14 @ 10:26:42</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35936915"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35936885">
          <h3>
            <a class="item" href="https://susam.github.io/devil/"
              >Devil Mode for Emacs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-14 @ 10:18:27</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35936885"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35936665">
          <h3>
            <a class="item" href="https://makefiletutorial.com/#top"
              >Learn Makefiles with the Tastiest Examples</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-14 @ 09:34:38</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35936665"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35935796">
          <h3>
            <a class="item" href="https://learningmusic.ableton.com/"
              >Get started making music</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-14 @ 06:28:53</span
              ><span class="points-container"
                >Points: <span class="points">246</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35935796"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
