<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43517337">
          <h3>
            <a class="item" href="https://veloren.net/"
              >Veloren – voxel action-adventure role-playing in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-29 @ 18:05:08</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43517337"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43517318">
          <h3>
            <a
              class="item"
              href="https://hackread.com/twitter-x-of-2-8-billion-data-leak-an-insider-job/"
              >Twitter (X) Hit by Data Leak of 2.8B Users – Allegedly an Insider
              Job</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-29 @ 18:02:42</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43517318"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43517301">
          <h3>
            <a
              class="item"
              href="https://tedium.co/2025/03/29/severance-apple-remote-editing-weirdness/"
              >Why Apple's Severance Gets Edited over Remote Desktop Software</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-29 @ 18:00:48</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43517301"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43517234">
          <h3>
            <a class="item" href="https://github.com/Overv/vramfs"
              >Vramfs: Vram Based Filesystem for Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-29 @ 17:51:12</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43517234"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43516879">
          <h3>
            <a
              class="item"
              href="https://www.pewresearch.org/religion/2025/03/26/around-the-world-many-people-are-leaving-their-childhood-religions/"
              >Around the World, Many People Are Leaving Their Childhood
              Religions</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-29 @ 16:59:41</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43516879"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43516733">
          <h3>
            <a
              class="item"
              href="https://richardzach.org/2025/03/accessible-open-textbooks-in-math-heavy-disciplines/"
              >Accessible open textbooks in math-heavy disciplines</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-29 @ 16:38:01</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43516733"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43515426">
          <h3>
            <a
              class="item"
              href="https://github.com/typedgrammar/typed-japanese"
              >Typed Japanese</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-29 @ 13:36:14</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43515426"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43514915">
          <h3>
            <a class="item" href="https://koto.dev/"
              >Koto Programming Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-29 @ 12:14:48</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43514915"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43514695">
          <h3>
            <a class="item" href="https://github.com/misprit7/real-time-chess"
              >Real Time Chess – A physical chess board without the concept of
              turns</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-29 @ 11:41:54</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43514695"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43514383">
          <h3>
            <a class="item" href="https://github.com/Rukenshia/pomodoro"
              >Show HN: Physical Pomodoro Timer with ESP32 and e-paper screen</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-29 @ 10:42:26</span
              ><span class="points-container"
                >Points: <span class="points">242</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43514383"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43514075">
          <h3>
            <a class="item" href="https://caido.io/"
              >Caido – A lightweight web security auditing toolkit</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-29 @ 09:32:00</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43514075"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43513996">
          <h3>
            <a
              class="item"
              href="https://github.com/supabase-community/postgres-language-server"
              >Postgres Language Server: Initial Release</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-29 @ 09:13:43</span
              ><span class="points-container"
                >Points: <span class="points">226</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43513996"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43513397">
          <h3>
            <a
              class="item"
              href="https://www2.eecs.berkeley.edu/Pubs/TechRpts/2018/EECS-2018-24.pdf"
              >Mathematical Compact Models of Advanced Transistors [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-29 @ 06:58:08</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43513397"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43512589">
          <h3>
            <a class="item" href="https://plainframework.com/"
              >Plain – a web framework for building products with Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-29 @ 03:55:02</span
              ><span class="points-container"
                >Points: <span class="points">247</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43512589"
                  >Comments</a
                ><span class="descendants">: 140</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43509923">
          <h3>
            <a
              class="item"
              href="https://twitter.com/elonmusk/status/1905731750275510312"
              >xAI has acquired X, xAI now valued at $80B</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 21:23:42</span
              ><span class="points-container"
                >Points: <span class="points">739</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43509923"
                  >Comments</a
                ><span class="descendants">: 1078</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43509548">
          <h3>
            <a
              class="item"
              href="https://www.chrbutler.com/digital-echoes-and-unquiet-minds"
              >Digital Echoes and Unquiet Minds</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 20:29:32</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43509548"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43508418">
          <h3>
            <a
              class="item"
              href="https://www.landh.tech/blog/20250327-we-hacked-gemini-source-code/"
              >We hacked Gemini's Python sandbox and leaked its source code (at
              least some)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 18:12:58</span
              ><span class="points-container"
                >Points: <span class="points">607</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43508418"
                  >Comments</a
                ><span class="descendants">: 125</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43508061">
          <h3>
            <a class="item" href="https://github.com/EmberEmu/Hexi"
              >Show HN: Hexi – Modern header-only network binary serialisation
              for C++</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 17:37:42</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43508061"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
            <div class="text">
              <p>
                I decided to put together my own class to do the job, starting
                with an easy, low-overhead way to move bytes in and out of
                arbitrary buffers. Along the way, it picked up useful bits and
                pieces, such as buffer structures and allocators that made the
                byte shuffling faster, often being able to do it with zero
                allocations and zero copies. Safety features came along to make
                sure that malicious packet data or mistakes in the code wouldn't
                result in segfaults or vulnerabilities.
              </p>
              <p>
                It's become useful enough to me that I've packaged it up in its
                own standalone library on the chance that it might be useful to
                others. It has zero dependencies other than the standard library
                and has been designed for quick integration into any project
                within minutes, or seconds with a copy paste of the amalgamated
                header. It can be used in production code but it's also ideal
                for for those that want to quickly hack away at binary data with
                minimal fuss.
              </p>
            </div>
          </section>
        </section>
        <section id="43506951">
          <h3>
            <a class="item" href="https://pianoboi.site"
              >Show HN Pianoboi – displays sheet music as you play your piano</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 15:55:17</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43506951"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
            <div class="text">
              <p>
                It displays sheet music as you play, and let's you take
                snapshots of specific chords, then keeps a running list of
                chords as keyboard visuals (instead of just displaying sheet
                music).
              </p>
              <p>
                Just a simple tool for songwriting/ figuring out songs by ear,
                or just understanding music key theory (which I'm admittedly a
                still a beginner at).
              </p>
            </div>
          </section>
        </section>
        <section id="43506238">
          <h3>
            <a
              class="item"
              href="https://terrytao.wordpress.com/2025/03/26/decomposing-a-factorial-into-large-factors/"
              >Decomposing a Factorial into Large Factors</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 14:55:54</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43506238"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43503872">
          <h3>
            <a
              class="item"
              href="https://refactoringenglish.com/chapters/write-blog-posts-developers-read/"
              >How to write blog posts that developers read</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 11:01:19</span
              ><span class="points-container"
                >Points: <span class="points">535</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43503872"
                  >Comments</a
                ><span class="descendants">: 148</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43493544">
          <h3>
            <a
              class="item"
              href="https://williambader.com/museum/cubes/cubes.html"
              >Rubik's Cube Solutions, Puzzles, and 8-Balls (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-27 @ 13:40:18</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43493544"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43489173">
          <h3>
            <a
              class="item"
              href="https://cerncourier.com/beyond-bohr-and-einstein/"
              >Beyond Bohr and Einstein</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-27 @ 00:37:21</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43489173"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43488438">
          <h3>
            <a class="item" href="https://github.com/timescale/rtabench"
              >New open-source benchmark for real-time analytics applications</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-26 @ 22:57:34</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43488438"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43482792">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s43856-025-00775-0"
              >Low responsiveness of ML models to critical or deteriorating
              health conditions</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-26 @ 14:43:37</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43482792"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43479906">
          <h3>
            <a
              class="item"
              href="https://willhbr.net/2025/03/20/snakes-in-a-pane/"
              >Show HN: I implemented Snake in a tmux config file</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-26 @ 08:07:20</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43479906"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43471907">
          <h3>
            <a
              class="item"
              href="https://www.sciencedaily.com/releases/2025/03/250324142002.htm"
              >Chimpanzees act as 'engineers', choosing materials to make
              tools</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-25 @ 14:39:52</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43471907"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43471838">
          <h3>
            <a class="item" href="https://github.com/bknd-io/bknd"
              >Show HN: Bknd – Firebase alternative that embeds into any React
              stack</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-25 @ 14:34:17</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43471838"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
            <div class="text">
              <p>
                bknd runs directly inside your frontend app — no separate
                backend required. It works with Next.js, Remix, Astro, React
                Router. It also runs standalone on Cloudflare Workers, AWS
                Lambda, Bun, or Node.
              </p>
              <p>
                It supports Postgres, LibSQL (Turso), D1, SQLite and has
                adapter-based storage. You get instant APIs, multi-strategy
                auth, media handling and a built-in Admin UI.
              </p>
              <p>Curious what you’d build with it, feedback welcome!</p>
            </div>
          </section>
        </section>
        <section id="43470416">
          <h3>
            <a
              class="item"
              href="https://gizmodo.com/the-carcinisation-of-playstation-is-complete-say-hello-to-playstacean-2000579934"
              >Playstation Mod Turns the PSOne into a Crustacean</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-25 @ 12:30:00</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43470416"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43469535">
          <h3>
            <a
              class="item"
              href="https://seb-v.github.io/optimization/update/2025/01/20/Fast-GPU-Matrix-multiplication.html"
              >Optimizing Matrix Multiplication on RDNA3</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-25 @ 09:55:21</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43469535"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
