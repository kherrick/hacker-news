<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36416176">
          <h3>
            <a class="item" href="https://sifted.eu/articles/pitch-deck-mistral"
              >See the pitch memo that raised €105M for four-week-old startup
              Mistral</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-21 @ 09:06:06</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36416176"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36416131">
          <h3>
            <a
              class="item"
              href="https://www.androidauthority.com/apple-swiss-fruit-company-change-logo-3336622/"
              >Apple could force a 111-year-old fruit company to change its
              Apple logo</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-21 @ 09:00:33</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36416131"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36415981">
          <h3>
            <a
              class="item"
              href="https://www.theatlantic.com/culture/archive/2023/06/the-truman-show-25-years-later/674456/"
              >The Real Lesson of The Truman Show</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-21 @ 08:38:22</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36415981"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36415839">
          <h3>
            <a class="item" href="https://github.com/pingcap/ossinsight-lite"
              >Show HN: GitHub Stats Dashboard Powered by GraphQL API and GitHub
              Action</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-21 @ 08:18:48</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36415839"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36415745">
          <h3>
            <a
              class="item"
              href="https://theorangeone.net/posts/youre-doing-2fa-wrong/"
              >You're doing two-factor authentication wrong</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-21 @ 08:04:52</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36415745"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36415616">
          <h3>
            <a
              class="item"
              href="https://utcc.utoronto.ca/~cks/space/blog/sysadmin/NonX86MakesLifeHarder"
              >Having non-x86 machines makes your life harder</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-21 @ 07:45:22</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36415616"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36414915">
          <h3>
            <a class="item" href="https://ra.co/news/79174"
              >Moog sells its business to InMusic</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-21 @ 05:57:24</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36414915"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36414826">
          <h3>
            <a
              class="item"
              href="https://blogs.nasa.gov/solarcycle25/2023/06/20/271/"
              >Strong Solar Flare Erupts from Sun on Jun 20, 2023</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-21 @ 05:45:52</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36414826"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36414538">
          <h3>
            <a
              class="item"
              href="https://twitter.com/sytelus/status/1671333552204693504"
              >50% on HumanEval with just 1.3B model</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-21 @ 04:55:09</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36414538"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36414493">
          <h3>
            <a
              class="item"
              href="https://yotam.net/posts/linux-namespaces-are-a-poor-mans-plan9-namespaces/"
              >Linux Namespaces Are a Poor Man's Plan 9 Namespaces</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-21 @ 04:45:57</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36414493"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36414037">
          <h3>
            <a class="item" href="https://podcast.thinkingelixir.com/156"
              >React to LiveView for Performance [audio]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-21 @ 03:28:35</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36414037"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36413897">
          <h3>
            <a class="item" href="https://www.rr-fallenflags.org/"
              >Fallen Flag Railroad Photos</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-21 @ 03:06:47</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36413897"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36413768">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2306.11644"
              >Textbooks are all you need</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-21 @ 02:48:17</span
              ><span class="points-container"
                >Points: <span class="points">176</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36413768"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36413296">
          <h3>
            <a
              class="item"
              href="https://twitter.com/swyx/status/1671272883379908608"
              >GPT4 is 8 x 220B params = 1.7T params</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-21 @ 01:38:35</span
              ><span class="points-container"
                >Points: <span class="points">228</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36413296"
                  >Comments</a
                ><span class="descendants">: 111</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36413260">
          <h3>
            <a
              class="item"
              href="https://www.noulakaz.net/2007/03/18/a-regular-expression-to-check-for-prime-numbers/"
              >A regular expression to check for prime numbers (2007)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-21 @ 01:33:41</span
              ><span class="points-container"
                >Points: <span class="points">235</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36413260"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36412300">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-023-01980-4"
              >How scientists are hacking the genetic code to give proteins new
              powers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 23:39:10</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36412300"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36412191">
          <h3>
            <a class="item" href="https://nadia.xyz/asu"
              >ASU: The New American University (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 23:26:51</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36412191"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36412105">
          <h3>
            <a class="item" href="https://cedwards.xyz/defer-for-shell/"
              >Defer for Shell (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 23:19:21</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36412105"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36412072">
          <h3>
            <a class="item" href="https://botsin.space/@intenttoship"
              >I post when browser makers announce their intent to ship features
              in web engines</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 23:15:21</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36412072"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36410522">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36410522"
              >Finley (YC W21) is hiring to reimagine business credit (US
              remote)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 21:01:00</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
            <div class="text">
              <p>
                That lack of transparency would be frightening, but hey, things
                could still work out, right?
              </p>
              <p>Well, let's up the difficulty.</p>
              <p>
                Imagine that, on top of not knowing exactly how much you were
                paying for your inputs, you also didn't know if you would have
                consistent and continued access to your wholesaler, your food
                supplier, or your building materials. That would almost
                certainly induce high blood pressure, stomach ulcers, and mild
                insomnia.
              </p>
              <p>
                In the world of private credit (this is basically business
                credit for the majority of companies), it's not only normal but
                expected that getting and maintaining access to debt capital
                (one of the key inputs for running any business!) will be
                opaque, error-prone, and hard to operationalize. In other words,
                capital uncertainty is the dismal reality in middle-market
                finance.
              </p>
              <p>
                Private credit is enormous (add up all the VC dollars spent last
                year and you'd still be short of the amount of private credit
                issued over the same period), unavoidable, and broken.
              </p>
              <p>
                That means credit access--the fuel or primary financial input
                for most medium-sized businesses--is hard to price, access,
                report on, and predict.
              </p>
              <p>
                And yet it doesn't have to be that way; the data and operational
                issues of private credit have been solved in other domains
                (e.g., CRMs for Sales, infrastructure tooling for devs, EMRs for
                hospitals). What's missing is a software layer for business
                finance.
              </p>
              <p>
                Finley has built the system of record for private credit. We
                plug into all borrower source systems and automate reporting and
                analysis for private credit lenders. The result is full
                transparency into the cost and availability of capital, which
                gives businesses newfound financial predictability.
              </p>
              <p>
                We're a team of builders, designers, finance experts, engineers,
                and systems thinkers from top companies in finance and
                technology, and we're backed by leading investors like Y
                Combinator, CRV, and Bain Capital Ventures.
              </p>
              <p>
                We're 2.5 years into our journey, recently raised a $17 million
                Series A, and already managing over $3 billion in private
                credit.
              </p>
              <p>
                It's still Day 1, though. The challenges we're taking on will
                reshape the economy over the next decades, and we'd love to
                partner with team members who share our passion for innovation
                and company-building.
              </p>
              <p>
                To learn more, check out our Careers page here:
                <a href="https://www.finleycms.com/careers/"
                  >https://www.finleycms.com/careers/</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="36409489">
          <h3>
            <a
              class="item"
              href="https://a16z.com/2023/06/20/emerging-architectures-for-llm-applications/"
              >Emerging architectures for LLM applications</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 19:48:12</span
              ><span class="points-container"
                >Points: <span class="points">223</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36409489"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36409262">
          <h3>
            <a
              class="item"
              href="https://www.johndcook.com/blog/2011/09/27/bayesian-amazon/"
              >A Bayesian view of Amazon resellers (2011)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 19:30:35</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36409262"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36409201">
          <h3>
            <a class="item" href="https://github.com/refuel-ai/autolabel"
              >Show HN: Autolabel, a Python library to label and enrich text
              data with LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 19:26:02</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36409201"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
            <div class="text">
              <p>
                We built Autolabel because access to clean, labeled data is a
                huge bottleneck for most ML/data science teams. The most capable
                LLMs are able to label data with high accuracy, and at a
                fraction of the cost and time compared to manual labeling. With
                Autolabel, you can leverage LLMs to label any text dataset with
                &lt;5 lines of code.
              </p>
              <p>We’re eager for your feedback!</p>
            </div>
          </section>
        </section>
        <section id="36409082">
          <h3>
            <a class="item" href="https://vllm.ai/"
              >vLLM: Easy, Fast, and Cheap LLM Serving with PagedAttention</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 19:17:32</span
              ><span class="points-container"
                >Points: <span class="points">260</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36409082"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36408633">
          <h3>
            <a
              class="item"
              href="https://www.linen.dev/s/linen/t/12647025/building-a-slack-discord-alternative-with-tauri-rust"
              >Building a Slack/Discord alternative with Tauri/Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 18:45:02</span
              ><span class="points-container"
                >Points: <span class="points">288</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36408633"
                  >Comments</a
                ><span class="descendants">: 184</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36407781">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gaming/2023/06/submarine-missing-near-titanic-used-a-30-logitech-gamepad-for-steering/"
              >Submarine missing near Titanic used a $30 Logitech gamepad for
              steering</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 17:50:10</span
              ><span class="points-container"
                >Points: <span class="points">426</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36407781"
                  >Comments</a
                ><span class="descendants">: 749</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36407477">
          <h3>
            <a class="item" href="https://devpod.sh/"
              >Codespaces but open-source, client-only, and unopinionated</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 17:30:50</span
              ><span class="points-container"
                >Points: <span class="points">568</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36407477"
                  >Comments</a
                ><span class="descendants">: 123</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36405761">
          <h3>
            <a class="item" href="https://github.com/shayonj/pg_easy_replicate"
              >Minimal downtime major PostgreSQL version upgrades with
              pg_easy_replicate</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 15:46:23</span
              ><span class="points-container"
                >Points: <span class="points">279</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36405761"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36401547">
          <h3>
            <a class="item" href="https://pages.hep.wisc.edu/~prepost/ELF.pdf"
              >The world's largest "radio" station [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 09:20:33</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36401547"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36400465">
          <h3>
            <a
              class="item"
              href="http://redsymbol.net/articles/bash-exit-traps/"
              >“Exit traps” can make your Bash scripts more robust and reliable
              (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 06:34:29</span
              ><span class="points-container"
                >Points: <span class="points">468</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36400465"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
