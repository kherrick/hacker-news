<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="35857731">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Operation_Epsilon"
              >Operation Epsilon</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 03:23:54</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35857731"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35857631">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=35857631"
              >Ask HN: Why is the state of “smart home” devices still so
              dire?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 02:59:00</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35857631"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
            <div class="text">
              <p>
                Is there no company smaller than Google or Amazon or Apple
                willing or able to make a better smart home device? Especially
                now with AI solving the language-proficiency problem in talking
                to these devices, it seems like the rest of the product is just
                API integrations with a few hundred smart home hardware vendors,
                and some easy lookups like weather and calendar.
              </p>
              <p>
                Is there something I'm missing about why the current generation
                of these still suck so bad? As a weekend project I bolted
                speech-synthesis and speech-recognition to ChatGPT (and have
                seen similar "Show HN" posts) and immediately had a more
                interesting conversational partner than Alexa or, god help them,
                Siri has ever been.
              </p>
              <p>
                Why are three of the most profitable technology companies in the
                history of mankind unable to come up with better than Google
                Home, Alexa, and Siri? Is there some unusual challenge here that
                I fail to understand?
              </p>
              <p>
                Plenty of people I know would spend $500-1000 (not to mention
                the lightbulbs, appliances, or various “smart” gadgets) on just
                the smart home “brain” itself, and not even for something HN
                folks might consider “ideal” (privacy respecting, no ads etc),
                but just for a device that actually, usefully, and consistently
                does most of the things these devices purport to do. Why can’t
                three different trillion-dollar companies even manage that, and
                more to the point, why aren’t there more billion-dollar
                companies even trying?
              </p>
            </div>
          </section>
        </section>
        <section id="35857463">
          <h3>
            <a
              class="item"
              href="https://lucasfcosta.com/2022/10/02/scrum-versus-kanban.html"
              >You don't need Scrum. You just need to do Kanban right (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 02:30:37</span
              ><span class="points-container"
                >Points: <span class="points">115</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35857463"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35857439">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/vint-cerf-mistakes"
              >Vint Cerf on 3 Mistakes He Made in TCP/IP</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 02:26:56</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35857439"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35857134">
          <h3>
            <a class="item" href="https://github.com/jessejanderson/skylink"
              >SkyLink – Bluesky DID Detector browser plugin</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 01:22:13</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35857134"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35856820">
          <h3>
            <a
              class="item"
              href="https://dinosaurpictures.org/ancient-earth/#470"
              >Ancient Earth Globe</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 00:14:35</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35856820"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35856036">
          <h3>
            <a class="item" href="https://spacetraders.io/"
              >SpaceTraders: A multiplayer game built on a free web API</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-07 @ 22:00:50</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35856036"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35855988">
          <h3>
            <a
              class="item"
              href="https://gwern.net/doc/technology/2005-shirky-agroupisitsownworstenemy.pdf"
              >A Group Is Its Own Worst Enemy [pdf] (2005)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-07 @ 21:55:26</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35855988"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35855929">
          <h3>
            <a class="item" href="https://github.com/lizrice/ebpf-beginners"
              >The Beginner's Guide to eBPF</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-07 @ 21:47:59</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35855929"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35855858">
          <h3>
            <a
              class="item"
              href="https://www.brandingmag.com/2016/09/28/branding-in-the-real-world-acronym-branding/"
              >Branding in the real world: acronym branding (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-07 @ 21:37:39</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35855858"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35855737">
          <h3>
            <a class="item" href="https://www.salon.com/2003/10/10/postman/"
              >Neil Postman: A civilized man in a century of barbarism (2003)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-07 @ 21:22:16</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35855737"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35855502">
          <h3>
            <a
              class="item"
              href="https://utcc.utoronto.ca/~cks/space/blog/linux/DrgnKernelPokingPraise"
              >Some early praise for using drgn for poking into Linux kernel
              internals</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-07 @ 20:51:41</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35855502"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35855454">
          <h3>
            <a class="item" href="https://svmetasearch.eu.org"
              >Show HN: What do you think about my metasearch engine?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-07 @ 20:44:09</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35855454"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35855398">
          <h3>
            <a
              class="item"
              href="https://emiruz.com/post/2023-04-30-prolog-for-data-science/"
              >Prolog for data science</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-07 @ 20:36:50</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35855398"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35855029">
          <h3>
            <a
              class="item"
              href="https://lemonspawn.com/turbo-rascal-syntax-error-expected-but-begin/"
              >Turbo Rascal Syntax Error</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-07 @ 19:55:41</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35855029"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35854834">
          <h3>
            <a class="item" href="https://digital.staatsbibliothek-berlin.de/"
              >210k works in the Public Domain, searchable</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-07 @ 19:36:38</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35854834"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35854772">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/2023/05/07/cyberpunk-2077s-path-tracing-update/"
              >Cyberpunk 2077’s Path Tracing Update</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-07 @ 19:30:18</span
              ><span class="points-container"
                >Points: <span class="points">160</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35854772"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35853588">
          <h3>
            <a class="item" href="https://planetarium100.org/"
              >The first planetarium projector was unveiled 100 years ago</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-07 @ 17:24:42</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35853588"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35853580">
          <h3>
            <a class="item" href="https://www.makeitfrom.com/"
              >Makeitfrom.com – Material Properties Database</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-07 @ 17:23:53</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35853580"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35853466">
          <h3>
            <a
              class="item"
              href="https://web.archive.org/web/20060830053522/http://www.ballaerospace.com/inter.exe"
              >Ball Aerospace Deep Impact's impactor simulation software
              (2006)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-07 @ 17:11:14</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35853466"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35853148">
          <h3>
            <a
              class="item"
              href="https://adrianco.medium.com/so-many-bad-takes-what-is-there-to-learn-from-the-prime-video-microservices-to-monolith-story-4bd0970423d4"
              >The Prime Video microservices to monolith story</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-07 @ 16:36:33</span
              ><span class="points-container"
                >Points: <span class="points">412</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35853148"
                  >Comments</a
                ><span class="descendants">: 300</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35853131">
          <h3>
            <a class="item" href="https://fivebooks.com/"
              >Five Books: The best books on everything</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-07 @ 16:33:52</span
              ><span class="points-container"
                >Points: <span class="points">212</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35853131"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35852774">
          <h3>
            <a
              class="item"
              href="https://wickedengine.net/2023/05/07/vulkan-video-decoding/"
              >Vulkan Video Decoding</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-07 @ 15:59:07</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35852774"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35852321">
          <h3>
            <a
              class="item"
              href="https://nyxt.atlas.engineer/article/why-lisp.org"
              >Why Lisp?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-07 @ 15:15:44</span
              ><span class="points-container"
                >Points: <span class="points">188</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35852321"
                  >Comments</a
                ><span class="descendants">: 196</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35852192">
          <h3>
            <a class="item" href="https://www.fitzsim.org/blog/?p=545"
              >Pixel phones are sold with bootloader unlocking disabled</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-07 @ 15:00:25</span
              ><span class="points-container"
                >Points: <span class="points">397</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35852192"
                  >Comments</a
                ><span class="descendants">: 223</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35851303">
          <h3>
            <a
              class="item"
              href="https://www.technologyreview.com/2023/05/04/1072603/the-inside-scoop-on-solar-geoengineering/"
              >The Scoop on Solar Geoengineering</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-07 @ 13:25:52</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35851303"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35850690">
          <h3>
            <a
              class="item"
              href="https://susam.net/blog/from-xon-xoff-to-forward-incremental-search.html"
              >From XON/XOFF to Forward Incremental Search (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-07 @ 12:22:24</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35850690"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35844574">
          <h3>
            <a
              class="item"
              href="https://statmodeling.stat.columbia.edu/2023/05/04/using-predictions-from-arbitrary-models-to-get-tighter-confidence-intervals/"
              >Using predictions from arbitrary models to get tighter confidence
              intervals</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-06 @ 19:26:59</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35844574"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35844078">
          <h3>
            <a
              class="item"
              href="https://www.lortex.org/articles/value-speculation-ocaml/"
              >Implementing Value Speculation in OCaml</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-06 @ 18:36:26</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35844078"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35838826">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=tCHKIdup5Lo"
              >Classic Sesame Street – Computer Trouble</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-06 @ 06:55:28</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35838826"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
