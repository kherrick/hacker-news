<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42409059">
          <h3>
            <a
              class="item"
              href="https://www.justice.gov/opa/pr/fourteen-north-korean-nationals-indicted-carrying-out-multi-year-fraudulent-information"
              >Fourteen North Koreans Indicted for Fraudulent IT Worker Scheme
              and Extortions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 15:05:33</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42409059"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42408945">
          <h3>
            <a
              class="item"
              href="https://twitter.com/levelsio/status/1867314119654637629"
              >The exact moment that I decided to go off-grid in Portugal</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 14:53:05</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42408945"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42408925">
          <h3>
            <a
              class="item"
              href="https://nypost.com/2024/12/12/opinion/feds-help-health-insurers-hide-dirty-secret-rising-denials/"
              >Feds help health insurers hide their dirty secret: denials on the
              rise</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 14:51:49</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42408925"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42408885">
          <h3>
            <a
              class="item"
              href="https://www.techdirt.com/2024/12/13/att-refuses-to-upgrade-millions-of-dsl-customers-to-fiber-despite-untold-billions-in-taxpayer-subsidies-and-government-favors/"
              >AT&amp;amp;T Won't Upgrade Millions Of DSL Users To Fiber Despite
              Billions In Subsidies</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 14:48:08</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42408885"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42408271">
          <h3>
            <a
              class="item"
              href="https://news.mit.edu/2024/noninvasive-imaging-method-can-penetrate-deeper-living-tissue-1211"
              >Noninvasive imaging method can penetrate deeper into living
              tissue</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 13:34:34</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42408271"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42406773">
          <h3>
            <a
              class="item"
              href="https://www.zellic.io/blog/proton-dart-flutter-csprng-prng/"
              >Three Mistakes from Dart/Flutter's Weak PRNG</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 08:05:27</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42406773"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42406158">
          <h3>
            <a
              class="item"
              href="https://computerhistory.org/blog/in-memoriam-donald-bitzer-1934-2024/"
              >In Memoriam: Donald Bitzer, 1934–2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 05:32:42</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42406158"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42405999">
          <h3>
            <a
              class="item"
              href="https://www.alexmurrell.co.uk/articles/the-age-of-average"
              >The age of average (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 04:50:34</span
              ><span class="points-container"
                >Points: <span class="points">184</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42405999"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42405956">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/article/amid-cuts-basic-research-new-zealand-scraps-all-support-social-sciences"
              >Amid cuts to basic research, New Zealand scraps all support for
              social sciences</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 04:38:28</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42405956"
                  >Comments</a
                ><span class="descendants">: 195</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42405733">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/mathematicians-uncover-a-new-way-to-count-prime-numbers-20241211/"
              >Mathematicians uncover a new way to count prime numbers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 03:38:29</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42405733"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42405497">
          <h3>
            <a
              class="item"
              href="http://thelondondead.blogspot.com/2014/11/the-pills-that-cure-all-ills-james.html"
              >The pills that cured all ills; James Morison the Hygeist
              (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 02:35:38</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42405497"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42405462">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/ibm-demo"
              >A new video captures a 1968 demo of IBM’s Executive Terminal</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 02:30:01</span
              ><span class="points-container"
                >Points: <span class="points">250</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42405462"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42405046">
          <h3>
            <a class="item" href="https://velofuso.com"
              >Show HN: I designed an espresso machine and coffee grinder</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-13 @ 01:03:27</span
              ><span class="points-container"
                >Points: <span class="points">539</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42405046"
                  >Comments</a
                ><span class="descendants">: 254</span></span
              >
            </h4>
            <div class="text">
              <p>
                I felt like espresso machines were getting very large,
                plasticky, and app-integrated without actually improving the
                underlying technologies that make them work. The noisy vibratory
                pumps in particular are from 1977 and haven’t really changed
                since then. So I wanted to focus on making the most advanced
                internals I could and leaving everything else as minimalist as
                possible. The pump is, as far as I know, completely unique in
                terms of power density and price. Without spending several
                thousand dollars, it was difficult to find a machine with a gear
                pump, and adjustable pressure was also similarly expensive but
                this machine has those things and costs a normal amount to buy.
                You can also turn the pressure way down and make filter coffee.
              </p>
              <p>
                I also saw so many people (including myself) using a scale while
                making espresso, and even putting a cup below the group head to
                catch drips, entirely negating the drip tray, so I basically
                designed for that! The profile of the machine is much lighter on
                the eyes and doesn’t loom in the corner like my old espresso
                machine did.
              </p>
              <p>
                And for the grinder, basically everything on the market uses
                conical and flat burrs that have descended from spice grinders,
                and the same couple of standard sizes. Sometimes larger
                companies design their own burrs, but only within those existing
                shapes. There is sort of a rush to put larger and larger burrs
                into coffee grinders, which makes sense, but with cylindrical
                burrs, you can increase the cutting surface way more relative to
                the size of the grinder. When grinders get too big, maintaining
                alignment becomes mechanically cumbersome, but the cylindrical
                burr can be very well supported from the inside, and there is
                the added benefit of hiding the entire motor within the burr
                itself. The resulting grounds are just outright better than all
                the other grinders I have used, but obviously this is a matter
                of taste and my own personal bias.
              </p>
              <p>
                The biggest downside for the grinder is that it doesn’t work
                with starbucks style oily roasts, because the coffee expands so
                much while traveling down through the burrs and can sometimes
                clog up the teeth. It doesn’t hurt the grinder but it does
                require cleaning (which is tool-free!). Another downside for
                both machines is the fact that they run on DC power so it’s best
                if you have a spot in your kitchen to tuck away the power brick.
              </p>
              <p>
                I also made a kit that makes the gear pump a drop-in upgrade for
                other espresso machines, to reduce noise and add adjustable
                pressure.
              </p>
              <p>
                <a href="https://velofuso.com/store/p/gear-pump-upgrade-kit"
                  >https://velofuso.com/store/p/gear-pump-upgrade-kit</a
                >
              </p>
              <p>
                The roughest part of this process were the moments midway
                through development where they weren’t working at all. When the
                grinder is just jamming itself instantly or the fourth factory
                in a row tells you the part you’re making is impossible or the
                pump is alternating between spraying water out the side and into
                your face and not pumping at all. And the default thought is “Of
                course it’s not working, if this was going to work someone else
                would have already made it like this”. The route you’ve taken is
                fundamentally different enough that there are no existing
                solutions to draw on. You’re basically feeling around in the
                dark for months on end, burning money, and then one day, every
                little cumulative change suddenly adds up to a tasty espresso.
                And it’s not perfect yet, but you at least can see the road
                ahead.
              </p>
              <p>
                Anyways, this is way more than I expected to write, thank you
                for reading! Tell me if you have any questions
              </p>
            </div>
          </section>
        </section>
        <section id="42404447">
          <h3>
            <a class="item" href="https://www.anthropic.com/research/clio"
              >Clio: A system for privacy-preserving insights into real-world AI
              use</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-12 @ 23:22:17</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42404447"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42404411">
          <h3>
            <a
              class="item"
              href="https://kennyballou.com/blog/2016/12/elixir-hot-swapping/index.html"
              >Elixir/Erlang Hot Swapping Code (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-12 @ 23:16:20</span
              ><span class="points-container"
                >Points: <span class="points">187</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42404411"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42404202">
          <h3>
            <a
              class="item"
              href="https://www.souzatharsis.com/tamingLLMs/markdown/toc.html"
              >Taming LLMs – A Practical Guide to LLM Pitfalls with Open Source
              Software</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-12 @ 22:45:57</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42404202"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42403744">
          <h3>
            <a
              class="item"
              href="https://assets.bitbashing.io/papers/concurrency-primer.pdf"
              >What every systems programmer should know about concurrency
              (2020) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-12 @ 21:46:16</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42403744"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42402927">
          <h3>
            <a
              class="item"
              href="https://www.science.org/doi/10.1126/science.abq1347"
              >A room temperature Li2O-based lithium-air battery enabled by a
              solid electrolyte</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-12 @ 20:14:26</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42402927"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42402079">
          <h3>
            <a class="item" href="https://stripe.com/blog/secret-life-of-dns"
              >The secret life of DNS packets (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-12 @ 18:51:07</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42402079"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42399397">
          <h3>
            <a
              class="item"
              href="https://xenaproject.wordpress.com/2024/12/11/fermats-last-theorem-how-its-going/"
              >Fermat's Last Theorem – how it’s going</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-12 @ 14:30:37</span
              ><span class="points-container"
                >Points: <span class="points">343</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42399397"
                  >Comments</a
                ><span class="descendants">: 163</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42398952">
          <h3>
            <a
              class="item"
              href="https://lichess.org/@/Lichess/blog/wcc-2024-round-14-gukesh-becomes-the-youngest-world-champion-in-history/cDggdNZw"
              >Gukesh becomes the youngest chess world champion in history</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-12 @ 13:29:23</span
              ><span class="points-container"
                >Points: <span class="points">1020</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42398952"
                  >Comments</a
                ><span class="descendants">: 418</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42397781">
          <h3>
            <a
              class="item"
              href="https://theengineeringmanager.substack.com/p/parkinsons-law-its-real-so-use-it"
              >Parkinson's Law: It’s real, so use it</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-12 @ 09:48:47</span
              ><span class="points-container"
                >Points: <span class="points">212</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42397781"
                  >Comments</a
                ><span class="descendants">: 149</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42397550">
          <h3>
            <a
              class="item"
              href="https://www.oldmapsonline.org/en/history/regions"
              >Timemap.org – Interactive Map of History</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-12 @ 09:12:28</span
              ><span class="points-container"
                >Points: <span class="points">998</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42397550"
                  >Comments</a
                ><span class="descendants">: 150</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42392267">
          <h3>
            <a class="item" href="https://lfi.dev/"
              >Show HN: Lfi – a lazy functional sync, async, and concurrent
              iteration library</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-11 @ 20:07:30</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42392267"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
            <div class="text">
              <p>
                - Supporting sync, sequential async, and concurrent async
                iteration
              </p>
              <p>
                - Limiting it to a small number of orthogonal concepts that
                compose beautifully to solve problems
              </p>
              <p>- Making it fully tree-shakeable</p>
              <p>
                I built it for myself and have (mostly) been its only user as I
                refined it. I've used it in lots of personal projects and really
                enjoyed it.
              </p>
              <p>
                I recently decided it would be nice to spread that enjoyment so
                I created a documentation website complete with a playground
                where you can try out the library.
              </p>
              <p>
                I hope you enjoy using it as much as I do! Looking forward to
                hearing your thoughts :)
              </p>
            </div>
          </section>
        </section>
        <section id="42385393">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=dF_9YcehCZo"
              >Saving Voyager 1 [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-11 @ 06:36:38</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42385393"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42382058">
          <h3>
            <a
              class="item"
              href="http://databasearchitects.blogspot.com/2024/12/c-exception-performance-three-years.html"
              >C++ exception performance three years later</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-10 @ 21:59:39</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42382058"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42378927">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/history/how-a-tale-of-demonic-possession-predicted-the-decline-of-an-early-medieval-empire-180985596/"
              >A Tale of Demonic Possession Predicted the Decline of an Early
              Medieval Empire</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-10 @ 17:23:35</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42378927"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42376724">
          <h3>
            <a class="item" href="https://github.com/Julow/Unexpected-Keyboard"
              >Unexpected Keyboard</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-10 @ 13:43:47</span
              ><span class="points-container"
                >Points: <span class="points">230</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42376724"
                  >Comments</a
                ><span class="descendants">: 116</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42372565">
          <h3>
            <a
              class="item"
              href="https://medium.com/@tomysshadow/fixing-the-loading-in-myst-iv-revelation-86e2814afbf8"
              >Fixing the Loading in Myst IV: Revelation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-10 @ 01:13:03</span
              ><span class="points-container"
                >Points: <span class="points">194</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42372565"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42356752">
          <h3>
            <a
              class="item"
              href="https://ezntek.com/posts/librebooting-the-thinkpad-t480-20241207t0933/"
              >Librebooting the ThinkPad T480</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-08 @ 12:29:53</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42356752"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
