<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42968995">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2025/02/05/technology/daniel-penny-andreessen-horowitz-investors.html"
              >Andreessen Horowitz Defends Hiring of Daniel Penny to Its
              Investors</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-07 @ 03:24:34</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42968995"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42968858">
          <h3>
            <a class="item" href="https://skilldrick.github.io/easy6502/"
              >Easy 6502</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-07 @ 03:11:56</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42968858"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42968700">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2502.03349"
              >Robust Autonomy Emerges from Self-Play</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-07 @ 02:44:09</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42968700"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42968547">
          <h3>
            <a
              class="item"
              href="https://www.byhand.ai/p/transformer-spreadsheet"
              >Transformer Implemented Using Excel</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-07 @ 02:13:03</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42968547"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42968347">
          <h3>
            <a class="item" href="https://www.veeto.app/bill/1955756"
              >California bill would require bots to disclose that they are
              bots</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-07 @ 01:41:30</span
              ><span class="points-container"
                >Points: <span class="points">239</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42968347"
                  >Comments</a
                ><span class="descendants">: 128</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42967474">
          <h3>
            <a class="item" href="https://tillitis.se/products/tkey/"
              >TKey – Security for the New World</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-06 @ 23:17:25</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42967474"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42967226">
          <h3>
            <a
              class="item"
              href="https://www.onverticality.com/blog/frank-lloyd-wright-mile-high-skyscraper"
              >Frank Lloyd Wright's mile high skyscraper proposal (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-06 @ 22:39:22</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42967226"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42966720">
          <h3>
            <a
              class="item"
              href="https://magazine.sebastianraschka.com/p/understanding-reasoning-llms"
              >Understanding Reasoning LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-06 @ 21:34:12</span
              ><span class="points-container"
                >Points: <span class="points">188</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42966720"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42966455">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42966455"
              >Verse (YC W22) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-06 @ 21:00:23</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
            <div class="text">
              <p>
                Verse is one of the fastest platforms ever to reach over 10
                million users. We're building a home on the internet for people
                to showcase their identity with unlimited expression and keep up
                with their friends. If you’re looking for the crazy consumer
                startup ride where you build products that millions of people
                use, this is the place for you. Even our last product, Discz,
                was coined “one of the hottest music apps in the world” by
                Rolling Stone. We are a lean team based out of NYC that is
                backed by top VCs including Union Square Ventures, Greylock, and
                Y Combinator.
              </p>
              <p>
                Apply here:
                <a href="https://www.ycombinator.com/companies/verse/jobs"
                  >https://www.ycombinator.com/companies/verse/jobs</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="42965267">
          <h3>
            <a
              class="item"
              href="https://github.com/US-Artificial-Intelligence/scraper"
              >Show HN: An API that takes a URL and returns a file with browser
              screenshots</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-06 @ 18:48:05</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42965267"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42965198">
          <h3>
            <a
              class="item"
              href="https://github.com/QuadrupleA/sqlite-page-explorer"
              >Show HN: SQLite disk page explorer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-06 @ 18:40:30</span
              ><span class="points-container"
                >Points: <span class="points">189</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42965198"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42964773">
          <h3>
            <a
              class="item"
              href="https://blog.pierre-ricadat.com/scala-3-migration-report-from-the-field"
              >Scala 3 Migration: Report from the field</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-06 @ 17:54:50</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42964773"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42963346">
          <h3>
            <a class="item" href="https://thestrikeagency.com/kaos/"
              >Show HN: An homage to Tom Dowdy's 1991 screensaver, "Kaos"</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-06 @ 15:35:32</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42963346"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
            <div class="text">
              <p>
                Kaos would take anywhere from 10 to 30 seconds to slowly iterate
                on a single image, starting with a few colored dots and growing
                into webs within webs of algorithmic beauty.
              </p>
              <p>
                I'm not sure how Tom Dowdy actually wrote the program. What I've
                done here is to try to reverse engineer how it might have
                worked, but to animate it at the same time.
              </p>
              <p>
                Freezing a frame (by clicking) seems to often yield something
                close to the original. My method is to cycle between 1 and 30
                lines, with spaced out pixels, and then iterate the whole buffer
                to draw fainter and fainter points within a radius from any
                point that's already lit, while also amplifying the ones that
                were lit before and shifting their colors slightly at the same
                time.
              </p>
              <p>
                Anyway, I did this tonight but I've been thinking about it for
                weeks, so, I hope someone enjoys it. Cheers!
              </p>
            </div>
          </section>
        </section>
        <section id="42962508">
          <h3>
            <a
              class="item"
              href="https://lisyarus.github.io/blog/posts/simulating-water-over-terrain.html"
              >Simulating water over terrain</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-06 @ 14:15:28</span
              ><span class="points-container"
                >Points: <span class="points">269</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42962508"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42960907">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/aluminum-battery"
              >Aluminum Batteries Outlive Lithium-Ion with a Pinch of Salt</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-06 @ 10:13:26</span
              ><span class="points-container"
                >Points: <span class="points">165</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42960907"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42960144">
          <h3>
            <a
              class="item"
              href="https://gladdendesign.com/collections/paper-apps"
              >Paper Apps</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-06 @ 07:58:33</span
              ><span class="points-container"
                >Points: <span class="points">576</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42960144"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42959226">
          <h3>
            <a
              class="item"
              href="https://github.com/heap-exploitation/heap-explorer"
              >Show HN: Heap Explorer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-06 @ 04:54:18</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42959226"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
            <div class="text">
              <p>
                It's fun to pause processes, free a bunch of their allocations,
                then resume them. Most of the time, the processes continue as
                though nothing happened, but sometimes they do interesting
                things :)
              </p>
            </div>
          </section>
        </section>
        <section id="42948642">
          <h3>
            <a
              class="item"
              href="https://abeljansma.nl/2025/01/28/mereoPhysics.html"
              >Complex Systems and Quantitative Mereology</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-05 @ 14:06:44</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42948642"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42947973">
          <h3>
            <a
              class="item"
              href="http://wtarreau.blogspot.com/2011/12/elastic-binary-trees-ebtree.html"
              >Elastic Binary Trees (2011)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-05 @ 13:08:40</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42947973"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42947447">
          <h3>
            <a class="item" href="https://github.com/atgreen/openldk"
              >OpenLDK: A Java JIT compiler and runtime in Common Lisp</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-05 @ 12:17:47</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42947447"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42946752">
          <h3>
            <a
              class="item"
              href="https://spillhistorie.no/qa-with-game-designer-steve-meretzky/"
              >Steve Meretzky – Working with Douglas Adams on the Hitchhiker's
              Guide</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-05 @ 10:53:02</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42946752"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42939312">
          <h3>
            <a
              class="item"
              href="https://blog.cryptographyengineering.com/2025/02/04/how-to-prove-false-statements-part-1/"
              >How to prove false statements? (Part 1)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-04 @ 21:47:12</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42939312"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42936162">
          <h3>
            <a class="item" href="https://zachholman.com/posts/red-teams"
              >Nontraditional Red Teams</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-04 @ 18:01:45</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42936162"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42929401">
          <h3>
            <a
              class="item"
              href="https://bsky.app/profile/sinevibes.bsky.social/post/3lhc6l3caps2l"
              >YouTube restores SineVibes channel after Peter Kirn &amp;amp; Ars
              Technica get involved</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-04 @ 07:51:00</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42929401"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42925110">
          <h3>
            <a
              class="item"
              href="https://play.ht/news/playai-announces-new-benchmarks-playdialog/"
              >PlayAI's new Dialog model achieves 3:1 preference in human
              evals</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-03 @ 23:51:39</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42925110"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42923940">
          <h3>
            <a
              class="item"
              href="https://www.redhat.com/en/blog/open-source-ai-red-hats-point-view"
              >Open source AI: Red Hat's point-of-view</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-03 @ 22:08:20</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42923940"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42922289">
          <h3>
            <a
              class="item"
              href="https://www.holm.dog/2025/02/keep-em-not-separated-detecting.html"
              >Keep 'em (not) separated: detecting discontinuities in grid
              graphs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-03 @ 20:08:48</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42922289"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42920799">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/how-does-life-happen-when-theres-barely-any-light-20250129/"
              >Biophysics: How Does Life Happen When There's Barely Any
              Light?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-03 @ 17:47:06</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42920799"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42917135">
          <h3>
            <a class="item" href="https://github.com/chipsalliance/t1"
              >T1: A RISC-V Vector processor implementation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-03 @ 11:22:44</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42917135"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42915944">
          <h3>
            <a
              class="item"
              href="https://blog.voyageai.com/2024/12/04/code-retrieval-eval/"
              >How do we evaluate vector-based code retrieval?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-03 @ 07:54:34</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42915944"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
