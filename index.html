<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39378402">
          <h3>
            <a
              class="item"
              href="https://retractionwatch.com/2023/10/02/nobel-prize-winner-gregg-semenza-tallies-tenth-retraction/"
              >Nobel Prize winner Gregg Semenza tallies tenth retraction</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-15 @ 02:24:36</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39378402"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39378342">
          <h3>
            <a
              class="item"
              href="https://blog.glyph.im/2024/02/let-me-tell-you-a-secret.html"
              >What you've got is in fact a people problem</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-15 @ 02:14:15</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39378342"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39378259">
          <h3>
            <a
              class="item"
              href="https://www.theatlantic.com/ideas/archive/2024/02/america-decline-hanging-out/677451/"
              >Why Americans Suddenly Stopped Hanging Out</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-15 @ 02:02:54</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39378259"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39378235">
          <h3>
            <a
              class="item"
              href="https://bc.ctvnews.ca/air-canada-s-chatbot-gave-a-b-c-man-the-wrong-information-now-the-airline-has-to-pay-for-the-mistake-1.6769454"
              >Air Canada is responsible for chatbot's mistake: B.C. tribunal</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-15 @ 01:59:06</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39378235"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39377860">
          <h3>
            <a class="item" href="https://gpulist.ai/"
              >gpulist – Craigslist for GPUs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-15 @ 01:05:41</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39377860"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39377508">
          <h3>
            <a
              class="item"
              href="https://benjamin-brady.github.io/gitlab-simulator/"
              >Show HN: Gitlab Meeting Simulator 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-15 @ 00:22:10</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39377508"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
            <div class="text">
              Gitlab's meeting recordings on YouTube have tens of thousands of
              views by people pretending to work. Now you can appear to be in
              the meeting using your own webcam.
            </div>
          </section>
        </section>
        <section id="39377055">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=AayZuuDDKP0"
              >Machine Assisted Proof [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-14 @ 23:28:34</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39377055"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39375410">
          <h3>
            <a class="item" href="https://leejo.github.io/2024/02/14/fosdem/"
              >I Went to FOSDEM</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-14 @ 21:09:25</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39375410"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39374020">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/inside-the-proton-the-most-complicated-thing-imaginable-20221019/"
              >Inside the proton, the ‘most complicated thing you could possibly
              imagine’</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-14 @ 19:26:18</span
              ><span class="points-container"
                >Points: <span class="points">271</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39374020"
                  >Comments</a
                ><span class="descendants">: 244</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39373960">
          <h3>
            <a
              class="item"
              href="https://pears.com/news/holepunch-unveils-groundbreaking-open-source-peer-to-peer-app-development-platform-pear-runtime/"
              >Holepunch Unveils P2P Platform "Pear Runtime"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-14 @ 19:21:07</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39373960"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39373829">
          <h3>
            <a class="item" href="https://kk.org/books/out-of-control"
              >Out of Control by Kevin Kelly (1994)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-14 @ 19:10:37</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39373829"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39373814">
          <h3>
            <a class="item" href="https://amazon-ltts-paper.com/"
              >BASE TTS: The largest text-to-speech model to-date</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-14 @ 19:09:29</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39373814"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39373800">
          <h3>
            <a class="item" href="https://foldmation.com"
              >Show HN: FoldMation – Interactive origami learning and
              creation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-14 @ 19:08:24</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39373800"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
            <div class="text">
              <p>
                On comparing to video instructions, you have the ability to
                quickly skip/rewind steps and replay a complicated step many
                times.
              </p>
              <p>
                On the creation side, there have been one or two attempts at
                this before, but those solutions rely on mouse drags as the user
                interface. This greatly limited the kinds of folds possible. The
                foldMation Creator uses commands, keywords and values to compose
                a domain specific language/step and provides a (relatively
                speaking) easy to use user interface to compose the steps.
              </p>
              <p>
                For those interested in using the Creator, please go through the
                tutorial at the top of the create page.
              </p>
              <p>
                Btw, the DSL for foldMation uses
                <a href="https://github.com/mationai/mation-spec"
                  >https://github.com/mationai/mation-spec</a
                >. I created it since I couldn't find anything out there that is
                similar, allowing me to specify a well structured data with
                English-like readable syntax.
              </p>
              <p>Let me know what you think?</p>
            </div>
          </section>
        </section>
        <section id="39373612">
          <h3>
            <a
              class="item"
              href="https://mailman.nginx.org/pipermail/nginx-announce/2024/NW6MNW34VZ6HDIHH5YFBIJYZJN7FGNAV.html"
              >Nginx Security Advisory</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-14 @ 18:53:17</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39373612"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39373327">
          <h3>
            <a
              class="item"
              href="https://mailman.nginx.org/pipermail/nginx-devel/2024-February/K5IC6VYO2PB7N4HRP2FUQIBIBCGP4WAU.html"
              >Freenginx: Core Nginx developer announces fork</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-14 @ 18:29:40</span
              ><span class="points-container"
                >Points: <span class="points">675</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39373327"
                  >Comments</a
                ><span class="descendants">: 265</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39372384">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2024/02/13/dnssec_vulnerability_internet/"
              >Just one bad packet can bring down a vulnerable DNS server thanks
              to DNSSEC</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-14 @ 17:18:56</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39372384"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39372159">
          <h3>
            <a class="item" href="https://github.com/reorproject/reor"
              >Show HN: Reor – An AI note-taking app that runs models locally</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-14 @ 17:00:52</span
              ><span class="points-container"
                >Points: <span class="points">255</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39372159"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
            <div class="text">
              <p>The four main things to know are:</p>
              <p>
                1. Notes are connected automatically with vector search. You can
                do semantic search + related notes are automatically connected.
              </p>
              <p>
                2. You can do RAG Q&amp;A on your notes using the local LLM of
                your choice.
              </p>
              <p>
                3. Embedding model, LLM, vector db and files are all run or
                stored locally.
              </p>
              <p>
                4. Point it to a directory of markdown files (like an Obsidian
                vault) and it works seamlessly alongside Obsidian.
              </p>
              <p>
                Under the hood, Reor uses Llama.cpp (node-llama-cpp
                integration), Transformers.js and Lancedb to power the local AI
                features.
              </p>
              <p>
                Reor was built right from the start to support local models. The
                future of knowledge management involves using lots of AI to
                organize pieces of knowledge - but crucially, that AI should run
                as much as possible privately &amp; locally.
              </p>
              <p>
                It's available for Mac, Windows &amp; Linux on the project
                Github:
                <a href="https://github.com/reorproject/reor"
                  >https://github.com/reorproject/reor</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="39371831">
          <h3>
            <a
              class="item"
              href="https://smlx.dev/posts/goodwe-sems-protocol-teardown/"
              >Reverse-engineering an encrypted IoT protocol</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-14 @ 16:34:22</span
              ><span class="points-container"
                >Points: <span class="points">159</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39371831"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39371805">
          <h3>
            <a class="item" href="https://www.ycombinator.com/rfs"
              >YC: Requests for Startups</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-14 @ 16:31:57</span
              ><span class="points-container"
                >Points: <span class="points">341</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39371805"
                  >Comments</a
                ><span class="descendants">: 386</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39371669">
          <h3>
            <a
              class="item"
              href="https://rosenzweig.io/blog/conformant-gl46-on-the-m1.html"
              >Conformant OpenGL 4.6 on the M1</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-14 @ 16:18:44</span
              ><span class="points-container"
                >Points: <span class="points">354</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39371669"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39371297">
          <h3>
            <a class="item" href="https://github.com/traceloop/openllmetry-js"
              >Show HN: You don't need to adopt new tools for LLM
              observability</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-14 @ 15:52:03</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39371297"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
            <div class="text">
              <p>
                Why should it be different when the app you're building happens
                to be using LLMs?
              </p>
              <p>
                So today we're open-sourcing OpenLLMetry-JS. It's an open
                protocol and SDK, based on OpenTelemetry, that provides traces
                and metrics for LLM JS/TS applications and can be connected to
                any of the 15+ tools that already support OpenTelemetry. Here's
                the repo:
                <a href="https://github.com/traceloop/openllmetry-js"
                  >https://github.com/traceloop/openllmetry-js</a
                >
              </p>
              <p>
                A few months ago we launched the python flavor here (<a
                  href="https://news.ycombinator.com/item?id=37843907"
                  >https://news.ycombinator.com/item?id=37843907</a
                >) and we've now built a compatible one for Node.js.
              </p>
              <p>Would love to hear your thoughts and opinions!</p>
              <p>Check it out -</p>
              <p>
                Docs:
                <a
                  href="https://www.traceloop.com/docs/openllmetry/getting-started-ts"
                  >https://www.traceloop.com/docs/openllmetry/getting-started-t...</a
                >
              </p>
              <p>
                Github:
                <a href="https://github.com/traceloop/openllmetry-js"
                  >https://github.com/traceloop/openllmetry-js</a
                >
                <a href="https://github.com/traceloop/openllmetry"
                  >https://github.com/traceloop/openllmetry</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="39369653">
          <h3>
            <a
              class="item"
              href="https://www.eureporter.co/world/human-rights-category/european-court-of-human-rights-echr/2024/02/14/european-court-of-human-rights-bans-weakening-of-secure-end-to-endencryption-the-end-of-eus-chat-control-csar-mass-surveillance-plans/"
              >European Court of Human Rights bans weakening of secure
              end-to-end encryption</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-14 @ 13:44:45</span
              ><span class="points-container"
                >Points: <span class="points">1434</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39369653"
                  >Comments</a
                ><span class="descendants">: 208</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39368859">
          <h3>
            <a
              class="item"
              href="https://openai.com/blog/disrupting-malicious-uses-of-ai-by-state-affiliated-threat-actors"
              >Disrupting malicious uses of AI by state-affiliated threat
              actors</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-14 @ 11:58:05</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39368859"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39367580">
          <h3>
            <a
              class="item"
              href="https://easyperf.net/blog/2024/02/12/Memory-Profiling-Part1"
              >Memory Profiling: Introduction</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-14 @ 08:01:04</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39367580"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39366542">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/02/13/business/bob-moore-dead.html"
              >Bob Moore, who founded Bob's Red Mill, has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-14 @ 04:38:29</span
              ><span class="points-container"
                >Points: <span class="points">425</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39366542"
                  >Comments</a
                ><span class="descendants">: 216</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39356259">
          <h3>
            <a
              class="item"
              href="https://www.koaa.com/news/news5-originals/the-last-linotype-newspaper-operating-the-saguache-crescent"
              >The Last Linotype Newspaper (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-13 @ 10:17:32</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39356259"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39355944">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gaming/2024/02/f-zero-courses-from-a-dead-nintendo-satellite-service-restored-using-vhs-and-ai/"
              >F-Zero courses from a dead Nintendo satellite service restored
              using VHS and AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-13 @ 09:15:23</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39355944"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39344355">
          <h3>
            <a class="item" href="https://github.com/R-O-C-K-E-T/Factorio-SAT"
              >Enhancing Factorio with SAT solvers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-12 @ 13:09:47</span
              ><span class="points-container"
                >Points: <span class="points">348</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39344355"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39344292">
          <h3>
            <a
              class="item"
              href="https://kbd.news/The-story-of-Signature-Plastics-2271.html"
              >The story of Signature Plastics</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-12 @ 13:01:07</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39344292"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39343831">
          <h3>
            <a
              class="item"
              href="https://seb.jambor.dev/posts/systemd-by-example-part-1-minimization/"
              >systemd by Example (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-12 @ 11:48:51</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39343831"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
