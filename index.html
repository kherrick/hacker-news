<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43513850">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/video/watch/incognito-mode-romance-scams"
              >Scammers Steal $1T a Year – Mostly from Americans</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-29 @ 08:39:57</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43513850"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43513397">
          <h3>
            <a
              class="item"
              href="https://www2.eecs.berkeley.edu/Pubs/TechRpts/2018/EECS-2018-24.pdf"
              >Mathematical Compact Models of Advanced Transistors [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-29 @ 06:58:08</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43513397"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43512660">
          <h3>
            <a
              class="item"
              href="https://infosec.exchange/@wdormann/114242475168860209"
              >Upcoming Windows 11 builds cannot install without internet and
              Microsoft Account</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-29 @ 04:13:04</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43512660"
                  >Comments</a
                ><span class="descendants">: 132</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43512657">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2301.08243"
              >Self-Supervised Learning from Images with JEPA</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-29 @ 04:11:45</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43512657"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43512589">
          <h3>
            <a class="item" href="https://plainframework.com/"
              >Plain – a web framework for building products with Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-29 @ 03:55:02</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43512589"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43512495">
          <h3>
            <a
              class="item"
              href="https://openwrt.org/voting/2025-02-12-openwrt-two"
              >OpenWrt Two Approval</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-29 @ 03:34:07</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43512495"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43511464">
          <h3>
            <a class="item" href="https://www.mail-tester.com/test-p3tdhnk3o"
              >iCloud Mail has DNS misconfigured?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-29 @ 00:22:21</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43511464"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43510710">
          <h3>
            <a
              class="item"
              href="https://github.com/lvidgen/WebRTC/blob/master/FOSS_TURN_Server/howto.md"
              >Show HN: An Almost Free, Open Source TURN Server</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 22:46:43</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43510710"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
            <div class="text">
              <p>
                I have been messing around with WebRTC for a few years now but
                when it comes to the TURN server I never quite got to my gold
                standard of free, self-hosted and open source. I decided to give
                it a go using Oracle Cloud Infrastructure's free tier, meaning
                that my total spend got down to domain name hosting. I know
                plenty of people have been burnt by Oracle in the past, but I
                have had servers running on the free tier for 5 years now
                without so much as a hiccup. Regardless, the concepts will be
                the same using any cloud based server.
              </p>
              <p>
                This is the first time I've written up an end-to-end technical
                how-to like this and the audience I am writing for is really
                myself - I know just enough about networks and web dev and
                Linux, etc to get all this running and there are plenty of
                snippets out there on the web that tell you how to do one thing
                or another, but nowhere that puts it all together in one place
                so if I'm explaining what is obvious to you, my apologies - like
                I say, I'm writing to myself here.
              </p>
              <p>
                I don't know that this even is a Show HN - @dang, if it isn't,
                please feel free to recategorise/edit the title.
              </p>
              <p>
                @Everybody else, I am happy to answer questions if I can but
                please bear in mind that I am not claiming to be an expert on
                any of the tech gathered together to make this work.
              </p>
            </div>
          </section>
        </section>
        <section id="43510036">
          <h3>
            <a
              class="item"
              href="https://www.jeffgeerling.com/blog/2025/diy-ptp-grandmaster-clock-raspberry-pi"
              >DIY PTP Grandmaster Clock with a Raspberry Pi</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 21:37:21</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43510036"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43509923">
          <h3>
            <a
              class="item"
              href="https://twitter.com/elonmusk/status/1905731750275510312"
              >xAI has acquired X, xAI now valued at $80B</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 21:23:42</span
              ><span class="points-container"
                >Points: <span class="points">583</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43509923"
                  >Comments</a
                ><span class="descendants">: 792</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43509782">
          <h3>
            <a
              class="item"
              href="https://ats.rippling.com/finley-technologies/jobs"
              >Finley (YC W21) Is Hiring a Technical Implementations
              Specialist</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 21:01:49</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43509548">
          <h3>
            <a
              class="item"
              href="https://www.chrbutler.com/digital-echoes-and-unquiet-minds"
              >Digital Echoes and Unquiet Minds</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 20:29:32</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43509548"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43508418">
          <h3>
            <a
              class="item"
              href="https://www.landh.tech/blog/20250327-we-hacked-gemini-source-code/"
              >We hacked Gemini's Python sandbox and leaked its source code (at
              least some)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 18:12:58</span
              ><span class="points-container"
                >Points: <span class="points">508</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43508418"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43508061">
          <h3>
            <a class="item" href="https://github.com/EmberEmu/Hexi"
              >Show HN: Hexi – Modern header-only network binary serialisation
              for C++</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 17:37:42</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43508061"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
            <div class="text">
              <p>
                I decided to put together my own class to do the job, starting
                with an easy, low-overhead way to move bytes in and out of
                arbitrary buffers. Along the way, it picked up useful bits and
                pieces, such as buffer structures and allocators that made the
                byte shuffling faster, often being able to do it with zero
                allocations and zero copies. Safety features came along to make
                sure that malicious packet data or mistakes in the code wouldn't
                result in segfaults or vulnerabilities.
              </p>
              <p>
                It's become useful enough to me that I've packaged it up in its
                own standalone library on the chance that it might be useful to
                others. It has zero dependencies other than the standard library
                and has been designed for quick integration into any project
                within minutes, or seconds with a copy paste of the amalgamated
                header. It can be used in production code but it's also ideal
                for for those that want to quickly hack away at binary data with
                minimal fuss.
              </p>
            </div>
          </section>
        </section>
        <section id="43507404">
          <h3>
            <a
              class="item"
              href="https://99percentinvisible.org/episode/the-real-book/"
              >The Real Book (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 16:39:10</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43507404"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43506951">
          <h3>
            <a class="item" href="https://pianoboi.site"
              >Show HN Pianoboi – displays sheet music as you play your piano</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 15:55:17</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43506951"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
            <div class="text">
              <p>
                It displays sheet music as you play, and let's you take
                snapshots of specific chords, then keeps a running list of
                chords as keyboard visuals (instead of just displaying sheet
                music).
              </p>
              <p>
                Just a simple tool for songwriting/ figuring out songs by ear,
                or just understanding music key theory (which I'm admittedly a
                still a beginner at).
              </p>
            </div>
          </section>
        </section>
        <section id="43506238">
          <h3>
            <a
              class="item"
              href="https://terrytao.wordpress.com/2025/03/26/decomposing-a-factorial-into-large-factors/"
              >Decomposing a Factorial into Large Factors</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 14:55:54</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43506238"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43505334">
          <h3>
            <a class="item" href="https://fathom.lib.uchicago.edu/2/21701757/"
              >The Biology of B-Movie Monsters (2003)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 13:40:41</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43505334"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43504413">
          <h3>
            <a
              class="item"
              href="https://cardinalnews.org/2025/03/28/i-drove-300-miles-in-rural-virginia-then-asked-police-to-send-me-their-public-surveillance-footage-of-my-car-heres-what-i-learned/"
              >I asked police to send me their public surveillance footage of my
              car</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 12:14:06</span
              ><span class="points-container"
                >Points: <span class="points">576</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43504413"
                  >Comments</a
                ><span class="descendants">: 438</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43503872">
          <h3>
            <a
              class="item"
              href="https://refactoringenglish.com/chapters/write-blog-posts-developers-read/"
              >How to write blog posts that developers read</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 11:01:19</span
              ><span class="points-container"
                >Points: <span class="points">442</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43503872"
                  >Comments</a
                ><span class="descendants">: 134</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43502291">
          <h3>
            <a class="item" href="https://blog.startifact.com/posts/xee/"
              >Xee: A Modern XPath and XSLT Engine in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-28 @ 06:48:18</span
              ><span class="points-container"
                >Points: <span class="points">334</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43502291"
                  >Comments</a
                ><span class="descendants">: 180</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43485373">
          <h3>
            <a
              class="item"
              href="https://blog.polybdenum.com/2025/03/26/why-you-need-subtyping.html"
              >You Need Subtyping</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-26 @ 18:38:14</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43485373"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43478789">
          <h3>
            <a
              class="item"
              href="https://mattlakeman.org/2025/03/24/conquest-of-the-incas/"
              >Conquest of the Incas</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-26 @ 04:08:45</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43478789"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43478480">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/articles/c5yr37nlzv8o"
              >Window cleaner in quest to confirm priceless Shakespeare
              portrait</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-26 @ 03:08:01</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43478480"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43475982">
          <h3>
            <a class="item" href="https://stressgrid.com/blog/beam_cpu_usage/"
              >The Curious Case of Beam CPU Usage (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-25 @ 21:07:40</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43475982"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43473195">
          <h3>
            <a
              class="item"
              href="https://jsgroth.dev/blog/posts/emulating-ym2612-part-1/"
              >Emulating the YM2612: Part 1 – Interface</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-25 @ 16:33:50</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43473195"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43470416">
          <h3>
            <a
              class="item"
              href="https://gizmodo.com/the-carcinisation-of-playstation-is-complete-say-hello-to-playstacean-2000579934"
              >Playstation Mod Turns the PSOne into a Crustacean</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-25 @ 12:30:00</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43470416"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43470192">
          <h3>
            <a
              class="item"
              href="https://www.jamesshore.com/v2/projects/nullables/testing-without-mocks"
              >Testing Without Mocks: A Pattern Language (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-25 @ 12:00:56</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43470192"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43469535">
          <h3>
            <a
              class="item"
              href="https://seb-v.github.io/optimization/update/2025/01/20/Fast-GPU-Matrix-multiplication.html"
              >Optimizing Matrix Multiplication on RDNA3</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-25 @ 09:55:21</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43469535"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43467988">
          <h3>
            <a
              class="item"
              href="https://krisp.ai/blog/improving-turn-taking-of-ai-voice-agents-with-background-voice-cancellation/"
              >Noise cancellation improves turn-taking for AI Voice Agents</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-25 @ 03:56:17</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43467988"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
