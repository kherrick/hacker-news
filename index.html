<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40393877">
          <h3>
            <a
              class="item"
              href="https://developer.chrome.com/docs/devtools/console/understand-messages"
              >Chrome DevTools now uses Gemini to help with JavaScript Errors in
              the console</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-17 @ 20:25:47</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40393877"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40392709">
          <h3>
            <a
              class="item"
              href="https://gabrielsieben.tech/2024/05/17/thinking-out-loud-2nd-gen-email/"
              >Thinking out loud about 2nd-gen email</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-17 @ 18:16:14</span
              ><span class="points-container"
                >Points: <span class="points">150</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40392709"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40392548">
          <h3>
            <a class="item" href="https://www.useequityval.com/"
              >Show HN: I built a website to create financial models for any
              stock online</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-17 @ 17:59:22</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40392548"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40391627">
          <h3>
            <a
              class="item"
              href="https://blog.arduino.cc/2024/05/11/glewbot-scales-buildings-like-a-gecko/"
              >Glewbot scales buildings like a gecko to inspect wall tiles</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-17 @ 16:31:33</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40391627"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40391614">
          <h3>
            <a class="item" href="https://blog.datawrapper.de/dualaxis/"
              >The case against dual axis charts (and what to use instead)
              (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-17 @ 16:30:40</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40391614"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40390820">
          <h3>
            <a
              class="item"
              href="https://corporate.dukehealth.org/news/trial-hiv-vaccine-triggered-elusive-and-essential-antibodies-humans"
              >A Trial HIV Vaccine Triggered Elusive and Essential Antibodies in
              Humans</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-17 @ 15:15:11</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40390820"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40390751">
          <h3>
            <a
              class="item"
              href="https://worksinprogress.co/issue/the-beauty-of-concrete/"
              >The Beauty of Concrete</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-17 @ 15:09:15</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40390751"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40390287">
          <h3>
            <a class="item" href="https://github.com/HigherOrderCO/Bend"
              >Bend: a high-level language that runs on GPUs (via HVM2)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-17 @ 14:23:44</span
              ><span class="points-container"
                >Points: <span class="points">354</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40390287"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40389711">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2405.07425"
              >Sakuga-42M Dataset: Scaling Up Cartoon Research</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-17 @ 13:38:31</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40389711"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40389445">
          <h3>
            <a class="item" href="https://toon3d.studio/"
              >Toon3D: Seeing Cartoons from a New Perspective</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-17 @ 13:04:06</span
              ><span class="points-container"
                >Points: <span class="points">279</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40389445"
                  >Comments</a
                ><span class="descendants">: 89</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40389421">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2405.09673"
              >LoRA Learns Less and Forgets Less</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-17 @ 13:00:55</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40389421"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40389404">
          <h3>
            <a class="item" href="https://bastian.rieck.me/blog/2019/ideas/"
              >Ideas and Creativity (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-17 @ 12:59:34</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40389404"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40389267">
          <h3>
            <a
              class="item"
              href="https://media.ccc.de/v/mch2022-236-non-euclidean-doom-what-happens-to-a-game-when-pi-is-not-3-14159-"
              >Non-Euclidean Doom: what happens to a game when pi is not 3.14159
              (2022) [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-17 @ 12:43:14</span
              ><span class="points-container"
                >Points: <span class="points">303</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40389267"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40389094">
          <h3>
            <a class="item" href="https://www.sdiolatz.info/ndg-fitting/"
              >N-Dimensional Gaussians for Fitting of High Dimensional
              Functions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-17 @ 12:18:59</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40389094"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40388933">
          <h3>
            <a class="item" href="https://onesignal.com/careers/4360841006"
              >OneSignal (YC S11) Is Hiring an Engineering Manager</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-17 @ 12:00:23</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40388655">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2405.06067"
              >HMT: Hierarchical Memory Transformer for Long Context Language
              Processing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-17 @ 11:19:29</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40388655"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40388013">
          <h3>
            <a
              class="item"
              href="https://bdtechtalks.com/2020/09/16/deep-learning-game-of-life/"
              >Why neural networks struggle with the Game of Life (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-17 @ 09:26:37</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40388013"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40387812">
          <h3>
            <a
              class="item"
              href="http://www.unixwiz.net/techtips/reading-cdecl.html"
              >How to read C type declarations (2003)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-17 @ 08:57:51</span
              ><span class="points-container"
                >Points: <span class="points">115</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40387812"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40387318">
          <h3>
            <a
              class="item"
              href="https://www.revk.uk/2017/12/its-official-adsl-works-over-wet-string.html"
              >ADSL works over wet string (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-17 @ 07:24:02</span
              ><span class="points-container"
                >Points: <span class="points">157</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40387318"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40386026">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/places/zwentendorf-nuclear-power-plant"
              >Zwentendorf Nuclear Power Plant: Finished in 1978 but never
              used</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-17 @ 03:16:38</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40386026"
                  >Comments</a
                ><span class="descendants">: 105</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40384959">
          <h3>
            <a
              class="item"
              href="https://www.potaroo.net/ispcol/2024-05/starlink-tcp.html"
              >A transport protocol's view of Starlink</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-17 @ 00:17:02</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40384959"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40382056">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=Q76X0cnSGHk"
              >Show HN: Drivr â€“ VR with real vehicles [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 19:19:16</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40382056"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
            <div class="text">
              <p>
                The go-kart seen in this video is drive-by-wire and
                steer-by-wire, so the system will not let the player exit the
                defined safe area. If a player goes off course, the vehicle will
                take control, and return them to the start. The autonomous
                capabilities also allow for games where the player can focus on
                other objectives other than driving, such as target shooting.
              </p>
              <p>
                No infrastructure is required other than the vehicle and an open
                place to drive (which honestly has been the most challenging
                part lately).
              </p>
              <p>If you're interested in this project, I'd love to connect!</p>
            </div>
          </section>
        </section>
        <section id="40380744">
          <h3>
            <a
              class="item"
              href="https://slate.com/technology/2024/05/deviantart-what-happened-ai-decline-lawsuit-stability.html"
              >The Downfall of DeviantArt</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 17:12:22</span
              ><span class="points-container"
                >Points: <span class="points">244</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40380744"
                  >Comments</a
                ><span class="descendants">: 179</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40379532">
          <h3>
            <a
              class="item"
              href="https://crystalverse.com/sodium-chloride-crystals/"
              >Growing sodium chloride crystals at home</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 15:24:19</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40379532"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40379175">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/computer-scientists-invent-an-efficient-new-way-to-count-20240516/"
              >Computer scientists invent an efficient new way to count</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 14:54:25</span
              ><span class="points-container"
                >Points: <span class="points">675</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40379175"
                  >Comments</a
                ><span class="descendants">: 198</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40378993">
          <h3>
            <a
              class="item"
              href="https://www.lesswrong.com/posts/RWu8eZqbwgB9zaerh/third-time-a-better-way-to-work"
              >Third Time: a better way to work (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 14:35:28</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40378993"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40378760">
          <h3>
            <a
              class="item"
              href="https://restofworld.org/2023/china-tech-workers-investors-founders-app/"
              >Jike: The obscure social media app beloved by China's tech
              scene</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 14:15:04</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40378760"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40374815">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/culture/2024/05/john-miltons-handwritten-notes-make-this-16th-century-history-book-a-rare-find/"
              >Scholars discover rare 16th-century tome with handwritten notes
              by John Milton</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 03:03:41</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40374815"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40370644">
          <h3>
            <a
              class="item"
              href="https://spritely.institute/news/make-a-game-with-hoot-for-the-lisp-game-jam.html"
              >Make a game with Hoot for the Lisp Game Jam</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 18:32:53</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40370644"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40367444">
          <h3>
            <a
              class="item"
              href="https://lambdaland.org/posts/2024-05-01_definitely_not_about_monads/"
              >Boilerplate busting in functional languages</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 14:29:58</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40367444"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
