<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42296287">
          <h3>
            <a
              class="item"
              href="https://christopherferan.com/2021/12/25/kenya-and-the-decline-of-the-worlds-greatest-coffee/"
              >Kenya and "The Decline of the Greatest Coffee" (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-02 @ 14:02:25</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42296287"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42296228">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41586-024-08080-x"
              >Carbon dioxide capture from open air using covalent organic
              frameworks</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-02 @ 13:56:02</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42296228"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42296067">
          <h3>
            <a
              class="item"
              href="https://www.intel.com/content/www/us/en/newsroom/news/intel-ceo-news-dec-2024.html"
              >Intel Announces Retirement of CEO Pat Gelsinger</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-02 @ 13:37:42</span
              ><span class="points-container"
                >Points: <span class="points">312</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42296067"
                  >Comments</a
                ><span class="descendants">: 215</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42296034">
          <h3>
            <a class="item" href="https://capibarazero.com/"
              >CapibaraZero: A cheap alternative to FlipperZero based on
              ESP32-S3</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-02 @ 13:34:23</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42296034"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42295491">
          <h3>
            <a
              class="item"
              href="https://www.phoronix.com/news/Vulkan-Video-VCN2-VCN3-Default"
              >Vulkan Video Now Enabled by Default for Radeon VCN2/VCN3 Hardware
              on Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-02 @ 12:24:04</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42295491"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42294624">
          <h3>
            <a class="item" href="https://vimeo.com/1028745293"
              >Show HN: Visualizing website carbon footprints using steam and
              robotics [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-02 @ 09:46:35</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42294624"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <p>
                Built during a residency at a cultural venue in Belgium. Code
                and build details here :
                <a
                  href="https://gitlab.constantvzw.org/gijs/carbon-aware/-/tree/main/MAD?ref_type=heads"
                  >https://gitlab.constantvzw.org/gijs/carbon-aware/-/tree/main...</a
                >.
              </p>
            </div>
          </section>
        </section>
        <section id="42293723">
          <h3>
            <a class="item" href="https://github.com/briangu/klongpy"
              >KlongPy: High-Performance Array Programming in Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-02 @ 06:40:53</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42293723"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42293703">
          <h3>
            <a class="item" href="https://cs.uwaterloo.ca/~csk/hat/"
              >An Aperiodic Monotile (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-02 @ 06:37:13</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42293703"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42292909">
          <h3>
            <a
              class="item"
              href="https://www.therpf.com/forums/threads/the-rock-vx-gas-canister-build.344983/"
              >The Rock VX Gas Canister Build (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-02 @ 03:44:25</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42292909"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42292805">
          <h3>
            <a
              class="item"
              href="https://parentheticallyspeaking.org/articles/bicameral-not-homoiconic/"
              >Bicameral, Not Homoiconic</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-02 @ 03:24:07</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42292805"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42291781">
          <h3>
            <a
              class="item"
              href="https://retrocomputing.stackexchange.com/questions/12521/when-was-the-famous-sudo-warning-introduced-under-what-background-by-whom"
              >When was the famous "sudo warning" introduced? (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-02 @ 00:08:38</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42291781"
                  >Comments</a
                ><span class="descendants">: 105</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42291386">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/article/gene-behind-orange-fur-cats-found-last"
              >Gene behind orange fur in cats found at last</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 22:59:52</span
              ><span class="points-container"
                >Points: <span class="points">173</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42291386"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42291125">
          <h3>
            <a
              class="item"
              href="https://jeremycarterau.substack.com/p/thinking-in-actors-part-1"
              >Thinking in Actors – Challenging your software modelling to be
              simpler</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 22:16:38</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42291125"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42290996">
          <h3>
            <a class="item" href="https://www.math.uh.edu/~dblecher/pf2.html"
              >How to Study Mathematics (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 21:50:51</span
              ><span class="points-container"
                >Points: <span class="points">177</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42290996"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42290448">
          <h3>
            <a
              class="item"
              href="https://publicdomainreview.org/features/entering-the-public-domain/2025/"
              >What Will Enter the Public Domain in 2025?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 20:17:02</span
              ><span class="points-container"
                >Points: <span class="points">289</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42290448"
                  >Comments</a
                ><span class="descendants">: 229</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42290069">
          <h3>
            <a
              class="item"
              href="https://www.hillelwayne.com/post/divide-by-zero/"
              >1/0 = 0 (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 19:17:06</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42290069"
                  >Comments</a
                ><span class="descendants">: 168</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42290011">
          <h3>
            <a class="item" href="https://caseymuratori.com/blog_0010"
              >The Color of Noise (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 19:05:10</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42290011"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42289955">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42289955"
              >Ask HN: How can I grow as an engineer without good seniors to
              learn from?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 18:56:22</span
              ><span class="points-container"
                >Points: <span class="points">336</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42289955"
                  >Comments</a
                ><span class="descendants">: 208</span></span
              >
            </h4>
            <div class="text">
              <p>
                I was hired 6 months ago as a freelance data engineer, and after
                proving myself through my work quality, I am now essentially
                functioning as a tech lead, with full responsibility and
                ownership of designing, implementing, and hiring for the
                projects I'm assigned.
              </p>
              <p>
                Our company is not a tech company, so I only have a couple of
                tech-oriented colleagues, and I barely interact with them. Now I
                directly report to the director of the company, who in all
                senses is awesome, with 40+ years of combined experience in some
                of the biggest oil and drilling companies globally.
              </p>
              <p>
                However, I have some strong FOMO about not being able to learn
                much technical stuff from my peers or seniors. I am trying my
                best to learn and pick things up on my own, learning design
                principles, getting code reviews from chatGPT, etc. But even
                then, I'm afraid I am not producing the software to the highest
                standards of the industry since we don't have any rigorous
                cross-checking, and might be missing out on a lot of learning.
              </p>
              <p>
                Can someone who has been in positions similar to these please
                guide me?
              </p>
            </div>
          </section>
        </section>
        <section id="42289913">
          <h3>
            <a
              class="item"
              href="https://deadreckonings.com/2007/12/07/heavisides-operator-calculus/"
              >Heaviside’s Operator Calculus (2007)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 18:47:38</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42289913"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42289798">
          <h3>
            <a class="item" href="https://www.asimov.press/p/crick"
              >Francis Crick's "Central Dogma" was misunderstood</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 18:24:26</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42289798"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42289690">
          <h3>
            <a class="item" href="https://markwhen.com"
              >Show HN: Markwhen: Markdown for Timelines</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 17:58:48</span
              ><span class="points-container"
                >Points: <span class="points">624</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42289690"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42289310">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2411.12580"
              >Procedural knowledge in pretraining drives reasoning in large
              language models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 16:54:26</span
              ><span class="points-container"
                >Points: <span class="points">216</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42289310"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42287231">
          <h3>
            <a class="item" href="https://adventofcode.com/2024/about"
              >Advent of Code 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 09:09:35</span
              ><span class="points-container"
                >Points: <span class="points">1227</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42287231"
                  >Comments</a
                ><span class="descendants">: 491</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42260179">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42260179"
              >Ask HN: Tools or frameworks to build music theory games</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-27 @ 21:53:05</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42260179"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
            <div class="text">
              <p>
                He is now on a journey to build games that interact with notes
                on scores, like colorize all the Cs, click on the notes that are
                wrong vs what you hear etc.
              </p>
              <p>
                He is building everything from scratch, with the scores, the
                notes, and I'm wondering if there are some tools or libraries
                out there that provide much flexibility to build stuff for music
                theory.
              </p>
            </div>
          </section>
        </section>
        <section id="42255899">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=wTv5kvuP1hI"
              >The Timeless Way of Software [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-27 @ 13:25:39</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42255899"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42250773">
          <h3>
            <a
              class="item"
              href="https://neuralmagic.com/blog/24-sparse-llama-smaller-models-for-efficient-gpu-inference/"
              >What happens if we remove 50 percent of Llama?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-26 @ 22:27:09</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42250773"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42248567">
          <h3>
            <a
              class="item"
              href="https://make.mad-scientist.net/papers/jobserver-implementation/"
              >The GNU make jobserver Implementation (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-26 @ 18:42:02</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42248567"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42245573">
          <h3>
            <a class="item" href="https://github.com/steel-dev/steel-browser"
              >Show HN: Steel.dev – An open-source browser API for AI agents and
              apps</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-26 @ 13:34:40</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42245573"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42244832">
          <h3>
            <a class="item" href="https://latex.vercel.app/"
              >LaTeX.css – Make your website look like a LaTeX document</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-26 @ 11:41:27</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42244832"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42220580">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-11-ryugu-asteroid-sample-rapidly-colonized.html"
              >Ryugu asteroid sample colonized by terrestrial life despite
              strict control</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-23 @ 12:39:37</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42220580"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
