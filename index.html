<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="46630369">
          <h3>
            <a
              class="item"
              href="https://e360.yale.edu/digest/china-renewable-photo-essay"
              >Photos Capture the Breathtaking Scale of China's Wind and Solar
              Buildout</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-15 @ 09:54:10</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46630369"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46629957">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/nao-labs/jobs/KjOBhf5-founding-software-engineer"
              >Nao Labs (Open-Source Analytics Agent, YC X25) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-15 @ 08:59:27</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46629682">
          <h3>
            <a
              class="item"
              href="https://www.jeffgeerling.com/blog/2026/raspberry-pi-ai-hat-2/"
              >Raspberry Pi's New AI Hat Adds 8GB of RAM for Local LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-15 @ 08:23:02</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46629682"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46629610">
          <h3>
            <a class="item" href="https://dylan.gr/1768295794"
              >Have Taken Up Farming</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-15 @ 08:12:46</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46629610"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46629474">
          <h3>
            <a
              class="item"
              href="https://passo.uno/letter-those-who-fired-tech-writers-ai/"
              >A letter to those who fired tech writers because of AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-15 @ 07:58:23</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46629474"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46628397">
          <h3>
            <a class="item" href="https://github.com/cjpais/Handy"
              >Handy – Free open source speech-to-text app</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-15 @ 05:23:18</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46628397"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46627652">
          <h3>
            <a class="item" href="https://creepylink.com/"
              >The URL shortener that makes your links look as suspicious as
              possible</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-15 @ 03:28:20</span
              ><span class="points-container"
                >Points: <span class="points">458</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46627652"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46626836">
          <h3>
            <a
              class="item"
              href="https://patrickmccanna.net/a-better-way-to-limit-claude-code-and-other-coding-agents-access-to-secrets/"
              >Bubblewrap: A nimble way to prevent agents from accessing your
              .env files</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-15 @ 01:45:22</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46626836"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46626410">
          <h3>
            <a
              class="item"
              href="https://furiosa.ai/blog/introducing-rngd-server-efficient-ai-inference-at-data-center-scale"
              >Furiosa: 3.5x efficiency over H100s</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-15 @ 00:53:21</span
              ><span class="points-container"
                >Points: <span class="points">185</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46626410"
                  >Comments</a
                ><span class="descendants">: 121</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46626210">
          <h3>
            <a
              class="item"
              href="https://webkit.org/blog/17746/new-safari-developer-tools-provide-insight-into-css-grid-lanes/"
              >New Safari developer tools provide insight into CSS Grid Lanes</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-15 @ 00:34:59</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46626210"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46624658">
          <h3>
            <a class="item" href="https://craftinginterpreters.com/"
              >Crafting Interpreters</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-14 @ 22:26:17</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46624658"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46624541">
          <h3>
            <a class="item" href="https://cursor.com/blog/scaling-agents"
              >Scaling long-running autonomous coding</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-14 @ 22:18:04</span
              ><span class="points-container"
                >Points: <span class="points">215</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46624541"
                  >Comments</a
                ><span class="descendants">: 131</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46624352">
          <h3>
            <a
              class="item"
              href="https://cryptography.io/en/latest/statements/state-of-openssl/"
              >The State of OpenSSL for pyca/cryptography</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-14 @ 22:04:10</span
              ><span class="points-container"
                >Points: <span class="points">152</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46624352"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46623761">
          <h3>
            <a class="item" href="https://drajmarsh.bitbucket.io/earthsun.html"
              >Sun Position Calculator</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-14 @ 21:26:51</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46623761"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46622328">
          <h3>
            <a
              class="item"
              href="https://www.promptarmor.com/resources/claude-cowork-exfiltrates-files"
              >Claude Cowork exfiltrates files</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-14 @ 20:12:25</span
              ><span class="points-container"
                >Points: <span class="points">705</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46622328"
                  >Comments</a
                ><span class="descendants">: 313</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46619614">
          <h3>
            <a
              class="item"
              href="https://www.tavus.io/post/sparrow-1-human-level-conversational-timing-in-real-time-voice"
              >Show HN: Sparrow-1 – Audio-native model for human-level
              turn-taking without ASR</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-14 @ 18:01:23</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46619614"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
            <div class="text">
              <p>Some technical details:</p>
              <p>
                - Predicts conversational floor ownership, not speech endpoints
              </p>
              <p>- Audio-native streaming model, no ASR dependency</p>
              <p>- Human-timed responses without silence-based delays</p>
              <p>- Zero interruptions at sub-100ms median latency</p>
              <p>
                - In benchmarks Sparrow-1 beats all existing models at real
                world turn-taking baselines
              </p>
              <p>
                I wrote more about the work here:
                <a
                  href="https://www.tavus.io/post/sparrow-1-human-level-conversational-timing-in-real-time-voice"
                  >https://www.tavus.io/post/sparrow-1-human-level-conversation...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="46619464">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=46619464"
              >Ask HN: What did you find out or explore today?</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-14 @ 17:54:25</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46619464"
                  >Comments</a
                ><span class="descendants">: 186</span></span
              >
            </h4>
            <div class="text">
              Doesn't matter what domain and how big or small.
            </div>
          </section>
        </section>
        <section id="46618714">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=46618714"
              >Ask HN: Share your personal website</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-14 @ 17:07:42</span
              ><span class="points-container"
                >Points: <span class="points">656</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46618714"
                  >Comments</a
                ><span class="descendants">: 1832</span></span
              >
            </h4>
            <div class="text">
              <p>
                As you can see, the directory currently has only a handful of
                entries. I need your help to grow it. If you have a personal
                website, I would be glad if you shared it here. If your website
                is hosted on a web space where you have full control over its
                design and content, and if it has been well received in past HN
                discussions, I might add it to the directory. Just drop a link
                in the comments. Please let me know if you do not want your
                website to be included in the directory.
              </p>
              <p>
                Also, I intend this to be a community maintained resource, so if
                you would like to join the GitHub project as a maintainer,
                please let me know either here or via the IRC link in the
                README.
              </p>
              <p>
                By the way, see also 'Ask HN: Could you share your personal blog
                here?' - https://news.ycombinator.com/item?id=36575081 - July
                2023 - (1014 points, 1940 comments). In this post, the scope is
                not restricted to blogs though. Any personal website is welcome,
                whether it is a blog, digital garden, personal wiki or something
                else entirely.
              </p>
              <p>
                UPDATE: It is going to take a while to go through all the
                submissions and add them. If you'd like to help with the
                process, please send a PR directly to this project:
                https://github.com/hnpwd/hnpwd.github.io
              </p>
            </div>
          </section>
        </section>
        <section id="46618503">
          <h3>
            <a
              class="item"
              href="https://ianservin.com/2026/01/13/project-skywatch-aka-wescam-at-home/"
              >Project SkyWatch (a.k.a. Wescam at Home)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-14 @ 16:54:40</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46618503"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46617360">
          <h3>
            <a class="item" href="https://www.ismypubfucked.com/"
              >Find a pub that needs you</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-14 @ 15:44:22</span
              ><span class="points-container"
                >Points: <span class="points">318</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46617360"
                  >Comments</a
                ><span class="descendants">: 278</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46616529">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=46616529"
              >Ask HN: How are you doing RAG locally?</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-14 @ 14:38:29</span
              ><span class="points-container"
                >Points: <span class="points">200</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46616529"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
            <div class="text">
              <p>
                Are you using a vector database, some type of semantic search, a
                knowledge graph, a hypergraph?
              </p>
            </div>
          </section>
        </section>
        <section id="46616488">
          <h3>
            <a class="item" href="https://www.sparkfun.com/official-response"
              >SparkFun Officially Dropping AdaFruit due to CoC Violation</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-14 @ 14:34:57</span
              ><span class="points-container"
                >Points: <span class="points">472</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46616488"
                  >Comments</a
                ><span class="descendants">: 473</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46616481">
          <h3>
            <a class="item" href="https://github.com/cosinusalpha/webctl"
              >Show HN: Webctl – Browser automation for agents based on CLI
              instead of MCP</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-14 @ 14:34:40</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46616481"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
            <div class="text">
              <p>
                I initially built this to solve a personal headache: I wanted an
                AI agent to handle project management tasks on my company’s
                intranet. I needed it to persist cookies across sessions (to
                handle SSO) and then scrape a Kanban board.
              </p>
              <p>
                Existing AI browser tools (like current MCP implementations)
                often force unsolicited data into the context window—dumping the
                full accessibility tree, console logs, and network errors
                whether you asked for them or not.
              </p>
              <p>webctl is an attempt to solve this with a Unix-style CLI:</p>
              <p>
                - Filter before context: You pipe the output to standard tools.
                webctl snapshot --interactive-only | head -n 20 means the LLM
                only sees exactly what I want it to see.
              </p>
              <p>
                - Daemon Architecture: It runs a persistent background process.
                The goal is to keep the browser state (cookies/session) alive
                while you run discrete, stateless CLI commands.
              </p>
              <p>
                - Semantic targeting: It uses ARIA roles (e.g., role=button
                name~="Submit") rather than fragile CSS selectors.
              </p>
              <p>
                Disclaimer: The daemon logic for state persistence is still a
                bit experimental, but the architecture feels like the right
                direction for building local, token-efficient agents.
              </p>
              <p>It’s basically "Playwright for the terminal."</p>
            </div>
          </section>
        </section>
        <section id="46612711">
          <h3>
            <a
              class="item"
              href="https://developer.chrome.com/blog/geolocation-html-element"
              >The HTML Element</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-14 @ 05:35:20</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46612711"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46584523">
          <h3>
            <a class="item" href="https://sunrise-ev.com/z80.htm"
              >Z80 Mem­ber­ship Card</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-12 @ 05:42:09</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46584523"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46566974">
          <h3>
            <a
              class="item"
              href="https://tanelpoder.com/posts/generate-qr-code-with-pure-sql-in-postgres/"
              >Generate QR Codes with Pure SQL in PostgreSQL</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-10 @ 16:19:42</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46566974"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46564866">
          <h3>
            <a
              class="item"
              href="https://popovicu.com/posts/bare-metal-programming-risc-v/"
              >Bare metal programming with RISC-V guide (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-10 @ 11:38:39</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46564866"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46561341">
          <h3>
            <a class="item" href="https://webtiles.kicya.net/"
              >Show HN: WebTiles – create a tiny 250x250 website with neighbors
              around you</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-10 @ 00:32:10</span
              ><span class="points-container"
                >Points: <span class="points">198</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46561341"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
            <div class="text">
              There is a large grid of 250x250 tiles, on which you are be able
              to create a tiny website, contained into the tile. You can
              basically consider the tile as a mini version of your website,
              showcasing what your full site has (but it can be anything). You
              are able to link to your full site, and use any HTML/CSS/JS
              inside. The purpose is to create beautiful and interesting tiles,
              that could be used for exploring the indie-web in an easy and
              interesting way.
            </div>
          </section>
        </section>
        <section id="46558224">
          <h3>
            <a
              class="item"
              href="https://www.toxel.com/tech/2025/09/17/san-remo-pasta-measurer/"
              >San Remo Pasta Measurer</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-09 @ 19:39:53</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46558224"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46552534">
          <h3>
            <a
              class="item"
              href="https://electronics.stackexchange.com/questions/764155/how-can-i-build-a-simple-pulse-generator-to-demonstrate-transmission-lines"
              >How can I build a simple pulse generator to demonstrate
              transmission lines</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-09 @ 11:02:18</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46552534"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2026/index.md"
              >2026</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
