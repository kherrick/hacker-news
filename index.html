<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41212364">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/business/healthcare-pharmaceuticals/us-fda-approves-first-nasal-spray-allergic-reactions-2024-08-09/"
              >US FDA approves nasal spray alternative to EpiPen for allergic
              reactions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 21:30:46</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41212364"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41212271">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/2024/08/10/amds-strix-point-zen-5-hits-mobile/"
              >AMD's Strix Point: Zen 5 Hits Mobile</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 21:18:51</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41212271"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41212099">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41212099"
              >Ask HN: 19yr old child suffering from internet gaming disorder?
              Any suggestions?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 20:45:08</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41212099"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
            <div class="text">
              <p>
                They are not focused on internship, which is about to end, and I
                don't think they did a good job. I tried to help but they're
                just not prioritizing the work. When at home they are just
                spending time on the above game. It's hard for us to decide how
                much to push and how much to let go, in case it all backfires
                and makes it worse. I'm worried they are throwing this great
                educational opportunity away which will impact their entire
                future life and worse this develops into something even more
                serious that it already is.
              </p>
              <p>
                Has anyone else gone through this, personally or for a loved
                one, and has any suggestions?
              </p>
              <p>Thank you!!</p>
            </div>
          </section>
        </section>
        <section id="41211540">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/blog-post/things-i-won-t-work-dimethylcadmium"
              >Things I Won't Work With: Dimethylcadmium</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 19:11:39</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41211540"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41211519">
          <h3>
            <a
              class="item"
              href="https://old.reddit.com/r/Defcon/comments/1ep00ln/def_cons_response_to_the_badge_controversy/"
              >DEF CON's response to the badge controversy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 19:07:23</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41211519"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41211215">
          <h3>
            <a
              class="item"
              href="https://twitter.com/antoniogm/status/1822141923538161776"
              >Waymo got a ticket and there was confusion about who or what was
              being ticketed</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 18:10:53</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41211215"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41211039">
          <h3>
            <a class="item" href="https://dl.acm.org/doi/10.1145/3591264"
              >Interval parsing grammars for file format parsing (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 17:42:02</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41211039"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41210742">
          <h3>
            <a
              class="item"
              href="https://gist.github.com/bluepnume/8f2376b0893bc6b85564e7359359ecd4"
              >OneText (YC W23) is hiring a lead TypeScript/Node engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 17:00:01</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41210700">
          <h3>
            <a class="item" href="https://www.converay.com/"
              >Show HN: I created quick and simple file converter and resizer –
              Converay</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 16:52:49</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41210700"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
            <div class="text">
              <p>
                I wanted some tool to show the size after conversion as well as
                compare it with original.
              </p>
              <p>
                I feel Converay tool just does that. It's quick, simple &amp;
                intuitive
              </p>
              <p>
                I'm using it on my own for my day-to-day tasks, but if you have
                any suggestions for future releases - I'm all ears.
              </p>
              <p>Cheers</p>
            </div>
          </section>
        </section>
        <section id="41209994">
          <h3>
            <a class="item" href="https://github.com/supabase/pg_replicate"
              >Show HN: Pg_replicate – Build Postgres replication applications
              in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 15:00:41</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41209994"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41209688">
          <h3>
            <a class="item" href="https://github.com/evilsocket/opensnitch"
              >OpenSnitch is a GNU/Linux interactive application firewall</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 14:15:52</span
              ><span class="points-container"
                >Points: <span class="points">223</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41209688"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41209452">
          <h3>
            <a
              class="item"
              href="https://markjgillespie.com/Research/harnack-tracing/index.html"
              >Ray Tracing Harmonic Functions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 13:45:12</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41209452"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41209181">
          <h3>
            <a class="item" href="https://deeplive.cam"
              >Deep Live Cam: Real-time face swapping and one-click video
              deepfake tool</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 13:05:48</span
              ><span class="points-container"
                >Points: <span class="points">184</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41209181"
                  >Comments</a
                ><span class="descendants">: 139</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41208988">
          <h3>
            <a class="item" href="https://roitman.io/blog/91"
              >A wonderful coincidence or an expected connection: why π² ≈ g</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 12:24:54</span
              ><span class="points-container"
                >Points: <span class="points">332</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41208988"
                  >Comments</a
                ><span class="descendants">: 224</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41208934">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s44323-024-00005-1"
              >Evidence for ~12-h ultradian gene programs in humans</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 12:13:01</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41208934"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41208704">
          <h3>
            <a
              class="item"
              href="https://github.com/WeeJeWel/node-google-backup"
              >Command-Line Utility to Backup Google Mail, Calendar and Contacts
              to Files</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 11:13:37</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41208704"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41207417">
          <h3>
            <a
              class="item"
              href="http://fxrant.blogspot.com/2024/06/hal-hickel-on-creating-tarkin.html"
              >Hal Hickel on Creating Tarkin for Rogue One</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 05:00:00</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41207417"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41207182">
          <h3>
            <a
              class="item"
              href="https://www.caltech.edu/about/news/caltech-team-develops-first-noninvasive-method-to-continually-measure-true-blood-pressure"
              >Caltech Develops First Noninvasive Method to Continually Measure
              Blood Pressure</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 03:53:04</span
              ><span class="points-container"
                >Points: <span class="points">173</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41207182"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41206908">
          <h3>
            <a
              class="item"
              href="https://blog.screenshotbot.io/2024/08/10/building-a-highly-available-web-service-without-a-database/"
              >Building a highly-available web service without a database</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 02:37:55</span
              ><span class="points-container"
                >Points: <span class="points">236</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41206908"
                  >Comments</a
                ><span class="descendants">: 137</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41206465">
          <h3>
            <a
              class="item"
              href="https://blog.djhaskin.com/blog/common-lisp-community-survey-2024-results/"
              >Common Lisp Community Survey 2024 Results</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 00:17:59</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41206465"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41206025">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/2024/07/31/grace-hopper-nvidias-halfway-apu/"
              >Grace Hopper, Nvidia's Halfway APU</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-09 @ 22:52:13</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41206025"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41202064">
          <h3>
            <a class="item" href="https://github.com/TrafficGuard/nous"
              >Show HN: Nous – Open-Source Agent Framework with Autonomous, SWE
              Agents, WebUI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-09 @ 14:16:09</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41202064"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
            <div class="text">
              <p>
                It's a bit of CrewAI, OpenDevon, LangFuse/Cloud all in one,
                providing devs who prefer TypeScript an integrated framework
                thats provides a lot out of the box to start experimenting and
                building agents with.
              </p>
              <p>
                It started after peeking at the LangChain docs a few times and
                never liking the example code. I began experimenting with
                automating a simple Jira request from the engineering team to
                add an index to one of our Google Spanner databases (for context
                I'm the DevOps/SRE lead for an AdTech company).
              </p>
              <p>
                It incudes the tooling we're building out to automate processes
                from a DevOps/SRE perspective, which initially includes a
                configurable GitLab merge request AI reviewer.
              </p>
              <p>
                The initial layer above Aider (<a href="https://aider.chat/"
                  >https://aider.chat/</a
                >) grew into coding agent and an autonomous agent with
                LLM-independent function calling with auto-generated function
                schemas.
              </p>
              <p>
                And as testing via the CLI became unwieldy soon grew database
                persistence, tracing, a Web UI and human-in-the-loop
                functionality.
              </p>
              <p>
                One of the more interesting additions is the new autonomous
                agent which generates Python code that can call the available
                functions. Using the pyodide library the tool objects are
                proxied into the Python scope and executed in a WebAssembly
                sandbox.
              </p>
              <p>
                As its able to perform multiple calls and validation logic in a
                single control loop, it can reduce the cost and latency, getting
                the most out of the frontier LLMs calls with better reasoning.
              </p>
              <p>
                Benchmark runners for the autonomous agent and coding benchmarks
                are in the works to get some numbers on the capabilities so far.
                I'm looking forward to getting back to implementing all the
                ideas around improving the code and autonomous agents from a
                metacognitive perspective after spending time on docs,
                refactorings and tidying up recently.
              </p>
              <p>
                Check it out at
                <a href="https://github.com/trafficguard/nous"
                  >https://github.com/trafficguard/nous</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="41196237">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41196237"
              >Ask HN: Resources about math behind A/B testing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-08 @ 21:03:31</span
              ><span class="points-container"
                >Points: <span class="points">170</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41196237"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
            <div class="text">
              I've been learning more about AB testing during the last months.
              I've read almost all the work by Evan Miller, and I've enjoyed it
              a lot. However, I'd like a more structured approach to the topic
              since sometimes I feel I'm missing some basics. I've good math
              knowledge and pretty decent stats foundations. Which are your
              favourite books/papers in this topic?
            </div>
          </section>
        </section>
        <section id="41183439">
          <h3>
            <a
              class="item"
              href="https://dl.acm.org/doi/pdf/10.1145/140979.140985"
              >SQL/SE Query Language Extension for Schema Evolution (1992)
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-07 @ 17:25:09</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41183439"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41179043">
          <h3>
            <a
              class="item"
              href="https://www.ams.org/notices/200503/fea-weil.pdf"
              >A 1940 Letter of André Weil on Analogy in Mathematics (2003)
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-07 @ 07:31:12</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41179043"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41178372">
          <h3>
            <a
              class="item"
              href="https://www.historytoday.com/archive/history-matters/powers-soviet-puppetry"
              >The Powers of Soviet Puppetry</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-07 @ 04:59:51</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41178372"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41175784">
          <h3>
            <a
              class="item"
              href="https://solidpixel.github.io/astcenc_meets_sve"
              >An SVE backend for astcenc (Adaptive Scalable Texture Compression
              Encoder)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-06 @ 21:52:48</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41175784"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41172938">
          <h3>
            <a
              class="item"
              href="https://www.studiobinder.com/blog/what-is-rotoscope-animation-definition/"
              >What Is Rotoscope Animation? The Process Explained (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-06 @ 17:16:21</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41172938"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41166774">
          <h3>
            <a class="item" href="https://www.henrikkarlsson.xyz/p/unfolding"
              >Everything that turned out well in my life followed the same
              design process</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-06 @ 00:14:41</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41166774"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41165392">
          <h3>
            <a
              class="item"
              href="https://www.bps.org.uk/research-digest/influential-descriptions-depression-are-often-misleading"
              >Influential descriptions of depression are often misleading</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-05 @ 20:40:47</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41165392"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
