<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39468057">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/us-news/2024/feb/14/construction-worker-unions-wage-theft"
              >'It has gotten out of hand': wage theft rampant in US
              construction</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-22 @ 14:59:55</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39468057"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39467975">
          <h3>
            <a
              class="item"
              href="https://polypane.app/blog/polypane-18-introducing-polypane-portal/"
              >Polypane 18: Introducing Polypane Portal</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-22 @ 14:55:07</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39467975"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39467434">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/education/2024/02/22/yale-sat-act-admissions-requirement-reinstated/"
              >Yale will again require standardized test scores for admission</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-22 @ 14:21:12</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39467434"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39467413">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39467413"
              >Launch HN: Danswer (YC W24) – Open-source AI search and chat over
              private data</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-22 @ 14:20:15</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39467413"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/danswer-ai/danswer"
                >https://github.com/danswer-ai/danswer</a
              >). We’re building an open source and self-hostable ChatGPT-style
              system that can access your team’s unique knowledge by connecting
              to 25 of the most common workplace tools (Slack, Google Drive,
              Jira, etc.). You ask questions in natural language and get back
              answers based on your team’s documents. Where relevant, answers
              are backed by citations and links to the exact documents used to
              generate them.
              <p>
                Quick Demo:
                <a href="https://youtu.be/hqSouur2FXw"
                  >https://youtu.be/hqSouur2FXw</a
                >
              </p>
              <p>
                Originally Danswer was a side project motivated by a challenge
                we experienced at work. We noticed that as teams scale, finding
                the right information becomes more and more challenging. I
                recall being on call and helping a customer recover from a
                mission critical failure but the error was related to some
                obscure legacy feature I had never used. For most projects, a
                simple question to ChatGPT would have solved it; but in this
                moment, ChatGPT was completely clueless without additional
                context (which I also couldn’t find).
              </p>
              <p>
                We believe that within a few years, every org will be using
                team-specific knowledge assistants. We also understand that
                teams don’t want to tell us their secrets and not every team has
                the budget for yet another SaaS solution, so we open-sourced the
                project. It is just a set of containers that can be deployed on
                any cloud or on-premise. All of the data is processed and
                persisted on that same instance. Some teams have even opted to
                self-host open-source LLMs to truly airgap the system.
              </p>
              <p>
                I also want to share a bit about the actual design of the system
                (<a href="https://docs.danswer.dev/system_overview"
                  >https://docs.danswer.dev/system_overview</a
                >). If you have questions about any parts of the flow such as
                the model choice, hyperparameters, prompting, etc. we’re happy
                to go into more depth in the comments.
              </p>
              <p>
                The system revolves around a custom Retrieval Augmented
                Generation (RAG) pipeline we’ve built. During indexing time (we
                pull documents from connected sources every 10 minutes),
                documents are chunked and indexed into hybrid keyword+vector
                indices (<a
                  href="https://github.com/danswer-ai/danswer/blob/main/backend/danswer/indexing/indexing_pipeline.py#L211"
                  >https://github.com/danswer-ai/danswer/blob/main/backend/dans...</a
                >).
              </p>
              <p>
                For the vector index (which gives the system the flexibility to
                understand natural language queries), we use state of the art
                prefix-aware embedding models trained with contrastive loss.
                Optionally the system can be configured to go over each doc with
                multiple passes of different granularity to capture wide context
                vs fine details. We also supplement the vector search with a
                keyword based BM25 index + N-Grams so that the system performs
                well even in low data domains. Additionally we’ve added in
                learning from feedback and time based decay—see our custom
                ranking function (<a
                  href="https://github.com/danswer-ai/danswer/blob/main/backend/danswer/document_index/vespa/app_config/schemas/danswer_chunk.sd#L187"
                  >https://github.com/danswer-ai/danswer/blob/main/backend/dans...</a
                >
                – this flexibility is why we love Vespa as a Vector DB).
              </p>
              <p>
                At query time, we preprocess the query with query-augmentation,
                contextual-rephrasing, as well as standard techniques like
                removing stopwords and lemmatization. Once the top documents are
                retrieved, we ask a smaller LLM to decide which of the chunks
                are “useful for answering the query” (this is something we
                haven’t seen much of elsewhere, but our tests have shown to be
                one of the biggest drivers for both precision and recall).
                Finally the most relevant passages are passed to the LLM along
                with the user query and chat history to produce the final
                answer. We post-process by checking guardrails and extracting
                citations to link the user to relevant documents. (<a
                  href="https://github.com/danswer-ai/danswer/blob/main/backend/danswer/prompts/chat_prompts.py#L20"
                  >https://github.com/danswer-ai/danswer/blob/main/backend/dans...</a
                >)
              </p>
              <p>
                The Vector and Keyword indices are both stored locally and the
                NLP models run on the same instance (we’ve chosen ones that can
                run without GPU). The only exception is that the default
                Generative model is OpenAI’s GPT, however this can also be
                swapped out (<a
                  href="https://docs.danswer.dev/gen_ai_configs/overview"
                  >https://docs.danswer.dev/gen_ai_configs/overview</a
                >).
              </p>
              <p>
                We’ve seen teams use Danswer on problems like: Improving
                turnaround times for support by reducing time taken to find
                relevant documentation; Helping sales teams get customer context
                instantly by combing through calls and notes; Reducing lost
                engineering time from answering cross-team questions, building
                duplicate features due to inability to surface old tickets or
                code merges, and helping on-calls resolve critical issues faster
                by providing the complete history on an error in one place;
                Self-serving onboarding for new members who don’t know where to
                find information.
              </p>
              <p>
                If you’d like to play around with things locally, check out the
                quickstart guide here:
                <a href="https://docs.danswer.dev/quickstart"
                  >https://docs.danswer.dev/quickstart</a
                >. If you already have Docker, you should be able to get things
                up and running in &lt;15 minutes. And for folks who want a
                zero-effort way of trying it out or don’t want to self-host,
                please visit our Cloud:
                <a href="https://www.danswer.ai/">https://www.danswer.ai/</a>
              </p>
            </div>
          </section>
        </section>
        <section id="39467132">
          <h3>
            <a class="item" href="https://pagescms.org"
              >Show HN: Pages CMS – A CMS for GitHub</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-22 @ 13:58:03</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39467132"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
            <div class="text">
              <p>1. You log in with your GitHub account.</p>
              <p>
                2. You select the GitHub repo where your site/app is at (whether
                it's Next.js, 11ty, Hugo, Nuxt... as long as you're using flat
                files for content).
              </p>
              <p>
                3. You add a single config file to your repo to define the
                content types and other settings (e.g. media folder).
              </p>
              <p>
                4. Congrats: you now have a user friendly CMS to manage content
                + media BUT all changes are still tracked like regular commits
                (under your account) on GitHub.
              </p>
              <p>
                I started using Jekyll around 2009 and over the course of the
                past 10+ years, I've helped build major sites and tiny blogs
                with Hugo, Gatsby, Next.js and more recently 11ty.
              </p>
              <p>I still love it.</p>
              <p>
                BUT once you're done building, managing content and media can be
                a bit of a pain. You have a few options:
              </p>
              <p>
                - Edit files directly (on GitHub or your local). Good luck
                getting your colleagues on the marketing team to do that.
              </p>
              <p>
                - Hook up a headless CMS like Contentful, Sanity, or Strapi.
                That works, but it's one more dependency and (IMHO) overkill in
                most cases.
              </p>
              <p>
                - OR you could use something like [Decap CMS](<a
                  href="https://decapcms.org/"
                  >https://decapcms.org/</a
                >). Really cool project, but I've never been a fan of the UI/UX,
                and it's been a bit of a pain to setup (maybe that's just me).
              </p>
              <p>
                I wanted something as simple as possible, preferably with
                nothing to install or deploy.
              </p>
              <p>
                Back in 2018, I had built a prototype (Jekyll+) [1] with the
                idea of getting a CMS set up by just adding a single
                configuration file to your GitHub repository.
              </p>
              <p>
                Pages CMS [2] is a continuation of that idea. It's 100% free and
                Open Source:
                <a href="https://github.com/pages-cms/pages-cms"
                  >https://github.com/pages-cms/pages-cms</a
                >.
              </p>
              <p>
                If you don't want to use the online version because you're not
                comfortable signing up with your GitHub account, consider the
                following options:
              </p>
              <p>
                - Use a fine-grained personal access token [3], there's an
                option on the login screen. There is still a bug if you try to
                access a repo that isn't part of your token scope, but I'll get
                it fixed in the next couple of days.
              </p>
              <p>
                - Deploy it yourself (for free) on Cloudflare Pages. Literally 5
                minutes of work max. I made a video walking you through the
                process [4].
              </p>
              <p>
                - Check out the intro video on the front page [2] (a bit crap,
                but I'll get a better one up in the next few days).
              </p>
              <p>
                I use it actively with a few other teams, I hope it will be of
                use to some of you.
              </p>
              <p>
                I'm already working on adding a few nicer features, like
                collaborative editing and email invites (to let non-developers
                login without a GitHub account).
              </p>
              <p>
                PS: I've spent the past 8+ years building a business and only
                recently got back into coding. I'd love pointers as to what I
                could do better (and how I can manage my Powerpoint PTSD).
              </p>
              <p>
                [1]:
                <a href="https://github.com/hunvreus/jekyllplus/"
                  >https://github.com/hunvreus/jekyllplus/</a
                >
              </p>
              <p>
                [2]: <a href="https://pagescms.org">https://pagescms.org</a>
              </p>
              <p>
                [3]:
                <a
                  href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens#fine-grained-personal-access-tokens"
                  >https://docs.github.com/en/authentication/keeping-your-accou...</a
                >
              </p>
              <p>
                [4]:
                <a href="https://pagescms.org/docs/development/"
                  >https://pagescms.org/docs/development/</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="39466630">
          <h3>
            <a class="item" href="https://stability.ai/news/stable-diffusion-3"
              >Stable Diffusion 3</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-22 @ 13:20:39</span
              ><span class="points-container"
                >Points: <span class="points">359</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39466630"
                  >Comments</a
                ><span class="descendants">: 198</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39466417">
          <h3>
            <a
              class="item"
              href="https://journal.paoloamoroso.com/reading-a-programmers-guide-to-common-lisp"
              >Reading "A Programmer's Guide to Common Lisp"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-22 @ 13:00:22</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39466417"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39466246">
          <h3>
            <a
              class="item"
              href="https://modernfarmer.com/2024/02/plastic-farms-stop-plasticulture/"
              >Plastic is taking over farms</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-22 @ 12:42:15</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39466246"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39466160">
          <h3>
            <a class="item" href="https://tempestfpga.com/"
              >Replacement PCB Replicates Early 80s Modem</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-22 @ 12:32:23</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39466160"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39466021">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2402.10013"
              >Bridging empirical-theoretical gap in neural network formal
              language learning</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-22 @ 12:15:03</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39466021"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39465891">
          <h3>
            <a class="item" href="https://supernotes.app/open-source/sn-pro/"
              >SN Pro Typeface</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-22 @ 12:01:42</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39465891"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39465878">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/stepful/jobs/iLjGDJ0-product-engineer"
              >Stepful (YC S21) is hiring a product engineer in New York</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-22 @ 12:00:36</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39465852">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/society/2024/feb/22/the-mothers-fighting-a-scandal-bigger-than-thalidomide-we-were-told-the-medication-was-safe"
              >The mothers fighting a scandal bigger than thalidomide</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-22 @ 11:57:06</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39465852"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39465841">
          <h3>
            <a
              class="item"
              href="https://www.adrianriv.com/blog/2024/02/19/minimum_volume_ellipsoid/"
              >How to optimally trap points in high-dimensional spaces inside
              ellipsoids</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-22 @ 11:55:51</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39465841"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39465838">
          <h3>
            <a
              class="item"
              href="https://dlang.org/blog/2024/02/22/dmd-compiler-as-a-library-a-call-to-arms/"
              >DMD Compiler as a Library: A Call to Arms</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-22 @ 11:55:32</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39465838"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39465740">
          <h3>
            <a
              class="item"
              href="https://github.com/ory/kratos/releases/tag/v1.1.0"
              >Auth0 OSS alternative Ory Kratos now with passwordless and SMS
              support</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-22 @ 11:41:48</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39465740"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39465614">
          <h3>
            <a
              class="item"
              href="https://www.gimp.org/news/2024/02/21/gimp-2-99-18-released/"
              >GIMP 2.99.18: The last development preview before 3.0</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-22 @ 11:27:35</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39465614"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39465519">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/intel-18a"
              >A peek at Intel's future foundry tech</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-22 @ 11:15:42</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39465519"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39465517">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2024/02/22/cellular-outage-in-us-hits-att-t-mobile-and-verizon-users-downdetector-shows-.html"
              >Cellular outage in U.S. hits AT&amp;amp;T, T-Mobile and Verizon
              users</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-22 @ 11:15:05</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39465517"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39465485">
          <h3>
            <a
              class="item"
              href="https://20y.hu/~slink/journal/xylophone-duplo/"
              >The Xylophone Maze: Screen-free coding for children</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-22 @ 11:09:20</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39465485"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39465357">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2402.13753"
              >LongRoPE: Extending LLM Context Window Beyond 2M Tokens</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-22 @ 10:44:35</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39465357"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39465250">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2024/2/21/24079371/google-ai-gemini-generative-inaccurate-historical"
              >Google to pause Gemini image generation of people after issues</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-22 @ 10:19:50</span
              ><span class="points-container"
                >Points: <span class="points">297</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39465250"
                  >Comments</a
                ><span class="descendants">: 523</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39465235">
          <h3>
            <a
              class="item"
              href="https://www.zufallsheld.de/2024/02/21/interesting-use-of-ansible-ternary-filter/"
              >Interesting Uses of Ansible's ternary filter</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-22 @ 10:16:24</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39465235"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39465230">
          <h3>
            <a class="item" href="https://www.intuitivemachines.com/im-1"
              >Private company landing on the moon today</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-22 @ 10:15:16</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39465230"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39463215">
          <h3>
            <a
              class="item"
              href="https://www.founderscoop.com/2024/what-went-wrong-at-techstars/"
              >What went wrong at Techstars</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-22 @ 04:19:22</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39463215"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39451291">
          <h3>
            <a
              class="item"
              href="https://scorpiosoftware.net/2024/02/20/projected-file-system/"
              >Projected File System</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-21 @ 08:13:07</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39451291"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39451285">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-02-decimal-centuries-older-historians-thought.html"
              >Use of decimal point is 1.5 centuries older than historians
              thought</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-21 @ 08:12:24</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39451285"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39450987">
          <h3>
            <a
              class="item"
              href="https://www.chosenplaintext.ca/articles/beginners-guide-constant-time-cryptography.html"
              >A beginner's guide to constant-time cryptography (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-21 @ 07:18:10</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39450987"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39447603">
          <h3>
            <a
              class="item"
              href="https://news.delta.com/eclipse-viewing-30000-feet-delta-offer-path-totality-flight"
              >Eclipse viewing at 30k feet: Delta to offer path-of-totality
              flight</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-20 @ 22:04:47</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39447603"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39438577">
          <h3><a class="item" href="https://re2c.org/index.html">Re2c</a></h3>
          <section>
            <h4>
              <span>2024-02-20 @ 06:31:04</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39438577"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
