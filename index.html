<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36068956">
          <h3>
            <a
              class="item"
              href="https://studyfinds.org/snacking-processed-foods-brain/"
              >Better cognitive ability from less snacking of processed
              carbohydrates</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 10:26:13</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36068956"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36068944">
          <h3>
            <a
              class="item"
              href="https://huggingface.co/blog/4bit-transformers-bitsandbytes"
              >4-Bit Quantization and QLoRA</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 10:23:44</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36068944"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36068896">
          <h3>
            <a class="item" href="https://deno.com/blog/v1.34"
              >Deno 1.34: Deno compile supports NPM packages</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 10:16:00</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36068896"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36068850">
          <h3>
            <a
              class="item"
              href="https://lightning.ai/pages/blog/how-to-finetune-gpt-like-large-language-models-on-a-custom-dataset/"
              >How to Finetune GPT Like Large Language Models on a Custom
              Dataset</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 10:06:38</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36068850"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36067983">
          <h3>
            <a class="item" href="https://github.com/vanjs-org/van"
              >VanJS (Vanilla JavaScript): smallest reactive UI framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 07:31:10</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36067983"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36067846">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/keyval/jobs/gc3sdVX-founding-backend-engineer"
              >Keyval (YC W23) Is Hiring Founding Back End Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 07:01:09</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36066660">
          <h3>
            <a class="item" href="https://www.tecgraf.puc-rio.br/iup/"
              >IUP – Cross platform C GUI library</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 03:05:32</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36066660"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36066431">
          <h3>
            <a
              class="item"
              href="https://news.ucsc.edu/2023/05/animal-siblings.html"
              >Comb jellies proven to be the sibling group to all other
              animals</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 02:26:30</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36066431"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36065666">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/05/22/dining/restaurant-qr-code-menu.html"
              >The QR-code menu is being shown the door</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 00:17:14</span
              ><span class="points-container"
                >Points: <span class="points">115</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36065666"
                  >Comments</a
                ><span class="descendants">: 217</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36065175">
          <h3>
            <a
              class="item"
              href="https://geohot.github.io//blog/jekyll/update/2023/05/24/the-tiny-corp-raised-5M.html"
              >The tiny corp raised $5.1M</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-24 @ 23:25:17</span
              ><span class="points-container"
                >Points: <span class="points">534</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36065175"
                  >Comments</a
                ><span class="descendants">: 233</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36064971">
          <h3>
            <a class="item" href="https://xorvoid.com/sectorc.html"
              >SectorC: A C Compiler in 512 bytes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-24 @ 23:02:56</span
              ><span class="points-container"
                >Points: <span class="points">367</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36064971"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36064639">
          <h3>
            <a class="item" href="https://pixian.ai/remove-image-backgrounds"
              >Show HN: Image background removal without annoying
              subscriptions</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-24 @ 22:26:59</span
              ><span class="points-container"
                >Points: <span class="points">218</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36064639"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
            <div class="text">
              <p>
                Removing the background from images is a surprisingly common
                image processing task, and AI has made it really easy. The
                technology has come a long way since segment leader remove.bg
                launched here on hn in Dec 2018 [1]. Chasing remove.bg's
                success, a legion of providers have come on the market offering
                varying levels of quality &amp; service.
              </p>
              <p>
                Despite there being a large number of competing services, most
                still price for very high (~95%?) gross margins. Furthermore,
                subscriptions make the effective unit price a lot higher than
                the list price for infrequent users, and requires effort &amp;
                attention to ensure you're getting value for money. This has
                prevented a host of use cases (e.g. infrequent professional /
                hobbyist) and business models (e.g. ad-supported websites &amp;
                mobile apps).
              </p>
              <p>
                We see this as an opportunity where we can jump to the market's
                logical conclusion to gain market share and build goodwill:
                cost-plus PAYGO pricing, i.e. the "S3 pricing model".
              </p>
              <p>
                So we've built yet-another image background removal service (
                <a href="https://pixian.ai">https://pixian.ai</a> - introductory
                post 6 months ago [2], a ton has been improved since then) but
                with a couple of twists:
              </p>
              <p>
                1. Quantified quality comparison (90-120% of remove.bg,
                depending on image category), free for you to check your own
                images so you can make an informed choice.
              </p>
              <p>
                2. Customer-friendly pricing (PAYGO @ 1-10% of competitors'
                subscriptions) with a generous free tier (and free while in
                beta).
              </p>
              <p>
                3. A novel API result format: Delta PNG [3], which offers
                excellent latency &amp; bandwidth savings. Especially useful for
                mobile apps.
              </p>
              <p>
                4. Operational transparency: actual volume &amp; latency metrics
                public, with more coming soon (all API providers should be
                showing this).
              </p>
              <p>
                There's of course more to it than just price and we see several
                sources of differentiation in this market: quality, price,
                capability, reliability, latency, and goodwill.
              </p>
              <p>
                As a new entrant we're looking to meet-or-beat the quality bar;
                beat on price, capability, reliability and latency; and to build
                up goodwill over time.
              </p>
              <p>
                Our goal is to make it a no-brainer for new accounts to choose
                us, and to provide the tools and guidance necessary for existing
                accounts to make the switch with confidence.
              </p>
              <p>We'd love for you to try it out and to hear your thoughts!</p>
              <p><a href="https://pixian.ai">https://pixian.ai</a></p>
              <p>
                [1]
                <a href="https://news.ycombinator.com/item?id=18697601"
                  >https://news.ycombinator.com/item?id=18697601</a
                >
                [2]
                <a href="https://news.ycombinator.com/item?id=33439405"
                  >https://news.ycombinator.com/item?id=33439405</a
                >
                [3]
                <a href="https://pixian.ai/api/deltaPng"
                  >https://pixian.ai/api/deltaPng</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="36064568">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2305.14314"
              >QLoRA: Efficient Finetuning of Quantized LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-24 @ 22:19:39</span
              ><span class="points-container"
                >Points: <span class="points">264</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36064568"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36064515">
          <h3>
            <a
              class="item"
              href="https://www.acm.org/media-center/2023/may/dissertation-award-2022"
              >UCLA computer grad constructs “crown jewel of cryptography”</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-24 @ 22:14:26</span
              ><span class="points-container"
                >Points: <span class="points">246</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36064515"
                  >Comments</a
                ><span class="descendants">: 96</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36064305">
          <h3>
            <a class="item" href="https://github.com/patte/fly-tailscale-exit"
              >Make your own VPN with Fly.io, tailscale and GitHub</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-24 @ 21:50:00</span
              ><span class="points-container"
                >Points: <span class="points">268</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36064305"
                  >Comments</a
                ><span class="descendants">: 108</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36063943">
          <h3>
            <a
              class="item"
              href="https://blog.thunderbird.net/2023/05/introducing-the-brand-new-thunderbird-logo/"
              >The brand new Thunderbird logo</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-24 @ 21:13:59</span
              ><span class="points-container"
                >Points: <span class="points">504</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36063943"
                  >Comments</a
                ><span class="descendants">: 211</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36061574">
          <h3>
            <a
              class="item"
              href="https://github.com/Kneesnap/onstream-data-recovery/blob/main/info/INTRO.MD"
              >The long road to recover Frogger 2 source from tape drives</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-24 @ 17:41:39</span
              ><span class="points-container"
                >Points: <span class="points">455</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36061574"
                  >Comments</a
                ><span class="descendants">: 173</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36061407">
          <h3>
            <a
              class="item"
              href="https://blog.pypi.org/posts/2023-05-24-pypi-was-subpoenaed/"
              >PyPI Was Subpoenaed</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-24 @ 17:28:12</span
              ><span class="points-container"
                >Points: <span class="points">1035</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36061407"
                  >Comments</a
                ><span class="descendants">: 493</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36061344">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36061344"
              >Launch HN: Dittofeed (YC S22) – open-source customer engagement
              platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-24 @ 17:24:05</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36061344"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
            <div class="text">
              <a href="https://dittofeed.com">https://dittofeed.com</a>. We make
              it easy for growth and marketing teams to message their customers
              across multiple channels. We're an open source alternative to
              platforms like Iterable,
              <a href="http://customer.io/">http://customer.io/</a>, Braze, and
              OneSignal. Here’s a short demo video showing how to run the
              platform locally, and use it to automate a customer onboarding
              journey:
              <p>
                <a
                  href="https://www.loom.com/share/0f7b67170b3a4205add00c22844ca06f"
                  >https://www.loom.com/share/0f7b67170b3a4205add00c22844ca06f</a
                >
              </p>
              <p>
                We created Dittofeed to tackle some commonly felt pains with
                customer engagement platforms:
              </p>
              <p>
                First, existing platforms make it difficult to keep imported
                user data accurate and up to date with your primary user
                datastore. To solve this, we’re building first-class support for
                importing data from your data warehouse, for better data
                consistency.
              </p>
              <p>
                Second, graphical “journey builders” are fragile, and difficult
                to debug at scale, so we’re building git-based workflows to
                check your messaging automation into git as configuration, as
                well the ability to run Dittofeed locally in development, or in
                CI with our testing sdk, for improved ease of debugging.
              </p>
              <p>
                Third, companies in industries like finance and healthcare are
                often forced to implement their own solutions in-house to avoid
                sharing sensitive PII with third parties. As an open source
                platform, companies can now self-host us to keep their PII in
                their network.
              </p>
              <p>
                Chandler, having worked in marketing for startups, experienced
                these challenges first hand. Max, on the other hand, was a
                senior platform infrastructure engineer at Braze, where he
                witnessed similar challenges from a technical perspective. Our
                combined experiences sparked the idea for Dittofeed.
              </p>
              <p>
                We decided to create an open source, developer-focused customer
                engagement platform, because the often unspoken truth is that
                maximizing the effectiveness of these tools requires ongoing
                engineering involvement.
              </p>
              <p>
                Dittofeed is built on Clickhouse (OLAP store used for storing
                user events, performing user segmentation, and aggregations) and
                Postgres (OLTP store for persisting application configuration,
                and serving user aggregations for efficient single-row reads).
              </p>
              <p>
                If you can use the following, we’d love it if you checked us
                out:
              </p>
              <p>Email support via sendgrid (other channels coming soon).</p>
              <p>User data import via Segment integration.</p>
              <p>
                We have a cloud offering, and offer paid support. You can find
                our pricing on our site
                <a href="https://dittofeed.com/pricing"
                  >https://dittofeed.com/pricing</a
                >.
              </p>
              <p>How to try Dittofeed out:</p>
              <p>
                Check out our demo site to play around with the app
                <a href="https://demo.dittofeed.com/dashboard"
                  >https://demo.dittofeed.com/dashboard</a
                >
              </p>
              <p>
                Run the app locally via docker compose (<a
                  href="https://docs.dittofeed.com/deployment/self-hosted/docker-compose"
                  >https://docs.dittofeed.com/deployment/self-hosted/docker-com...</a
                >).
              </p>
              <p>
                Join our slack and we’ll set you up with cloud hosting (<a
                  href="https://join.slack.com/t/dittofeed-community/shared_invite/zt-1u3lyts83-P6npff1AbjniNRLVlrlM5A"
                  >https://join.slack.com/t/dittofeed-community/shared_invite/z...</a
                >)
              </p>
              <p>
                We’d love to hear your thoughts, opinions, and experiences with
                these tools. What’s been your experience working with this kind
                of tech?
              </p>
            </div>
          </section>
        </section>
        <section id="36057523">
          <h3>
            <a
              class="item"
              href="https://blog.gingerbeardman.com/2023/05/24/ordering-photocopies-from-japans-national-library/"
              >Ordering Photocopies from Japan's National Library</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-24 @ 13:12:04</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36057523"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36057222">
          <h3>
            <a
              class="item"
              href="https://medium.com/@tenyks_blogger/mean-average-precision-definition-and-common-myths-c679a809807a"
              >Mean Average Precision (mAP): Common Definitions, Myths and
              Misconceptions</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-24 @ 12:43:46</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36057222"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36056589">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/science-nature/inside-the-first-deep-sea-dive-in-history-180982128/"
              >The First Deep-Sea Dive in History</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-24 @ 11:37:21</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36056589"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36056408">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/news/tape-storage-trundles-on-increases-yearly-volume-to-128-exabytes"
              >Tape Storage Trundles On, Increases Yearly Volume to 128
              Exabytes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-24 @ 11:16:00</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36056408"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36056299">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36056299"
              >Ask HN: How do you not take criticism of your work personally?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-24 @ 11:00:23</span
              ><span class="points-container"
                >Points: <span class="points">294</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36056299"
                  >Comments</a
                ><span class="descendants">: 286</span></span
              >
            </h4>
            <div class="text">
              <p>
                I see this as one of my major flaws and try hard to mask how I
                feel. But I just hope to learn to stop feeling bad for honest
                mistakes.
              </p>
            </div>
          </section>
        </section>
        <section id="36055426">
          <h3>
            <a class="item" href="http://john.maloney.org/Patterns/patterns.htm"
              >Thin Film Patterns</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-24 @ 08:27:59</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36055426"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36054868">
          <h3>
            <a
              class="item"
              href="https://blog.koehntopp.info/2023/03/14/tracing-python.html"
              >Tracing Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-24 @ 06:45:02</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36054868"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36054820">
          <h3>
            <a
              class="item"
              href="https://onthepublicrecord.org/2009/03/25/trust-and-the-peripheral-canal/"
              >Trust and the Peripheral Canal</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-24 @ 06:36:50</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36054820"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36054416">
          <h3>
            <a
              class="item"
              href="https://xmonader.github.io/letsbuildacompiler-pretty/tutor01_introduction.html"
              >Let's Build a Compiler (1988)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-24 @ 05:28:25</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36054416"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36028045">
          <h3>
            <a
              class="item"
              href="https://tetzoo.com/blog/2023/5/10/basilisks-revisited"
              >The Remarkable Basilisks</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 06:16:22</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36028045"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36020067">
          <h3>
            <a
              class="item"
              href="https://nhm.org/stories/microscopic-look-snail-jaws"
              >A Microscopic Look at Snail Jaws</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-21 @ 12:07:23</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36020067"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
