<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37427127">
          <h3>
            <a class="item" href="https://hackyournews.com/"
              >Show HN: HackYourNews â€“ AI summaries of the top HN stories</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 23:30:33</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37427127"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
            <div class="text">
              <p>
                I wanted to share a pet project of mine. I built HackYourNews
                [1] to scratch a personal itch: Knowing which stories to focus
                on while browsing aimlessly (though there is a certain joy in
                that, as well!)
              </p>
              <p>
                HackYourNews uses OpenAI's gpt-3.5-turbo to summarize the
                destination article as well as the comments section.
                Summarization of the article is always cached, while summaries
                of the comments are regenerated if the comments count is &gt;10%
                (or &gt;10 comments) different.
              </p>
              <p>
                While I styled the homepage to welcome HNers, my preferred view
                is the Mobile view, accessed from the navbar. This no-frills
                view honors OS-level dark mode and is easy to skim on any
                device.
              </p>
              <p>
                Tried to keep the site minimal. The only JS is Cloudflare's
                privacy-preserving analytics [2], just to gauge interest.
              </p>
              <p>This is the first time I'm releasing something to the wild.</p>
              <p>Hope you find this useful!</p>
              <p>The frontend is pure HTML+CSS.</p>
              <p>
                The backend is NodeJS (Puppeteer) + Python with the excellent
                Microsoft Guidance [3] library to interface to OpenAI's API.
              </p>
              <p>
                [1]
                <a href="https://hackyournews.com/"
                  >https://hackyournews.com/</a
                >
              </p>
              <p>
                [2]
                <a href="https://www.cloudflare.com/web-analytics/"
                  >https://www.cloudflare.com/web-analytics/</a
                >
              </p>
              <p>
                [3]
                <a href="https://github.com/guidance-ai/guidance"
                  >https://github.com/guidance-ai/guidance</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="37427008">
          <h3>
            <a
              class="item"
              href="https://grizzlyreports.com/we-believe-pdd-is-a-dying-fraudulent-company-and-its-shopping-app-temu-is-cleverly-hidden-spyware-that-poses-an-urgent-security-threat-to-u-s-national-interests/"
              >TEMU Is Cleverly Hidden Spyware That Poses an Urgent Security
              Threat to U.S.</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 23:18:31</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37427008"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37426223">
          <h3>
            <a
              class="item"
              href="https://github.com/searx/searx/commit/276ffd3f01cdd823f75676c51231fad4040059d3"
              >Searx is no longer maintained</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 22:04:10</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37426223"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37425855">
          <h3>
            <a
              class="item"
              href="https://www.freightwaves.com/news/i-rode-with-an-ice-road-trucker-to-the-arctic-circle-heres-what-it-was-like"
              >What it's Really Like to be an Alaskan Truck Driver</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 21:27:38</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37425855"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37425130">
          <h3>
            <a
              class="item"
              href="https://github.com/samvher/bert-for-laptops/blob/main/BERT_for_laptops.ipynb"
              >A BERT for laptops, from scratch</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 20:30:27</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37425130"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37425007">
          <h3>
            <a
              class="item"
              href="https://citizenlab.ca/2023/09/blastpass-nso-group-iphone-zero-click-zero-day-exploit-captured-in-the-wild/"
              >NSO group iPhone zero-click, zero-day exploit captured in the
              wild</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 20:21:01</span
              ><span class="points-container"
                >Points: <span class="points">541</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37425007"
                  >Comments</a
                ><span class="descendants">: 325</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37424416">
          <h3>
            <a class="item" href="https://apps.london.gov.uk/street-trees/"
              >London Street Trees</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 19:34:41</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37424416"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37423811">
          <h3>
            <a
              class="item"
              href="https://kevincox.ca/2023/09/02/ricochet-robots-solver/"
              >Ricochet Robots Solver</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 18:53:08</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37423811"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37422624">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/science/2023/sep/07/humanised-kidneys-grown-inside-pigs-for-the-first-time"
              >Humanised kidneys grown inside pigs for the first time</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 17:38:12</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37422624"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37422615">
          <h3>
            <a class="item" href="https://www.adept.ai/blog/persimmon-8b"
              >Persimmon-8B</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 17:37:47</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37422615"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37422115">
          <h3>
            <a class="item" href="https://archive.org/details/ProjectMars"
              >Project Mars (1953)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 17:08:35</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37422115"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37421573">
          <h3>
            <a
              class="item"
              href="https://forums.atariage.com/topic/354609-atariage-atari/"
              >AtariAge and Atari</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 16:35:02</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37421573"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37421554">
          <h3>
            <a
              class="item"
              href="https://www.collabora.com/news-and-blog/news-and-events/video-codecs-adding-av1-stateless-video-decoder-support-to-linux.html"
              >Video codecs: Adding AV1 stateless video decoder support to
              Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 16:33:43</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37421554"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37421529">
          <h3>
            <a
              class="item"
              href="https://www.modular.com/blog/mojo-its-finally-here"
              >Mojo is available for local download</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 16:32:15</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37421529"
                  >Comments</a
                ><span class="descendants">: 128</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37421104">
          <h3>
            <a
              class="item"
              href="https://suricrasia.online/blog/turning-a-keyboard-into/"
              >Turning a keyboard into a mouse with Libevdev</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 16:09:27</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37421104"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37421083">
          <h3>
            <a
              class="item"
              href="https://www.espn.com/nfl/story/_/id/38343968/study-finds-influence-smaller-jersey-numbers-perception"
              >Study finds influence of smaller jersey numbers on perception</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 16:08:08</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37421083"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37420885">
          <h3>
            <a
              class="item"
              href="https://blogs.microsoft.com/on-the-issues/2023/09/07/copilot-copyright-commitment-ai-legal-concerns/"
              >Microsoft will assume liability for legal copyright risks of
              Copilot</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 15:56:31</span
              ><span class="points-container"
                >Points: <span class="points">371</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37420885"
                  >Comments</a
                ><span class="descendants">: 278</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37420831">
          <h3>
            <a
              class="item"
              href="https://blog.google/threat-analysis-group/active-north-korean-campaign-targeting-security-researchers/"
              >North Korean campaign targeting security researchers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 15:53:23</span
              ><span class="points-container"
                >Points: <span class="points">399</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37420831"
                  >Comments</a
                ><span class="descendants">: 193</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37420812">
          <h3>
            <a class="item" href="http://www-formal.stanford.edu/jmc/facts.txt"
              >John McCarthyâ€™s collection of numerical facts for use in elisp
              programs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 15:52:09</span
              ><span class="points-container"
                >Points: <span class="points">153</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37420812"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37420690">
          <h3>
            <a
              class="item"
              href="https://predr.ag/blog/semver-violations-are-common-better-tooling-is-the-answer/"
              >Semver violations are common, better tooling is the answer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 15:45:04</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37420690"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37420281">
          <h3>
            <a class="item" href="https://blog.kagi.com/small-web"
              >Kagi Small Web</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 15:22:26</span
              ><span class="points-container"
                >Points: <span class="points">498</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37420281"
                  >Comments</a
                ><span class="descendants">: 134</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37420053">
          <h3>
            <a
              class="item"
              href="https://tailscale.com/blog/mullvad-integration/"
              >Mullvad on Tailscale: Privately browse the web</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 15:09:19</span
              ><span class="points-container"
                >Points: <span class="points">431</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37420053"
                  >Comments</a
                ><span class="descendants">: 242</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37419886">
          <h3>
            <a class="item" href="https://retool.com/products/ai">Retool AI</a>
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 15:00:15</span
              ><span class="points-container"
                >Points: <span class="points">175</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37419886"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37419864">
          <h3>
            <a
              class="item"
              href="https://blog.duolingo.com/words-shared-in-all-languages/"
              >Are any words the same in all languages?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 14:58:59</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37419864"
                  >Comments</a
                ><span class="descendants">: 171</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37417698">
          <h3>
            <a class="item" href="https://github.com/stanfordnlp/dspy"
              >DSPy: Framework for programming with foundation models</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 12:04:02</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37417698"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37417646">
          <h3>
            <a class="item" href="https://github.com/lsmor/snake-fury"
              >Snake-fury â€“ a challenge for Haskell beginners</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 11:57:23</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37417646"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37417055">
          <h3>
            <a
              class="item"
              href="https://muldoon.cloud/2023/09/06/software-keeps-failing.html"
              >Every software project is a startup that will probably fail</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 10:41:56</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37417055"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37417027">
          <h3>
            <a
              class="item"
              href="https://mathspp.com/blog/animations-from-first-principles-in-5-minutes"
              >Animations From First Principles (in 5 minutes)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 10:38:07</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37417027"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37415505">
          <h3>
            <a class="item" href="https://github.com/JuliaDebug/Cthulhu.jl"
              >Cthulhu.jl â€“ show type-inferred Julia code</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-07 @ 06:40:36</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37415505"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37412560">
          <h3>
            <a
              class="item"
              href="https://www.vulture.com/article/rotten-tomatoes-movie-rating.html"
              >The Decomposition of Rotten Tomatoes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-06 @ 22:56:52</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37412560"
                  >Comments</a
                ><span class="descendants">: 378</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
