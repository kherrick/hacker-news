<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44302650">
          <h3>
            <a
              class="item"
              href="https://www.dedoimedo.com/computers/xlibre.html"
              >Long live Xorg, I mean Xlibre</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-17 @ 19:03:23</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44302650"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44302414">
          <h3>
            <a
              class="item"
              href="https://gizmodo.com/astronomers-just-solved-the-mystery-of-the-universes-missing-matter-2000616320"
              >Astronomers Just Solved the Mystery of the Universe's Missing
              Matter</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-17 @ 18:44:14</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44302414"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44301998">
          <h3>
            <a
              class="item"
              href="https://kumo.ai/research/time-series-forecasting/"
              >Time Series Forecasting with Graph Transformers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-17 @ 18:05:53</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44301998"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44301809">
          <h3>
            <a
              class="item"
              href="https://www.anthropic.com/engineering/building-effective-agents"
              >Building Effective AI Agents</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-17 @ 17:50:05</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44301809"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44301794">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/news/688267/threads-fediverse-feed-search"
              >Threads is adding Fediverse content to social feeds</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-17 @ 17:48:53</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44301794"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44301686">
          <h3>
            <a
              class="item"
              href="https://kianbradley.com/2025/06/15/resurrecting-a-dead-tracker.html"
              >Resurrecting a dead torrent tracker and finding 3M peers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-17 @ 17:40:19</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44301686"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44301660">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/p/amds-cdna-4-architecture-announcement"
              >AMD's CDNA 4 Architecture Announcement – By Chester Lam</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-17 @ 17:38:02</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44301660"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44301373">
          <h3>
            <a class="item" href="https://osf.io/2kdez/wiki/home/"
              >Guidelines on how to be a scientific sleuth released</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-17 @ 17:12:30</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44301373"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44301246">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/music/2025/jun/17/celebrated-pianist-and-writer-alfred-brendel-dies-aged-94"
              >Celebrated pianist and writer Alfred Brendel dies aged 94</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-17 @ 17:00:25</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44301246"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44301186">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/business/energy/investigation-into-spains-april-28-blackout-shows-no-evidence-cyberattack-2025-06-17/"
              >Miscalculation by Spanish power grid operator REE contributed to
              blackout</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-17 @ 16:54:44</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44301186"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44300717">
          <h3>
            <a
              class="item"
              href="https://blog.google/products/gemini/gemini-2-5-model-family-expands/"
              >Making 2.5 Flash and 2.5 Pro GA, and introducing Gemini 2.5
              Flash-Lite</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-17 @ 16:06:05</span
              ><span class="points-container"
                >Points: <span class="points">178</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44300717"
                  >Comments</a
                ><span class="descendants">: 111</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44300554">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2506.04266"
              >CPU-Based Layout Design for Picker-to-Parts Pallet Warehouses</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-17 @ 15:49:10</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44300554"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44300102">
          <h3>
            <a
              class="item"
              href="https://global.honda/en/topics/2025/c_2025-06-17ceng.html"
              >Honda conducts successful launch and landing of experimental
              reusable rocket</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-17 @ 15:02:12</span
              ><span class="points-container"
                >Points: <span class="points">467</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44300102"
                  >Comments</a
                ><span class="descendants">: 172</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44299970">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/jpeg-image-format-history"
              >Why JPEGs still rule the web (2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-17 @ 14:51:10</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44299970"
                  >Comments</a
                ><span class="descendants">: 143</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44299947">
          <h3>
            <a class="item" href="https://thezvi.substack.com/p/o3-turns-pro"
              >O3 Turns Pro</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-17 @ 14:49:50</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44299947"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44299354">
          <h3>
            <a
              class="item"
              href="https://www.nngroup.com/articles/hamburger-menu-icon-recognizability/"
              >The hamburger-menu icon today: Is it recognizable?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-17 @ 14:01:16</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44299354"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44298724">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2506.02774"
              >Voyager: Real-Time Splatting City-Scale 3D Gaussians on Your
              Phone</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-17 @ 13:08:01</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44298724"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44298656">
          <h3>
            <a
              class="item"
              href="https://bytes.zone/posts/should-we-design-for-iffy-internet/"
              >Should we design for iffy internet?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-17 @ 13:02:54</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44298656"
                  >Comments</a
                ><span class="descendants">: 115</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44297045">
          <h3>
            <a
              class="item"
              href="https://www.worksinprogress.news/p/the-magic-of-through-running"
              >The magic of through running</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-17 @ 08:57:46</span
              ><span class="points-container"
                >Points: <span class="points">151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44297045"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44296564">
          <h3>
            <a class="item" href="https://github.com/FossifyOrg"
              >Fossify – A suite of open-source, ad-free apps</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-17 @ 07:32:07</span
              ><span class="points-container"
                >Points: <span class="points">352</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44296564"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44293610">
          <h3>
            <a
              class="item"
              href="https://nautil.us/clergy-blown-away-by-psilocybin-1217112/"
              >What happens when clergy take psilocybin</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-16 @ 21:34:09</span
              ><span class="points-container"
                >Points: <span class="points">299</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44293610"
                  >Comments</a
                ><span class="descendants">: 442</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44293260">
          <h3>
            <a class="item" href="https://chawan.net/news/chawan-0-2-0.html"
              >Show HN: Chawan TUI web browser</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-16 @ 20:48:43</span
              ><span class="points-container"
                >Points: <span class="points">359</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44293260"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
            <div class="text">
              <p>
                Chawan started out as a w3m clone, and the UI still resembles
                it. However, the architecture has turned out quite different,
                with pages loaded in separate processes, and protocol/file type
                handling separated out into external binaries. An interesting
                result is that you can even register decoders for custom inline
                image formats, although practical use cases of this are rather
                minimal.
              </p>
              <p>
                There is a gallery showcasing some websites being rendered here:
                <a href="https://chawan.net/gallery/index.html"
                  >https://chawan.net/gallery/index.html</a
                >
              </p>
              <p>
                [1]: <a href="https://nim-lang.org">https://nim-lang.org</a>
              </p>
            </div>
          </section>
        </section>
        <section id="44292103">
          <h3>
            <a class="item" href="https://github.com/czhu12/canine"
              >Show HN: Canine – A Heroku alternative built on Kubernetes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-16 @ 18:27:59</span
              ><span class="points-container"
                >Points: <span class="points">294</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44292103"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
            <div class="text">
              <p>
                I've been working on Canine for about a year now. It started
                when I was sick of paying the overhead of using stuff like
                Heroku, Render, Fly, etc to host some web apps that I've built.
                At one point I was paying over $400 a month for hosting these in
                the cloud. Last year I moved all my stuff to Hetzner.
              </p>
              <p>For a 4GB machine, the cost of various providers:</p>
              <p>Heroku = $260 Fly.io = $65 Render = $85 Hetzner = $4</p>
              <p>(This problem gets a lot worse when you need &gt; 4GB)</p>
              <p>
                The only downside of using Hetzner is that there isn’t a super
                straightforward way to do stuff like:
              </p>
              <p>
                - DNS management / SSL certificate management - Team management
                - Github integration
              </p>
              <p>
                But I figured it should be easy to quickly build something like
                Heroku for my Hetzner instance. Turns out it was a bit harder
                than expected, but after a year, I’ve made some good progress
              </p>
              <p>
                The best part of Canine, is that it also makes it trivial to
                host any helm chart, which is available for basically any open
                source project, so everything from databases (e.g. Postgres,
                Redis), to random stuff like torrent tracking servers, VPN’s
                endpoints, etc.
              </p>
              <p>
                Open source:
                <a href="https://github.com/czhu12/canine"
                  >https://github.com/czhu12/canine</a
                >
                Cloud hosted version is:
                <a href="https://canine.sh">https://canine.sh</a>
              </p>
            </div>
          </section>
        </section>
        <section id="44290413">
          <h3>
            <a
              class="item"
              href="https://www.chemistryworld.com/opinion/benzene-at-200/4021504.article"
              >Benzene at 200</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-16 @ 15:16:47</span
              ><span class="points-container"
                >Points: <span class="points">230</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44290413"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44285956">
          <h3>
            <a class="item" href="https://github.com/sirgallo/cmapv2"
              >Cmapv2: A high performance, concurrent map</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-16 @ 01:00:15</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44285956"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44283637">
          <h3>
            <a
              class="item"
              href="https://medium.com/planet-stories/a-beginners-guide-to-calculating-oil-storage-tank-occupancy-with-help-of-satellite-imagery-e8f387200178"
              >Calculating Oil Storage Tank Occupancy with Help of Satellite
              Imagery</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-15 @ 17:30:07</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44283637"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44280926">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-025-01835-0"
              >How you breathe is like a fingerprint that can identify you</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-15 @ 06:41:31</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44280926"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44277284">
          <h3>
            <a
              class="item"
              href="https://www.shayon.dev/post/2025/164/pitfalls-of-premature-closure-with-llm-assisted-coding/"
              >Pitfalls of premature closure with LLM assisted coding</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-14 @ 16:29:35</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44277284"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44277179">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/p/amds-pre-zen-interconnect-testing"
              >AMD's Pre-Zen Interconnect: Testing Trinity's Northbridge</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-14 @ 16:07:23</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44277179"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44276778">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=6x_NMytSA90"
              >Attempting to Make the Smallest* Electric Motor [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-06-14 @ 14:55:28</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44276778"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
