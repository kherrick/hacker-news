<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39770712">
          <h3>
            <a
              class="item"
              href="https://post.lurk.org/@emenel/112111014479288871"
              >Private GitHub repos may have been used for an AI dataset</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 19:07:03</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39770712"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39770257">
          <h3>
            <a
              class="item"
              href="https://twitter.com/__tinygrad__/status/1770151484363354195"
              >The AMD tinybox is on hold until we can build and run the
              firmware on our GPUs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 18:25:10</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39770257"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39770249">
          <h3>
            <a
              class="item"
              href="https://www.qamcom.com/look-into-qamcoms-research-on-5g/"
              >5GSimWaveform: Open Source Common Waveform Simulator for 5G
              Physical Layer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 18:24:31</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39770249"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39769708">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2024/03/20/openais-chatbot-store-is-filling-up-with-spam/"
              >OpenAI's chatbot store is filling up with spam</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 17:34:58</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39769708"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39769412">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39769412"
              >Launch HN: CamelQA (YC W24) – AI that tests mobile apps</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 17:13:07</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39769412"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
            <div class="text">
              <a href="https://camelqa.com/">https://camelqa.com/</a>). We’re
              building an AI agent that can automate mobile devices using
              computer vision. Our first use case is for mobile app QA. We
              convert natural language test cases into tests that run on real
              iOS and Android devices in our device farm.
              <p>
                Flaky UI tests suck. We want to create a solution where
                engineers don’t waste time maintaining fragile scripts.
              </p>
              <p>
                camelQA uses a combination of accessibility element data along
                with an in-house custom vision-only RCNN object detection model
                paired with Google Siglip for UI element classification (see a
                sample output here -
                <a href="https://camelqa.com/blog/sole-ui-element-detector.png"
                  >https://camelqa.com/blog/sole-ui-element-detector.png</a
                >). This way we’re able to detect elements even if they do not
                have accessibility elements associated with them.
              </p>
              <p>
                Under the hood the agent is using Appium to interface with the
                device. We use GPT-4V to reason at a high level and GPT-3.5 to
                execute the high-level actions. Check out a gif of our
                playground here (<a
                  href="https://camelqa.com/blog/sole-signup.gif"
                  >https://camelqa.com/blog/sole-signup.gif</a
                >)
              </p>
              <p>
                Since we’re vision based, we don’t need access to your source
                code and we work across all app types - SwiftUI and UIKit, React
                Native, Flutter.
              </p>
              <p>
                We built a demo for HN where you can use our model to control
                Wikipedia on a simulated iPhone. Check that out here (<a
                  href="https://demo.camelqa.com/"
                  >https://demo.camelqa.com/</a
                >). Try giving it a task like “Bookmark the wiki page for Ilya
                Sutskever“ or “Find San Francisco in the Places tab”. We only
                have 5 simulators running so there may be a wait. You get 5
                minutes once you enter your first command.
              </p>
              <p>
                If you want to see what our front end looks like, we made an
                account with some test runs. Use this login (Username:
                hackerNews Password: 1337hackerNews!) to view our sandboxed HN
                account (<a href="https://dash.camelqa.com/login"
                  >https://dash.camelqa.com/login</a
                >).
              </p>
              <p>
                Last year we left our corporate jobs to build in the AI space.
                It felt like we were endlessly testing our apps, even for minor
                updates, and we still shipped a bug that caused one of our apps
                to crash on subscribe (the app in question -
                <a
                  href="https://apps.apple.com/us/app/tldr-ai-summarizer/id6449304716"
                  >https://apps.apple.com/us/app/tldr-ai-summarizer/id644930471...</a
                >). That was the catalyst for camelQA.
              </p>
              <p>We’re excited to hear what you all think!</p>
            </div>
          </section>
        </section>
        <section id="39769263">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/fathom/jobs/TArBVR8-senior-site-reliability-engineer-remote"
              >Fathom AI Notetaker (YC W21) Is Hiring a Senior SRE (Remote)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 17:01:18</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39768860">
          <h3>
            <a class="item" href="https://danluu.com/discontinuities/"
              >Suspicious discontinuities (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 16:31:14</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39768860"
                  >Comments</a
                ><span class="descendants">: 89</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39768604">
          <h3>
            <a
              class="item"
              href="https://news.northeastern.edu/2024/03/20/parrots-playing-tablet-games/"
              >Parrots love playing tablet games. That's helping researchers
              understand them</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 16:15:03</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39768604"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39768438">
          <h3>
            <a
              class="item"
              href="https://scholar.googleblog.com/2024/03/supercharge-your-pdf-reading-follow.html"
              >Google Scholar PDF Reader</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 16:03:59</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39768438"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39768434">
          <h3>
            <a
              class="item"
              href="https://www.flightradar24.com/blog/gps-jamming-map/"
              >Flightradar24's new GPS jamming map</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 16:03:21</span
              ><span class="points-container"
                >Points: <span class="points">372</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39768434"
                  >Comments</a
                ><span class="descendants">: 137</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39768361">
          <h3>
            <a
              class="item"
              href="https://twitter.com/kenrickcai/status/1770474370278035775"
              >Multiple Stability AI researchers are departing, CEO says</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 15:58:22</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39768361"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39767533">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-03-powerful-cyclone-remarkable-recovery-pacific.html"
              >In wake of powerful cyclone, remarkable recovery of Pacific
              island's forests</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 14:56:40</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39767533"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39767408">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-03-rare-eleventh-century-astrolabe-discovery.html"
              >Rare eleventh-century astrolabe discovery shows Islamic–Jewish
              sci. exchange</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 14:49:29</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39767408"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39766893">
          <h3>
            <a
              class="item"
              href="https://rive.app/blog/rive-renderer-now-open-source-and-available-on-all-platforms"
              >Rive Renderer for real-time vector graphics is now open source</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 14:16:52</span
              ><span class="points-container"
                >Points: <span class="points">189</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39766893"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39766236">
          <h3>
            <a
              class="item"
              href="https://myme.no/posts/2024-03-19-focus-by-automation.html"
              >Focus by Automation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 13:33:57</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39766236"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39766222">
          <h3>
            <a
              class="item"
              href="https://antithesis.com/blog/deterministic_hypervisor/"
              >So you think you want to write a deterministic hypervisor?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 13:32:41</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39766222"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39766170">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/eight-google-employees-invented-modern-ai-transformers-paper/"
              >The Google employees who created transformers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 13:29:02</span
              ><span class="points-container"
                >Points: <span class="points">246</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39766170"
                  >Comments</a
                ><span class="descendants">: 165</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39765718">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/03/20/us/politics/chips-act-grant-intel.html"
              >Intel to Receive $8.5B in Grants to Build Chip Plants</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 12:51:35</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39765718"
                  >Comments</a
                ><span class="descendants">: 251</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39765715">
          <h3>
            <a class="item" href="https://tavianator.com/2024/btrfs_bug.html"
              >Bug hunting in Btrfs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 12:51:12</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39765715"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39765692">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/03/17/realestate/paris-france-housing-costs.html"
              >Paris preserves its mixed society by pouring billions into public
              housing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 12:48:31</span
              ><span class="points-container"
                >Points: <span class="points">232</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39765692"
                  >Comments</a
                ><span class="descendants">: 438</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39765630">
          <h3>
            <a class="item" href="https://anchor.dev/blog/introducing-lcl-host"
              >Lcl.host: fast, easy HTTPS in your local dev environment</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 12:42:16</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39765630"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39764992">
          <h3>
            <a
              class="item"
              href="https://restofworld.org/2024/homemade-ebike-battery-indonesia/"
              >Indonesia's e-bike shops are building their own batteries</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 11:20:26</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39764992"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39764954">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/michel-talagrand-wins-abel-prize-for-work-wrangling-randomness-20240320/"
              >Michel Talagrand wins Abel Prize for work wrangling randomness</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 11:12:39</span
              ><span class="points-container"
                >Points: <span class="points">187</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39764954"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39764839">
          <h3>
            <a class="item" href="https://github.com/dennis-tra/nebula"
              >Show HN: Nebula – A network agnostic DHT crawler</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 10:54:08</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39764839"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39764287">
          <h3>
            <a class="item" href="https://mtlynch.io/zig-extraneous-build/"
              >Why does an extraneous build step make my Zig app 10x faster?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 09:18:06</span
              ><span class="points-container"
                >Points: <span class="points">190</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39764287"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39763750">
          <h3>
            <a
              class="item"
              href="https://sethmlarson.dev/regex-$-matches-end-of-string-or-newline"
              >Regex character "$" doesn't mean "end-of-string"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 07:50:09</span
              ><span class="points-container"
                >Points: <span class="points">353</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39763750"
                  >Comments</a
                ><span class="descendants">: 287</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39763458">
          <h3>
            <a
              class="item"
              href="https://twitter.com/kenshirriff/status/1770188240777044079"
              >Space Shuttle teleprinter reverse engineering</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-20 @ 06:45:26</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39763458"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39750372">
          <h3>
            <a
              class="item"
              href="https://slate.com/technology/2024/03/concussion-symptoms-signs-treatment-advice.html"
              >We've Been Treating Concussions All Wrong</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-18 @ 21:39:17</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39750372"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39744178">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-03-quantum-energy-electron-tuned-atoms.html"
              >Researchers observe how energy of single electron is tuned by
              surrounding atoms</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-18 @ 13:28:23</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39744178"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39734094">
          <h3>
            <a class="item" href="https://eclipsetracks.org/">Eclipse Tracks</a>
          </h3>
          <section>
            <h4>
              <span>2024-03-17 @ 12:41:48</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39734094"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
