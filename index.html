<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="35880997">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/arts-culture/these-intimate-photos-capture-a-family-farms-bittersweet-final-years-180982139/"
              >The last days of a 350-year-old family farm</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 22:08:13</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35880997"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35880700">
          <h3>
            <a class="item" href="https://www.editanything.ai"
              >Segment anything and Stable Diffusion showcase app</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 21:36:37</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35880700"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35880504">
          <h3>
            <a
              class="item"
              href="https://blog.thunderbird.net/2023/05/thunderbird-is-thriving-our-2022-financial-report/"
              >Thunderbird Is Thriving: Our 2022 Financial Report</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 21:17:48</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35880504"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35880466">
          <h3>
            <a
              class="item"
              href="https://www.techradar.com/news/apple-just-lost-its-lawsuit-trying-to-ban-ios-virtual-machines"
              >Apple just lost its lawsuit trying to ban iOS virtual machines</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 21:14:13</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35880466"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35880376">
          <h3>
            <a class="item" href="https://github.com/kraxarn/spotify-qt"
              >Spotify-Qt</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 21:04:44</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35880376"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35880345">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=35880345"
              >Aptible (YC S14) Is Hiring: Security Engineer and Head of
              Product</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 21:02:06</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
            <div class="text">
              <p>
                <a href="https://www.aptible.com/culture-hub/careers"
                  >https://www.aptible.com/culture-hub/careers</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="35880011">
          <h3>
            <a
              class="item"
              href="https://thewalrus.ca/worlds-oldest-ultramarathon-runner/"
              >The world’s oldest ultramarathon runner is racing against
              death</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 20:32:23</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35880011"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35879678">
          <h3>
            <a
              class="item"
              href="https://frame.work/ca/en/blog/getting-ready-to-ship-13th-gen-and-announcing-power-saving-expansion-cards"
              >Getting ready to ship 13th Gen and announcing power saving
              Expansion Cards</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 20:04:16</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35879678"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35879660">
          <h3>
            <a class="item" href="https://seclists.org/oss-sec/2023/q2/133"
              >Linux kernel use-after-free in Netfilter, local privilege
              escalation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 20:02:15</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35879660"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35879628">
          <h3>
            <a
              class="item"
              href="https://erlangforums.com/t/in-erlang-otp-27-0-0-will-no-longer-be-exactly-equal-to-0-0/2586"
              >In Erlang/OTP 27, +0.0 will no longer be exactly equal to -0.0</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 19:58:51</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35879628"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35879409">
          <h3>
            <a
              class="item"
              href="https://austinhenley.com/blog/teachingpainpoints.html"
              >Pain points of teaching computer science</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 19:40:16</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35879409"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35879278">
          <h3>
            <a class="item" href="https://app.wordbots.io/"
              >Show HN: Card game where players write their own cards that get
              parsed into code</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 19:31:00</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35879278"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
            <div class="text">
              <p>
                It's an online tactical card game (inspired by games like
                Hearthstone and Magic: the Gathering), where players write their
                own cards in natural language, that gets parsed down to
                JavaScript. The English-to-JavaScript translation is handled by
                a semantic parser operating on a hand-crafted CCG grammar – kind
                of an “old-school” approach in this age of LLMs but one that
                performs quite well on the very constrained language of Wordbots
                cards.
              </p>
              <p>
                The resulting game gets pretty wacky as players can create all
                sorts of cards, though there are some game formats that try to
                produce more balanced gameplay as well (e.g. one format in which
                both players shuffle their decks together, and various draft
                formats).
              </p>
              <p>
                If you're curious about how it all works, I made a write-up
                about it here:
                <a href="https://app.wordbots.io/how-it-works"
                  >https://app.wordbots.io/how-it-works</a
                >
              </p>
              <p>
                And if you want to chat about Wordbots beyond this thread,
                please don't hesitate to join our discord at
                <a href="https://discord.wordbots.io/"
                  >https://discord.wordbots.io/</a
                >
                . I'd love to hear any and all feedback.
              </p>
              <p>-Alex</p>
            </div>
          </section>
        </section>
        <section id="35879039">
          <h3>
            <a class="item" href="https://syncthing.net/"
              >Syncthing: A continuous file synchronization program</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 19:12:00</span
              ><span class="points-container"
                >Points: <span class="points">165</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35879039"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35878961">
          <h3>
            <a
              class="item"
              href="https://jack-vanlightly.com/blog/2023/5/9/is-sequential-io-dead-in-the-era-of-the-nvme-drive"
              >Is sequential IO dead in the era of the NVMe drive?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 19:05:48</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35878961"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35878124">
          <h3>
            <a class="item" href="https://www.engineeringbookclub.com/"
              >Show HN: Engineering Book Club</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 18:02:23</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35878124"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
            <div class="text">
              An online community that enjoys reading and discussing engineering
              books together.
            </div>
          </section>
        </section>
        <section id="35877402">
          <h3>
            <a
              class="item"
              href="https://openai.com/research/language-models-can-explain-neurons-in-language-models"
              >Language models can explain neurons in language models</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 17:15:04</span
              ><span class="points-container"
                >Points: <span class="points">403</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35877402"
                  >Comments</a
                ><span class="descendants">: 198</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35877291">
          <h3>
            <a
              class="item"
              href="https://news.nd.edu/news/companies-hide-negative-news-by-issuing-unrelated-press-releases-alongside-sec-filings-study-shows/"
              >Companies hide negative news with unrelated press releases
              alongside SEC filings</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 17:07:06</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35877291"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35876506">
          <h3>
            <a
              class="item"
              href="https://news.tulane.edu/pr/study-finds-elevated-levels-toxic-metals-some-mixed-fruit-juices-and-soft-drinks"
              >Study finds elevated levels of toxic metals in some juices and
              soft drinks</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 16:10:50</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35876506"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35875393">
          <h3>
            <a
              class="item"
              href="https://today.ucsd.edu/story/t-cells-can-activate-themselves-to-fight-tumors"
              >T cells can activate themselves to fight tumors</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 15:02:58</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35875393"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35874704">
          <h3>
            <a
              class="item"
              href="https://skyandtelescope.org/astronomy-news/the-james-webb-space-telescope-reveals-fomalhauts-disk-in-unprecedented-detail/"
              >James Webb Space Telescope reveals Fomalhaut's disk in detail</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 14:19:14</span
              ><span class="points-container"
                >Points: <span class="points">281</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35874704"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35874670">
          <h3>
            <a
              class="item"
              href="https://www.apa.org/topics/social-media-internet/health-advisory-adolescent-social-media-use"
              >Health advisory on social media use in adolescence</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 14:17:03</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35874670"
                  >Comments</a
                ><span class="descendants">: 111</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35874575">
          <h3>
            <a
              class="item"
              href="https://buttondown.email/hillelwayne/archive/the-seven-specification-ur-languages/"
              >The seven specification ur-languages</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 14:11:11</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35874575"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35873732">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/newsroom/2023/05/apple-brings-final-cut-pro-and-logic-pro-to-ipad/"
              >Apple brings Final Cut Pro and Logic Pro to iPad</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 13:04:06</span
              ><span class="points-container"
                >Points: <span class="points">595</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35873732"
                  >Comments</a
                ><span class="descendants">: 495</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35873714">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2305.04760"
              >Cheshire: A Lightweight, Linux-Capable RISC-V Host Platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 13:02:49</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35873714"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35873552">
          <h3>
            <a
              class="item"
              href="https://leaningtech.com/announcing-cheerpj-3-0-a-jvm-replacement-in-html5-and-webassembly-to-run-java-applications-and-applets-on-modern-browsers/"
              >CheerpJ 3.0: a JVM replacement in HTML5 and WASM to run Java on
              modern browsers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 12:48:13</span
              ><span class="points-container"
                >Points: <span class="points">259</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35873552"
                  >Comments</a
                ><span class="descendants">: 124</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35872758">
          <h3>
            <a class="item" href="https://lock.cmpxchg8b.com/lotus123.html"
              >Lotus 1-2-3</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 11:35:44</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35872758"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35872647">
          <h3>
            <a
              class="item"
              href="https://www.permaculturedesignmagazine.com/what-is-permaculture"
              >What is permaculture? (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 11:23:13</span
              ><span class="points-container"
                >Points: <span class="points">165</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35872647"
                  >Comments</a
                ><span class="descendants">: 123</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35867939">
          <h3>
            <a
              class="item"
              href="https://www.thechatner.com/p/its-1178-bce-and-the-bronze-age-has"
              >The Bronze Age has never looked stronger</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 22:45:32</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35867939"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35866570">
          <h3>
            <a
              class="item"
              href="https://haywirez.com/strange-devirtualization-of-techno/"
              >The Strange Devirtualization of Techno</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 20:22:28</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35866570"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35860892">
          <h3>
            <a
              class="item"
              href="https://www.nybooks.com/articles/2023/05/25/the-inventor-of-magical-realism-mr-president-asturias/"
              >The Inventor of Magical Realism</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 12:39:38</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35860892"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
