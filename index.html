<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="45521704">
          <h3>
            <a class="item" href="https://pwascore.com/">Show HN: PWAscore</a>
          </h3>
          <section>
            <h4>
              <span>2025-10-08 @ 23:14:32</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45521704"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45521484">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2025-10-08/the-circular-openai-nvidia-and-amd-deals-raising-fears-of-a-new-tech-bubble"
              >Why Circular AI Deals Among OpenAI, Nvidia, AMD Are Raising
              Eyebrows</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-08 @ 22:47:57</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45521484"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45519944">
          <h3>
            <a
              class="item"
              href="https://blog.google/technology/google-labs/opal-expansion/"
              >Expanding access to Opal, our no-code AI mini-app builder</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-08 @ 19:56:54</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45519944"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45519575">
          <h3>
            <a
              class="item"
              href="https://www.hagerty.com/media/advice/a-few-things-to-know-before-you-steal-my-914/"
              >A few things to know before stealing my 914 (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-08 @ 19:16:10</span
              ><span class="points-container"
                >Points: <span class="points">172</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45519575"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45519263">
          <h3>
            <a
              class="item"
              href="https://julialang.org/blog/2025/10/julia-1.12-highlights/"
              >Julia 1.12 highlights</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-08 @ 18:42:22</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45519263"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45518861">
          <h3>
            <a class="item" href="https://github.com/built-by-as/FleetCode"
              >Show HN: FleetCode – Open-source UI for running multiple coding
              agents</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-08 @ 18:00:34</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45518861"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
            <div class="text">
              <p>
                After having to do a ton of git stashing and branch fumbling, I
                decided I needed to something to more ergonomically run these
                agents in their own dedicated spaces.
              </p>
              <p>
                I tried a lot of the existing products but they either were too
                convoluted or flat out didn't work. Some of them also seem to
                roll their own chat UI which I don't think is the right
                approach, I wanted to something to lightly wrap my terminal
                sessions.
              </p>
              <p>
                So I built FleetCode! It uses git worktrees and let's you run
                multiple agents at once. It's made my multi agent coding
                workflow much easier.
              </p>
              <p>It's free and open source, would love some feedback!</p>
            </div>
          </section>
        </section>
        <section id="45518813">
          <h3>
            <a class="item" href="https://www.winboat.app/"
              >WinBoat: Windows apps on Linux with seamless integration</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-08 @ 17:56:32</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45518813"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45517674">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Ortega_hypothesis"
              >Ortega hypothesis</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-08 @ 16:06:21</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45517674"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45517134">
          <h3>
            <a
              class="item"
              href="https://lighthouseapp.io/blog/feed-reader-deep-dive"
              >The RSS feed reader landscape</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-08 @ 15:17:36</span
              ><span class="points-container"
                >Points: <span class="points">163</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45517134"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45516968">
          <h3>
            <a
              class="item"
              href="https://www.readonlymemo.com/mame-hyper-neo-geo-support-sound-emulation/"
              >After 2 decades of tinkering, MAME cracks the Hyper Neo Geo 64</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-08 @ 15:01:38</span
              ><span class="points-container"
                >Points: <span class="points">271</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45516968"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45516690">
          <h3>
            <a class="item" href="https://vectrex.com/vectrex-mini-details/"
              >Vectrex Mini</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-08 @ 14:38:23</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45516690"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45516584">
          <h3>
            <a
              class="item"
              href="https://www.npmjs.com/package/@joseairosa/recall"
              >Show HN: Recall: Give Claude memory with Redis-backed persistent
              context</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-08 @ 14:28:06</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45516584"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
            <div class="text">
              <p>
                The Problem: I use Claude for coding daily, but every
                conversation starts from scratch. I'd explain my architecture,
                coding standards, past decisions... then hit the context limit
                and lose everything. Next session? Start over.
              </p>
              <p>
                The Solution: Recall is an MCP (Model Context Protocol) server
                that gives Claude persistent memory using Redis + semantic
                search. Think of it as long-term memory that survives context
                limits and session restarts.
              </p>
              <p>
                How it works: - Claude stores important context as "memories"
                during conversations - Memories are embedded (OpenAI) and stored
                in Redis with metadata - Semantic search retrieves relevant
                memories automatically - Works across sessions, projects, even
                machines (if you use cloud Redis)
              </p>
              <p>
                Key Features: - Global memories: Share context across all
                projects - Relationships: Link related memories into knowledge
                graphs - Versioning: Track how memories evolve over time -
                Templates: Reusable patterns for common workflows - Workspace
                isolation: Project A memories don't pollute Project B
              </p>
              <p>
                Tech Stack: - TypeScript + MCP SDK - Redis for storage - OpenAI
                embeddings (text-embedding-3-small) - ~189KB bundle, runs
                locally
              </p>
              <p>
                Current Stats: - 27 tools exposed to Claude - 10 context types
                (directives, decisions, patterns, etc.) - Sub-second semantic
                search on 10k+ memories - Works with Claude Desktop, Claude
                Code, any MCP client
              </p>
              <p>
                Example Use Case: I'm building an e-commerce platform. I told
                Claude once: "We use Tailwind, prefer composition API, API rate
                limit is 1000/min." Now every conversation, Claude remembers and
                applies these preferences automatically.
              </p>
              <p>
                What's Next (v1.6.0 in progress): - CI/CD pipeline with GitHub
                Actions - Docker support for easy deployment - Proper test suite
                with Vitest - Better error messages and logging
              </p>
              <p>Try it:</p>
              <p>
                npm install -g @joseairosa/recall # Add to
                claude_desktop_config.json # Start using persistent memory
              </p>
            </div>
          </section>
        </section>
        <section id="45516426">
          <h3>
            <a
              class="item"
              href="https://blog.google/technology/developers/gemini-cli-extensions/"
              >Now open for building: Introducing Gemini CLI extensions</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-08 @ 14:13:30</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45516426"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45516000">
          <h3>
            <a
              class="item"
              href="https://blog.cloudflare.com/how-we-found-a-bug-in-gos-arm64-compiler/"
              >We found a bug in Go's ARM64 compiler</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-08 @ 13:33:15</span
              ><span class="points-container"
                >Points: <span class="points">485</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45516000"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45515657">
          <h3>
            <a
              class="item"
              href="https://it-notes.dragas.net/2025/10/08/the-email-they-shouldnt-have-read/"
              >The email they shouldn't have read</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-08 @ 12:56:54</span
              ><span class="points-container"
                >Points: <span class="points">347</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45515657"
                  >Comments</a
                ><span class="descendants">: 145</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45514433">
          <h3>
            <a
              class="item"
              href="https://www.politico.eu/article/one-man-spam-campaign-ravages-eu-chat-control-bill-fight-chat-control/"
              >One-man campaign ravages EU 'Chat Control' bill</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-08 @ 10:26:05</span
              ><span class="points-container"
                >Points: <span class="points">389</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45514433"
                  >Comments</a
                ><span class="descendants">: 147</span></span
              >
            </h4>
            <div class="text">
              <a href="https://fightchatcontrol.eu/"
                >https://fightchatcontrol.eu/</a
              >
            </div>
          </section>
        </section>
        <section id="45514164">
          <h3>
            <a
              class="item"
              href="https://www.nobelprize.org/prizes/chemistry/2025/popular-information/"
              >Nobel Prize in Chemistry 2025</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-08 @ 09:49:36</span
              ><span class="points-container"
                >Points: <span class="points">295</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45514164"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45513485">
          <h3>
            <a
              class="item"
              href="https://www.guru3d.com/story/synology-reverses-policy-banning-thirdparty-hdds-after-nas-sales-plummet/"
              >Synology reverses policy banning third-party HDDs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-08 @ 08:19:36</span
              ><span class="points-container"
                >Points: <span class="points">981</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45513485"
                  >Comments</a
                ><span class="descendants">: 628</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45492977">
          <h3>
            <a
              class="item"
              href="https://stratechery.com/2025/sora-ai-bicycles-and-meta-disruption/"
              >Sora, AI Bicycles, and Meta Disruption</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 16:17:15</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45492977"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45490538">
          <h3>
            <a
              class="item"
              href="https://lyonhe.art/the-fourth-quadrant-of-knowledge/"
              >The Fourth Quadrant of Knowledge</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 12:16:13</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45490538"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45490202">
          <h3>
            <a
              class="item"
              href="https://www.tomorrowstechnician.com/tpms-sensor-ids-why-where-and-when/"
              >Tire Pressure Sensor IDs: Why, Where and When (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 11:28:35</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45490202"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45489317">
          <h3>
            <a class="item" href="https://kau.sh/blog/usbi/"
              >A macOS terminal command that tells you if your USB-C cable is
              bad</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 09:06:28</span
              ><span class="points-container"
                >Points: <span class="points">261</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45489317"
                  >Comments</a
                ><span class="descendants">: 150</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45487310">
          <h3>
            <a
              class="item"
              href="https://parallelprogrammer.substack.com/p/why-we-need-simd-the-real-reason"
              >Why we need SIMD</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 03:10:13</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45487310"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45484999">
          <h3>
            <a
              class="item"
              href="https://vitalik.eth.limo/general/2025/10/05/memory13.html"
              >Memory access is O(N^[1/3])</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-05 @ 20:34:28</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45484999"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45484123">
          <h3>
            <a class="item" href="https://www.aerolane.com/"
              >Aerocart cargo gliders</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-05 @ 18:49:31</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45484123"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45481417">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2025/09/17/meta-launches-hyperscape-technology-to-turn-real-world-spaces-into-vr/"
              >Meta launches Hyperscape, technology to turn real-world spaces
              into VR</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-05 @ 13:42:03</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45481417"
                  >Comments</a
                ><span class="descendants">: 130</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45477983">
          <h3>
            <a
              class="item"
              href="https://blog.tymscar.com/posts/intellijollamaconnectionmystery/"
              >When Curl Works but IntelliJ Doesn't: The Ollama Connection
              Mystery</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-05 @ 00:39:26</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45477983"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45475556">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/news/784966/lumafield-x-ray-ct-scan-lithium-ion-battery-risks-manufacturing-defect"
              >X-ray scans reveal the hidden risks of cheap batteries</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-04 @ 18:37:31</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45475556"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45474301">
          <h3>
            <a
              class="item"
              href="https://www.cbsnews.com/texas/news/sec-approves-texas-stock-exchange-txse/"
              >SEC approves Texas Stock Exchange, first new US integrated
              exchange in decades</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-04 @ 16:04:24</span
              ><span class="points-container"
                >Points: <span class="points">501</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45474301"
                  >Comments</a
                ><span class="descendants">: 334</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45472119">
          <h3>
            <a class="item" href="https://github.com/irony/aspipes"
              >Working pipe operator today in pure JavaScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-04 @ 09:54:01</span
              ><span class="points-container"
                >Points: <span class="points">247</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45472119"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
