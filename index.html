<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36147285">
          <h3>
            <a
              class="item"
              href="https://utcc.utoronto.ca/~cks/space/blog/tech/DNSSECFailureDrivesDisablement"
              >DNSSEC failures are how you get people to disable DNSSEC</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-01 @ 03:29:13</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36147285"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36147196">
          <h3>
            <a
              class="item"
              href="https://www.axios.com/2023/05/31/ftc-ring-employees-illegally-accessed-user-private-videos"
              >Amazon to pay over $30M for Ring and Alexa privacy violations</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-01 @ 03:11:37</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36147196"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36146905">
          <h3>
            <a
              class="item"
              href="https://www.npr.org/2023/05/31/1179098682/john-coltrane-eric-dolphy-village-gate-1961-lost-album"
              >Lost John Coltrane recording, from experimental phase with Eric
              Dolphy, emerges</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-01 @ 02:18:09</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36146905"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36146877">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36146877"
              >Tell HN: The dragon compiler book (2nd edition) is a great
              book</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-01 @ 02:14:23</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36146877"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
            <div class="text">
              <p>
                I have seen a lot of people on the internet say that the dragon
                book is horrible book to learn compilers from.
              </p>
              <p>
                well, I have read some of the second edition of the dragon book
                and I think it is a great book. The main criticism is that its
                too focused on parsing. Thats just like 5 chapters. I skipped
                these and went straight into the intermediate language, code
                generation, and optimizing chapters.
              </p>
              <p>
                These chapters give a detailed account of things such as
                register allocation, instruction selection, and instruction
                scheduling. The optimizing chapters are also good.
              </p>
              <p>
                im not claiming im an expert compiler person. I am not but
                compilers is something i want to learn and so i gave the dragon
                book a try and i really liked it.
              </p>
              <p>
                more importantly the dragon book made me realize that compilers
                are mathematical systems in a way. the ast is tree and trees
                have mathematical properties but graphs are needed for register
                allocation, dataflow analysis for optimization. optimization is
                math problem.
              </p>
              <p>
                So i think this book gave me a better understanding of the field
                and it made appreciate compilers.
              </p>
              <p>
                i'd say if youre interested in compilers you can start with
                "essence of compilation" by dr. siek and get some experience
                writing compilers and then read the dragon book.
              </p>
              <p>
                i just wanted to share my experience. i think the dragon book is
                a great book.
              </p>
            </div>
          </section>
        </section>
        <section id="36146627">
          <h3>
            <a
              class="item"
              href="https://www.faa.gov/newsroom/faa-seeks-public-input-drone-operations"
              >FAA seeks public input on drone operations</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-01 @ 01:24:44</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36146627"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36146278">
          <h3>
            <a
              class="item"
              href="https://palant.info/2023/05/31/more-malicious-extensions-in-chrome-web-store/"
              >More malicious extensions in Chrome Web Store</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-01 @ 00:26:45</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36146278"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36145823">
          <h3>
            <a
              class="item"
              href="https://thebulletin.org/2023/05/qa-how-darpa-hacked-a-science-writers-brain-and-turned-her-into-a-sharpshooter/"
              >DARPA hacked a science writer’s brain and turned her into a
              sharpshooter</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 23:23:19</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36145823"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36145007">
          <h3>
            <a class="item" href="http://www.projectmf.org/"
              >Project MF: A simulation of analog SF/MF telephone signaling</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 22:05:03</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36145007"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36144674">
          <h3>
            <a class="item" href="https://github.com/OAI/moonwalk"
              >OpenAPI v4 (aka Moonwalk) Proposal</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 21:38:04</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36144674"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36144241">
          <h3>
            <a
              class="item"
              href="https://technomancers.ai/japan-goes-all-in-copyright-doesnt-apply-to-ai-training/"
              >Japan Goes All In: Copyright Doesn’t Apply to AI Training</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 20:58:13</span
              ><span class="points-container"
                >Points: <span class="points">310</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36144241"
                  >Comments</a
                ><span class="descendants">: 228</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36144211">
          <h3>
            <a class="item" href="https://codeberg.org/teddit/teddit"
              >Teddit – An alternative Reddit front-end focused on privacy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 20:55:26</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36144211"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36144033">
          <h3>
            <a
              class="item"
              href="https://www.instructables.com/DIY-Pure-Sine-Wave-Inverter/"
              >1000W 12V –&amp;gt; 220V Inverter</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 20:40:13</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36144033"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36141544">
          <h3>
            <a class="item" href="https://humanloop.com/blog/open_ai_talk"
              >OpenAI's plans according to sama</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 18:05:03</span
              ><span class="points-container"
                >Points: <span class="points">240</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36141544"
                  >Comments</a
                ><span class="descendants">: 182</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36141170">
          <h3>
            <a class="item" href="https://pgp.governikus.de/?lang=EN"
              >You can link an OpenPGP key to a German eID</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 17:40:44</span
              ><span class="points-container"
                >Points: <span class="points">174</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36141170"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36141083">
          <h3>
            <a
              class="item"
              href="https://old.reddit.com/r/apolloapp/comments/13ws4w3/had_a_call_with_reddit_to_discuss_pricing_bad/"
              >Had a call with Reddit to discuss pricing</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 17:30:39</span
              ><span class="points-container"
                >Points: <span class="points">1444</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36141083"
                  >Comments</a
                ><span class="descendants">: 977</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36140916">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36140916"
              >Launch HN: Onu (YC W23) – Turn scripts into internal tools in
              minutes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 17:19:40</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36140916"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
            <div class="text">
              <a href="https://joinonu.com">https://joinonu.com</a>). Onu lets
              you write scripts and turn them into internal tools suitable for
              use by non-technical teammates. We built Onu to help you spend
              more time coding and less time running scripts for ops or customer
              support. Unlike no-code/low-code products, we’re code-first and
              let you use your preferred tools. We take care of the annoying
              parts for you: most importantly the frontend, but also auditing,
              permissions, and 3rd party integrations (e.g. Slack, email, Jira,
              Pagerduty).
              <p>
                We’ve put up a few sample screenshots at
                <a href="https://joinonu.com/examples"
                  >https://joinonu.com/examples</a
                >, and a demo video here:
                <a href="https://www.youtube.com/watch?v=4XMnBRsktsw"
                  >https://www.youtube.com/watch?v=4XMnBRsktsw</a
                >.
              </p>
              <p>
                Many engineers lose hours a week fielding requests from other
                teams. While most companies have a home-grown internal dashboard
                (or are using a third party tool builder for this such as
                Retool), there is still a long tail of scripts that engineers
                have to run regularly for their ops and CX teammates, either
                locally or by SSHing into prod. Maybe a user’s account got stuck
                in a weird state, or you have a script to manually onboard new
                customers to your B2B product, or you have to run a custom
                provisioning script each time you add a bike to your e-bike
                fleet (something we experienced at Lyft).
              </p>
              <p>
                We experienced these problems while working on engineering teams
                at Lyft and Stripe. Our teams needed internal tooling, but we
                didn’t have time to build feature-rich dashboards. Stripe had a
                homegrown tool that allowed engineers to quickly spin up simple
                internal tools without writing any frontend code. When we
                started working on Onu with a different idea we immediately felt
                the pain of not having a similar tool. We pivoted to working on
                our current product instead because we already knew how powerful
                it can be for speeding up engineering teams.
              </p>
              <p>
                Internal tool builders mostly take a no code/low code approach
                that requires engineers to duplicate a lot of business logic in
                the browser. This leads to brittle internal apps that are hard
                to keep in sync with the business logic in your codebase, and
                difficult to maintain as you scale. In addition, such tools
                subject you to point-and-click / drag-and-drop workflows that
                just aren’t the sweet spot for programmers. We don’t like
                working that way ourselves, so we focus on a code-first
                approach, allowing you to hand scripts to non-technical
                teammates to own and run without engineering oversight.
              </p>
              <p>
                Onu works with your existing dev workflow. You write scripts in
                your editor of choice—not the browser—and deploy tasks the same
                way you deploy any other code. We can host your scripts if you
                prefer, but you can also add Onu to your existing Express server
                and our frontend will handle routing requests to the correct
                script. We currently have a Node SDK and are rolling out Python
                next.
              </p>
              <p>
                You can try Onu now by heading to
                <a href="https://auth.joinonu.com/signup"
                  >https://auth.joinonu.com/signup</a
                >
                and signing up for an account. It’s free for personal use cases
                and for teams of up to 5 people.
              </p>
              <p>We’re looking forward to your thoughts and feedback!</p>
            </div>
          </section>
        </section>
        <section id="36140639">
          <h3>
            <a
              class="item"
              href="https://provision-software.notion.site/Provision-is-Hiring-8b53cc10bbd04af39bf3d3c7ab181cac"
              >Provision (YC S22) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 17:00:04</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36140177">
          <h3>
            <a
              class="item"
              href="https://linuxfoundation.eu/newsroom/rise-project-launches-to-accelerate-development-of-risc-v"
              >RISE: Accelerate the development of open source software for
              RISC-V</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 16:22:48</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36140177"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36138642">
          <h3>
            <a
              class="item"
              href="https://neon.tech/blog/when-limit-9-works-but-limit-10-hangs"
              >When LIMIT 9 works but LIMIT 10 hangs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 14:11:49</span
              ><span class="points-container"
                >Points: <span class="points">216</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36138642"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36138304">
          <h3>
            <a class="item" href="https://cs.uwaterloo.ca/~csk/slide/"
              >Slide to Unlock</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 13:41:55</span
              ><span class="points-container"
                >Points: <span class="points">844</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36138304"
                  >Comments</a
                ><span class="descendants">: 143</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36137535">
          <h3>
            <a
              class="item"
              href="https://sneller.io/blog/decompressing-at-over-10-gigabytes-per-second/"
              >Iguana: fast SIMD-optimized decompression</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 12:28:46</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36137535"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36136819">
          <h3>
            <a
              class="item"
              href="https://web.archive.org/web/20230531105653/https://rarbg.to/index80.php"
              >Rarbg Is No More</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 10:56:14</span
              ><span class="points-container"
                >Points: <span class="points">1146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36136819"
                  >Comments</a
                ><span class="descendants">: 554</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36136639">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Peelian_principles"
              >Peelian Principles</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 10:22:16</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36136639"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36136179">
          <h3>
            <a
              class="item"
              href="https://www.reproof.app/blog/notes-apps-help-us-forget"
              >Notes apps are where ideas go to die (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 09:11:37</span
              ><span class="points-container"
                >Points: <span class="points">315</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36136179"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36134423">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2018/11/03/obituaries/hardy-fox-dead.html"
              >Hardy Fox, of the avant-garde band The Residents (maybe)
              (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 04:21:55</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36134423"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36130194">
          <h3>
            <a
              class="item"
              href="https://borretti.me/article/language-pragmatics"
              >Language Pragmatics Engineering</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 20:22:11</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36130194"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36128617">
          <h3>
            <a class="item" href="https://kuenzi.dev/toothbrush/"
              >Hacking my “smart” toothbrush</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 18:30:31</span
              ><span class="points-container"
                >Points: <span class="points">707</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36128617"
                  >Comments</a
                ><span class="descendants">: 272</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36128321">
          <h3>
            <a
              class="item"
              href="https://www.leadedsolder.com/2023/05/30/apple-bandai-pippin-pickup-fan-repair.html"
              >Pippin in My Orchard</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 18:10:02</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36128321"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36127198">
          <h3>
            <a
              class="item"
              href="https://boingboing.net/2023/05/30/the-mystery-person-who-spies-on-theme-parks-from-the-sky.html"
              >A mystery person who spies on theme parks from the sky</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 16:51:42</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36127198"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36121556">
          <h3>
            <a
              class="item"
              href="https://www.firstthings.com/article/2023/06/kafkas-trials"
              >The Diaries of Franz Kafka</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 05:57:27</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36121556"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
