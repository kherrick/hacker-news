<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37335492">
          <h3>
            <a class="item" href="https://www.yourmusictastesucks.com/?ref=hn"
              >Show HN: AI Judges Your Spotify</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-31 @ 11:24:49</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37335492"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37335404">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2023/8/31/23853517/microsoft-teams-unbundling-europe"
              >Microsoft is unbundling Teams from Office in Europe to address
              regulator concern</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-31 @ 11:12:45</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37335404"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37334750">
          <h3>
            <a
              class="item"
              href="https://thebulletin.org/2023/08/managed-to-death-how-canada-turned-its-forests-into-a-carbon-bomb/#post-heading"
              >Managed to death: How Canada turned its forests into a carbon
              bomb</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-31 @ 09:58:48</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37334750"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37334695">
          <h3>
            <a class="item" href="https://atlantic.money/gb/en/business"
              >Show HN: 99% cheaper international business transfers – fixed
              fee, real rate</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-31 @ 09:51:21</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37334695"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
            <div class="text">
              Hello Hackers! One year ago we changed international transfers for
              consumers with only a fixed fee and made them on average 10x
              cheaper than Wise. Now we are thrilled to announce that we start
              “Atlantic Money for Business” to offer transfers up to £/€1m for a
              fixed £/€3 fee and at the current exchange rate. And while Revolut
              and Wise have recently raised their prices for business transfers
              by up to 50%, we enable savings of several thousand on every
              transfer. What are you waiting for?
            </div>
          </section>
        </section>
        <section id="37334486">
          <h3>
            <a
              class="item"
              href="https://github.com/opentffoundation/roadmap/issues/24"
              >HashiCorp silently amend Terraform Registry TOS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-31 @ 09:19:45</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37334486"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37333882">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2023/08/31/microsoft-to-unbundle-teams-software-in-europe-in-bid-to-abate-eu-concerns.html"
              >Microsoft to unbundle Teams software in Europe to abate EU
              antitrust concerns</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-31 @ 07:59:07</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37333882"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37333848">
          <h3><a class="item" href="https://xkcd.com/2822/">*@gmail.com</a></h3>
          <section>
            <h4>
              <span>2023-08-31 @ 07:54:08</span
              ><span class="points-container"
                >Points: <span class="points">154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37333848"
                  >Comments</a
                ><span class="descendants">: 125</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37333596">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=37333596"
              >Tell HN: UC Berkeley's CS61A/B/C are the best courses to learn CS
              and coding</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-31 @ 07:18:26</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37333596"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
            <div class="text">
              <p>
                The books and blogs at least taught me basic syntax constructs
                like variables, function definition, loops, etc. But I couldn't
                understand how to package them up (compose) to use them in
                solving problems.
              </p>
              <p>
                Then I started studying through Berkeley's 3 course intro CS61A,
                CS61B, CS61C. They have all materials in the open and if you are
                following the most current iteration of the course, they even
                post solutions to the problems. It was godsend for me.
              </p>
              <p>
                Now, I am confident to learn more CS topics using courses from
                CMU, MIT, Berkeley, Stanford, etc. The thing that was holding me
                back was the lack of confidence of programming and understanding
                really what a program was doing.
              </p>
            </div>
          </section>
        </section>
        <section id="37333404">
          <h3>
            <a class="item" href="https://github.com/utmapp/UTM"
              >UTM – Virtual Machines for iOS and macOS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-31 @ 06:53:43</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37333404"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37333195">
          <h3>
            <a class="item" href="https://github.com/obra/Youtube2Webpage"
              >Youtube2Webpage: Create Websites with Text from Videos</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-31 @ 06:23:21</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37333195"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37333077">
          <h3>
            <a class="item" href="https://macspot.net/"
              >Cheetah: A Lightweight Virtual Machine Manager for macOS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-31 @ 06:07:06</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37333077"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37332493">
          <h3>
            <a class="item" href="https://ryujinx.org/"
              >RyujinX – Open Source Nintendo Switch Emulator</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-31 @ 04:33:40</span
              ><span class="points-container"
                >Points: <span class="points">292</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37332493"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37332126">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=37332126"
              >Ask HN: How to handle Asian-style “Family name first” when
              designing interfaces?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-31 @ 03:30:01</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37332126"
                  >Comments</a
                ><span class="descendants">: 284</span></span
              >
            </h4>
            <div class="text">
              <p>
                We have members who follow western naming conventions as well as
                members following common asian naming conventions.
              </p>
              <p>
                Turns out there can be alot of variation on what is the
                convention.
              </p>
              <p>
                <a
                  href="https://www.asiamediacentre.org.nz/features/a-guide-to-using-asian-names"
                  >https://www.asiamediacentre.org.nz/features/a-guide-to-using...</a
                >
              </p>
              <p>
                How would you handle different naming conventions, so users see
                their name in the order they would like?
              </p>
              <p>Family, Given</p>
              <p>Given, Family</p>
            </div>
          </section>
        </section>
        <section id="37331778">
          <h3>
            <a
              class="item"
              href="https://www.marginalia.nu/log/87_absurd_success/"
              >Absurd Success</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-31 @ 02:27:26</span
              ><span class="points-container"
                >Points: <span class="points">376</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37331778"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37330318">
          <h3>
            <a
              class="item"
              href="https://about.sourcegraph.com/blog/security-update-august-2023"
              >Sourcegraph: Incident involving unauthorized admin access</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-30 @ 23:09:34</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37330318"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37329067">
          <h3>
            <a class="item" href="https://www.mux.com/jobs?j=srplatform"
              >Mux (YC W16) is hiring a Sr Platform Engineer to work on video
              infra at scale</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-30 @ 21:01:00</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37326870">
          <h3>
            <a class="item" href="https://github.com/eschluntz/compress"
              >Show HN: I automated half of my typing</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-30 @ 18:40:52</span
              ><span class="points-container"
                >Points: <span class="points">657</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37326870"
                  >Comments</a
                ><span class="descendants">: 249</span></span
              >
            </h4>
            <div class="text">
              I've been using this for about a year now - I parsed 6 months of
              my messages on slack and found the most common phrases I use and
              generated keyboard shortcuts for them.
            </div>
          </section>
        </section>
        <section id="37325622">
          <h3>
            <a
              class="item"
              href="https://leifgehrmann.com/2021/09/05/photogrammetry-on-a-plane/"
              >Photogrammetry on commercial flights (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-30 @ 17:25:55</span
              ><span class="points-container"
                >Points: <span class="points">212</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37325622"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37324518">
          <h3>
            <a
              class="item"
              href="https://ottertune.com/blog/query-best-practices-when-should-you-use-the-in-instead-of-the-or-operator"
              >When should you use the IN instead of the OR operator in
              Postgres?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-30 @ 16:29:27</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37324518"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37323834">
          <h3>
            <a
              class="item"
              href="https://www.news.uzh.ch/en/articles/media/2023/Drone-race.html"
              >High-Speed AI Drone Overtakes World-Champion Drone Racers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-30 @ 15:40:06</span
              ><span class="points-container"
                >Points: <span class="points">257</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37323834"
                  >Comments</a
                ><span class="descendants">: 155</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37323604">
          <h3>
            <a
              class="item"
              href="https://gist.github.com/kj800x/be3001c07c49fdb36970633b0bc6defb"
              >Hacking the LG Monitor's EDID</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-30 @ 15:24:08</span
              ><span class="points-container"
                >Points: <span class="points">291</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37323604"
                  >Comments</a
                ><span class="descendants">: 122</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37321028">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-023-02648-9"
              >A DIY ‘bionic pancreas’ is changing diabetes care</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-30 @ 12:32:05</span
              ><span class="points-container"
                >Points: <span class="points">440</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37321028"
                  >Comments</a
                ><span class="descendants">: 157</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37320071">
          <h3>
            <a
              class="item"
              href="https://www.slowboring.com/p/a-serious-case-for-dynamic-scoring"
              >A case for dynamic scoring of high-skilled immigration</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-30 @ 10:51:00</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37320071"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37316280">
          <h3>
            <a
              class="item"
              href="https://citeseerx.ist.psu.edu/document?repid=rep1&amp;type=pdf&amp;doi=108b3a24274af0aab079bd94ab7c1ee6543563d4"
              >The Tera Computer System (1990)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-30 @ 00:56:25</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37316280"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37308469">
          <h3>
            <a
              class="item"
              href="https://www.evanjones.ca/random-load-balancing-is-uneven.html"
              >Random Load Balancing Is Unevenly Distributed</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 14:28:34</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37308469"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37306431">
          <h3>
            <a
              class="item"
              href="https://hyperallergic.com/830328/three-antiquities-traffickers-and-their-fall-from-grace/"
              >Three Antiquities Traffickers and Their Fall from Grace</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 11:59:59</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37306431"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37306401">
          <h3>
            <a
              class="item"
              href="https://anarchonomicon.substack.com/p/review-blackberry"
              >Film Review: BlackBerry</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 11:57:43</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37306401"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37306376">
          <h3>
            <a class="item" href="https://www.df7cb.de/projects/sdate/"
              >Never Ending September Date</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 11:54:58</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37306376"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37304666">
          <h3>
            <a class="item" href="https://www.makingmolecules.com/handouts"
              >Gallery – Making Molecules</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 07:59:26</span
              ><span class="points-container"
                >Points: <span class="points">241</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37304666"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37303722">
          <h3>
            <a
              class="item"
              href="https://www.stohrermusic.com/2017/10/the-open-source-saxophone-project/"
              >The open source saxophone project</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 05:04:19</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37303722"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
