<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41466963">
          <h3>
            <a
              class="item"
              href="https://mailman.nginx.org/pipermail/nginx-announce/2024/ITL3AOQSAJANFJXMM3VOVOIGOUADWFFK.html"
              >Nginx Has Moved to GitHub</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-06 @ 15:17:02</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41466963"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41466853">
          <h3>
            <a
              class="item"
              href="https://evmarketsreports.com/europe-surpasses-900-000-public-ev-charge-points/"
              >Europe Surpasses 900,000 Public EV Charge Points</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-06 @ 15:03:34</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41466853"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41466724">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/wellness/2024/09/05/parkinsons-disease-gut-study/"
              >Parkinson's may begin in the gut, study says, adding to growing
              evidence</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-06 @ 14:48:00</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41466724"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41466702">
          <h3>
            <a
              class="item"
              href="https://twitter.com/GarrisonLovely/status/1831104024612896795"
              >The fight between Prospero and Honduras</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-06 @ 14:44:35</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41466702"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41466667">
          <h3>
            <a
              class="item"
              href="https://lwn.net/ml/all/4d7tq6a7febsoru3wjium4ekttuw2ouocv6jstdkthnacmzr6x@f2zfbe5hs7h5/"
              >Linux man-pages project maintenance</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-06 @ 14:41:19</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41466667"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41465870">
          <h3>
            <a class="item" href="https://github.com/taviso/nntpit"
              >Nntpit: Minimalist Reddit2nntp Gateway</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-06 @ 13:12:08</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41465870"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41465735">
          <h3>
            <a class="item" href="https://wealthfolio.app"
              >Show HN: Wealthfolio: A Private, Open-Source Investment
              Tracker</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-06 @ 12:56:15</span
              ><span class="points-container"
                >Points: <span class="points">205</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41465735"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41465357">
          <h3>
            <a
              class="item"
              href="https://jobs.ashbyhq.com/permitflow?departmentId=d33195eb-8978-4439-abc6-5a8a072de808"
              >PermitFlow (YC W22) Is Hiring Senior/Staff+ Engineers and
              Designers in NYC</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-06 @ 12:00:25</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41464705">
          <h3>
            <a class="item" href="https://github.com/SAMA-Communications"
              >SAMA – open-source Chat server</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-06 @ 10:20:10</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41464705"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41464585">
          <h3>
            <a class="item" href="https://github.com/punnerud/rgcosm"
              >RGCosm – Reverse Geocode for OpenStreetMap</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-06 @ 09:58:33</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41464585"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41464347">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/science/2024/09/study-playing-dungeons-dragons-helps-autistic-players-in-social-interactions/"
              >Study: Playing D&amp;amp;D helps autistic players in social
              interactions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-06 @ 09:05:50</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41464347"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41463809">
          <h3>
            <a
              class="item"
              href="https://blog.nuclearsecrecy.com/2024/09/04/did-sandia-use-a-thermonuclear-secondary-in-a-product-logo/"
              >Did Sandia use a thermonuclear secondary in a product logo?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-06 @ 07:27:06</span
              ><span class="points-container"
                >Points: <span class="points">389</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41463809"
                  >Comments</a
                ><span class="descendants">: 118</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41462574">
          <h3>
            <a
              class="item"
              href="https://www.jeffgeerling.com/blog/2024/what-happens-when-you-touch-pickle-am-radio-tower"
              >What happens when you touch a pickle to an AM radio tower</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-06 @ 03:16:20</span
              ><span class="points-container"
                >Points: <span class="points">243</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41462574"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41461850">
          <h3>
            <a class="item" href="https://www.nongnu.org/lwip/2_1_x/index.html"
              >LwIP – Lightweight IP Stack</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-06 @ 01:00:06</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41461850"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41459865">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/science/article/2024/sep/05/common-food-dye-found-to-make-skin-and-muscle-temporarily-transparent"
              >Common food dye found to make skin and muscle temporarily
              transparent</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-05 @ 19:48:22</span
              ><span class="points-container"
                >Points: <span class="points">299</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41459865"
                  >Comments</a
                ><span class="descendants">: 123</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41458987">
          <h3>
            <a class="item" href="https://github.com/Scthe/nanite-webgpu"
              >UE5 Nanite in WebGPU</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-05 @ 17:55:59</span
              ><span class="points-container"
                >Points: <span class="points">361</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41458987"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41458508">
          <h3>
            <a
              class="item"
              href="https://security.googleblog.com/2024/09/deploying-rust-in-existing-firmware.html"
              >Deploying rust in existing firmware codebases</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-05 @ 17:02:40</span
              ><span class="points-container"
                >Points: <span class="points">177</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41458508"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41458240">
          <h3>
            <a
              class="item"
              href="https://github.com/cloudflare/serverless-registry"
              >Serverless-registry: A Docker registry backed by Workers and
              R2</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-05 @ 16:34:51</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41458240"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41458141">
          <h3>
            <a class="item" href="https://kalmia.difuse.io/doc/"
              >Show HN: We built a FOSS documentation CMS with a pretty GUI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-05 @ 16:26:12</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41458141"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
            <div class="text">
              <p>
                Recently, we decided to open source it, as we believe others
                might benefit from a lightweight, customizable documentation
                system like this. We're excited to see how the community can
                take it further, contribute, and adapt it to their own needs!
              </p>
            </div>
          </section>
        </section>
        <section id="41458083">
          <h3>
            <a
              class="item"
              href="https://www.phind.com/blog/introducing-phind-405b-and-better-faster-searches"
              >Phind-405B and faster, high quality AI answers for everyone</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-05 @ 16:22:09</span
              ><span class="points-container"
                >Points: <span class="points">315</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41458083"
                  >Comments</a
                ><span class="descendants">: 131</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41457331">
          <h3>
            <a
              class="item"
              href="https://deepmind.google/discover/blog/alphaproteo-generates-novel-proteins-for-biology-and-health-research/"
              >AlphaProteo generates novel proteins for biology and health
              research</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-05 @ 15:05:49</span
              ><span class="points-container"
                >Points: <span class="points">289</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41457331"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41456552">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41456552"
              >Launch HN: Maitai (YC S24) – Self-Optimizing LLM Platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-05 @ 13:42:43</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41456552"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
            <div class="text">
              <a href="https://trymaitai.ai">https://trymaitai.ai</a>). We're
              building an LLM platform that optimizes request routing,
              autocorrects bad responses, and automatically fine-tunes new
              application-specific models with incremental improvements. Here’s
              a demo video:
              <a
                href="https://www.loom.com/share/a2cd9192359840cab5274ccba399bd87?sid=7097fd84-ea85-42cd-9616-84abc1087a56"
                >https://www.loom.com/share/a2cd9192359840cab5274ccba399bd87?...</a
              >.
              <p>
                If you want to try it out, we built a game (<a
                  href="https://maitaistreasure.com"
                  >https://maitaistreasure.com</a
                >) to show how our real-time autocorrections work with
                mission-critical expectations (like never giving financial
                advice). Try and coax the bot to give you the secret phrase in
                its system prompt. If you're the first to crack it, you can
                email us the phrase and win a bounty. Maitai is used to make
                sure the bot always adheres to our expectations, and thus never
                gives up the secret phrase.
              </p>
              <p>
                We built Maitai because getting an LLM app into production and
                maintaining it is a slog. Teams spend most of their time on LLM
                reliability rather than their main product. We experienced this
                ourselves at our previous jobs deploying AI-enabled applications
                for Presto—the vast majority of time was making sure the model
                did what we wanted it to do.
              </p>
              <p>
                For example, one of our customers builds AI ordering agents for
                restaurants. It's crucial that their LLMs return results in a
                predictable, consistent manner throughout the conversation. If
                not, it leads to a poor guest experience and a staff member may
                intervene. At the end of the order conversation, they need to
                ensure that the order cart matches what the customer requested
                before it's submitted to the Point of Sale system. It's common
                for a human-in-the-loop to review critical pieces of information
                like this, but it’s costly to set up such a pipeline and it’s
                difficult to scale. When it's time to send out a receipt and
                payment link, they must first get the customer's consent to
                receive text messages, else they risk fines for violating the
                Telephone Consumer Protection Act. To boot, getting from 0 to 1
                usually relies on inefficient general-purpose models that aren't
                viable at any sort of scale beyond proof of concept.
              </p>
              <p>
                Since reliability is the #1 thing hindering the adoption of LLMs
                in production, we decided to help change that. Here's how it
                works:
              </p>
              <p>
                1. Maitai sits between the client and the LLMs as a super
                lightweight proxy, analyzing traffic to automatically build a
                robust set of expectations for how the LLM should respond.
              </p>
              <p>
                2. The application sends a request to Maitai, and Maitai
                forwards it to the appropriate LLM (user specified, but we'll
                preemptively fallback to a similar model if we notice issues
                with the primary model).
              </p>
              <p>
                3. We intercept the response from the LLM, and evaluate it
                against the expectations we had previously built.
              </p>
              <p>
                4. If we notice that an expectation was not met, we surface a
                fault (Slack, webhook) and can, optionally, substitute the
                faulty response with a clean response to be sent back to the
                client. This check and correction adds about 250ms on average
                right now, and we're working on making it faster.
              </p>
              <p>
                5. We use all of the data from evaluating model responses to
                fine-tune application-specific models. We're working on
                automating this step for passive incremental improvements. We'd
                like to get it to a point where our user's inference step just
                gets better, faster, and cheaper over time without them having
                to do anything.
              </p>
              <p>
                Our hope is that we take on the reliability and resiliency
                problems of the LLMs for our customers, and make it so they can
                focus on domain specific problems instead.
              </p>
              <p>
                We're self-serve (<a href="https://portal.trymaitai.ai"
                  >https://portal.trymaitai.ai</a
                >), and have both Python and Node SDKs that mock OpenAI's for
                quick integration. Users can set their preferences for primary
                and secondary (fallback) models in our Portal, or in code. Right
                now, the expectations we use for real-time evaluations are
                automatically generated, but we manually go through and do some
                pruning before enabling them. Fine-tuning is all done manually
                for now.
              </p>
              <p>
                We charge for platform usage, plus a monthly application fee.
                Customers can bring their own LLM provider API keys, or use ours
                and pay at-cost for what they use. We have contracts with most
                of our current customers, so we are still trying to figure out
                what's right for our pay-as-you-go plan.
              </p>
              <p>
                We securely store requests and responses that go through Maitai,
                as well as derivative data such as evaluation results. This
                information is used for fine-tuning models, accessible only by
                the organization the data belongs to. Data is never shared
                between our users. API keys we manage on behalf of our customers
                are only injected before sending to the LLM provider, and never
                leave our servers otherwise. We're working on SOC2 and HIPAA
                compliance, as well as a self-hosted solution for companies with
                extremely sensitive data privacy requirements.
              </p>
              <p>
                We’d love to get your feedback on what we’re building, or hear
                about your experience building around LLMs!
              </p>
            </div>
          </section>
        </section>
        <section id="41445931">
          <h3>
            <a class="item" href="https://github.com/luke8086/retronews"
              >Show HN: Retronews – TUI for HN and Lobsters emulating classical
              Usenet readers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-04 @ 13:58:06</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41445931"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41436009">
          <h3>
            <a
              class="item"
              href="https://storymaps.arcgis.com/stories/41d4bd6029044afbb1b9ad805a4731d8"
              >More than 20k ships sank during WW II. One man is on a mission to
              map them</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-03 @ 15:38:11</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41436009"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41435444">
          <h3>
            <a
              class="item"
              href="https://landsat.gsfc.nasa.gov/apps/YourNameInLandsat-main/index.html"
              >Name in Landsat</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-03 @ 14:43:01</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41435444"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41433579">
          <h3>
            <a
              class="item"
              href="https://blog.rootsofprogress.org/steam-engine-origins"
              >The origins of the steam engine (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-03 @ 11:03:40</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41433579"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41428245">
          <h3>
            <a
              class="item"
              href="https://blog.demofox.org/2024/09/02/summing-blue-noise-octaves-like-perlin-noise/"
              >Summing Blue Noise Octaves Like Perlin Noise</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-02 @ 19:46:02</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41428245"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41426898">
          <h3>
            <a
              class="item"
              href="https://8dcc.github.io/programming/understanding-y-combinator.html"
              >Understanding the Y Combinator</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-02 @ 16:47:32</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41426898"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41426828">
          <h3>
            <a
              class="item"
              href="https://medium.com/@yonatanzunger/advanced-python-achieving-high-performance-with-code-generation-796b177ec79"
              >Advanced Python: Achieving High Performance with Code
              Generation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-02 @ 16:38:14</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41426828"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41424533">
          <h3>
            <a
              class="item"
              href="https://www.cam.ac.uk/stories/hawking-archive-for-all"
              >Hawking Archive made available to historians and researchers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-02 @ 11:36:45</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41424533"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
