<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39552934">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/business/2024/feb/29/biden-spending-highways-public-transport-climate-crisis"
              >US spends billions on roads rather than public transport in
              'climate time bomb'</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 18:17:09</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39552934"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39552882">
          <h3>
            <a class="item" href="https://marimo.app/l/c7h6pz"
              >Show HN: Marimo – open-source reactive Python notebook – running
              in WASM</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 18:12:22</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39552882"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
            <div class="text">
              <p>
                It’s now possible to run marimo notebooks entirely in the
                browser via WebAssembly (WASM).
              </p>
              <p>
                - A marimo tutorial as a WASM notebook:
                <a href="https://marimo.app/l/c7h6pz"
                  >https://marimo.app/l/c7h6pz</a
                >
              </p>
              <p>
                - Training a neural network with Karpathy’s micrograd:
                <a href="https://marimo.app/l/xpd4te"
                  >https://marimo.app/l/xpd4te</a
                >
              </p>
              <p>
                - Visualizing attractors, as a read-only app:
                <a href="https://marimo.app/l/e9wii1?mode=read"
                  >https://marimo.app/l/e9wii1?mode=read</a
                >
              </p>
              <p>
                - A blank notebook:
                <a href="https://marimo.new">https://marimo.new</a>
              </p>
              <p>
                - Docs:
                <a href="https://docs.marimo.io/guides/wasm.html"
                  >https://docs.marimo.io/guides/wasm.html</a
                >
              </p>
              <p>
                WASM notebooks let you experiment with code without having to
                install Python on your machine. These notebooks can be easily
                shared — marimo includes a button that generates a marimo.app
                URL (code encoded as a query parameter), and marimo.app has a
                built-in permalink generator. We also support embedding via
                iframes: you can use this to (say) author interactive
                documentation or standalone interactive blog posts. We now in
                fact use embedded WASM notebooks throughout our API docs.
              </p>
              <p>
                Our WASM notebook is powered by Pyodide [3], a WASM-based Python
                distribution. Pyodide can run any Python package that has a pure
                Python wheel, as well as many popular libraries for scientific
                computing and machine learning, including Pandas, NumPy, SciPy,
                and scikit-learn. Over time, we expect more and more libraries
                to be packaged for Pyodide.
              </p>
              <p>
                We’re very excited by the potential of WASM notebooks to make
                computing more accessible, and we’re in awe of all that the WASM
                and Pyodide contributors have accomplished. We have lots more
                planned (one example: we plan to make it easy to work with local
                files), and hope to share new developments with you in the
                future. In the meantime, please try
                <a href="https://marimo.app">https://marimo.app</a> out. We’d
                appreciate feedback!
              </p>
              <p>
                P.S. Our support for WASM is very new; you may encounter sharp
                edges. Still, since WASM-compatibility was one of the most
                requested features from our previous HN, we felt it was worth
                sharing.
              </p>
              <p>
                [1]
                <a href="https://news.ycombinator.com/item?id=38971966"
                  >https://news.ycombinator.com/item?id=38971966</a
                >
              </p>
              <p>
                [2]
                <a href="https://github.com/marimo-team/marimo"
                  >https://github.com/marimo-team/marimo</a
                >
              </p>
              <p>
                [3]
                <a href="https://github.com/pyodide/pyodide"
                  >https://github.com/pyodide/pyodide</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="39552446">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/cars/2024/02/ford-evs-gain-access-to-tesla-superchargers-starting-today/"
              >Ford EVs gain access to Tesla Superchargers starting today</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 17:36:44</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39552446"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39552442">
          <h3>
            <a
              class="item"
              href="https://www.bleepingcomputer.com/news/security/malicious-ai-models-on-hugging-face-backdoor-users-machines/"
              >Malicious AI models on Hugging Face backdoor users' machines</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 17:36:21</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39552442"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39552367">
          <h3>
            <a
              class="item"
              href="https://old.reddit.com/r/LocalLLaMA/comments/1b2wron/alright_then_keep_your_secrets/"
              >Alright then keep your secrets</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 17:29:40</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39552367"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39552100">
          <h3>
            <a
              class="item"
              href="https://www.gov.uk/government/publications/the-buckland-review-of-autism-employment-report-and-recommendations/the-buckland-review-of-autism-employment-report-and-recommendations"
              >The Buckland Review of Autism Employment: Report and
              Recommendations</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 17:06:39</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39552100"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39551457">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=7BGtVJ3lBdE"
              >Neurosurgeon pioneers Alzheimer's, addiction treatments using
              ultrasound [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 16:24:52</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39551457"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39551115">
          <h3>
            <a
              class="item"
              href="https://www.phoronix.com/news/Cloudflare-Pingora-Open-Source"
              >Cloudflare Makes Pingora Rust Framework Open-Source</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 16:00:41</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39551115"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39551064">
          <h3>
            <a class="item" href="https://rowzero.io"
              >Show HN: We built the fastest spreadsheet</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 15:57:44</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39551064"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39550891">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/climate-environment/2024/02/29/life-earth-origin-chemistry/"
              >Scientists get closer to solving chemical puzzle of the origin of
              life</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 15:45:47</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39550891"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39550202">
          <h3>
            <a
              class="item"
              href="https://worldsensorium.com/unearthing-the-oldest-forest-on-earth-two-hours-from-new-york-city-you-can-travel-back-nearly-400-million-years/"
              >Unearthing the Oldest Forest on Earth</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 15:01:57</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39550202"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39550124">
          <h3>
            <a
              class="item"
              href="https://ferrous-systems.com/blog/lock-free-ring-buffer/"
              >A lock-free ring-buffer with contiguous reservations (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 14:57:03</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39550124"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39550081">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2024/2/29/24086501/crypto-firm-gemini-ny-regulator-settlement"
              >Crypto firm Gemini to pay over $1B back to customers in
              settlement</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 14:54:33</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39550081"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39549838">
          <h3>
            <a
              class="item"
              href="https://www.biorxiv.org/content/10.1101/2023.12.08.570879v1"
              >Rendering protein structures inside cells at the atomic level
              with Unreal Engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 14:38:09</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39549838"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39549415">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/entropy-bagels-and-other-complex-structures-emerge-from-simple-rules-20240227/"
              >'Entropy Bagels' and Other Complex Structures Emerge from Simple
              Rules</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 14:04:14</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39549415"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39549194">
          <h3>
            <a
              class="item"
              href="https://github.com/jovandeginste/workout-tracker"
              >Show HN: Workout Tracker – self-hosted, single binary web
              application</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 13:45:44</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39549194"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
            <div class="text">
              I tried some web tools to track my workouts (specifically,
              running); some (like FitTrackee) came close, but I always found
              annoyances. So I decided to build my own. Specifically geared
              towards distance-based workouts, such as walking, running or
              cycling.
            </div>
          </section>
        </section>
        <section id="39548410">
          <h3>
            <a
              class="item"
              href="https://jamesg.blog/2024/02/29/linux-manual-pages/"
              >Serving my blog posts as Linux manual pages</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 12:18:20</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39548410"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39548088">
          <h3>
            <a
              class="item"
              href="https://lwn.net/SubscriberLink/963851/0c64b8038c62432c/"
              >The KDE desktop gets an overhaul with Plasma 6</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 11:33:24</span
              ><span class="points-container"
                >Points: <span class="points">554</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39548088"
                  >Comments</a
                ><span class="descendants">: 401</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39547940">
          <h3>
            <a
              class="item"
              href="https://docs.hetzner.com/general/others/new-billing-model/"
              >Hetzner switches to new billing model</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 10:18:17</span
              ><span class="points-container"
                >Points: <span class="points">245</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39547940"
                  >Comments</a
                ><span class="descendants">: 135</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39547109">
          <h3>
            <a
              class="item"
              href="https://www.lumafield.com/article/heinzs-sustainable-ketchup-cap"
              >Heinz’s sustainable ketchup cap</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 07:23:10</span
              ><span class="points-container"
                >Points: <span class="points">205</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39547109"
                  >Comments</a
                ><span class="descendants">: 333</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39546158">
          <h3>
            <a
              class="item"
              href="https://www.bryanbraun.com/2021/09/21/i-keep-making-things-out-of-checkboxes/"
              >I keep making things out of checkboxes (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 03:34:10</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39546158"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39544937">
          <h3>
            <a
              class="item"
              href="https://www.seriouseats.com/history-of-jell-o-salad"
              >A Social History of Jell-O Salad (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 23:39:46</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39544937"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39544498">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Antarctic_English"
              >Antarctic English</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 22:48:51</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39544498"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39541944">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/culture/cultural-comment/dune-and-the-delicate-art-of-making-fictional-languages"
              >"Dune" and the Delicate Art of Making Fictional Languages</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 18:34:34</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39541944"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39541084">
          <h3>
            <a
              class="item"
              href="https://github.com/Dicklesworthstone/sassaman_and_dingledine_on_remailers_at_blackhat_2003"
              >Transcript of "Attacks on Anonymity Systems: The Theory"
              (2003)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 17:29:19</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39541084"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39537486">
          <h3>
            <a class="item" href="https://github.com/mentat-collective/emmy"
              >The Emmy Computer Algebra System</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 13:20:29</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39537486"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39536437">
          <h3>
            <a
              class="item"
              href="https://two-wrongs.com/software-design-tree-and-program-families.html"
              >Common Mistakes in Modularisation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 11:04:36</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39536437"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39535800">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2402.17764"
              >The Era of 1-bit LLMs: ternary parameters for cost-effective
              computing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 09:28:43</span
              ><span class="points-container"
                >Points: <span class="points">962</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39535800"
                  >Comments</a
                ><span class="descendants">: 419</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39534937">
          <h3>
            <a class="item" href="http://book.mixu.net/css/"
              >Learn CSS Layout the Pedantic Way</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 07:07:16</span
              ><span class="points-container"
                >Points: <span class="points">187</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39534937"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39534574">
          <h3>
            <a
              class="item"
              href="https://blog.frost.kiwi/WebGL-LUTS-made-simple/"
              >How video games use lookup tables</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 06:00:04</span
              ><span class="points-container"
                >Points: <span class="points">472</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39534574"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
