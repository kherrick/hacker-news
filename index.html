<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="45771636">
          <h3>
            <a
              class="item"
              href="https://news.mit.edu/2025/your-brain-without-sleep-1029"
              >Attention lapses due to sleep deprivation due to flushing fluid
              from brain</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-31 @ 13:14:23</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45771636"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45771538">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/interactive/2025/10/31/technology/openai-fundraising-deals.html"
              >OpenAI Uses Complex and Circular Deals to Fuel Its
              Multibillion-Dollar Rise</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-31 @ 13:03:46</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45771538"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45771211">
          <h3>
            <a
              class="item"
              href="https://tedium.co/2025/10/30/canva-affinity-free-loss-leader-strategy/"
              >Affinity, targeting office workers over pros, making pro tools
              the loss leader</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-31 @ 12:18:35</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45771211"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45770928">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2025-10-delays-egypt-lavish-grand-museum.html"
              >After delays, Egypt set for lavish opening of grand museum</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-31 @ 11:41:25</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45770928"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45769971">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2510.22371"
              >Reasoning Models Reason Well, Until They Don't</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-31 @ 09:23:41</span
              ><span class="points-container"
                >Points: <span class="points">176</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45769971"
                  >Comments</a
                ><span class="descendants">: 141</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45767916">
          <h3>
            <a
              class="item"
              href="https://www.guru3d.com/story/amd-enters-arm-market-with-sound-wave-apu-built-on-tsmc-3nm-process/"
              >AMD Could Enter ARM Market with Sound Wave APU Built on TSMC 3nm
              Process</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-31 @ 03:07:48</span
              ><span class="points-container"
                >Points: <span class="points">213</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45767916"
                  >Comments</a
                ><span class="descendants">: 147</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45767725">
          <h3>
            <a
              class="item"
              href="https://twitter.com/id_aa_carmack/status/1983593511703474196"
              >John Carmack on mutable variables</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-31 @ 02:34:36</span
              ><span class="points-container"
                >Points: <span class="points">264</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45767725"
                  >Comments</a
                ><span class="descendants">: 306</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45767257">
          <h3>
            <a
              class="item"
              href="https://forums.swift.org/t/roadmap-for-improving-the-type-checker/82952"
              >Roadmap for Improving the Type Checker</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-31 @ 01:00:45</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45767257"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45767162">
          <h3>
            <a class="item" href="https://github.com/fulcrumresearch/quibbler"
              >Show HN: Quibbler â€“ A critic for your coding agent that learns
              what you want</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-31 @ 00:43:57</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45767162"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45766937">
          <h3>
            <a class="item" href="https://github.com/MoonshotAI/Kimi-Linear"
              >Kimi Linear: An Expressive, Efficient Attention Architecture</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-31 @ 00:07:36</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45766937"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45765787">
          <h3>
            <a
              class="item"
              href="https://www.acma.gov.au/phone-numbers-use-tv-shows-films-and-creative-works"
              >Phone numbers for use in TV shows, films and creative works</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-30 @ 21:49:11</span
              ><span class="points-container"
                >Points: <span class="points">237</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45765787"
                  >Comments</a
                ><span class="descendants">: 116</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45765664">
          <h3>
            <a
              class="item"
              href="https://therecord.media/demark-reportedly-withdraws-chat-control-proposal"
              >Denmark reportedly withdraws Chat Control proposal following
              controversy</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-30 @ 21:35:42</span
              ><span class="points-container"
                >Points: <span class="points">473</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45765664"
                  >Comments</a
                ><span class="descendants">: 177</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45763877">
          <h3>
            <a class="item" href="https://github.com/itsfrank/MinecraftHDL"
              >Minecraft HDL, an HDL for Redstone</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-30 @ 18:59:02</span
              ><span class="points-container"
                >Points: <span class="points">203</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45763877"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45762259">
          <h3>
            <a
              class="item"
              href="https://www.dissonances.blog/p/the-ear-does-not-do-a-fourier-transform"
              >How the cochlea computes (2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-30 @ 17:01:20</span
              ><span class="points-container"
                >Points: <span class="points">451</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45762259"
                  >Comments</a
                ><span class="descendants">: 137</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45761445">
          <h3>
            <a class="item" href="https://www.affinity.studio/get-affinity"
              >Affinity Studio now free</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-30 @ 15:54:38</span
              ><span class="points-container"
                >Points: <span class="points">1110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45761445"
                  >Comments</a
                ><span class="descendants">: 722</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.affinity.studio/"
                >https://www.affinity.studio/</a
              >
            </div>
          </section>
        </section>
        <section id="45760878">
          <h3>
            <a class="item" href="https://danieldelaney.net/normal/"
              >Free software scares normal people</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-30 @ 15:07:15</span
              ><span class="points-container"
                >Points: <span class="points">790</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45760878"
                  >Comments</a
                ><span class="descendants">: 511</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45760321">
          <h3>
            <a class="item" href="https://0github.com"
              >Show HN: I made a heatmap diff viewer for code reviews</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-30 @ 14:21:58</span
              ><span class="points-container"
                >Points: <span class="points">243</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45760321"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
            <div class="text">
              <p>
                To try it, replace github.com with 0github.com in any
                pull-request URL. Under the hood, we split the PR into
                individual files, and for each file, we ask an LLM to annotate
                each line with a data structure that we parse into a colored
                heatmap.
              </p>
              <p>Examples:</p>
              <p>
                <a href="https://0github.com/manaflow-ai/cmux/pull/666"
                  >https://0github.com/manaflow-ai/cmux/pull/666</a
                >
              </p>
              <p>
                <a href="https://0github.com/stack-auth/stack-auth/pull/988"
                  >https://0github.com/stack-auth/stack-auth/pull/988</a
                >
              </p>
              <p>
                <a href="https://0github.com/tinygrad/tinygrad/pull/12995"
                  >https://0github.com/tinygrad/tinygrad/pull/12995</a
                >
              </p>
              <p>
                <a href="https://0github.com/simonw/datasette/pull/2548"
                  >https://0github.com/simonw/datasette/pull/2548</a
                >
              </p>
              <p>
                Notice how all the example links have a 0 prepended before
                github.com. This navigates you to our custom diff viewer where
                we handle the same URL path parameters as github.com. Darker
                yellows indicate that an area might require more investigation.
                Hover on the highlights to see the LLM's explanation. There's
                also a slider on the top left to adjust the "should review"
                threshold.
              </p>
              <p>
                Repo (MIT license):
                <a href="https://github.com/manaflow-ai/cmux"
                  >https://github.com/manaflow-ai/cmux</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="45755027">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/security/2025/10/npm-flooded-with-malicious-packages-downloaded-more-than-86000-times/"
              >NPM flooded with malicious packages downloaded more than 86k
              times</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-30 @ 00:37:33</span
              ><span class="points-container"
                >Points: <span class="points">311</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45755027"
                  >Comments</a
                ><span class="descendants">: 225</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45742957">
          <h3>
            <a
              class="item"
              href="https://theamericanscholar.org/scrolling-through/"
              >Jack Kerouac, Malcolm Cowley, and the difficult birth of On the
              Road</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-29 @ 05:27:42</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45742957"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45736461">
          <h3>
            <a
              class="item"
              href="https://www.joshwcomeau.com/animation/linear-timing-function/"
              >Springs and bounces in native CSS</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-28 @ 18:01:46</span
              ><span class="points-container"
                >Points: <span class="points">229</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45736461"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45720616">
          <h3>
            <a
              class="item"
              href="https://www.juliensauctions.com/en/articles/the-florian-schneider-collection-rare-instruments-and-iconic-equipment-from-kraftwerk"
              >Florian Schneider Collection: Instruments and equipment up for
              auction</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-27 @ 13:06:46</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45720616"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45712620">
          <h3>
            <a
              class="item"
              href="https://www.johndcook.com/blog/2025/10/26/987654321/"
              >987654321 / 123456789</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-26 @ 15:22:16</span
              ><span class="points-container"
                >Points: <span class="points">602</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45712620"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45703860">
          <h3>
            <a
              class="item"
              href="https://gmpy.dev/blog/2025/wheels-for-free-threaded-python-now-available-in-psutil"
              >Wheels for free-threaded Python now available for psutil</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-25 @ 13:46:35</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45703860"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45703063">
          <h3>
            <a
              class="item"
              href="https://rockyj-blogs.web.app/2025/10/25/result-monad.html"
              >Result is all I need</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-25 @ 11:40:58</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45703063"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45702281">
          <h3>
            <a
              class="item"
              href="https://www.rsc.org/news/2019/july/exceptional-measurement-of-chirality"
              >Exceptional Measurement of Chirality</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-25 @ 08:43:28</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45702281"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45693698">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/in-orbit-you-have-to-slow-down-to-speed-up/"
              >In orbit you have to slow down to speed up</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-24 @ 11:55:59</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45693698"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45691697">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Bertie_the_Brain"
              >Bertie the Brain</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-24 @ 07:00:57</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45691697"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45680366">
          <h3>
            <a
              class="item"
              href="https://www.scientificamerican.com/article/a-human-on-a-bicycle-is-among-the-most-efficient-forms-of-travel-in-the/"
              >A classic graphic reveals nature's most efficient traveler</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-23 @ 10:45:33</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45680366"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45680023">
          <h3>
            <a class="item" href="https://github.com/bnjbvr/rouille"
              >Rouille â€“ Rust Programming, in French</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-23 @ 09:43:52</span
              ><span class="points-container"
                >Points: <span class="points">181</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45680023"
                  >Comments</a
                ><span class="descendants">: 111</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45671336">
          <h3>
            <a
              class="item"
              href="https://www.samaterials.com/content/a-closer-look-at-stressed-piezo-crystals.html"
              >A Closer Look at Piezoelectric Crystal</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-22 @ 16:12:16</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45671336"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
