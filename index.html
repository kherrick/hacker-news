<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39007248">
          <h3>
            <a class="item" href="https://ihavenotv.com/"
              >Watch Free Online Documentaries</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 23:03:46</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39007248"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39007076">
          <h3>
            <a
              class="item"
              href="https://everyonegaming.com/oppo-find-x7-ultra-flagship-smartphone-features-the-worlds-first-dual-periscope-zooms/"
              >Oppo Find X7 Ultra: smartphone features the first dual periscope
              zooms</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 22:44:45</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39007076"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39006398">
          <h3>
            <a
              class="item"
              href="https://twitter.com/emollick/status/1746254000914092480"
              >Amazon R&amp;amp;D spending is more than that of all companies
              and government of France</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 21:35:42</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39006398"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39006383">
          <h3>
            <a
              class="item"
              href="https://eliasnaur.com/blog/immediate-mode-gui-programming"
              >Immediate Mode GUI Programming</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 21:33:57</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39006383"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39006337">
          <h3>
            <a class="item" href="https://www.svix.com/careers/"
              >Svix (YC W21) Is Hiring a Technical Content Marketer (US
              Remote)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 21:28:48</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39005818">
          <h3>
            <a
              class="item"
              href="https://techxplore.com/news/2024-01-future-gigantic-solar-farms-impact.amp"
              >Gigantic solar farms might change weather elsewhere</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 20:41:26</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39005818"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39005780">
          <h3>
            <a
              class="item"
              href="https://www.abubalay.com/blog/2024/01/14/rust-effect-lowering"
              >A lowering strategy for control effects in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 20:38:02</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39005780"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39005505">
          <h3>
            <a
              class="item"
              href="https://hackaday.com/2024/01/15/haiku-os-the-open-source-beos-you-can-daily-drive-in-2024/"
              >Haiku OS: The Open Source BeOS You Can Daily Drive in 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 20:14:58</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39005505"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39005433">
          <h3>
            <a
              class="item"
              href="https://aeon.co/essays/does-language-mirror-the-mind-an-intellectual-history"
              >Our language, our world</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 20:08:16</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39005433"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39005238">
          <h3>
            <a
              class="item"
              href="https://www.classicshorts.com/stories/dresses.html"
              >"The Girls in Their Summer Dresses" â€“ Irwin Shaw (1939)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 19:48:09</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39005238"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39004963">
          <h3>
            <a
              class="item"
              href="https://www.sqlite.org/changes.html#version_3_45_0"
              >SQLite 3.45 released with JSONB support</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 19:24:44</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39004963"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39004755">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39004755"
              >Ask HN: OCR for 100 year old (German) handwritten cursive
              script?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 19:08:23</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39004755"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
            <div class="text">
              I'm looking for an OCR solution for about 200 pages of text. It's
              handwritten German script from about 100 years old and I can
              barely read the handwriting myself. Google Translate sometimes
              manages to OCR certain parts, but nothing useful (I don't need the
              translation part of GT). Which solutions out there would be able
              to recognize old handwritten script?
            </div>
          </section>
        </section>
        <section id="39004725">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/2024/01/15/us/antique-dress-maine-encrypted-message-cec/index.html"
              >A woman bought a vintage dress. It had a secret pocket with a
              mysterious note</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 19:06:18</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39004725"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39003929">
          <h3>
            <a class="item" href="https://eligrey.com/blog/link-fraud/"
              >Big Tech's role in enabling link fraud</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 18:01:44</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39003929"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39003867">
          <h3>
            <a
              class="item"
              href="https://axleos.com/simulating-slices-of-ios-apps/"
              >Simulating Slices of iOS Apps</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 17:57:51</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39003867"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39003773">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/articles/spotted-water-hemlock-toxic-plant"
              >Spotted water hemlock: the most toxic plant in North America
              (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 17:51:06</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39003773"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39003417">
          <h3>
            <a class="item" href="https://one-from-nippon.ghost.io/onigiri/"
              >Japan's Comfort Food: The Onigiri</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 17:22:27</span
              ><span class="points-container"
                >Points: <span class="points">203</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39003417"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39003255">
          <h3>
            <a
              class="item"
              href="https://www.bbc.co.uk/future/article/20240103-sewage-a-low-cost-low-carbon-way-to-warm-homes"
              >Harnessing heat from wastewater</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 17:12:22</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39003255"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39003066">
          <h3>
            <a
              class="item"
              href="https://www.danielcorin.com/posts/2024/fine-tuning-connections/"
              >(Unsuccessfully) Fine-tuning GPT to play "Connections"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 17:02:33</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39003066"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39002643">
          <h3>
            <a class="item" href="https://github.com/FossifyOrg"
              >Fossify â€“ Open-source fork of Simple Mobile Tools</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 16:29:53</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39002643"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39002138">
          <h3>
            <a
              class="item"
              href="https://github.com/open-spaced-repetition/fsrs4anki/wiki/ABC-of-FSRS"
              >FSRS: A modern, efficient spaced repetition algorithm</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 15:40:03</span
              ><span class="points-container"
                >Points: <span class="points">229</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39002138"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39001755">
          <h3>
            <a class="item" href="https://norvig.com/21-days.html"
              >Teach Yourself Programming in Ten Years (1998)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 15:06:07</span
              ><span class="points-container"
                >Points: <span class="points">355</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39001755"
                  >Comments</a
                ><span class="descendants">: 210</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39001572">
          <h3>
            <a
              class="item"
              href="https://github.com/awwsmm/hello-rust-sdl2-wasm"
              >Show HN: A minimal working Rust / SDL2 / WASM browser game</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 14:49:51</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39001572"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
            <div class="text">
              "Game" is a stretch, but I put together this repo containing a
              pure Rust app which uses SDL2 and compiles to WASM (and can be run
              in a browser). Older resources were a bit out of date and a bit
              too verbose for my purposes, so here's a minimal working example.
            </div>
          </section>
        </section>
        <section id="39000648">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=ujdlxAQw5oA"
              >Paper Pipe Organ (2019) [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 13:22:06</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39000648"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38998516">
          <h3>
            <a
              class="item"
              href="https://www.bitsand.cloud/posts/slashing-data-transfer-costs/"
              >Slashing data transfer costs in AWS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 08:19:13</span
              ><span class="points-container"
                >Points: <span class="points">305</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38998516"
                  >Comments</a
                ><span class="descendants">: 206</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38997500">
          <h3>
            <a class="item" href="https://github.com/ludios/expand-everything"
              >Expand Everything: Userscript to click "show more" links to
              expand all the text</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-15 @ 04:35:05</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38997500"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38989999">
          <h3>
            <a
              class="item"
              href="https://www.studiobinder.com/blog/write-compelling-logline-examples"
              >How to write a logline producers won't pass on</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-14 @ 12:55:39</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38989999"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38987966">
          <h3>
            <a class="item" href="https://www.gatesnotes.com/Lights-Out"
              >What Happened to GE?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-14 @ 06:12:38</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38987966"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38985308">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=ued2cEcfAio"
              >Feynman Sprinkler [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-13 @ 22:32:13</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38985308"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38979792">
          <h3>
            <a class="item" href="https://wokwi.com/"
              >Wokwi â€“ Simulate IoT Projects in the Browser</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-13 @ 13:42:58</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38979792"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
