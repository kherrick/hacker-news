<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38027791">
          <h3>
            <a class="item" href="https://www.internetisbeautiful.com"
              >Show HN: I am curating the best websites on the internet</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 16:20:10</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38027791"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38027533">
          <h3>
            <a
              class="item"
              href="https://www.spacechatter.com/2023/10/25/moon-fragment-near-earth-asteroid-kamooalewa/"
              >Near-Earth Asteroid Is a Chunk of the Moon</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 16:04:24</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38027533"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38026983">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/economy/central-banking/us-gdp-economy-third-quarter-f247fa45"
              >U.S. Economy Grew at 4.9% Rate This Summer, Powered by
              Fast-Spending Americans</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 15:35:10</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38026983"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38026736">
          <h3>
            <a class="item" href="https://github.com/PurpleI2P/i2pd"
              >I2P: End-to-End encrypted and anonymous Internet</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 15:18:24</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38026736"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38026637">
          <h3>
            <a
              class="item"
              href="https://hackerhistory.com/podcast/the-history-of-rob-cmdrtaco-malda/"
              >Rob 'CmdrTaco' Malda – Hacker History Podcast</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 15:12:07</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38026637"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38026119">
          <h3>
            <a
              class="item"
              href="https://komonews.com/news/local/uw-medicine-kidney-stone-breakthrough-procedure-treatment-nasa-mars-astronaut-research-patients-game-changer-seattle-clinical-trial-harborview-medical-center"
              >Kidney stone breakthrough procedure at UW called 'game changer'
              for patients</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 14:32:02</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38026119"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38026037">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/10/26/microsoft_dma_exemption/"
              >Microsoft seeks EU Digital Market Acts exemption for underdog
              apps like Edge</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 14:26:25</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38026037"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38025998">
          <h3>
            <a
              class="item"
              href="https://www.chalmers.se/en/current/news/75-percent-of-exclusive-hardwood-may-be-illegally-harvested,c3863187/"
              >75 percent of exclusive hardwood may be illegally harvested</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 14:23:54</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38025998"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38025788">
          <h3>
            <a
              class="item"
              href="https://kerkour.com/why-cloud-bandwidth-is-so-expensive"
              >Why cloud bandwidth is so obscenely expensive and what you can do
              about that</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 14:08:04</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38025788"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38025767">
          <h3>
            <a
              class="item"
              href="https://www.nngroup.com/articles/content-dispersion/"
              >The Negative Impact of Mobile-First Web Design on Desktop</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 14:06:45</span
              ><span class="points-container"
                >Points: <span class="points">256</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38025767"
                  >Comments</a
                ><span class="descendants">: 155</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38025381">
          <h3>
            <a
              class="item"
              href="https://probablymarcus.com/blocks/2023/10/19/vectorizing-wide-pytorch-expressions.html"
              >What happens when you vectorize wide PyTorch expressions?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 13:41:16</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38025381"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38025200">
          <h3>
            <a
              class="item"
              href="https://therecord.media/uk-government-criticized-over-abolishing-ai-biometric-safeguards"
              >UK government accused of 'vandalism' over abolishing biometrics
              safeguards</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 13:25:29</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38025200"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38025177">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2023/10/26/us-gdp-grew-at-a-4point9percent-annual-pace-in-the-third-quarter-better-than-expected.html"
              >U.S. GDP grew at a 4.9% annual pace in the third quarter, better
              than expected</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 13:23:03</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38025177"
                  >Comments</a
                ><span class="descendants">: 426</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38025125">
          <h3>
            <a
              class="item"
              href="https://gearspace.com/board/electronic-music-instruments-and-electronic-music-production/1416192-synth-emulation-mame-arcade-machine-emulator-new-trend.html"
              >Synth Emulation in MAME (Arcade Machine Emulator). A New
              Trend?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 13:18:51</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38025125"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38025086">
          <h3>
            <a
              class="item"
              href="https://www.economist.com/leaders/2023/10/26/sodium-batteries-offer-an-alternative-to-tricky-lithium"
              >Sodium batteries offer an alternative to tricky lithium</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 13:14:48</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38025086"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38024899">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-023-03271-4"
              >Mars has a surprise layer of molten rock inside</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 12:57:25</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38024899"
                  >Comments</a
                ><span class="descendants">: 158</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38024665">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/science/2023/oct/26/cold-war-satellite-images-hundreds-unknown-roman-forts"
              >Cold war satellite images reveal hundreds of unknown Roman
              forts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 12:31:58</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38024665"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38024456">
          <h3>
            <a class="item" href="https://www.verto.sh/"
              >Verto.sh: A New Hub Connecting Beginners with Open-Source
              Projects</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 12:08:18</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38024456"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38024418">
          <h3>
            <a
              class="item"
              href="http://jsxgraph.uni-bayreuth.de/wiki/index.php/Hilbert_curve"
              >Hilbert curve: The famous space filling curve drawn with
              JavaScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 12:01:48</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38024418"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38024002">
          <h3>
            <a
              class="item"
              href="https://github.com/analysis-tools-dev/static-analysis"
              >Static Analysis Tools for C</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 11:03:20</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38024002"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38023891">
          <h3>
            <a
              class="item"
              href="https://oxide.computer/blog/the-cloud-computer"
              >Oxide: The Cloud Computer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 10:43:59</span
              ><span class="points-container"
                >Points: <span class="points">755</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38023891"
                  >Comments</a
                ><span class="descendants">: 448</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38023580">
          <h3>
            <a
              class="item"
              href="https://www.gamesradar.com/5-people-made-the-original-super-mario-bros-all-of-them-were-still-at-nintendo-to-ship-wonder-38-years-later/"
              >People who made the original Super Mario Bros shipped Wonder 38
              years later</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 09:45:17</span
              ><span class="points-container"
                >Points: <span class="points">165</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38023580"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38023544">
          <h3>
            <a class="item" href="https://github.com/facebookresearch/MetaCLIP"
              >MetaCLIP – Meta AI Research</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 09:36:42</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38023544"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38021461">
          <h3>
            <a class="item" href="https://github.com/instant-dev/api"
              >Show HN: Instant API – Build type-safe web APIs with
              JavaScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 04:00:22</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38021461"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
            <div class="text">
              <p>
                This eliminates the need for most schema validation libraries,
                automates user input sanitization, and prevents your team from
                developing carpal tunnel syndrome trying to keep your OpenAPI /
                Swagger specifications up-to-date. We developed it as a side
                effect of building our own serverless API platform, where it has
                scaled to handle over 100M requests from users per day. This is
                an early release, but Instant API has had about six years of
                consistent development as proprietary software to get to the
                point it is at today. We have spent the last couple of months
                modernizing it.
              </p>
              <p>
                We have command line tools that make building, testing, and
                deploying Instant API to Vercel or AWS a breeze. Additionally,
                there is a sister package, Instant ORM, that provides a Ruby on
                Rails-like model management, migration and querying suite for
                Postgres. Everything you need to build an API from scratch.
              </p>
              <p>
                Finally -- LLMs and chatbots are the the top of the hype cycle
                right now. We aren't immune, and have developed a number of
                LLM-integrated tools ourselves. Instant API comes with
                first-class Server-Sent Event support for building your own
                assistants and a few other nifty tools that help with AI
                integrations and chatbot webhook responses, like executing
                endpoints as background jobs.
              </p>
              <p>
                This has been a huge labor of love -- it has become our
                "JavaScript on Rails" suite -- and we hope y'all enjoy it!
              </p>
            </div>
          </section>
        </section>
        <section id="38020792">
          <h3>
            <a class="item" href="https://research.swtch.com/nih"
              >Running the "Reflections on Trusting Trust" Compiler</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 01:57:14</span
              ><span class="points-container"
                >Points: <span class="points">240</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38020792"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38013299">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Heslington_Brain"
              >Heslington Brain</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 14:40:06</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38013299"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38012494">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=TGiVMj5Vm2g"
              >William Blake's Printing Process</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 13:21:00</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38012494"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38009291">
          <h3>
            <a
              class="item"
              href="https://salt.security/blog/oh-auth-abusing-oauth-to-take-over-millions-of-accounts"
              >Oh-Auth – Abusing OAuth to take over millions of accounts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 04:57:08</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38009291"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38007547">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/10/23/books/review/thurston-moore-sonic-life.html"
              >Thurston Moore Revisits His Sonic Youth</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 00:14:02</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38007547"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38000479">
          <h3>
            <a
              class="item"
              href="https://lareviewofbooks.org/article/reading-in-the-conglomerate-era-or-do-small-presses-even-exist/"
              >Reading in the Conglomerate Era</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 15:25:43</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38000479"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
