<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="45250202">
          <h3>
            <a
              class="item"
              href="https://blog.velocifyer.com/Posts/3,0,0,2025-8-13,+how+to+self+host+a+font+from+google+fonts.html"
              >How to self-host a web font from Google Fonts</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-15 @ 14:33:41</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45250202"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45249985">
          <h3>
            <a
              class="item"
              href="https://tidyfirst.substack.com/p/programming-deflation"
              >Programming Deflation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-15 @ 14:11:43</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45249985"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45249915">
          <h3>
            <a
              class="item"
              href="https://newsroom.paypal-corp.com/2025-09-15-PayPal-Ushers-in-a-New-Era-of-Peer-to-Peer-Payments,-Reimagining-How-Money-Moves-to-Anyone,-Anywhere"
              >PayPal Ushers in a New Era of Peer-to-Peer Payments with Ethereum
              and Bitcoin</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-15 @ 14:04:47</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45249915"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45249878">
          <h3>
            <a
              class="item"
              href="https://www.jeffgeerling.com/blog/2025/cubesats-are-fascinating-learning-tools-space"
              >CubeSats are fascinating learning tools for space</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-15 @ 14:02:02</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45249878"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45249697">
          <h3>
            <a class="item" href="https://github.com/anishathalye/semlib"
              >Show HN: Semlib – Semantic Data Processing</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-15 @ 13:45:56</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45249697"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45249500">
          <h3>
            <a class="item" href="http://vmchale.com/static/serve/taxonomy.html"
              >The Obsolescence of Political Definitions</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-15 @ 13:29:50</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45249500"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45249287">
          <h3>
            <a
              class="item"
              href="https://bogdanthegeek.github.io/blog/projects/vapeserver/"
              >Hosting a website on a disposable vape</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-15 @ 13:13:49</span
              ><span class="points-container"
                >Points: <span class="points">298</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45249287"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45249113">
          <h3>
            <a
              class="item"
              href="https://ktklp.substack.com/p/my-first-year-without-an-iphone"
              >My First Year Without an iPhone</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-15 @ 12:57:28</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45249113"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45248868">
          <h3>
            <a class="item" href="https://github.com/xataio/pgstream"
              >Pgstream: Postgres streaming logical replication with DDL
              changes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-15 @ 12:28:24</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45248868"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45248802">
          <h3>
            <a
              class="item"
              href="https://mastodon.social/@chatcontrol/115204439983078498"
              >Denmark's Justice Minister calls encrypted messaging a false
              civil liberty</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-15 @ 12:21:21</span
              ><span class="points-container"
                >Points: <span class="points">319</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45248802"
                  >Comments</a
                ><span class="descendants">: 194</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45247890">
          <h3>
            <a class="item" href="https://github.com/tekaratzas/RustGPT"
              >RustGPT: A pure-Rust transformer LLM built from scratch</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-15 @ 09:47:18</span
              ><span class="points-container"
                >Points: <span class="points">244</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45247890"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45247616">
          <h3>
            <a
              class="item"
              href="https://neurofrontiers.blog/how-does-air-pollution-impact-your-brain/"
              >How does air pollution impact your brain?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-15 @ 09:04:23</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45247616"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45247396">
          <h3>
            <a class="item" href="https://cindori.com/backdrop"
              >Show HN: I reverse engineered macOS to allow custom Lock Screen
              wallpapers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-15 @ 08:28:09</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45247396"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
            <div class="text">
              <p>
                For years, I've been frustrated by the lack of customisation of
                macOS. In particular the Lock Screen which supports animated
                wallpapers, but only ones provided by Apple. There's never been
                a way to add your own personal videos.
              </p>
              <p>
                I decided to figure out how to solve this, and the result is
                Backdrop 2.0. Backdrop is my Live Wallpaper app for Mac, it can
                play video wallpapers on your desktop. And now it can play on
                your Lock Screen too.
              </p>
              <p>
                The core technical challenge, as you can imagine, came from
                trying to do something that Apple otherwise does not allow.
                However, through extensive reverse engineering of the macOS
                wallpaper system, I figured out a way to provide Backdrop
                wallpapers to the system in a way that allows them to play on
                the lock screen, and even appear in a custom section in System
                Settings.
              </p>
              <p>
                I'm here all day to answer any questions—especially about the
                reverse engineering process, the challenges of integrating with
                macOS, or the experience of being an indie Mac developer.
              </p>
              <p>Would love to hear your thoughts and feedback.</p>
            </div>
          </section>
        </section>
        <section id="45246971">
          <h3>
            <a
              class="item"
              href="https://blog.jim-nielsen.com/2025/mac-app-flea-market/"
              >The Mac App Flea Market</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-15 @ 07:14:13</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45246971"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45246953">
          <h3>
            <a
              class="item"
              href="https://lcamtuf.substack.com/p/folks-we-have-the-best"
              >Folks, we have the best π</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-15 @ 07:10:03</span
              ><span class="points-container"
                >Points: <span class="points">216</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45246953"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45246403">
          <h3>
            <a class="item" href="https://celestiaproject.space/"
              >Celestia – Real-time 3D visualization of space</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-15 @ 05:30:19</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45246403"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45245948">
          <h3>
            <a class="item" href="https://nickyoder.com/johnson-lindenstrauss/"
              >Language Models Pack Billions of Concepts into 12k Dimensions</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-15 @ 03:54:20</span
              ><span class="points-container"
                >Points: <span class="points">288</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45245948"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45245678">
          <h3>
            <a
              class="item"
              href="https://adamhl.dev/blog/largest-number-in-npm-package/"
              >Which NPM package has the largest version number?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-15 @ 03:03:18</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45245678"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45245313">
          <h3>
            <a class="item" href="https://forgoodfirstissue.github.com/"
              >For Good First Issue – A repository of social impact and open
              source projects</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-15 @ 02:02:39</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45245313"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45243803">
          <h3>
            <a
              class="item"
              href="https://www.sdstate.edu/news/2025/08/can-grapevines-help-slow-plastic-waste-problem"
              >Grapevine canes can be converted into plastic-like material that
              will decompose</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-14 @ 22:15:33</span
              ><span class="points-container"
                >Points: <span class="points">370</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45243803"
                  >Comments</a
                ><span class="descendants">: 290</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45243635">
          <h3>
            <a
              class="item"
              href="https://www.cubbyathome.com/boxed-cake-mix-sizes-have-shrunk-80045058"
              >Betty Crocker broke recipes by shrinking boxes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-14 @ 21:54:07</span
              ><span class="points-container"
                >Points: <span class="points">512</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45243635"
                  >Comments</a
                ><span class="descendants">: 554</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45228615">
          <h3>
            <a
              class="item"
              href="https://silverrainz.me/blog/2025-09-systemd-fzf-aliases.html"
              >A set of smooth, fzf-powered shell aliases&amp;amp;functions for
              systemctl</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-13 @ 01:40:37</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45228615"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45226938">
          <h3>
            <a
              class="item"
              href="https://www.jpl.nasa.gov/news/nasas-guardian-tsunami-detection-tech-catches-wave-in-real-time/"
              >NASA's Guardian Tsunami Detection Tech Catches Wave in Real
              Time</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-12 @ 21:25:08</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45226938"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45225903">
          <h3>
            <a
              class="item"
              href="https://stephenfollows.com/p/which-colours-dominate-movie-posters-and-why"
              >Which colours dominate movie posters and why?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-12 @ 19:43:26</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45225903"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45223827">
          <h3>
            <a
              class="item"
              href="https://log.bede.im/2025/09/12/zstandard-long-range-genomes.html"
              >Removing newlines in FASTA file increases ZSTD compression ratio
              by 10x</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-12 @ 16:25:11</span
              ><span class="points-container"
                >Points: <span class="points">151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45223827"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45222715">
          <h3>
            <a
              class="item"
              href="https://harpers.org/archive/2022/05/in-the-land-of-living-skies-reacquainting-ourselves-with-the-night/"
              >In the Land of Living Skies: Reacquainting ourselves with the
              night (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-12 @ 14:45:55</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45222715"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45222705">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2025/09/jef-raskins-cul-de-sac-and-the-quest-for-the-humane-computer/"
              >Jef Raskin's cul-de-sac and the quest for the humane computer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-12 @ 14:44:55</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45222705"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45221023">
          <h3>
            <a class="item" href="https://xeon.me/gnome/pythonbpf/"
              >PythonBPF – Writing eBPF Programs in Pure Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-12 @ 11:29:47</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45221023"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45216460">
          <h3>
            <a
              class="item"
              href="https://www.earlence.com/blog.html#/post/cellmate"
              >Sandboxing Browser AI Agents</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-11 @ 21:48:47</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45216460"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45216327">
          <h3>
            <a
              class="item"
              href="https://www.sciencedirect.com/science/article/pii/S1383762124000390"
              >Analyzing the memory ordering models of the Apple M1</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-11 @ 21:33:46</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45216327"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
