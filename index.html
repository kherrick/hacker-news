<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36141244">
          <h3>
            <a
              class="item"
              href="https://theathletic.com/4565384/2023/05/30/nflpa-licensing-crypto-nft/"
              >NFL labor union is out almost $42M thanks to crypto collapse</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 17:46:22</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36141244"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36141131">
          <h3>
            <a
              class="item"
              href="https://www.businessinsider.com/sweden-work-life-balance-american-expat-happiness-burnout-2023-5"
              >I moved from the US to Sweden after struggling with burnout</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 17:37:14</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36141131"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36141083">
          <h3>
            <a
              class="item"
              href="https://old.reddit.com/r/apolloapp/comments/13ws4w3/had_a_call_with_reddit_to_discuss_pricing_bad/"
              >Had a call with Reddit to discuss pricing. Bad news for
              third-party apps</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 17:30:39</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36141083"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36140916">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36140916"
              >Launch HN: Onu (YC W23) – Turn scripts into internal tools in
              minutes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 17:19:40</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36140916"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
            <div class="text">
              <a href="https://joinonu.com">https://joinonu.com</a>). Onu lets
              you write scripts and turn them into internal tools suitable for
              use by non-technical teammates. We built Onu to help you spend
              more time coding and less time running scripts for ops or customer
              support. Unlike no-code/low-code products, we’re code-first and
              let you use your preferred tools. We take care of the annoying
              parts for you: most importantly the frontend, but also auditing,
              permissions, and 3rd party integrations (e.g. Slack, email, Jira,
              Pagerduty).
              <p>
                We’ve put up a few sample screenshots at
                <a href="https://joinonu.com/examples"
                  >https://joinonu.com/examples</a
                >, and a demo video here:
                <a href="https://www.youtube.com/watch?v=4XMnBRsktsw"
                  >https://www.youtube.com/watch?v=4XMnBRsktsw</a
                >.
              </p>
              <p>
                Many engineers lose hours a week fielding requests from other
                teams. While most companies have a home-grown internal dashboard
                (or are using a third party tool builder for this such as
                Retool), there is still a long tail of scripts that engineers
                have to run regularly for their ops and CX teammates, either
                locally or by SSHing into prod. Maybe a user’s account got stuck
                in a weird state, or you have a script to manually onboard new
                customers to your B2B product, or you have to run a custom
                provisioning script each time you add a bike to your e-bike
                fleet (something we experienced at Lyft).
              </p>
              <p>
                We experienced these problems while working on engineering teams
                at Lyft and Stripe. Our teams needed internal tooling, but we
                didn’t have time to build feature-rich dashboards. Stripe had a
                homegrown tool that allowed engineers to quickly spin up simple
                internal tools without writing any frontend code. When we
                started working on Onu with a different idea we immediately felt
                the pain of not having a similar tool. We pivoted to working on
                our current product instead because we already knew how powerful
                it can be for speeding up engineering teams.
              </p>
              <p>
                Internal tool builders mostly take a no code/low code approach
                that requires engineers to duplicate a lot of business logic in
                the browser. This leads to brittle internal apps that are hard
                to keep in sync with the business logic in your codebase, and
                difficult to maintain as you scale. In addition, such tools
                subject you to point-and-click / drag-and-drop workflows that
                just aren’t the sweet spot for programmers. We don’t like
                working that way ourselves, so we focus on a code-first
                approach, allowing you to hand scripts to non-technical
                teammates to own and run without engineering oversight.
              </p>
              <p>
                Onu works with your existing dev workflow. You write scripts in
                your editor of choice—not the browser—and deploy tasks the same
                way you deploy any other code. We can host your scripts if you
                prefer, but you can also add Onu to your existing Express server
                and our frontend will handle routing requests to the correct
                script. We currently have a Node SDK and are rolling out Python
                next.
              </p>
              <p>
                You can try Onu now by heading to
                <a href="https://auth.joinonu.com/signup"
                  >https://auth.joinonu.com/signup</a
                >
                and signing up for an account. It’s free for personal use cases
                and for teams of up to 5 people.
              </p>
              <p>We’re looking forward to your thoughts and feedback!</p>
            </div>
          </section>
        </section>
        <section id="36140861">
          <h3>
            <a
              class="item"
              href="https://openai.com/research/improving-mathematical-reasoning-with-process-supervision"
              >Improving Mathematical Reasoning with Process Supervision</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 17:15:59</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36140861"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36140639">
          <h3>
            <a
              class="item"
              href="https://provision-software.notion.site/Provision-is-Hiring-8b53cc10bbd04af39bf3d3c7ab181cac"
              >Provision (YC S22) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 17:00:04</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36140520">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36140520"
              >Tell HN: YouTube Download Websites Disappearing from Google
              Search Results</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 16:51:34</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36140520"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
            <div class="text">
              <p>
                Upon further investigation, I discovered that numerous recent
                DMCA reports have called for the removal of these websites,
                e.g., (https://lumendatabase.org/notices/34141048#) and
                (https://lumendatabase.org/notices/34226349#). Interestingly,
                this development coincides with YouTube's ongoing ad-blocker
                crackdown.
              </p>
              <p>
                I don´t agree that those websites necessarily violate
                copyrighted content. I can't help but feel that my trust in
                Google search results has been further eroded.
              </p>
            </div>
          </section>
        </section>
        <section id="36140494">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36140494"
              >What's the best AWS S3 protocol alternative?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 16:49:59</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36140494"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
            <div class="text">
              That's it, with batteries included like file grant
              privilege/permission control, or presigned url with path support.
            </div>
          </section>
        </section>
        <section id="36140380">
          <h3>
            <a
              class="item"
              href="https://gizmodo.com/rocket-carrying-north-korean-spy-satellite-crashes-sea-1850490896"
              >Rocket Carrying North Korean Spy Satellite Crashes into Sea</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 16:39:49</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36140380"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36140177">
          <h3>
            <a
              class="item"
              href="https://linuxfoundation.eu/newsroom/rise-project-launches-to-accelerate-development-of-risc-v"
              >Rise: Accelerate the Development of Open Source Software for
              RISC-V</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 16:22:48</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36140177"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36139852">
          <h3>
            <a
              class="item"
              href="https://aisnakeoil.substack.com/p/is-avoiding-extinction-from-ai-really"
              >The greatest risk of AI is from the people who control it, not
              the tech itself</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 15:58:38</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36139852"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36139729">
          <h3>
            <a class="item" href="https://www.theprompt.io/p/ai-camera-no-lens"
              >AI Camera with No Lens</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 15:49:22</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36139729"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36139349">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-023-01780-w"
              >AI intensifies fight against ‘paper mills’ that churn out fake
              research</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 15:18:04</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36139349"
                  >Comments</a
                ><span class="descendants">: 108</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36138642">
          <h3>
            <a
              class="item"
              href="https://neon.tech/blog/when-limit-9-works-but-limit-10-hangs"
              >When LIMIT 9 works but LIMIT 10 hangs: A short debugging story</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 14:11:49</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36138642"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36138439">
          <h3>
            <a
              class="item"
              href="https://locusmag.com/2023/05/commentary-cory-doctorow-the-swivel-eyed-loons-have-a-point/"
              >The Swivel-Eyed Loons Have a Point</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 13:53:56</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36138439"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36138304">
          <h3>
            <a class="item" href="https://cs.uwaterloo.ca/~csk/slide/"
              >Slide to Unlock</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 13:41:55</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36138304"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36138239">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/gigabyte-motherboard-firmware-backdoor/"
              >Some models of Gigabyte motherboards download firmware updates
              insecurely</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 13:35:56</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36138239"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36137897">
          <h3>
            <a
              class="item"
              href="https://www.ai21.com/blog/human-or-not-results"
              >AI21 Labs concludes largest Turing Test experiment to date</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 13:05:03</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36137897"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36137530">
          <h3>
            <a
              class="item"
              href="https://www.colorado.edu/today/2023/05/24/these-tiny-medical-robots-could-one-day-travel-through-your-body"
              >Tiny, medical robots could one day travel through the body</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 12:28:32</span
              ><span class="points-container"
                >Points: <span class="points">178</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36137530"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36137261">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-023-01770-y"
              >India cuts periodic table and evolution from school textbooks</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 11:55:06</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36137261"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36136819">
          <h3>
            <a
              class="item"
              href="https://web.archive.org/web/20230531105653/https://rarbg.to/index80.php"
              >Rarbg Is No More</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 10:56:14</span
              ><span class="points-container"
                >Points: <span class="points">751</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36136819"
                  >Comments</a
                ><span class="descendants">: 431</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36135955">
          <h3>
            <a class="item" href="https://zealdocs.org/"
              >Zeal is an offline documentation browser for software
              developers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 08:38:49</span
              ><span class="points-container"
                >Points: <span class="points">255</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36135955"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36135844">
          <h3>
            <a
              class="item"
              href="https://spritely.institute/news/scheme-to-wasm-lambdas-recursion.html"
              >Directly compiling Scheme to WebAssembly: lambdas, recursion,
              iteration</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 08:20:24</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36135844"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36135533">
          <h3>
            <a class="item" href="https://github.com/openjdk/jdk/pull/14227"
              >AVX512 intrinsics for JDK’s Arrays.sort methods</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 07:30:26</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36135533"
                  >Comments</a
                ><span class="descendants">: 122</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36135190">
          <h3>
            <a class="item" href="https://box86.org/2023/05/box64-and-risc-v/"
              >Box64 and RISC-V</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 06:32:50</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36135190"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36134423">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2018/11/03/obituaries/hardy-fox-dead.html"
              >Hardy Fox, of the avant-garde band The Residents (maybe)
              (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 04:21:55</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36134423"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36134249">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36134249"
              >Ask HN: Is it just me or GPT-4's quality has significantly
              deteriorated lately?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-31 @ 03:46:58</span
              ><span class="points-container"
                >Points: <span class="points">744</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36134249"
                  >Comments</a
                ><span class="descendants">: 612</span></span
              >
            </h4>
            <div class="text">
              <p>
                For a while, the GPT-4 on phind.com gave even better results
                than GPT-4-powered ChatGPT. I could notice the difference in
                speed of both GPT-4s. Phind's was slower and more accurate. I
                say "was" because apparently phind is now trying to use GPT-3.5
                and their own Phind model more frequently, so much for GPT-4
                powered search engine....
              </p>
              <p>
                I wonder if I use Poe's GPT-4, maybe I'll get the good old GPT-4
                back?
              </p>
            </div>
          </section>
        </section>
        <section id="36131210">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=6yrYWjjuIOs"
              >Rde: A configuration framework for GNU Guix</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 21:35:45</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36131210"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36128617">
          <h3>
            <a class="item" href="https://kuenzi.dev/toothbrush/"
              >Hacking my “smart” toothbrush</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 18:30:31</span
              ><span class="points-container"
                >Points: <span class="points">617</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36128617"
                  >Comments</a
                ><span class="descendants">: 239</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36121482">
          <h3>
            <a
              class="item"
              href="https://hacks.mozilla.org/2018/03/es-modules-a-cartoon-deep-dive/"
              >ES modules: A cartoon deep-dive (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-30 @ 05:39:42</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36121482"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
