<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42193793">
          <h3>
            <a class="item" href="https://github.com/greymattergames/unbug"
              >Show HN: Unbug – Rust macros for programmatically invoking
              breakpoints</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 13:33:15</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42193793"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
            <div class="text">
              <p>
                Due to reliance on core_intrinsics it is necessary to develop
                using nightly Rust, but there are stubs in place so a production
                build will not require nightly.
              </p>
              <p>
                I recently released version 0.2 which includes no_std support
                and adds optional log message arguments to the ensure macro.
              </p>
            </div>
          </section>
        </section>
        <section id="42193771">
          <h3>
            <a
              class="item"
              href="https://history.stackexchange.com/questions/57033/what-is-the-origin-of-the-lake-tank-image-that-has-become-a-meme"
              >What is the origin of the lake tank image that has become a meme?
              (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 13:30:03</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42193771"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42193089">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42193089"
              >Clearest Health (YC S23) is hiring a full-stack engineer in NY</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 12:00:58</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
            <div class="text">
              <p>
                We are in an unsexy $300 B market that desperately needs better
                incentive alignment, which can only be achieved through better
                technology. Your work will directly impact the health and
                savings of 60% of the American population. We have a five-year
                tech roadmap, a strong sales motion, and significant funding.
              </p>
              <p>
                If you are a good fit, you’ll join us in our Soho Office, get
                covered lunch + dinner, Equinox membership, weekly massages, and
                whatever you need to make the 10 years your best 10 years.
                Expect your friends to ask why you are working so hard and then
                ask if they can work with you.
              </p>
              <p>Culture-fit Requirements</p>
              <p>
                Customer-obsessed Opinionated but convincible Has great taste
                Wicked fast iterations High trust, high loyalty Cares deeply
                about changing healthcare and insurance Role Guidelines
              </p>
              <p>
                - Measure twice, cut once. Design features by presenting
                multiple options for review prior to implementation. You show
                good judgment when making technical trade-offs. - High
                ownership. You can operate independently and own features end to
                end with minimal guidance. - Comfortable with moving fast,
                taking shortcuts as directed and technical guidance. - Super
                user of Cursor &amp; Chrome Dev Tools. - Background in life
                sciences, UX or product design is a plus. - Design and build
                products from repo creation - Extreme knowledge and expertise in
                building data-intensive applications
              </p>
              <p>Technical Stack</p>
              <p>
                - Frontend: React, React Router, Tailwind.css and Mantine. -
                Backend: Node.js + Typescript Hono Lambda. Heavy IO operations
                will be written in Go. - Infrastructure: - Auth: Clerk (we will
                roll our own using Auth.js eventually) - Hosting: AWS,
                Cloudflare Pages - Compute: AWS Lambda, ECS Fargate (for long
                running jobs) - Storage: S3, DynamoDB, PostgresSQL - Analytics:
                CloudWatch, Metabase
              </p>
            </div>
          </section>
        </section>
        <section id="42192336">
          <h3>
            <a
              class="item"
              href="https://www.abebooks.com/books/ex-library-books"
              >Discarded delights: The joy of ex-library books (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 09:58:39</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42192336"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42191709">
          <h3>
            <a
              class="item"
              href="https://blog.frost.kiwi/analytical-anti-aliasing/"
              >AAA – Analytical Anti-Aliasing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 08:03:20</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42191709"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42191354">
          <h3>
            <a
              class="item"
              href="https://scottlocklin.wordpress.com/2024/11/19/lush-my-favorite-small-programming-language/"
              >Lush: My favorite small programming language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 06:47:02</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42191354"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42190650">
          <h3>
            <a
              class="item"
              href="https://emschwartz.me/understanding-the-bm25-full-text-search-algorithm/"
              >Understanding the BM25 full text search algorithm</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 03:43:10</span
              ><span class="points-container"
                >Points: <span class="points">180</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42190650"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42190418">
          <h3>
            <a
              class="item"
              href="https://welltypedwitch.bearblog.dev/nominal-for-storing-structural-for-manipulating/"
              >Nominal for Storing, Structural for Manipulating</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 02:50:21</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42190418"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42190199">
          <h3>
            <a
              class="item"
              href="https://nickelinstitute.org/media/lxxh1zwr/2023-nickelplatinghandbooka5_printablepdf.pdf"
              >Nickel Plating Handbook [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 02:08:31</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42190199"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42189253">
          <h3>
            <a
              class="item"
              href="https://jmlr.org/papers/volume22/20-1061/20-1061.pdf"
              >Large-Scale Dimension Reduction with Both Global and Local
              Structure (2021) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 23:39:02</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42189253"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42188816">
          <h3>
            <a
              class="item"
              href="https://www.newstatesman.com/culture/books/book-of-the-day/2024/11/political-afterlife-paradise-lost-milton-orlando-reade-review"
              >The Political Afterlife of Paradise Lost</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 22:35:21</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42188816"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42187766">
          <h3>
            <a class="item" href="https://github.com/OpenRiak"
              >Open Riak – open, modern Riak fork</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 20:29:30</span
              ><span class="points-container"
                >Points: <span class="points">185</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42187766"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42185842">
          <h3>
            <a
              class="item"
              href="https://chernando.com/blog/2023/07/23/hand-tracking-for-mouse-input.html"
              >Hand Tracking for Mouse Input (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 17:18:14</span
              ><span class="points-container"
                >Points: <span class="points">199</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42185842"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42185715">
          <h3>
            <a class="item" href="https://the-analog-thing.org/"
              >The Analog Thing: Analog Computing for the Future</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 17:09:28</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42185715"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42185668">
          <h3>
            <a
              class="item"
              href="https://apps.apple.com/us/app/black-hole-vision/id6737292448"
              >Show HN: Physically accurate black hole simulation using your
              iPhone camera</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 17:06:11</span
              ><span class="points-container"
                >Points: <span class="points">291</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42185668"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42183561">
          <h3>
            <a
              class="item"
              href="https://semiengineering.com/shift-left-is-the-tip-of-the-iceberg/"
              >Shift Left Is the Tip of the Iceberg</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 14:06:36</span
              ><span class="points-container"
                >Points: <span class="points">157</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42183561"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42182784">
          <h3>
            <a class="item" href="https://github.com/mtantaoui/Integrate"
              >Show HN: Rust library for numerical integration of real-valued
              functions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 12:41:08</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42182784"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
            <div class="text">
              <p>
                Integrate supports a variety of numerical integration
                techniques: - Newton-Cotes methods:
              </p>
              <p></p>
              <pre><code>  - Rectangle Rule.
  - Trapezoidal Rule.
  - Simpson's Rule.
  - Newton's 3/8 Rule.
</code></pre>
              - Gauss quadrature methods:
              <p></p>
              <pre><code>  - Gauss-Legendre.
  - Gauss-Laguerre.
  - Gauss-Hermite.
  - Gauss-Chebyshev First Kind.
  - Gauss-Chebyshev Second Kind.
</code></pre>
              - Adaptive Methods:
              <p></p>
              <pre><code>  - Adaptive Simpson's method
</code></pre>
              - Romberg’s method.
            </div>
          </section>
        </section>
        <section id="42182519">
          <h3>
            <a
              class="item"
              href="https://tech.marksblogg.com/osm-mvt-vector-tiles.html"
              >OpenStreetMap's New Vector Tiles</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 12:03:02</span
              ><span class="points-container"
                >Points: <span class="points">444</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42182519"
                  >Comments</a
                ><span class="descendants">: 142</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42181345">
          <h3>
            <a
              class="item"
              href="https://www.researchgate.net/publication/374700857_Fair_coins_tend_to_land_on_the_same_side_they_started_Evidence_from_350757_flips"
              >Fair coins tend to land on the side they started (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 09:03:50</span
              ><span class="points-container"
                >Points: <span class="points">380</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42181345"
                  >Comments</a
                ><span class="descendants">: 179</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42178916">
          <h3>
            <a
              class="item"
              href="https://pmc.ncbi.nlm.nih.gov/articles/PMC2997957/"
              >Why I hate the index finger (1980)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 00:35:15</span
              ><span class="points-container"
                >Points: <span class="points">225</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42178916"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42174105">
          <h3>
            <a
              class="item"
              href="https://www.andreinc.net/2024/11/18/a-function-to-approximate-raising-small-numbers-to-small-irrational-powers"
              >A joke in approximating numbers raised to irrational powers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-18 @ 16:41:02</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42174105"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42170423">
          <h3>
            <a
              class="item"
              href="https://texdraft.github.io/fortran/fortran.html"
              >Fortran II Hypersource</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-18 @ 07:10:35</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42170423"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42162271">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2409.11582"
              >Tiling with Three Polygons Is Undecidable</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-17 @ 05:51:44</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42162271"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42149762">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/11/14/world/canada/blobs-canada-newfoundland.html"
              >Chemist Identifies Mystery 'Blobs' Washing Up in Newfoundland</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 18:57:50</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42149762"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42147860">
          <h3>
            <a class="item" href="https://sandimetz.com/99bottles"
              >Bottles of OOP now available in Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 15:39:16</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42147860"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42147252">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2410.16144"
              >1-Bit AI Infrastructure</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 14:28:23</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42147252"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42145975">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/server-reuse"
              >Researchers have built server prototypes that re-use old
              components</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 11:32:14</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42145975"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42144816">
          <h3>
            <a class="item" href="https://github.com/dbohdan/recur"
              >Show HN: Retry a command with exponential backoff and jitter (+
              Starlark exprs)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 08:04:36</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42144816"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42144369">
          <h3>
            <a class="item" href="https://github.com/mkalioby/leopards"
              >Query Your Python Lists</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 06:18:48</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42144369"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42135303">
          <h3>
            <a
              class="item"
              href="https://hwisnu.bearblog.dev/fireducks-pandas-but-100x-faster/"
              >FireDucks: Pandas but Faster</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-14 @ 11:48:30</span
              ><span class="points-container"
                >Points: <span class="points">207</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42135303"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
