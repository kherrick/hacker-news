<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36253769">
          <h3>
            <a class="item" href="https://github.com/geoffreytools/free-types"
              >Free-types: Higher kinded types in TypeScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-09 @ 05:45:46</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36253769"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36253591">
          <h3>
            <a
              class="item"
              href="https://www.rtl-sdr.com/flipper-zero-self-destructs-an-electricity-smart-meter/"
              >Flipper Zero Self Destructs an Electricity Smart Meter</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-09 @ 05:22:29</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36253591"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36253422">
          <h3>
            <a
              class="item"
              href="https://jlericson.com/2023/06/07/strike_progress.html"
              >How's the Stack Overflow strike going?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-09 @ 05:01:14</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36253422"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36251643">
          <h3>
            <a
              class="item"
              href="https://grist.org/energy/first-us-nuclear-reactor-40-years-online-georgia/"
              >The US is getting its first new nuclear reactor in 40 years</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-09 @ 00:52:40</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36251643"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36250689">
          <h3>
            <a
              class="item"
              href="https://fortune.com/2023/06/08/google-remote-work-office-attendance-performance-review/"
              >Google uses in-person office attendance as part of employee
              performance reviews</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 23:18:44</span
              ><span class="points-container"
                >Points: <span class="points">150</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36250689"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36250350">
          <h3>
            <a
              class="item"
              href="https://www.historytoday.com/archive/history-matters/war-dogs"
              >The dog cull of 1760 divided London</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 22:50:52</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36250350"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36249671">
          <h3>
            <a
              class="item"
              href="https://www.instructables.com/Mechanical-Apple-Watch-From-Real-E-Waste-Apple-Wat/"
              >Mechanical Apple Watch from real e-waste Apple Watch</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 21:48:20</span
              ><span class="points-container"
                >Points: <span class="points">205</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36249671"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36249546">
          <h3>
            <a
              class="item"
              href="https://shanen.medium.com/the-ti-lisp-explorer-project-5fc53a90fb11"
              >The TI (Lisp) Explorer Project</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 21:39:33</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36249546"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36249036">
          <h3>
            <a class="item" href="https://manjaro.org/"
              >Manjaro is a free and open source Linux operating system that
              emphasizes privacy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 21:04:37</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36249036"
                  >Comments</a
                ><span class="descendants">: 118</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36248633">
          <h3>
            <a
              class="item"
              href="https://simonwillison.net/2023/Jun/8/gpt-tokenizers/"
              >Understanding GPT tokenizers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 20:40:30</span
              ><span class="points-container"
                >Points: <span class="points">271</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36248633"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36247549">
          <h3>
            <a
              class="item"
              href="https://twitter.com/DimitrisPapail/status/1666843952824168465"
              >GPT-4 “discovered” the same sorting algorithm as AlphaDev by
              removing “mov S P”</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 19:37:48</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36247549"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36247404">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2023/6/8/23754239/mark-zuckerberg-meta-apple-vision-pro-headset"
              >Mark Zuckerberg on Apple’s Vision Pro headset</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 19:30:08</span
              ><span class="points-container"
                >Points: <span class="points">154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36247404"
                  >Comments</a
                ><span class="descendants">: 415</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36246750">
          <h3>
            <a
              class="item"
              href="https://www.science.org/doi/10.1126/science.abn9257"
              >Taurine deficiency as a driver of aging</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 18:50:36</span
              ><span class="points-container"
                >Points: <span class="points">220</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36246750"
                  >Comments</a
                ><span class="descendants">: 212</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36245786">
          <h3>
            <a
              class="item"
              href="https://engineering.desmos.com/articles/pratt-parser/"
              >Desmos uses Pratt Parsers (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 17:46:48</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36245786"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36245435">
          <h3>
            <a
              class="item"
              href="https://old.reddit.com/r/apolloapp/comments/144f6xm/apollo_will_close_down_on_june_30th_reddits/"
              >Apollo will close down on June 30th</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 17:22:27</span
              ><span class="points-container"
                >Points: <span class="points">3080</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36245435"
                  >Comments</a
                ><span class="descendants">: 1433</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36245102">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/aviator/jobs/svf18r9-senior-software-engineer-founding-team"
              >Aviator (YC S21) is hiring senior engineers who are passionate
              about DX</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 17:00:41</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36244886">
          <h3>
            <a class="item" href="https://www.tremor.so/changelog"
              >Show HN: Tremor 3.0 – Open-source library to build dashboards
              fast</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 16:48:00</span
              ><span class="points-container"
                >Points: <span class="points">178</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36244886"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
            <div class="text">
              <p>- Global theming via tailwind.config.js</p>
              <p>- An out-of-the-box dark mode</p>
              <p>- A new Tremor CLI helping you set up projects faster</p>
            </div>
          </section>
        </section>
        <section id="36244647">
          <h3>
            <a
              class="item"
              href="https://www.nber.org/be/20231/startups-drive-commercialization-high-impact-innovations"
              >Startups drive commercialization of high-impact innovations</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 16:34:10</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36244647"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36244591">
          <h3>
            <a
              class="item"
              href="https://candrews.medium.com/why-youre-going-about-recovering-from-perfectionism-all-wrong-b747dea3981f"
              >Why you’re going about recovering from perfectionism all wrong
              (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 16:30:03</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36244591"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36244565">
          <h3>
            <a class="item" href="https://infinitemac.org/"
              >Infinite Mac: Classic Macintosh system releases and software on a
              web browser</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 16:28:24</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36244565"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36243955">
          <h3>
            <a
              class="item"
              href="https://9to5mac.com/2023/06/08/ios-17-link-tracking-protection/"
              >iOS 17 automatically removes tracking parameters from links you
              click on</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 15:51:29</span
              ><span class="points-container"
                >Points: <span class="points">776</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36243955"
                  >Comments</a
                ><span class="descendants">: 267</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36243951">
          <h3>
            <a
              class="item"
              href="https://www.kolide.com/blog/ai-browser-extensions-are-a-security-nightmare"
              >AI browser extensions are a security nightmare</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 15:51:22</span
              ><span class="points-container"
                >Points: <span class="points">221</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36243951"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36243926">
          <h3>
            <a class="item" href="https://databasediagram.com"
              >Show HN: Private, text to entity-relationship diagram tool</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 15:49:06</span
              ><span class="points-container"
                >Points: <span class="points">226</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36243926"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36243738">
          <h3>
            <a
              class="item"
              href="https://www.medien.ifi.lmu.de/pubdb/publications/pub/mai2017mum/mai2017mum.pdf"
              >TransparentHMD: Revealing the HMD User’s Face to Bystanders
              (2017) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 15:39:47</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36243738"
                  >Comments</a
                ><span class="descendants">: 115</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36242914">
          <h3>
            <a
              class="item"
              href="https://twitter.com/goodside/status/1666598580319035392"
              >Weird GPT-4 behavior for the specific string “ davidjl”</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 14:56:22</span
              ><span class="points-container"
                >Points: <span class="points">212</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36242914"
                  >Comments</a
                ><span class="descendants">: 180</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36242459">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/06/08/nyregion/feral-cats-nyc.html"
              >Clearing 500k feral cats from New York’s streets</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 14:30:33</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36242459"
                  >Comments</a
                ><span class="descendants">: 154</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36238438">
          <h3>
            <a
              class="item"
              href="https://www.silentcinemasociety.org/the-american-fotoplayer/"
              >The American Fotoplayer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 07:27:01</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36238438"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36237969">
          <h3>
            <a
              class="item"
              href="https://www.artpublikamag.com/post/the-making-of-the-worlds-first-ever-fully-painted-feature-film-loving-vincent"
              >The Making of the First Ever Fully Painted Feature Film “Loving
              Vincent”</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 06:21:15</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36237969"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36237731">
          <h3>
            <a class="item" href="http://www.bricklin.com/visicalc.htm"
              >The History of VisiCalc (1999-2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-08 @ 05:48:58</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36237731"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36229524">
          <h3>
            <a
              class="item"
              href="https://handbooks.clerky.com/startup-incorporation"
              >Startup Incorporation for Founders: A new handbook</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-07 @ 16:52:52</span
              ><span class="points-container"
                >Points: <span class="points">246</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36229524"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
            <div class="text">
              <p>
                We've written a handbook about startup incorporation and I
                wanted to share it with all of you :)
              </p>
              <p>
                There is, of course, a lot of content about startup
                incorporation out there already. Why did we decide to add to the
                pile? Honestly, I often wince when I read what's out there,
                because so much of it is misguided or just plain wrong. A lot of
                it is people with no legal expertise regurgitating the same
                (often misguided / wrong) information they've read/heard
                elsewhere. Basically, the setup for the Gell-Mann amnesia
                effect, except the culprits are content marketers instead of the
                media.
              </p>
              <p>
                We also felt there was a need to have something comprehensive.
                While there's a lot of bad information out there, there is also
                a lot of great, accurate information. It's just usually spread
                across various blogs from startup attorneys, which makes it
                difficult to get a comprehensive view. With this handbook, our
                goal was to provide a central resource covering everything you
                need to know about startup incorporation.
              </p>
              <p>A few content-related notes:</p>
              <p>
                • We mention this in the handbook, but this is all written with
                US-based startups in mind. We fully recognize a lot of founders
                are elsewhere, but there's just too much to cover if we were to
                expand the scope to beyond the US. Sorry about that!
              </p>
              <p>
                • The word "startup" means different things to different people.
                We use the word in pretty much the way PG uses it here:
                <a href="http://www.paulgraham.com/growth.html"
                  >http://www.paulgraham.com/growth.html</a
                >
              </p>
              <p>
                • As the name implies, this handbook is narrowly focused on
                startup incorporation. A lot of people don't know this, but
                there's a lot more to forming a startup than just incorporation,
                like setting up a board, issuing stock to founders, etc. We
                previously published a handbook called Legal Concepts for
                Founders, which touches on those topics:
                <a href="https://handbooks.clerky.com/legal-concepts"
                  >https://handbooks.clerky.com/legal-concepts</a
                >
              </p>
              <p>
                On more of a UI-related note, some personal pain points that we
                tried to address with our handbook design:
              </p>
              <p>
                • It's easy to jump down to a footnote and jump back up to where
                you came from (just click on the footnote number).
              </p>
              <p>
                • Every subheading is link-able, as are any callouts that you
                might want to link to.
              </p>
              <p>
                • We've been very generous with linking to glossary terms so
                that readers can quickly learn what they need to know in order
                to understand what they're reading. The challenge was that
                regular link styling would leave the copy way too busy. To solve
                for this, we made each link look super close to regular text so
                that the linking isn't distracting. That way readers that are
                puzzled by a term, who might be looking at it more closely
                anyways, will be able to click through and learn more, and other
                readers won't be distracted by the link styling.
              </p>
              <p>
                I'd love to hear any thoughts or questions about either the
                content or the UI! I'll be here all day to respond. Also happy
                to answer random questions related to startup law.
              </p>
              <p>Thanks :)</p>
            </div>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
