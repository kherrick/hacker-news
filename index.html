<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37476588">
          <h3>
            <a
              class="item"
              href="https://martypc.blogspot.com/2023/09/hacking-book8088-for-better-accuracy.html"
              >Hacking the Book8088 for better accuracy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-12 @ 03:05:04</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37476588"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37476399">
          <h3>
            <a class="item" href="https://www.scottscheper.com/niche-dev"
              >Don't "find" your niche, "develop" it</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-12 @ 02:29:22</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37476399"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37475737">
          <h3>
            <a class="item" href="https://padlet.jobs"
              >Padlet (YC W13) is hiring in Singapore and San Francisco</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-12 @ 01:01:17</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37475257">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=pxPEdUFdayA"
              >Have I Been Pwned? [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-11 @ 23:54:48</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37475257"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37474904">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/2023/09/11/hot-chips-2023-arms-neoverse-v2/"
              >Armâ€™s Neoverse V2</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-11 @ 23:06:33</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37474904"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37474780">
          <h3>
            <a
              class="item"
              href="https://www.dualshockers.com/neopets-is-still-active-2023/"
              >Neopets is still around</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-11 @ 22:52:49</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37474780"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37474601">
          <h3>
            <a
              class="item"
              href="https://www.openssl.org/blog/blog/2023/09/11/eol-111/"
              >OpenSSL 1.1.1 End of Life</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-11 @ 22:33:37</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37474601"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37471417">
          <h3>
            <a
              class="item"
              href="https://opensecuritytraining.info/AdvancedX86-VTX.html"
              >Advanced x86: Virtualization with Intel VT-x</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-11 @ 18:25:02</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37471417"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37471321">
          <h3>
            <a
              class="item"
              href="https://www.bigmessowires.com/2023/09/09/mac-rom-inator-ii-restock-and-partnerships/"
              >Mac ROM-Inator II Restock and Partnerships</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-11 @ 18:18:37</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37471321"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37471149">
          <h3>
            <a
              class="item"
              href="https://www.massicotte.org/reading-bug-reports"
              >How to read bug reports (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-11 @ 18:08:06</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37471149"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37470801">
          <h3>
            <a
              class="item"
              href="https://www.casino.org/news/mgm-resorts-suffers-cybersecurity-attack-system-outage-reported/"
              >MGM is down, cybersecurity attack ongoing</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-11 @ 17:44:17</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37470801"
                  >Comments</a
                ><span class="descendants">: 89</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37470611">
          <h3>
            <a class="item" href="https://antimatter15.com/splat/"
              >Show HN: Real-Time 3D Gaussian Splatting in WebGL</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-11 @ 17:31:50</span
              ><span class="points-container"
                >Points: <span class="points">217</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37470611"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37470318">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=37470318"
              >Ask HN: Why did Visual Basic die?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-11 @ 17:12:56</span
              ><span class="points-container"
                >Points: <span class="points">307</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37470318"
                  >Comments</a
                ><span class="descendants">: 391</span></span
              >
            </h4>
            <div class="text">
              <p>
                Now, I'm no fan of Microsoft products but, I have yet to find a
                tool that can allow me to be as productive in so short a time as
                Visual Basic. Yet I can't help wondering what problems it had
                that caused them to abandon it? Moreover, why hasn't someone
                come out with a solid replacement?
              </p>
            </div>
          </section>
        </section>
        <section id="37470285">
          <h3>
            <a class="item" href="http://phylactery.org/antimirov/"
              >Calculate the difference and intersection of any two regexes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-11 @ 17:10:06</span
              ><span class="points-container"
                >Points: <span class="points">278</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37470285"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37470132">
          <h3>
            <a
              class="item"
              href="http://disagreeableme.blogspot.com/2023/05/a-multi-level-view-of-llm-intentionality.html"
              >A Multi-Level View of LLM Intentionality</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-11 @ 16:59:15</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37470132"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37469920">
          <h3>
            <a
              class="item"
              href="https://news.ucsb.edu/2023/021198/wifi-can-read-through-walls"
              >WiFi can read through walls</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-11 @ 16:45:09</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37469920"
                  >Comments</a
                ><span class="descendants">: 148</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37469849">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/dartmouth-ai-workshop"
              >The meeting of the minds that launched AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-11 @ 16:40:24</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37469849"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37468342">
          <h3>
            <a
              class="item"
              href="https://www.nasa.gov/goddard/2023/webb-discovers-methane-carbon-dioxide-in-atmosphere-of-k2-18b/"
              >Webb Discovers Methane, Carbon Dioxide in Atmosphere of K2-18B</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-11 @ 15:04:02</span
              ><span class="points-container"
                >Points: <span class="points">210</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37468342"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37468031">
          <h3>
            <a class="item" href="https://felixk15.github.io/posts/c_ocoa/"
              >Develop with Cocoa for Apple devices without using Objective-C</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-11 @ 14:44:08</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37468031"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37466302">
          <h3>
            <a class="item" href="https://comsci.blog/posts/intuitive-harris"
              >Intuitively Understanding Harris Corner Detector</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-11 @ 12:35:54</span
              ><span class="points-container"
                >Points: <span class="points">166</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37466302"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37466027">
          <h3>
            <a
              class="item"
              href="https://marhamilresearch4.blob.core.windows.net/gutenberg-public/Website/index.html"
              >The Project Gutenberg Open Audiobook Collection</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-11 @ 12:06:28</span
              ><span class="points-container"
                >Points: <span class="points">343</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37466027"
                  >Comments</a
                ><span class="descendants">: 142</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37465852">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/the-biggest-smallest-triangle-just-got-smaller-20230908/"
              >New upper bound found for the Heilbronn triangle problem</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-11 @ 11:49:09</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37465852"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37465427">
          <h3>
            <a class="item" href="https://ntietz.com/blog/how-i-debug-2023/"
              >A systematic approach to debugging</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-11 @ 10:58:37</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37465427"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37465086">
          <h3>
            <a
              class="item"
              href="https://twitter.com/lauriewired/status/1700982575291142594"
              >The SHA256 for this sentence begins with: one, eight, two, a,
              seven, c and nine.</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-11 @ 10:08:50</span
              ><span class="points-container"
                >Points: <span class="points">244</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37465086"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37464668">
          <h3>
            <a
              class="item"
              href="https://utcc.utoronto.ca/~cks/space/blog/unix/BourneShellObscureErrorRoots"
              >The roots of an obscure Bourne shell error message</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-11 @ 09:05:37</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37464668"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37463523">
          <h3>
            <a class="item" href="https://pinouts.org/"
              >The Pinouts Book: Pinout functions for 130 commonly used
              components</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-11 @ 06:14:35</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37463523"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37461695">
          <h3>
            <a class="item" href="https://jameshaydon.github.io/nats-fail/"
              >UK air traffic control meltdown</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-11 @ 01:08:16</span
              ><span class="points-container"
                >Points: <span class="points">722</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37461695"
                  >Comments</a
                ><span class="descendants">: 340</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37461632">
          <h3>
            <a
              class="item"
              href="https://statmodeling.stat.columbia.edu/wp-content/uploads/2022/12/HonestHypothesisTestingNonStandardErrors.pdf"
              >Non-Standard Errors [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-11 @ 00:58:51</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37461632"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37452322">
          <h3>
            <a
              class="item"
              href="https://adamj.eu/tech/2023/09/07/introducing-flake8-logging/"
              >Flake8-Logging</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-10 @ 02:22:44</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37452322"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37444683">
          <h3>
            <a
              class="item"
              href="https://github.com/nevesnunes/ghidra-plays-mario"
              >Show HN: Ghidra Plays Mario</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-09 @ 12:42:31</span
              ><span class="points-container"
                >Points: <span class="points">188</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37444683"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
            <div class="text">
              <p>
                Context: Ghidra is used for reverse engineering binary
                executables, complementing the usual disassembly view with
                function decompilation. Each supported architecture has a SLEIGH
                specification, which provides semantics for parsing and
                emulating instructions, not unlike the dispatch handlers you
                would find in interpreters written for console emulators.
              </p>
              <p>
                Emulator devs have long had extensive test ROMs for popular
                consoles, but Ghidra only provides CPU emulation, so it can't
                run them without additional setup. What I did here is bridge the
                gap: by modifying a console emulator to instead delegate CPU
                execution to Ghidra, we can now use these same ROMs to validate
                Ghidra processor modules.
              </p>
              <p>
                Previously [1], I went with a trace log diffing approach, where
                any hardware specific behaviour that affected CPU execution was
                also encoded in trace logs. However, it required writing
                hardware specific logic, and is still not complete. With the
                delegation approach, most of this effort is avoided, since it's
                easier to hook and delegate memory accesses.
              </p>
              <p>
                I plan on continuing research in this space and generalizing my
                approaches, since it shows potencial for complementing existing
                test coverage provided by pcodetest. If a simple architecture
                like 6502 had a few bugs, who knows how many are in more complex
                architectures! I wasn't able to find similar attempts (outside
                of diffing and coverage analysis from trace logs), please let me
                know if I missed something, and any suggestions for
                improvements.
              </p>
              <p>
                [1]:
                <a
                  href="https://github.com/nevesnunes/ghidra-tlcs900h#emulation"
                  >https://github.com/nevesnunes/ghidra-tlcs900h#emulation</a
                >
              </p>
            </div>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
