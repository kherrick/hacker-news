<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40371785">
          <h3>
            <a
              class="item"
              href="https://thebulletin.org/2024/05/a-plague-comes-before-the-fall-lessons-from-roman-history/"
              >A 'plague' comes before the fall: lessons from Roman history</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 20:11:55</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40371785"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40371683">
          <h3>
            <a
              class="item"
              href="https://www.haiku-os.org/blog/waddlesplash/2024-05-14-haiku_activity_contract_report_april_2024/"
              >Haiku Activity and Contract Report, April 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 20:03:45</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40371683"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40371595">
          <h3>
            <a class="item" href="https://usemumble.neocities.org/"
              >Stop Using Discord</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 19:55:24</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40371595"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40371401">
          <h3>
            <a
              class="item"
              href="https://developers.googleblog.com/en/project-gameface-launches-on-android/"
              >Project Gameface Launches on Android</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 19:39:28</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40371401"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40371237">
          <h3>
            <a
              class="item"
              href="https://blog.roboflow.com/paligemma-multimodal-vision/"
              >PaliGemma: Open-Source Multimodal Model by Google</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 19:24:47</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40371237"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40370613">
          <h3>
            <a
              class="item"
              href="https://www.vldb.org/pvldb/vol17/p148-zeng.pdf"
              >An Empirical Evaluation of Columnar Storage Formats [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 18:29:36</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40370613"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40369668">
          <h3>
            <a
              class="item"
              href="https://blog.google/products/android/android-theft-protection/"
              >Google Blog: Android's theft protection features keep your device
              and data safe</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 17:12:05</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40369668"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40369524">
          <h3>
            <a
              class="item"
              href="https://www.ashbyhq.com/careers?utm_source=hn&amp;ashby_jid=933570bc-a3d6-4fcc-991d-dc399c53a58a"
              >Ashby (YC W19) Is Hiring Technical EMs Who Love Coaching</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 17:00:50</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40369467">
          <h3>
            <a
              class="item"
              href="https://jepsen.io/analyses/datomic-pro-1.0.7075"
              >Jepsen: Datomic Pro 1.0.7075</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 16:57:30</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40369467"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40369319">
          <h3>
            <a class="item" href="https://github.com/reworkd/tarsier"
              >Show HN: Tarsier – Vision utilities for web interaction agents</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 16:46:15</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40369319"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
            <div class="text">
              <p>
                Over the course of experimenting with pruned HTML, accessibility
                trees, and other perception systems for web agents, we've
                iterated on Tarsier's components to maximize downstream
                agent/codegen performance.
              </p>
              <p>Here's the Tarsier pipeline in a nutshell:</p>
              <p>
                1. tag interactable elements with IDs for the LLM to act upon
                &amp; grab a full-sized webpage screenshot
              </p>
              <p>
                2. for text-only LLMs, run OCR on the screenshot &amp; convert
                it to whitespace-structured text (this is the coolest part imo)
              </p>
              <p>
                3. map LLM intents back to actions on elements in the browser
                via an ID-to-XPath dict
              </p>
              <p>
                Humans interact with the web through visually-rendered pages,
                and agents should too. We run Tarsier in production for
                thousands of web data extraction agents a day at Reworkd (<a
                  href="https://reworkd.ai"
                  >https://reworkd.ai</a
                >).
              </p>
              <p>
                By the way, we're hiring backend/infra engineers with experience
                in compute-intensive distributed systems!
              </p>
              <p>
                <a href="https://reworkd.ai/careers"
                  >https://reworkd.ai/careers</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="40369226">
          <h3>
            <a
              class="item"
              href="https://news.mit.edu/2024/mit-researchers-discover-universes-oldest-stars-in-galactic-backyard-0514"
              >Three of the oldest stars in the universe found circling the
              Milky Way</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 16:40:30</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40369226"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40369021">
          <h3>
            <a
              class="item"
              href="https://www.dunlap.utoronto.ca/instrumentation/dragonfly/"
              >Dragonfly: An optical telescope built from an array of
              off-the-shelf Canon lens</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 16:24:03</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40369021"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40368509">
          <h3>
            <a
              class="item"
              href="https://www.statnews.com/2024/05/01/brain-biopsies-mount-sinai-fda-review/"
              >Brain biopsies on 'vulnerable' patients at Mt Sinai set off alarm
              bells at FDA</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 15:48:39</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40368509"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40368016">
          <h3>
            <a
              class="item"
              href="https://computerhistory.org/blog/adobe-photoshop-source-code/"
              >Adobe Photoshop Source Code (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 15:12:15</span
              ><span class="points-container"
                >Points: <span class="points">327</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40368016"
                  >Comments</a
                ><span class="descendants">: 128</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40368008">
          <h3>
            <a class="item" href="https://www.hidden-mirrors.com"
              >Show HN: I wrote a symmetry game with a daily puzzle</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 15:11:20</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40368008"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
            <div class="text">
              <p>
                The game is based on a small region of tiles in a grid that is
                mirrored, modified, and mirrored again. It’s based on a novel
                phenomenon I noticed where, once these mutations happen a few
                times, the original region can be hard to recognize. You have a
                feeling there are symmetries in the image, but they are just out
                of grasp. Going further, if only part of the region is visible,
                such as mirroring off the edge of the board, it adds to the
                feeling and it becomes a satisfying puzzle to solve.
              </p>
              <p>
                I originally published this on the app stores, but after
                spending some money on marketing, I didn’t have line of sight to
                something people would pay for. I had built it around a hosted
                level API to tweak levels between version releases, making it
                prone to software rot over a few years. SSL certs would expire,
                credit cards would expire, App Store agreements need to be
                renewed, etc.. Without a continual drip of effort I wasn’t
                motivated to put in, it defaulted to broken.
              </p>
              <p>
                With that software rot in mind, and hoping to make something
                that would be around for a while for my friends and family to
                play, I started making a web-only, client-side only version.
                Still prone to rot, but not nearly as many moving pieces. It’s
                missing some of the polish of the original and the puzzles
                aren't hand curated with a graduating difficulty, but it’s
                playable on many modern devices. The generated puzzles are good
                ~75% of the time. I’m still working out how to detect the dud
                puzzles- they are playable, but not fun. I’ve got ideas on what
                defines a “good” puzzle, but haven’t formalized them into a
                fitness function yet.
              </p>
              <p>
                One other note– while there are almost definitely UI bugs
                (please report!), if it says the puzzle can be solved in X taps
                &amp; flips, it can. Those numbers are derived from how the
                puzzle itself renders, so it’s (thankfully) not prone to
                producing impossible to solve puzzles. Merely ones that may
                appear so at first-- hence the name.
              </p>
              <p>
                Today’s puzzle is a good difficulty to start with, a new one
                generates daily at midnight EST. There's no cookie or tracking,
                so let me know if you're playing!
              </p>
            </div>
          </section>
        </section>
        <section id="40367488">
          <h3>
            <a class="item" href="https://www.inboxpurge.com/"
              >Show HN: I made a Chrome extension to clean up your Gmail inbox
              locally</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 14:33:32</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40367488"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
            <div class="text">
              <p>
                My motivation for building this was to address the trouble of
                mass unsubscribing from unwanted emails and deleting bulk emails
                while ensuring privacy and control over the process. With this
                Chrome extension, emails are not sent to any external servers.
                All calls to the Gmail API happen locally on your device.
              </p>
              <p>Feedback and suggestions are welcome!</p>
            </div>
          </section>
        </section>
        <section id="40367331">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/newsroom/2024/05/apple-announces-new-accessibility-features-including-eye-tracking/"
              >Apple announces new accessibility features, including Eye
              Tracking</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 14:22:05</span
              ><span class="points-container"
                >Points: <span class="points">170</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40367331"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40367090">
          <h3>
            <a class="item" href="https://github.com/quarylabs/quary"
              >Show HN: Open-source BI and analytics for engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 14:02:35</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40367090"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
            <div class="text">
              <a href="https://quary.dev">https://quary.dev</a>), an
              engineer-first BI/analytics product. You can find our repo at
              <a href="https://github.com/quarylabs/quary"
                >https://github.com/quarylabs/quary</a
              >
              and our website at
              <a href="https://www.quary.dev/">https://www.quary.dev/</a>.
              There’s a demo video here:
              <a href="https://www.youtube.com/watch?v=o3hO65_lkGU"
                >https://www.youtube.com/watch?v=o3hO65_lkGU</a
              >
              <p>
                As engineers who have worked on data at startups and Amazon, we
                were frustrated by self-serve BI tools. They seemed dumbed down
                and they always required us to abandon our local dev tools we
                know and love (e.g. copilot, git). For us and for everyone we
                speak to, they end up being a mess.
              </p>
              <p>
                Based on this, we decided there was a need for engineer-oriented
                BI and analytics software.
              </p>
              <p>
                Quary solves these pain points by bringing standard software
                practices (version control, testing, refactoring, ci/cd,
                open-source, etc.) to the BI and analytics workflow.
              </p>
              <p>
                We integrate with many databases, but we’re showcasing our slick
                Supabase integration, because it: (1) keeps your data safe by
                running on your machine without data flowing through our
                servers; and (2) enables you to quickly build an analytics layer
                on top of your Supabase Postgres instances. Check out our
                Supabase guide:
                <a href="https://www.quary.dev/docs/quickstart-supabase"
                  >https://www.quary.dev/docs/quickstart-supabase</a
                >
              </p>
              <p>
                What we’re launching today is open source under the Apache 2.0
                license. We plan to keep the developer core open source and add
                paid features like a web platform to easily share data models
                (per-seat pricing), and an orchestration engine to materialize
                your data models.
              </p>
              <p>
                Please try Quary at
                <a href="https://quary.dev">https://quary.dev</a> and let us
                know what you think! We're excited to put the power of BI and
                analytics into the hands of engineers.
              </p>
            </div>
          </section>
        </section>
        <section id="40366443">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/society/article/2024/may/15/proteins-blood-cancer-warning-seven-years-study"
              >Proteins in blood could provide early cancer warning 'by more
              than seven years'</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 13:11:08</span
              ><span class="points-container"
                >Points: <span class="points">231</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40366443"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40366323">
          <h3>
            <a
              class="item"
              href="https://plbrault.com/blog-posts/i-coded-something-dumb-and-im-proud-of-it-en/"
              >I coded something dumb and I'm proud of it</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 12:58:46</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40366323"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40366204">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/video-games/nearly-all-nintendo-64-games-can-now-be-recompiled-into-native-pc-ports-to-add-proper-ray-tracing-ultrawide-high-fps-and-more"
              >Nearly all Nintendo 64 games can now be recompiled into native PC
              ports</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 12:48:19</span
              ><span class="points-container"
                >Points: <span class="points">247</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40366204"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40366062">
          <h3>
            <a
              class="item"
              href="https://www.londonstockexchange.com/news-article/market-news/expected-intention-to-float/16470316"
              >Raspberry Pi Ltd is considering an IPO</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 12:32:14</span
              ><span class="points-container"
                >Points: <span class="points">306</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40366062"
                  >Comments</a
                ><span class="descendants">: 262</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40363744">
          <h3>
            <a
              class="item"
              href="https://formal.land/blog/2024/04/26/translation-core-alloc-crates"
              >Translation of Rust's core and alloc crates to Coq for formal
              verification</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 06:32:18</span
              ><span class="points-container"
                >Points: <span class="points">315</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40363744"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40363704">
          <h3>
            <a class="item" href="https://ha.cking.ch/s8_data_line_locator/"
              >A low budget consumer hardware espionage implant (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 06:24:02</span
              ><span class="points-container"
                >Points: <span class="points">304</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40363704"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40358041">
          <h3>
            <a class="item" href="https://deepmind.google/technologies/veo/"
              >Veo</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-14 @ 17:58:26</span
              ><span class="points-container"
                >Points: <span class="points">1608</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40358041"
                  >Comments</a
                ><span class="descendants">: 458</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40353874">
          <h3>
            <a
              class="item"
              href="https://www.ams.org/notices/199612/pomerance.pdf"
              >A Tale of Two Sieves (1996) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-14 @ 11:10:17</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40353874"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40353694">
          <h3>
            <a
              class="item"
              href="https://blog.can.ac/2021/03/22/speculating-x86-64-isa-with-one-weird-trick/"
              >Speculating the entire x86-64 instruction set in seconds
              (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-14 @ 10:42:03</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40353694"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40353557">
          <h3>
            <a
              class="item"
              href="https://www.carlos-menezes.com/post/branded-types"
              >Branded types for TypeScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-14 @ 10:21:15</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40353557"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40352472">
          <h3>
            <a
              class="item"
              href="https://causal.app/blog/forecasting-with-uncertainty"
              >The Flaw of Averages (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-14 @ 07:14:36</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40352472"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40342105">
          <h3>
            <a
              class="item"
              href="http://www.mtome.com/Publications/PNLA/prolog-digital.pdf"
              >Prolog and Natural-Language Analysis (1987) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-13 @ 11:41:11</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40342105"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
