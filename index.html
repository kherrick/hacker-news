<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39538978">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2024-02-28/teleperformance-sinks-as-klarna-fuels-worries-over-impact-of-ai"
              >Call-Center Firm Sinks on Klarna Claims AI Is Doing Agents'
              Jobs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 15:14:38</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39538978"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39538800">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=qw4DseiPu7E"
              >Orbital reentry from 17000mph looks like dropping out of
              hyperspace [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 15:01:37</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39538800"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39538618">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=u2WciH6rAFg"
              >Leaving Everything Behind For Elixir [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 14:47:49</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39538618"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39538601">
          <h3>
            <a class="item" href="https://roe.dev/blog/funding"
              >How I'm funded</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 14:46:44</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39538601"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39538550">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2024/02/wear-os-hybrid-design-has-two-oses-two-cpus-100-hour-battery-life/"
              >Wear OS "Hybrid" design has two OSes, two CPUs, "100 hour"
              battery life</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 14:42:15</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39538550"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39538526">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/pc-components/cpus/intel-puts-1nm-process-10a-on-the-roadmap-for-2027-aiming-for-fully-ai-automated-factories-with-cobots"
              >Intel puts 1nm process (10A) on the roadmap for 2027</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 14:40:23</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39538526"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39538425">
          <h3>
            <a
              class="item"
              href="https://www.space.com/alien-technosignatures-exoplanet-mathematically-perfect-orbits"
              >'Mathematically perfect' star system being investigated for
              potential alien tech</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 14:31:55</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39538425"
                  >Comments</a
                ><span class="descendants">: 112</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39538335">
          <h3>
            <a class="item" href="https://pgs.sh"
              >Show HN: Pgs.sh â€“ A zero-install static site hosting service for
              hackers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 14:25:51</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39538335"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39537735">
          <h3>
            <a
              class="item"
              href="https://lore.kernel.org/lkml/20240227215146.46487-1-daniel.almeida@collabora.com/"
              >Rewrite the VP9 codec library in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 13:39:37</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39537735"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39537570">
          <h3>
            <a class="item" href="https://vatsim.net/"
              >VATSIM: The International Online Aviation Network</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 13:26:54</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39537570"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39537448">
          <h3>
            <a class="item" href="https://www.sympy.org/en/index.html"
              >SymPy: Symbolic Mathematics in Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 13:17:28</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39537448"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39536824">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2024/02/28/eu_microsoft_mistral/"
              >Europe probes Microsoft's â‚¬15M stake in AI upstart Mistral</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 12:05:44</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39536824"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39535969">
          <h3>
            <a class="item" href="https://github.com/cloudflare/pingora"
              >Pingora: build fast, reliable and programmable networked
              systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 09:56:16</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39535969"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39535800">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2402.17764"
              >The Era of 1-bit LLMs: ternary parameters for cost-effective
              computing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 09:28:43</span
              ><span class="points-container"
                >Points: <span class="points">271</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39535800"
                  >Comments</a
                ><span class="descendants">: 155</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39535106">
          <h3>
            <a class="item" href="https://trenchbroom.github.io/"
              >TrenchBroom: A cross platform level editor for Quake-engine based
              games</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 07:35:22</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39535106"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39534362">
          <h3>
            <a
              class="item"
              href="https://mattlakeman.org/2020/11/08/the-blind-alone-and-confused-for-24-hours-challenge/"
              >Blind, Alone, and Confused for 24 Hours Challenge (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 05:29:33</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39534362"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39533800">
          <h3>
            <a class="item" href="https://broadbandbreakfast.com/untitled-12/"
              >New FCC Broadband Standards Should Consider Latency</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 03:57:47</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39533800"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39532650">
          <h3>
            <a class="item" href="https://www.gobolinux.org/">GoboLinux</a>
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 01:15:56</span
              ><span class="points-container"
                >Points: <span class="points">225</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39532650"
                  >Comments</a
                ><span class="descendants">: 157</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39532367">
          <h3>
            <a class="item" href="https://recurse.chat/"
              >Show HN: I made an app to use local AI as daily driver</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 00:40:00</span
              ><span class="points-container"
                >Points: <span class="points">446</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39532367"
                  >Comments</a
                ><span class="descendants">: 187</span></span
              >
            </h4>
            <div class="text">
              <p>
                Excited to share a macOS app I've been working on:
                <a href="https://recurse.chat/">https://recurse.chat/</a> for
                chatting with local AI. While it's amazing that you can run AI
                models locally quite easily these days (through llama.cpp /
                llamafile / ollama / llm CLI etc.), I missed feature complete
                chat interfaces. Tools like LMStudio are super powerful, but
                there's a learning curve to it. I'd like to hit a middleground
                of simplicity and customizability for advanced users.
              </p>
              <p>Here's what separates RecurseChat out from similar apps:</p>
              <p>
                - UX designed for you to use local AI as a daily driver. Zero
                config setup, supports multi-modal chat, chat with multiple
                models in the same session, link your own gguf file.
              </p>
              <p>
                - Import ChatGPT history. This is probably my favorite feature.
                Import your hundreds of messages, search them and even
                continuing previous chats using local AI offline.
              </p>
              <p>
                - Full text search. Search for hundreds of messages and see
                results instantly.
              </p>
              <p>- Private and capable of working completely offline.</p>
              <p>
                Thanks to the amazing work of @ggerganov on llama.cpp which made
                this possible. If there is anything that you wish to exist in an
                ideal local AI app, I'd love to hear about it.
              </p>
            </div>
          </section>
        </section>
        <section id="39531536">
          <h3>
            <a class="item" href="https://testcontainers.com/"
              >Testcontainers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-27 @ 23:15:57</span
              ><span class="points-container"
                >Points: <span class="points">555</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39531536"
                  >Comments</a
                ><span class="descendants">: 218</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39526057">
          <h3>
            <a class="item" href="https://ciechanow.ski/airfoil/">Airfoil</a>
          </h3>
          <section>
            <h4>
              <span>2024-02-27 @ 16:32:49</span
              ><span class="points-container"
                >Points: <span class="points">2311</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39526057"
                  >Comments</a
                ><span class="descendants">: 270</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39522801">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/science/2024/feb/27/smallest-fish-sounds-loud-danionella-cerebrum"
              >One of worldâ€™s smallest fish found to make sound as loud as a
              gunshot</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-27 @ 11:27:33</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39522801"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39522734">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39522734"
              >Ask HN: Slow thinkers, how do you compensate for your lack of
              quick-wittedness?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-27 @ 11:16:52</span
              ><span class="points-container"
                >Points: <span class="points">202</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39522734"
                  >Comments</a
                ><span class="descendants">: 131</span></span
              >
            </h4>
            <div class="text">
              <p>
                E.g. I found I'm great at analysis or putting together elaborate
                argument but if I'm in a situation where I need to make a quick
                decision or get in actual argument I lose all of that capacity
                and usually drop to the level of IQ 85 if I/m to be judged by
                the outcomes. Nevertheless a slow thinker does have that
                potential there he's jut not able to tap into it if he falls
                into my category. In martial arts, rehearsing overcomes a lot of
                that - what has worked in real life for you?
              </p>
            </div>
          </section>
        </section>
        <section id="39522464">
          <h3>
            <a
              class="item"
              href="https://www.anandtech.com/show/21277/micron-kicks-off-production-of-hbm3e-memory"
              >Micron Kicks Off Production of HBM3E Memory</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-27 @ 10:37:30</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39522464"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39522268">
          <h3>
            <a class="item" href="https://herbertlui.net/montage-fallacy/"
              >Montage Fallacy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-27 @ 10:06:05</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39522268"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39521568">
          <h3>
            <a
              class="item"
              href="https://mmapped.blog/posts/25-domain-types.html"
              >Universal Domain Types</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-27 @ 08:30:17</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39521568"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39518535">
          <h3>
            <a
              class="item"
              href="https://daily.jstor.org/the-marvelous-automata-of-antiquity/"
              >The Marvelous Automata of Antiquity (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-27 @ 00:22:45</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39518535"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39518329">
          <h3>
            <a
              class="item"
              href="http://python-history.blogspot.com/2010/08/why-pythons-integer-division-floors.html"
              >Why Python's Integer Division Floors (2010)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-26 @ 23:52:07</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39518329"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39517635">
          <h3>
            <a class="item" href="https://www.mdpi.com/2079-9292/13/5/854"
              >MeMPA: A Memory Mapped M-SIMD Co-Processor to Cope with the
              Memory Wall Issue</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-26 @ 22:40:44</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39517635"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39512912">
          <h3>
            <a class="item" href="https://speakz.ai"
              >Show HN: AI dub tool I made to watch foreign language videos with
              my 7-year-old</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-26 @ 16:08:45</span
              ><span class="points-container"
                >Points: <span class="points">307</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39512912"
                  >Comments</a
                ><span class="descendants">: 138</span></span
              >
            </h4>
            <div class="text">
              <p>
                I love watching YouTube with my 7-year-old daughter.
                Unfortunately, the best stuff is often in English (we're
                German). So I made an AI tool that translates videos directly,
                using the original voices. All other sounds, as well as
                background music, are preserved, too.
              </p>
              <p>
                Turns out that it works for many other language pairs, too. So
                far, it can create dubs in English, Mandarin Chinese, Spanish,
                Arabic, French, Russian, German, Italian, Korean, Polish and
                Dutch.
              </p>
              <p>
                The main challenge in building this was to get the balance right
                between translating the original meaning and getting the timing
                right. Especially for language pairs like English -&gt; German,
                where the target ist often longer than the source ("bat" -&gt;
                "Fle-der-maus", "speed" -&gt; "Ge-schwin-dig-keit").
              </p>
              <p>Let me know what you think! :)</p>
            </div>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
