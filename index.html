<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38925301">
          <h3>
            <a
              class="item"
              href="https://apolloacademy.com/the-magnitude-of-the-ai-bubble/"
              >The Magnitude of the AI Bubble</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 12:22:08</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38925301"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38925125">
          <h3>
            <a
              class="item"
              href="https://jobs.lever.co/FinleyTechnologies/f3b6fed8-795f-433e-a3f8-7fdec5e85745"
              >Finley (YC W21) Is Hiring for Business Operations and Strategy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 12:01:08</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38924310">
          <h3>
            <a
              class="item"
              href="https://tratt.net/laurie/blog/2022/practising_programming.html"
              >Practising Programming</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 10:07:05</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38924310"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38924300">
          <h3>
            <a
              class="item"
              href="https://github.com/webcompat/web-bugs/issues/131916"
              >Google breaks search for Firefox users because of bad UA string
              sniffing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 10:04:49</span
              ><span class="points-container"
                >Points: <span class="points">181</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38924300"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38923969">
          <h3>
            <a class="item" href="https://calv.info/heat-pumps"
              >Heat pumps, more than you wanted to know (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 09:18:53</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38923969"
                  >Comments</a
                ><span class="descendants">: 141</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38923741">
          <h3>
            <a
              class="item"
              href="https://tonybaloney.github.io/posts/python-gets-a-jit.html"
              >Python 3.13 Gets a JIT</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 08:35:58</span
              ><span class="points-container"
                >Points: <span class="points">356</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38923741"
                  >Comments</a
                ><span class="descendants">: 181</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38923033">
          <h3>
            <a
              class="item"
              href="https://www.ismailzai.com/blog/picking-the-widevine-locks"
              >Picking the Widevine Locks: Acquiring and Using an L3 CDM</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 06:19:50</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38923033"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38922657">
          <h3>
            <a class="item" href="https://www.darpa.mil/news-events/2024-01-03"
              >DARPA Moves Forward on X-65: Plane with no moving control
              surfaces</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 05:22:40</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38922657"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38921668">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2401.04088"
              >Mixtral 8x7B: A sparse Mixture of Experts language model</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 02:53:06</span
              ><span class="points-container"
                >Points: <span class="points">302</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38921668"
                  >Comments</a
                ><span class="descendants">: 111</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38921518">
          <h3>
            <a class="item" href="https://github.com/risolvipro/playdate-mode7"
              >Mode7 Graphics Library for Playdate</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 02:31:37</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38921518"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38921441">
          <h3>
            <a
              class="item"
              href="https://physics.stackexchange.com/questions/101913/why-does-a-remote-car-key-work-when-held-to-your-head-body"
              >Why does holding a key fob to your head increase its range?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 02:23:15</span
              ><span class="points-container"
                >Points: <span class="points">376</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38921441"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38921237">
          <h3>
            <a
              class="item"
              href="https://nee.lv/2021/02/28/How-I-cut-GTA-Online-loading-times-by-70/"
              >I cut GTA Online loading times by 70% (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 01:55:50</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38921237"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38920738">
          <h3>
            <a
              class="item"
              href="https://9to5mac.com/2023/11/03/macs-liquids-detected-in-usb-c-ports/"
              >Macs can now inform Apple if any liquids have been detected in
              the USB-C ports</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-09 @ 00:46:59</span
              ><span class="points-container"
                >Points: <span class="points">153</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38920738"
                  >Comments</a
                ><span class="descendants">: 249</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38920043">
          <h3><a class="item" href="https://pola.rs/">Polars</a></h3>
          <section>
            <h4>
              <span>2024-01-08 @ 23:32:54</span
              ><span class="points-container"
                >Points: <span class="points">758</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38920043"
                  >Comments</a
                ><span class="descendants">: 316</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38919884">
          <h3>
            <a class="item" href="https://openreview.net/forum?id=MGWsPGogLH"
              >Turing Complete Transformers: Two Transformers Are More Powerful
              Than One</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 23:20:21</span
              ><span class="points-container"
                >Points: <span class="points">172</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38919884"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38919862">
          <h3>
            <a class="item" href="https://www.openbsd.org/lyrics.html"
              >OpenBSD Release Songs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 23:18:24</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38919862"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38917820">
          <h3>
            <a
              class="item"
              href="https://theaircurrent.com/feed/dispatches/united-finds-loose-bolts-on-plug-doors-during-737-max-9-inspections/"
              >United finds loose bolts on plug doors during 737 Max 9
              inspections</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 20:43:37</span
              ><span class="points-container"
                >Points: <span class="points">459</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38917820"
                  >Comments</a
                ><span class="descendants">: 642</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38917749">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/cells-across-the-body-talk-to-each-other-about-aging-20240108/"
              >Cells across the body talk to each other about aging</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 20:37:54</span
              ><span class="points-container"
                >Points: <span class="points">223</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38917749"
                  >Comments</a
                ><span class="descendants">: 144</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38916663">
          <h3>
            <a class="item" href="https://www.cs.umd.edu/~ben/goldenrules.html"
              >Golden Rules of Interface Design (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 19:15:07</span
              ><span class="points-container"
                >Points: <span class="points">225</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38916663"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38916266">
          <h3>
            <a
              class="item"
              href="https://eligrey.com/blog/adtech-catalyzing-fraud/"
              >Unverified vanity URLs and interest tracking catalyze fraud
              online</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 18:46:17</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38916266"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38914764">
          <h3>
            <a
              class="item"
              href="https://www.crunchydata.com/blog/an-overview-of-distributed-postgresql-architectures"
              >An overview of distributed Postgres architectures</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 16:52:56</span
              ><span class="points-container"
                >Points: <span class="points">235</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38914764"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38912406">
          <h3>
            <a class="item" href="https://ktye.github.io/pdp11/index.html"
              >k on pdp11</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 14:31:26</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38912406"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38911407">
          <h3>
            <a
              class="item"
              href="https://semiengineering.com/money-pours-into-new-fabs-and-facilities/"
              >Money pours into new fabs and facilities</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 13:10:40</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38911407"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38911245">
          <h3>
            <a class="item" href="https://vmoldo.com/anamorfic-inserts/"
              >How to mod any lens for anamorphic bokeh</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-08 @ 12:53:16</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38911245"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38906330">
          <h3>
            <a
              class="item"
              href="https://liorpachter.wordpress.com/2014/12/30/the-two-cultures-of-mathematics-and-biology/"
              >The two cultures of mathematics and biology (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-07 @ 23:28:33</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38906330"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38905590">
          <h3>
            <a class="item" href="https://scientific.place/math-crossword/"
              >Show HN: I made an interactive math crossword puzzle with
              infinite levels</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-07 @ 21:59:21</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38905590"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
            <div class="text">
              <p>
                This game is all about making math a little more fun – users
                just drag and drop numbers to fill in the blanks and move on to
                the next level if they get it right.
              </p>
              <p>Let me know if face any issues or have any suggestions! :)</p>
            </div>
          </section>
        </section>
        <section id="38902042">
          <h3>
            <a class="item" href="https://github.com/quickwit-oss/quickwit"
              >Show HN: Quickwit – OSS Alternative to Elasticsearch, Splunk,
              Datadog</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-07 @ 15:35:39</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38902042"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
            <div class="text">
              <p>
                We started Quickwit 3 years ago with a POC, "Searching the web
                for under $1000/month" (see HN discussions [0]), with the goal
                of making a robust OSS alternative to Elasticsearch / Splunk /
                Datadog.
              </p>
              <p>
                We have reached a significant milestone with our latest release
                (0.7) [1], as we have witnessed users of the nightly version of
                Quickwit deploy clusters with hundreds of nodes, ingest hundreds
                of terabytes of data daily, and enjoy considerable cost savings.
              </p>
              <p>
                To give you a concrete example, one company is ingesting
                hundreds of terabytes of logs daily and migrating from
                Elasticsearch to Quickwit. They divided their compute costs by
                5x and storage costs by 2x while increasing retention from 3 to
                30 days. They also increased their durability, accuracy with
                exactly-once semantics thanks to the native Kafka support, and
                elasticity.
              </p>
              <p>
                The 0.7 release also brings better integrations with the
                Observability ecosystem: improvements of the
                Elasticsearch-compatible API and better support of OpenTelemetry
                standards, Grafana, and Jaeger.
              </p>
              <p>
                Of course, we still have a lot of work to be a fully-fledged
                observability engine, and we would love to get some feedback or
                suggestions.
              </p>
              <p>
                To give you a glance at our 2024 roadmap, we planned to focus on
                Kibana/OpenDashboard integration, metrics support, and
                pipe-based query language.
              </p>
              <p>
                [0] Searching the web for under $1000/month:
                <a href="https://news.ycombinator.com/item?id=27074481"
                  >https://news.ycombinator.com/item?id=27074481</a
                >
              </p>
              <p>
                [1] Release blog post:
                <a href="https://quickwit.io/blog/quickwit-0.7"
                  >https://quickwit.io/blog/quickwit-0.7</a
                >
              </p>
              <p>
                [2] Open Source Repo:
                <a href="https://github.com/quickwit-oss/quickwit"
                  >https://github.com/quickwit-oss/quickwit</a
                >
              </p>
              <p>
                [3] Home Page:
                <a href="https://quickwit.io">https://quickwit.io</a>
              </p>
            </div>
          </section>
        </section>
        <section id="38899922">
          <h3>
            <a
              class="item"
              href="https://newsletter.pnote.eu/p/simple-lasts-longer"
              >Simple Lasts Longer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-07 @ 09:57:01</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38899922"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38891286">
          <h3>
            <a
              class="item"
              href="https://www.instructables.com/An-Easy-to-Build-Real-Homemade-Computer-Z80-MBC2/"
              >An Easy to Build Real Homemade Computer: Z80-MBC2</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-06 @ 13:33:22</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38891286"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38890692">
          <h3>
            <a
              class="item"
              href="https://ggnotes.com/the-best-way-to-get-unstuck"
              >The best way to get unstuck</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-06 @ 11:55:27</span
              ><span class="points-container"
                >Points: <span class="points">177</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38890692"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
