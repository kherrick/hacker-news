<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39964402">
          <h3>
            <a
              class="item"
              href="https://www.msn.com/en-us/health/other/neurons-in-the-brain-appear-to-follow-a-distinct-mathematical-pattern/ar-AA1mhCzO"
              >Neurons in the Brain Appear to Follow a Distinct Mathematical
              Pattern</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 22:10:27</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39964402"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39963891">
          <h3>
            <a class="item" href="https://jobs.lever.co/buildzoom"
              >BuildZoom (better way to build custom homes) Is hiring a Growth
              Associate</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 21:02:00</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39963776">
          <h3>
            <a
              class="item"
              href="https://twitter.com/aviationbrk/status/1777036113565061618"
              >Boeing 737-800 makes emergency landing after its engine cowling
              detached</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 20:48:44</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39963776"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39963694">
          <h3>
            <a
              class="item"
              href="https://grist.org/science/us-landfills-emit-far-more-methane-than-previously-known/"
              >Landfills Leak More Planet-Baking Methane Than We Thought</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 20:40:08</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39963694"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39963058">
          <h3>
            <a
              class="item"
              href="https://bitheap.tech/why-is-software-quality-worse-than-a-decado-ago/"
              >Why is software quality worse than a decado ago</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 19:21:06</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39963058"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39962756">
          <h3>
            <a class="item" href="https://github.com/FascinatedBox/bonk"
              >Show HN: Bonk, a command-line tool for X11 window management</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 18:39:43</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39962756"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39962737">
          <h3>
            <a
              class="item"
              href="https://lareviewofbooks.org/article/the-bulgarian-computers-global-reach-on-victor-petrovs-balkan-cyberia/"
              >The Bulgarian Computer's Global Reach: On Victor Petrov's "Balkan
              Cyberia"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 18:37:55</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39962737"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39962415">
          <h3>
            <a class="item" href="https://www.flashnotesapp.com"
              >Show HN: Flash Notes – Flashcards for Your Notes, LLM, iOS/macOS
              Sync</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 17:54:31</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39962415"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <p>
                So I've started experimenting with flashcards derived from
                structured notes. Writing the 1st MVP was fast, but
                productionising it was way harder. Content synchronisation when
                the user can work from tube/plane and use multiple devices and
                content is text is… not trivial. So I had to learn about OT
                (Operational Transformation) and CRDT (Conflict-Free Replicated
                Data Type), and even implemented a few iterations of CRDT in
                Swift. This was intellectually rewarding, but the app was not
                progressing. Also, when you have both app data model and CRDT in
                your head, you start to over-optimize - you are leaking
                abstractions. Thankfully, the CRDT market nowadays is pretty
                mature; Automerge is production-ready, and automerge-swift comes
                with a nice abstraction. I strongly believe offline-first apps
                are the future/now.
              </p>
              <p>
                ChatGPT happened, and it felt like a perfect match for the app,
                as it's already text-focused. First, it was just to provide
                prompts for the cards, but when you turn the problem around, you
                realise that LLM is great for predicting other flashcards in the
                context of your note. So instead of downloading a premade
                flashcard deck, you start a new note, give it a title, and click
                generate. I still find it weird to watch but also mesmerising.
              </p>
              <p>
                Other features that I think are valuable: App data sits within
                your iCloud account until you use Generative AI (LLM).
                Hopefully, we will get an API from Apple soon.
              </p>
              <p>
                The Spaced Repetition that I've implemented is not really
                spaced. I wanted the app to adapt to the user. So it's focusing
                on sorting the card deck based on your recall and lets you
                practise as much as you want. I found this approach to work way
                better for me.
              </p>
              <p>Oh, it's multilingual with text-to-speech.</p>
              <p>
                Here we are; the 1st production-ready "MVP" is live. I'd love to
                hear your feedback.
              </p>
            </div>
          </section>
        </section>
        <section id="39962303">
          <h3>
            <a class="item" href="https://diffoscope.org/"
              >Diffoscope – In-depth comparison of files, archives, and
              directories</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 17:36:06</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39962303"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39962023">
          <h3>
            <a class="item" href="https://github.com/migueletto/PumpkinOS"
              >PumpkinOS, a Re-Implementation of PalmOS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 16:55:16</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39962023"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39961994">
          <h3>
            <a class="item" href="https://github.com/rpgp/rpgp"
              >Rpgp: Pure Rust implementation of OpenPGP</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 16:50:30</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39961994"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39961910">
          <h3>
            <a
              class="item"
              href="https://3quarksdaily.com/3quarksdaily/2020/10/what-john-von-neumann-really-did-at-los-alamos.html"
              >What John von Neumann Did at Los Alamos (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 16:42:04</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39961910"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39961245">
          <h3>
            <a
              class="item"
              href="https://retrocmp.de/hardware/greaseweazle/greaseweazle.htm"
              >Greaseweazle</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 15:06:42</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39961245"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39960788">
          <h3>
            <a
              class="item"
              href="https://daveon.design/adventures-making-vegemite.html"
              >Adventures Making Vegemite</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 13:55:02</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39960788"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39960717">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2404.02258"
              >Mixture-of-Depths: Dynamically allocating compute in
              transformers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 13:42:05</span
              ><span class="points-container"
                >Points: <span class="points">172</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39960717"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39960645">
          <h3>
            <a class="item" href="https://breckyunits.com/sleepWriting.html"
              >Blog posts, sorted by sleep</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 13:32:27</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39960645"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39960537">
          <h3>
            <a class="item" href="https://github.com/stackframe-projects/pgmock"
              >Show HN: I open-sourced the in-memory PostgreSQL I built at work
              for E2E tests</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 13:13:43</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39960537"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39960535">
          <h3>
            <a class="item" href="https://github.com/AmrDeveloper/ClangQL"
              >ClangQL: A tool to run SQL-like query on C/C++ Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 13:13:23</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39960535"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39960251">
          <h3>
            <a
              class="item"
              href="https://www.nasa.gov/missions/lro/nasas-lro-finds-photo-op-as-it-zips-past-skoreas-danuri-moon-orbiter/"
              >NASA's LRO Finds Photo Op as It Zips Past SKorea's Danuri Moon
              Orbiter</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 12:19:45</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39960251"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39960202">
          <h3>
            <a class="item" href="https://github.com/pldubouilh/alarm"
              >Fire alarm audio detection, using FFTs and Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 12:08:22</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39960202"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39960125">
          <h3>
            <a
              class="item"
              href="https://security.googleblog.com/2024/03/google-public-dnss-approach-to-fight.html"
              >Google Public DNS's approach to fight against cache poisoning
              attacks</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 11:46:55</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39960125"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39959946">
          <h3>
            <a
              class="item"
              href="https://retrocomputing.stackexchange.com/questions/29787/did-any-processor-implement-an-integer-square-root-instruction"
              >Did any processor implement an integer square root
              instruction?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 10:55:10</span
              ><span class="points-container"
                >Points: <span class="points">184</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39959946"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39959790">
          <h3>
            <a class="item" href="https://www.sbert.net/index.html"
              >SentenceTransformers: Python framework for sentence, text and
              image embeddings</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 10:23:51</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39959790"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39959543">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2404.02679"
              >Rendering string diagrams recursively [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 09:23:09</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39959543"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39959380">
          <h3>
            <a
              class="item"
              href="https://sourcegraph.com/blog/the-lifecycle-of-a-code-ai-completion"
              >The lifecycle of a code AI completion</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 08:55:03</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39959380"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39959368">
          <h3>
            <a
              class="item"
              href="https://eidel.io/how-to-found-a-company-in-germany-14-easy-steps-and-lots-of-pain/"
              >How to found a company in Germany: 14 "easy" steps and lots of
              pain</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-07 @ 08:51:20</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39959368"
                  >Comments</a
                ><span class="descendants">: 257</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39954993">
          <h3>
            <a
              class="item"
              href="https://www.infinitelymore.xyz/p/structuralism"
              >Structuralism as a Philosophy of Mathematics</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-06 @ 19:59:24</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39954993"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39952819">
          <h3>
            <a
              class="item"
              href="https://bkardell.com/blog/blessing-strings.html"
              >The Blessing of the Strings</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-06 @ 14:38:39</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39952819"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39947045">
          <h3>
            <a
              class="item"
              href="https://codewithkira.com/2024-04-04-state-of-clojure-ml.html"
              >Clojure's machine learning ecosystem</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-05 @ 20:49:14</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39947045"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39946763">
          <h3>
            <a class="item" href="https://opt-models.org/"
              >Opt-Models: Intro to Optimization Programming Using LEGOs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-05 @ 20:23:06</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39946763"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
