<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43438601">
          <h3>
            <a
              class="item"
              href="https://www.daemonology.net/blog/chunking-attacks.pdf"
              >Chunking Attacks on File Backup Services Using Content-Deﬁned
              Chunking [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-21 @ 17:30:34</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43438601"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43438206">
          <h3>
            <a class="item" href="https://www.bigscreenvr.com/"
              >Bigscreen Beyond 2</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-21 @ 17:03:27</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43438206"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43438192">
          <h3>
            <a class="item" href="https://mathup.xyz/"
              >Mathup: Easy MathML authoring tool with a quick to write
              syntax</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-21 @ 17:02:17</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43438192"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43438166">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=43438166"
              >GoGoGrandparent (YC S16) is hiring Back end Engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-21 @ 17:00:58</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
            <div class="text">
              <p>
                The positions: FULLY REMOTE | Full-time | US, UK, or able to
                work 4+ hours overlap with mainland US (UK time working hours
                also OK) | $100k to $160k (partially location-dependent)
              </p>
              <p>
                Build high-quality, robust engineering at the rarest of things -
                a Silicon Valley startup that is both wholesome AND profitable.
                We have 8-figure revenue, are YC-backed, and growing fast.
              </p>
              <p>
                Tech stack (<i>required): Back-end heavy (Node</i>, Typescript<i
                  >, MySQL</i
                >, REST*+GraphQL), front-end (Vue), deploy (AWS, Docker/K8s)
              </p>
              <p>Minimum 6 years experience (mostly Node/Vue)</p>
              <p>2-stage interview process.</p>
              <p>
                If you want to help older adults and people with disabilities,
                send your LinkedIn/CV to william@gogograndparent.com (keep it
                brief) or apply at
                <a
                  href="https://www.ycombinator.com/companies/gogograndparent/jobs"
                  >https://www.ycombinator.com/companies/gogograndparent/jobs</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="43436933">
          <h3>
            <a
              class="item"
              href="https://www.noemamag.com/the-cult-of-the-american-lawn/"
              >The Cult of the American Lawn</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-21 @ 15:38:13</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43436933"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43436894">
          <h3>
            <a class="item" href="https://github.com/Devolutions/IronRDP"
              >IronRDP: a Rust implementation of Microsoft's RDP protocol</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-21 @ 15:35:27</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43436894"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43436643">
          <h3>
            <a
              class="item"
              href="https://psycnet.apa.org/fulltext/2025-79126-001.html"
              >Police-Induced Confessions, 2.0: Risk Factors and
              Recommendations</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-21 @ 15:11:18</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43436643"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43435438">
          <h3>
            <a
              class="item"
              href="https://victorpoughon.github.io/torchlensmaker/"
              >Show HN: Torch Lens Maker – Differentiable Geometric Optics in
              PyTorch</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-21 @ 13:29:11</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43435438"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
            <div class="text">
              <p>
                Not only is PyTorch's autograd an amazing general purpose
                optimizer, but torch.nn (the neural network building blocks) can
                be used pretty much out of the box to model an optical system.
                This is because there is a strong analogy to be made between
                layers of a neural network, and optical elements in a so-called
                sequential optical system. So the magic is that we can stack
                lenses as if we were stacking Conv2D and ReLu layers and
                everything works out. Instead of Conv2D you have ray-surface
                collision detection, instead of ReLu you have the law of
                refraction. Designing lenses is surprisingly like training a
                neural network.
              </p>
              <p>
                Check out the docs for examples of using the API. My favorite
                one is the rainbow :)
                <a
                  href="https://victorpoughon.github.io/torchlensmaker/examples/rainbow"
                  >https://victorpoughon.github.io/torchlensmaker/examples/rain...</a
                >
              </p>
              <p>
                You should be able to `pip install torchlensmaker` to try it
                out, but I just set it up so let me know if there's any trouble.
              </p>
              <p>
                I was part of the Winter 1'24 batch at the Recurse Center (<a
                  href="https://www.recurse.com/"
                  >https://www.recurse.com/</a
                >) working on this project pretty much full time. I'm happy to
                talk about that experience too!
              </p>
            </div>
          </section>
        </section>
        <section id="43434910">
          <h3>
            <a class="item" href="https://umich-curly.github.io/DHAL/"
              >Legged Locomotion Meets Skateboarding</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-21 @ 12:38:20</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43434910"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43434730">
          <h3>
            <a
              class="item"
              href="https://tobloef.com/blog/wheel-reinventors-principles/"
              >Wheel Reinventor’s Principles (2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-21 @ 12:16:45</span
              ><span class="points-container"
                >Points: <span class="points">152</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43434730"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43434152">
          <h3>
            <a class="item" href="https://www.notetimeapp.com"
              >Notetime: Minimalistic notes where everything is timestamped</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-21 @ 10:58:28</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43434152"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43434093">
          <h3>
            <a
              class="item"
              href="https://kellblog.com/2015/03/08/career-development-what-it-really-means-to-be-a-manager-director-or-vp/"
              >Career Development: What It Means to Be a Manager, Director, or
              VP (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-21 @ 10:49:41</span
              ><span class="points-container"
                >Points: <span class="points">298</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43434093"
                  >Comments</a
                ><span class="descendants">: 153</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43433599">
          <h3>
            <a
              class="item"
              href="https://www.cs.utexas.edu/~EWD/transcriptions/EWD08xx/EWD831.html"
              >Numbering should start at zero (1982)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-21 @ 09:35:33</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43433599"
                  >Comments</a
                ><span class="descendants">: 173</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43432291">
          <h3>
            <a
              class="item"
              href="https://www.historytoday.com/archive/review/celts-modern-history-ian-stewart-review"
              >'The Celts: A Modern History' by Ian Stewart Review</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-21 @ 06:08:04</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43432291"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43431675">
          <h3>
            <a
              class="item"
              href="https://finance.yahoo.com/news/apple-shuffles-ai-executive-ranks-162500488.html"
              >Apple shuffles AI executive ranks in bid to turn around Siri</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-21 @ 04:01:00</span
              ><span class="points-container"
                >Points: <span class="points">241</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43431675"
                  >Comments</a
                ><span class="descendants">: 389</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43431567">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/2025/03/20/travel/london-heathrow-airport-shut-intl-hnk/index.html"
              >London's Heathrow Airport announces complete shutdown due to
              power outage</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-21 @ 03:31:06</span
              ><span class="points-container"
                >Points: <span class="points">159</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43431567"
                  >Comments</a
                ><span class="descendants">: 168</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43429417">
          <h3>
            <a class="item" href="https://github.com/smparsons/retroboy"
              >Retro Boy: simple Game Boy emulator written in Rust, can be
              played on the web</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-20 @ 21:54:17</span
              ><span class="points-container"
                >Points: <span class="points">292</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43429417"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43426022">
          <h3>
            <a class="item" href="https://www.openai.fm/"
              >OpenAI Audio Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-20 @ 17:18:00</span
              ><span class="points-container"
                >Points: <span class="points">604</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43426022"
                  >Comments</a
                ><span class="descendants">: 285</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43425655">
          <h3>
            <a class="item" href="https://www.anthropic.com/news/web-search"
              >Claude can now search the web</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-20 @ 16:51:12</span
              ><span class="points-container"
                >Points: <span class="points">1124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43425655"
                  >Comments</a
                ><span class="descendants">: 640</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43422162">
          <h3>
            <a
              class="item"
              href="https://polotek.net/posts/the-frontend-treadmill/"
              >The Frontend Treadmill</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-20 @ 12:25:31</span
              ><span class="points-container"
                >Points: <span class="points">666</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43422162"
                  >Comments</a
                ><span class="descendants">: 620</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43408487">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/science/2025/03/even-the-worst-mass-extinction-had-its-oases/"
              >Even the worst mass extinction had its oases</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-19 @ 05:21:33</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43408487"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43402058">
          <h3>
            <a
              class="item"
              href="https://www1.grc.nasa.gov/beginners-guide-to-aeronautics/whoosh-rocket/"
              >NASA Whoosh Rocket</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-18 @ 17:23:30</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43402058"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43398908">
          <h3>
            <a class="item" href="https://vectorfold.studio/blog/egglog"
              >Specializing Python with E-Graphs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-18 @ 12:58:40</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43398908"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43398539">
          <h3>
            <a class="item" href="https://en.liberapay.com/">Liberapay</a>
          </h3>
          <section>
            <h4>
              <span>2025-03-18 @ 12:21:12</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43398539"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43398308">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41467-025-56906-7"
              >Global population datasets systematically underrepresent rural
              population</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-18 @ 11:50:38</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43398308"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43397640">
          <h3>
            <a class="item" href="https://www.instantdb.com/essays/sync_future"
              >Sync Engines Are the Future</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-18 @ 10:18:12</span
              ><span class="points-container"
                >Points: <span class="points">241</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43397640"
                  >Comments</a
                ><span class="descendants">: 161</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43397625">
          <h3>
            <a class="item" href="https://github.com/mnfst/manifest"
              >Manifest: A 1-file micro-back end</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-18 @ 10:15:41</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43397625"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43397055">
          <h3>
            <a
              class="item"
              href="https://jerf.org/iri/post/2025/fp_lessons_simplicity/"
              >Component Simplicity</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-18 @ 09:00:16</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43397055"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43394698">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/arts-culture/books/the-mavericks-museum-review-albert-barnes-and-the-art-of-collecting-11f6c5e3"
              >'The Maverick's Museum' Review: Albert Barnes and the Art of
              Collecting</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-18 @ 01:10:47</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43394698"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43389455">
          <h3>
            <a class="item" href="https://taylor.town/napkin-math"
              >Napkin Math Tool</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-17 @ 15:16:03</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43389455"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
