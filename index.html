<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41595485">
          <h3>
            <a
              class="item"
              href="https://devblogs.microsoft.com/directx/directx-adopting-spir-v/"
              >DirectX Adopting SPIR-V as the Interchange Format of the
              Future</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 19:32:53</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41595485"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41595310">
          <h3>
            <a
              class="item"
              href="https://www.zombiezen.com/blog/2024/09/zb-early-stage-build-system/"
              >Zb: An Early-Stage Build System</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 19:16:04</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41595310"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41594912">
          <h3>
            <a
              class="item"
              href="https://finance.yahoo.com/news/blackrock-microsoft-aim-raise-30-202200420.html"
              >BlackRock, Microsoft to Raise $30B for AI Investments</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 18:35:46</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41594912"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41594774">
          <h3>
            <a
              class="item"
              href="https://www.bunniestudios.com/blog/2024/turning-everyday-gadgets-into-bombs-is-a-bad-idea/"
              >Turning Everyday Gadgets into Bombs Is a Bad Idea</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 18:23:00</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41594774"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41594510">
          <h3>
            <a
              class="item"
              href="https://www.theatlantic.com/magazine/archive/2024/10/christophe-lebold-leonard-cohen-book/679573/"
              >Leonard Cohen: The Anti-Rock Star</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 18:01:04</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41594510"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41593901">
          <h3>
            <a class="item" href="https://aviator.co/jobs"
              >Aviator (YC S21) is hiring engineers to build open source stacked
              PRs CLI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 17:00:28</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41593809">
          <h3>
            <a
              class="item"
              href="https://www.ftc.gov/news-events/news/press-releases/2024/09/ftc-staff-report-finds-large-social-media-video-streaming-companies-have-engaged-vast-surveillance"
              >FTC: Vast Surveillance of Users by Social Media and Video
              Streaming Companies</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 16:49:38</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41593809"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41593368">
          <h3>
            <a
              class="item"
              href="https://www.marketplace.org/2019/05/29/theres-a-reason-your-columbia-shirt-has-a-tiny-pocket-near-your-waistline/"
              >The reason your Columbia shirt has a tiny pocket near your
              waistline (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 16:12:11</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41593368"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41593216">
          <h3>
            <a class="item" href="https://playground.numscript.org/"
              >Show HN: Numscript, a declarative language to model financial
              transactions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 15:59:19</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41593216"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
            <div class="text">
              <p>
                * Payments involving vouchers and a user's prepaid balance *
                Complex funds destination scenario where the customer gets cash
                back * Configurable user credit balance spending transactions
              </p>
              <p>
                The main idea is to take the pain out of describing of a system
                dealing with money movements should behave in traditional
                languages such as JS/TS/Go/Ruby etc, landing an expressive way
                to model these movements of value.
              </p>
              <p>
                It is voluntarily broad in applicability—our customers use it
                today for use-cases ranging from marketplaces funds
                orchestration to home-grown loan management systems.
              </p>
              <p>
                Once those transactions are modeled, they are to be picked up
                and committed to a system-of-record, ledgering system or
                executed on a set of payments and banking APIs.
              </p>
              <p>
                It was initially a DSL we bundled into our Core Ledger product
                at Formance (YCS21) but we're giving it more autonomy now and
                started to make it standalone, with the idea that anyone could
                eventually bolt Numscript on top of their ledgering system.
                We're also exploring to make it natively compatible with other
                backends.
              </p>
              <p>
                As part of this un-bundling, we've just shipping a playground
                which lets you fiddle with it without installing anything at
                <a href="https://playground.numscript.org/"
                  >https://playground.numscript.org/</a
                >
                (it works best on desktop).
              </p>
              <p>Happy to chime in on any questions!</p>
            </div>
          </section>
        </section>
        <section id="41592646">
          <h3>
            <a class="item" href="https://www.opennms.com/opennms-feature-list/"
              >OpenNMS: Visualize and monitor everything on your local and
              distributed networks</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 15:02:48</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41592646"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41592632">
          <h3>
            <a
              class="item"
              href="https://rethinkingsoftware.substack.com/p/how-to-measure-progress-in-a-software"
              >How to Measure Progress in a Software Project – By Adam Ard</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 15:00:53</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41592632"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41592552">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/5g-antenna-transparent-window"
              >Glass Antenna Turns windows into 5G Base Stations</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 14:53:32</span
              ><span class="points-container"
                >Points: <span class="points">205</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41592552"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41592119">
          <h3>
            <a
              class="item"
              href="https://www.latimes.com/lifestyle/story/2024-09-18/regret-how-to-overcome"
              >Tortured by regrets? A new study details how best to overcome
              them</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 14:16:39</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41592119"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41591998">
          <h3>
            <a class="item" href="https://www.evanjones.ca/jvm-mmap-pause.html"
              >JVM statistics cause garbage collection pauses (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 14:05:32</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41591998"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41591906">
          <h3>
            <a
              class="item"
              href="https://www.tudelft.nl/en/2024/tnw/quantum-researchers-cause-controlled-wobble-in-the-nucleus-of-a-single-atom"
              >Quantum researchers cause controlled 'wobble' in the nucleus of a
              single atom</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 13:58:56</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41591906"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41591622">
          <h3>
            <a
              class="item"
              href="https://www.pivotaltracker.com/blog/2024-09-18-end-of-life"
              >Pivotal Tracker will shut down</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 13:25:15</span
              ><span class="points-container"
                >Points: <span class="points">238</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41591622"
                  >Comments</a
                ><span class="descendants">: 186</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41591527">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-09-astronomers-biggest-black-hole-jets.html"
              >Biggest ever seen black hole jets; blasting plasma well beyond
              their own galaxy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 13:12:56</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41591527"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41591449">
          <h3>
            <a class="item" href="https://github.com/dragostis/chili"
              >Show HN: Chili. Rust port of Spice, a low-overhead
              parallelization library</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 13:04:21</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41591449"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41591399">
          <h3>
            <a
              class="item"
              href="https://risk-engineering.org/concept/Rasmussen-practical-drift"
              >Drift towards danger and the normalization of deviance (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 12:58:18</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41591399"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41591230">
          <h3>
            <a
              class="item"
              href="https://www.strangeloopcanon.com/p/seeing-like-a-network"
              >Seeing Like a Network</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 12:41:16</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41591230"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41591018">
          <h3>
            <a class="item" href="https://github.com/MightyMoud/sidekick"
              >Show HN: A CLI tool I made to self-host any app with two commands
              on a VPS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 12:17:05</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41591018"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41590807">
          <h3>
            <a class="item" href="https://www.trebeljahr.com/posts/diatoms"
              >Diatom Arrangements</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 11:47:45</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41590807"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41590466">
          <h3>
            <a class="item" href="https://larslofgren.com/forbes-marketplace/"
              >Forbes Marketplace: The Parasite SEO Company Trying to Devour Its
              Host</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-19 @ 10:44:08</span
              ><span class="points-container"
                >Points: <span class="points">159</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41590466"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41585017">
          <h3>
            <a class="item" href="https://getselectable.com/"
              >Show HN: Selectable – mobile-friendly Postgres client</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-18 @ 20:23:47</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41585017"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41560397">
          <h3>
            <a class="item" href="https://vapour.run/"
              >Vapour: A typed superset of the R programming language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-16 @ 20:24:49</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41560397"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41554729">
          <h3>
            <a class="item" href="https://github.com/Harvie/cnc-simulator"
              >I Revived 3-Axis CNC Mill G-Code Simulator</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-16 @ 10:45:54</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41554729"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41554014">
          <h3>
            <a class="item" href="https://github.com/line/ts-remove-unused"
              >Show HN: ts-remove-unused – Remove unused code from your
              TypeScript project</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-16 @ 08:39:33</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41554014"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
            <div class="text">
              <p>
                There are some similar tools but they are focused on "detecting"
                rather than "removing" so I've built one myself. I wanted a
                solution that's as minimal as possible; config files to specify
                the files in your project shouldn't be necessary because that
                info should be already configured in tsconfig.json. All you need
                to do is to specify your entrypoint file.
              </p>
              <p>Feedback is much appreciated!</p>
            </div>
          </section>
        </section>
        <section id="41550907">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=Bicjxl4EcJg"
              >The Cheating Device (ChatGPT on a TI-84) [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-15 @ 22:15:22</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41550907"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41548475">
          <h3>
            <a
              class="item"
              href="https://medium.com/@polyglot_factotum/modelling-a-message-passing-bug-with-tla-baaf090a688d"
              >Modelling the archetype of a message-passing bug with TLA+
              (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-15 @ 16:33:48</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41548475"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41540542">
          <h3>
            <a class="item" href="https://lab.flipper.net/apps/upython"
              >MicroPython on Flipper Zero</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-14 @ 15:43:53</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41540542"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
