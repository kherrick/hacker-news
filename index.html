<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36571110">
          <h3>
            <a
              class="item"
              href="https://www.dataorienteddesign.com/dodbook/dodmain.html"
              >Data-Oriented Design</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-03 @ 10:41:09</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36571110"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36570714">
          <h3>
            <a
              class="item"
              href="https://diff.wikimedia.org/2023/06/29/stepping-into-the-future-wikimedia-projects-transition-to-creative-commons-4-0-license/"
              >Wikipedia switches to CC BY-SA 4.0 license</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-03 @ 09:35:43</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36570714"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36570499">
          <h3>
            <a
              class="item"
              href="https://ray.run/blog/detecting-and-handling-flaky-tests-in-playwright"
              >Detecting and Handling Flaky Tests in Playwright</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-03 @ 09:03:24</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36570499"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36570139">
          <h3>
            <a
              class="item"
              href="https://www.forbes.com/sites/anandgopal/2023/07/02/batteries-and-renewables-are-saving-texas-in-the-heat-wave/"
              >Batteries and Renewables Are Saving Texas During the Heat Wave</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-03 @ 08:05:33</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36570139"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36569736">
          <h3>
            <a
              class="item"
              href="https://github.com/szabolcsdombi/optimization-demo"
              >Show HN: Python can make 3M+ WebSocket keys per second</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-03 @ 07:06:02</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36569736"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36569592">
          <h3>
            <a
              class="item"
              href="https://dc.watch.impress.co.jp/docs/news/1511787.html"
              >NanoSnap: A 19g, 5x3cm camera with 4K photo and 2K video</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-03 @ 06:42:59</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36569592"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36569411">
          <h3>
            <a class="item" href="https://github.com/rogerkeays/fluent"
              >Fluent: Static Extension Methods for Java</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-03 @ 06:03:20</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36569411"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36569044">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/2023/07/02/nvidias-h100-funny-l2-and-tons-of-bandwidth/"
              >Nvidiaâ€™s H100: Funny L2, and Tons of Bandwidth</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-03 @ 04:55:09</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36569044"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36568192">
          <h3>
            <a
              class="item"
              href="https://codegolf.stackexchange.com/questions/215216/high-throughput-fizz-buzz/236630#236630"
              >55 GiB/s FizzBuzz (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-03 @ 02:54:46</span
              ><span class="points-container"
                >Points: <span class="points">338</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36568192"
                  >Comments</a
                ><span class="descendants">: 130</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36567918">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36567918"
              >Ask HN: Are people in tech inside an AI echo chamber?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-03 @ 02:17:29</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36567918"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
            <div class="text">
              I recently spoke with a friend who is not in the tech space and he
              hadnâ€™t even heard of ChatGPT. Heâ€™s a millennial &amp;amp; a white
              collar worker and smart. I have had conversations with non-tech
              people about ChatGPT/AI, but not very frequently, which led me to
              think, are we just in an echo chamber? Not that this would be a
              bad thing, as weâ€™re all quite aware that AI will play an
              increasing role in our lives (in &amp;amp; out of the office), but
              maybe AI mainstream adoption will take longer than we anticipate.
              What do you think?
            </div>
          </section>
        </section>
        <section id="36566999">
          <h3>
            <a class="item" href="https://woa-project.github.io/LumiaWOA/"
              >Lumia WOA Project â€“ Windows 10 or Windows 11 Desktop OS for Lumia
              950/XL</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-02 @ 23:42:43</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36566999"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36566638">
          <h3>
            <a
              class="item"
              href="https://collindonnell.com/the-xerox-smalltalk-80-gui-was-weird"
              >The Xerox Smalltalk-80 GUI Was Weird</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-02 @ 22:51:50</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36566638"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36566634">
          <h3>
            <a
              class="item"
              href="https://oppositeinvictus.com/illegal-life-pro-tip-want-to-ruin-your-competitors-business"
              >Illegal Life Pro Tip: Want to ruin your competitor's business?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-02 @ 22:51:19</span
              ><span class="points-container"
                >Points: <span class="points">285</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36566634"
                  >Comments</a
                ><span class="descendants">: 163</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36566167">
          <h3>
            <a
              class="item"
              href="https://thechipletter.substack.com/p/ericsson-to-whatsapp-the-story-of"
              >Ericsson to WhatsApp: The Story of Erlang</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-02 @ 21:51:33</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36566167"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36565854">
          <h3>
            <a
              class="item"
              href="https://www.ben-evans.com/benedictevans/2023/7/2/working-with-ai"
              >AI and the Automation of Work</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-02 @ 21:16:39</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36565854"
                  >Comments</a
                ><span class="descendants">: 158</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36565405">
          <h3>
            <a
              class="item"
              href="https://sec.okta.com/articles/2020/04/webauthn-great-and-it-sucks/"
              >WebAuthn Is Great and It Sucks (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-02 @ 20:35:08</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36565405"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36565225">
          <h3>
            <a
              class="item"
              href="https://prashanth.world/seo-ruining-programming-help/"
              >Googling for answers costs time (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-02 @ 20:16:35</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36565225"
                  >Comments</a
                ><span class="descendants">: 136</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36564923">
          <h3>
            <a class="item" href="https://github.com/GRVYDEV/S.A.T.U.R.D.A.Y"
              >Show HN: Project S.A.T.U.R.D.A.Y. â€“ open-source, self hosted,
              J.A.R.V.I.S.</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-02 @ 19:42:45</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36564923"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
            <div class="text">
              <p>
                I have had a blast working on this so far and I'm excited to
                continue to build with it. It uses whisper.cpp [1], Coqui TTS
                [2] and OpenAI [3] to do speech-to-text, text-to-text and
                text-to-speech inference all 100% locally (except for
                text-to-text). In the future I plan to swap out OpenAI for
                llama.cpp [4]. It is built on top of WebRTC as the media
                transmission layer which will allow this technology to be
                deployed anywhere as it does not rely on any native or 3rd party
                APIs.
              </p>
              <p>
                The purpose of this project is to be a toolbox for vocal
                computing. It provides high-level abstractions for dealing with
                speech-to-text, text-to-text and text-to-speech tasks. The tools
                remain decoupled from underlying AI models allowing for quick
                and easy upgrades when new technology is realeased. The main
                demo for this project is a J.A.R.V.I.S-like assistant however
                this is meant to be used for a wide variety of use cases.
              </p>
              <p>
                In the coming months I plan to continue to build (hopefully with
                some of you) on top of this project in order to refine the
                abstraction level and better understand the kinds of tools
                required. I hope to build a community of like-minded individuals
                who want to see J.A.R.V.I.S finally come to life! If you are
                interested in vocal computing come join the Discord server and
                build with us! Hope to see you there :)
              </p>
              <p>
                Video demo:
                <a href="https://youtu.be/xqEQSw2Wq54"
                  >https://youtu.be/xqEQSw2Wq54</a
                >
              </p>
              <p>
                [1] whisper.cpp:
                <a href="https://github.com/ggerganov/whisper.cpp"
                  >https://github.com/ggerganov/whisper.cpp</a
                >
              </p>
              <p>
                [2] Coqui TTS:
                <a href="https://github.com/coqui-ai/TTS"
                  >https://github.com/coqui-ai/TTS</a
                >
              </p>
              <p>
                [3] OpenAI:
                <a href="https://openai.com/">https://openai.com/</a>
              </p>
              <p>
                [4] llama.cpp:
                <a href="https://github.com/ggerganov/llama.cpp"
                  >https://github.com/ggerganov/llama.cpp</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="36564608">
          <h3>
            <a
              class="item"
              href="https://pedestrianobservations.com/2023/06/30/why-commuters-prefer-origin-to-destination-transfers/"
              >Commuters prefer origin to destination transfers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-02 @ 19:07:21</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36564608"
                  >Comments</a
                ><span class="descendants">: 146</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36564042">
          <h3>
            <a
              class="item"
              href="https://matt-rickard.com/google-searchs-death-by-a-thousand-cuts"
              >Google search's death by a thousand cuts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-02 @ 18:14:13</span
              ><span class="points-container"
                >Points: <span class="points">190</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36564042"
                  >Comments</a
                ><span class="descendants">: 158</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36564010">
          <h3>
            <a class="item" href="https://frantic.im/javascript-gom-jabbar/"
              >JavaScript Gom Jabbar</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-02 @ 18:12:09</span
              ><span class="points-container"
                >Points: <span class="points">467</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36564010"
                  >Comments</a
                ><span class="descendants">: 204</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36563780">
          <h3>
            <a class="item" href="https://www.amigalive.com/"
              >AMIGAlive â€“ Play Amiga games online with people across the
              world</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-02 @ 17:50:52</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36563780"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36563590">
          <h3>
            <a
              class="item"
              href="https://mainichi.jp/english/articles/20230609/p2a/00m/0sc/026000c"
              >First 'tooth regrowth' medicine moves toward clinical trials in
              Japan</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-02 @ 17:33:17</span
              ><span class="points-container"
                >Points: <span class="points">829</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36563590"
                  >Comments</a
                ><span class="descendants">: 260</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36561827">
          <h3>
            <a
              class="item"
              href="https://pncnmnp.github.io/blogs/addressograph.html"
              >Before Xerox, there was Addressograph</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-02 @ 14:32:04</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36561827"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36561309">
          <h3>
            <a
              class="item"
              href="https://jmmv.dev/2022/11/endbasic-bytecode.html"
              >From AST to bytecode execution in EndBASIC</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-02 @ 13:29:12</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36561309"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36559779">
          <h3>
            <a
              class="item"
              href="https://zeux.io/2023/06/30/efficient-jagged-arrays/"
              >Efficient Jagged Arrays</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-02 @ 09:22:27</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36559779"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36559758">
          <h3>
            <a
              class="item"
              href="https://scholarlykitchen.sspnet.org/2013/04/30/iannotate-whatever-happened-to-the-web-as-an-annotation-system/"
              >iAnnotate â€“ Whatever happened to the web as an annotation system?
              (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-02 @ 09:17:44</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36559758"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36550598">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=RCVXaqSEqmI"
              >Douglas Rushkoff: Crashing Technosolutionism [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-01 @ 14:39:40</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36550598"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36550086">
          <h3>
            <a
              class="item"
              href="https://www.deusinmachina.net/p/simula-the-forgotten-programming"
              >Simula â€“ The forgotten programming language</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-01 @ 13:49:10</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36550086"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36507423">
          <h3>
            <a
              class="item"
              href="https://www.vice.com/en/article/ak3k34/2200-forgotten-vintage-computers-are-being-liberated-from-a-barn-in-massachusetts"
              >2,200 forgotten vintage computers from a barn in Massachusetts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-28 @ 14:58:48</span
              ><span class="points-container"
                >Points: <span class="points">346</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36507423"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
