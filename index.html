<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37611191">
          <h3>
            <a class="item" href="https://www.bbc.co.uk/news/business-66887717"
              >Amazon Prime Video content to start including ads next year</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-22 @ 12:36:09</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37611191"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37611080">
          <h3>
            <a class="item" href="https://www.shuttle.rs/launchpad"
              >Learn Rust by building real-world examples</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-22 @ 12:25:46</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37611080"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37611045">
          <h3>
            <a class="item" href="https://anybt.eth.link/#/?s=yc"
              >AnyBT: A BitTorrent Search Engine Works on ENS and IPFS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-22 @ 12:22:01</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37611045"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37610899">
          <h3>
            <a
              class="item"
              href="https://blog.sequin.io/all-the-ways-to-capture-changes-in-postgres/"
              >All the ways to capture changes in Postgres</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-22 @ 12:06:42</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37610899"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37610864">
          <h3>
            <a class="item" href="https://github.com/getzep/zep"
              >Zep: Fast, scalable building blocks for production LLM apps</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-22 @ 12:02:25</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37610864"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37610623">
          <h3>
            <a
              class="item"
              href="https://info.westinghousenuclear.com/news/westinghouse-and-bechtel-sign-consortium-agreement-for-first-nuclear-power-plant-in-poland"
              >Westinghouse/Bechtel Consortium Agreement: First Nuclear Power
              Plant in Poland</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-22 @ 11:29:39</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37610623"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37610447">
          <h3>
            <a class="item" href="https://signal.org/docs/specifications/pqxdh/"
              >Signal: The Pqxdh Key Agreement Protocol</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-22 @ 11:02:50</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37610447"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37610417">
          <h3>
            <a
              class="item"
              href="https://www.travelandleisure.com/cheaper-to-live-on-boat-than-apartment-in-these-cities-7971310"
              >It's Cheaper to Live on a Boat Than Rent an Apartment in These
              U.S. Cities</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-22 @ 10:55:03</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37610417"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37610375">
          <h3>
            <a class="item" href="https://corrode.dev/blog/enums/"
              >Using enums to represent state in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-22 @ 10:48:11</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37610375"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37610238">
          <h3>
            <a
              class="item"
              href="https://tante.cc/2023/09/21/the-age-of-the-grift-shift/"
              >The Age of the Grift Shift</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-22 @ 10:25:46</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37610238"
                  >Comments</a
                ><span class="descendants">: 96</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37610230">
          <h3>
            <a
              class="item"
              href="https://blog.arduino.cc/2023/09/20/turning-an-old-car-into-a-powerful-generator/"
              >Turning an old car into a powerful generator</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-22 @ 10:25:00</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37610230"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37609914">
          <h3>
            <a
              class="item"
              href="https://mollymielke.notion.site/Computing-History-Hub-be72f307fc2e4b05abe3dc67eb937521"
              >Computing History Hub</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-22 @ 09:38:16</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37609914"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37609663">
          <h3>
            <a
              class="item"
              href="https://chromestatus.com/feature/5124977788977152"
              >Chrome feature: Compression dictionary transport with Shared
              Brotli</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-22 @ 08:57:56</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37609663"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37608900">
          <h3>
            <a
              class="item"
              href="https://tty.neveragain.de/2023/09/21/aws-cannot-escape-ipv4.html"
              >AWS Customers Cannot Escape IPv4</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-22 @ 07:15:40</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37608900"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37608580">
          <h3>
            <a
              class="item"
              href="https://adayinthelifeof.nl/2023/09/22/browsers.html"
              >I'm fed up with it, so I'm writing a browser</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-22 @ 06:27:15</span
              ><span class="points-container"
                >Points: <span class="points">293</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37608580"
                  >Comments</a
                ><span class="descendants">: 183</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37608186">
          <h3>
            <a
              class="item"
              href="https://altinity.com/blog/is-clickhouse-moving-away-from-open-source"
              >Is ClickHouse Moving Away from Open Source?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-22 @ 05:20:04</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37608186"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37608110">
          <h3>
            <a class="item" href="https://lwn.net/Articles/944209/"
              >The Bogus CVE Problem</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-22 @ 05:08:06</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37608110"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37608061">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/behold-modular-forms-the-fifth-fundamental-operation-of-math-20230921/"
              >Modular forms, the ‘fifth fundamental operation’ of math</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-22 @ 04:59:21</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37608061"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37607597">
          <h3>
            <a
              class="item"
              href="https://ancientrecipes.wordpress.com/2015/05/18/678/"
              >The curious incident of the dog and the palm tree (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-22 @ 03:46:14</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37607597"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37607534">
          <h3>
            <a
              class="item"
              href="https://daily.jstor.org/the-poet-is-a-man-who-feigns/"
              >“The Poet Is a Man Who Feigns”</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-22 @ 03:35:31</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37607534"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37606380">
          <h3>
            <a
              class="item"
              href="https://www.copetti.org/writings/consoles/nintendo-3ds/"
              >Nintendo 3DS Architecture</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-22 @ 00:31:55</span
              ><span class="points-container"
                >Points: <span class="points">281</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37606380"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37606352">
          <h3>
            <a
              class="item"
              href="https://blog.research.google/2023/09/distilling-step-by-step-outperforming.html"
              >Outperforming larger language models with less training data and
              smaller models</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-22 @ 00:29:44</span
              ><span class="points-container"
                >Points: <span class="points">225</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37606352"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37603905">
          <h3>
            <a
              class="item"
              href="https://blog.kagi.com/unlimited-searches-for-10"
              >Unlimited Kagi searches for $10 per month</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 20:32:53</span
              ><span class="points-container"
                >Points: <span class="points">1450</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37603905"
                  >Comments</a
                ><span class="descendants">: 767</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37600852">
          <h3>
            <a class="item" href="https://blog.isosceles.com/the-webp-0day/"
              >The WebP 0day</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 17:21:39</span
              ><span class="points-container"
                >Points: <span class="points">322</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37600852"
                  >Comments</a
                ><span class="descendants">: 162</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37597532">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/sports/baseball/mini-bombs-pitching-elbow-injuries-ohtani-degrom-4aa32bfa"
              >‘Mini-bombs’ blowing up the elbows of baseball’s top pitchers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 13:45:55</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37597532"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37596253">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=37596253"
              >Launch HN: Loops (YC W22) – Email for SaaS Companies</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 11:48:51</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37596253"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
            <div class="text">
              <a href="https://loops.so">https://loops.so</a>), a platform aimed
              at simplifying the email experience for SaaS companies. We support
              creating and sending marketing, product, and transactional email.
              <p>
                Email is important but painful to manage. If you've ever dealt
                with the frustration of coding emails by hand, testing them
                across multiple clients, or integrating them into various SaaS
                tools, you might find our approach interesting.
              </p>
              <p>
                We make it simple to design and send email to your users either
                manually in the app, via API or triggered via an integration. We
                offer unlimited team seats, so your product team can help align
                copy, your marketing team can send newsletters, your revenue
                team can work on dunning and your engineers can have a solid API
                to help orchestrate the sends.
              </p>
              <p>
                Most of our competitors use email editors that are licensed from
                a third party. Our editor is built from the ground up on the
                Lexical text editor from Meta, extended beyond just text nodes.
                It supports mobile editing and dark mode, and it autosaves your
                changes.
              </p>
              <p>
                Our REST API is straightforward, and we have integrations with
                tools like Segment and Census. Documentation is available at
                <a href="https://loops.so/docs">https://loops.so/docs</a>. On
                our homepage, right under the fold, we list endpoints and sample
                payloads.
              </p>
              <p>
                One issue we've worked hard to address is email compatibility
                across devices and platforms. It's a problem full of edge cases
                that we've mitigated by extending MJML, a markup language
                designed for responsive email, to be even more compliant across
                different platforms. We don't think you should have to code and
                test your emails. Email copy shouldn't live in your codebase.
              </p>
              <p>
                If you're concerned about spam, we are too. We educate our users
                on CAN-SPAM rules and automatically add compliant footers to
                emails. We actively monitor to ensure our platform isn't used
                for spam, and we do not allow cold sales emails.
              </p>
              <p>
                Our pricing is upfront and available on our website. You can try
                the platform for free without a credit card. We launched
                publicly a week ago. We're really interested in any technical
                feedback you have, as we aim to make this tool as
                developer-friendly as possible.
              </p>
              <p>Looking forward to hearing your thoughts!</p>
            </div>
          </section>
        </section>
        <section id="37595649">
          <h3>
            <a class="item" href="https://chen-geng.com/inv-shade-trees"
              >Tree-Structured Shading Decomposition</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 10:23:00</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37595649"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37593404">
          <h3>
            <a
              class="item"
              href="https://bernsteinbear.com/blog/compiling-ml-models/"
              >Compiling ML models to C for fun</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 05:03:41</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37593404"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37593398">
          <h3>
            <a
              class="item"
              href="https://browsercompany.substack.com/cp/137231709"
              >Interoperability: Swift’s Super Power</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 05:01:16</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37593398"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37593137">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/culture/the-front-row/stop-making-sense-and-the-transformative-power-of-collaboration"
              >“Stop Making Sense” is having a theatrical rerelease</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 04:12:50</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37593137"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
