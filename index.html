<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="45047395">
          <h3>
            <a
              class="item"
              href="https://insidemedicine.substack.com/p/breaking-news-read-three-top-cdc"
              >CDC officials’ resignation emails</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-28 @ 01:47:03</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45047395"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45047129">
          <h3>
            <a
              class="item"
              href="https://www.chrbutler.com/the-national-design-studio-is-a-scam"
              >The National Design Studio is a scam</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-28 @ 01:03:23</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45047129"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45046916">
          <h3>
            <a
              class="item"
              href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0329411"
              >Altered states of consciousness induced by breathwork accompanied
              by music</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-28 @ 00:22:24</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45046916"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45045500">
          <h3>
            <a
              class="item"
              href="https://news.fsu.edu/news/education-society/2025/08/26/on-screen-and-now-irl-fsu-researchers-find-evidence-suggesting-chatgpt-influences-how-we-speak/"
              >Researchers find evidence of ChatGPT buzzwords turning up in
              everyday speech</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-27 @ 21:27:13</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45045500"
                  >Comments</a
                ><span class="descendants">: 158</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45045398">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2025/08/27/google-executive-says-company-has-cut-a-third-of-its-managers.html"
              >Google has eliminated 35% of managers overseeing small teams in
              past year</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-27 @ 21:16:56</span
              ><span class="points-container"
                >Points: <span class="points">308</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45045398"
                  >Comments</a
                ><span class="descendants">: 136</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45045307">
          <h3>
            <a class="item" href="https://yamanot.es/"
              >Yamanot.es: A music box of train station melodies from the JR
              Yamanote Line</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-27 @ 21:08:49</span
              ><span class="points-container"
                >Points: <span class="points">151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45045307"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45045116">
          <h3>
            <a class="item" href="https://github.com/polaroi8d/cactoide"
              >Show HN: Meetup.com and eventribe alternative to small groups</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-27 @ 20:53:51</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45045116"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
            <div class="text">
              <p>
                - One-Click Sharing - Each event gets a unique, memorable URL.
                Share instantly via any platform or messaging app. - No Hassle,
                No Sign-Ups - Skip registrations and endless forms. Unlike other
                event platforms, you create and share instantly — no accounts,
                no barriers. - Effortless Simplicity - Designed to be instantly
                clear and easy. No learning curve — just open, create, and go.
              </p>
            </div>
          </section>
        </section>
        <section id="45044440">
          <h3>
            <a class="item" href="https://dw-news.dreamwidth.org/44429.html"
              >Beginning 1 September, we will need to geoblock Mississippi
              IPs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-27 @ 20:03:01</span
              ><span class="points-container"
                >Points: <span class="points">152</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45044440"
                  >Comments</a
                ><span class="descendants">: 179</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45042461">
          <h3>
            <a
              class="item"
              href="https://www.nordbayern.de/news-in-english/paypal-security-systems-down-german-banks-block-payments-in-the-billions-1.14811187"
              >A failure of security systems at PayPal is causing concern for
              German banks</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-27 @ 17:28:20</span
              ><span class="points-container"
                >Points: <span class="points">217</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45042461"
                  >Comments</a
                ><span class="descendants">: 150</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45042175">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/lago/jobs"
              >Lago – Open-Source Usage Based Billing – Is Hiring in Sales, Eng,
              Ops (EU, US)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-27 @ 17:01:06</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45041743">
          <h3>
            <a class="item" href="https://gmplib.org/gmp-zen5"
              >GMP damaging Zen 5 CPUs?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-27 @ 16:24:12</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45041743"
                  >Comments</a
                ><span class="descendants">: 125</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45041315">
          <h3>
            <a class="item" href="https://github.com/renzorlive/vimmaster"
              >VIM Master</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-27 @ 15:50:54</span
              ><span class="points-container"
                >Points: <span class="points">223</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45041315"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45041286">
          <h3>
            <a
              class="item"
              href="https://lubeno.dev/blog/rusts-productivity-curve"
              >Unexpected productivity boost of Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-27 @ 15:48:07</span
              ><span class="points-container"
                >Points: <span class="points">300</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45041286"
                  >Comments</a
                ><span class="descendants">: 296</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45041185">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=45041185"
              >Launch HN: Bitrig (YC S25) – Build Swift apps on your iPhone</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-27 @ 15:39:33</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45041185"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.bitrig.app">https://www.bitrig.app</a>).
              <p>
                Bitrig lets you create native Swift apps for your phone, on your
                phone, just by chatting with AI. It’s like Lovable for iPhone
                apps.
              </p>
              <p>
                Here's a video of Bitrig in action:
                <a href="https://youtu.be/CUlWhF3ERME"
                  >https://youtu.be/CUlWhF3ERME</a
                >
              </p>
              <p>
                We created SwiftUI at Apple to help developers make better apps
                with less code. Bitrig lets anyone build at this level of
                polish. If you've thought about making an iPhone app, Bitrig is
                the easiest possible way to get started with Swift.
              </p>
              <p>
                Bitrig uses Claude Sonnet 4.0 with a simple system prompt and
                tool definitions to generate native Swift code. Normally running
                this on an iPhone would require compiling and signing it with
                Xcode, and you can’t run Xcode on an iPhone. So we did
                something… creative. We wrote a custom Swift interpreter! Among
                other things this lets you instantly preview your app in Bitrig
                and share it with just a URL.
              </p>
              <p>
                If you have a paid Apple developer account, you can connect it
                with Bitrig. We’ll compile your app on our server and upload it
                to App Store Connect, so you can distribute it on TestFlight or
                the App Store. This last step also gives you a fully optimized
                build of your app that you can install right on your Home
                Screen.
              </p>
              <p>
                We think there’s something electric about building apps directly
                on your phone. We hope you give Bitrig a try!
              </p>
              <p>
                We’re ingesting Apple’s SDK frameworks into Bitrig piece by
                piece. If you try to build something and hit a missing
                framework, let us know and we’ll prioritize adding it.
              </p>
              <p>
                Download Bitrig on the App Store:
                <a href="https://apps.apple.com/us/app/bitrig/id6747835910"
                  >https://apps.apple.com/us/app/bitrig/id6747835910</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="45040875">
          <h3>
            <a
              class="item"
              href="https://github.com/razetime/efficient-array-programming"
              >Efficient Array Programming</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-27 @ 15:16:18</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45040875"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45039301">
          <h3>
            <a
              class="item"
              href="https://eli.thegreenplace.net/2025/implementing-forth-in-go-and-c/"
              >Implementing Forth in Go and C</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-27 @ 13:19:11</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45039301"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45038710">
          <h3>
            <a
              class="item"
              href="https://zed.dev/blog/bring-your-own-agent-to-zed"
              >Bring Your Own Agent to Zed – Featuring Gemini CLI</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-27 @ 12:25:38</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45038710"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
            <div class="text">
              <a
                href="https://developers.googleblog.com/en/gemini-cli-is-now-integrated-into-zed/"
                >https://developers.googleblog.com/en/gemini-cli-is-now-integ...</a
              >
            </div>
          </section>
        </section>
        <section id="45038260">
          <h3>
            <a
              class="item"
              href="https://stefan-marr.de/2025/08/how-to-slow-down-a-program/"
              >How to slow down a program and why it can be useful</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-27 @ 11:38:35</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45038260"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45037365">
          <h3>
            <a
              class="item"
              href="https://github.com/orgs/community/discussions/170758"
              >The GitHub website is slow on Safari</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-27 @ 09:43:43</span
              ><span class="points-container"
                >Points: <span class="points">293</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45037365"
                  >Comments</a
                ><span class="descendants">: 230</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45036294">
          <h3>
            <a
              class="item"
              href="https://thedailywtf.com/articles/the-therac-25-incident"
              >The Therac-25 Incident (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-27 @ 06:57:56</span
              ><span class="points-container"
                >Points: <span class="points">405</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45036294"
                  >Comments</a
                ><span class="descendants">: 242</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45034496">
          <h3>
            <a
              class="item"
              href="https://github.com/nrwl/nx/security/advisories/GHSA-cxm3-wv7p-598c"
              >Malicious versions of Nx and some supporting plugins were
              published</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-27 @ 01:38:48</span
              ><span class="points-container"
                >Points: <span class="points">324</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45034496"
                  >Comments</a
                ><span class="descendants">: 376</span></span
              >
            </h4>
            <div class="text">
              <p>
                <a
                  href="https://www.stepsecurity.io/blog/supply-chain-security-alert-popular-nx-build-system-package-compromised-with-data-stealing-malware"
                  >https://www.stepsecurity.io/blog/supply-chain-security-alert...</a
                >
              </p>
              <p>
                <a
                  href="https://semgrep.dev/blog/2025/security-alert-nx-compromised-to-steal-wallets-and-credentials/"
                  >https://semgrep.dev/blog/2025/security-alert-nx-compromised-...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="45023857">
          <h3>
            <a
              class="item"
              href="https://oshub.org/projects/retros-32/posts/object-oriented-design-patterns-in-osdev"
              >Object-oriented design patterns in C and kernel development</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-26 @ 08:34:15</span
              ><span class="points-container"
                >Points: <span class="points">200</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45023857"
                  >Comments</a
                ><span class="descendants">: 130</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45017770">
          <h3>
            <a
              class="item"
              href="https://www.ducktyped.org/p/a-mini-book-on-aws-networking-introduction"
              >A mini-book on AWS networking</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-25 @ 19:15:02</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45017770"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45012995">
          <h3>
            <a
              class="item"
              href="https://www.are.na/editorial/introducing-areal-are-nas-new-typeface"
              >Areal, Are.na's new typeface</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-25 @ 12:11:38</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45012995"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45011404">
          <h3>
            <a
              class="item"
              href="https://linuxcontainers.org/incus/docs/main/explanation/containers_and_vms/"
              >About Containers and VMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-25 @ 07:58:56</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45011404"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45008434">
          <h3>
            <a
              class="item"
              href="https://www.nvidia.com/en-us/products/workstations/dgx-spark/"
              >Nvidia DGX Spark</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-24 @ 22:35:23</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45008434"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45005823">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/future/article/20250819-why-italys-beloved-ancient-monolith-is-falling"
              >'Rocks as big as cars' are flying down the Dolomites</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-24 @ 17:03:44</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45005823"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45001005">
          <h3>
            <a
              class="item"
              href="https://www.cbc.ca/news/science/bloodsuckers-1.5361074"
              >You shouldn't salt a leech that's sucking your blood (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-24 @ 03:12:05</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45001005"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45000904">
          <h3>
            <a class="item" href="https://www.goranssongaspar.com/mastermind"
              >Using information theory to solve Mastermind</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-24 @ 02:54:11</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45000904"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44998010">
          <h3>
            <a
              class="item"
              href="https://www.thedrive.com/news/toyota-is-recycling-old-ev-batteries-to-help-power-mazdas-production-line"
              >Toyota is recycling old EV batteries to help power Mazda's
              production line</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-23 @ 18:29:05</span
              ><span class="points-container"
                >Points: <span class="points">207</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44998010"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
