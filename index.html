<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39162963">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2024/01/27/opinion_column/"
              >Remembering Unix Desktops – and What We Can Learn from Them</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-28 @ 05:56:26</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39162963"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39162856">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=5rg7xvTJ8SU"
              >I built my own 16-Bit CPU in Excel [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-28 @ 05:23:42</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39162856"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39162150">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=zj7YjFDt2WY"
              >Building a DIY CT/CAT scanner for $200 [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-28 @ 03:03:38</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39162150"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39161888">
          <h3>
            <a class="item" href="https://azich.org/blockdude/"
              >Block Dude (Ti-83) in the Browser</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-28 @ 02:13:27</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39161888"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39161841">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/solid-state-battery-production-challenges"
              >Solid-state EV batteries now face "production hell"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-28 @ 02:05:56</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39161841"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39161339">
          <h3>
            <a class="item" href="https://tonsky.me/blog/checkbox/"
              >In Loving Memory of Square Checkbox</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-28 @ 00:36:19</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39161339"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39161194">
          <h3>
            <a class="item" href="https://nitter.d420.de"
              >So long and thanks for all the fish</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-28 @ 00:13:32</span
              ><span class="points-container"
                >Points: <span class="points">342</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39161194"
                  >Comments</a
                ><span class="descendants">: 238</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39160463">
          <h3>
            <a
              class="item"
              href="https://www.law.com/thelegalintelligencer/2024/01/26/philadelphia-jury-hits-monsanto-with-2-25b-roundup-verdict/"
              >Philadelphia Jury Hits Monsanto with $2.25B Roundup Verdict</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-27 @ 22:20:57</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39160463"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39160291">
          <h3>
            <a
              class="item"
              href="https://www.e-basteln.de/computing/65f02/65f02/"
              >The 100MHz 6502 (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-27 @ 21:58:46</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39160291"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39159601">
          <h3>
            <a
              class="item"
              href="https://nautil.us/its-like-youre-a-space-explorer-encountering-aliens-500550/"
              >Studying species in the deepest parts of the ocean: A new method
              of analysis</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-27 @ 20:39:47</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39159601"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39159418">
          <h3>
            <a class="item" href="https://pong-wars.koenvangilst.nl/"
              >Show HN: Pong Wars</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-27 @ 20:19:12</span
              ><span class="points-container"
                >Points: <span class="points">259</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39159418"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39159263">
          <h3>
            <a
              class="item"
              href="https://kottke.org/21/03/the-invention-of-a-new-pasta-shape"
              >The invention of a new pasta shape (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-27 @ 20:03:28</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39159263"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39159246">
          <h3>
            <a
              class="item"
              href="https://typing.readthedocs.io/en/latest/source/typing_anti_pitch.html"
              >Reasons to avoid static type checking</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-27 @ 20:01:56</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39159246"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39159188">
          <h3>
            <a
              class="item"
              href="https://gitlab.com/Screwtapello/topaz-unicode#topaz-unicode"
              >Topaz Unicode</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-27 @ 19:55:53</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39159188"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39159002">
          <h3>
            <a
              class="item"
              href="https://www.scmagazine.com/news/gitlab-password-reset-bug-leaves-more-than-5-3k-servers-up-for-grabs"
              >Gitlab password reset bug leaves more than 5.3K servers up for
              grabs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-27 @ 19:34:27</span
              ><span class="points-container"
                >Points: <span class="points">202</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39159002"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39158250">
          <h3>
            <a class="item" href="https://danluu.com/why-video/"
              >Why good content gets posted on the wrong platform?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-27 @ 18:23:35</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39158250"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39157888">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/security/2024/01/in-major-gaffe-hacked-microsoft-test-account-was-assigned-admin-privileges/"
              >In major gaffe, hacked Microsoft test account was assigned admin
              privileges</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-27 @ 17:50:28</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39157888"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39157297">
          <h3>
            <a
              class="item"
              href="https://www.emergetools.com/careers/jobs/senior-android-engineer"
              >Emerge (YC W21) is hiring an Android expert to help build the
              future of mobile</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-27 @ 17:02:14</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39157061">
          <h3>
            <a
              class="item"
              href="https://camel-cdr.github.io/rvv-bench-results/articles/vector-utf.html"
              >Vectorizing Unicode conversions on real RISC-V hardware</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-27 @ 16:44:41</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39157061"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39156778">
          <h3>
            <a class="item" href="https://github.com/rasbt/LLMs-from-scratch"
              >Implementing a ChatGPT-like LLM from scratch, step by step</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-27 @ 16:19:42</span
              ><span class="points-container"
                >Points: <span class="points">501</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39156778"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39156463">
          <h3>
            <a
              class="item"
              href="https://news.mit.edu/2024/researchers-demonstrate-rapid-3d-printing-liquid-metal-0125"
              >Researchers demonstrate rapid 3D printing with liquid metal</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-27 @ 15:43:51</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39156463"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39156444">
          <h3>
            <a
              class="item"
              href="https://www.ign.com/articles/disney-unveils-the-holotile-floor-inching-us-closer-to-a-real-life-holodeck"
              >Disney unveils the HoloTile floor</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-27 @ 15:41:26</span
              ><span class="points-container"
                >Points: <span class="points">647</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39156444"
                  >Comments</a
                ><span class="descendants">: 255</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39156212">
          <h3>
            <a
              class="item"
              href="https://untappedcities.com/2024/01/26/opening-night-apollo-theater/"
              >Opening night at the Apollo Theater, 90 years ago</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-27 @ 15:13:20</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39156212"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39156207">
          <h3>
            <a class="item" href="http://impredicative.com/ur/"
              >The Ur Programming Language Family</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-27 @ 15:12:50</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39156207"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39155103">
          <h3>
            <a class="item" href="https://sxmo.org/"
              >Sxmo: Linux tiling window manager for phones</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-27 @ 12:49:37</span
              ><span class="points-container"
                >Points: <span class="points">298</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39155103"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39154418">
          <h3>
            <a class="item" href="https://github.com/imdj/HNRelevant"
              >Show HN: HNRelevant – Explore Related Discussions on HN in an
              Integrated Sidebar</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-27 @ 10:39:19</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39154418"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
            <div class="text">
              <p>
                I enjoy being knee-deep in discussions. Many times you're
                learning about something new, where the topic is either
                unfamiliar, thought-provoking, or just could use some context
                that you don't even know about. If a submission is interesting
                enough for me to click on, chances are I'd like to dig deeper
                into this topic and there are more related discussions that
                offer new context or perspective.
              </p>
              <p>
                This is an extension that I always have on so I paid special
                attentions to UX to make it intuitive and seamless and now the
                extension has become just part of the HN experience for me.
                Implementation-wise, it integrates
                <a href="https://hn.algolia.com/">https://hn.algolia.com/</a>
                API and uses the submission title as its initial query with the
                ability to change the query and other options interactively.
              </p>
              <p>It's available on: Chrome, Firefox, and as a userscript.</p>
              <p>
                Chrome:<a
                  href="https://chromewebstore.google.com/detail/hnrelevant/iajhnkei"
                  >https://chromewebstore.google.com/detail/hnrelevant/iajhnkei</a
                >...
              </p>
              <p>
                Firefox:
                <a
                  href="https://addons.mozilla.org/en-US/firefox/addon/hnrelevant/"
                  >https://addons.mozilla.org/en-US/firefox/addon/hnrelevant/</a
                >
              </p>
              <p>
                I shared it earlier last year when it was early in development,
                barely a prototype, at the time it wasn't yet published and
                could only be used on chrome by "load unpacked":
                <a href="https://news.ycombinator.com/item?id=36102610"
                  >https://news.ycombinator.com/item?id=36102610</a
                >. I've been using it daily since and I'm happy to share it now
                for you to give it a try.
              </p>
            </div>
          </section>
        </section>
        <section id="39145513">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/the-quest-to-decode-the-mandelbrot-set-maths-famed-fractal-20240126/"
              >The quest to decode the Mandelbrot set</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-26 @ 17:54:55</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39145513"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39142149">
          <h3>
            <a
              class="item"
              href="https://themillions.com/2022/09/on-proprioception-the-sixth-sense-of-storytelling.html"
              >On Proprioception, the Sixth Sense of Storytelling (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-26 @ 13:01:36</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39142149"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39141334">
          <h3>
            <a
              class="item"
              href="https://lareviewofbooks.org/article/revisiting-madonna-ology-in-the-era-of-taylor-swift-studies/"
              >Revisting Madonna-Ology in the Era of Taylor Swift Studies</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-26 @ 11:13:56</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39141334"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39135487">
          <h3>
            <a class="item" href="http://rachelbythebay.com/w/2024/01/24/fail/"
              >Hold on there: WPA3 connections fail after 11 hours</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-25 @ 21:21:28</span
              ><span class="points-container"
                >Points: <span class="points">334</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39135487"
                  >Comments</a
                ><span class="descendants">: 128</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
