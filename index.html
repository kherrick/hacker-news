<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40876568">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40876568"
              >Ask HN: Who Wants a Penpal?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 17:25:27</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40876568"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
            <div class="text">
              <p>
                If you're interesting in finding a penpal, post in this thread
                with the following format:
              </p>
              <p></p>
              <pre><code>  alias:
  interests:
  language(s): 
  link to something you think is cool:
  contact info:
</code></pre>
              To prevent spambots from scraping this like they do the hiring
              threads, please obscure your contact info.
            </div>
          </section>
        </section>
        <section id="40876342">
          <h3>
            <a
              class="item"
              href="https://press.uchicago.edu/books/excerpt/2012/kemp_floating.html"
              >The Origin of Ambergris (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 16:53:59</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40876342"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40876017">
          <h3>
            <a
              class="item"
              href="https://blog.prusa3d.com/we-are-now-manufacturing-3d-printers-and-filaments-in-the-usa_99148/"
              >Prusa is now manufacturing 3D printers in USA</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 16:15:28</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40876017"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40875924">
          <h3>
            <a
              class="item"
              href="https://news.ncsu.edu/2024/06/kirigami-mechanical-computer/"
              >Mechanical computer relies on kirigami cubes, not electronics</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 16:03:32</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40875924"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40875913">
          <h3>
            <a class="item" href="https://github.com/singulatron/singulatron"
              >Singulatron: Have your own internal AI network</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 16:02:20</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40875913"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40875702">
          <h3>
            <a class="item" href="https://lmno.lol/alvaro/ready-player-mode"
              >Ready Player Mode</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 15:34:08</span
              ><span class="points-container"
                >Points: <span class="points">3</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40875702"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40875559">
          <h3>
            <a
              class="item"
              href="https://stevana.github.io/the_sad_state_of_property-based_testing_libraries.html"
              >The sad state of property-based testing libraries</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 15:15:39</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40875559"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40875355">
          <h3>
            <a
              class="item"
              href="https://www.economist.com/science-and-technology/2010/09/08/lord-of-the-dance"
              >The dance moves that make men attractive to women</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 14:44:45</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40875355"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40874341">
          <h3>
            <a
              class="item"
              href="https://www.securityweek.com/twilio-confirms-data-breach-after-hackers-leak-33m-authy-user-phone-numbers/"
              >Twilio confirms data breach after hackers leak 33M Authy user
              phone numbers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 12:26:39</span
              ><span class="points-container"
                >Points: <span class="points">239</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40874341"
                  >Comments</a
                ><span class="descendants">: 139</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40874013">
          <h3>
            <a
              class="item"
              href="https://corecursive.com/building-powershell-with-jeffrey-snover/"
              >Jeffrey Snover and the Making of PowerShell</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 11:26:32</span
              ><span class="points-container"
                >Points: <span class="points">193</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40874013"
                  >Comments</a
                ><span class="descendants">: 179</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40873598">
          <h3>
            <a class="item" href="https://www.leiga.com/post/kanban-vs-scrum"
              >Kanban vs. Scrum: What's the difference?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 09:36:26</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40873598"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40873001">
          <h3>
            <a
              class="item"
              href="https://community.fly.io/t/fresh-produce-region-specific-machines-pricing/20690"
              >Region-specific Machines pricing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 07:17:34</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40873001"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40872978">
          <h3>
            <a class="item" href="https://www.jogmekeebs.com"
              >Show HN: I made a split keyboard for large palms</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 07:11:29</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40872978"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
            <div class="text">
              I had an issue a few years ago - every ergonomic keyboard I tried
              had the switches too close to each other and my fingers were
              cramped in that small space. Then I decided to create a keyboard
              which is suitable for larger hands and eliminates most of the
              wrist movement. 34 keys was the most optimized version for
              achieving as little wrist movement as possible. You can try the
              fitment for your palm IRL with the printable template on the
              website.
            </div>
          </section>
        </section>
        <section id="40872799">
          <h3>
            <a
              class="item"
              href="https://www.humanityredefined.com/p/superintelligence10-years-later"
              >"Superintelligence" 10 years later</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 06:28:40</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40872799"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40872438">
          <h3>
            <a class="item" href="https://blog.nelhage.com/post/fuzzy-dedup/"
              >Finding near-duplicates with Jaccard similarity and MinHash</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 05:04:09</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40872438"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40872332">
          <h3>
            <a
              class="item"
              href="https://lazamar.github.io/haskell-data-compression-with-huffman-codes/"
              >Building a data compression utility in Haskell using Huffman
              codes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 04:29:12</span
              ><span class="points-container"
                >Points: <span class="points">160</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40872332"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40872020">
          <h3>
            <a class="item" href="https://www.firezone.dev/blog/sans-io"
              >Sans-IO: The secret to effective Rust for network services</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 03:05:36</span
              ><span class="points-container"
                >Points: <span class="points">177</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40872020"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40871783">
          <h3>
            <a class="item" href="https://boyuan.space/diffusion-forcing/"
              >Diffusion Forcing: Next-Token Prediction Meets Full-Sequence
              Diffusion</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 02:09:20</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40871783"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40870357">
          <h3>
            <a
              class="item"
              href="https://www.arno.org/on-the-origins-of-ds-store"
              >The Origins of DS_store (2006)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 21:55:13</span
              ><span class="points-container"
                >Points: <span class="points">367</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40870357"
                  >Comments</a
                ><span class="descendants">: 200</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40870345">
          <h3>
            <a class="item" href="https://salykova.github.io/matmul-cpu"
              >Beating NumPy matrix multiplication in 150 lines of C</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 21:52:55</span
              ><span class="points-container"
                >Points: <span class="points">292</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40870345"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40870301">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/articles/c0vewjq4dxwo"
              >Oldest cave art found</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 21:47:43</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40870301"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40870280">
          <h3>
            <a
              class="item"
              href="https://reactormag.com/the-joy-of-reading-books-you-dont-entirely-understand/"
              >The joy of reading books you don't understand</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 21:44:47</span
              ><span class="points-container"
                >Points: <span class="points">290</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40870280"
                  >Comments</a
                ><span class="descendants">: 183</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40869877">
          <h3>
            <a class="item" href="https://0x.tools/"
              >Show HN: Xcapture-BPF â€“ like Linux top, but with Xray vision</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 20:52:37</span
              ><span class="points-container"
                >Points: <span class="points">351</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40869877"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40868504">
          <h3>
            <a
              class="item"
              href="https://zdimension.fr/analyzing-my-electricity-consumption/"
              >Analyzing my electricity consumption</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 18:04:59</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40868504"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40862941">
          <h3>
            <a
              class="item"
              href="https://biowpn.github.io/bioweapon/2024/07/02/a-type-for-overload-set.html"
              >A Type for Overload Set</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 05:22:15</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40862941"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40856225">
          <h3>
            <a
              class="item"
              href="https://conbio.onlinelibrary.wiley.com/doi/10.1111/cobi.14313"
              >Island restoration to rebuild seabird populations and amplify
              coral reefs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-02 @ 13:01:21</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40856225"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40853665">
          <h3>
            <a
              class="item"
              href="https://escapethealgorithm.substack.com/p/should-this-be-a-map-or-500-maps"
              >Should this be a map or 500 maps?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-02 @ 04:50:40</span
              ><span class="points-container"
                >Points: <span class="points">217</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40853665"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40846815">
          <h3>
            <a
              class="item"
              href="https://github.com/Racket-Cookbooks/Plot-cookbook"
              >Racket Plot Cookbook</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 15:34:36</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40846815"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40845628">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/shipt"
              >Shipt's algorithm squeezed gig workers, who fought back</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 13:21:33</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40845628"
                  >Comments</a
                ><span class="descendants">: 96</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40843185">
          <h3>
            <a
              class="item"
              href="https://www.yachtingworld.com/extraordinary-boats/faster-than-the-weather-how-comanche-took-more-than-a-day-off-the-transatlantic-record-99160"
              >Breaking transatlantic sailing record by more than a day
              (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 06:40:56</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40843185"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
