<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39817340">
          <h3>
            <a
              class="item"
              href="https://9to5mac.com/2024/03/25/app-store-proposals-rejected/"
              >EU rejects Apple's changes: Company could be fined 10% of global
              turnover</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 15:13:44</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39817340"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39817243">
          <h3>
            <a
              class="item"
              href="https://stratechery.com/2024/united-states-v-apple/"
              >United States vs. Apple</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 15:07:35</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39817243"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39817008">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/business/airlines/boeing-ceo-dave-calhoun-to-step-down-at-end-of-year-16917c94"
              >Boeing CEO Dave Calhoun to Step Down in Wake of 737 MAX
              Struggles</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 14:48:06</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39817008"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39816836">
          <h3>
            <a class="item" href="https://github.com/divriots/jampack"
              >Show HN: Jampack – Optimizes static websites as a post-processing
              step</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 14:32:46</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39816836"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
            <div class="text">
              <p>
                Jampack is a post-processing tool that takes the output of your
                Static Site Generator (aka SSG) and optimizes it for best user
                experience and best Core Web Vitals scores.
              </p>
              <p>As of today it can:</p>
              <p>- Optimize local images, CDN images or external images</p>
              <p>- Optimize above-the-fold vs below-the-fold</p>
              <p>- Limit images max width</p>
              <p>- Inline critical CSS</p>
              <p>- Prefetch links on scroll</p>
              <p>- Improve browser compatibility</p>
              <p>- Auto-fixes HTML issues</p>
              <p>- Warn for HTML accessibility issues</p>
              <p>- Compress all assets in the end</p>
              <p>
                It processes directly the static output so it's compatible with
                any SSG or framework. We are intensively using it as a
                post-processing step to our Astro websites for example.
              </p>
              <p>
                With Jampack, we end-up focusing more on how simple, readable
                and maintainable our code is, throw images of any size, and let
                it optimize for maximum performance.
              </p>
              <p>
                We hope this can be helpful to lot of people! Cheers, Georges
                and the ‹div›RIOTS team!
              </p>
            </div>
          </section>
        </section>
        <section id="39816835">
          <h3>
            <a
              class="item"
              href="https://github.com/Mechazawa/103-early-anti-adblock"
              >Show HN: Detecting adblock, without JavaScript, by abusing HTTP
              103 responses</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 14:32:43</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39816835"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39816808">
          <h3>
            <a class="item" href="https://github.com/ceritium/flatito"
              >Show HN: Flatito, grep for YAML and JSON files</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 14:30:23</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39816808"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
            <div class="text">
              <p>
                I created this tool because I sometimes struggle to find
                specific keys in typical i18n rails yamls. In the views, you
                don't always have the whole key, but it is extrapolated from the
                context. I am sure there are other use cases; I hope you find it
                useful.
              </p>
              <p>Cheers!</p>
            </div>
          </section>
        </section>
        <section id="39816423">
          <h3>
            <a
              class="item"
              href="https://thereader.mitpress.mit.edu/for-brilliant-color-packaging-the-first-lsd-blotter/"
              >For Brilliant Color: Packaging the First LSD Blotter</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 14:01:15</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39816423"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39815976">
          <h3>
            <a class="item" href="https://github.com/radiosilence/nano-web"
              >Show HN: Nano-web, a low latency one binary webserver designed
              for serving SPAs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 13:23:44</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39815976"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
            <div class="text">
              <p>
                It uses a single compiled binary, it's going to have extremely
                low latency on account of caching all files in memory at
                runtime, and also the fun feature and really useful that's good
                for SPAs (e.g. Vite) or things like Astro is that you can inject
                configuration variables into it at runtime and access them from
                within your frontend code, so you don't have to rebuild any
                images for different environments as part of your CI.
              </p>
              <p>
                Whilst I'm sure this problem has been solved time and time
                again, I could never get a solution to be quite right.
              </p>
              <p>
                Also, serving things like Astro from S3 gets to be tricky
                because CloudFront doesn't support index pages in subdirectories
                so the routing breaks. This fixes this.
              </p>
              <p>
                Use it or don't, I think it's a cool little project and it's
                been a while since I worked on and released something :)
              </p>
            </div>
          </section>
        </section>
        <section id="39815805">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/2024/03/25/travel/sagrada-familia-barcelona-completion-scli-intl/index.html"
              >Barcelona’s Sagrada Familia will be completed in 2026</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 13:06:44</span
              ><span class="points-container"
                >Points: <span class="points">208</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39815805"
                  >Comments</a
                ><span class="descendants">: 157</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39815458">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/03/25/business/germany-solar-panels-china-protectionism.html"
              >Germany's Solar Panel Industry, Once a Leader, Is Getting
              Squeezed</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 12:27:35</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39815458"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39815219">
          <h3>
            <a
              class="item"
              href="https://brainbaking.com/post/2024/03/the-case-of-a-leaky-goroutine/"
              >The Case of a Leaky Goroutine</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 12:01:48</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39815219"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39815208">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/spine-ai/jobs/ak6G8jk-senior-backend-engineer"
              >Spine AI (YC S23) Is Hiring for a Senior Back End Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 12:01:05</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39814877">
          <h3>
            <a
              class="item"
              href="https://github.com/pg-sharding/spqr/discussions/569"
              >SPQR 1.3.0: a production-ready system for horizontal scaling of
              PostgreSQL</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 11:24:39</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39814877"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39814683">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/functional-electrical-stimulation-exosuit-project"
              >Exosuit Muscle Control Steps Closer to Reality</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 10:58:16</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39814683"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39814558">
          <h3>
            <a
              class="item"
              href="https://ec.europa.eu/commission/presscorner/detail/en/ip_24_1689"
              >Commission opens non-compliance investigations against Alphabet,
              Apple and Meta</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 10:38:17</span
              ><span class="points-container"
                >Points: <span class="points">283</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39814558"
                  >Comments</a
                ><span class="descendants">: 255</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39813883">
          <h3>
            <a class="item" href="https://github.com/pyenv/pyenv"
              >Pyenv – lets you easily switch between multiple versions of
              Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 08:34:01</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39813883"
                  >Comments</a
                ><span class="descendants">: 160</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39813588">
          <h3>
            <a class="item" href="https://divy.work/turbocall.html"
              >Turbocall – the just-in-time compiler for Deno FFI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 07:41:48</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39813588"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39813438">
          <h3>
            <a
              class="item"
              href="https://www.bleepingcomputer.com/news/technology/opera-sees-big-jump-in-eu-users-on-ios-android-after-dma-update/"
              >Opera sees big jump in EU users on iOS, Android after DMA
              update</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 07:08:21</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39813438"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39812969">
          <h3>
            <a class="item" href="https://notgull.net/why-not-threads/"
              >Why choose async/await over threads?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 04:56:24</span
              ><span class="points-container"
                >Points: <span class="points">330</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39812969"
                  >Comments</a
                ><span class="descendants">: 290</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39812652">
          <h3>
            <a class="item" href="https://www.starlinkmap.org/"
              >Real-time map of every Starlink satellite in orbit</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 03:35:03</span
              ><span class="points-container"
                >Points: <span class="points">213</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39812652"
                  >Comments</a
                ><span class="descendants">: 149</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39812259">
          <h3>
            <a class="item" href="https://github.com/roboflow/supervision"
              >Supervision: Reusable Computer Vision</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 01:58:33</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39812259"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39812124">
          <h3>
            <a
              class="item"
              href="https://blog.djhaskin.com/blog/mutt-on-windows-without-wsl/"
              >Mutt on Windows Without WSL</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 01:28:34</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39812124"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39812122">
          <h3>
            <a
              class="item"
              href="https://www.swpc.noaa.gov/products/aurora-viewline-tonight-and-tomorrow-night-experimental"
              >Northern lights forecasted to be visible into upper United States
              tonight</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 01:27:46</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39812122"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39811261">
          <h3>
            <a
              class="item"
              href="https://github.com/LeoDJ/FW-EC-DongleHiderPlus"
              >DongleHider+ Framework Laptop Expansion Card</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-24 @ 22:53:33</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39811261"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39811155">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/how-quickly-do-large-language-models-learn-unexpected-skills-20240213/"
              >“Emergent” abilities in LLMs actually develop gradually and
              predictably – study</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-24 @ 22:36:33</span
              ><span class="points-container"
                >Points: <span class="points">223</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39811155"
                  >Comments</a
                ><span class="descendants">: 161</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39810378">
          <h3>
            <a class="item" href="https://github.com/Y2Z/monolith"
              >Monolith – CLI tool for saving complete web pages as a single
              HTML file</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-24 @ 20:48:06</span
              ><span class="points-container"
                >Points: <span class="points">652</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39810378"
                  >Comments</a
                ><span class="descendants">: 134</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39810320">
          <h3>
            <a
              class="item"
              href="https://lithub.com/shes-bouncing-the-ball-on-the-uncanny-way-octopuses-play/"
              >"She's bouncing the ball" – the uncanny way octopuses play</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-24 @ 20:41:59</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39810320"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39807912">
          <h3>
            <a class="item" href="https://glossarie.app/"
              >Show HN: Glossarie – a new, immersive way to learn a language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-24 @ 15:43:16</span
              ><span class="points-container"
                >Points: <span class="points">315</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39807912"
                  >Comments</a
                ><span class="descendants">: 132</span></span
              >
            </h4>
            <div class="text">
              <p>
                The idea is to introduce vocabulary and grammar whilst you read
                eBooks in your own language. I've found that it is easier to
                remember vocabulary 'in context' and with regular repetition.
                Plus you don't have to carve out dedicated time for language
                learning. Other apps require you to build a habit around various
                exercises or ‘games’, whereas lots of people already read books.
              </p>
              <p>
                From testing with early users so far it's proving effective for
                building a basic understanding of a language and quickly getting
                to the point where you can read and broadly understand text in
                the target language. It’s even better in combination with other
                apps that help with listening/speaking like Pimsleur.
              </p>
              <p>
                There were lots of technical challenges making this. It turned
                out to be (reassuringly) hard to get accuracy to an acceptable
                level, requiring a rabbit-hole into machine translation. There
                was a lot of testing required to optimise the engine that
                chooses the translations to show and to reduce the friction when
                reading books. And the backend to support uploading books is a
                beast in itself. I’d love to share details if there is interest.
              </p>
              <p>Roadmap</p>
              <p>
                - Accuracy - 100% accuracy is the target, but at present there
                can be errors. Feedback from users will be important here so
                that accuracy issues can be generalised and solved at scale.
                Errors can be reported within the app - please do so if you spot
                anything!
              </p>
              <p>
                - Dynamic difficulty - rather than have a progression of
                difficulty levels I’d prefer to introduce vocabulary and grammar
                automatically in response to user progress, balancing against
                the friction of seeing unfamiliar words. There’s a lot ‘under
                the hood’ to manage this today, but plenty of room to improve.
              </p>
              <p>
                - More practice features - to reinforce vocabulary/grammar and
                support writing, listening and speaking.
              </p>
              <p>
                - Better eBook support - improving the formatting of eBooks
                within the app and providing more methods for finding good books
                to read.
              </p>
              <p>Use of AI</p>
              <p>
                - LLMs provided a step change in accuracy and have enabled a
                feature that explains translations and grammar to the user
              </p>
              <p>- vastly improving the utility versus a year ago.</p>
              <p>
                - I believe apps like this, which use AI to enhance or scale
                functionality rather than simply acting as a wrapper over APIs,
                will be the major beneficiaries as LLMs improve.
              </p>
              <p>Take a look, and let me know your thoughts or questions!</p>
            </div>
          </section>
        </section>
        <section id="39805077">
          <h3>
            <a
              class="item"
              href="https://www.amnh.org/explore/news-blogs/on-exhibit-posts/the-immortal-jellyfish"
              >The Immortal Jellyfish (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-24 @ 04:01:21</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39805077"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39787334">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/articles/when-did-dogs-become-our-best-friends"
              >When Did Dogs Become Our Best Friends?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-22 @ 03:54:11</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39787334"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
