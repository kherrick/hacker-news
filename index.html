<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38075198">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/10/30/technology/x-twitter-19-billion-dollars.html"
              >X says it is worth $19B, down from $44B last year</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 20:19:48</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38075198"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38074992">
          <h3>
            <a
              class="item"
              href="https://blog.google/products/gmail/gmail-security-authentication-spam-protection/"
              >Gmail, Yahoo announce new 2024 authentication requirements for
              bulk senders</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 20:07:07</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38074992"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38074906">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=38074906"
              >Ask HN: Cloudflare Workers Are Down?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 20:01:36</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38074906"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
            <div class="text">
              <p>
                UPD: https://www.cloudflarestatus.com/incidents/l6x2h1zp69bc
              </p>
            </div>
          </section>
        </section>
        <section id="38074834">
          <h3>
            <a
              class="item"
              href="https://webzine.puffy.cafe/issue-16-special-octopenbsd-2023.html"
              >OpenBSD Webzine Special 2023</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 19:57:11</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38074834"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38074739">
          <h3>
            <a
              class="item"
              href="https://jacobbartlett.substack.com/p/through-the-ages-apple-cpu-architecture"
              >Apple CPU Architecture Through the Ages</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 19:51:03</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38074739"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38074701">
          <h3>
            <a class="item" href="https://youglish.com/"
              >Use YouTube to improve your English pronunciation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 19:47:10</span
              ><span class="points-container"
                >Points: <span class="points">154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38074701"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38074535">
          <h3>
            <a
              class="item"
              href="https://twitter.com/pranay01/status/1719067058736955582"
              >Open source Datadog alternative SigNoz crosses 15K GitHub
              stars</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 19:34:13</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38074535"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38074406">
          <h3>
            <a
              class="item"
              href="https://datenlord.github.io/xline-home/#/blog/2023-08-18-Introduction-to-CURP-Protocol"
              >Introduction to Curp Protocol</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 19:23:41</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38074406"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38073956">
          <h3>
            <a class="item" href="https://www.8bitdo.com/micro/"
              >8BitDo Micro</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 18:51:14</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38073956"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38073512">
          <h3>
            <a class="item" href="https://kartproject.org/"
              >Kart: DVC for geospatial and tabular data. Git for GIS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 18:22:18</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38073512"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38072756">
          <h3>
            <a
              class="item"
              href="https://neuroclastic.com/autism-and-responding-to-authority/"
              >Autism and responding to authority (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 17:38:55</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38072756"
                  >Comments</a
                ><span class="descendants">: 169</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38072277">
          <h3>
            <a
              class="item"
              href="https://zilliz.com/learn/approximate-nearest-neighbor-oh-yeah-ANNOY"
              >Approximate Nearest Neighbor Oh Yeah (Annoy)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 17:06:28</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38072277"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38072074">
          <h3>
            <a class="item" href="https://logopictureai.com/"
              >Show HN: Web app to generate AI pictures with logos "hidden" in
              them</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 16:54:09</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38072074"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
            <div class="text">
              <p>
                Some time ago I built a site that generates AI pictures in a
                style of GitHub logo (<a href="https://octoart.vercel.app/"
                  >https://octoart.vercel.app/</a
                >). It's completely free, and even official GitHub accounts in
                Twitter and Instagram (yes turns out they have Instagram) posted
                about it. It was fun.
              </p>
              <p>
                So I thought it would be cool to build an app that works with
                any logo, so people can generate nice branded pictures with
                their logo.
              </p>
              <p>
                I went on to build
                <a href="https://logopictureai.com/"
                  >https://logopictureai.com/</a
                >. It's build with Next.js, Replicate API and Supabase.
              </p>
              <p>It's a very early version, I built it in a weekend.</p>
              <p>
                It works like this: your upload a logo, type a prompt (or select
                a predefined one), select number of variations to generate and
                click a button. Images will be delivered to your email in 2-3
                minutes.
              </p>
              <p>
                As I said, it's pretty early and I am not sure if it's really
                useful. It works decently with most logos, but sometimes can
                generate something weird.
              </p>
              <p>Anyways, would love to hear your thought. Thanks!</p>
            </div>
          </section>
        </section>
        <section id="38072012">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41565-023-01527-8"
              >DNA turbine powered by a transmembrane potential across a
              nanopore</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 16:49:30</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38072012"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38071796">
          <h3>
            <a
              class="item"
              href="https://cleantechnica.com/2023/10/30/a-tiny-supercritical-carbon-dioxide-turbine-can-power-10000-homes/"
              >A Tiny Supercritical Carbon Dioxide Turbine Can Power 10k
              Homes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 16:34:42</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38071796"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38071552">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=38071552"
              >Show HN: Unlogged – open-source record and replay for Java</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 16:17:41</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38071552"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <p>
                Both Parth and I come from an e-commerce/payments background
                where production bugs meant heavy financial losses. Big billion
                days/Black Friday sales meant months of code freezes with low
                productivity. Before committing the code, we wanted to replay
                production traffic and know the breaking changes right away,
                like in sub-second. Kind of like unit+integration tests on
                steroids.
              </p>
              <p>
                So, we built an SDK that adds probes to the code in compile
                time. The SDK logs code execution, in detail.
              </p>
              <p>Git: https://github.com/unloggedio/unlogged-sdk</p>
              <p>
                We also built an IDE plugin that keeps monitoring code changes,
                hot reloads these changes, replays the relevant methods, and
                alerts on failing replays. It also lets developers call Java
                methods directly, mock downstream methods in run time, highlight
                code coverage in real-time, and show performance numbers for
                methods with inlay hints. (right above each method)
              </p>
              <p>Git: https://github.com/unloggedio/intellij-java-plugin</p>
              <p>
                We are excited to launch the first version of our product that
                replays with assertions + mocking + code coverage reports right
                inside the IDE.
              </p>
              <p>
                Link to our IntelliJ plugin:
                https://plugins.jetbrains.com/plugin/18529-unlogged/
              </p>
              <p>
                Record and Replay Demo:
                https://www.youtube.com/watch?v=muCyE-doEB0
              </p>
              <p>
                Define Assertions on Replay:
                https://www.youtube.com/watch?v=YKsi1p634-M
              </p>
              <p>
                Track Code Coverage: https://www.youtube.com/watch?v=NMmp954kfaU
              </p>
              <p>
                Generate JUnit Test Cases:
                https://www.youtube.com/watch?v=rTUmg5b1Z_Q
              </p>
              <p>
                Mocking when replaying:
                https://www.youtube.com/watch?v=O_aqU1u-Kmw
              </p>
              <p>Documentation: http://read.unlogged.io/</p>
              <p>Roadmap:</p>
              <p>1. Create a production logger</p>
              <p>-So that the performance impact is minimal</p>
              <p>-out of the box masking PII from production logs</p>
              <p>
                -creating meaningful input/return value combinations from
                production traffic to be replayed locally.
              </p>
              <p>
                2. Creating a CI test runner that can integrate with CI/CD
                pipelines.
              </p>
              <p>3. Auto-Replaying API endpoints of only the changed code.</p>
              <p>
                4. Real-time alerts for the performance impact of code changes.
              </p>
              <p>5. Creating a dashboard with reports, email/slack alerts.</p>
            </div>
          </section>
        </section>
        <section id="38071472">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/10/30/technology/facebook-meta-subscription-europe.html"
              >Meta to charge for ad-free versions of Facebook and Instagram in
              Europe</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 16:12:55</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38071472"
                  >Comments</a
                ><span class="descendants">: 141</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38071341">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Razor_1911"
              >Razor 1911</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 16:05:41</span
              ><span class="points-container"
                >Points: <span class="points">178</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38071341"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38069974">
          <h3>
            <a class="item" href="https://quic.video/blog/replacing-webrtc/"
              >Replacing WebRTC: real-time latency with WebTransport and
              WebCodecs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 14:38:36</span
              ><span class="points-container"
                >Points: <span class="points">157</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38069974"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38069915">
          <h3>
            <a
              class="item"
              href="https://robertovitillo.com/costs-of-microservices/"
              >The costs of microservices (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 14:33:41</span
              ><span class="points-container"
                >Points: <span class="points">253</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38069915"
                  >Comments</a
                ><span class="descendants">: 251</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38069659">
          <h3>
            <a
              class="item"
              href="https://odigos.io/blog/ebpf-instrumentation-faster-than-manual"
              >eBPF-based auto-instrumentation outperforms manual
              instrumentation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 14:10:22</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38069659"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38069284">
          <h3>
            <a
              class="item"
              href="https://pythonspeed.com/articles/faster-cython-simd/"
              >Speeding up Cython with SIMD</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 13:34:03</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38069284"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38068801">
          <h3>
            <a
              class="item"
              href="https://www.raspberrypi.com/news/introducing-raspberry-pi-5/#comment-1594055"
              >Raspberry Pi 5 has no hardware video encoding and only HEVC
              decoding</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 12:47:08</span
              ><span class="points-container"
                >Points: <span class="points">284</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38068801"
                  >Comments</a
                ><span class="descendants">: 195</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38068363">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Bakhshali_manuscript"
              >Bakhshali manuscript</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 12:06:54</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38068363"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38064453">
          <h3>
            <a
              class="item"
              href="http://www.rdrop.com/~half/Creations/Writings/Web.patterns/index.html"
              >Patterns for personal web sites (2003)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 00:52:48</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38064453"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38064441">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-10-spy-satellites-reveal-hundreds-undiscovered.html"
              >Spy satellites reveal undiscovered Roman forts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-30 @ 00:51:57</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38064441"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38057265">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/places/thomas-edisons-concrete-houses"
              >Thomas Edison's Concrete Houses</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-29 @ 10:31:42</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38057265"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38057112">
          <h3>
            <a
              class="item"
              href="https://www.noemamag.com/a-forgotten-prophet-whose-time-has-come/"
              >Ivan Illich’s radical critique of modern certitudes (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-29 @ 10:01:46</span
              ><span class="points-container"
                >Points: <span class="points">151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38057112"
                  >Comments</a
                ><span class="descendants">: 123</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38046674">
          <h3>
            <a class="item" href="https://ertdfgcvb.xyz/?mode=screensaver"
              >Ertdfgcvb</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-28 @ 03:00:37</span
              ><span class="points-container"
                >Points: <span class="points">196</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38046674"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38024405">
          <h3>
            <a class="item" href="https://rue-a.github.io/L-Systems/"
              >Lindenmayer Systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 11:59:48</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38024405"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
