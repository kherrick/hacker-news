<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38255923">
          <h3>
            <a
              class="item"
              href="https://www.macchaffee.com/blog/2023/solarwinds-hack-lessons-learned/"
              >We've learned nothing from the SolarWinds hack</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 21:56:51</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38255923"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38255004">
          <h3>
            <a class="item" href="https://www.macchaffee.com/blog/2023/wafs/"
              >Discouraging the use of web application firewalls</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 20:32:38</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38255004"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38254866">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-023-03511-7"
              >Future is quantum: universities look to train engineers for an
              emerging industry</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 20:22:16</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38254866"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38254835">
          <h3>
            <a
              class="item"
              href="https://alsado.ca/posts/principles-are-products-of-practice/"
              >Principles are products of practice, not the reverse</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 20:20:00</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38254835"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38254656">
          <h3>
            <a
              class="item"
              href="https://www.eff.org/deeplinks/2023/11/reauthorizing-mass-surveillance-shouldnt-be-tied-funding-government"
              >Reauthorizing Mass Surveillance Shouldn't Be Tied to Funding the
              Government</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 20:04:56</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38254656"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38254353">
          <h3>
            <a
              class="item"
              href="https://fortune.com/2023/11/08/panama-canal-congestion-record-4-million-skip-line/"
              >Panama Canal is so congested that one ship owner paid $4M to skip
              the line</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 19:43:14</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38254353"
                  >Comments</a
                ><span class="descendants">: 121</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38254153">
          <h3>
            <a
              class="item"
              href="http://jeffe.cs.illinois.edu/teaching/algorithms/"
              >Algorithms (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 19:28:01</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38254153"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38252963">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=38252963"
              >Show HN: Bitemporal – Binary JSON database system and event
              store</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 17:51:42</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38252963"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
            <div class="text">
              <p>So, what is it all about?</p>
              <p>
                The system uses ideas from ZFS (a keyed index trie, storing
                checksums in parent pages...) and Git (a persistent index
                structure that shares unchanged pages between revisions) but
                appends new tree roots on each commit [1][2].
              </p>
              <p>
                It is a JSON DBS. The system stores fine granular JSON nodes.
                Thus, there's almost no limit to the structure and size of an
                object. Objects can be arbitrarily nested, and updates are
                cheap.
              </p>
              <p>
                On a high level, it supports space-efficient snapshots, tracking
                changes by an author / optional commit messages, time travel
                queries, reverting to previous revisions (while all revisions
                in-between still exist for audits...), or retrieving the changes
                of whole (sub)trees.
              </p>
              <p>
                On the one hand, it's, thus, a bitemporal DBS, but on the other
                hand, it can be used as a simple event store. It stores the
                state after an event or a change occurs and tracks the changes.
              </p>
              <p>
                Thus, an entity, a node in the JSON structure, can be updated to
                new values and eventually be removed while the history is easily
                retrievable, or we can easily revert to a previous state. The
                system assigns a unique ID to each new node, which never changes
                and is never reused (even after the deletion of the node). Thus,
                the system stores the state after the change/event and the event
                itself (the change event).
              </p>
              <p>
                The leaf pages of the index structures are not simply copied
                during a write, but a sliding window algorithm is applied, such
                that only modified nodes and nodes that fall out of the sliding
                window have to be written. A predefined window length is
                configurable. The system avoids write-peaks, which would occur
                due to full snapshots and having to read a long chain of
                incremental changes in between.
              </p>
              <p>
                Thus, it's best suited for fast flash drives with fast random
                reads and sequential writes. Data is never overwritten thus,
                audit trails are given for free.
              </p>
              <p>
                Another aspect is that the system does not need a WAL (that is
                basically a second data store) due to atomic switches of a root
                index page and a single permitted read/write transaction (txn)
                concurrently and in parallel to N read-only txns, which are
                bound to specific revisions during the start. Reads do not
                involve any locks.[2]
              </p>
              <p>
                A path summary, an unordered set of all paths to leaf nodes in
                the tree, is built and enables various optimizations.
                Furthermore, a rolling hash is optionally built, whereas all
                ancestor node hashes are adapted during inserts.
              </p>
              <p>
                A dated Jupyter notebook with some examples can be found in [3],
                and overall documentation in [4].
              </p>
              <p>
                The query engine[5] Brackit is retargetable (a couple of
                interfaces and rewrite rules have to be implemented for DB
                systems) and especially finds implicit joins and applies known
                algorithms from the relational DB systems world to optimize
                joins and aggregate functions due to set-oriented processing of
                the operators.[6]
              </p>
              <p>
                I've given an interview in [7], but I'm usually very nervous, so
                don't judge too harshly.
              </p>
              <p>Give it a try, and happy coding!</p>
              <p>Kind regards</p>
              <p>Johannes</p>
              <p>
                [1] <a href="https://sirix.io">https://sirix.io</a> |
                <a href="https://github.com/sirixdb/sirix"
                  >https://github.com/sirixdb/sirix</a
                >
              </p>
              <p>
                [2]
                <a href="https://sirix.io/docs/concepts.html"
                  >https://sirix.io/docs/concepts.html</a
                >
              </p>
              <p>
                [3]
                <a
                  href="https://colab.research.google.com/drive/1NNn1nwSbK6hAekzo1YbED52RI3NMqqbG#scrollTo=CBWQIvc0Ov3P"
                  >https://colab.research.google.com/drive/1NNn1nwSbK6hAekzo1Yb...</a
                >
              </p>
              <p>
                [4] <a href="https://sirix.io/docs/">https://sirix.io/docs/</a>
              </p>
              <p>[5] <a href="http://brackit.io">http://brackit.io</a></p>
              <p>
                [6]
                <a
                  href="https://colab.research.google.com/drive/19eC-UfJVm_gCjY--koOWN50sgiFa5hSC"
                  >https://colab.research.google.com/drive/19eC-UfJVm_gCjY--koO...</a
                >
              </p>
              <p>
                [7]
                <a href="https://youtu.be/Ee-5ruydgqo?si=Ift73d49w84RJWb2"
                  >https://youtu.be/Ee-5ruydgqo?si=Ift73d49w84RJWb2</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="38252947">
          <h3>
            <a
              class="item"
              href="https://health.ucdavis.edu/news/headlines/researchers-identify-switch-to-activate-cancer-cell-death/2023/10"
              >Researchers identify 'switch' to activate cancer cell death</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 17:50:27</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38252947"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38252597">
          <h3>
            <a
              class="item"
              href="https://almalinux.org/blog/2023-11-13-announcing-93-stable/"
              >AlmaLinux 9.3 Stable</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 17:18:45</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38252597"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38252566">
          <h3>
            <a class="item" href="https://matthew.science/posts/occupancy/"
              >Building an occupancy sensor with a $5 ESP32 and a serverless
              DB</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 17:17:14</span
              ><span class="points-container"
                >Points: <span class="points">275</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38252566"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38252449">
          <h3>
            <a class="item" href="https://www.tng-project.org/about/"
              >Cosmological galaxy formation simulation software</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 17:08:21</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38252449"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38251957">
          <h3>
            <a
              class="item"
              href="https://embracethered.com/blog/posts/2023/google-bard-data-exfiltration/"
              >Hacking Google Bard – From Prompt Injection to Data
              Exfiltration</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 16:22:06</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38251957"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38251935">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Slow-scan_television"
              >Slow-Scan Television</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 16:20:09</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38251935"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38251842">
          <h3>
            <a
              class="item"
              href="https://jxnl.github.io/instructor/blog/2023/11/05/chain-of-density/"
              >Smarter summaries with finetuning GPT-3.5 and chain of density</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 16:12:44</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38251842"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38251330">
          <h3>
            <a
              class="item"
              href="https://blog.jim-nielsen.com/2023/html-web-components/"
              >HTML Web Components</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 15:31:43</span
              ><span class="points-container"
                >Points: <span class="points">305</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38251330"
                  >Comments</a
                ><span class="descendants">: 151</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38251032">
          <h3>
            <a
              class="item"
              href="https://gothamist.com/news/the-nypd-is-using-drones-3-times-more-than-it-did-last-year"
              >The NYPD is using drones 3 times more than it did last year</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 15:10:18</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38251032"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38250913">
          <h3>
            <a
              class="item"
              href="https://cdm.link/2023/11/black-goo-ferrofluid-synths/"
              >Black goo is the new oscilloscope: Love Hultén's ferrofluid
              synths</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 15:01:11</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38250913"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38250001">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/baltic-power-grid"
              >To free the Baltic grid, old technology is new again</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 13:42:37</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38250001"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38249742">
          <h3>
            <a
              class="item"
              href="https://github.com/DeadlyRedCube/Cathode-Retro"
              >Cathode-Retro: A collection of shaders to emulate the display of
              an NTSC signal</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 13:14:17</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38249742"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38249473">
          <h3>
            <a class="item" href="https://peergos.org/posts/blake3"
              >Reasons to Prefer Blake3 over Sha256</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 12:34:54</span
              ><span class="points-container"
                >Points: <span class="points">166</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38249473"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38249404">
          <h3>
            <a
              class="item"
              href="https://ittavern.com/url-explained-the-fundamentals/"
              >URL Explained – The Fundamentals</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 12:23:42</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38249404"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38249214">
          <h3>
            <a
              class="item"
              href="https://www.canva.dev/blog/engineering/ship-shape/"
              >Ship Shape</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 11:51:00</span
              ><span class="points-container"
                >Points: <span class="points">258</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38249214"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38248900">
          <h3>
            <a
              class="item"
              href="https://www.loro.dev/blog/loro-now-open-source"
              >Loro: Reimagine state management with CRDTs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 10:51:20</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38248900"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38248705">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/climate-solutions/2023/11/12/biggest-insect-farm-record/"
              >Why companies are racing to build the biggest bug farm</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 10:12:02</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38248705"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38248681">
          <h3>
            <a
              class="item"
              href="https://github.com/gbonacini/nuclear_rng_generation2"
              >Convert standard Geiger counter to RNG</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 10:06:03</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38248681"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38248532">
          <h3>
            <a
              class="item"
              href="https://web.williams.edu/Mathematics/lg5/Rota.pdf"
              >Lessons I wish I had learned before teaching differential
              equations [pdf] (1997)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 09:36:16</span
              ><span class="points-container"
                >Points: <span class="points">276</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38248532"
                  >Comments</a
                ><span class="descendants">: 210</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38248422">
          <h3>
            <a class="item" href="https://www.mwasoftware.co.uk/why-ibx"
              >Why IBX and Why Lazarus (2011)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 09:18:23</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38248422"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38248421">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=HDKUEXBF3B4"
              >Ruby on Rails: The Documentary [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 09:18:21</span
              ><span class="points-container"
                >Points: <span class="points">362</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38248421"
                  >Comments</a
                ><span class="descendants">: 165</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38247964">
          <h3>
            <a
              class="item"
              href="https://virtuallyfun.com/2023/11/12/dont-waste-money-on-a-math-coprocessor-they-said/"
              >Don't waste money on a math coprocessor they said</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-13 @ 07:51:00</span
              ><span class="points-container"
                >Points: <span class="points">243</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38247964"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
