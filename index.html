<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42507312">
          <h3>
            <a
              class="item"
              href="https://www.ruby-lang.org/en/news/2024/12/25/ruby-3-4-0-released/"
              >Ruby 3.4.0</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 06:40:07</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42507312"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42507185">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=IQqtsm-bBRU"
              >This open problem taught me what topology is [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 06:08:45</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42507185"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42507134">
          <h3>
            <a
              class="item"
              href="https://docs.ruby-lang.org/en/master/NEWS_md.html"
              >News for Ruby 3.4.0</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 05:49:24</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42507134"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42507116">
          <h3>
            <a class="item" href="https://papermatch.mitanshu.tech/"
              >Show HN: I made a website to semantically search ArXiv papers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 05:44:12</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42507116"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <p>
                I used MixedBread's [^1] embedding model to generate vectors
                from the abstracts. I store and search similar vectors using
                Milvus [^2] and finally use Gradio [^3] to serve the frontend. I
                update the vector database weekly by pulling the metadata
                dataset from Kaggle [^4].
              </p>
              <p>
                To speed up the search process on my free oracle instance, I
                binarise the embeddings and use Hamming distance as a metric.
              </p>
              <p>I would love your feedback on the site :) Happy Holidays!</p>
              <p>
                [1]:
                <a
                  href="https://www.mixedbread.ai/docs/embeddings/mxbai-embed-large-v1"
                  >https://www.mixedbread.ai/docs/embeddings/mxbai-embed-large-...</a
                >
                [2]: <a href="https://milvus.io/">https://milvus.io/</a> [3]:
                <a href="https://www.gradio.app/">https://www.gradio.app/</a>
                [4]:
                <a
                  href="https://www.kaggle.com/datasets/Cornell-University/arxiv"
                  >https://www.kaggle.com/datasets/Cornell-University/arxiv</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="42506577">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42506577"
              >Merry Christmas Everyone</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 03:10:07</span
              ><span class="points-container"
                >Points: <span class="points">498</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42506577"
                  >Comments</a
                ><span class="descendants">: 159</span></span
              >
            </h4>
            <div class="text"><p>- Josh :)</p></div>
          </section>
        </section>
        <section id="42506569">
          <h3>
            <a class="item" href="https://www.fixbrowser.org/"
              >Show HN: FixBrowser – a lightweight web browser created from
              scratch</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 03:08:13</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42506569"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
            <div class="text">
              <p>
                At some point I've realized that much of the complexity and
                resource requirements of web browsers comes from JavaScript.
                This is because every part needs to be dynamic and optimized for
                speed.
              </p>
              <p>
                So a few years ago I've started to work on a web browser that
                intentionally doesn't implement JavaScript, instead it contains
                an updated set of scripts that fix and improve various websites.
              </p>
              <p>
                I've been using this approach using a proxy server for a few
                years as my primary way of web browsing with good results. It
                uses a whitelist approach where no resources are loaded from
                different domains by default (the fix scripts can override it to
                load images from CDNs, etc.). This avoids any trackers by
                default.
              </p>
              <p>You can find more details on the homepage of the project:</p>
              <p>
                <a href="https://www.fixbrowser.org/"
                  >https://www.fixbrowser.org/</a
                >
              </p>
              <p>
                I'm currently running a fundraiser to get it really going. All
                the foundation blocks are there it just needs some more work.
                Any support is welcome.
              </p>
            </div>
          </section>
        </section>
        <section id="42506289">
          <h3>
            <a
              class="item"
              href="https://innocenceproject.org/how-curb-your-enthusiasm-saved-an-innocent-man-from-death-row/"
              >A Taping of 'Curb Your Enthusiasm' Saved an Innocent Man from
              Death Row (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 01:49:07</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42506289"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42506211">
          <h3>
            <a
              class="item"
              href="https://blurbusters.com/crt-simulation-in-a-gpu-shader-looks-better-than-bfi/"
              >CRT Simulation in a GPU Shader, Looks Better Than Black Frame
              Insertion</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 01:26:29</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42506211"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42506145">
          <h3>
            <a
              class="item"
              href="https://community.wolfram.com/c/portal/getImageAttachment?filename=tree.gif&amp;userId=93201"
              >T * sin (t)' ≈ Ornamented Christmas Tree (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 01:07:22</span
              ><span class="points-container"
                >Points: <span class="points">217</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42506145"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42506041">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/2024/12/21/travel/united-pilot-reunites-bone-marrow-donor/index.html"
              >A pilot raced through the airport to surprise the woman who saved
              his life</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 00:41:36</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42506041"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42505542">
          <h3>
            <a
              class="item"
              href="https://www.pcworld.com/article/2564783/gordon-mah-ung-remembered.html"
              >Gordon Mah Ung has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-24 @ 22:55:14</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42505542"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42505475">
          <h3>
            <a
              class="item"
              href="https://v5.chriskrycho.com/journal/jujutsu-megamerges-and-jj-absorb/"
              >Jujutsu Megamerges and jj Absorb</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-24 @ 22:42:41</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42505475"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42505454">
          <h3>
            <a class="item" href="https://github.com/Jaennaet/pISSStream"
              >macOS menu bar app that shows how full the ISS urine tank is in
              real time</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-24 @ 22:38:40</span
              ><span class="points-container"
                >Points: <span class="points">728</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42505454"
                  >Comments</a
                ><span class="descendants">: 156</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42505038">
          <h3>
            <a class="item" href="https://simonwillison.net/2024/Dec/24/qvq/"
              >Trying out QvQ – Qwen's new visual reasoning model</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-24 @ 21:25:32</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42505038"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42504677">
          <h3>
            <a
              class="item"
              href="https://www.abortretry.fail/p/shockley-semiconductor-laboratory"
              >Shockley Semiconductor Laboratory</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-24 @ 20:29:09</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42504677"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42504343">
          <h3>
            <a
              class="item"
              href="https://admiralcloudberg.medium.com/masks-smoke-and-mirrors-the-untold-story-of-egyptair-flight-804-42c788fcac2d"
              >Masks, Smoke, and Mirrors: The story of EgyptAir flight 804</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-24 @ 19:39:40</span
              ><span class="points-container"
                >Points: <span class="points">162</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42504343"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42499567">
          <h3>
            <a
              class="item"
              href="https://mathstodon.xyz/@johncarlosbaez/113703444230936435"
              >The number pi has an evil twin</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-24 @ 03:41:22</span
              ><span class="points-container"
                >Points: <span class="points">486</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42499567"
                  >Comments</a
                ><span class="descendants">: 189</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42497338">
          <h3>
            <a
              class="item"
              href="https://jeremymorrell.dev/blog/a-practitioners-guide-to-wide-events/"
              >A Practitioner's Guide to Wide Events</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 20:29:29</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42497338"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42494773">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-12-earth-subsurface-million-metric-tons.html"
              >Earth's subsurface may hold up to 5.6 × 10⁶ million metric tons
              of hydrogen</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 14:51:08</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42494773"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42494723">
          <h3>
            <a
              class="item"
              href="https://eclecticlight.co/2024/12/23/will-that-hub-or-dock-slow-your-ssds-or-even-make-them-faster/"
              >Will that hub or dock slow your SSDs, or even make them
              faster?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 14:45:10</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42494723"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42494293">
          <h3>
            <a
              class="item"
              href="https://petapixel.com/2024/12/09/this-incredible-camera-ignores-perspective-and-sees-behind-walls/"
              >Camera Ignores Perspective and Sees Behind Walls</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 13:38:09</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42494293"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42494127">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2211.00241"
              >Adversarial policies beat superhuman Go AIs (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 13:10:15</span
              ><span class="points-container"
                >Points: <span class="points">273</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42494127"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42493871">
          <h3>
            <a
              class="item"
              href="https://medium.com/inspiredbrilliance/exploring-lora-part-1-the-idea-behind-parameter-efficient-fine-tuning-and-lora-ec469d176c26"
              >Exploring LoRA – Part 1: The Idea Behind Parameter Efficient
              Fine-Tuning</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 12:19:26</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42493871"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42493808">
          <h3>
            <a
              class="item"
              href="https://www.cs.utexas.edu/~EWD/transcriptions/EWD08xx/EWD896.html"
              >On the nature of computing science (1984)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 12:03:18</span
              ><span class="points-container"
                >Points: <span class="points">225</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42493808"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42493688">
          <h3>
            <a class="item" href="https://github.com/siapy/siapy-lib"
              >Spectral Imaging Made Easy: A Powerful Python Library</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 11:39:17</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42493688"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42493123">
          <h3>
            <a
              class="item"
              href="https://linuxblog.io/immutable-linux-distros-are-they-right-for-you-take-the-test/"
              >Are Immutable Linux Distros right for you?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 09:39:41</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42493123"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42493027">
          <h3>
            <a
              class="item"
              href="https://yoric.github.io/post/rust-refinement-types/"
              >What would it take to add refinement types to Rust?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 09:15:27</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42493027"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42489600">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=JfZxOuc9Qwk"
              >What Happened to the Largest Tube TV? [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-22 @ 22:12:30</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42489600"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42485746">
          <h3>
            <a class="item" href="https://github.com/hoarder-app/hoarder"
              >Hoarder: Self-hostable bookmark-everything app</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-22 @ 11:34:17</span
              ><span class="points-container"
                >Points: <span class="points">334</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42485746"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42484095">
          <h3>
            <a class="item" href="https://blog.smidt.dev/posts/0004/"
              >Bit Vectors and my first steps into assembly</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-22 @ 03:00:32</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42484095"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
