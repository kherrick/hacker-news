<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40052532">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/technology/2024/apr/16/creating-sexually-explicit-deepfake-images-to-be-made-offence-in-uk"
              >Creating sexually explicit deepfake images to be made offence in
              UK</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-16 @ 14:37:39</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40052532"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40052184">
          <h3>
            <a
              class="item"
              href="https://twitter.com/paulg/status/1779930175574090094"
              >People who don't want to learn how to program can always find a
              reason not to</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-16 @ 14:14:28</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40052184"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40052069">
          <h3>
            <a
              class="item"
              href="https://gizmodo.com/your-mobile-ad-blocker-will-no-longer-stop-youtubes-ads-1851412797"
              >Mobile Ad Blocker Will No Longer Stop YouTube's Ads</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-16 @ 14:06:49</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40052069"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40051975">
          <h3>
            <a
              class="item"
              href="https://blog.mdturp.ch/posts/2024-04-05-visual_guide_to_vision_transformer.html"
              >A visual guide to Vision Transformer – A scroll story</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-16 @ 14:00:58</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40051975"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40051818">
          <h3>
            <a class="item" href="https://pmf.firstround.com/levels"
              >Product-Market Fit Isn't a Black Box – A New Framework to Help
              B2B Founders</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-16 @ 13:48:55</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40051818"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40051698">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/pc-components/cpus/amd-unveils-ryzen-pro-8040-hawk-point-and-8000-series-phoenix-processors-ai-engines-come-to-the-commercial-market"
              >AMD unveils Ryzen Pro 8000-series processors</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-16 @ 13:38:07</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40051698"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40051633">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/business/media/live-nation-justice-department-antitrust-lawsuit-ab98c268"
              >Justice Department to File Antitrust Suit Against Live Nation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-16 @ 13:31:51</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40051633"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40051597">
          <h3>
            <a
              class="item"
              href="https://www.businessinsider.com/gambling-young-men-sports-betting-crypto-meme-stock-market-addiction-2024-4"
              >To make a fortune, target bored young men who want to make a
              fortune</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-16 @ 13:26:18</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40051597"
                  >Comments</a
                ><span class="descendants">: 305</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40051223">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/RICE_(medicine)"
              >Ice to treat soft-tissue injuries contraindicated by creator of
              protocol</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-16 @ 12:42:52</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40051223"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40051191">
          <h3>
            <a
              class="item"
              href="https://aliramadhan.me/2024/03/31/trillion-rows.html"
              >Loading a trillion rows of weather data into TimescaleDB</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-16 @ 12:39:07</span
              ><span class="points-container"
                >Points: <span class="points">115</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40051191"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40051100">
          <h3>
            <a
              class="item"
              href="https://jalopnik.com/10-million-in-gold-disguised-as-machine-parts-seized-f-1851397958"
              >$10M in Gold Disguised as Machine Parts Seized from Cargo
              Plane</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-16 @ 12:27:24</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40051100"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40050914">
          <h3>
            <a class="item" href="https://onesignal.com/careers#section-job"
              >OneSignal (YC S11) Is Hiring Engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-16 @ 12:01:15</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40050717">
          <h3>
            <a
              class="item"
              href="https://blog.abctaylor.com/what-would-happen-to-low-latency-trading-if-exchanges-moved-to-the-cloud/"
              >Thoughts on low latency trading if exchanges went full cloud</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-16 @ 11:28:12</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40050717"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40049623">
          <h3>
            <a class="item" href="https://github.com/SilinMeng0510/imgcatr"
              >Show HN: a Rust based CLI tool 'imgcatr' for displaying images</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-16 @ 08:30:46</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40049623"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
            <div class="text">cat for images, by RUST</div>
          </section>
        </section>
        <section id="40049400">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/science/2024/apr/16/astronomers-discover-milky-way-biggest-stellar-black-hole-bh3-33-times-size-of-sun"
              >Astronomers discover Milky Way's biggest stellar black hole–33
              times size of sun</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-16 @ 07:50:36</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40049400"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40048177">
          <h3>
            <a class="item" href="https://github.com/kevinbentley/Descent3"
              >Descent 3 Source Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-16 @ 03:49:06</span
              ><span class="points-container"
                >Points: <span class="points">876</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40048177"
                  >Comments</a
                ><span class="descendants">: 206</span></span
              >
            </h4>
            <div class="text">
              Someone recently asked if the source code from Descent 3 will be
              released. I reached out to my old boss (Matt Toschlog) at Outrage
              Entertainment and he gave me the go ahead. I'm going to work on
              getting this running again and I'm looking for some
              co-maintainers.
            </div>
          </section>
        </section>
        <section id="40047806">
          <h3>
            <a
              class="item"
              href="https://maphappenings.com/2024/04/11/story-of-etak/"
              >A curious phenomenon called 'Etak'</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-16 @ 02:27:23</span
              ><span class="points-container"
                >Points: <span class="points">487</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40047806"
                  >Comments</a
                ><span class="descendants">: 125</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40047212">
          <h3>
            <a class="item" href="https://github.com/honojs/hono"
              >HonoJS: Small, simple, and ultrafast web framework for the
              Edges</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-16 @ 00:41:33</span
              ><span class="points-container"
                >Points: <span class="points">224</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40047212"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40047193">
          <h3>
            <a
              class="item"
              href="https://www.space.com/object-crash-florida-home-iss-space-junk-nasa-confirms"
              >Object that slammed into Florida home was space junk for ISS,
              NASA confirms</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-16 @ 00:38:47</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40047193"
                  >Comments</a
                ><span class="descendants">: 138</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40047152">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2404.07738"
              >ResearchAgent: Iterative Research Idea Generation Using LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-16 @ 00:29:40</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40047152"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40047041">
          <h3>
            <a class="item" href="https://github.com/johang/btfs"
              >BTFS: BitTorrent Filesystem</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-16 @ 00:08:46</span
              ><span class="points-container"
                >Points: <span class="points">299</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40047041"
                  >Comments</a
                ><span class="descendants">: 89</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40046774">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40046774"
              >Show HN: Render audio waveforms to HTML canvas using WebGPU</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 23:23:28</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40046774"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
            <div class="text">
              <p>
                It's the first time I use WebGPU and it's been a while since I
                write shaders. Feedback is very welcome!
              </p>
              <p>
                GitHub: https://github.com/mrkev/webgpu-waveform Examples:
                https://aykev.dev/webgpu-waveform
              </p>
            </div>
          </section>
        </section>
        <section id="40044901">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Ramanujan%27s_lost_notebook"
              >Ramanujan's lost notebook</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 19:54:14</span
              ><span class="points-container"
                >Points: <span class="points">256</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40044901"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40044863">
          <h3>
            <a
              class="item"
              href="https://www.orlandoweekly.com/news/phone-conversations-with-law-enforcement-can-be-recorded-without-their-consent-court-says-36640808"
              >Phone conversations with law enforcement can be recorded without
              their consent</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 19:49:42</span
              ><span class="points-container"
                >Points: <span class="points">343</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40044863"
                  >Comments</a
                ><span class="descendants">: 250</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40044665">
          <h3>
            <a
              class="item"
              href="https://www.chiark.greenend.org.uk/~sgtatham/putty/wishlist/vuln-p521-bias.html"
              >PuTTY vulnerability vuln-p521-bias</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 19:24:52</span
              ><span class="points-container"
                >Points: <span class="points">487</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40044665"
                  >Comments</a
                ><span class="descendants">: 182</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40041198">
          <h3>
            <a
              class="item"
              href="https://axleos.com/building-a-gps-receiver-part-1-hearing-whispers/"
              >Show HN: Building a GPS receiver</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 14:42:10</span
              ><span class="points-container"
                >Points: <span class="points">468</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40041198"
                  >Comments</a
                ><span class="descendants">: 118</span></span
              >
            </h4>
            <div class="text">
              <p>
                Shortly after publishing my iOS 4 jailbreak last October[1], I
                got to work on my next hobby project: a from-scratch homebrew
                GPS receiver, which can solve the user’s location solely from
                billions of radio antenna samples.
              </p>
              <p>
                I took a commodity SDR (alongside the Python standard library
                and numpy) and built a signal processing pipeline that can
                detect and track GPS satellites over many minutes, drop and pick
                up satellites as they come in and out of view, and precisely
                determine the user’s position and clock inaccuracy.
              </p>
              <p>
                All told, gypsum can go from a cold start to a fix on the user’s
                position, and the precise time, in less than a minute of
                listening to the antenna. I went on a journey of learning how to
                detect and track satellite signals that are literally too quiet
                to hear, and I hope that some of the magic comes through in the
                posts!
              </p>
              <p>
                After implementing this myself and walking the long road of
                getting it working, I’m left completely stunned by the
                brilliance of GPS, across so many axes. I hope you enjoy the
                read!
              </p>
              <p>
                On a more personal note, I’ll be starting a new job next week
                which isn’t as amenable to publishing side projects, and
                therefore this will be my last publicly-published project for
                some time. I’ve had great experiences making and sharing
                projects on here, and I’m really grateful for the positive
                feedback that’s been shared!
              </p>
              <p>
                [1]:
                <a href="https://news.ycombinator.com/item?id=37736318"
                  >https://news.ycombinator.com/item?id=37736318</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="40038309">
          <h3>
            <a
              class="item"
              href="https://www.forbes.com/sites/passionoftheweiss/2016/02/19/the-queen-of-sample-clearance-an-interview-with-deborah-mannis-gardner/"
              >The Queen of Sample Clearance: An Interview with Deborah
              Mannis-Gardner (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 09:15:58</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40038309"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40037589">
          <h3>
            <a
              class="item"
              href="https://amu.hal.science/hal-04167028/file/tcs2023-1.pdf"
              >Trap spaces of Boolean networks are conflict-free siphons of
              their Petri net [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 06:30:50</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40037589"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40037486">
          <h3>
            <a
              class="item"
              href="https://dpolakovic.space/blogs/windows-95-printer-hack"
              >Reproducing the printer hack of Windows 95</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 06:04:53</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40037486"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40029469">
          <h3>
            <a
              class="item"
              href="https://www.cambridge.org/core/journals/journal-of-functional-programming/article/knuthmorrispratt-illustrated/8EFA77D663D585B68630E372BCE1EBA4"
              >Knuth–Morris–Pratt illustrated</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-14 @ 07:55:22</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40029469"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
