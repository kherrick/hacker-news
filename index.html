<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43314851">
          <h3>
            <a
              class="item"
              href="https://www.richardmorris.org/blog-1-1/vilhelm-hammershi-the-eminence-in-greys"
              >Vilhelm Hammersh√∏i: the eminence in greys</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-09 @ 23:00:25</span
              ><span class="points-container"
                >Points: <span class="points">3</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43314851"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43314657">
          <h3>
            <a
              class="item"
              href="https://randomaugustine.medium.com/on-apple-exclaves-d683a2c37194"
              >Apple Exclaves</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-09 @ 22:38:57</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43314657"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43314334">
          <h3>
            <a
              class="item"
              href="https://www.economist.com/finance-and-economics/2025/03/02/el-salvadors-wild-crypto-experiment-ends-in-failure"
              >El Salvador's crypto experiment ends in failure</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-09 @ 21:58:27</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43314334"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43314171">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2025/03/08/kernel_sanders_apple_rearranges_xnu/"
              >Apple rearranged its XNU kernel with exclaves</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-09 @ 21:40:03</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43314171"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43313781">
          <h3>
            <a
              class="item"
              href="https://scitechdaily.com/scientists-just-discovered-an-rna-that-repairs-dna-damage-and-its-a-game-changer/"
              >Scientists discover an RNA that repairs DNA damage</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-09 @ 21:02:47</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43313781"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43313706">
          <h3>
            <a
              class="item"
              href="https://www.phoronix.com/news/Wine-Framework-Mono-6.14"
              >Wine Releases Framework Mono 6.14 in Taking over the Mono
              Project</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-09 @ 20:55:48</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43313706"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43313574">
          <h3>
            <a
              class="item"
              href="https://www.sciencedirect.com/science/article/pii/S1550413125000063"
              >Aspartame aggravates atherosclerosis through insulin-triggered
              inflammation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-09 @ 20:44:08</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43313574"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43313522">
          <h3>
            <a class="item" href="https://dmitri.shuralyov.com/idiomatic-go"
              >Idiomatic Go (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-09 @ 20:40:04</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43313522"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43313321">
          <h3>
            <a class="item" href="https://websvg.com/"
              >Show HN: I built a free SVG Web site</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-09 @ 20:20:13</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43313321"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
            <div class="text">
              This has been an experiment to see if I could create everything
              using scripts and AI. If AI couldn't do it I'd get it to create
              the code such as API calls and so on. This websvg.com site was
              completely created using these AI tools. Including the DNS being
              applied, the Cloudflare Pages were automatically set up and the
              the web site was a Svelte 5 application generated by v0.dev and
              Cursor. Every image was generated in Midjourney and converted to
              SVG. I have now taken all of these scripts and can create a
              similar landing or directory site in less than a minute, provided
              I have the data. Anyway it's been fun.
            </div>
          </section>
        </section>
        <section id="43312652">
          <h3>
            <a class="item" href="https://rodyne.com/?p=1828"
              >With AI you need to think bigger</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-09 @ 19:18:41</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43312652"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43311696">
          <h3>
            <a
              class="item"
              href="https://www.thebignewsletter.com/p/hatching-a-conspiracy-a-big-investigation"
              >An investigation into egg prices</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-09 @ 17:49:17</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43311696"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43311610">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2025-02-nickel-superconductor-233c-threshold-pressure.html"
              >Nickel superconductor works above -233¬∞C threshold at normal
              pressure</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-09 @ 17:43:15</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43311610"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43311573">
          <h3>
            <a class="item" href="https://blog.ecosia.org/eusp/"
              >Ecosia is teaming up with Qwant to build a European search
              index</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-09 @ 17:40:38</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43311573"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43311044">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/infisical/jobs/QqCs5fv-full-stack-engineer-sf"
              >Infisical (YC W23) Is Hiring for Full Stack Engineers in San
              Francisco</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-09 @ 17:00:35</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43310963">
          <h3>
            <a
              class="item"
              href="https://github.com/matiasmolinas/evolving-agents"
              >Show HN: Evolving Agents Framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-09 @ 16:51:59</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43310963"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
            <div class="text">
              <p>
                I've been working on an open-source framework for creating AI
                agents that evolve, communicate, and collaborate to solve
                complex tasks. The Evolving Agents Framework allows agents to:
              </p>
              <p>
                Reuse, evolve, or create new agents dynamically based on
                semantic similarity Communicate and delegate tasks to other
                specialized agents Continuously improve by learning from past
                executions Define workflows in YAML, making it easy to
                orchestrate agent interactions Search for relevant tools and
                agents using OpenAI embeddings Support multiple AI frameworks
                (BeeAI, etc.) Current Status &amp; Roadmap This is still a draft
                and a proof of concept (POC). Right now, I‚Äôm focused on
                validating it in real-world scenarios to refine and improve it.
              </p>
              <p>
                Next week, I'm adding a new feature to make it useful for
                distributed multi-agent systems. This will allow agents to work
                across different environments, improving scalability and
                coordination.
              </p>
              <p>
                Why? Most agent-based AI frameworks today require manual
                orchestration. This project takes a different approach by
                allowing agents to decide and adapt based on the task at hand.
                Instead of always creating new agents, it determines if existing
                ones can be reused or evolved.
              </p>
              <p>
                Example Use Case: Let‚Äôs say you need an invoice analysis agent.
                Instead of manually configuring one, our framework: Checks if a
                similar agent exists (e.g., a document analyzer) Decides whether
                to reuse, evolve, or create a new agent Runs the best agent and
                returns the extracted information
              </p>
              <p>Here's a simple example in Python:</p>
              <p>
                import asyncio from evolving_agents.smart_library.smart_library
                import SmartLibrary from evolving_agents.core.llm_service import
                LLMService from evolving_agents.core.system_agent import
                SystemAgent
              </p>
              <p>
                async def main(): library = SmartLibrary("agent_library.json")
                llm = LLMService(provider="openai", model="gpt-4o") system =
                SystemAgent(library, llm)
              </p>
              <p></p>
              <pre><code>    result = await system.decide_and_act(
        request="I need an agent that can analyze invoices and extract the total amount",
        domain="document_processing",
        record_type="AGENT"
    )

    print(f"Decision: {result['action']}")  # 'reuse', 'evolve', or 'create'
    print(f"Agent: {result['record']['name']}")
</code></pre>
              if __name__ == "__main__": asyncio.run(main())
              <p>
                Next Steps Validating in real-world use cases and improving
                agent evolution strategies Adding distributed multi-agent
                support for better scalability Full integration with BeeAI Agent
                Communication Protocol (ACP) Better visualization tools for
                debugging Would love feedback from the HN community! What
                features would you like to see?
              </p>
              <p>
                Repo:
                <a href="https://github.com/matiasmolinas/evolving-agents"
                  >https://github.com/matiasmolinas/evolving-agents</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="43310253">
          <h3>
            <a class="item" href="https://binocularshot.com/">Binocular Shot</a>
          </h3>
          <section>
            <h4>
              <span>2025-03-09 @ 15:55:08</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43310253"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43308994">
          <h3>
            <a
              class="item"
              href="https://pippinbarr.com/it-is-as-if-you-were-on-your-phone/info/"
              >It is as if you were on your phone</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-09 @ 13:40:35</span
              ><span class="points-container"
                >Points: <span class="points">486</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43308994"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43307809">
          <h3>
            <a
              class="item"
              href="https://twitter.com/Steve_Yegge/status/1898674257808515242"
              >I've been using Claude Code for a couple of days</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-09 @ 10:20:50</span
              ><span class="points-container"
                >Points: <span class="points">171</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43307809"
                  >Comments</a
                ><span class="descendants">: 238</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43305803">
          <h3>
            <a class="item" href="https://dynomight.net/theanine/"
              >My 16-month theanine self-experiment</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-09 @ 03:08:12</span
              ><span class="points-container"
                >Points: <span class="points">712</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43305803"
                  >Comments</a
                ><span class="descendants">: 366</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43302394">
          <h3>
            <a
              class="item"
              href="https://nicula.xyz/2025/03/08/improving-stdcountif-vectorization.html"
              >Improving on std:count_if()'s auto-vectorization</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-08 @ 18:44:19</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43302394"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43289990">
          <h3>
            <a
              class="item"
              href="https://www.cbc.ca/radio/quirks/pendant-ancient-dna-1.6832580"
              >Woman's DNA discovered in 20k year old deer-tooth pendant</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-07 @ 13:30:08</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43289990"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43289774">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/2025/03/01/science/leonardo-da-vinci-sforza-castle-tunnels/index.html"
              >Mysterious tunnels sketched by Leonardo may have been found</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-07 @ 12:55:02</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43289774"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43289550">
          <h3>
            <a
              class="item"
              href="https://www.spectator.co.uk/article/bring-back-shortwave/"
              >Bring Back Shortwave</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-07 @ 12:16:16</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43289550"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43289247">
          <h3>
            <a
              class="item"
              href="https://www.goto10retro.com/p/sublogic-flight-simulator"
              >Sublogic Flight Simulator</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-07 @ 11:16:57</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43289247"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43287193">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2502.00316"
              >The Kernighan-Lin Search Algorithm</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-07 @ 03:32:47</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43287193"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43284541">
          <h3>
            <a
              class="item"
              href="https://devblogs.microsoft.com/oldnewthing/20250214-00/?p=110868"
              >Investigating an argument-dependent lookup issue and working
              around it</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-06 @ 20:03:51</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43284541"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43283214">
          <h3>
            <a
              class="item"
              href="https://www.core77.com/posts/135763/Japans-Clever-Anti-Snow-Roadways"
              >Japan's Clever Anti-Snow Roadways</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-06 @ 18:12:26</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43283214"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43281275">
          <h3>
            <a
              class="item"
              href="https://theahura.substack.com/p/ilyas-30-papers-to-carmack-vlaes"
              >Paper Review: Variational Lossy Auto-Encoders</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-06 @ 15:23:42</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43281275"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43280517">
          <h3>
            <a
              class="item"
              href="https://leandromoreira.com/2019/08/02/linux-ffmpeg-source-internals-a-good-software-design/"
              >Exploring Polymorphism in C: Lessons from Linux and FFmpeg's Code
              Design (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-06 @ 14:23:24</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43280517"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43268477">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2502.14882"
              >16-Bit to 1-Bit: Visual KV Cache Quantization for Efficient
              Multimodal LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-05 @ 16:09:26</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43268477"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
