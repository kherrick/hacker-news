<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="35372111">
          <h3>
            <a class="item" href="https://hexcloud.co/docs"
              >Show HN: Data Ingestion / Transformation SaaS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-30 @ 13:10:40</span
              ><span class="points-container"
                >Points: <span class="points">0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35371750">
          <h3>
            <a
              class="item"
              href="https://nymag.com/strategist/article/led-light-bulbs-investigation.html"
              >There's something off about LED bulbs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-30 @ 12:42:21</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35371750"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35371541">
          <h3>
            <a class="item" href="https://ergomake.dev/blog/hsts-introduction/"
              >The Fascinating World of HTTP Strict-Transport-Security</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-30 @ 12:25:12</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35371541"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35371469">
          <h3>
            <a class="item" href="https://gut-cli.dev"
              >Show HN: Gut – An easy-to-use CLI for Git</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-30 @ 12:18:56</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35371469"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
            <div class="text">
              <p>I’m Julien and I built an alternative CLI for Git : gut.</p>
              <p>
                Even if I haven’t been coding for a long time (I’m in the first
                year studying computer science), I’ve always found git to be
                frustrating. The command naming is inconsistent and git lets you
                easily shoot yourself in the foot.
              </p>
              <p>I made gut, another git porcelain, to solve these issues.</p>
              <p>
                It provides a consistent naming of command. To do so, syntax is
                based on subcommands. For example, to delete a branch, run gut
                branch rm rather than git branch -d, same to delete a remote
                (gut remote rm) and so on.
              </p>
              <p>
                Gut also prevents you from shooting yourself. It provides nice
                defaults and always prompt you before doing something
                destructive. Also, it won’t allow you to rewrite the history if
                it has been pushed to the remote. Creating commits in detached
                head is also prohibited.
              </p>
              <p>
                Finally, git was made when GitHub and others didn’t existed yet.
                To diff commits, gut opens the compare view in the browser. And
                to merge a branch, gut opens a pull request.
              </p>
              <p>
                I have been working on this project for the past few months and
                I am happy to be able to share it.
              </p>
              <p>I hope you’ll like it. Any suggestions is welcome !</p>
              <p>
                Repo:
                <a href="https://github.com/julien040/gut"
                  >https://github.com/julien040/gut</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="35371296">
          <h3>
            <a
              class="item"
              href="https://mastodon.social/@bagder/110102954036946925"
              >Bloomberg sponsors curl with 10K USD</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-30 @ 12:01:18</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35371296"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35371293">
          <h3>
            <a
              class="item"
              href="https://github.com/laudspeaker/laudspeaker/tree/Hiring"
              >Laudspeaker hiring Product Eng for open source customer journey
              automation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-30 @ 12:00:46</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35371261">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/technology/streaming-device-maker-roku-cut-200-jobs-second-round-layoffs-2023-03-30/"
              >Streaming company Roku to lay off 6% workforce</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-30 @ 11:57:08</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35371261"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35370963">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/2023/03/29/business/egg-profits-cal-maine/index.html"
              >High egg prices send profits at largest US producer soaring more
              than 700%</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-30 @ 11:21:25</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35370963"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35370731">
          <h3>
            <a
              class="item"
              href="https://tutanota.com/blog/posts/eu-client-side-scanning"
              >Germany opposes client-side scanning planned by EU</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-30 @ 10:53:05</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35370731"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35370728">
          <h3>
            <a
              class="item"
              href="https://blog.sandworm.dev/one-in-two-new-npm-packages-is-seo-spam-right-now"
              >50% of new NPM packages are spam</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-30 @ 10:52:52</span
              ><span class="points-container"
                >Points: <span class="points">242</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35370728"
                  >Comments</a
                ><span class="descendants">: 184</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35370357">
          <h3>
            <a
              class="item"
              href="https://johanwind.github.io/2023/03/23/rwkv_overview.html"
              >The RWKV language model: An RNN with the advantages of a
              transformer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-30 @ 10:03:47</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35370357"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35370284">
          <h3>
            <a class="item" href="https://github.com/KTStephano/StratusGFX"
              >Show HN: Yesterday I open sourced StratusGFX, a realtime 3D
              rendering engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-30 @ 09:55:25</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35370284"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
            <div class="text">
              <p>
                A feature reel showing its capabilities can be found here:
                <a
                  href="https://ktstephano.github.io/rendering/stratusgfx/feature_reel"
                  >https://ktstephano.github.io/rendering/stratusgfx/feature_re...</a
                >
              </p>
              <p>
                A technical breakdown of a single frame can be found here:
                <a
                  href="https://ktstephano.github.io/rendering/stratusgfx/frame_analysis"
                  >https://ktstephano.github.io/rendering/stratusgfx/frame_anal...</a
                >
              </p>
              <p>
                It's still in a very beta state (bugs and instability expected),
                but I felt like it was a good time to make it public since a lot
                of its core features are mostly presentable. I plan to continue
                working on it in my spare time to try and improve the usability
                of the code.
              </p>
              <p>Two main use cases I could see for it:</p>
              <p>1) People using it for educational purposes.</p>
              <p>
                2) People integrating it into other more general purpose engines
                that they're working on since Stratus is primarily a rendering
                engine. Any extensions to the rendering code that are made
                public would then further help others.
              </p>
              <p>
                So I think it will remain very niche but I'm hoping it will
                still be helpful for people in the future.
              </p>
            </div>
          </section>
        </section>
        <section id="35369084">
          <h3>
            <a
              class="item"
              href="https://medium.com/@kaleberg7/apl-an-array-oriented-programming-language-b03fb39401c1"
              >APL: An Array Oriented Programming Language (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-30 @ 07:00:35</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35369084"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35369075">
          <h3>
            <a
              class="item"
              href="https://www.vice.com/en/article/4a3ddb/restrict-act-insanely-broad-ban-tiktok-vpns"
              >The 'Insanely Broad' Restrict Act Could Ban Much More Than Just
              TikTok</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-30 @ 06:59:50</span
              ><span class="points-container"
                >Points: <span class="points">237</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35369075"
                  >Comments</a
                ><span class="descendants">: 153</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35368813">
          <h3>
            <a
              class="item"
              href="https://blog.glyph.im/2023/03/incompetent-but-nice-response.html"
              >A Response to Jacob Kaplan-Moss’s “Incompetent but Nice”</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-30 @ 06:24:48</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35368813"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35368053">
          <h3>
            <a
              class="item"
              href="https://lightning.ai/pages/blog/gradient-accumulation/"
              >Finetuning LLMs on a Single GPU Using Gradient Accumulation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-30 @ 04:39:27</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35368053"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35367520">
          <h3>
            <a
              class="item"
              href="https://ohadravid.github.io/posts/2023-03-rusty-python/"
              >Making Python faster with Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-30 @ 03:25:52</span
              ><span class="points-container"
                >Points: <span class="points">296</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35367520"
                  >Comments</a
                ><span class="descendants">: 142</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35366955">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=FWQGA_n5Z4M"
              >TikTok Ban Bill Is Patriot Act 2.0 Trojan Horse [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-30 @ 02:17:23</span
              ><span class="points-container"
                >Points: <span class="points">695</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35366955"
                  >Comments</a
                ><span class="descendants">: 348</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35366838">
          <h3>
            <a class="item" href="https://github.com/PrefectHQ/marvin"
              >Show HN: Marvin – build AI functions that use an LLM as a
              runtime</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-30 @ 02:04:39</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35366838"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
            <div class="text">
              <p>
                Marvin introduces a new concept called AI Functions. These look
                and feel just like regular Python functions: you provide typed
                inputs, outputs, and docstrings. However, instead of relying on
                traditional source code, AI functions use LLMs like GPT-4 as a
                sort of “runtime” to generate outputs on-demand, based on the
                provided inputs and other details. The results are then parsed
                and converted back into native data types.
              </p>
              <p>
                This “functional prompt engineering” means you can seamlessly
                integrate AI functions with your existing codebase. You can
                chain them together with other functions to form sophisticated,
                AI-enabled pipelines. They’re particularly useful for tasks that
                are simple to describe yet challenging to code, such as entity
                extraction, semantic scraping, complex filtering, template-based
                data generation, and categorization. For example, you could
                extract terms from a contract as JSON, scrape websites for
                quotes that support an idea, or build a list of questions from a
                customer support request. All of these would yield structured
                data that you could immediately start to process.
              </p>
              <p>
                We initially created Marvin to tackle broad internal use cases
                in customer service and knowledge synthesis. AI Functions are
                just a piece of that, but have proven to be even more effective
                than we anticipated, and have quickly become one of our favorite
                features! We’re eager for you to try them out for yourself.
              </p>
              <p>
                We’d love to hear your thoughts, feedback, and any creative ways
                you could use Marvin in your own projects. Let’s discuss in the
                comments!
              </p>
            </div>
          </section>
        </section>
        <section id="35365440">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/news/letter-from-the-southwest/the-horrifying-epidemic-of-teen-age-fentanyl-deaths-in-a-texas-county"
              >Teen-age fentanyl deaths in a Texas county</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 23:31:09</span
              ><span class="points-container"
                >Points: <span class="points">190</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35365440"
                  >Comments</a
                ><span class="descendants">: 489</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35365399">
          <h3>
            <a class="item" href="https://sites.research.google/usm/"
              >Universal Speech Model</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 23:27:32</span
              ><span class="points-container"
                >Points: <span class="points">463</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35365399"
                  >Comments</a
                ><span class="descendants">: 166</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35364383">
          <h3>
            <a
              class="item"
              href="https://www.wiz.io/blog/azure-active-directory-bing-misconfiguration"
              >AAD misconfiguration led to Bing.com results manipulation,
              account takeover</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 21:58:41</span
              ><span class="points-container"
                >Points: <span class="points">268</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35364383"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35361991">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/features/2021-11-19/to-fight-floods-new-york-city-rebuilds-a-wall-of-oysters"
              >New York City is building a wall of oysters to fend off floods
              (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 19:22:37</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35361991"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35361252">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/XML_appliance"
              >XML Appliance</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 18:29:41</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35361252"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35358873">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=35358873"
              >Launch HN: Vocode (YC W23) – Library for voice conversation with
              LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 15:43:36</span
              ><span class="points-container"
                >Points: <span class="points">302</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35358873"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/vocodedev/vocode-python"
                >https://github.com/vocodedev/vocode-python</a
              >
              and our docs are at
              <a href="https://docs.vocode.dev">https://docs.vocode.dev</a>.
              <p>
                Building realtime voice apps with LLMs is powerful but hard. You
                have to orchestrate the speech recognition, LLM, and speech
                synthesis in real-time (all async)–while handling the complexity
                of conversation (like understanding when someone is finished
                speaking or handling interruptions).
              </p>
              <p>
                Our library is easy to get up and running–you can set up a
                conversation in &lt;15 lines of code. Check out our Gen Z GPT
                hotline demo:
                <a href="https://replit.com/@vocode/Gen-Z-Phone"
                  >https://replit.com/@vocode/Gen-Z-Phone</a
                >
                (try it out at +1-650-729-9536).
              </p>
              <p>
                It all started with our PrankGPT project that we built for fun
                (quick demo at
                <a
                  href="https://www.loom.com/share/0d0d68f1a62f409eb5ae24521293d2dc"
                  >https://www.loom.com/share/0d0d68f1a62f409eb5ae24521293d2dc</a
                >). We realized how powerful voice + LLMs are but that it was
                hard to build.
              </p>
              <p>
                Once we got everything working, it was really cool and useful.
                Talking to LLMs is better than all the voice AI experiences
                we’ve had before. And, we imagined a host of cool applications
                that people can build on top of that.
              </p>
              <p>
                So, we decided to build a developer tool to make it easy. Our
                library is open source and gives you everything you need in a
                single place.
              </p>
              <p>
                We give you a bunch of integrations out-of-the-box to speech
                recognition/synthesis providers and let you swap them out
                easily. We have platform support across web and telephony (via
                Twilio), with mobile coming soon. We also provide abstractions
                for streaming conversation (this is good for realtime apps like
                phone calls) and for command-based/turn-based applications (like
                voice-based chess). And, we provide customizability around how
                the conversation is done—things like how to know when someone is
                finished speaking, changing emotion, sending filler audio if
                there are delays, etc.
              </p>
              <p>
                In terms of “how do you make money” – we have a hosted version
                that we’re going to charge for (though right now you can get it
                for free!
                <a href="https://app.vocode.dev">https://app.vocode.dev</a>) and
                we're also going to build enterprise products in the future.
              </p>
              <p>
                We’d love for you to try it out and give us some feedback! And,
                if you have any demos you'd like to see – let us know and we’ll
                take a crack at building them. We’re curious about your
                experiences using or building voice AI, what features or use
                cases you’d love to see, and any other ideas you have to share!
              </p>
            </div>
          </section>
        </section>
        <section id="35356052">
          <h3>
            <a
              class="item"
              href="https://mitadmissions.org/blogs/entry/how-to-draw-dotted-lines-on-chalkboards-mit-style/"
              >How to draw dotted lines on chalkboards, MIT style (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 12:13:40</span
              ><span class="points-container"
                >Points: <span class="points">224</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35356052"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35355521">
          <h3>
            <a class="item" href="https://arxiv.org/abs/1908.00490"
              >“Terrascope”: The possibility of using the Earth as an
              atmospheric lens (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 11:18:39</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35355521"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35355136">
          <h3>
            <a
              class="item"
              href="https://www.bigwallgear.com/p/zion-climbing-in-the-1930s"
              >Zion Climbing in the 1930s</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 10:30:26</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35355136"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35354032">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2023/03/great-espresso-isnt-hard-enough-so-heres-a-diy-open-source-machine-for-it/"
              >Open source espresso machine is one delicious rabbit hole inside
              another</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-29 @ 08:02:04</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35354032"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35348353">
          <h3>
            <a
              class="item"
              href="https://futureoflife.org/open-letter/pause-giant-ai-experiments/"
              >Pause Giant AI Experiments: An Open Letter</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-03-28 @ 21:43:33</span
              ><span class="points-container"
                >Points: <span class="points">807</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35348353"
                  >Comments</a
                ><span class="descendants">: 1093</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
