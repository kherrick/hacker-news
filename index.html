<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44609616">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/ai/2025/07/exhausted-man-defeats-ai-model-in-world-coding-championship/"
              >Exhausted man defeats AI model in world coding championship</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-18 @ 20:43:12</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44609616"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44609137">
          <h3>
            <a
              class="item"
              href="https://burn.dev/blog/sota-multiplatform-matmul/"
              >Multiplatform Matrix Multiplication Kernels</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-18 @ 19:59:49</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44609137"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44609130">
          <h3>
            <a
              class="item"
              href="https://paulkedrosky.com/honey-ai-capex-ate-the-economy/"
              >AI CapEx Is Eating the Economy</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-18 @ 19:59:04</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44609130"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44608998">
          <h3>
            <a
              class="item"
              href="https://old.reddit.com/r/Steam/comments/1m000kp/trying_to_send_a_sticker_in_steam_chat_burned/"
              >Trying to send a sticker in Steam Chat burned through a month of
              mobile data</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-18 @ 19:44:48</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44608998"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44608856">
          <h3>
            <a
              class="item"
              href="https://github.com/bitnami/charts/issues/35164"
              >Broadcom to discontinue free Bitnami Helm charts</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-18 @ 19:29:52</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44608856"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44608840">
          <h3>
            <a class="item" href="https://www.librari.io/"
              >Show HN: I built library management app for those who outgrew
              spreadsheets</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-18 @ 19:28:34</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44608840"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
            <div class="text">
              <p>
                The Problem: I have 500+ books across multiple rooms in my house
                and was desperately looking for an app to manage them properly.
                Most library management apps are either too basic or designed
                for institutional libraries with rigid workflows that don't fit
                personal use.
              </p>
              <p>What I Built:</p>
              <p>
                - Multiple libraries: manage collections in different locations
              </p>
              <p>
                - Location tracking - remember exactly which shelf each book is
                on
              </p>
              <p>- Loan management - track books you've lent to friends</p>
              <p>
                - Custom fields &amp; tags - store any additional book info the
                way YOU think about them
              </p>
              <p>
                - Reading progress tracking - dates, duration, personal ratings
              </p>
              <p>- Modern UI/UX - clean &amp; actually enjoyable to use</p>
              <p>Current Status:</p>
              <p>- Beta version live</p>
              <p>
                - Working on improving the responsiveness of the app and
                addressing initial user feedback
              </p>
              <p>Would love feedback! Especially curious about:</p>
              <p>
                - What features would make YOU actually use a library management
                app?
              </p>
              <p>- UI/UX feedback always welcome</p>
              <p>
                - Any book collectors here who'd be interested in beta testing?
              </p>
              <p>Looking forward to your thoughts! Thank you in advance.</p>
            </div>
          </section>
        </section>
        <section id="44608814">
          <h3>
            <a
              class="item"
              href="https://www.grepular.com/Evolution%20Mail%20Users%20Easily%20Trackable%20Part%202"
              >Evolution Mail Users Easily Trackable Part 2</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-18 @ 19:26:35</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44608814"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44608754">
          <h3>
            <a
              class="item"
              href="https://kristoff.it/blog/asynchrony-is-not-concurrency/"
              >Asynchrony Is Not Concurrency</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-18 @ 19:21:38</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44608754"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44608622">
          <h3>
            <a class="item" href="https://eprint.iacr.org/2025/1237"
              >Replication of Quantum Factorisation Records with a VIC-20, an
              Abacus, and a Dog</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-18 @ 19:09:07</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44608622"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44608295">
          <h3>
            <a
              class="item"
              href="https://www.sciencenews.org/article/cancer-tumor-dna-blood-test-screening"
              >Cancer DNA is detectable in blood years before diagnosis</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-18 @ 18:39:06</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44608295"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44608294">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/mango-health/jobs/3bjIHus-founding-engineer"
              >Mango Health (YC W24) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-18 @ 18:39:02</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44608275">
          <h3>
            <a
              class="item"
              href="https://blog.nilenso.com/blog/2025/06/23/how-i-keep-up-with-ai-progress/"
              >How I keep up with AI progress</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-18 @ 18:36:39</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44608275"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44608170">
          <h3>
            <a
              class="item"
              href="https://www.biocentury.com/article/656520/third-death-from-a-sarepta-gene-therapy"
              >Third patient dies from acute liver failure caused by a Sarepta
              gene therapy</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-18 @ 18:26:22</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44608170"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44607961">
          <h3>
            <a
              class="item"
              href="https://newsletter.pragmaticengineer.com/p/the-pulse-section-174-is-reversed"
              >Section 174 is reversed! Mostly, that is.</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-18 @ 18:07:57</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44607961"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44607403">
          <h3>
            <a
              class="item"
              href="https://www.filfre.net/2025/07/the-year-of-peak-might-and-magic/"
              >The Year of Peak Might and Magic</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-18 @ 17:21:49</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44607403"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44606646">
          <h3>
            <a
              class="item"
              href="https://www.neowin.net/news/libreoffice-calls-out-microsoft-for-using-complex-file-formats-to-lock-in-office-users/"
              >LibreOffice slams Microsoft for locking in Office users w/
              complex file formats</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-18 @ 16:30:58</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44606646"
                  >Comments</a
                ><span class="descendants">: 89</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44605946">
          <h3>
            <a class="item" href="https://imgur.com/a/2H7HVcU"
              >Dear valued user, You have reached the error page for the error
              page</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-18 @ 15:39:51</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44605946"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
            <div class="text">
              Just got to this error page by refreshing my Gmail tab, seeing the
              Gmail error page, and then refreshing the error page and getting
              this. Never seen this posted on the Internet before, but I thought
              it was interesting.
            </div>
          </section>
        </section>
        <section id="44605670">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/a-new-geometry-for-einsteins-theory-of-relativity-20250716/"
              >A New Geometry for Einstein's Theory of Relativity</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-18 @ 15:19:17</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44605670"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44605213">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=44605213"
              >I'm Peter Roberts, immigration attorney who does work for YC and
              startups. AMA</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-18 @ 14:44:57</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44605213"
                  >Comments</a
                ><span class="descendants">: 228</span></span
              >
            </h4>
            <div class="text">
              <p>
                Previous threads we've done:
                <a href="https://news.ycombinator.com/submitted?id=proberts"
                  >https://news.ycombinator.com/submitted?id=proberts</a
                >.
              </p>
            </div>
          </section>
        </section>
        <section id="44604050">
          <h3>
            <a
              class="item"
              href="https://rockorager.dev/log/lsr-ls-but-with-io-uring/"
              >lsr: ls with io_uring</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-18 @ 12:40:41</span
              ><span class="points-container"
                >Points: <span class="points">270</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44604050"
                  >Comments</a
                ><span class="descendants">: 147</span></span
              >
            </h4>
            <div class="text">
              <a href="https://tangled.sh/@rockorager.dev/lsr"
                >https://tangled.sh/@rockorager.dev/lsr</a
              >
            </div>
          </section>
        </section>
        <section id="44603267">
          <h3>
            <a
              class="item"
              href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5367557/"
              >Psilocybin decreases depression and anxiety in cancer patients
              (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-18 @ 10:57:08</span
              ><span class="points-container"
                >Points: <span class="points">240</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44603267"
                  >Comments</a
                ><span class="descendants">: 231</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44603066">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/cpm-creator-gary-kildalls-memoirs-released-as-free-download"
              >CP/M creator Gary Kildall's memoirs released as free download</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-18 @ 10:22:15</span
              ><span class="points-container"
                >Points: <span class="points">215</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44603066"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44602532">
          <h3>
            <a
              class="item"
              href="https://rsadowski.de/posts/2025/openbsd-immutable-system-logs/"
              >When root meets immutable: OpenBSD chflags vs. log tampering</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-18 @ 08:36:47</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44602532"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44571908">
          <h3>
            <a
              class="item"
              href="https://www.leadedsolder.com/2025/07/15/tandy-trs80-coco-composite-mod-aquarius.html"
              >CoCo1 composite video</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-15 @ 15:05:59</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44571908"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44571549">
          <h3>
            <a class="item" href="https://www.hathitrust.org/"
              >HathiTrust Digital Library</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-15 @ 14:32:21</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44571549"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44570089">
          <h3>
            <a class="item" href="https://hakibenita.com/django-foreign-keys"
              >How to Get Foreign Keys Horribly Wrong</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-15 @ 11:36:08</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44570089"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44569819">
          <h3>
            <a class="item" href="https://briandouglas.ie/string-buffer-c/"
              >Making a StringBuffer in C, and questioning my sanity</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-15 @ 10:48:34</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44569819"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44569032">
          <h3>
            <a class="item" href="https://tazj.in/blog/trying-guix"
              >Trying Guix: A Nixer's impressions</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-15 @ 08:11:19</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44569032"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44566673">
          <h3>
            <a
              class="item"
              href="https://chiselapp.com/user/MistressRemilia/repository/benben/home"
              >Benben: An audio player for the terminal, written in Common
              Lisp</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-15 @ 00:19:04</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44566673"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44561516">
          <h3>
            <a class="item" href="https://100r.co/site/home.html"
              >Hundred Rabbits – Low-tech living while sailing the world</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-14 @ 15:45:28</span
              ><span class="points-container"
                >Points: <span class="points">194</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44561516"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
