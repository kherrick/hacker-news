<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36491079">
          <h3>
            <a
              class="item"
              href="https://boingboing.net/2017/03/02/how-to-imagine-52-factorial.html"
              >How to Imagine 52 Factorial</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 10:30:14</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36491079"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36489847">
          <h3>
            <a class="item" href="https://github.com/wolfi-dev"
              >Wolfi: A community Linux OS designed for the container and
              cloud-native era</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 07:19:37</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36489847"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36489288">
          <h3>
            <a class="item" href="https://rigtorp.se/ringbuffer/"
              >Optimizing a ring buffer for throughput (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 05:42:05</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36489288"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36488871">
          <h3>
            <a
              class="item"
              href="https://lilianweng.github.io/posts/2023-06-23-agent/"
              >LLM Powered Autonomous Agents</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 04:22:32</span
              ><span class="points-container"
                >Points: <span class="points">178</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36488871"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36488735">
          <h3>
            <a class="item" href="https://x0axz.com/blog/autograd.html"
              >Show HN: An Interactive Guide to Teach Derivatives and
              Backpropagation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 04:01:10</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36488735"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36488461">
          <h3>
            <a class="item" href="https://cubxity.dev/blog/folia-test-june-2023"
              >Testing a 1,000 player Minecraft server with Folia</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 03:13:53</span
              ><span class="points-container"
                >Points: <span class="points">189</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36488461"
                  >Comments</a
                ><span class="descendants">: 125</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36488356">
          <h3>
            <a
              class="item"
              href="https://akashrajpurohit.com/blog/build-your-own-docker-with-linux-namespaces-cgroups-and-chroot-handson-guide/"
              >Build your own Docker with Linux namespaces, cgroups, and
              chroot</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 02:50:55</span
              ><span class="points-container"
                >Points: <span class="points">209</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36488356"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36488127">
          <h3>
            <a
              class="item"
              href="https://www.uber.com/blog/microservice-architecture/"
              >Domain-Oriented Microservice Architecture (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 02:00:58</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36488127"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36487883">
          <h3>
            <a class="item" href="https://opnsense.org/"
              >OPNsense: Open-source security platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 01:14:01</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36487883"
                  >Comments</a
                ><span class="descendants">: 96</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36487574">
          <h3>
            <a class="item" href="https://eatrightindia.gov.in/dart/"
              >Detect Food Adulteration with Easy Home Tests</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 00:18:19</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36487574"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36486512">
          <h3>
            <a class="item" href="https://www.dialup.net/wingpt/tls.html"
              >Modern TLS/SSL on 16-bit Windows</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 22:03:59</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36486512"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36485597">
          <h3>
            <a
              class="item"
              href="https://doubleagent.net/2023/05/21/a-car-battery-monitor-tracking-your-location"
              >Discovering that a Bluetooth car battery monitor is siphoning
              location data</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 20:45:47</span
              ><span class="points-container"
                >Points: <span class="points">605</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36485597"
                  >Comments</a
                ><span class="descendants">: 253</span></span
              >
            </h4>
            <div class="text">
              <p>
                It turns out it's sending GPS, cell phone tower cell IDs and
                Wifi beacon data to servers in Hong Kong and mainland China on a
                continued basis. Google and Apple app store pages say no
                personal data is collected or sent to 3rd parties.
              </p>
              <p>
                Hopefully readers pick up a few tips on reversing apps for their
                connected devices.
              </p>
            </div>
          </section>
        </section>
        <section id="36484609">
          <h3>
            <a
              class="item"
              href="https://determinate.systems/posts/magic-nix-cache"
              >The Magic Nix Cache, a GitHub Action for speeding up your Nix
              workflows</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 19:32:38</span
              ><span class="points-container"
                >Points: <span class="points">173</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36484609"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36484502">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-023-02065-y"
              >Hunter-gatherer lifestyle fosters thriving gut microbiome</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 19:23:20</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36484502"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36484308">
          <h3>
            <a class="item" href="https://github.com/eyurtsev/kor"
              >Kor: a half-baked prototype that "helps" you extract structured
              data using LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 19:05:41</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36484308"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36483445">
          <h3>
            <a
              class="item"
              href="https://enigma.hoerenberg.com/index.php?cat=Unbroken&amp;page=P1030680"
              >P1030680: Unbroken Enigma message (U534, 01 May 1945)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 18:10:23</span
              ><span class="points-container"
                >Points: <span class="points">286</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36483445"
                  >Comments</a
                ><span class="descendants">: 125</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36480687">
          <h3>
            <a class="item" href="https://mofi.loud.red/"
              >Show HN: Mofi – Content-aware fill for audio to change a song to
              any duration</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 15:12:53</span
              ><span class="points-container"
                >Points: <span class="points">552</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36480687"
                  >Comments</a
                ><span class="descendants">: 144</span></span
              >
            </h4>
            <div class="text">
              <a
                href="https://mofi.loud.red/edit/8bd3fdf780f8c3927e41029f3b957f8a7ed96863"
                >https://mofi.loud.red/edit/8bd3fdf780f8c3927e41029f3b957f8a7...</a
              >
              <p>
                The cool thing is that after the song is analyzed on the server,
                the client can recompute and preview the results completely
                client-side through an implementation that uses Web Workers and
                WebAssembly. The audio previewing uses Tone.js. I am thinking of
                writing up some more details about the implementation in the
                future.
              </p>
              <p>
                I'm still working on a way to explain this easily, but I like
                the idea of carrying over the concept of content-aware fill from
                images to audio.
              </p>
              <p>Please let me know if you have any comments or questions!</p>
            </div>
          </section>
        </section>
        <section id="36480460">
          <h3>
            <a
              class="item"
              href="https://vivaldi.com/blog/how-to/5-reasons-why-a-browser-and-mail-combination-is-worth-it/"
              >Why a browser and mail combination is worth it</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 15:00:11</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36480460"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36480230">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36480230"
              >Launch HN: Argonaut (YC S21) – Easily Deploy Apps and Infra to
              AWS and GCP</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 14:41:47</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36480230"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.argonaut.dev/">https://www.argonaut.dev/</a
              >), a unified platform that tries to make software ops painless,
              so teams can focus on building features instead of building and
              managing infrastructure. Argonaut combines Kubernetes PaaS, a CI
              pipeline builder, and a Terraform state manager with prebuilt AWS
              and GCP modules. Here’s a demo:
              <a href="https://www.youtube.com/watch?v=8DZsYXxA2tQ"
                >https://www.youtube.com/watch?v=8DZsYXxA2tQ</a
              >.
              <p>
                I’ve helped build infrastructure tooling from scratch at
                multiple companies and realized two things: that the shape of
                the solution with the advent of containerization, Kubernetes,
                and hyperscalers is quite similar across orgs, and that highly
                knowledgeable engineers are needed to build and manage this
                system.
              </p>
              <p>
                Internal infrastructure teams juggle a multitude of
                tasks—provisioning cloud infrastructure, configuring runtimes,
                building code, securing artifacts, running tests, and deploying
                at scale. Post-deployment, they're also tasked with monitoring
                app performance, errors, uptime, and cost visibility. It's a lot
                of work, and having to build this tooling in-house is a deep
                inefficiency in engineering teams. The root of the problem is
                that AWS and GCP provide a lower level of abstraction than the
                entities, such as environments and applications, that developers
                have to deal with, and a ton of work is getting duplicated,
                often by underfunded teams, across many orgs. Argonaut’s
                objective is to be the developer platform and control center
                that you would otherwise have to build internally.
              </p>
              <p>
                Argonaut provides an intuitive developer experience that
                simplifies working with Kubernetes and enables developer
                self-service, reducing the burden on devops and platform teams.
                We've productized this workflow orchestration, incorporating
                best practices to provide a push-to-deploy experience with
                flexible pipelines and scalable infrastructure, all within
                minutes.
              </p>
              <p>
                Our users are startups across various domains like healthcare,
                IoT, fintech, AI, and SaaS products. Over the last two years,
                we’ve enabled customers to scale their engineering teams 10x and
                manage 10+ environments in parallel without needing a dedicated
                infra/DevOps team, saving them precious time and resources.
              </p>
              <p>
                Argonaut lets you set up production-ready infrastructure and
                customize as you scale. We then let you set up automated
                deployments of your application in minutes. We offer
                configurable build-and-deploy pipelines, powered by Dagger and
                ArgoCD, and deep integration with GitHub Actions and GitLab CI.
                In addition, we support container registries, multiple cloud
                accounts, observability stacks, cost visibility providers, CDNs,
                and the entire helm chart ecosystem of Kubernetes, with more
                integrations on the way.
              </p>
              <p>
                Key features include: (1) easily create environments
                encapsulating cloud infrastructure, applications, and deployment
                pipelines (2) autoscaling deployments for apps and cronjobs to
                GCP and AWS with a progression across environments (3) compose
                deployments across multiple environments with our visual
                pipeline builder (4) get cost estimates before making infra
                changes, giving you a clear understanding of your expenses; (5)
                managed Terraform state and pre-built modules that just work,
                fostering team collaboration on infrastructure.
              </p>
              <p>
                Argonaut is self-serve, so you can sign up and start using the
                product right away:
                <a href="https://ship.argonaut.dev">https://ship.argonaut.dev</a
                >. There is a free tier that doesn't require a credit card to
                get started. We'd be delighted to have you try it, and are happy
                to help with onboarding.
              </p>
              <p>
                If your teams work with AWS, GCP, or Kubernetes, I’d love to
                hear about your experiences, pain points, and what you think a
                product like Argonaut should be able to do. Looking forward to
                your comments!
              </p>
            </div>
          </section>
        </section>
        <section id="36480200">
          <h3>
            <a
              class="item"
              href="http://www.solipsys.co.uk/new/UnexpectedInteractionOfFeatures.html?wf26hn"
              >Unexpected Interaction of Features</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 14:39:03</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36480200"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36478854">
          <h3>
            <a
              class="item"
              href="https://spin.atomicobject.com/2023/06/26/dexec-docker/"
              >Working with Docker containers with the dexec bash script</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 12:29:04</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36478854"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36478772">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/06/20/magazine/hotel-bars.html"
              >The best place to drink is the emptiest bar in the city</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 12:21:23</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36478772"
                  >Comments</a
                ><span class="descendants">: 225</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36478206">
          <h3>
            <a
              class="item"
              href="https://matan-h.com/google-has-a-secret-browser-hidden-inside-the-settings/"
              >Google has a secret browser hidden inside the settings</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 11:13:03</span
              ><span class="points-container"
                >Points: <span class="points">859</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36478206"
                  >Comments</a
                ><span class="descendants">: 292</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36475846">
          <h3>
            <a
              class="item"
              href="https://blogs.loc.gov/loc/2023/06/bloomsday-the-librarys-one-of-a-kind-copy-of-ulysses/"
              >Bloomsday the Library’s One-of-a-Kind Copy of “Ulysses”</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 04:51:43</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36475846"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36475755">
          <h3>
            <a
              class="item"
              href="https://time.com/6286931/how-to-steal-a-masterpiece-advice-from-the-worlds-greatest-art-thief/"
              >How to steal a masterpiece: Advice from the world’s greatest art
              thief</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 04:34:21</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36475755"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36475083">
          <h3>
            <a
              class="item"
              href="http://meta-studies.net/pmwiki/pmwiki.php?n=Site.Introduction"
              >Things That Count</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 02:36:51</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36475083"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36469086">
          <h3>
            <a
              class="item"
              href="https://marctenbosch.com/news/2023/03/4d-toys-update-v-1-8-rotating-the-3d-slice-2d-faces-projections-marble-scenes-and-many-more/"
              >4D Toys Update 8: Rotating the 3D Slice, 2D Faces Projections,
              Marble Scenes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-25 @ 15:15:38</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36469086"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36467855">
          <h3>
            <a
              class="item"
              href="https://www.deeplearning.ai/the-batch/the-paella-model-for-fast-image-generation-explained/"
              >Like diffusion but faster: The Paella model for fast image
              generation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-25 @ 13:10:30</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36467855"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36467187">
          <h3>
            <a
              class="item"
              href="https://moonbaseotago.github.io/2023/06/19/vector-patterns.html"
              >Vector ALU Patterns</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-25 @ 11:41:45</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36467187"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36456662">
          <h3>
            <a
              class="item"
              href="https://parametric-architecture.com/bolwoningen-living-in-spherical-homes/"
              >Bolwoningen: Living in spherical homes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-24 @ 08:18:20</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36456662"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
