<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42748172">
          <h3>
            <a
              class="item"
              href="https://www.popsci.com/technology/uk-cybertruck-illegal/"
              >UK police seize Cybertruck because it's illegal there</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-18 @ 13:29:39</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42748172"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42748130">
          <h3>
            <a
              class="item"
              href="https://www.ftc.gov/news-events/news/press-releases/2025/01/genshin-impact-game-developer-will-be-banned-selling-lootboxes-teens-under-16-without-parental"
              >FTC bans Genshin Impact dev from selling lootboxes to under-16s,
              fines them $20M</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-18 @ 13:22:15</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42748130"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42747923">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/uk-news/2025/jan/16/bloodletting-recommended-for-jersey-residents-after-pfas-contamination"
              >Bloodletting recommended for Jersey residents after PFAS
              contamination</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-18 @ 12:42:46</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42747923"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42747922">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=U2aQTJDJwd8"
              >Transmeta: A CPU Revolution That Never Was [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-18 @ 12:42:45</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42747922"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42747899">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/toyota-prius-transformed-auto-industry"
              >The Toyota Prius Transformed the Auto Industry</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-18 @ 12:38:34</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42747899"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42747515">
          <h3>
            <a class="item" href="http://famitracker.com/"
              >FamiTracker free windows tracker for producing music for the
              NES/Famicom-systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-18 @ 11:07:24</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42747515"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42747092">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2025/01/17/google-begins-requiring-javascript-for-google-search/"
              >Google begins requiring JavaScript for Google Search</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-18 @ 09:36:39</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42747092"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42747065">
          <h3>
            <a
              class="item"
              href="https://bugzilla.mozilla.org/show_bug.cgi?id=647959"
              >Honest Ahmed (2011)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-18 @ 09:31:45</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42747065"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42746222">
          <h3>
            <a
              class="item"
              href="https://reedybear.bearblog.dev/ive-been-advocating-for-rss-support-and-you-should-too/"
              >I've been advocating for RSS support, and you should too</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-18 @ 05:58:53</span
              ><span class="points-container"
                >Points: <span class="points">400</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42746222"
                  >Comments</a
                ><span class="descendants">: 166</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42745334">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/smart-news/can-you-read-this-cursive-handwriting-the-national-archives-wants-your-help-180985833/"
              >Can you read this cursive handwriting? The National Archives
              wants your help</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-18 @ 02:42:54</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42745334"
                  >Comments</a
                ><span class="descendants">: 127</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42745082">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/news/annals-of-communications/is-the-tiktok-ban-a-chance-to-rethink-the-whole-internet"
              >Is the TikTok ban a chance to rethink the whole internet?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-18 @ 01:51:18</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42745082"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42744820">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42744820"
              >Spellbrush (YC W18) Is Hiring Game Programmers (Anime
              SRPG/Tactics)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-18 @ 01:00:04</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
            <div class="text">
              <p>
                Our team has worked on acclaimed tactics titles such as Sword of
                Convallaria, Archeland, and Final Fantasy Brave Exvius.
              </p>
              <p>
                If you're interested in working on anime tactics games while
                also utilizing world class bleeding-edge AI research to enhance
                gameplay and production, shoot an email directly to
                jobs@spellbrush.com with the subject header "[Game Programmer] -
                [Your Name]". Make sure to include your resume and what tactics
                games you've played or worked on.
              </p>
              <p>
                Offices in San Francisco &amp; Tokyo; we sponsor both US &amp;
                JP visas.
              </p>
              <p>
                Lastly, if Anime perked your interest but you're not a games
                programmer, we also have general SWE and AI Research positions
                open too. See all listings over at our full careers page:
                <a href="https://spellbrush.com/careers"
                  >https://spellbrush.com/careers</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="42743033">
          <h3>
            <a
              class="item"
              href="https://lcamtuf.substack.com/p/investigating-an-evil-rj45-dongle"
              >Investigating an "evil" RJ45 dongle</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 20:41:56</span
              ><span class="points-container"
                >Points: <span class="points">413</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42743033"
                  >Comments</a
                ><span class="descendants">: 135</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42743019">
          <h3>
            <a
              class="item"
              href="https://blog.railway.com/p/data-center-build-part-one"
              >So you want to build your own data center</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 20:41:07</span
              ><span class="points-container"
                >Points: <span class="points">401</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42743019"
                  >Comments</a
                ><span class="descendants">: 177</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42742350">
          <h3>
            <a class="item" href="https://github.com/tomhea/c2fj"
              >Show HN: Compile C to Not Gates</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 19:36:37</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42742350"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
            <div class="text">
              <p>
                Today I completed my compiler from C to FlipJump. It takes C
                files, and compiles them into flipjump. I finished testing it
                all today, and it works! My key interest in this project is to
                stretch what we know of computing and to prove that anything can
                be done even with minimal power.
              </p>
              <p>
                I appreciate you reading my announcement, and be happy to answer
                questions.
              </p>
              <p>More links:</p>
              <p>
                - The flipjump language:
                <a href="https://github.com/tomhea/flip-jump"
                  >https://github.com/tomhea/flip-jump</a
                >
                <a href="https://esolangs.org/wiki/FlipJump"
                  >https://esolangs.org/wiki/FlipJump</a
                >
              </p>
              <p>
                - c2fj python package
                <a href="https://pypi.org/project/c2fj/"
                  >https://pypi.org/project/c2fj/</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="42742184">
          <h3>
            <a
              class="item"
              href="https://cceckman.com/writing/branchless-utf8-encoding/"
              >Branchless UTF-8 Encoding</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 19:20:14</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42742184"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42742161">
          <h3>
            <a
              class="item"
              href="https://www.nutraingredients-asia.com/Article/2025/01/07/higher-potassium-intake-at-dinner-linked-to-fewer-sleep-disturbances/"
              >Higher potassium intake at dinner linked to fewer sleep
              disturbances – study</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 19:17:48</span
              ><span class="points-container"
                >Points: <span class="points">162</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42742161"
                  >Comments</a
                ><span class="descendants">: 89</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42741155">
          <h3>
            <a
              class="item"
              href="https://blogsystem5.substack.com/p/netbsd-graphics-wo-x11"
              >Hands-On Graphics Without X11</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 17:54:02</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42741155"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42740596">
          <h3>
            <a
              class="item"
              href="https://blog.sourcedive.net/brood-war-korean-translations/"
              >Brood War Korean Translations</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 17:15:07</span
              ><span class="points-container"
                >Points: <span class="points">287</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42740596"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42739572">
          <h3>
            <a
              class="item"
              href="https://aeon.co/essays/the-french-modernists-loathed-and-loved-the-mass-media-of-their-day"
              >French modernists were alarmed, inspired by newspaper's voracious
              dynamism</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 16:21:13</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42739572"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42738464">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2025/01/17/supreme-court-rules-to-uphold-tiktok-ban.html"
              >Supreme Court upholds TikTok ban, but Trump might offer
              lifeline</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 15:23:58</span
              ><span class="points-container"
                >Points: <span class="points">909</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42738464"
                  >Comments</a
                ><span class="descendants">: 2372</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42734478">
          <h3>
            <a
              class="item"
              href="https://blog.cryptographyengineering.com/2025/01/17/lets-talk-about-ai-and-end-to-end-encryption/"
              >Let's talk about AI and end-to-end encryption</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-17 @ 05:50:25</span
              ><span class="points-container"
                >Points: <span class="points">231</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42734478"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42713576">
          <h3>
            <a
              class="item"
              href="https://www.minecraft.net/en-us/article/minecraft-snapshot-25w03a"
              >Minecraft Snapshot 25w03a</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-15 @ 16:59:11</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42713576"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42711012">
          <h3>
            <a
              class="item"
              href="https://www.openculture.com/2025/01/discover-the-playful-drawings-that-charles-darwins-children-left-on-his-manuscripts.html"
              >Playful Drawings That Charles Darwin's Children Left on His
              Manuscripts</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-15 @ 14:18:32</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42711012"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42709667">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=rCIZflYEpEk"
              >Fixing a real world bug in Redis vector sets with LLMs [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-15 @ 11:14:59</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42709667"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42708291">
          <h3>
            <a
              class="item"
              href="https://medium.com/altitudehq/is-traditional-nlp-dead-05544ae7d756"
              >Has LLM killed traditional NLP?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-15 @ 07:26:35</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42708291"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42707660">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/articles/cp3z0k72yw3o"
              >Trapped in the dark for 35 hours – Red Sea dive-boat survivors
              tell of escapes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-15 @ 05:35:03</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42707660"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42699370">
          <h3>
            <a
              class="item"
              href="https://steveblank.com/2014/07/08/the-path-of-our-lives/"
              >The Path of Our Lives</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-14 @ 16:25:45</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42699370"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42697001">
          <h3>
            <a class="item" href="https://www.lightcellenergy.com/"
              >Lightcell: An engine that uses light to make electricity</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-14 @ 13:36:09</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42697001"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42693748">
          <h3>
            <a
              class="item"
              href="https://www.paulosyibelo.com/2024/12/doubleclickjacking-what.html"
              >DoubleClickjacking: A New type of web hacking technique</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-14 @ 04:44:06</span
              ><span class="points-container"
                >Points: <span class="points">186</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42693748"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
