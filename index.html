<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43649853">
          <h3>
            <a
              class="item"
              href="https://developer.mozilla.org/en-US/blog/h1-element-styles/"
              >Default styles for h1 elements are changing</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-11 @ 02:14:13</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43649853"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43649811">
          <h3>
            <a
              class="item"
              href="https://www.propublica.org/article/tiger-algorithm-louisiana-parole-calvin-alexander"
              >Louisiana prison board uses algorithms to determine eligility for
              parole</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-11 @ 02:07:53</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43649811"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43649665">
          <h3>
            <a
              class="item"
              href="https://electrek.co/2025/04/09/tesla-canada-says-its-shady-43-million-incentive-grab-was-a-misunderstanding/"
              >Tesla Canada says its shady $43M incentive grab was a
              misunderstanding</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-11 @ 01:42:51</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43649665"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43649618">
          <h3>
            <a
              class="item"
              href="https://crystal-lang.org/2025/04/09/1.16.0-released/"
              >Crystal 1.16.0 Is Released</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-11 @ 01:36:45</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43649618"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43648950">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2025/04/10/fintech-founder-charged-with-fraud-after-ai-shopping-app-found-to-be-powered-by-humans-in-the-philippines/"
              >Fintech founder charged with fraud; AI app found to be humans in
              the Philippines</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 23:36:54</span
              ><span class="points-container"
                >Points: <span class="points">160</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43648950"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43648890">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/technology/2025/apr/10/black-mirror-tv-show-pessimism"
              >Black Mirror's pessimism porn won't lead us to a better future</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 23:24:51</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43648890"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43648593">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/parity/jobs"
              >Parity (YC S24) is hiring founding engineers to build an AI SRE
              (in-person SF)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 22:23:48</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43648145">
          <h3>
            <a class="item" href="https://rewards.getonecard.io"
              >Show HN: I built a tool to manage and compare credit card
              rewards</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 21:24:28</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43648145"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
            <div class="text">
              <p>
                You can input the cards in your wallet and see how they
                complement each other, spot gaps in your setup, and also see the
                best card to use for a given merchant.
              </p>
              <p>
                I’m also a founder at OneCard, where we’re building a smart card
                that’ll eventually handle all of this automatically, routing
                each purchase to the best card in real-time.
              </p>
              <p>Would love feedback from the HN community!</p>
            </div>
          </section>
        </section>
        <section id="43647880">
          <h3>
            <a class="item" href="https://www.thecoder.cafe/p/100-go-mistakes"
              >The Story Behind “100 Go Mistakes and How to Avoid Them”</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 20:47:01</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43647880"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43647716">
          <h3>
            <a class="item" href="https://peps.python.org/pep-0750/"
              >PEP 750 – Template Strings</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 20:24:01</span
              ><span class="points-container"
                >Points: <span class="points">363</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43647716"
                  >Comments</a
                ><span class="descendants">: 242</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43647598">
          <h3>
            <a
              class="item"
              href="https://bobbiechen.com/blog/2022/7/21/what-if-your-website-had-business-hours"
              >What if your website had business hours? (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 20:09:23</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43647598"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43647294">
          <h3>
            <a
              class="item"
              href="https://www.muppetlabs.com/~breadbox/txt/mopb.html"
              >My Own Private Binary: An Idiosyncratic Introduction to Linux
              Kernel Modules</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 19:29:46</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43647294"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43646920">
          <h3>
            <a
              class="item"
              href="https://www.404media.co/how-a-2-000-made-in-the-usa-liberty-phone-phone-is-manufactured/"
              >How a $2k 'Made in the USA' Phone Is Manufactured</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 18:43:56</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43646920"
                  >Comments</a
                ><span class="descendants">: 132</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43646698">
          <h3>
            <a
              class="item"
              href="https://crocidb.com/post/kernel-adventures/demystifying-the-shebang/"
              >Demystifying the (Shebang): Kernel Adventures</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 18:21:45</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43646698"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43646466">
          <h3>
            <a
              class="item"
              href="https://machinelearning.apple.com/research/transporting-activations"
              >Controlling Language and Diffusion Models by Transporting
              Activations</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 17:58:02</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43646466"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43646219">
          <h3>
            <a class="item" href="https://www.bigbookofr.com/">Big Book of R</a>
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 17:34:19</span
              ><span class="points-container"
                >Points: <span class="points">185</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43646219"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43646095">
          <h3>
            <a class="item" href="https://garfieldminusgarfield.net"
              >Garfield Minus Garfield</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 17:21:03</span
              ><span class="points-container"
                >Points: <span class="points">511</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43646095"
                  >Comments</a
                ><span class="descendants">: 183</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43645183">
          <h3>
            <a
              class="item"
              href="https://macintoshgarden.org/apps/sdl2-macos-9-rough-draft"
              >SDL2 for macOS 9 “rough draft”</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 15:54:50</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43645183"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43644970">
          <h3>
            <a
              class="item"
              href="https://www.cheeseprofessor.com/blog/cheese-wheel-tapping"
              >Why Tap a Wheel of Cheese?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 15:35:04</span
              ><span class="points-container"
                >Points: <span class="points">162</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43644970"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43644351">
          <h3>
            <a class="item" href="https://koreo.dev/"
              >Show HN: Koreo – A platform engineering toolkit for Kubernetes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 14:48:20</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43644351"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
            <div class="text">
              <p>
                As a result, we ended up building something that's sort of a
                "meta-controller programming language" on top of Kubernetes
                called Koreo. It provides a solution for configuration
                management and resource orchestration in Kubernetes by basically
                letting you program controllers. We've been using Koreo for a
                while now to build internal developer platform capabilities for
                our commercial product and our clients, and we recently open
                sourced it to share it with the community.
              </p>
              <p>
                Koreo has some similarities to configuration languages like KCL,
                Jsonnet, etc. since it is a means of configuration management
                (e.g. you can define base configurations, apply overlays, point
                patches, and so forth). Where it really diverges though is Koreo
                provides a unified approach to config management
                <i>and</i> resource orchestration. This means you can start to
                treat Kubernetes resources as "legos" to build pretty
                sophisticated workflows. For instance, the output of a resource
                can be used as the input to another resource. This isn't really
                possible with Helm, even with `lookup` because `lookup` requires
                the resource to already be in-cluster in order to reference it.
              </p>
              <p>
                This is why we refer to Koreo as a meta-controller programming
                language because it effectively lets you program and compose
                Kubernetes controllers into cohesive platforms—either built-in
                controllers (think Deployment or StatefulSet), off-the-shelf
                ones such as AWS ACK or GCP's Config Connector, or custom
                operators. It lets you build or combine controllers without
                actually needing to implement an operator. Through this lens,
                Koreo is really more akin to Crossplane but without some of the
                limitations such as Providers and cluster-scoped managed
                resources.
              </p>
              <p>
                It seems crazy and maybe it is, but I've found working in Koreo
                to actually be surprisingly fun since it kind of turns
                Kubernetes primitives into legos you can easily piece together,
                reuse, and build some pretty cool automated workflows. You can
                learn more about the motivation and thinking behind it here:
                <a href="https://theyamlengineer.com"
                  >https://theyamlengineer.com</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="43643968">
          <h3>
            <a
              class="item"
              href="https://www.arroyo.dev/blog/arroyo-is-joining-cloudflare"
              >Arroyo (YC W23) has been acquired by Cloudflare</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 14:12:44</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43643968"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43643886">
          <h3>
            <a
              class="item"
              href="https://developers.redhat.com/articles/2025/04/10/6-usability-improvements-gcc-15"
              >Usability Improvements in GCC 15</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 14:03:54</span
              ><span class="points-container"
                >Points: <span class="points">217</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43643886"
                  >Comments</a
                ><span class="descendants">: 167</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43643343">
          <h3>
            <a
              class="item"
              href="https://emilygorcenski.com/post/owning-my-own-data-part-1-integrating-a-self-hosted-calendar-solution/"
              >Owning my own data, part 1: Integrating a self-hosted calendar
              solution</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 12:59:54</span
              ><span class="points-container"
                >Points: <span class="points">316</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43643343"
                  >Comments</a
                ><span class="descendants">: 120</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43643292">
          <h3>
            <a
              class="item"
              href="https://susam.net/elliptical-python-programming.html"
              >Elliptical Python Programming</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-10 @ 12:53:56</span
              ><span class="points-container"
                >Points: <span class="points">152</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43643292"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43625139">
          <h3>
            <a
              class="item"
              href="https://andersmurphy.com/2025/04/07/clojure-realtime-collaborative-web-apps-without-clojurescript.html"
              >Clojure: Realtime collaborative web apps without ClojureScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-08 @ 18:40:23</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43625139"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43621021">
          <h3>
            <a
              class="item"
              href="https://petapixel.com/2025/03/25/levitating-bugs-with-sound-could-transform-scientific-photography/"
              >Levitating Bugs with Sound Could Transform Scientific
              Photography</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-08 @ 12:38:34</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43621021"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43616649">
          <h3>
            <a class="item" href="https://jpfennell.com/posts/enum-type-size/"
              >A surprising enum size optimization in the Rust compiler</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-07 @ 22:30:45</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43616649"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43615844">
          <h3>
            <a
              class="item"
              href="https://movieweb.com/eno-documentary-movie-different-every-time/"
              >The movie that's different every time you watch it</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-07 @ 20:55:27</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43615844"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43613463">
          <h3>
            <a
              class="item"
              href="https://blog.google/products/gemini/gemini-live-android-tips/"
              >Gemini Live with camera and screen sharing capabilities</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-07 @ 16:53:08</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43613463"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43608422">
          <h3>
            <a
              class="item"
              href="https://www.piercemfg.com/pierce/blog/difference-between-municipal-and-airport-fire-trucks"
              >The Difference Between Municipal Fire Trucks and Airport Fire
              Trucks</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-07 @ 06:27:03</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43608422"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
