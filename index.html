<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41926554">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/style/media/2024/10/23/new-york-times-tech-guild-strike/"
              >What happens if the NY Times tech staff strikes on election
              night?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-23 @ 16:19:31</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41926554"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41926515">
          <h3>
            <a
              class="item"
              href="https://theconversation.com/paper-mills-the-cartel-like-companies-behind-fraudulent-scientific-journals-230124"
              >Paper mills: the 'cartel-like' companies behind fraudulent
              scientific journals</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-23 @ 16:16:25</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41926515"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41926472">
          <h3>
            <a
              class="item"
              href="https://ij.org/press-release/federal-lawsuit-challenges-virginia-citys-use-of-over-170-cameras-to-conduct-prolonged-warrantless-surveillance-of-entire-driving-population/"
              >Federal Suit Challenges City's Use of 170+ Cameras for
              Warrantless Surveillance</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-23 @ 16:11:57</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41926472"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41925658">
          <h3>
            <a class="item" href="https://www.dont-click-here.com/"
              >Don't use "click here" for link text</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-23 @ 14:53:24</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41925658"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41925511">
          <h3>
            <a
              class="item"
              href="https://benhouston3d.com/blog/risc-v-in-2024-is-slow"
              >RISC-V is currently slow compared to modern CPUs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-23 @ 14:41:12</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41925511"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41925141">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2024/10/23/superhtml_live_html_syntax_checking/"
              >SuperHTML is here to rescue you from syntax errors, and it's
              FOSS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-23 @ 14:01:07</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41925141"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41924801">
          <h3>
            <a class="item" href="https://www.mdpi.com/1996-1944/17/20/5020"
              >Carbon Sequestration by Recycling Cement, Aggregates, and
              Concrete</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-23 @ 13:20:17</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41924801"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41924787">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41924787"
              >Launch HN: GPT Driver (YC S21) – End-to-end app testing in
              natural language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-23 @ 13:18:17</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41924787"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
            <div class="text">
              <a href="https://mobileboost.io/">https://mobileboost.io/</a>).
              We’re building GPT Driver, an AI-native approach to create and
              execute end-to-end (E2E) tests on mobile applications. Our
              solution allows teams to define tests in natural language and
              prevents test flakiness by taking a visual approach paired with
              LLM (Large Language Model) reasoning. This helps achieve E2E test
              coverage with a fraction of the usual effort.
              <p>
                You can watch a brief product walkthrough here:
                <a href="https://www.youtube.com/watch?v=5-Ge2fqdlxc"
                  >https://www.youtube.com/watch?v=5-Ge2fqdlxc</a
                >
              </p>
              <p>
                In terms of trying the product out: since the service is
                resource-intensive (we provide hosted virtual/real phone
                instances), we don't currently have a playground available.
                However, you can see some examples here
                <a href="https://mobileboost.io/showcases"
                  >https://mobileboost.io/showcases</a
                >
                and book a demo of GPT Driver testing your app through our
                website.
              </p>
              <p>
                Why we built this: working at previous startups and scaleups, we
                saw how as app teams grew, QA teams would struggle to ensure
                everything was still working. This caused tension between teams
                and resulted in bugs making it into production.
              </p>
              <p>
                You’d expect automated tests to help, but these were a huge
                effort because only engineers could create the tests, and the
                apps themselves kept changing—breaking the tests regularly and
                leading to high maintenance overhead. Functional tests often
                failed not because of actual app errors, but due to changes like
                copy updates or modifications to element IDs. This was already a
                challenge, even before considering the added complexities of
                multiple platforms, different environments, multilingual UIs,
                marketing popups, A/B tests, or minor UI changes from
                third-party authentication or payment providers.
              </p>
              <p>
                We realized that combining computer vision with LLM reasoning
                could solve the common flakiness issues in E2E testing. So, we
                launched GPT Driver—a no-code editor paired with a hosted
                emulator/simulator service that allows teams to set up test
                automation efficiently. Our visual + LLM reasoning test
                execution reduces false alarms, enabling teams to integrate
                their E2E tests into their CI/CD pipelines without getting
                blocked. Some interesting technical challenges we faced along
                the way: (1) UI Object Detection from Vision Input: We had to
                train object detection models (YOLO and Faster R-CNN based) on a
                subset of the RICO dataset as well as our own dataset to be able
                to interact accurately with the UI. (2) Reasoning with Current
                LLMs: We have to shorten instructions, action history, and
                screen content during runtime for better results, as handling
                large amounts of input tokens remains a challenge. We also work
                with reasoning templates to achieve robust decision-making. (3)
                Performance Optimization: We optimized our agentic loop to make
                decisions in less than 4 seconds. To reduce this further, we
                implemented caching mechanisms and offer a command-first
                approach, where our AI agent only takes over when the command
                fails.
              </p>
              <p>
                Since launching GPT Driver, we’ve seen adoption by technical
                teams, both with and without dedicated QA roles. Compared to
                code-based tests, the core benefit is the reduction of both the
                manual work and the time required to maintain effective E2E
                tests. This approach is particularly powerful for apps which
                have a lot of dynamic screens and content such as Duolingo which
                we have been working with since a couple of months.
                Additionally, the tests can now also be managed by
                non-engineers.
              </p>
              <p>
                We’d love to hear about your experiences with E2E test
                automation—what approaches have worked or didn’t work for you?
                What features would you find valuable?
              </p>
            </div>
          </section>
        </section>
        <section id="41923945">
          <h3>
            <a
              class="item"
              href="https://blog.apnic.net/2021/07/05/tcp-fast-open-not-so-fast/"
              >TCP Fast Open? Not so fast (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-23 @ 11:42:02</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41923945"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41923931">
          <h3>
            <a
              class="item"
              href="https://krebsonsecurity.com/2024/10/the-global-surveillance-free-for-all-in-mobile-ad-data/"
              >The Global Surveillance Free-for-All in Mobile Ad Data</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-23 @ 11:39:49</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41923931"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41923641">
          <h3>
            <a
              class="item"
              href="https://blog.hyperknot.com/p/comparing-auth-providers"
              >Comparing Auth from Supabase, Firebase, Auth.js, Ory, Clerk and
              Others</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-23 @ 10:35:26</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41923641"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41923625">
          <h3>
            <a
              class="item"
              href="https://cybernetist.com/2024/10/21/you-should-probably-pay-attention-to-tokenizers/"
              >Probably pay attention to tokenizers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-23 @ 10:29:15</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41923625"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41922556">
          <h3>
            <a
              class="item"
              href="https://www.newscatcherapi.com/career/web-crawling-scraping-engineer"
              >NewsCatcher (YC S22) Is Hiring Web Scraping/Crawling Engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-23 @ 07:00:15</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41922356">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=iwVu2BWLZqA"
              >The Incredible Machine (1968) [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-23 @ 06:24:16</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41922356"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41922081">
          <h3>
            <a class="item" href="https://bernsteinbear.com/blog/row-poly/"
              >Adding row polymorphism to Damas-Hindley-Milner</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-23 @ 05:26:23</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41922081"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41920591">
          <h3>
            <a class="item" href="https://bmchtech.github.io/post/multiply/"
              >Solving the Mystery of ARM7TDMI Multiply Carry Flag</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-23 @ 01:13:28</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41920591"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41920401">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2024-10-23/arm-to-cancel-qualcomm-chip-design-license-in-escalation-of-feud"
              >Arm is canceling Qualcomm's chip design license</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-23 @ 00:48:24</span
              ><span class="points-container"
                >Points: <span class="points">486</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41920401"
                  >Comments</a
                ><span class="descendants">: 319</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41919711">
          <h3>
            <a
              class="item"
              href="https://science.nasa.gov/missions/chandra/the-dawn-of-a-new-era-for-supernova-1987a/"
              >The Dawn of a New Era for Supernova 1987a (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 23:09:37</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41919711"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41919262">
          <h3>
            <a
              class="item"
              href="https://www.micron.com/about/blog/memory/dram/how-dram-changed-the-world"
              >How DRAM changed the world</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 22:12:15</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41919262"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41918626">
          <h3>
            <a
              class="item"
              href="https://www.laphamsquarterly.org/roundtable/her-majestys-rat-catcher"
              >Her Majesty’s Rat-Catcher (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 20:58:55</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41918626"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41917016">
          <h3>
            <a
              class="item"
              href="https://www.theatlantic.com/technology/archive/2017/04/the-tragedy-of-google-books/523320/"
              >The Tragedy of Google Books (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 18:11:03</span
              ><span class="points-container"
                >Points: <span class="points">332</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41917016"
                  >Comments</a
                ><span class="descendants">: 142</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41916322">
          <h3>
            <a
              class="item"
              href="https://www.usgs.gov/news/national-news-release/unlocking-arkansas-hidden-treasure-usgs-uses-machine-learning-show-large"
              >USGS uses machine learning to show large lithium potential in
              Arkansas</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 17:05:01</span
              ><span class="points-container"
                >Points: <span class="points">321</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41916322"
                  >Comments</a
                ><span class="descendants">: 197</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41915958">
          <h3>
            <a class="item" href="https://github.com/solcloud/Counter-Strike"
              >Show HN: Open-source Counter-Strike-like game</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 16:27:51</span
              ><span class="points-container"
                >Points: <span class="points">386</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41915958"
                  >Comments</a
                ><span class="descendants">: 151</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41914989">
          <h3>
            <a
              class="item"
              href="https://www.anthropic.com/news/3-5-models-and-computer-use"
              >Computer use, a new Claude 3.5 Sonnet, and Claude 3.5 Haiku</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 15:02:46</span
              ><span class="points-container"
                >Points: <span class="points">1353</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41914989"
                  >Comments</a
                ><span class="descendants">: 684</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41914845">
          <h3>
            <a
              class="item"
              href="https://clickhouse.com/blog/a-new-powerful-json-data-type-for-clickhouse"
              >A new JSON data type for ClickHouse</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-22 @ 14:47:00</span
              ><span class="points-container"
                >Points: <span class="points">359</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41914845"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41900190">
          <h3>
            <a
              class="item"
              href="https://github.com/konstin/sudoku-in-python-packaging"
              >Solving Sudoku in Python Packaging</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-21 @ 02:30:28</span
              ><span class="points-container"
                >Points: <span class="points">255</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41900190"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41886047">
          <h3>
            <a
              class="item"
              href="https://blog.wilsonb.com/posts/2024-09-27-brainfuck.html"
              >Implementing Brainfuck in APL</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-19 @ 06:32:50</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41886047"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41885192">
          <h3>
            <a
              class="item"
              href="https://theconversation.com/what-makes-a-person-seem-wise-global-study-finds-that-cultures-do-differ-but-not-as-much-as-youd-think-238808"
              >What makes a person seem wise?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-19 @ 02:29:00</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41885192"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41883365">
          <h3>
            <a
              class="item"
              href="https://github.com/pc2005cz/TheUltimate486Upgrade/blob/main/main.md"
              >Coreboot port for 486 motherboard (UM8881/6)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-18 @ 20:48:43</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41883365"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41879930">
          <h3>
            <a
              class="item"
              href="https://dl.acm.org/doi/10.1145/3613904.3642063"
              >Supporting Task Switching with Reinforcement Learning</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-18 @ 14:46:58</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41879930"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
