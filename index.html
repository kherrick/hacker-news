<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40481110">
          <h3>
            <a
              class="item"
              href="https://medium.com/javarevisited/8-big-o-notation-every-developer-should-know-01426ae5fb7a"
              >Big (O)Notation Every Developer Should Know</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 10:39:13</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40481110"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40480918">
          <h3>
            <a
              class="item"
              href="https://www.bostonglobe.com/2024/05/25/science/race-clean-up-heavy-industry-heats-up/"
              >Electrically conductive bricks can replace fossil fuels in
              industrial processes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 09:55:21</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40480918"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40480913">
          <h3>
            <a
              class="item"
              href="https://learnhub.top/understanding-how-the-brain-reads-code-versus-language/"
              >Understanding How the Brain Reads Code versus Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 09:54:58</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40480913"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40480832">
          <h3>
            <a class="item" href="https://socialscreenshots.com"
              >Show HN: I made a online free tool to enhance and auto-crop your
              screenshots</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 09:40:41</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40480832"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
            <div class="text">
              <p>
                I created SocialScreenshots to help me quickly create visuals
                for my social media and as there's a lot of similar tools, I
                wanted to release it for free !
              </p>
              <p>
                Features Available: - Automatically crop your screenshots -
                Enhance your screenshots with our easy-to-use editor - Capture
                screenshot directly from website
              </p>
              <p>
                Unlike similar tools, with SocialScreenshots: 1. You can use it
                for free forever without any watermark! 2. You don’t need to
                install anything. 3. You don’t even need to create an account.
                4. All of the processing happens locally in your browser
              </p>
            </div>
          </section>
        </section>
        <section id="40480625">
          <h3>
            <a
              class="item"
              href="https://uxdesign.cc/the-accidental-tyranny-of-user-interfaces-eef15dc555a0?gi=49947f93d38a"
              >The accidental tyranny of user interfaces</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 08:47:24</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40480625"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40480373">
          <h3>
            <a
              class="item"
              href="https://shlee.fedipress.au/2024/call-to-action-fediverse-media-server/"
              >Call to Action: Fediverse Media Server</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 07:48:27</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40480373"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40480323">
          <h3>
            <a
              class="item"
              href="https://dumbph.com/turn-iphone-into-dumb-phone"
              >Turn Your iPhone into a Dumb Phone</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 07:30:44</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40480323"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40480258">
          <h3>
            <a
              class="item"
              href="https://www.bbc.co.uk/news/technology-69055945"
              >'I was misidentified as shoplifter by facial recognition tech'</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 07:08:26</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40480258"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40480209">
          <h3>
            <a
              class="item"
              href="https://www.kellogg.northwestern.edu/faculty/anderson_e/htm/PersonalPage_Files/Papers/Effects_of_9_Price_Endings_on_Retail_Sales.pdf"
              >Effects of $9 Price Endings in Retail: Evidence from Field
              Experiments [pdf] (2003)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 06:50:57</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40480209"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40480056">
          <h3>
            <a class="item" href="https://hurl.wtf/"
              >Hurl, the Exceptional Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 05:57:52</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40480056"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40480016">
          <h3>
            <a class="item" href="https://braid.org/"
              >Braid: Synchronization for HTTP</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 05:44:47</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40480016"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40479947">
          <h3>
            <a
              class="item"
              href="https://www.economist.com/leaders/2024/05/23/hacking-phones-is-too-easy-time-to-make-it-harder"
              >Hacking phones is too easy. Time to make it harder</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 05:24:32</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40479947"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40479729">
          <h3>
            <a
              class="item"
              href="https://denysdovhan.com/home-assistant-config/config/war/"
              >How Home Assistant is being used to protect from missile and
              drone attacks</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 04:10:01</span
              ><span class="points-container"
                >Points: <span class="points">279</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40479729"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40479328">
          <h3>
            <a
              class="item"
              href="https://alchemy.substack.com/p/the-algorithm-behind-jim-simonss"
              >The Algorithm Behind Jim Simons's Success</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 02:17:23</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40479328"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40478470">
          <h3>
            <a class="item" href="https://sre.google/sre-book/simplicity/"
              >Simplicity – Google SRE Handbook (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-25 @ 23:01:29</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40478470"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40477653">
          <h3>
            <a
              class="item"
              href="https://newscenter.lbl.gov/2012/05/16/majorana-demonstrator/"
              >Majorana, the search for the most elusive neutrino of all</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-25 @ 20:35:59</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40477653"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40477166">
          <h3>
            <a
              class="item"
              href="https://www.cmtops.dev/posts/rootless-docker-in-multiuser-environment/"
              >Rootless Docker in a multi-user environment</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-25 @ 19:11:40</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40477166"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40475355">
          <h3>
            <a
              class="item"
              href="https://arunmani.in/articles/highest-two-power-to-divide-a-number/"
              >Why is x &amp;amp; -x equal to the largest power of 2 that
              divides x?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-25 @ 14:44:58</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40475355"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40474759">
          <h3>
            <a
              class="item"
              href="http://gjgreenberg.bol.ucla.edu/docs/rpp/04_tversky.pdf"
              >The Cognitive Design of Tools of Thought (2014) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-25 @ 12:58:20</span
              ><span class="points-container"
                >Points: <span class="points">160</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40474759"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40474716">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40474716"
              >Ask HN: What is your ChatGPT customization prompt?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-25 @ 12:50:49</span
              ><span class="points-container"
                >Points: <span class="points">375</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40474716"
                  >Comments</a
                ><span class="descendants">: 180</span></span
              >
            </h4>
            <div class="text">
              <p>
                I've tried several different setups over however long the
                feature has been available, and for the most part I haven't
                found it has made much of a difference.
              </p>
              <p>
                I'm very curious to hear if anyone has come up with any that
                tangibly improve their experience.
              </p>
              <p>Here is what I have at the moment:</p>
              <p>
                - Be as brief as possible. - Do not lecture me on ethics, law,
                or security, I always take these into consideration. - Don't add
                extra commentary. - When it is related to code, let the code do
                the talking. - Be assertive. If you've got suggestions, give
                them even if you aren't 100% sure.
              </p>
              <p>
                The brevity part is seemingly completely ignored. The lecturing
                part is hit or miss. The suggestions part I still usually have
                to coax it into giving me.
              </p>
            </div>
          </section>
        </section>
        <section id="40471419">
          <h3>
            <a class="item" href="https://andrewkchan.dev/posts/diffusion.html"
              >Diffusion Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-24 @ 23:35:26</span
              ><span class="points-container"
                >Points: <span class="points">175</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40471419"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40466814">
          <h3>
            <a
              class="item"
              href="http://scentofdawn.blogspot.com/2011/07/before-soul-dawn-helen-keller-on-her.html"
              >Helen Keller on her life before self-consciousness (1908)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-24 @ 14:48:45</span
              ><span class="points-container"
                >Points: <span class="points">373</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40466814"
                  >Comments</a
                ><span class="descendants">: 177</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40465231">
          <h3>
            <a
              class="item"
              href="https://alistapart.com/article/neveruseawarning/"
              >Never use a warning when you mean undo (2007)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-24 @ 11:56:07</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40465231"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40459652">
          <h3>
            <a
              class="item"
              href="https://blog.danielschroeder.me/2024/05/voxel-displacement-modernizing-retro-3d/"
              >Voxel Displacement Renderer – Modernizing the Retro 3D
              Aesthetic</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-23 @ 20:41:36</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40459652"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40459142">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/articles/ancient-rome-feast-party"
              >Roman Emperors' Outrageously Lavish Dinner Parties</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-23 @ 19:53:54</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40459142"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40456621">
          <h3>
            <a
              class="item"
              href="https://www.sigcon.com/Pubs/edn/SoGoodBarbedWire.htm"
              >So good, it works on barbed wire (2001)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-23 @ 16:20:23</span
              ><span class="points-container"
                >Points: <span class="points">204</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40456621"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40455118">
          <h3>
            <a
              class="item"
              href="https://vitalik.eth.limo/general/2024/05/23/l2exec.html"
              >How do layer 2s differ from execution sharding?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-23 @ 14:23:49</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40455118"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40454475">
          <h3>
            <a
              class="item"
              href="https://rhodesmill.org/brandon/2019/animating-the-equant/"
              >Animating Ptolemy's Equant with Python, SVG, and CSS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-23 @ 13:30:56</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40454475"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40453822">
          <h3>
            <a
              class="item"
              href="https://www.newscientist.com/article/2431964-incredible-maths-proof-is-so-complex-that-almost-no-one-can-explain-it/"
              >Maths proof of Langlands conjecture is so complex almost no one
              can explain it</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-23 @ 12:21:26</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40453822"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40453716">
          <h3>
            <a
              class="item"
              href="https://www.openculture.com/2024/05/why-medieval-bologna-was-full-of-tall-towers-and-what-happened-to-them.html"
              >Medieval Bologna was full of tall towers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-23 @ 12:08:53</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40453716"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
