<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="46359042">
          <h3>
            <a
              class="item"
              href="https://nevadacurrent.com/2025/12/22/feds-demand-compromise-on-colorado-river-states-flounder-despite-water-shoratge/"
              >Feds demand compromise on Colorado River while states flounder</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-22 @ 21:03:04</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46359042"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46358437">
          <h3>
            <a
              class="item"
              href="https://comicbook.com/gaming/news/vince-zampella-developer-of-call-of-duty-and-battlefield-dead-at-55/"
              >Vince Zampella, developer of Call of Duty and Battlefield has
              died</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-22 @ 20:12:20</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46358437"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46357945">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/ultrasound-cancer-treatment"
              >Ultrasound Cancer Treatment: Sound Waves Fight Tumors</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-22 @ 19:37:34</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46357945"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46357881">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/science/2025/12/us-government-finds-new-excuse-to-stop-construction-of-offshore-wind/"
              >US blocks all offshore wind construction, says reason is
              classified</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-22 @ 19:31:11</span
              ><span class="points-container"
                >Points: <span class="points">238</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46357881"
                  >Comments</a
                ><span class="descendants">: 190</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46357870">
          <h3>
            <a class="item" href="https://gchandbook.org/index.html"
              >The Garbage Collection Handbook</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-22 @ 19:30:18</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46357870"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46357675">
          <h3>
            <a
              class="item"
              href="https://jalammar.github.io/illustrated-transformer/"
              >The Illustrated Transformer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-22 @ 19:15:56</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46357675"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46357535">
          <h3>
            <a
              class="item"
              href="https://www.latimes.com/environment/story/2025-12-18/state-regulators-vote-to-keep-utility-profits-high-angering-customers"
              >State regulators vote to keep utility profits high angering
              customers across CA</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-22 @ 19:06:16</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46357535"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46357458">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2512.14693"
              >Universal Reasoning Model (53.8% pass 1 ARC1 and 16.0% ARC 2)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-22 @ 18:59:22</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46357458"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46357451">
          <h3>
            <a class="item" href="https://enzom.dev/b/passkeys/"
              >Things I learnt about passkeys when building passkeybot</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-22 @ 18:58:45</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46357451"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46357287">
          <h3>
            <a class="item" href="https://z.ai/blog/glm-4.7"
              >GLM-4.7: Advancing the Coding Capability</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-22 @ 18:46:32</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46357287"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46356320">
          <h3>
            <a class="item" href="https://hengefinder.rcdis.co/#learn"
              >Henge Finder</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-22 @ 17:32:18</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46356320"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46355949">
          <h3>
            <a
              class="item"
              href="https://www.jeffgeerling.com/blog/2025/nist-was-5-μs-utc-after-last-weeks-power-cut"
              >NIST was 5 μs off UTC after last week's power cut</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-22 @ 17:01:28</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46355949"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46355932">
          <h3>
            <a class="item" href="https://www.useparallel.com/uplane1/careers"
              >Uplane (YC F25) Is Hiring Founding Engineers (Full-Stack and
              AI)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-22 @ 17:00:34</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46355888">
          <h3>
            <a
              class="item"
              href="https://reason.com/2025/12/19/jimmy-lai-is-a-martyr-for-freedom/"
              >Jimmy Lai Is a Martyr for Freedom</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-22 @ 16:56:35</span
              ><span class="points-container"
                >Points: <span class="points">233</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46355888"
                  >Comments</a
                ><span class="descendants">: 108</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46355345">
          <h3>
            <a
              class="item"
              href="https://skilldeliver.com/your-supabase-is-public"
              >Your Supabase Is Public</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-22 @ 16:14:43</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46355345"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46355165">
          <h3>
            <a
              class="item"
              href="https://github.com/anthropics/claude-code/blob/main/CHANGELOG.md"
              >Claude Code gets native LSP support</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-22 @ 15:59:01</span
              ><span class="points-container"
                >Points: <span class="points">213</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46355165"
                  >Comments</a
                ><span class="descendants">: 118</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46354970">
          <h3>
            <a
              class="item"
              href="https://blog.kierangill.xyz/oversight-and-guidance"
              >Scaling LLMs to Larger Codebases</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-22 @ 15:38:37</span
              ><span class="points-container"
                >Points: <span class="points">178</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46354970"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46353777">
          <h3>
            <a
              class="item"
              href="https://dfarq.homeip.net/the-biggest-crt-ever-made-sonys-pvm-4300/"
              >The biggest CRT ever made: Sony's PVM-4300</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-22 @ 12:54:29</span
              ><span class="points-container"
                >Points: <span class="points">196</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46353777"
                  >Comments</a
                ><span class="descendants">: 129</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46352565">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/culture/article/20251219-the-ancient-monuments-saluting-the-winter-solstice"
              >The ancient monuments saluting the winter solstice</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-22 @ 09:30:58</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46352565"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46352286">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=g7vmPFZrYAk"
              >Hybrid Aerial Underwater Drone – Bachelor Project [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-22 @ 08:37:34</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46352286"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
            <div class="text">
              <a
                href="https://www.energy.aau.dk/aau-drone-can-both-fly-and-dive-underwater-n145124"
                >https://www.energy.aau.dk/aau-drone-can-both-fly-and-dive-un...</a
              >
            </div>
          </section>
        </section>
        <section id="46352231">
          <h3>
            <a class="item" href="https://diziet.dreamwidth.org/20436.html"
              >Debian's Git Transition</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-22 @ 08:24:32</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46352231"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46338437">
          <h3>
            <a
              class="item"
              href="https://timthompson.com/plum/cgi/showlist.cgi?sort=name&amp;concise=yes"
              >Programming languages used for music</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-20 @ 18:40:45</span
              ><span class="points-container"
                >Points: <span class="points">211</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46338437"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46331364">
          <h3>
            <a class="item" href="https://netrinos.com"
              >Show HN: Netrinos – A keep it simple Mesh VPN for small teams</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-19 @ 21:50:52</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46331364"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
            <div class="text">
              <p>
                Netrinos creates a LAN-like overlay network across your devices.
                Connections are direct P2P via WireGuard, with no central server
                routing traffic. Each device gets a stable IP and DNS name
                (pc.you.netrinos.com). When direct connections fail, they fall
                back to a relay server that's still encrypted end-to-end. We
                can't see your traffic.
              </p>
              <p>
                The most challenging problem to solve was NAT traversal. UDP
                hole punching works most of the time. The rest is a cocktail of
                symmetric NAT, CGNAT, and serial NATs. We use STUN-style
                discovery and relay fallback for the edge cases. I was surprised
                by how unreliable low-end ISP routers really are, and how much
                technical wizardry it takes to hide that behind a clean, simple
                UX.
              </p>
              <p>
                Our stack is a Go backend for client and server, WireGuard
                kernel mode for Linux and Windows (macOS is userspace), Wails.io
                for cross-platform UI. WireGuard does all the heavy lifting. Go
                ties it all together.
              </p>
              <p>
                Popular use cases include: RDP to home PCs, accessing NAS
                without exposing it, and SSH into headless Linux boxes. One
                customer manages hundreds of IoT devices in the field,
                eliminating the need to deal with customer routers.
              </p>
              <p>
                We just released Pro with multi-user, access control, and remote
                gateway routing. Personal is free (up to 100 devices).
              </p>
              <p>
                I'd love to hear what you expect from a simple mesh VPN, what's
                missing from current tools, and what's lacking from your remote
                access setup. Use code HNPRO26 for a 30-day trial of Pro.
              </p>
              <p><a href="https://netrinos.com">https://netrinos.com</a></p>
            </div>
          </section>
        </section>
        <section id="46316050">
          <h3>
            <a
              class="item"
              href="https://www.schneier.com/blog/archives/2025/12/deliberate-internet-shutdowns.html"
              >Deliberate Internet Shutdowns</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-18 @ 17:49:10</span
              ><span class="points-container"
                >Points: <span class="points">300</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46316050"
                  >Comments</a
                ><span class="descendants">: 155</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46315581">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=N5yV1Q9O6r4"
              >There's no such thing as a fake feather [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-18 @ 17:14:44</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46315581"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46312755">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/the-rise-of-sql"
              >The Rise of SQL:the second programming language everyone needs to
              know</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-18 @ 14:00:50</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46312755"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46305516">
          <h3>
            <a class="item" href="https://github.com/dpipstudio/botwave"
              >Show HN: An easy way of broadcasting radio around you (looking
              for feedback)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-17 @ 21:07:18</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46305516"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
            <div class="text">
              The project identifies as "Your Raspberry Pi FM network". It uses
              a fork of the well-known PiFmRds as a backend to stream audio on
              FM radio. It allows the control of multiple pi units with a
              central server, that can also be temporarly hosted on google cloud
              shell or github codespaces.
            </div>
          </section>
        </section>
        <section id="46288042">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/security/2025/12/microsoft-will-finally-kill-obsolete-cipher-that-has-wreaked-decades-of-havoc/"
              >Microsoft will finally kill obsolete cipher that has wreaked
              decades of havoc</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-16 @ 13:08:46</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46288042"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46287464">
          <h3>
            <a
              class="item"
              href="https://brooker.co.za:443/blog/2025/12/15/database-for-ssd.html"
              >How do SSDs change database design?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-16 @ 11:52:55</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46287464"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46286935">
          <h3>
            <a
              class="item"
              href="https://nakst.gitlab.io/tutorial/ui-part-1.html"
              >Let's write a toy UI library</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-16 @ 10:31:40</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46286935"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
