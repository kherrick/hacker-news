<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37698506">
          <h3>
            <a class="item" href="https://github.com/sapientml/sapientml"
              >Show HN: SapientML – Generative AutoML for Tabular Data</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-29 @ 02:10:28</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37698506"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37698334">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=37698334"
              >Ask HN: Which is the oldest software alive still in 0.x, used by
              many?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-29 @ 01:45:21</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37698334"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
            <div class="text">
              <p>
                PuTTY's first Git commit shows "Fri Jan 8 13:02:13 1999" for
                beta 0.43, from r11 of SVN.
              </p>
              <p>
                https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html
              </p>
            </div>
          </section>
        </section>
        <section id="37698322">
          <h3>
            <a
              class="item"
              href="https://www.stoneageherbalist.com/p/the-maori-genocide-of-the-moriori"
              >The Māori Genocide of the Moriori</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-29 @ 01:43:42</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37698322"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37697948">
          <h3>
            <a
              class="item"
              href="https://www.politico.com/minutes/congress/09-8-2023/senate-reply-all-mess/"
              >US Senate’s email system melts down in face of security test and
              reply-all chaos</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-29 @ 00:45:31</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37697948"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37697846">
          <h3>
            <a class="item" href="https://choubey.gitbook.io/internals-of-deno/"
              >The Internals of Deno</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-29 @ 00:32:39</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37697846"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37697795">
          <h3>
            <a class="item" href="https://mozilla.social"
              >Mozilla.social mastodon instance is live</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-29 @ 00:25:37</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37697795"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37697152">
          <h3>
            <a
              class="item"
              href="https://twitter.com/pdrmnvd/status/1707395736458207430"
              >Ads team begging for worse search results so that ads team can
              hit their goals</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-28 @ 23:09:52</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37697152"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37697030">
          <h3>
            <a
              class="item"
              href="https://this.alicorn.gay/post/729670550209937408/discord-as-a-filehost-will-no-longer-be-possible"
              >Discord as a filehost will no longer be possible by the end of
              the year</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-28 @ 22:56:04</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37697030"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37696467">
          <h3>
            <a
              class="item"
              href="https://graphite.dev/blog/the-best-pr-title-of-all-time"
              >The comprehensive guide to writing the best PR title of all
              time</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-28 @ 22:02:54</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37696467"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37695530">
          <h3>
            <a class="item" href="https://github.com/fill3d/fill"
              >Show HN: Generative Fill with AI and 3D</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-28 @ 20:41:30</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37695530"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
            <div class="text">
              <p>
                You've probably seen projects that add objects to an image from
                a style or text prompt, like InteriorAI (levelsio) and Adobe
                Firefly. The prevalent issue with these diffusion-based
                inpainting approaches is that they don't yet have great
                conditioning on lighting, perspective, and structure. You'll
                often get incorrect or generic shadows; warped-looking objects;
                and distorted backgrounds.
              </p>
              <p>
                What is Fill 3D? Fill 3D is an exploration on doing generative
                fill in 3D to render ultra-realistic results that harmonize with
                the background image, using industry-standard path tracing, akin
                to compositing in Hollywood movies.
              </p>
              <p>
                How does it work? 1. Deproject: First, deproject an image to a
                3D shell using both geometric and photometric cues from the
                input image. 2. Place: Draw rectangles and describe what you
                want in them, akin to Photoshop's Generative Fill feature. 3.
                Render: Use good ol' path tracing to render ultra-realistic
                results.
              </p>
              <p>
                Why Fill 3D? + The results are insanely realistic (see video in
                the github repo, or on the website). + Fast enough: Currently,
                generations take 40-80 seconds. Diffusion takes ~10seconds, so
                we're slower, but for the level of realism, it's pretty good. +
                Potential applications: I'm thinking of virtual staging in real
                estate media, what do you think?
              </p>
              <p>
                Check it out at
                <a href="https://fill3d.ai">https://fill3d.ai</a> + There's API
                access! :D + Right now, you need an image of an empty room. Will
                loosen this restriction over time.
              </p>
              <p>
                Fill 3D is built on Function (<a href="https://fxn.ai"
                  >https://fxn.ai</a
                >). With Function, I can run the Python functions that do the
                steps above on powerful GPUs with only code (no Dockerfile,
                YAML, k8s, etc), and invoke them from just about anywhere. I'm
                the founder of fxn.
              </p>
              <p>Tell me what you think!!</p>
              <p>PS: This is my first Show HN, so please be nice :)</p>
            </div>
          </section>
        </section>
        <section id="37695245">
          <h3>
            <a class="item" href="https://xlinux.nist.gov/dads/"
              >Dictionary of Algorithms and Data Structures</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-28 @ 20:19:26</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37695245"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37695165">
          <h3>
            <a class="item" href="https://redbadger.github.io/crux/"
              >Crux: Cross-platform app development in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-28 @ 20:13:28</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37695165"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37695035">
          <h3>
            <a
              class="item"
              href="https://rocknerd.co.uk/2023/09/28/bandcamp-has-been-sold-to-songtradr/"
              >Bandcamp has been sold to Songtradr. What does this mean for the
              musicians?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-28 @ 20:04:13</span
              ><span class="points-container"
                >Points: <span class="points">191</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37695035"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37694910">
          <h3>
            <a class="item" href="https://github.com/Kautenja/RackNES"
              >RackNES: NES Module for VCV Rack</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-28 @ 19:55:54</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37694910"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37694414">
          <h3><a class="item" href="https://librepcb.org/">LibrePCB</a></h3>
          <section>
            <h4>
              <span>2023-09-28 @ 19:23:04</span
              ><span class="points-container"
                >Points: <span class="points">241</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37694414"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37694333">
          <h3>
            <a class="item" href="https://amtrakexplorer.com/"
              >Amtrak Explorer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-28 @ 19:17:33</span
              ><span class="points-container"
                >Points: <span class="points">163</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37694333"
                  >Comments</a
                ><span class="descendants">: 140</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37693766">
          <h3>
            <a
              class="item"
              href="https://retrocomputing.stackexchange.com/questions/27741/how-were-the-signs-for-logical-and-arithmetic-operators-decided"
              >How were the signs for logical and arithmetic operators
              decided?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-28 @ 18:36:23</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37693766"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37692467">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=37692467"
              >GoGoGrandparent (YC S16) is hiring a senior/staff back
              end/full-stack engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-28 @ 17:00:47</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
            <div class="text">
              <p>
                The position: FULLY REMOTE | Full-time | US, UK, or able to work
                4+ hours overlap with mainland US
              </p>
              <p>
                Build high-quality, robust engineering at the rarest of things -
                a Silicon Valley startup that is both wholesome AND profitable.
                We have 8-figure revenue, are YC-backed, and growing fast.
              </p>
              <p>
                Tech stack (<i>required): Back-end heavy (Node</i>, Typescript<i
                  >, MySQL</i
                >, REST*+GraphQL), front-end (Vue), deploy (AWS, Docker/K8s)
              </p>
              <p>
                Minimum 4 years experience (with Node). If full-stack, you must
                be strongest on the backend.
              </p>
              <p>2-stage interview process.</p>
              <p>
                If you want to help older adults and people with disabilities,
                send your LinkedIn/CV to william@gogograndparent.com (keep it
                brief) or apply at
                <a
                  href="https://www.ycombinator.com/companies/gogograndparent/jobs"
                  >https://www.ycombinator.com/companies/gogograndparent/jobs</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="37692335">
          <h3>
            <a
              class="item"
              href="https://www.publicbooks.org/publishers-and-scholars-unite/"
              >Universities have disinvested from their presses just as much as
              their libraries</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-28 @ 16:52:54</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37692335"
                  >Comments</a
                ><span class="descendants">: 144</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37691686">
          <h3>
            <a
              class="item"
              href="https://royalsocietypublishing.org/doi/10.1098/rsbl.2020.0370"
              >Just kidding: the evolutionary roots of playful teasing</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-28 @ 16:09:55</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37691686"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37691232">
          <h3>
            <a class="item" href="https://jamesbvaughan.com/southwest-wifi/"
              >WiFi without internet on a Southwest flight</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-28 @ 15:42:05</span
              ><span class="points-container"
                >Points: <span class="points">1051</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37691232"
                  >Comments</a
                ><span class="descendants">: 469</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37691057">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/air-space-magazine/airliner-repair-247-9974457/"
              >Airliner Repair, 24/7 Boeing’s traveling fix-it team (2008)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-28 @ 15:31:03</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37691057"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37690320">
          <h3>
            <a
              class="item"
              href="https://tidyfirst.substack.com/p/coding-in-the-debugger"
              >Coding in the Debugger (2007)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-28 @ 14:48:51</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37690320"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37688887">
          <h3>
            <a class="item" href="https://www.freerdp.com/"
              >FreeRDP: A remote desktop protocol implementation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-28 @ 12:48:14</span
              ><span class="points-container"
                >Points: <span class="points">204</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37688887"
                  >Comments</a
                ><span class="descendants">: 121</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37688341">
          <h3>
            <a
              class="item"
              href="https://swiftrocks.com/how-async-await-works-internally-in-swift"
              >How async/await works internally in Swift</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-28 @ 12:00:22</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37688341"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37688340">
          <h3>
            <a
              class="item"
              href="https://www.tamikothiel.com/theory/cm_txts/di-frames.html"
              >The Design of the Connection Machine</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-28 @ 12:00:18</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37688340"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37687134">
          <h3>
            <a
              class="item"
              href="https://aras-p.info/blog/2023/09/27/Making-Gaussian-Splats-more-smaller/"
              >Making Gaussian Splats more smaller</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-28 @ 09:10:00</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37687134"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37686633">
          <h3>
            <a
              class="item"
              href="https://effectivetypescript.com/2023/09/27/closure-compiler/"
              >The saga of the Closure compiler, and why TypeScript won</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-28 @ 07:55:38</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37686633"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37686400">
          <h3>
            <a class="item" href="https://weaviate.io/blog/pq-rescoring"
              >How to Reduce Memory Requirements with Product Quantization</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-28 @ 07:19:18</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37686400"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37685580">
          <h3>
            <a
              class="item"
              href="https://www.raspberrypi.com/products/raspberry-pi-5/"
              >Raspberry Pi 5</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-28 @ 05:29:21</span
              ><span class="points-container"
                >Points: <span class="points">1359</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37685580"
                  >Comments</a
                ><span class="descendants">: 808</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
