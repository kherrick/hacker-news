<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40047193">
          <h3>
            <a
              class="item"
              href="https://www.space.com/object-crash-florida-home-iss-space-junk-nasa-confirms"
              >Object that slammed into Florida home was space junk for ISS,
              NASA confirms</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-16 @ 00:38:47</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40047193"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40047152">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2404.07738"
              >ResearchAgent: Iterative Research Idea Generation Using LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-16 @ 00:29:40</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40047152"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40047041">
          <h3>
            <a class="item" href="https://github.com/johang/btfs"
              >BTFS (BitTorrent Filesystem)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-16 @ 00:08:46</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40047041"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40046774">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40046774"
              >Show HN: Render audio waveforms to HTML canvas using WebGPU</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 23:23:28</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40046774"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
            <div class="text">
              <p>
                It's the first time I use WebGPU and it's been a while since I
                write shaders. Feedback is very welcome!
              </p>
              <p>
                GitHub: https://github.com/mrkev/webgpu-waveform Examples:
                https://aykev.dev/webgpu-waveform
              </p>
            </div>
          </section>
        </section>
        <section id="40045532">
          <h3>
            <a class="item" href="https://skio.com/careers/"
              >Skio (YC S20) â€“ Subscriptions for Shopify, ReCharge Migrations Is
              Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 21:01:23</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40045357">
          <h3>
            <a
              class="item"
              href="https://www.smilepolitely.com/culture/nathan-tolbert-pushes-the-limitations-of-new-games-on-old-consoles/"
              >Nathan Tolbert pushes the limitations of new games on old
              consoles</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 20:47:31</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40045357"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40045319">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/geometers-engineer-new-tools-to-wrangle-spacecraft-orbits-20240415/"
              >Geometers Engineer New Tools to Wrangle Spacecraft Orbits</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 20:43:53</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40045319"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40045093">
          <h3>
            <a
              class="item"
              href="https://tmo.report/2024/04/t-mobile-employees-across-the-country-receive-cash-offers-to-illegally-swap-sims/"
              >T-Mobile employees across the country receive cash offers to
              illegally swap SIMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 20:19:17</span
              ><span class="points-container"
                >Points: <span class="points">374</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40045093"
                  >Comments</a
                ><span class="descendants">: 336</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40044901">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Ramanujan%27s_lost_notebook"
              >Ramanujan's Lost Notebook</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 19:54:14</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40044901"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40044863">
          <h3>
            <a
              class="item"
              href="https://www.orlandoweekly.com/news/phone-conversations-with-law-enforcement-can-be-recorded-without-their-consent-court-says-36640808"
              >Phone conversations with law enforcement can be recorded without
              their consent</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 19:49:42</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40044863"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40044665">
          <h3>
            <a
              class="item"
              href="https://www.chiark.greenend.org.uk/~sgtatham/putty/wishlist/vuln-p521-bias.html"
              >PuTTY vulnerability vuln-p521-bias</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 19:24:52</span
              ><span class="points-container"
                >Points: <span class="points">316</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40044665"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40044464">
          <h3>
            <a class="item" href="https://www.visualcapitalist.com/histomap/"
              >Histomap: Visualizing the 4000 year history of global power
              (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 19:05:36</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40044464"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40042616">
          <h3>
            <a
              class="item"
              href="https://www.stimmel-law.com/en/articles/story-1-embezzlers-are-nice-people"
              >Embezzlers Are Nice People (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 16:24:51</span
              ><span class="points-container"
                >Points: <span class="points">390</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40042616"
                  >Comments</a
                ><span class="descendants">: 241</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40042497">
          <h3>
            <a class="item" href="https://github.com/lkesteloot/turbopascal"
              >Web-based Turbo Pascal compiler</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 16:15:39</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40042497"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40041430">
          <h3>
            <a
              class="item"
              href="https://www.npr.org/sections/health-shots/2024/04/15/1244501055/tinnitus-hearing-loss-ringing-ear-noise"
              >An FDA approved device offers a new treatment for tinnitus</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 14:58:41</span
              ><span class="points-container"
                >Points: <span class="points">248</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40041430"
                  >Comments</a
                ><span class="descendants">: 154</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40041406">
          <h3>
            <a
              class="item"
              href="https://mattklein123.dev/2024/04/10/do-you-need-to-store-that-telemetry/"
              >Do we need to store all that telemetry?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 14:57:23</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40041406"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40041198">
          <h3>
            <a
              class="item"
              href="https://axleos.com/building-a-gps-receiver-part-1-hearing-whispers/"
              >Show HN: Building a GPS receiver</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 14:42:10</span
              ><span class="points-container"
                >Points: <span class="points">336</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40041198"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
            <div class="text">
              <p>
                Shortly after publishing my iOS 4 jailbreak last October[1], I
                got to work on my next hobby project: a from-scratch homebrew
                GPS receiver, which can solve the userâ€™s location solely from
                billions of radio antenna samples.
              </p>
              <p>
                I took a commodity SDR (alongside the Python standard library
                and numpy) and built a signal processing pipeline that can
                detect and track GPS satellites over many minutes, drop and pick
                up satellites as they come in and out of view, and precisely
                determine the userâ€™s position and clock inaccuracy.
              </p>
              <p>
                All told, gypsum can go from a cold start to a fix on the userâ€™s
                position, and the precise time, in less than a minute of
                listening to the antenna. I went on a journey of learning how to
                detect and track satellite signals that are literally too quiet
                to hear, and I hope that some of the magic comes through in the
                posts!
              </p>
              <p>
                After implementing this myself and walking the long road of
                getting it working, Iâ€™m left completely stunned by the
                brilliance of GPS, across so many axes. I hope you enjoy the
                read!
              </p>
              <p>
                On a more personal note, Iâ€™ll be starting a new job next week
                which isnâ€™t as amenable to publishing side projects, and
                therefore this will be my last publicly-published project for
                some time. Iâ€™ve had great experiences making and sharing
                projects on here, and Iâ€™m really grateful for the positive
                feedback thatâ€™s been shared!
              </p>
              <p>
                [1]:
                <a href="https://news.ycombinator.com/item?id=37736318"
                  >https://news.ycombinator.com/item?id=37736318</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="40038922">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/2024/04/22/are-flying-cars-finally-here"
              >Are flying cars finally here?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 11:05:27</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40038922"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40038773">
          <h3>
            <a
              class="item"
              href="https://www.privatdozent.co/p/the-great-purge-of-1933-9f0"
              >The purge of German science in 1933</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 10:43:42</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40038773"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40038759">
          <h3>
            <a
              class="item"
              href="https://notes.alinpanaitiu.com/Weird-monitor-bugs"
              >Weird monitor bugs people sent me in the last 5 years (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 10:42:04</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40038759"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40038729">
          <h3>
            <a
              class="item"
              href="https://jazco.dev/2024/04/15/in-memory-graphs/"
              >How much memory does a graph take?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 10:36:49</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40038729"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40037811">
          <h3>
            <a class="item" href="https://www.asd-ste100.org/"
              >Simplified Technical English</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 07:26:23</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40037811"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40037486">
          <h3>
            <a
              class="item"
              href="https://dpolakovic.space/blogs/windows-95-printer-hack"
              >Reproducing the printer hack of Windows 95</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 06:04:53</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40037486"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40037466">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/uk-england-gloucestershire-68788690"
              >Mini rope bridges built in Forest of Dean to help dormice</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 06:00:13</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40037466"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40037324">
          <h3>
            <a
              class="item"
              href="http://muratbuffalo.blogspot.com/2020/06/learning-about-distributed-systems.html"
              >Learning about distributed systems: where to start?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 05:26:47</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40037324"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40031732">
          <h3>
            <a
              class="item"
              href="https://www.sci.news/paleontology/titanomachya-gimenezi-12853.html"
              >New Titanosaur Species Identified in Argentina</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-14 @ 15:19:32</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40031732"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40030786">
          <h3>
            <a
              class="item"
              href="https://rtpg.co/2024/03/07/parsing-copilots-type-spaghetti/"
              >Trying to Understand Copilot's Type Spaghetti</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-14 @ 13:01:10</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40030786"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40029469">
          <h3>
            <a
              class="item"
              href="https://www.cambridge.org/core/journals/journal-of-functional-programming/article/knuthmorrispratt-illustrated/8EFA77D663D585B68630E372BCE1EBA4"
              >Knuthâ€“Morrisâ€“Pratt illustrated</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-14 @ 07:55:22</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40029469"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40029032">
          <h3>
            <a
              class="item"
              href="https://placesjournal.org/article/a-city-is-not-a-computer/"
              >A City Is Not a Computer (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-14 @ 06:04:45</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40029032"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40021458">
          <h3>
            <a class="item" href="https://www.adamsummers.org/scanallfish"
              >ScanAllFish</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-13 @ 08:23:01</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40021458"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
