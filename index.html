<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38708065">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2023/12/20/rite-aid-facial-recognition/"
              >Rite Aid banned from using face recognition software after false
              ID shoplifters</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 12:52:44</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38708065"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38707995">
          <h3>
            <a
              class="item"
              href="https://simpleflying.com/concorde-engine-for-sale-ebay/"
              >There's a Concorde Engine Complete with Afterburner for Sale on
              eBay</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 12:45:12</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38707995"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38707809">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2023/12/20/24009125/eu-dsa-pornhub-xvideos-stripchat-digital-services-act-age-verification"
              >Pornhub, XVideos, and Stripchat hit with tough new EU safety
              regulations</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 12:19:21</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38707809"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38707589">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/investigates/special-report/tesla-musk-steering-suspension/"
              >Tesla blamed drivers for failures of parts it long knew were
              defective</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 11:46:33</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38707589"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38707275">
          <h3>
            <a
              class="item"
              href="https://github.com/alphagov/frontend/pull/3895"
              >Update tinsel bunting</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 10:53:58</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38707275"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38707156">
          <h3>
            <a class="item" href="https://notesnook.com/"
              >Notesnook – open-source and zero knowledge private note taking
              app</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 10:28:32</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38707156"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38707095">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=lC4YLMLar5I"
              >Elite: "The game that couldn't be written" [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 10:18:02</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38707095"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38706760">
          <h3>
            <a
              class="item"
              href="https://vickiboykis.com/2023/12/11/why-if-type_checking/"
              >Why if TYPE_CHECKING?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 09:15:24</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38706760"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38706697">
          <h3>
            <a
              class="item"
              href="https://buttondown.email/hillelwayne/archive/advice-for-new-software-devs-whove-read-all-those/"
              >Advice for new software devs who've read all those other advice
              essays</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 09:01:29</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38706697"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38706547">
          <h3>
            <a class="item" href="https://www.bbc.com/news/business-67757333"
              >End of an era for electronics giant Toshiba</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 08:32:17</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38706547"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38706190">
          <h3>
            <a class="item" href="https://quotion.co/"
              >Show HN: A Website to Turn Your Apple Notes into Blogs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 07:11:49</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38706190"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
            <div class="text">
              <a href="https://montaigne.io">https://montaigne.io</a>, a service
              that creates websites, blogs, or portfolios using Apple Notes. I
              liked the idea, but the websites looked too plain for me. So, the
              first product I shipped after quitting is
              <a href="https://quotion.co">https://quotion.co</a> – a website
              that turns your Apple Notes into beautiful blogs. The best part?
              You get custom domain, customizable branding and web analytics for
              free, while Montaigne charges $12 per month. I hope Quotion will
              be as helpful to you as it has been for me. Please let me know if
              you have any questions or feedback.
              <p>Qing</p>
            </div>
          </section>
        </section>
        <section id="38705535">
          <h3>
            <a class="item" href="https://avse.vercel.app"
              >Show HN: I built an open source AI video search engine to learn
              more about AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 04:44:54</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38705535"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
            <div class="text">
              <p>
                With the rise of short form content with TikTok and Youtube. A
                lot more knowledge is in videos than ever before. Finding
                specific answers within millions of videos can be difficult for
                any one person to go through. So the question is if there is
                Google that indexes text on website making it easier to find
                based on the context of on your question, why is there no Google
                that indexes video content making it easier for users to find
                answers within them.
              </p>
              <p>
                So I built this to showcase that it's very much possible with
                the technology and infrastructure that is readily available.
              </p>
              <p>
                I've indexed thousands of videos from Youtube and will be adding
                more, some of the things coming soon: - Index TikTok videos -
                Using whisper to transcribe audio in videos that don't have
                captions - Auto scraping both Youtube and Tiktok everyday to add
                new content
              </p>
              <p>
                The tech stack: - Supbase (PostgreSQL, PG_Vector, Auth) - Hasura
                (GraphQL layer, permissions) - Fly (Hosting of Hasura) -
                JigsawStack (Summary AI, Chat AI) - Vercel (NextJS hosting,
                Serverless functions)
              </p>
              <p>
                The code is opensource here:<a
                  href="https://github.com/yoeven/ai-video-search-engine"
                  >https://github.com/yoeven/ai-video-search-engine</a
                >
              </p>
              <p>
                Would love some feedback and thoughts on what you would like to
                see?
              </p>
            </div>
          </section>
        </section>
        <section id="38705132">
          <h3>
            <a
              class="item"
              href="https://www.economist.com/science-and-technology/2023/11/15/was-an-ancient-bacterium-awakened-by-an-industrial-accident"
              >Was an ancient bacterium awakened by an industrial accident?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 03:30:01</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38705132"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38704982">
          <h3>
            <a class="item" href="https://huggingface.co/papers/2312.11514"
              >LLM in a Flash: Efficient LLM Inference with Limited Memory</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 03:02:43</span
              ><span class="points-container"
                >Points: <span class="points">189</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38704982"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38703943">
          <h3>
            <a class="item" href="https://blog.elicit.com/search-vs-vector-db/"
              >Build a search engine, not a vector DB</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 00:27:10</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38703943"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38703724">
          <h3>
            <a class="item" href="https://github.com/NICUP14/MiniLang"
              >MiniLang: A type-safe C successor that compiles directly to
              x86_64 assembly</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 00:01:34</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38703724"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38702738">
          <h3>
            <a
              class="item"
              href="https://carnewschina.com/2023/12/17/nio-et7-with-150-kwh-semi-solid-state-battery-achieves-a-1044-km-range/"
              >Nio ET7 with 150 kWh semi-solid state battery achieves a 1,044 km
              range</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-19 @ 22:26:00</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38702738"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38702276">
          <h3>
            <a
              class="item"
              href="https://www.switchyardmag.com/issue-1/bulgarianfrontier"
              >The Closing of the Bulgarian Frontier</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-19 @ 21:59:39</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38702276"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38702271">
          <h3>
            <a
              class="item"
              href="https://lwn.net/SubscriberLink/955376/b3fba3bbfabbc411/"
              >The Linux graphics stack in a nutshell</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-19 @ 21:59:18</span
              ><span class="points-container"
                >Points: <span class="points">221</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38702271"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38701780">
          <h3>
            <a
              class="item"
              href="https://www.khronos.org/blog/khronos-finalizes-vulkan-video-extensions-for-accelerated-h.264-and-h.265-encode"
              >Vulkan video extensions for accelerated H.264 and H.265 encode</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-19 @ 21:21:36</span
              ><span class="points-container"
                >Points: <span class="points">208</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38701780"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38700552">
          <h3>
            <a
              class="item"
              href="https://captain-of-coit.github.io/cs2-ecs-explorer/#system/Game.Simulation.ServiceFeeSystem"
              >Show HN: Interactive ECS Systems/Component Explorer for Cities:
              Skylines 2</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-19 @ 19:48:31</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38700552"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
            <div class="text">
              <p>
                Recently I've been diving into doing mods for Cities: Skylines
                2, which been very interesting as it's one of the first games
                that is using ECS and that I also have a deep interest into.
                I've mainly used ECS via Bevy before, but this time it's Unity,
                but many things still work the same way.
              </p>
              <p>
                In order to help myself and other modders to navigate the ECS
                Systems and Components from the decompiled code, I created this
                interactive D3 graph.
              </p>
              <p>
                You can click on nodes to "navigate" to that system/component,
                and once you're zoomed in a particular System/Component, you get
                a sidebar with more details. Ctrl+click also removes nodes in
                case you want to temporarily filter something.
              </p>
              <p>This is, in short, how it works:</p>
              <p>
                1. A C# program extracts information from decompiled C# code:
                <a
                  href="https://github.com/Captain-Of-Coit/cs2-ecs-explorer/blob/master/src/cli.cs"
                  >https://github.com/Captain-Of-Coit/cs2-ecs-explorer/blob/mas...</a
                >
              </p>
              <p>
                2. The program outputs that info as JSON:
                <a
                  href="https://github.com/Captain-Of-Coit/cs2-ecs-explorer/blob/master/data/Systems.json"
                  >https://github.com/Captain-Of-Coit/cs2-ecs-explorer/blob/mas...</a
                >
              </p>
              <p>
                3. Render with D3.js:
                <a
                  href="https://github.com/Captain-Of-Coit/cs2-ecs-explorer/blob/master/index.js"
                  >https://github.com/Captain-Of-Coit/cs2-ecs-explorer/blob/mas...</a
                >
              </p>
              <p>
                Basically it helps people to navigate the Systems and Components
                references for the game.
              </p>
              <p>
                If you're feeling brave, you can also browse the full graph
                which has something like ~700 nodes and ~1200 links:
                <a href="https://captain-of-coit.github.io/cs2-ecs-explorer/"
                  >https://captain-of-coit.github.io/cs2-ecs-explorer/</a
                >
                (it'll take a while to first load)
              </p>
              <p>
                A big problem was to figure out how to make the D3 not too messy
                when there are large graphs, and I don't think I've succeeded
                very well with this, but everything I tried (link distance based
                on how many connections, clustering based on namespaces and so
                on) made it even worse.
              </p>
              <p>Happy to hear what you think and what I could do better.</p>
            </div>
          </section>
        </section>
        <section id="38698907">
          <h3>
            <a class="item" href="https://andrewkchan.dev/posts/fire.html"
              >Simulating fluids, fire, and smoke in real-time</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-19 @ 17:51:38</span
              ><span class="points-container"
                >Points: <span class="points">614</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38698907"
                  >Comments</a
                ><span class="descendants">: 134</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38698782">
          <h3>
            <a class="item" href="https://labs.perplexity.ai/"
              >Perplexity Labs Playground</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-19 @ 17:44:33</span
              ><span class="points-container"
                >Points: <span class="points">264</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38698782"
                  >Comments</a
                ><span class="descendants">: 166</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38695453">
          <h3>
            <a
              class="item"
              href="https://thebsdbox.co.uk/2023/12/08/Application-traffic-with-eBPF/"
              >Application Traffic with eBPF</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-19 @ 13:48:11</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38695453"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38694278">
          <h3>
            <a class="item" href="https://github.com/informalsystems/quint"
              >Quint: A specification language based on the temporal logic of
              actions (TLA)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-19 @ 11:19:55</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38694278"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38693439">
          <h3>
            <a class="item" href="https://github.com/jetmonk/cl-pigpio"
              >Common Lisp interface to the pigpio Raspberry Pi hardware
              library</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-19 @ 09:10:03</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38693439"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38692715">
          <h3>
            <a class="item" href="https://www.somleng.org/blog.html"
              >Open Source Infrastructure Somleng</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-19 @ 07:02:54</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38692715"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38692634">
          <h3>
            <a
              class="item"
              href="https://playfulprogramming.blogspot.com/2023/12/about-time.html"
              >How to unit test code that depends on time</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-19 @ 06:48:46</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38692634"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38692049">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2015/10/25/magazine/terry-gross-and-the-art-of-opening-up.html"
              >Terry Gross and the Art of Opening Up (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-19 @ 05:06:15</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38692049"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38672211">
          <h3>
            <a class="item" href="https://scrollyvideo.js.org/"
              >Responsive scrollable videos without obscure video encoding
              requirements</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-17 @ 11:46:12</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38672211"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
