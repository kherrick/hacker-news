<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38609488">
          <h3>
            <a
              class="item"
              href="https://heistak.github.io/your-code-displays-japanese-wrong/"
              >Your Code Displays Japanese Wrong</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-12 @ 04:28:09</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38609488"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38608672">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=zQeQWGqfFN0"
              >Car Manufacturing Process Overview [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-12 @ 02:43:56</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38608672"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38607540">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/12/11/microsoft_openai_investment_ftc/"
              >FTC wants Microsoft's relationship with OpenAI under the
              microscope</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-12 @ 00:32:53</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38607540"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38607424">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/23945184/epic-v-google-fortnite-play-store-antitrust-trial-updates#stream-entry-65d34a06-1fa5-4eab-abf6-ce450441b543"
              >Epic vs. Google: Google Loses</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-12 @ 00:21:07</span
              ><span class="points-container"
                >Points: <span class="points">715</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38607424"
                  >Comments</a
                ><span class="descendants">: 607</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38606804">
          <h3>
            <a
              class="item"
              href="https://e360.yale.edu/features/worlds-largest-beaver-dam"
              >Deep in the wilderness, the largest beaver dam endures</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 23:14:30</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38606804"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38606667">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2310.00239"
              >AdaptNet: Policy Adaptation for Physics-Based Character
              Control</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 22:57:50</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38606667"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38606587">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=38606587"
              >Ask HN: Working with CPG Retail Data</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 22:51:14</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38606587"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
            <div class="text">
              <p>
                Over the past several years I’ve worked at a mid-size company
                and moved from a basic analyst role to wearing several data
                hats. Mostly taking on data engineering and business
                intelligence tasks. The hot thing right now is Power BI
                reporting, so I build out data pipelines, create data models,
                and design Power BI reports. This has lead to a lot of career
                success at my company, but lately I’ve been more and more
                frustrated by the seemingly antiquated data practices in the CPG
                industry.
              </p>
              <p>
                My company is a bit unique in that we are not a single retailer
                or manufacturer. We work with CPG brands and retailers across
                the entire country. This means we rely heavily on syndicated
                retail data from providers like Circana (merger between IRI and
                The NPD Group) and NielsenIQ (NIQ). They get retail scan data
                from almost every CPG retailer in the country. Except some
                retailers are exclusive to one platform, so you’ll never have a
                complete picture without both.
              </p>
              <p>
                However, Circana and NIQ do not make it easy to extract what I
                consider medium-size data. Everything is a portal with data
                presented across various “dashboards” and rudimentary no-code
                report creator web apps. The minute you ask about an API or data
                transfer service they wonder why you would ever want to leave
                their platform. And when you do convince your company to
                purchase large data extract access or similar (why do we need
                that when we have “analysts” who can extract hundreds of small
                data pieces through the web portal?), you find out it’s
                incredibly fragile, inflexible, slow, and unreliable. The
                pricing for access is never transparent either.
              </p>
              <p>
                In some cases, I can access a retailers’ data directly (for the
                manufacturers my company works with) though their web portal and
                reverse engineer an API. But that’s typically a limited data set
                and more supply chain focused.
              </p>
              <p>
                Has anyone developed a successful data strategy in the CPG
                realm? Is there an opportunity here to solve these problems? Are
                these normal problems in tech/other industries?
              </p>
            </div>
          </section>
        </section>
        <section id="38606488">
          <h3>
            <a
              class="item"
              href="https://blog.withedge.com/p/the-secret-behind-qualcomms-margins"
              >The Secret Behind Qualcomm's Margins? Patents</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 22:43:12</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38606488"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38606146">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2312.00638"
              >What if an SQL statement returned a database?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 22:05:52</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38606146"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38605765">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/newsroom/2023/12/apple-introduces-spatial-video-capture-on-iphone-15-pro/"
              >Apple introduces spatial video capture on iPhone 15 Pro</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 21:30:11</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38605765"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38605643">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/12/11/us/portland-oregon-drug-laws.html"
              >To revive Portland, officials seek to ban public drug use</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 21:21:17</span
              ><span class="points-container"
                >Points: <span class="points">214</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38605643"
                  >Comments</a
                ><span class="descendants">: 592</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38605525">
          <h3>
            <a
              class="item"
              href="https://www.zwillgen.com/law-enforcement/fisa-reform-bill-702-surveillance/"
              >FISA "reform" bill would greatly expand the entities forced to
              surveil users</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 21:10:03</span
              ><span class="points-container"
                >Points: <span class="points">250</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38605525"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38605453">
          <h3>
            <a class="item" href="https://www.bishopbook.com/"
              >Deep Learning – Foundations and Concepts (Chris Bishop)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 21:01:05</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38605453"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38603853">
          <h3>
            <a class="item" href="https://github.com/bricks-cloud/BricksLLM"
              >Show HN: I built an OSS alternative to Azure OpenAI services</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 18:56:23</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38603853"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
            <div class="text">
              <p>
                Azure OpenAI services was born out of companies needing enhanced
                security and access control for using different GPT models. I
                want to build an OSS version of Azure OpenAI services that
                people could self host in their own infrastructure.
              </p>
              <p>"How can I track LLM spend per API key?"</p>
              <p>
                "Can I create a development OpenAI API key with limited access
                for Bob?"
              </p>
              <p>"Can I see my LLM spend breakdown by models and endpoints?"</p>
              <p>
                "Can I create 100 OpenAI API keys that my students could use in
                a classroom setting?"
              </p>
              <p>These are questions that BricksLLM helps you answer.</p>
              <p>
                BricksLLM is an API gateway that let you create API keys with
                rate limit, cost control and ttl that could be used to access
                all OpenAI and Anthropic endpoints with out of box analytics.
              </p>
              <p>
                When I first started building with OpenAI APIs, I was constantly
                worried about API keys being comprised since vanilla OpenAI API
                keys would grant you unlimited access to all of their models.
                There are stories of people losing thousands of dollars and the
                existence of a black market for stolen OpenAI API keys.
              </p>
              <p>
                This is why I started building a proxy for ourselves that allows
                for the creation of API keys with rate limits and cost controls.
                I built BricksLLM in Go since that was the language I used to
                build performative ads exchanges that scaled to thousands of
                requests per second at my previous job. A lot of developer tools
                in LLM ops are built with Python which I believe might be
                suboptimal in terms of performance and compute resource
                efficiency.
              </p>
              <p>
                One of the challenges building this platform is to get accurate
                token counts for different OpenAI and Anthropic models. LLM
                providers are not exactly transparent with the way how they
                count prompt and completion tokens. In addition to user input,
                OpenAI and Anthropic pad prompt inputs with additional
                instructions or phrases that contribute to the final token
                counts. For example, Anthropic's actual completion token
                consumption is consistently 4 more than the token count of the
                completion output.
              </p>
              <p>
                The latency of the gateway hovers around 50ms. Half of the
                latency comes from the tokenizer. If I start utilizing Go
                routines, might be able to lower the latency of the gateway to
                30ms.
              </p>
              <p>
                BricksLLM is not an observability platform, but we do provide
                integration with Datadog so you can get more insights regarding
                what is going on inside the proxy. Compared to other tools in
                the LLMOps space, I believe that BricksLLM has the most
                comprehensive features when it comes to access control.
              </p>
              <p>Let me know what you guys think.</p>
            </div>
          </section>
        </section>
        <section id="38603440">
          <h3>
            <a
              class="item"
              href="https://upgradedpoints.com/news/tsa-self-service-screening/"
              >TSA introducing self-service screening technology in Las Vegas</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 18:29:28</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38603440"
                  >Comments</a
                ><span class="descendants">: 152</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38603353">
          <h3>
            <a class="item" href="http://pascal.hansotten.com/"
              >Pascal for Small Machines</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 18:24:09</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38603353"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38602750">
          <h3>
            <a
              class="item"
              href="https://00f.net/2023/12/11/webassembly-compilation-to-c/"
              >The best WebAssembly runtime may be no runtime</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 17:44:26</span
              ><span class="points-container"
                >Points: <span class="points">175</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38602750"
                  >Comments</a
                ><span class="descendants">: 112</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38602575">
          <h3>
            <a class="item" href="https://blog.beeper.com/p/beeper-mini-is-back"
              >Beeper Mini is back</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 17:30:14</span
              ><span class="points-container"
                >Points: <span class="points">930</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38602575"
                  >Comments</a
                ><span class="descendants">: 1135</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38602281">
          <h3>
            <a class="item" href="https://patterns.app/"
              >Patterns (YC S21) is hiring to automate analytics with LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 17:00:41</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38601435">
          <h3>
            <a
              class="item"
              href="https://cdacamar.github.io/data%20structures/algorithms/benchmarking/text%20editors/c++/rethinking-undo/"
              >Text Editor Data Structures: Rethinking Undo</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 15:27:42</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38601435"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38600551">
          <h3>
            <a
              class="item"
              href="https://www.scientificamerican.com/article/ultrasound-enables-remote-3-d-printing-even-in-the-human-body/"
              >Ultrasound Enables Remote 3-D Printing – Even in the Human
              Body</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 13:42:39</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38600551"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38600246">
          <h3>
            <a class="item" href="https://shepherd.com/bboy/2023"
              >Show HN: Crunching 1,200 Authors' Favorite Reads of 2023</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 12:58:42</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38600246"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
            <div class="text">
              <p>
                I launched Shepherd.com on a Show HN in April 2021 (<a
                  href="https://news.ycombinator.com/item?id=26871660"
                  >https://news.ycombinator.com/item?id=26871660</a
                >), and it has come a long way.
              </p>
              <p>
                My goal with Shepherd is to create an experience that feels like
                wandering your local bookstore, along with little notes from
                authors &amp; experts sharing why each book is one of their
                all-time favorites.
              </p>
              <p>
                For 2023, I surveyed 1,200+ authors to get their three favorite
                reads of the year. Then I crunched that data and broke it by
                genre, age range, and when it was published. Publisher data is a
                nightmare, so some of the genres are not perfect; I am working
                on improving that and some of the NLP/ML that drives this.
              </p>
              <p>
                Check out their top sci-fi reads:
                <a href="https://shepherd.com/bboy/2023/science-fiction"
                  >https://shepherd.com/bboy/2023/science-fiction</a
                >
              </p>
              <p>
                Or, their top nonfiction reads:
                <a href="https://shepherd.com/bboy/2023/nonfiction"
                  >https://shepherd.com/bboy/2023/nonfiction</a
                >
              </p>
              <p>You can also zoom in on each author’s favorite 3 reads.</p>
              <p>
                Louise Carey -
                <a href="https://shepherd.com/bboy/2023/f/louise-carey"
                  >https://shepherd.com/bboy/2023/f/louise-carey</a
                >
              </p>
              <p>
                Kevin Klehr -
                <a href="https://shepherd.com/bboy/2023/f/kevin-klehr"
                  >https://shepherd.com/bboy/2023/f/kevin-klehr</a
                >
              </p>
              <p>
                Alice C. Hill -
                <a href="https://shepherd.com/bboy/2023/f/alice-c-hill"
                  >https://shepherd.com/bboy/2023/f/alice-c-hill</a
                >
              </p>
              <p>
                Sara Ackerman -
                <a href="https://shepherd.com/bboy/2023/f/sara-ackerman"
                  >https://shepherd.com/bboy/2023/f/sara-ackerman</a
                >
              </p>
              <p>
                My email is ben@shepherd.com if you want to share ideas or
                suggestions for 2024.
              </p>
              <p>Thanks, Ben</p>
              <p>
                P.S. I have a newsletter for readers here where I share what I
                am building, new features, my fav book lists:
                <a href="https://forauthors.shepherd.com/newsletter-for-readers"
                  >https://forauthors.shepherd.com/newsletter-for-readers</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="38599252">
          <h3>
            <a class="item" href="https://github.com/berwynhoyt/wordstar-keys"
              >Wordstar-keys: Implement wordstar cursor control keys in Linux
              using xkb</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 10:23:52</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38599252"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38598940">
          <h3>
            <a class="item" href="https://github.com/TobyLobster/multiply_test"
              >Comparing 6502 Multiply Routines</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 09:19:20</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38598940"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38598171">
          <h3>
            <a
              class="item"
              href="https://www.hpl.hp.com/techreports/2007/HPL-2007-28R1.pdf"
              >Electing the Doge of Venice: analysis of a 13th Century protocol
              (2007) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 06:32:15</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38598171"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38597505">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/books/2023/11/22/gustave-flaubert-letters-review/"
              >Flaubert's letters are as hilarious and humane as his best
              fiction</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 03:57:46</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38597505"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38594891">
          <h3>
            <a
              class="item"
              href="https://www.thedrive.com/news/sliding-doors-that-time-gm-fumbled-its-chance-to-launch-the-first-minivan"
              >Sliding Doors: The Time GM Fumbled Its Chance to Launch the First
              Minivan</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-10 @ 20:47:01</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38594891"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38592432">
          <h3>
            <a
              class="item"
              href="https://literaryreview.co.uk/he-steals-them-of-course"
              >He steals them, of course</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-10 @ 16:02:04</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38592432"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38591084">
          <h3>
            <a class="item" href="https://ciechanow.ski/mechanical-watch/"
              >Mechanical Watch (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-10 @ 12:28:49</span
              ><span class="points-container"
                >Points: <span class="points">823</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38591084"
                  >Comments</a
                ><span class="descendants">: 136</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38579913">
          <h3>
            <a
              class="item"
              href="https://marc.info/?l=openbsd-tech&amp;m=170205367232026&amp;w=2"
              >OpenBSD – pinning all system calls</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-09 @ 08:34:29</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38579913"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
