<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41861442">
          <h3>
            <a
              class="item"
              href="https://spidermonkey.dev/blog/2024/10/16/75x-faster-optimizing-the-ion-compiler-backend.html"
              >Optimizing the Ion compiler back end</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 17:15:24</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41861442"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41861301">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/artie/jobs/7nZZhlU-founding-bdr"
              >Artie (YC S23) Is Hiring Founding BDRs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 17:00:03</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41861056">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2024/10/winamp-really-whips-open-source-coders-into-frenzy-with-its-source-release/"
              >Winamp deletes entire GitHub source code repo after a rocky few
              weeks</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 16:34:15</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41861056"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41860909">
          <h3>
            <a
              class="item"
              href="https://docs.sweeting.me/s/archivebox-plugin-ecosystem-announcement"
              >ArchiveBox is evolving: the future of self-hosted internet
              archives</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 16:18:39</span
              ><span class="points-container"
                >Points: <span class="points">160</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41860909"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
            <div class="text">
              We've been pushing really hard over the last 6mo to develop this
              release. I'd love to hear feedback from people who've worked on
              big plugin systems in the past, or anyone who's tried our betas!
            </div>
          </section>
        </section>
        <section id="41860135">
          <h3>
            <a
              class="item"
              href="https://buttondown.com/hillelwayne/archive/be-suspicious-of-success/"
              >It's not enough for a program to work â€“ it has to work for the
              right reasons</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 15:20:08</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41860135"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41859805">
          <h3>
            <a class="item" href="https://nvlabs.github.io/Sana/"
              >Efficient high-resolution image synthesis with linear diffusion
              transformer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 14:56:22</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41859805"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41859466">
          <h3>
            <a class="item" href="https://mistral.ai/news/ministraux/"
              >Un Ministral, Des Ministraux</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 14:31:18</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41859466"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41859012">
          <h3>
            <a
              class="item"
              href="https://azadux.blog/2024/10/08/traveling-with-apple-vision-pro/"
              >Traveling with Apple Vision Pro</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 13:48:51</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41859012"
                  >Comments</a
                ><span class="descendants">: 211</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41858975">
          <h3>
            <a class="item" href="https://gist.github.com/jackrusher/5139396"
              >Hofstadter on Lisp (1983)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 13:44:37</span
              ><span class="points-container"
                >Points: <span class="points">184</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41858975"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41858665">
          <h3>
            <a
              class="item"
              href="https://www.ftc.gov/news-events/news/press-releases/2024/10/federal-trade-commission-announces-final-click-cancel-rule-making-it-easier-consumers-end-recurring"
              >FTC announces "click-to-cancel" rule making it easier to cancel
              subscriptions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 13:09:04</span
              ><span class="points-container"
                >Points: <span class="points">775</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41858665"
                  >Comments</a
                ><span class="descendants">: 369</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41858331">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-024-03287-4"
              >The early days of peer review: five insights from historic
              reports</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 12:32:09</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41858331"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41857450">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41857450"
              >Show HN: LinkedIn Hype Crew</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 10:21:16</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41857450"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
            <div class="text">
              <p>
                It takes your PDF LinkedIn profile or resume and generates a
                short podcast either hyping you up, or roasting you.
              </p>
              <p>
                It takes your professional experience and crafts a narrative of
                your life and why youâ€™re so successful. Or if you want a roastâ€¦
                It pokes holes and makes fun of you.
              </p>
              <p>Iâ€™d love to hear any feedback!</p>
              <p><a href="https://podial.ai/hype">https://podial.ai/hype</a></p>
            </div>
          </section>
        </section>
        <section id="41857032">
          <h3>
            <a
              class="item"
              href="https://floss.fund/blog/announcing-floss-fund/"
              >FLOSS/fund for free and open source projects</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 09:02:25</span
              ><span class="points-container"
                >Points: <span class="points">340</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41857032"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41856883">
          <h3>
            <a
              class="item"
              href="https://mullvad.net/en/blog/macos-sometimes-leaks-traffic-after-system-updates"
              >MacOS sometimes leaks traffic after system updates</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 08:37:23</span
              ><span class="points-container"
                >Points: <span class="points">348</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41856883"
                  >Comments</a
                ><span class="descendants">: 175</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41855006">
          <h3>
            <a
              class="item"
              href="https://nabeelqu.substack.com/p/reflections-on-palantir"
              >Reflections on Palantir</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 02:18:29</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41855006"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41854801">
          <h3>
            <a
              class="item"
              href="https://www.sievedata.com/functions/sieve/eye-contact-correction"
              >Eye Contact Correction: Redirecting the eyes to look at the
              camera</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 01:37:12</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41854801"
                  >Comments</a
                ><span class="descendants">: 152</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41854405">
          <h3>
            <a
              class="item"
              href="https://digipres.club/@foone/113313955144323780"
              >Redbox left PII on decommissioned machines</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 00:15:22</span
              ><span class="points-container"
                >Points: <span class="points">238</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41854405"
                  >Comments</a
                ><span class="descendants">: 123</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41853810">
          <h3>
            <a class="item" href="https://graphite.rs/"
              >Show HN: Graphite, a Blender-inspired 2D procedural design Rust
              app</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 22:32:06</span
              ><span class="points-container"
                >Points: <span class="points">695</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41853810"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
            <div class="text">
              <p>
                Q3 progress report:
                <a
                  href="https://graphite.rs/blog/graphite-progress-report-q3-2024/"
                  >https://graphite.rs/blog/graphite-progress-report-q3-2024/</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="41853780">
          <h3>
            <a
              class="item"
              href="https://bernsteinbear.com/blog/type-inference/"
              >Damas-Hindley-Milner inference two ways</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 22:27:17</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41853780"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41853637">
          <h3>
            <a
              class="item"
              href="https://thecraftsmanblog.com/why-dont-we-use-awnings-anymore/"
              >Why don't we use awnings anymore (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 22:11:35</span
              ><span class="points-container"
                >Points: <span class="points">322</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41853637"
                  >Comments</a
                ><span class="descendants">: 274</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41852821">
          <h3>
            <a class="item" href="https://capibarazero.github.io/docs/"
              >CapibaraZero: A cheap alternative to FlipperZero based on
              ESP32-S3</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 20:34:41</span
              ><span class="points-container"
                >Points: <span class="points">342</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41852821"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41850017">
          <h3>
            <a
              class="item"
              href="https://gustedt.wordpress.com/2024/10/15/the-c23-edition-of-modern-c/"
              >The C23 edition of ModernÂ C</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 16:06:29</span
              ><span class="points-container"
                >Points: <span class="points">485</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41850017"
                  >Comments</a
                ><span class="descendants">: 305</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41849058">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/newsroom/2024/10/apple-introduces-powerful-new-ipad-mini-built-for-apple-intelligence/"
              >Apple introduces iPadÂ mini built for AppleÂ Intelligence</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 14:35:29</span
              ><span class="points-container"
                >Points: <span class="points">306</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41849058"
                  >Comments</a
                ><span class="descendants">: 459</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41848804">
          <h3>
            <a
              class="item"
              href="https://digital-naturalism-laboratories.github.io/Mothbox/"
              >Mothbox 4.0</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 14:10:58</span
              ><span class="points-container"
                >Points: <span class="points">259</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41848804"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41848150">
          <h3>
            <a class="item" href="https://emoji.build/deal-with-it-generator/"
              >Show HN: I built the most over-engineered Deal With It emoji
              generator</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 13:05:05</span
              ><span class="points-container"
                >Points: <span class="points">768</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41848150"
                  >Comments</a
                ><span class="descendants">: 145</span></span
              >
            </h4>
            <div class="text">
              <p>
                - All operations done fully client-side - no backend, no private
                data leaves your browser. - Uses machine learning models
                (MediaPipe Face Detector task) to automatically scale and
                position glasses on the detected faces. - Extensive
                customization options for glasses: - Placement of glasses
                anywhere on the input image (including slightly going outside
                it). - Change the size of glasses. - No limit on the number of
                glasses. - Flip the glasses vertically or horizontally. -
                Customize the direction from which the glasses appear on the
                image. - Different types of glasses. - GIF output options: -
                Looping mode. - Number of frames. - Frame delay. - Separate
                delay setting for last frame. - Output size. - Celebration
                confetti - Easter eggs.
              </p>
              <p>
                I've been working remotely for the last &gt;9 years. When using
                non-verbal communication, it's important that your tone and
                intent comes across accurately.. Custom emojis became for me
                part of expressing yourself, creating bonds and camaraderie.
                I've originally created an MVP of this tool while applying for a
                exciting new job opportunity. As a showcase of my passion for
                programming, building teams and creating delightful user
                experiences. Unfortunately, they were not impressed and
                ultimately did not offer me the job :( But I wanted to polish it
                and release it for everyone to use for free, so that you can too
                "Deal With It"!
              </p>
              <p>
                I have more ideas for even more features (check GitHub[1]), but
                wanted to launch it and see what's the feedback and ideas from
                the community! And if you're looking for a Fullstack Developer
                with &gt;14 years of experience, with passion for great customer
                experience (remote work or locally in Iceland), let's chat!
              </p>
              <p>
                [1] -
                <a href="https://github.com/klimeryk/dealwithit"
                  >https://github.com/klimeryk/dealwithit</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="41848099">
          <h3>
            <a
              class="item"
              href="https://mused.com/guided/158/temple-26-and-excavation-tunnels-copan-ruinas/"
              >Show HN: I 3D scanned the tunnels inside the Maya Pyramid Temples
              at Copan</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 12:57:54</span
              ><span class="points-container"
                >Points: <span class="points">426</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41848099"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
            <div class="text">
              <p>
                Unlike Egyptian pyramids, the Maya built their temples layer by
                layer outward, so to understand them, researchers tunneled into
                the structures to understand the earlier phases of construction.
                I arranged the guided versions of the virtual tours in a rough
                chronology, moving from the highest to the lowest and oldest
                areas: the hieroglyphic stairway composing the largest Maya
                inscription anywhere, the Rosalila temple that was buried fully
                intact, and finally the tomb of the Founder of the city, Yax
                KÊ¼ukÊ¼ MoÊ¼.
              </p>
              <p>
                I've been working to build on top of the Matterport SDK with
                Three.js--and then reusing the data in Unreal for a desktop
                experience or rendering for film (coming soon to PBS).
              </p>
              <p>
                Blog about process:
                <a
                  href="https://blog.mused.com/what-lies-beneath-digitally-recording-over-4km-of-tunnels-inside-the-maya-temples-at-copan/"
                  >https://blog.mused.com/what-lies-beneath-digitally-recording...</a
                >
              </p>
              <p>
                Major thanks to the Matterport team for providing support with
                data alignment and merging tunnels while I was living in the
                village near site.
              </p>
            </div>
          </section>
        </section>
        <section id="41847754">
          <h3>
            <a class="item" href="https://vaaal88.itch.io/trapped">Trapped</a>
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 12:15:55</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41847754"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41847640">
          <h3>
            <a class="item" href="https://github.com/asterinas/asterinas"
              >Asterinas: OS kernel written in Rust and providing
              Linux-compatible ABI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 12:01:59</span
              ><span class="points-container"
                >Points: <span class="points">324</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41847640"
                  >Comments</a
                ><span class="descendants">: 175</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41846636">
          <h3>
            <a class="item" href="https://github.com/Snowiiii/Pumpkin"
              >Show HN: Pumpkin â€“ A Modern Minecraft server written in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 09:18:16</span
              ><span class="points-container"
                >Points: <span class="points">385</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41846636"
                  >Comments</a
                ><span class="descendants">: 143</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41839697">
          <h3>
            <a
              class="item"
              href="https://www.zdnet.com/home-and-office/networking/how-ham-radio-endures-and-remains-a-disaster-lifeline-in-the-iphone-era/"
              >How ham radio endures</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-14 @ 17:26:35</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41839697"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
