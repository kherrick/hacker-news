<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42287231">
          <h3>
            <a class="item" href="https://adventofcode.com/2024/about"
              >Advent of Code 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 09:09:35</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42287231"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42286771">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/signoz/jobs/Y8SWUCk-open-source-community-engineer-remote"
              >SigNoz (YC W21) Is Hiring Open Source Community Engineer (Remote)
              (IN/EU)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 07:01:24</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42286416">
          <h3>
            <a class="item" href="https://www.seangoedecke.com/confidence/"
              >I don't know how to build software and you don't either</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 05:27:08</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42286416"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42286397">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2411.01747"
              >DynaSaur: Large Language Agents Beyond Predefined Actions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 05:21:59</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42286397"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42286133">
          <h3>
            <a
              class="item"
              href="https://betterschooling.in/collection/education-and-healthcare-suck-here-s-how-we-can-change-that"
              >Education and Healthcare Suck for the Same Reasons</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 04:13:21</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42286133"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42285689">
          <h3>
            <a
              class="item"
              href="https://sfconservancy.org/news/2024/nov/29/openwrt-one-wireless-router-now-ships-black-friday/"
              >OpenWRT One Released: First Router Designed Specifically for
              OpenWrt</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 02:34:24</span
              ><span class="points-container"
                >Points: <span class="points">200</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42285689"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42285676">
          <h3>
            <a
              class="item"
              href="https://ilikeinterfaces.com/2015/03/09/map-ui-ghost-in-the-shell/"
              >Map UI – Ghost in the Shell</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 02:32:15</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42285676"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42284412">
          <h3>
            <a class="item" href="https://github.com/privastead/privastead"
              >Show HN: Open-source private home security camera system
              (end-to-end encryption)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-30 @ 22:13:49</span
              ><span class="points-container"
                >Points: <span class="points">217</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42284412"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
            <div class="text">
              <p>
                Based on some of the discussions I've seen online, it seems like
                there are other users who are also concerned with the privacy
                implications of home security cameras. Therefore, I decided to
                open source my solution for everyone to use. If you need a
                privacy-preserving home security camera, please give it a try
                and provide feedback. Note that trying out the system requires
                you to have a supported IP camera, a local machine connected to
                the IP camera, a server, and an Android smartphone. I have put
                together detailed instructions on setting up the system, which I
                hope makes it easier for others to get the system up and
                running.
              </p>
              <p>
                In addition, consider contributing to the project. The prototype
                currently has a lot of limitations: mainly that it has only been
                tested with one IP camera, only allows the use of one camera,
                and only supports Android. I'll continue to improve the
                prototype as time permits, but progress will be much faster if
                there are other contributors as well.
              </p>
            </div>
          </section>
        </section>
        <section id="42284202">
          <h3>
            <a
              class="item"
              href="https://follow.agwa.name/notice/AoZSMI38xcA3TrN1sm"
              >A Brazilian CA trusted only by Microsoft has issued a certificate
              for google.com</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-30 @ 21:35:03</span
              ><span class="points-container"
                >Points: <span class="points">403</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42284202"
                  >Comments</a
                ><span class="descendants">: 150</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42283950">
          <h3>
            <a class="item" href="https://github.com/maharmstone/ntfs2btrfs"
              >Ntfs2btrfs does in-place conversion of NTFS filesystem to the
              open-source Btrfs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-30 @ 20:50:08</span
              ><span class="points-container"
                >Points: <span class="points">295</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42283950"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42283933">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/p/amd-disables-zen-4s-loop-buffer"
              >AMD Disables Zen 4's Loop Buffer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-30 @ 20:47:35</span
              ><span class="points-container"
                >Points: <span class="points">209</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42283933"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42283678">
          <h3>
            <a
              class="item"
              href="https://journals.sagepub.com/doi/abs/10.1177/09567976211044685?journalCode=pssa"
              >Motivating Personal Growth by Seeking Discomfort (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-30 @ 20:04:03</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42283678"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42282112">
          <h3>
            <a
              class="item"
              href="https://leancrew.com/all-this/2024/11/square-roots-and-maxima/"
              >Square Roots and Maxima</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-30 @ 15:33:59</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42282112"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42280570">
          <h3>
            <a
              class="item"
              href="https://blog.lucasholten.com/rust-query-announcement/"
              >Safe relational database queries using the Rust type system</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-30 @ 09:29:39</span
              ><span class="points-container"
                >Points: <span class="points">217</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42280570"
                  >Comments</a
                ><span class="descendants">: 121</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42280119">
          <h3>
            <a class="item" href="https://linus.coffee/note/software-industry/"
              >Thoughts on the Software Industry (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-30 @ 07:16:44</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42280119"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42279454">
          <h3>
            <a class="item" href="https://minjunes.ai/posts/sleep/index.html"
              >Engineering Sleep</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-30 @ 04:33:32</span
              ><span class="points-container"
                >Points: <span class="points">390</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42279454"
                  >Comments</a
                ><span class="descendants">: 166</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42279172">
          <h3>
            <a
              class="item"
              href="https://infrequently.org/2024/11/if-not-react-then-what/"
              >If not React, then what?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-30 @ 03:35:00</span
              ><span class="points-container"
                >Points: <span class="points">316</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42279172"
                  >Comments</a
                ><span class="descendants">: 568</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42277850">
          <h3>
            <a
              class="item"
              href="https://www.theparisreview.org/blog/2017/02/15/rhythmical-lines/"
              >Geometric line-art of Wacław Szpakowski (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-29 @ 22:54:12</span
              ><span class="points-container"
                >Points: <span class="points">397</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42277850"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42276865">
          <h3>
            <a
              class="item"
              href="https://www.nullpt.rs/breaking-the-4chan-captcha"
              >Breaking the 4Chan CAPTCHA</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-29 @ 20:32:22</span
              ><span class="points-container"
                >Points: <span class="points">529</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42276865"
                  >Comments</a
                ><span class="descendants">: 321</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42276620">
          <h3>
            <a
              class="item"
              href="https://blog.koenvh.nl/what-does-this-button-do-cm42u2oi7000a09l42f54g2pr"
              >What does this button do? – My new car has a mysterious and
              undocumented switch</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-29 @ 19:59:47</span
              ><span class="points-container"
                >Points: <span class="points">642</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42276620"
                  >Comments</a
                ><span class="descendants">: 461</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42254769">
          <h3>
            <a
              class="item"
              href="https://stuff.tamius.net/sacred-texts/2024/09/18/how-to-print-your-guild-wars-2-character-or-any-game-really/"
              >How to print your Guild Wars 2 character</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-27 @ 10:19:40</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42254769"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42254575">
          <h3>
            <a
              class="item"
              href="https://github.com/francisrstokes/githublog/blob/main/2024/11/26/getting-an-ip-address.md"
              >I Got an IP Address</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-27 @ 09:45:16</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42254575"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42254146">
          <h3>
            <a
              class="item"
              href="https://meyerweb.com/eric/thoughts/2005/10/17/ie7-and-ie7/"
              >IE7 and IE7 (2005)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-27 @ 08:32:54</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42254146"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42254144">
          <h3>
            <a
              class="item"
              href="https://buttondown.com/hillelwayne/archive/the-opposite-of-documentation-is-superstition/"
              >The Opposite of Documentation is Superstition (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-27 @ 08:32:39</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42254144"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42244472">
          <h3>
            <a class="item" href="https://shader-slang.com"
              >The Slang Shading Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-26 @ 10:40:53</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42244472"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42243313">
          <h3>
            <a
              class="item"
              href="https://guix.gnu.org/en/blog/2024/hurd-on-thinkpad/"
              >Guix/Hurd on a ThinkPad X60</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-26 @ 07:25:26</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42243313"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42233836">
          <h3>
            <a
              class="item"
              href="https://notso.boringsql.com/posts/deletes-are-difficult/"
              >DELETEs Are Difficult</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-25 @ 06:46:15</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42233836"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42232952">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/future/article/20241029-the-caving-scientists-exploring-the-darkest-places-on-earth"
              >Caving scientists exploring the darkest places on Earth</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-25 @ 03:25:33</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42232952"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42228281">
          <h3>
            <a class="item" href="https://danieljones.au/posts/direct/130.html"
              >Exploring and having fun with rotary telephones</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-24 @ 15:12:30</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42228281"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42220596">
          <h3>
            <a class="item" href="https://github.com/hfiref0x/WinDepends"
              >WinDepends – A Rewrite of the Dependency Walker</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-23 @ 12:48:06</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42220596"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
