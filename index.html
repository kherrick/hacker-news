<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37577861">
          <h3>
            <a class="item" href="https://brisray.com/web/webring-tech.htm"
              >Webring Technology</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 22:28:19</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37577861"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37576633">
          <h3>
            <a class="item" href="https://web.mit.edu/jemorris/humor/500-miles"
              >Can’t send email more than 500 miles (2002)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 21:05:20</span
              ><span class="points-container"
                >Points: <span class="points">184</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37576633"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37576580">
          <h3>
            <a class="item" href="https://www.workatastartup.com/jobs/61922/"
              >Emerge (YC W21) is hiring a lead front end engineer (remote,
              small team)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 21:02:11</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37575377">
          <h3>
            <a
              class="item"
              href="https://nibblestew.blogspot.com/2023/09/circles-do-not-exist.html"
              >Circles do not exist</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 19:44:52</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37575377"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37575365">
          <h3>
            <a
              class="item"
              href="https://pinot.apache.org/blog/2023/09/19/Annoucing-Apache-Pinot-1-0/"
              >Apache Pinot 1.0</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 19:44:11</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37575365"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37575256">
          <h3>
            <a class="item" href="https://arabic-numbers.koljapluemer.com/"
              >Show HN: I'm building a tool to practice numbers in Arabic</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 19:38:13</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37575256"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
            <div class="text">
              <p>
                Possibly very niche, but maybe it is useful for someone else out
                there. Feedback is always welcome.
              </p>
            </div>
          </section>
        </section>
        <section id="37575227">
          <h3>
            <a class="item" href="https://github.com/phillbush/jvm"
              >Simple Open-Source Java Virtual Machine in C</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 19:36:22</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37575227"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37575204">
          <h3>
            <a class="item" href="https://go.dev/blog/loopvar-preview"
              >Fixing for loops in Go 1.22</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 19:34:09</span
              ><span class="points-container"
                >Points: <span class="points">285</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37575204"
                  >Comments</a
                ><span class="descendants">: 208</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37574644">
          <h3>
            <a
              class="item"
              href="https://www.mimicry.ai/faster-sorting-beyond-deepminds-alphadev"
              >Faster Sorting Beyond DeepMind’s AlphaDev</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 18:59:50</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37574644"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37574552">
          <h3>
            <a
              class="item"
              href="https://eranstiller.com/rabbitmq-vs-kafka-an-architects-dilemma-part-1"
              >RabbitMQ vs. Kafka – An Architect’s Dilemma (Part 1)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 18:54:43</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37574552"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37574192">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-023-02874-1"
              >X-ray laser will ‘film’ chemical reactions in unprecedented
              detail</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 18:35:14</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37574192"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37573948">
          <h3>
            <a class="item" href="https://agentscript.org/"
              >Agentscript: Agent Based Modeling in the Browser</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 18:16:59</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37573948"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37573045">
          <h3>
            <a
              class="item"
              href="https://trofi.github.io/posts/248-how-do-shared-library-collisions-break.html"
              >How do shared library collisions break? (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 17:12:36</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37573045"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37572394">
          <h3>
            <a
              class="item"
              href="https://web.archive.org/web/20230718112821/https://www.nature.com/articles/d41586-023-02299-w"
              >How many medical studies are faked or flawed?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 16:31:31</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37572394"
                  >Comments</a
                ><span class="descendants">: 152</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37571974">
          <h3>
            <a
              class="item"
              href="https://www.hydra.so/blog-posts/hydra-1-generally-available"
              >Show HN: Hydra - Open-Source Columnar Postgres</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 16:05:07</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37571974"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
            <div class="text">
              <p>
                hydra is an open-source extension that adds columnar tables to
                Postgres for efficient analytical reporting. With Hydra, you can
                analyze billions of rows instantly without changing code.
              </p>
              <p>
                demo video (5 min):
                <a href="https://youtu.be/1yzxgb0Oyrw"
                  >https://youtu.be/1yzxgb0Oyrw</a
                >
                github repo:
                <a href="https://github.com/hydradatabase/hydra"
                  >https://github.com/hydradatabase/hydra</a
                >
              </p>
              <p>
                For 1.0 GA release, aggregate queries are over *60% faster* than
                Hydra beta due to aggregate vectorization. Spatial indexes (gin,
                gist, spgist, and rum indexes) and pg_hint_plan are now enabled
                for performance optimization.
              </p>
              <p>
                postgres is great, but aggregates can take minutes to hours to
                return results on large data sets. long-running analytical
                queries hog database resources and degrade performance. use
                hydra to run much faster analytics on postgres without changing
                code.
              </p>
              <p>
                for testing, try the hydra free tier to create a column postgres
                instance on the cloud.
                <a href="https://dashboard.hydra.so/signup"
                  >https://dashboard.hydra.so/signup</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="37571919">
          <h3>
            <a class="item" href="https://signal.org/blog/pqxdh/"
              >Quantum Resistance and the Signal Protocol</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 16:02:11</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37571919"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37571535">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2309.04332"
              >Graph Neural Networks use graphs when they shouldn't</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 15:40:38</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37571535"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37571328">
          <h3>
            <a class="item" href="https://opsahl.github.io/yash/"
              >Yash: Yet another short hand</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 15:28:06</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37571328"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37570947">
          <h3>
            <a
              class="item"
              href="https://fitzgeraldnick.com/2019/11/01/always-bump-downwards.html"
              >Always Bump Downwards (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 15:04:49</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37570947"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37570743">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/new-physics-inspired-generative-ai-exceeds-expectations-20230919/"
              >The physical process that powers a new type of generative AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 14:50:23</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37570743"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37570719">
          <h3>
            <a
              class="item"
              href="https://medium.com/graalvm/graalvm-for-jdk-21-is-here-ee01177dd12d"
              >GraalVM for JDK 21</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 14:48:03</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37570719"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37570407">
          <h3>
            <a
              class="item"
              href="https://twitter.com/matthew_d_green/status/1703959863796158678"
              >Snowden leak: Cavium networking hardware may contain NSA
              backdoor</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 14:24:27</span
              ><span class="points-container"
                >Points: <span class="points">831</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37570407"
                  >Comments</a
                ><span class="descendants">: 442</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37569622">
          <h3>
            <a
              class="item"
              href="https://resobscura.substack.com/p/historical-maps-probably-helped-cause"
              >Historical maps probably helped cause World War I</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 13:24:02</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37569622"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37568950">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/09/19/arts/russell-brand-youtube.html"
              >YouTube blocks Russell Brand from making money through its
              platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 12:25:00</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37568950"
                  >Comments</a
                ><span class="descendants">: 464</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37568746">
          <h3>
            <a class="item" href="https://www.chequpi.com/"
              >Show HN: Cheq UPI – India's first UPI payments app for
              foreigners</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 12:02:32</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37568746"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
            <div class="text">
              <p>
                My name is Sudhanshu and I'm the Co-founder/CEO of Cheq UPI (<a
                  href="https://www.chequpi.com"
                  >https://www.chequpi.com</a
                >). We are the first UPI wallet for foreigners and non-resident
                Indians travelling to India. Using Cheq, you can purchase almost
                any goods/services across India .
              </p>
              <p>
                Just scan the merchant QR code / choose the pay by UPI id option
                to make the purchase. You don’t need an Indian bank account to
                operate Cheq UPI. Our prepaid wallet can be topped up with any
                international debit/credit card.
              </p>
              <p>
                10mn+ foreigners visiting India each year, invariably face one
                of the below problems
              </p>
              <p>
                1) Indian merchant not accepting international credit/debit
                cards
              </p>
              <p>
                2) Unavailability of ATMs/money changers at remote locations
              </p>
              <p>3) Indian merchants not tendering exact loose change</p>
              <p>
                The Cheq UPI app was launched to help all these individuals
                travel cashfree across the country.
              </p>
              <p>
                If know someone planning to visit India this year, please ask
                them to try us out!
              </p>
              <p>
                A lot of time, hard work and luck has gone into building Cheq
                and we hope it’ll make travelling to India more convenient for
                citizens across the globe.
              </p>
              <p>Some quick pointers to know about the Cheq UPI app:</p>
              <p>
                - The Cheq UPI app works ONLY in India and we must verify your
                passport in-person before activating the UPI wallet.
              </p>
              <p>
                - Once activated, you’ll be able to scan &amp; pay with UPI
                anywhere across India.
              </p>
              <p>
                - Funds can be added to the Cheq wallet using any international
                debit/credit card, you don’t need an Indian bank account /
                aadhaar card.
              </p>
              <p>
                - Apart from the 10$ account opening fees, there are no other
                costs for using the product. Funds added can be spent anywhere
                across India.
              </p>
              <p>
                I’ll be available to answer any questions you may have
                throughout the day about Cheq, UPI or Indian fintech in general.
              </p>
              <p>Look forward to seeing you all try Cheq UPI</p>
              <p>
                PS: We're continuously improving our services, so critical and
                constructive feedback is most welcome.
              </p>
            </div>
          </section>
        </section>
        <section id="37568554">
          <h3>
            <a class="item" href="https://simulavr.com/blog/headsets-delayed/"
              >Headsets Delayed into 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 11:41:47</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37568554"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37568350">
          <h3>
            <a
              class="item"
              href="https://www.stewartcalculus.com/data/default/upfiles/LiesCalcAndCompTold.pdf"
              >Lies my calculator and computer told me (1987) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 11:19:10</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37568350"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37568278">
          <h3>
            <a class="item" href="https://vcmi.eu"
              >VCMI: Open-Source Engine for Heroes of Might and Magic III</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 11:12:06</span
              ><span class="points-container"
                >Points: <span class="points">233</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37568278"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37562541">
          <h3>
            <a class="item" href="https://apps.aist.org/steelwheel/index.html"
              >AIST Steel Wheel</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-18 @ 21:47:55</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37562541"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37547851">
          <h3>
            <a
              class="item"
              href="https://www.nathanmanousos.com/posts/chonky-menu"
              >Chonky Menu Re-Creation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-17 @ 18:16:04</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37547851"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
