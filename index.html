<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40454933">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40454933"
              >Ask HN: Devs/data scis who pivoted to a new career in 30s/40s,
              what do you do?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-23 @ 14:07:03</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40454933"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
            <div class="text">
              <p>
                For those who made a successful transition, what did you move
                to? What advice do you have in hindsight?
              </p>
            </div>
          </section>
        </section>
        <section id="40453619">
          <h3>
            <a
              class="item"
              href="https://jobs.ashbyhq.com/permitflow?departmentId=d33195eb-8978-4439-abc6-5a8a072de808"
              >PermitFlow (YC W22) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-23 @ 12:00:17</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40453384">
          <h3>
            <a
              class="item"
              href="https://github.com/sqlite/sqlite/commit/fd288f3549a1ab9a309a9e120d46319d42adea29"
              >Change the default temp file prefix to be "SQLite" spelled
              backwards</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-23 @ 11:32:30</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40453384"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40453221">
          <h3>
            <a
              class="item"
              href="https://www.sligocki.com//2024/05/22/bb-3-4-a14.html"
              >BB(3, 4) &amp;gt; Ack(14)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-23 @ 11:13:28</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40453221"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40452731">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/how-failure-has-made-mathematics-stronger-20240522/"
              >How Failure Has Made Mathematics Stronger</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-23 @ 10:03:27</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40452731"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40452655">
          <h3>
            <a
              class="item"
              href="http://tomwaitslibrary.info/biography/copyright/frito-lay/"
              >Tom Waits vs. Frito-Lay, Inc</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-23 @ 09:52:18</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40452655"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40451525">
          <h3>
            <a
              class="item"
              href="https://bitfehler.srht.site/posts/2024-04-15_m2dir-treating-mails-as-files-without-going-crazy.html"
              >M2dir: Treating mails as files without going crazy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-23 @ 07:17:22</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40451525"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40450128">
          <h3>
            <a class="item" href="https://magicui.design/"
              >Magic UI: UI Library for Design Engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-23 @ 03:23:54</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40450128"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40449767">
          <h3>
            <a class="item" href="https://windirstat.net/"
              >WinDirStat – Windows Directory Statistics</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-23 @ 02:34:14</span
              ><span class="points-container"
                >Points: <span class="points">235</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40449767"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40449278">
          <h3>
            <a class="item" href="https://fpvsim.com/drone-flying-101"
              >Drone Flying 101 – An Interactive Tutorial for Beginners</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-23 @ 01:25:35</span
              ><span class="points-container"
                >Points: <span class="points">166</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40449278"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40448045">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/technology/2024/05/22/openai-scarlett-johansson-chatgpt-ai-voice/"
              >OpenAI didn’t copy Scarlett Johansson’s voice for ChatGPT,
              records show</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 23:16:52</span
              ><span class="points-container"
                >Points: <span class="points">405</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40448045"
                  >Comments</a
                ><span class="descendants">: 691</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40447998">
          <h3>
            <a class="item" href="https://github.com/misohena/el-easydraw"
              >Emacs Easydraw – drawing tool inside Emacs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 23:13:50</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40447998"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40447431">
          <h3>
            <a
              class="item"
              href="https://www.vox.com/future-perfect/351132/openai-vested-equity-nda-sam-altman-documents-employees"
              >Leaked OpenAI documents reveal aggressive tactics toward former
              employees</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 22:22:30</span
              ><span class="points-container"
                >Points: <span class="points">1661</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40447431"
                  >Comments</a
                ><span class="descendants">: 491</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40446433">
          <h3>
            <a class="item" href="https://github.com/leukipp/cortile"
              >Cortile – Linux auto tiling manager with hot corner support</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 20:56:20</span
              ><span class="points-container"
                >Points: <span class="points">157</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40446433"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40444121">
          <h3>
            <a class="item" href="https://tryclojure.org/">Try Clojure</a>
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 18:11:34</span
              ><span class="points-container"
                >Points: <span class="points">509</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40444121"
                  >Comments</a
                ><span class="descendants">: 336</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40443927">
          <h3>
            <a class="item" href="https://github.com/nucleuscloud/neosync"
              >Show HN: Neosync – Open-Source Data Anonymization for Postgres
              and MySQL</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 17:53:45</span
              ><span class="points-container"
                >Points: <span class="points">227</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40443927"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.github.com/nucleuscloud/neosync"
                >https://www.github.com/nucleuscloud/neosync</a
              >). Neosync is an open source platform that helps developers
              anonymize production data, generate synthetic data and sync it
              across their environments for better testing, debugging and
              developer experience.
              <p>
                Most developers and teams have some version of a database seed
                script that creates some mock data for their local and stage
                databases. The problem is that production data is messy and it’s
                very difficult to replicate that with mock data. This causes two
                big problems for developers.
              </p>
              <p>
                The first problem is that features seem to work locally/stage
                but have bugs and edge cases in production because the seed data
                you used to develop against was not representative of production
                data.
              </p>
              <p>
                The second problem we saw was that debugging production errors
                would take a long time and would often resurface. When we see a
                bug in production, the first thing we want to do is reproduce it
                locally, but if we can’t reproduce the state of the data
                locally, then we’re kind of flying blind.
              </p>
              <p>
                Working directly with production data would solve both of these
                problems but most teams can’t because of: (1) privacy/security
                issues and (2) scale. So we set out to solve these two problems
                with Neosync.
              </p>
              <p>
                We solve the privacy and security problem using anonymization
                and synthetic data. We have 40+ pre-built transformers (or you
                can write your own in code) that can anonymize PII or sensitive
                data so that it’s safe to use locally. Additionally, you can
                generate synthetic data from scratch that fits your existing
                schema across your database.
              </p>
              <p>
                The second problem is scale. Some production databases are too
                big to fit locally or just have more data than you need. Also,
                in some cases, you may want to debug a certain customer’s data
                and you only want their data. We solve this with subsetting. You
                can pass in a SQL query to filter your table(s) and Neosync will
                handle all of the heavy lifting including referential integrity.
              </p>
              <p>
                At the core of Neosync does three things: (1) It streams data
                from a source to one or multiple destination databases. We never
                store your sensitive data. (2) While that data is being
                streamed, we transform it. You define which schemas and tables
                you want to sync and at the column level, select a transformer
                that defines how you want to anonymize the data or generate
                synthetic data. (3) We subset your data based on your filters.
              </p>
              <p>
                We do all of this while handling referential integrity. Whether
                you have primary keys, foreign keys, unique constraints,
                circular dependencies (within a table and across tables),
                sequences and more, Neosync preserves those references.
              </p>
              <p>
                We also ship with APIs, a Terraform provider, a CLI and Github
                action that you can use to hydrate a CI database.
              </p>
              <p>
                Neosync is an open source project written in Go and Typescript
                and can be run on Docker Compose, Bare Metal, or Kubernetes via
                Helm. You can also use our hosted platform or managed platform
                that you can deploy in your VPC. We also have a hosted platform
                with a generous free tier -
                <a href="https://neosync.dev">https://neosync.dev</a>
              </p>
              <p>
                Here's a brief loom demo:
                <a
                  href="https://www.loom.com/share/ac21378d01cd4d848cf723e4960e8338?sid=2faf613c-92be-44fa-9278-c8087e777356"
                  >https://www.loom.com/share/ac21378d01cd4d848cf723e4960e8338?...</a
                >
              </p>
              <p>We'd love any feedback you have!</p>
            </div>
          </section>
        </section>
        <section id="40442595">
          <h3>
            <a class="item" href="https://string.spiel.com/"
              >Pluckable Strings</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 16:05:06</span
              ><span class="points-container"
                >Points: <span class="points">636</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40442595"
                  >Comments</a
                ><span class="descendants">: 115</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40441945">
          <h3>
            <a class="item" href="https://unify.ai/chat?default=true"
              >Show HN: Route your prompts to the best LLM</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 15:07:20</span
              ><span class="points-container"
                >Points: <span class="points">263</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40441945"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
            <div class="text">
              <p>
                Here is a quick(ish) screen-recroding explaining how it works:
                <a href="https://youtu.be/ZpY6SIkBosE"
                  >https://youtu.be/ZpY6SIkBosE</a
                >
              </p>
              <p>
                Best results when training a custom router on your own prompt
                data:
                <a href="https://youtu.be/9JYqNbIEac0"
                  >https://youtu.be/9JYqNbIEac0</a
                >
              </p>
              <p>
                The router balances user preferences for quality, speed and
                cost. The end result is higher quality and faster LLM responses
                at lower cost.
              </p>
              <p>
                The quality for each candidate LLM is predicted ahead of time
                using a neural scoring function, which is a BERT-like
                architecture conditioned on the prompt and a latent
                representation of the LLM being scored. The different LLMs are
                queried across the batch dimension, with the neural scoring
                architecture taking a single latent representation of the LLM as
                input per forward pass. This makes the scoring function very
                modular to query for different LLM combinations. It is trained
                in a supervised manner on several open LLM datasets, using GPT4
                as a judge. The cost and speed data is taken from our live
                benchmarks, updated every few hours across all continents. The
                final "loss function" is a linear combination of quality, cost,
                inter-token-latency and time-to-first-token, with the user
                effectively scaling the weighting factors of this linear
                combination.
              </p>
              <p>
                Smaller LLMs are often good enough for simple prompts, but
                knowing exactly how and when they might break is difficult.
                Simple perturbations of the phrasing can cause smaller LLMs to
                fail catastrophically, making them hard to rely on. For example,
                Gemma-7B converts numbers to strings and returns the "largest"
                string when asking for the "largest" number in a set, but works
                fine when asking for the "highest" or "maximum".
              </p>
              <p>
                The router is able to learn these quirky distributions, and
                ensure that the smaller, cheaper and faster LLMs are only used
                when there is high confidence that they will get the answer
                correct.
              </p>
              <p>
                Pricing-wise, we charge the same rates as the backend providers
                we route to, without taking any margins. We also give $50 in
                free credits to all new signups.
              </p>
              <p>
                The router can be used off-the-shelf, or it can be trained
                directly on your own data for improved performance.
              </p>
              <p>What do people think? Could this be useful?</p>
              <p>Feedback of all kinds is welcome!</p>
            </div>
          </section>
        </section>
        <section id="40440841">
          <h3>
            <a
              class="item"
              href="https://thephd.dev/just-put-raii-in-c-bro-please-bro-just-one-more-destructor-bro-cmon-im-good-for-it"
              >Why not just do simple C++ RAII in C?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 13:38:51</span
              ><span class="points-container"
                >Points: <span class="points">152</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40440841"
                  >Comments</a
                ><span class="descendants">: 185</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40440086">
          <h3>
            <a
              class="item"
              href="https://engineering.mit.edu/engage/ask-an-engineer/whats-the-difference-between-a-motor-and-an-engine/"
              >What's the difference between a motor and an engine? (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 12:21:23</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40440086"
                  >Comments</a
                ><span class="descendants">: 115</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40439654">
          <h3>
            <a
              class="item"
              href="https://petapixel.com/2024/05/21/microsoft-paints-new-ai-image-generator-builds-on-your-brushstrokes/"
              >Microsoft Paint's new AI image generator builds on your
              brushstrokes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 11:23:20</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40439654"
                  >Comments</a
                ><span class="descendants">: 179</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40439641">
          <h3>
            <a
              class="item"
              href="https://blog.playcanvas.com/a-faster-supersplat-with-pwa-support/"
              >A Faster SuperSplat with PWA Support</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 11:21:16</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40439641"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40439515">
          <h3>
            <a class="item" href="https://gmunk.com/Windows-10-Desktop/"
              >Windows 10 wallpaper was physically built and photographed
              (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 10:59:46</span
              ><span class="points-container"
                >Points: <span class="points">619</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40439515"
                  >Comments</a
                ><span class="descendants">: 207</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40438510">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Number_16_(spider)"
              >Number 16 (spider)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 08:08:26</span
              ><span class="points-container"
                >Points: <span class="points">243</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40438510"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40437641">
          <h3>
            <a class="item" href="https://maggieappleton.com/generative-forgery"
              >Faking William Morris, Generative Forgery, and the Erosion of Art
              History</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 05:31:30</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40437641"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40437638">
          <h3>
            <a class="item" href="https://dl.acm.org/doi/10.1145/356580.356581"
              >Von Neumann's First Computer Program (1970)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-22 @ 05:31:19</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40437638"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40434743">
          <h3>
            <a
              class="item"
              href="https://ideonexus.com/2007/12/02/the-complex-william-jennings-bryan/"
              >The complex William Jennings Bryan (2007)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-21 @ 22:19:07</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40434743"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40426453">
          <h3>
            <a class="item" href="https://www.emacswiki.org/emacs/EmacsStories"
              >Emacs used as a message router in Germany's ATC systems in the
              1990s (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-21 @ 10:18:00</span
              ><span class="points-container"
                >Points: <span class="points">210</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40426453"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40425762">
          <h3>
            <a
              class="item"
              href="https://slothconservation.org/sloths-move-slow/"
              >Why Are Sloths So Slow?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-21 @ 08:55:56</span
              ><span class="points-container"
                >Points: <span class="points">170</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40425762"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40424650">
          <h3>
            <a
              class="item"
              href="https://stephaniewalter.design/blog/a-designers-guide-to-documenting-accessibility-user-interactions/"
              >A Designer's Guide to Documenting Accessibility and User
              Interactions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-21 @ 05:56:13</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40424650"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
