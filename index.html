<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40629570">
          <h3>
            <a
              class="item"
              href="https://sherwood.news/business/elon-musk-tesla-extra-inventory-satellite-imagery/"
              >Tesla's unsold inventory is creating stockpiles you can see from
              space</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 02:31:40</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40629570"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40629213">
          <h3>
            <a
              class="item"
              href="https://www.cambridge.org/core/journals/antiquity/article/monumental-snake-engravings-of-the-orinoco-river/147F83AA4381153C4D0F4EA4817B3766"
              >Monumental snake engravings of the Orinoco River</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 01:27:56</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40629213"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40629146">
          <h3>
            <a class="item" href="https://siteprofile.io/"
              >Show HN: I Build an AI-Powered API That Instantly Obtains Website
              Information</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 01:17:53</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40629146"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
            <div class="text">
              <p></p>
              <pre><code>  1.Real-time Webpage Screenshots
  Instantly capture real-time screenshots in both PC or Mobile views.

  2. AI-Generated Content:
  Generate content based on user prompts and website data, e.g. Describe the core functions of this website.

  3.Comprehensive Website Info:
  Social Media Links, Contact Info, Basic Details, and Assets, all in one place.
</code></pre>
              With just this API, you can instantly create an ai directory or
              similar website.
              <p>
                SiteProfile is currently in the testing phase. During this
                period, all subscriptions are discounted. There are still a few
                minor issues, and I’m working hard to fix them.
              </p>
              <p>
                If you try it out, please let me know if you found it useful, if
                you have anything you’d like me to add, or if you have any other
                feedback. And if you have any questions, I’d be happy to answer.
                Much appreciated.
              </p>
            </div>
          </section>
        </section>
        <section id="40628950">
          <h3>
            <a class="item" href="https://github.com/google/mesop"
              >Google Mesop: Build web apps in Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 00:51:03</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40628950"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40628573">
          <h3>
            <a
              class="item"
              href="https://www.techradar.com/pro/qualcomm-snapdragon-x-elite-prototype-that-runs-linux-emerges-from-a-brand-youve-probably-never-heard-of-schenker-tuxedo-has-12-core-cpu-with-32gb-ram-and-surprise-surprise-debian"
              >Qualcomm Snapdragon X Elite prototype that runs Linux emerges</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 23:46:29</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40628573"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40628395">
          <h3>
            <a
              class="item"
              href="https://www.madinamerica.com/2024/06/988-records-shared/"
              >"Confidential" 988 Conversation Records Shared with
              Corporations</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 23:12:20</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40628395"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40627946">
          <h3>
            <a
              class="item"
              href="https://daviddfriedman.substack.com/p/on-being-brought-up-by-libertarian"
              >On being brought up by libertarian economists</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 21:56:04</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40627946"
                  >Comments</a
                ><span class="descendants">: 121</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40627786">
          <h3>
            <a
              class="item"
              href="https://www.edge.org/conversation/freeman_dyson-heretical-thoughts-about-science-and-society"
              >Heretical thoughts about science and society (2005)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 21:30:45</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40627786"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40627558">
          <h3>
            <a
              class="item"
              href="https://asim.bearblog.dev/how-a-single-chatgpt-mistake-cost-us-10000/"
              >A ChatGPT mistake cost us $10k</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 20:56:29</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40627558"
                  >Comments</a
                ><span class="descendants">: 234</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40627522">
          <h3>
            <a
              class="item"
              href="https://twitter.com/revjaydub/status/1799212814646796648"
              >Woman set up a table to share her collection of washers. Nothing
              was for sale</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 20:51:26</span
              ><span class="points-container"
                >Points: <span class="points">208</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40627522"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40627208">
          <h3>
            <a class="item" href="http://www.ringbell.co.uk/ukwmo/Page211.htm"
              >British Nuclear Warning System</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 20:11:09</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40627208"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40627056">
          <h3>
            <a
              class="item"
              href="https://blog.sigplan.org/2024/06/03/a-dsl-for-implementing-math-functions/"
              >A DSL for Implementing Math Functions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 19:53:10</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40627056"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40626969">
          <h3>
            <a class="item" href="https://github.com/haampie/libtree"
              >Libtree: Ldd as a tree saying why a library is found or not</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 19:42:03</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40626969"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40626807">
          <h3>
            <a class="item" href="https://marian42.de/article/orrery/"
              >Designing a Lego orrery</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 19:23:08</span
              ><span class="points-container"
                >Points: <span class="points">257</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40626807"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40626332">
          <h3>
            <a
              class="item"
              href="https://www.bitsofwonder.co/p/a-revolution-in-biology"
              >A Revolution in Biology?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 18:13:34</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40626332"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40625959">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/technology/2024/06/09/home-health-tests-doctors-fda/"
              >A new world of DIY medical testing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 17:21:18</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40625959"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40625307">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2024/06/09/with-congestion-pricing-stop-nyc-enters-new-economic-gridlock-era.html"
              >With congestion pricing stop, New York City enters new era of
              economic gridlock</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 15:56:23</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40625307"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40624924">
          <h3>
            <a
              class="item"
              href="https://www.writingruxandrabio.com/p/the-weird-nerd-comes-with-trade-offs"
              >The Weird Nerd comes with trade-offs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 15:06:50</span
              ><span class="points-container"
                >Points: <span class="points">270</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40624924"
                  >Comments</a
                ><span class="descendants">: 309</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40624709">
          <h3>
            <a
              class="item"
              href="https://www.windytan.com/2024/06/ultrasonic-investigations-in-shopping.html"
              >Ultrasonic investigations in shopping centres</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 14:35:43</span
              ><span class="points-container"
                >Points: <span class="points">218</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40624709"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40623883">
          <h3>
            <a class="item" href="https://github.com/labmlai/inspectus"
              >Show HN: We've open-sourced our LLM attention visualization
              library</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 12:05:53</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40623883"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
            <div class="text">
              Inspectus allows you to create interactive visualizations of
              attention matrices with just a few lines of Python code. It’s
              designed to run smoothly in Jupyter notebooks through an
              easy-to-use Python API. Inspectus provides multiple views to help
              you understand language model behaviors. If you have any
              questions, feel free to ask!
            </div>
          </section>
        </section>
        <section id="40622799">
          <h3>
            <a
              class="item"
              href="https://diamondgeezer.blogspot.com/2024/06/londons-high-streets.html"
              >How many High Streets are there in London?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 08:10:23</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40622799"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40622724">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/articles/cyrrylklzjdo"
              >Orwell on the Isle of Jura</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 07:47:26</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40622724"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40620055">
          <h3>
            <a
              class="item"
              href="https://www.anthropic.com/research/claude-character"
              >Claude's Character</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-08 @ 20:40:12</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40620055"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40619664">
          <h3>
            <a
              class="item"
              href="https://abstractexpr.com/2024/06/08/finding-out-where-syscalls-are-called-from-stack-traces-with-strace/"
              >Finding out where syscalls are called from: Stack traces with
              strace</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-08 @ 19:23:32</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40619664"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40619521">
          <h3>
            <a
              class="item"
              href="https://codeopinion.com/beware-anti-patterns-in-event-driven-architecture/"
              >Anti-patterns in event-driven architecture</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-08 @ 18:56:29</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40619521"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40619297">
          <h3>
            <a
              class="item"
              href="https://theconversation.com/records-of-pompeiis-survivors-have-been-found-and-archaeologists-are-starting-to-understand-how-they-rebuilt-their-lives-230641"
              >Records of Pompeii's survivors have been found</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-08 @ 18:09:15</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40619297"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40618615">
          <h3>
            <a
              class="item"
              href="https://www.jeffreydonenfeld.com/blog/2012/12/the-south-pole-power-plant/"
              >The South Pole Power Plant (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-08 @ 16:23:37</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40618615"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40616930">
          <h3>
            <a class="item" href="https://github.com/below/HelloSilicon"
              >An Introduction to ARM64 Assembly on Apple Silicon Macs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-08 @ 11:42:50</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40616930"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40614308">
          <h3>
            <a
              class="item"
              href="https://lil.law.harvard.edu/blog/2024/02/12/warc-gpt-an-open-source-tool-for-exploring-web-archives-with-ai/"
              >WARC-GPT: An open-source tool for exploring web archives using
              AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-08 @ 00:32:06</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40614308"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40607845">
          <h3>
            <a
              class="item"
              href="https://fobes.dev/general/2024/02/29/inline-assembly-dangers.html"
              >(Debugging Story) Inline Assembly Dangers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-07 @ 12:05:54</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40607845"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
