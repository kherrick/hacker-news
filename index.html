<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="45554369">
          <h3>
            <a
              class="item"
              href="https://www.csis.org/analysis/chinas-new-rare-earth-and-magnet-restrictions-threaten-us-defense-supply-chains"
              >China's New Rare Earth and Magnet Restrictions Threaten US
              Defense Supply Chains</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-12 @ 01:37:37</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45554369"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45553995">
          <h3>
            <a class="item" href="https://github.com/acsandmann/rift"
              >Show HN: rift â€“ a tiling window manager for macOS</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-12 @ 00:22:15</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45553995"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45553835">
          <h3>
            <a class="item" href="https://lineageos.org/Changelog-30/"
              >LineageOS 23</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 23:53:17</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45553835"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45553783">
          <h3>
            <a
              class="item"
              href="https://scamcouver.wordpress.com/wp-content/uploads/2012/04/scam-capital.pdf"
              >Vancouver Stock Exchange: Scam capital of the world (1989)
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 23:43:42</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45553783"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45553764">
          <h3>
            <a
              class="item"
              href="https://www.androidauthority.com/pixel-ims-broken-october-update-3606444/"
              >Google blocks Android hack that let Pixel users enable VoLTE
              anywhere</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 23:41:00</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45553764"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45553701">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2510.05096"
              >Paper2Video: Automatic Video Generation from Scientific Papers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 23:32:25</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45553701"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45553577">
          <h3>
            <a
              class="item"
              href="https://paddedinputs.substack.com/p/meta-superintelligences-surprising"
              >Meta Superintelligence's surprising first paper</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 23:16:05</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45553577"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
            <div class="text">
              <a href="https://arxiv.org/abs/2509.01092"
                >https://arxiv.org/abs/2509.01092</a
              >
            </div>
          </section>
        </section>
        <section id="45553296">
          <h3>
            <a
              class="item"
              href="https://justismills.substack.com/p/heroin-addicts-often-seem-normal"
              >Heroin Addicts Often Seem Normal</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 22:43:58</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45553296"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45553132">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=45553132"
              >Ask HN: Abandoned/dead projects you think died before their time
              and why?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 22:16:18</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45553132"
                  >Comments</a
                ><span class="descendants">: 131</span></span
              >
            </h4>
            <div class="text">
              Just curious and who knows, maybe someone will adopt it or develop
              something new based on its ideas.
            </div>
          </section>
        </section>
        <section id="45552913">
          <h3>
            <a
              class="item"
              href="https://spillhistorie.no/2025/10/10/the-story-of-x-copy-on-the-amiga/"
              >The story of X-Copy on the Amiga</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 21:35:33</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45552913"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45552578">
          <h3>
            <a
              class="item"
              href="https://english.kyodonews.net/articles/-/62626"
              >Japan's summers have lengthened by 3 weeks over 42 years, say
              resaerchers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 20:51:03</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45552578"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45552049">
          <h3>
            <a
              class="item"
              href="https://psyonik.tech/posts/a-guide-for-wireguard-vpn-setup-with-pi-hole-adblock-and-unbound-dns/"
              >A Guide for WireGuard VPN Setup with Pi-Hole Adblock and Unbound
              DNS</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 19:41:27</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45552049"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45551995">
          <h3>
            <a
              class="item"
              href="https://dayvster.com/blog/is-odin-just-a-more-boring-c/"
              >Is Odin just a more boring C?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 19:33:27</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45551995"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45551504">
          <h3>
            <a
              class="item"
              href="https://hardware.slashdot.org/story/25/10/11/0238213/microsofts-onedrive-begins-testing-face-recognizing-ai-for-photos-for-some-preview-users"
              >Microsoft only lets you opt out of AI photo scanning 3x a year</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 18:36:51</span
              ><span class="points-container"
                >Points: <span class="points">494</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45551504"
                  >Comments</a
                ><span class="descendants">: 183</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45551450">
          <h3>
            <a
              class="item"
              href="https://neilmadden.blog/2025/09/12/rating-26-years-of-java-changes/"
              >Rating 26 years of Java changes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 18:29:27</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45551450"
                  >Comments</a
                ><span class="descendants">: 187</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45551260">
          <h3>
            <a
              class="item"
              href="https://github.com/anthropics/prompt-eng-interactive-tutorial"
              >Anthropic's Prompt Engineering Tutorial</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 18:06:40</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45551260"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45551081">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2025/10/people-regret-buying-amazon-smart-displays-after-being-bombarded-with-ads/"
              >People regret buying Amazon smart displays after being bombarded
              with ads</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 17:41:45</span
              ><span class="points-container"
                >Points: <span class="points">237</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45551081"
                  >Comments</a
                ><span class="descendants">: 120</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45550049">
          <h3>
            <a class="item" href="https://www.gnuhealth.org/about-us.html"
              >GNU Health</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 15:47:22</span
              ><span class="points-container"
                >Points: <span class="points">367</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45550049"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45549434">
          <h3>
            <a
              class="item"
              href="https://mitchellh.com/writing/non-trivial-vibing"
              >Vibing a non-trivial Ghostty feature</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 14:31:15</span
              ><span class="points-container"
                >Points: <span class="points">238</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45549434"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45547566">
          <h3>
            <a
              class="item"
              href="https://denodell.com/blog/html-best-kept-secret-output-tag"
              >The Tag</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 08:27:26</span
              ><span class="points-container"
                >Points: <span class="points">737</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45547566"
                  >Comments</a
                ><span class="descendants">: 166</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45547359">
          <h3>
            <a class="item" href="https://github.com/BalajeS/WSL-For-FreeBSD"
              >Windows Subsystem for FreeBSD</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 07:32:08</span
              ><span class="points-container"
                >Points: <span class="points">229</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45547359"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45547344">
          <h3>
            <a class="item" href="https://blog.fsck.com/2025/10/09/superpowers/"
              >Superpowers: How I'm using coding agents in October 2025</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 07:29:23</span
              ><span class="points-container"
                >Points: <span class="points">318</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45547344"
                  >Comments</a
                ><span class="descendants">: 168</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45518159">
          <h3>
            <a
              class="item"
              href="https://www.vcluster.com/blog/vcluster-standalone-multi-tenancy-kubernetes"
              >Show HN: Solving the cluster 1 problem with vCluster
              standalone</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-08 @ 16:50:12</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45518159"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              vcluster is an open source tool for Kubernetes multi tenancy and
              over the years it has matured to have hosted controlplane virtual
              cluster, shared virtual clusters but the host cluster problem was
              always there. With vcluster standalone, you can now create the
              first cluster also with the same developer experience and
              consolidate the multiple vendor problem. With this, you can now
              use vcluster for entire multi tenancy spectrum. Feel free to
              discuss, happy to answer any questuons.
            </div>
          </section>
        </section>
        <section id="45506748">
          <h3>
            <a class="item" href="https://jherrm.github.io/knobs/"
              >How Apple designs a virtual knob (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 18:19:37</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45506748"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45506055">
          <h3>
            <a
              class="item"
              href="https://tech.marksblogg.com/building-footprints-gba.html"
              >The World's 2.75B Buildings</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 17:26:20</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45506055"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45500142">
          <h3>
            <a class="item" href="https://www.exakat.io/weird-operators-in-php/"
              >Weird Operators in PHP</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 06:59:02</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45500142"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45498055">
          <h3>
            <a
              class="item"
              href="https://rarehistoricalphotos.com/twin-towers-construction-photographs/"
              >The World Trade Center under construction through photos,
              1966-1979</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 00:40:26</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45498055"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45495051">
          <h3>
            <a
              class="item"
              href="https://www.johndcook.com/blog/2025/10/06/a-quiet-change-to-rsa/"
              >A quiet change to RSA</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 19:07:22</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45495051"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45490980">
          <h3>
            <a
              class="item"
              href="https://www.texasmonthly.com/true-crime/skip-hollandsworth-new-book-she-kills/"
              >My First Murder</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 13:06:44</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45490980"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45489497">
          <h3>
            <a
              class="item"
              href="https://ounapuu.ee/posts/2025/10/06/datablocks-white-label-drives/"
              >Testing two 18 TB white label SATA hard drives from
              datablocks.dev</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 09:36:08</span
              ><span class="points-container"
                >Points: <span class="points">159</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45489497"
                  >Comments</a
                ><span class="descendants">: 96</span></span
              >
            </h4>
            <div class="text">
              <a
                href="https://web.archive.org/web/20251006052340/https://ounapuu.ee/posts/2025/10/06/datablocks-white-label-drives/"
                >https://web.archive.org/web/20251006052340/https://ounapuu.e...</a
              >
            </div>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
