<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43324827">
          <h3>
            <a
              class="item"
              href="https://slate.com/news-and-politics/2025/03/trump-elon-musk-doge-spacex-approval-tariffs.html"
              >America Is Under Siege by a Surprising Force: Losers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-10 @ 19:25:49</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43324827"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43323974">
          <h3>
            <a
              class="item"
              href="https://www.morningstar.com/economy/what-weve-learned-150-years-stock-market-crashes"
              >What We've Learned from 150 Years of Stock Market Crashes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-10 @ 18:29:00</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43323974"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43323946">
          <h3>
            <a
              class="item"
              href="https://github.com/MathFoundationRL/Book-Mathematical-Foundation-of-Reinforcement-Learning"
              >Mathematical Foundations of Reinforcement Learning</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-10 @ 18:27:32</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43323946"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43323923">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2025/03/firmware-update-bricks-hp-printers-makes-them-unable-to-use-hp-cartridges/"
              >Firmware update bricks HP printers, makes them unable to use HP
              cartridges</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-10 @ 18:26:27</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43323923"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43323860">
          <h3>
            <a
              class="item"
              href="https://tinlizzie.org/VPRIPapers/tr2012001_steps.pdf"
              >STEPS Toward the Reinvention of Programming [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-10 @ 18:22:57</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43323860"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43323738">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2025-02-bullies-children.html"
              >Study finds bullies have more children than non-bullies</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-10 @ 18:15:34</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43323738"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43323071">
          <h3>
            <a
              class="item"
              href="https://www.analog.com/media/en/training-seminars/design-handbooks/Software-Defined-Radio-for-Engineers-2018/SDR4Engineers.pdf"
              >Software-Defined Radio for Engineers (2018) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-10 @ 17:40:40</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43323071"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43322922">
          <h3>
            <a
              class="item"
              href="https://chromewebstore.google.com/detail/ublock-origin/cjpalhdlnbpafiamejdnhcphjbkeiagm?hl=en"
              >uBlock Origin is no longer available on the Chrome Store</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-10 @ 17:30:34</span
              ><span class="points-container"
                >Points: <span class="points">877</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43322922"
                  >Comments</a
                ><span class="descendants">: 428</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43322496">
          <h3>
            <a
              class="item"
              href="https://charlespetzold.com/etc/DoesVisualStudioRotTheMind.html"
              >Does Visual Studio rot the mind? (2005)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-10 @ 16:56:08</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43322496"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43322245">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/tech-policy/2025/03/music-labels-will-regret-coming-for-the-internet-archive-sound-historian-says/"
              >Music labels will regret coming for the Internet Archive, sound
              historian says</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-10 @ 16:28:44</span
              ><span class="points-container"
                >Points: <span class="points">186</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43322245"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43321688">
          <h3>
            <a class="item" href="https://playscl.com/make"
              >Show HN: Editable Games</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-10 @ 15:31:57</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43321688"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
            <div class="text">
              <p>
                I've been working on canvas language for 15 years now. Not very
                successful, but editable gifs turned out okay. Since it's my
                passion, I keep trying, and my latest is editable games - I'm
                not officially calling it that though.
              </p>
              <p>
                I've had some interest in advergames and this would allow
                designers to easily customize games for their clients - the
                hidden objects game being the best example for this, and the
                only one made specifically for the purpose.
              </p>
              <p>
                Anyways, games are interpreted at runtime by JavaScript. To
                publish, for example on itch or your own website, you need to
                submit your project file (download it from the dev studio) and
                wait a few minutes. You'll get back a JS file that contains your
                game.
              </p>
              <p>
                ngl, although a passion project, I'd like this to one day be
                profitable - trying to work that out.
              </p>
              <p>
                If interested, the main project site is
                <a href="https://canvaslanguage.com"
                  >https://canvaslanguage.com</a
                >
              </p>
              <p>
                I'd love to get some feedback. Although to be honest, I just
                want to show somebody my newest creation :)
              </p>
              <p>Thank you.</p>
            </div>
          </section>
        </section>
        <section id="43321523">
          <h3>
            <a class="item" href="https://blog.kuzudb.com/post/kuzu-wasm-rag/"
              >Show HN: In-Browser Graph RAG with Kuzu-WASM and WebLLM</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-10 @ 15:12:57</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43321523"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
            <div class="text">
              <p>
                We will soon also be releasing a vector index as part of Kuzu
                that you can also use in the browser to build traditional RAG or
                Graph RAG that retrieves from both vectors and graphs. The
                system has come a long way since we open sourced it about 2
                years ago, so please give us feedback about how it can be more
                useful!
              </p>
            </div>
          </section>
        </section>
        <section id="43321145">
          <h3>
            <a class="item" href="https://github.com/yt-dlp/yt-dlp/issues/12563"
              >YouTube DRM added on ALL videos with TV (TVHTML5) clients</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-10 @ 14:36:48</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43321145"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43321131">
          <h3>
            <a
              class="item"
              href="https://www.mcmordie.co.uk/acornhistory/index.shtml"
              >A technical history of Acorn Computers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-10 @ 14:35:05</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43321131"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43320230">
          <h3>
            <a
              class="item"
              href="https://exclusivearchitecture.com/03-technical-articles-CLT-12-autofocus-systems.html"
              >Canon EF and RF Lenses – All Autofocus Motors</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-10 @ 13:12:38</span
              ><span class="points-container"
                >Points: <span class="points">296</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43320230"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43320024">
          <h3>
            <a
              class="item"
              href="https://glasskube.dev/blog/kubernetes-zero-downtime-deployments-aws-eks/"
              >Zero-Downtime Kubernetes Deployments on AWS with EKS</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-10 @ 12:48:32</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43320024"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43319611">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/furtherai/jobs"
              >FurtherAI (YC W24) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-10 @ 12:00:58</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43318624">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2502.05244"
              >Probabilistic Artificial Intelligence</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-10 @ 09:50:33</span
              ><span class="points-container"
                >Points: <span class="points">235</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43318624"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43317887">
          <h3>
            <a class="item" href="https://blog.ecosia.org/trees-not-profits/"
              >Trees not profits: we're giving up our right to ever sell Ecosia
              (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-10 @ 07:42:11</span
              ><span class="points-container"
                >Points: <span class="points">230</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43317887"
                  >Comments</a
                ><span class="descendants">: 149</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43317592">
          <h3>
            <a
              class="item"
              href="https://blog.nelhage.com/post/cpython-tail-call/"
              >Performance of the Python 3.14 tail-call interpreter</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-10 @ 06:44:27</span
              ><span class="points-container"
                >Points: <span class="points">442</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43317592"
                  >Comments</a
                ><span class="descendants">: 130</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43315406">
          <h3>
            <a
              class="item"
              href="https://raoulpop.com/2012/04/15/chasing-rfi-waves-part-seven/"
              >Chasing RFI Waves – Part Seven</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-10 @ 00:16:54</span
              ><span class="points-container"
                >Points: <span class="points">276</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43315406"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43314657">
          <h3>
            <a
              class="item"
              href="https://randomaugustine.medium.com/on-apple-exclaves-d683a2c37194"
              >Apple Exclaves</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-09 @ 22:38:57</span
              ><span class="points-container"
                >Points: <span class="points">408</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43314657"
                  >Comments</a
                ><span class="descendants">: 155</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43311573">
          <h3>
            <a class="item" href="https://blog.ecosia.org/eusp/"
              >Ecosia is teaming up with Qwant to build a European search
              index</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-09 @ 17:40:38</span
              ><span class="points-container"
                >Points: <span class="points">463</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43311573"
                  >Comments</a
                ><span class="descendants">: 162</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43307833">
          <h3>
            <a
              class="item"
              href="https://siginthistorian.blogspot.com/2025/02/sigint-in-fiction.html"
              >Sigint in Fiction</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-09 @ 10:29:27</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43307833"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43300414">
          <h3>
            <a class="item" href="https://thomwolf.io/blog/scientific-ai.html"
              >The Einstein AI Model</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-08 @ 14:14:22</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43300414"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43290516">
          <h3>
            <a
              class="item"
              href="https://matduggan.com/help-me-help-you-maintainers/"
              >Help Me Help You, Maintainers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-07 @ 14:38:41</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43290516"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43290498">
          <h3>
            <a
              class="item"
              href="https://www.noemamag.com/how-to-build-a-thousand-year-old-tree/"
              >How to Build a Thousand-Year-Old Tree</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-07 @ 14:36:50</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43290498"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43289994">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/articles/cq6yg204pvmo"
              >Planes are having their GPS hacked. Could new clocks keep them
              safe?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-07 @ 13:31:46</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43289994"
                  >Comments</a
                ><span class="descendants">: 199</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43287327">
          <h3>
            <a
              class="item"
              href="https://www.abortretry.fail/p/so-powerful-its-kind-of-ridiculous"
              >3dfx: So powerful, it's kind of ridiculous (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-07 @ 04:07:18</span
              ><span class="points-container"
                >Points: <span class="points">181</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43287327"
                  >Comments</a
                ><span class="descendants">: 165</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43280517">
          <h3>
            <a
              class="item"
              href="https://leandromoreira.com/2019/08/02/linux-ffmpeg-source-internals-a-good-software-design/"
              >Exploring Polymorphism in C: Lessons from Linux and FFmpeg's Code
              Design (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-06 @ 14:23:24</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43280517"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
