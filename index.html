<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40506582">
          <h3>
            <a
              class="item"
              href="https://www.businessinsider.com/openai-board-member-details-sam-altman-lied-allegation-ousted-2024-5"
              >Ex-OpenAI board member reveals what led to Sam Altman's brief
              ousting</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 23:13:33</span
              ><span class="points-container"
                >Points: <span class="points">214</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40506582"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40506554">
          <h3>
            <a
              class="item"
              href="https://theaviationist.com/2024/05/28/f-35-crashes-near-albuquerque-new-mexico/"
              >F-35 Crashes Near Albuquerque Airport, New Mexico</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 23:09:07</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40506554"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40506340">
          <h3>
            <a
              class="item"
              href="https://mail.openjdk.org/pipermail/jdk-dev/2024-May/009028.html"
              >Proposal to change default annotation processing policy in JDK
              23</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 22:36:59</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40506340"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40506093">
          <h3>
            <a
              class="item"
              href="https://www.garelick.net/2024/05/28/marc-andreessen-wants-you-to-stay-in-school/"
              >Marc Andreessen wants you to stay in school</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 22:02:47</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40506093"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40505839">
          <h3>
            <a
              class="item"
              href="https://www.thejournal.ie/facebook-data-ai-6391876-May2024/"
              >Facebook will soon use your photos, posts and other info to train
              its AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 21:31:38</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40505839"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40505586">
          <h3>
            <a class="item" href="https://www.ece.rutgers.edu/~orfanidi/ewa/"
              >Electromagnetic Waves and Antennas (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 21:02:50</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40505586"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40505575">
          <h3>
            <a
              class="item"
              href="https://www.zaxis.page/p/productivity-versus-alignment"
              >Productivity Versus Alignment</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 21:01:37</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40505575"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40505213">
          <h3>
            <a
              class="item"
              href="https://tinlizzie.org/~ohshima/shadama2/live2017/"
              >Shadama: A particle simulation programming environment for
              everyone</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 20:25:20</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40505213"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40505197">
          <h3>
            <a class="item" href="https://brandur.org/two-phase-render"
              >Eradicating N+1s: The Two-Phase Data Load and Render Pattern in
              Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 20:23:40</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40505197"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40505099">
          <h3>
            <a
              class="item"
              href="https://aksh-garg.medium.com/llama-3v-building-an-open-source-gpt-4v-competitor-in-under-500-7dd8f1f6c9ee"
              >Llama 3-V: Matching GPT4-V with a 100x smaller model and 500
              dollars</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 20:16:19</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40505099"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40504756">
          <h3>
            <a class="item" href="https://jviide.iki.fi/http-redirects"
              >API Shouldn't Redirect HTTP to HTTPS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 19:42:34</span
              ><span class="points-container"
                >Points: <span class="points">316</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40504756"
                  >Comments</a
                ><span class="descendants">: 149</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40504586">
          <h3>
            <a
              class="item"
              href="https://www.influxdata.com/blog/using-parquets-bloom-filters/"
              >Using Parquet's Bloom Filters</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 19:28:21</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40504586"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40504481">
          <h3>
            <a
              class="item"
              href="https://github.com/brian-smith-github/ch32v003_stt"
              >Simple Speech-to-Text on the '10 Cents' CH32V003
              Microcontroller</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 19:20:38</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40504481"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40504420">
          <h3>
            <a class="item" href="https://complicated.world/en/Human_Life"
              >Happiness</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 19:16:10</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40504420"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40504212">
          <h3>
            <a
              class="item"
              href="https://github.com/tinygrad/tinygrad/releases/tag/v0.9.0"
              >Tinygrad 0.9.0</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 18:58:45</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40504212"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40503925">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/roboform-password-3-million-dollar-crypto-wallet/"
              >Researchers cracked an 11-year-old password to a $3M crypto
              wallet</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 18:32:06</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40503925"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40503648">
          <h3>
            <a
              class="item"
              href="https://apnews.com/article/japan-fukushima-nuclear-meltdown-debris-robot-238a5177ec3ac3c7608c3116fdf58a58"
              >A robot will soon try to remove melted nuclear fuel from
              Fukushima reactor</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 18:08:23</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40503648"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40503202">
          <h3>
            <a
              class="item"
              href="https://chrisbuilds.github.io/terminaltexteffects/showroom/"
              >TTE: Terminal Text Effects</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 17:31:48</span
              ><span class="points-container"
                >Points: <span class="points">870</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40503202"
                  >Comments</a
                ><span class="descendants">: 139</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40502956">
          <h3>
            <a class="item" href="https://github.com/openkoda/openkoda"
              >Show HN: Openkoda – Open–source, private, Salesforce
              alternative</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 17:11:56</span
              ><span class="points-container"
                >Points: <span class="points">211</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40502956"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40502877">
          <h3>
            <a
              class="item"
              href="https://www.flickr.com/photos/jurvetson/albums/72157623704246792/"
              >Steve Jurvetson's personal collection of Apollo Lunar Module
              parts</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 17:03:03</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40502877"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40502858">
          <h3>
            <a class="item" href="https://www.workatastartup.com/jobs/66397"
              >Linum (YC W23) is a hiring a founding AI engineer to train
              text-to-video models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 17:00:50</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40502090">
          <h3>
            <a
              class="item"
              href="https://github.com/karpathy/llm.c/discussions/481"
              >Reproducing GPT-2 in llm.c</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 15:58:46</span
              ><span class="points-container"
                >Points: <span class="points">360</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40502090"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40501561">
          <h3>
            <a
              class="item"
              href="https://blog.r-project.org/2024/05/17/generalizing-support-for-functional-oop-in-r/index.html"
              >Generalizing Support for Functional OOP in R</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 15:19:00</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40501561"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40501164">
          <h3>
            <a class="item" href="https://github.com/turbo9team/turbo9"
              >Turbo9 – A Compact and Efficient Pipelined 6809 Microprocessor
              IP</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 14:39:14</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40501164"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40501027">
          <h3>
            <a class="item" href="https://f-droid.org/2024/05/24/mobifree.html"
              >Mobifree – An open-source mobile ecosystem</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 14:24:24</span
              ><span class="points-container"
                >Points: <span class="points">225</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40501027"
                  >Comments</a
                ><span class="descendants">: 124</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40501021">
          <h3>
            <a class="item" href="https://grooved.okat.best/"
              >Show HN: I made a free app to calibrate your turntable by simply
              playing a song</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 14:23:28</span
              ><span class="points-container"
                >Points: <span class="points">276</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40501021"
                  >Comments</a
                ><span class="descendants">: 157</span></span
              >
            </h4>
            <div class="text">
              <p>
                I made a little app that lets you to calibrate your turntable by
                putting on any record and tapping a button. It's called Grooved
                and it uses your phone's microphone to see how fast your platter
                is going, almost like magic.
              </p>
              <p>
                You can see what it looks like in action here:
                <a
                  href="https://twitter.com/OKatBest/status/1795453042994680148"
                  >https://twitter.com/OKatBest/status/1795453042994680148</a
                >
              </p>
              <p>
                The app itself is free without ads, subscriptions, or trackers.
                It's a tool I built for myself, and I just thought someone else
                might want to use it too. I have never seen this technology
                being used before, all other apps require you to either print
                something and use the camera, or to place your phone on the
                spinning platter and use the accelerometer.
              </p>
              <p>
                You can grab it on the App Store, and I am working on an Android
                version I hope to release at some point in June.
              </p>
              <p>Would love to hear what you think about it!</p>
              <p>Ivan_</p>
            </div>
          </section>
        </section>
        <section id="40501015">
          <h3>
            <a
              class="item"
              href="https://eos.org/science-updates/an-air-quality-model-that-is-evolving-with-the-times"
              >An air quality model that is evolving with the times</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 14:22:52</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40501015"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40498580">
          <h3>
            <a class="item" href="https://www.file0.dev"
              >Show HN: File0 – An easier way to manage files in serverless
              apps</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 08:17:00</span
              ><span class="points-container"
                >Points: <span class="points">163</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40498580"
                  >Comments</a
                ><span class="descendants">: 133</span></span
              >
            </h4>
            <div class="text">
              <p>
                I can't be asked, so I built FILE0. It's for storing files but
                you don't need to complete an online course.
              </p>
            </div>
          </section>
        </section>
        <section id="40496660">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-05-succeed-accurately-dating-year-prehistoric.html"
              >Researchers accurately dating a 7k-year-old settlement using
              cosmic rays</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-28 @ 02:00:13</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40496660"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40478696">
          <h3>
            <a
              class="item"
              href="https://surfingcomplexity.blog/2024/05/25/the-error-term-isnt-pareto-distributed/"
              >The error term isn't Pareto distributed</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-25 @ 23:45:39</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40478696"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
