<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38315309">
          <h3>
            <a
              class="item"
              href="https://twitter.com/gdb/status/1725736242137182594"
              >Sam Altman and Greg Brockman Joint Statement</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-18 @ 04:42:51</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38315309"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38314407">
          <h3>
            <a
              class="item"
              href="https://twitter.com/GaryMarcus/status/1725707548106580255"
              >Sutskever: OpenAI board doing its mission to build AGI that
              benefits all</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-18 @ 02:54:24</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38314407"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38314224">
          <h3>
            <a
              class="item"
              href="https://gabrielsieben.tech/2023/11/15/parental-controls-are-unusable-and-its-why-congress-is-stepping-in/"
              >Parental controls? What parental controls?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-18 @ 02:31:34</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38314224"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38313747">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=38313747"
              >Ask HN: Are job referrals worthless now?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-18 @ 01:37:08</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38313747"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
            <div class="text">
              I've been looking for work the past few months. I've never been
              great at the people-networking side of the software engineering
              business but know enough people to get some good referrals from
              Staff Engineer / Director level former coworkers. Despite meeting
              all the requirements, and being referred by a current
              employee...I'm just getting simple rejection emails. Previously I
              thought of referrals as a great signal that someone was good
              candidate and was worth at least a phone call. Is that no longer
              the case?
            </div>
          </section>
        </section>
        <section id="38313457">
          <h3>
            <a class="item" href="https://lmax-exchange.github.io/disruptor/"
              >LMAX Disruptor â€“ High Performance Inter-Thread Messaging
              Library</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-18 @ 01:08:39</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38313457"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38312974">
          <h3>
            <a
              class="item"
              href="https://yuzu-emu.org/entry/yuzu-progress-report-oct-2023/"
              >Yuzu Progress Report October 2023</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-18 @ 00:28:59</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38312974"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38312704">
          <h3>
            <a
              class="item"
              href="https://twitter.com/gdb/status/1725667410387378559?s=20"
              >Greg Brockman quits OpenAI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-18 @ 00:10:21</span
              ><span class="points-container"
                >Points: <span class="points">986</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38312704"
                  >Comments</a
                ><span class="descendants">: 477</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38312649">
          <h3>
            <a
              class="item"
              href="https://uplab.pro/2023/11/i-hacked-the-magic-mouse/"
              >I Hacked the Magic Mouse</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-18 @ 00:06:28</span
              ><span class="points-container"
                >Points: <span class="points">165</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38312649"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38312372">
          <h3>
            <a
              class="item"
              href="https://www.axios.com/2023/11/17/microsoft-openai-sam-altman-ouster"
              >Microsoft was blindsided by OpenAI's ouster of CEO Sam Altman</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-17 @ 23:42:38</span
              ><span class="points-container"
                >Points: <span class="points">516</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38312372"
                  >Comments</a
                ><span class="descendants">: 166</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38311999">
          <h3>
            <a
              class="item"
              href="https://blog.koehntopp.info/2023/11/11/a-revolution-devours-its-children.html"
              >A Revolution Devours Its Children</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-17 @ 23:14:10</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38311999"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38311144">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/technology/metas-head-augmented-reality-software-stepping-down-2023-11-17/"
              >Meta's head of augmented reality software stepping down</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-17 @ 22:07:34</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38311144"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38310502">
          <h3>
            <a class="item" href="https://www.narrative.bi/ai"
              >Show HN: nbi.ai â€“ Generative Business Intelligence</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-17 @ 21:18:32</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38310502"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38310270">
          <h3>
            <a class="item" href="https://up.codes/careers?utm_source=HN"
              >Upcodes (YC S17) is hiring a recruiter to help build out remote
              team</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-17 @ 21:02:10</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38309970">
          <h3>
            <a class="item" href="https://github.com/FWGS/xash3d-fwgs"
              >Xash3D: An open-source reimplementation of Half-Life</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-17 @ 20:44:33</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38309970"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38309611">
          <h3>
            <a
              class="item"
              href="https://openai.com/blog/openai-announces-leadership-transition"
              >OpenAI's board has fired Sam Altman</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-17 @ 20:28:50</span
              ><span class="points-container"
                >Points: <span class="points">4210</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38309611"
                  >Comments</a
                ><span class="descendants">: 1740</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38309014">
          <h3>
            <a class="item" href="https://www.latent.space/p/semianalysis"
              >The state of silicon and the GPU poors</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-17 @ 19:41:53</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38309014"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38308552">
          <h3>
            <a
              class="item"
              href="https://www.jeffgeerling.com/blog/2023/pcie-coral-tpu-finally-works-on-raspberry-pi-5"
              >A PCIe Coral TPU Finally Works on Raspberry Pi 5</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-17 @ 19:16:01</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38308552"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38307596">
          <h3>
            <a
              class="item"
              href="https://www.construction-physics.com/p/how-the-gas-turbine-conquered-the"
              >How the gas turbine conquered the electric power industry</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-17 @ 18:17:30</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38307596"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38306680">
          <h3>
            <a class="item" href="https://www.apostrophe.org.uk"
              >Apostrophe Protection Society</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-17 @ 17:21:53</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38306680"
                  >Comments</a
                ><span class="descendants">: 131</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38306540">
          <h3>
            <a
              class="item"
              href="https://rocket.rs/v0.5/news/2023-11-17-version-0.5/"
              >Rocket v0.5: Stable, Async</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-17 @ 17:14:22</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38306540"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38306320">
          <h3>
            <a
              class="item"
              href="https://blog.sentry.io/introducing-the-functional-source-license-freedom-without-free-riding/"
              >Sentry Relicense Again (FSL)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-17 @ 17:01:12</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38306320"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38306174">
          <h3>
            <a
              class="item"
              href="https://breakingdefense.com/2023/11/with-trillions-at-play-pentagon-fails-audit-for-sixth-year-in-a-row/"
              >Pentagon fails audit for sixth year in a row</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-17 @ 16:52:28</span
              ><span class="points-container"
                >Points: <span class="points">287</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38306174"
                  >Comments</a
                ><span class="descendants">: 237</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38305787">
          <h3>
            <a class="item" href="https://stranger.video/"
              >A game about staring into the eyes of a stranger</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-17 @ 16:30:07</span
              ><span class="points-container"
                >Points: <span class="points">229</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38305787"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38304661">
          <h3>
            <a
              class="item"
              href="https://squint-cljs.github.io/squint/?src=https://gist.githubusercontent.com/borkdude/ca3af924dc2526f00361f28dcf5d0bfb/raw/09cd9e17bf0d6fa3655d0e7cbf2c878e19cb894f/pinball.cljs"
              >Pinball implemented using Squint, a ClojureScript dialect</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-17 @ 15:13:40</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38304661"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38304485">
          <h3>
            <a
              class="item"
              href="https://theconversation.com/the-worlds-280-million-electric-bikes-and-mopeds-are-cutting-demand-for-oil-far-more-than-electric-cars-213870"
              >280M e-bikes and mopeds are cutting demand for oil far more than
              electric cars</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-17 @ 15:02:26</span
              ><span class="points-container"
                >Points: <span class="points">691</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38304485"
                  >Comments</a
                ><span class="descendants">: 659</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38304405">
          <h3>
            <a
              class="item"
              href="https://www.goldmansachs.com/intelligence/pages/electric-vehicle-battery-prices-falling.html"
              >Electric vehicle battery prices are falling faster than
              expected</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-17 @ 14:57:16</span
              ><span class="points-container"
                >Points: <span class="points">374</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38304405"
                  >Comments</a
                ><span class="descendants">: 218</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38302033">
          <h3>
            <a
              class="item"
              href="https://landaire.net/world-of-warships-deobfuscation/"
              >Deobfuscating World of Warships' Python Scripts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-17 @ 11:23:26</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38302033"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38301473">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/science/2023/07/is-distributed-computing-dying-or-just-fading-into-the-backdrop/"
              >Is distributed computing dying, or just fading into the
              background?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-17 @ 09:51:57</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38301473"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38300902">
          <h3>
            <a
              class="item"
              href="https://www.cricetuscricetus.co.uk/post/copernicus-galileo-kepler-they-all-lacked-proof"
              >Copernicus, Galileo and Kepler all lacked proof</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-17 @ 08:19:16</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38300902"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38295705">
          <h3>
            <a
              class="item"
              href="https://www.executeprogram.com/courses/python-for-programmers"
              >Show HN: Beta test Execute Program's interactive "Python for
              Programmers" course</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-16 @ 21:21:26</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38295705"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
            <div class="text">
              <p>
                <a
                  href="https://www.executeprogram.com/courses/python-for-programmers"
                  >https://www.executeprogram.com/courses/python-for-programmer...</a
                >
              </p>
              <p>
                Today, "Python for Programmers" contains 581 interactive code
                examples covering the core language. It's aimed at established
                programmers, not beginners. We don't explain basic language
                features like `while`, but we do show them briefly and note
                anything special about how they work in Python. We pay special
                attention to foot guns. For example, we have an entire lesson
                about Python's mutable default argument foot gun.
              </p>
              <p>
                This is the first of two courses, with the second coming in
                2024. For this course, we drew the line at __dunder__ methods:
                if a topic requires a dunder method other than `__init__`, then
                it'll be in the follow-up course. This beta is concurrent with
                the tail end of our editing process, so you may see the course
                grow by another 17 lessons (214 code examples) during the beta.
              </p>
              <p>
                Some details about how the course works internally, and why we
                need a beta at all:
              </p>
              <p>
                First, all Python code in the course runs in your browser via
                Pyodide. (Reality continues to look more and more like my PyCon
                2014 talk [1].) You'll feel a pause when the first code example
                runs, as your browser loads and boots CPython (around 12 MB).
                After that, it should be as responsive as a local app.
              </p>
              <p>
                Second, if you look at the course page, you'll see that it's
                structured as a DAG, similar to a "tech tree" in Civilization,
                Age of Empires, Stellaris, Satisfactory, etc. (Some of those
                games have true trees, but some of their "trees" are actually
                DAGs like ours.) You make progress through the course by
                traversing one graph edge at a time. Our courses have always
                been structured as graphs internally, but the raw graphs are
                simply unreadable due to the number of edges [2].
              </p>
              <p>
                This year, I taught Execute Program to simplify its own course
                graphs by breaking them into the level subgraphs that you see on
                the page, so we can finally render them. It automatically turns
                the mess that I linked above into the clean graphs that you see
                in the course. The graph for this course is currently a bit
                dull, but it'll fill out as we finish editing the remaining
                lessons. I like Everyday TypeScript's graph [3] the best.
              </p>
              <p>
                Please try the course and use the "Give Feedback" entry in the
                menu to tell us what you think! I'll also stick around in this
                thread today.
              </p>
              <p>
                [1]
                <a
                  href="https://www.destroyallsoftware.com/talks/the-birth-and-death-of-javascript"
                  >https://www.destroyallsoftware.com/talks/the-birth-and-death...</a
                >
              </p>
              <p>
                [2]
                <a
                  href="https://executeprogram-misc.s3.us-east-1.amazonaws.com/python-for-programmers-1.png"
                  >https://executeprogram-misc.s3.us-east-1.amazonaws.com/pytho...</a
                >
              </p>
              <p>
                [3]
                <a
                  href="https://www.executeprogram.com/courses/everyday-typescript"
                  >https://www.executeprogram.com/courses/everyday-typescript</a
                >
              </p>
            </div>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
