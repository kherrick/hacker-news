<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42347606">
          <h3>
            <a
              class="item"
              href="https://github.com/Olshansk/postgres_for_everything"
              >Postgres for Everything (E/Postgres)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-07 @ 05:56:15</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42347606"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42347601">
          <h3>
            <a
              class="item"
              href="https://www.healthcaredive.com/news/health-insurers-remove-executive-bios-images-unitedhealthcare-ceo-killing/734824/"
              >Health insurers remove executive bios, images from websites after
              CEO killing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-07 @ 05:54:48</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42347601"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42347432">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42347432"
              >Tell HN: Alaska Airlines website exposes passenger data</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-07 @ 05:12:07</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42347432"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
            <div class="text">
              <p>
                The first time it happened it appeared by seeing "Treat
                yourself, Samantha" in the website ad for upgrading yourself to
                Premium class. My name is not Samantha.
              </p>
              <p>
                I clicked, and saw Samantha Lastname was traveling from Miami to
                Seattle. There was her phone number, record locator, ticket and
                mileage numbers, emails and other info. It also would have let
                me change or cancel her flights.
              </p>
              <p>
                When I refreshed I got a new person. Trevor. He's going from JFK
                to SEA, and back to EWR.
              </p>
              <p>
                I figured this wasn't one-off (yet still serious) bug, and
                called Alaska Support. They didn't believe me, but once I had
                rattled off the customer information I had in front of me and
                told them I'm none of these people, they transferred me to
                somewhere I thought was a higher up.
              </p>
              <p>
                The higher-up person verified some information, asked no
                questions on how to replicate the bug, and asked me to log out
                and log back in. Once I did, the issue did not show up again.
                They said they'll send me 3,000 points for reporting. That
                sounded pretty low to me as it seemed like a serious data leak,
                but whatever.
              </p>
              <p>
                I contemplated whether to post about this as I thought it would
                be interesting for the HN audience to see, but decided against
                it thinking I'll give Alaska time to fix it.
              </p>
              <p>
                It's been 4 months now, and today this happened again. I saw an
                upgrade ad for Sally. Sally and Chris are traveling in the same
                reservation from Redmond, OR to Seattle in Main Preferred class.
                Knowing what I was looking at, I figured Alaska had done
                absolutely nothing to fix the issue.
              </p>
              <p>
                I have a theory what's causing it as there's something specific
                that happened before both of these issues, but I'll refrain from
                posting it here so it's not as easy to exploit. Who knows what
                else the payload might include.
              </p>
              <p>
                I took screenshots throughout the process, including some
                console logs, to document what I saw. I am sharing this here in
                the hope that the added visibility will finally push Alaska
                Airlines to address the issue.
              </p>
            </div>
          </section>
        </section>
        <section id="42346463">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=0JouTsMQsEA"
              >RollerCoaster Tycoon was the last of its kind [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-07 @ 01:32:19</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42346463"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42346344">
          <h3>
            <a class="item" href="https://ollama.com/blog/structured-outputs"
              >Structured Outputs with Ollama</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-07 @ 01:12:32</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42346344"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42346274">
          <h3>
            <a
              class="item"
              href="https://github.com/oils-for-unix/oils/wiki/The-Biggest-Shell-Programs-in-the-World"
              >Biggest shell programs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-07 @ 00:59:11</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42346274"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42344002">
          <h3>
            <a class="item" href="https://shilin.ca/my-second-year-without-job/"
              >My second year without a job</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-06 @ 20:26:05</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42344002"
                  >Comments</a
                ><span class="descendants">: 229</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42343953">
          <h3>
            <a
              class="item"
              href="https://www.moment.dev/blog/lies-i-was-told-pt-1"
              >Lies I was told about collab editing, Part 1: Algorithms for
              offline editing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-06 @ 20:22:07</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42343953"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42343920">
          <h3>
            <a
              class="item"
              href="http://www.moserware.com/2008/02/does-your-code-pass-turkey-test.html"
              >Does Your Code Pass the Turkey Test? (2008)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-06 @ 20:18:55</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42343920"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42343692">
          <h3>
            <a class="item" href="https://dspy.ai/"
              >DSPy – Programming–not prompting–LMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-06 @ 19:59:49</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42343692"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42343215">
          <h3>
            <a class="item" href="https://arcprize.org/2024-results"
              >Arc Prize 2024 Winners and Technical Report</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-06 @ 19:20:19</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42343215"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42343182">
          <h3>
            <a
              class="item"
              href="https://lighthouseapp.io/blog/deep-dive-finding-rss-feeds"
              >Deep dive into finding RSS feeds</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-06 @ 19:17:07</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42343182"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42343089">
          <h3>
            <a
              class="item"
              href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/dialog"
              >: The Dialog Element</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-06 @ 19:09:07</span
              ><span class="points-container"
                >Points: <span class="points">214</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42343089"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42343052">
          <h3>
            <a
              class="item"
              href="https://lcat.dev/post.php?id=3cf8e1b9-e5e3-4a6d-af27-12720c5b2d54"
              >How to Bypass WhatsApp Web's Locked Chat Feature</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-06 @ 19:06:17</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42343052"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42342697">
          <h3>
            <a class="item" href="https://openai.com/form/rft-research-program/"
              >OpenAI Reinforcement Fine-Tuning Research Program</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-06 @ 18:37:56</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42342697"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42342382">
          <h3>
            <a class="item" href="https://everyuuid.com/">Every V4 UUID</a>
          </h3>
          <section>
            <h4>
              <span>2024-12-06 @ 18:11:46</span
              ><span class="points-container"
                >Points: <span class="points">876</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42342382"
                  >Comments</a
                ><span class="descendants">: 282</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42342203">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/2024/12/06/asia/tokyo-government-4-day-workweek-intl-hnk/index.html"
              >Tokyo is set to introduce a four-day workweek for government
              employees</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-06 @ 17:54:20</span
              ><span class="points-container"
                >Points: <span class="points">478</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42342203"
                  >Comments</a
                ><span class="descendants">: 247</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42341506">
          <h3>
            <a
              class="item"
              href="https://terriblesoftware.org/2024/12/04/the-6-mistakes-youre-going-to-make-as-a-new-manager/"
              >Mistakes as a new manager</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-06 @ 16:56:50</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42341506"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42340959">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2024/12/06/tiktok-divestment-law-upheld-by-federal-appeals-court.html"
              >TikTok divestment law upheld by federal appeals court</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-06 @ 16:00:51</span
              ><span class="points-container"
                >Points: <span class="points">255</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42340959"
                  >Comments</a
                ><span class="descendants">: 404</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42340065">
          <h3>
            <a
              class="item"
              href="https://crackoverflow.com/docs/system_administration/containerization/install-docker-natively-on-android-phone-and-use-it-as-a-home-server/"
              >Install postmarketOS on Android phone and use Docker as a home
              server</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-06 @ 14:23:17</span
              ><span class="points-container"
                >Points: <span class="points">239</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42340065"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42340000">
          <h3>
            <a
              class="item"
              href="https://www.thedrive.com/news/rivian-is-opening-its-charger-network-to-other-evs"
              >Rivian is opening its charging network to other EVs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-06 @ 14:16:49</span
              ><span class="points-container"
                >Points: <span class="points">213</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42340000"
                  >Comments</a
                ><span class="descendants">: 200</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42339819">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/articles/cn4x2epppego"
              >Romanian court annuls result of presidential election first
              round</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-06 @ 13:55:49</span
              ><span class="points-container"
                >Points: <span class="points">392</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42339819"
                  >Comments</a
                ><span class="descendants">: 756</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42338134">
          <h3>
            <a
              class="item"
              href="https://lwn.net/SubscriberLink/1000485/670ef0045e5e8a3e/"
              >Debian opens a can of username worms</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-06 @ 09:55:18</span
              ><span class="points-container"
                >Points: <span class="points">191</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42338134"
                  >Comments</a
                ><span class="descendants">: 225</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42306868">
          <h3>
            <a
              class="item"
              href="https://www.science.org/doi/10.1126/sciadv.ade2537"
              >The dogs of Chernobyl: Populations in the nuclear exclusion zone
              (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-03 @ 15:07:31</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42306868"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42305766">
          <h3>
            <a
              class="item"
              href="https://utcc.utoronto.ca/~cks/space/blog/programming/GoUnionTypesComplexities"
              >Union types ('enum types') would be complicated in Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-03 @ 13:21:57</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42305766"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42302907">
          <h3>
            <a
              class="item"
              href="https://www.joshwcomeau.com/css/backdrop-filter/"
              >Next-level frosted glass with backdrop-filter</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-03 @ 03:43:13</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42302907"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42294284">
          <h3>
            <a
              class="item"
              href="https://dailyrefactor.com/exploring-php-lazy-objects-practical-implementation"
              >Exploring PHP Lazy Objects: A Practical Implementation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-02 @ 08:33:47</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42294284"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42286395">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2305.17493"
              >The Curse of Recursion: Training on Generated Data Makes Models
              Forget</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-01 @ 05:21:45</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42286395"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42275249">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-11-rna-crispr-reveals-hundreds-noncoding.html"
              >RNA-targeting CRISPR reveals that noncoding RNAs are not
              'junk'</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-29 @ 17:10:20</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42275249"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42253601">
          <h3>
            <a class="item" href="https://boston.conman.org/2024/11/26.3"
              >Writing assembly language subroutines for Extended Color BASIC</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-27 @ 06:53:33</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42253601"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
