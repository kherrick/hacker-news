<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38343385">
          <h3>
            <a
              class="item"
              href="https://colinwalker.blog/blog/?date=2023-11-19"
              >RSS can be used to distribute all sorts of information</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 06:29:01</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38343385"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38343203">
          <h3>
            <a
              class="item"
              href="https://matplotlib.org/stable/gallery/showcase/xkcd.html"
              >TIL you could make xkcd-like plots with matplotlib</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 06:10:46</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38343203"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38342643">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2023/11/20/23967515/sam-altman-openai-board-fired-new-ceo"
              >Emmett Shear becomes interim OpenAI CEO as Altman talks break
              down</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 05:19:57</span
              ><span class="points-container"
                >Points: <span class="points">442</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38342643"
                  >Comments</a
                ><span class="descendants">: 723</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38342642">
          <h3>
            <a
              class="item"
              href="https://www.evanjones.ca/setenv-is-not-thread-safe.html"
              >Setenv Is Not Thread Safe and C Doesn't Want to Fix It</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 05:19:56</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38342642"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38341466">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2023/11/19/cruise-co-founder-and-ceo-kyle-vogt-resigns/"
              >Kyle Vogt resigns from Cruise</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 02:30:15</span
              ><span class="points-container"
                >Points: <span class="points">257</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38341466"
                  >Comments</a
                ><span class="descendants">: 120</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38341035">
          <h3>
            <a class="item" href="https://github.com/kamranahmedse/local-ses"
              >Trap and test AWS SES emails locally</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 01:38:46</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38341035"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38340431">
          <h3>
            <a
              class="item"
              href="https://twitter.com/justinetunney/status/1726141024597324189?s=46&amp;t=K1nIh-2Y7JjaoOc9Y6bUzA"
              >Cosmopolitan v3.1</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 00:32:07</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38340431"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38340226">
          <h3>
            <a
              class="item"
              href="https://github.com/cxli233/FriendsDontLetFriends"
              >Friends don't let friends make bad graphs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 00:13:24</span
              ><span class="points-container"
                >Points: <span class="points">315</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38340226"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38340188">
          <h3>
            <a class="item" href="https://www.searshouseseeker.com/?m=0"
              >A trip to see Chicagoland Sears houses</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-20 @ 00:10:16</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38340188"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38339715">
          <h3>
            <a
              class="item"
              href="https://github.com/simoninns/DomesdayDuplicator/wiki"
              >The Domesday Duplicator (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-19 @ 23:23:41</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38339715"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38339092">
          <h3>
            <a class="item" href="https://vintagetek.org/tour-crt-catacombs/"
              >A Tour of the Tektronix Ceramic CRT "Catacombs"</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-19 @ 22:29:21</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38339092"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38338635">
          <h3>
            <a
              class="item"
              href="https://magazine.sebastianraschka.com/p/practical-tips-for-finetuning-llms"
              >Practical Tips for Finetuning LLMs Using LoRA (Low-Rank
              Adaptation)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-19 @ 21:54:14</span
              ><span class="points-container"
                >Points: <span class="points">252</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38338635"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38338033">
          <h3>
            <a
              class="item"
              href="https://htmx.org/essays/why-tend-not-to-use-content-negotiation/"
              >Why I tend not to use content negotiation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-19 @ 21:07:33</span
              ><span class="points-container"
                >Points: <span class="points">188</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38338033"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38337784">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/ninth-dedekind-number-found-by-two-independent-groups-20230801/"
              >Ninth Dedekind number found by two independent groups</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-19 @ 20:50:36</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38337784"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38337001">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/culture/cultural-comment/the-cassette-tape-revolution"
              >The Cassette-Tape Revolution</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-19 @ 19:44:13</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38337001"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38336912">
          <h3>
            <a
              class="item"
              href="https://www.sfgate.com/sfhistory/article/the-skylab-race-to-san-francisco-18074888.php"
              >A space station fell to Earth. An Australian boy brought it to
              San Francisco</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-19 @ 19:37:44</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38336912"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38336688">
          <h3>
            <a
              class="item"
              href="https://github.com/arcataroger/awesome-engineering-games"
              >Awesome Engineering Games</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-19 @ 19:22:22</span
              ><span class="points-container"
                >Points: <span class="points">246</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38336688"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
            <div class="text">
              <p>
                These games are both fun and often quite educational, presenting
                gamified versions of real-world challenges and professions.
              </p>
              <p>
                There's a lot of different sub-genres of "engineering game",
                such as:
              </p>
              <p>* Factory automation (Factorio, Dyson Sphere Program)</p>
              <p>* City builders (Cities: Skylines, Anno series)</p>
              <p>* Route-builders (Mini Motorways, Railway Empire)</p>
              <p>* Comp sci (TIS-100, Bitburner)</p>
              <p>
                All games on the list are very highly reviewed. I've played most
                (but not all) of them, and provided personal recommendations
                alongside the reviews. Many of them are also playable on GeForce
                Now (if you don't have a gaming PC).
              </p>
              <p>
                Please contribute if you know of more, or have any
                comments/suggestions!
              </p>
            </div>
          </section>
        </section>
        <section id="38335255">
          <h3>
            <a class="item" href="https://github.com/yl4579/StyleTTS2"
              >StyleTTS2 – open-source Eleven-Labs-quality Text To Speech</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-19 @ 17:40:33</span
              ><span class="points-container"
                >Points: <span class="points">554</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38335255"
                  >Comments</a
                ><span class="descendants">: 194</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38334784">
          <h3>
            <a
              class="item"
              href="https://github.com/AndreaFavero71/CUBOTino_base_version"
              >CUBOTino: A small, simple, 3D printed, inexpensive Rubik's Cube
              solver robot</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-19 @ 17:13:36</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38334784"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38333116">
          <h3>
            <a
              class="item"
              href="https://blog.miguelgrinberg.com/post/it-s-time-for-a-change-datetime-utcnow-is-now-deprecated"
              >datetime.utcnow() is now deprecated</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-19 @ 14:49:32</span
              ><span class="points-container"
                >Points: <span class="points">332</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38333116"
                  >Comments</a
                ><span class="descendants">: 384</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38332014">
          <h3>
            <a
              class="item"
              href="https://watchesbysjx.com/2020/02/positional-error-and-accuracy.html"
              >The position of a watch influences accuracy (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-19 @ 12:24:42</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38332014"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38326758">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/articles/oldest-tartan-plaid-in-scotland"
              >Scotland's Oldest Tartan Rose</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-19 @ 00:29:07</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38326758"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38326746">
          <h3>
            <a
              class="item"
              href="https://publicdomainreview.org/collection/man-and-his-desire/"
              >Modernity in the Rainforest: Man and his Desire (1917)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-19 @ 00:27:04</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38326746"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38326279">
          <h3>
            <a
              class="item"
              href="https://www.nutsvolts.com/magazine/article/remembering-the-crystal-radio"
              >Remembering the Crystal Radio (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-18 @ 23:50:15</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38326279"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38325551">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/11/17/books/as-byatt-dead.html"
              >A.S. Byatt has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-18 @ 22:51:38</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38325551"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38318132">
          <h3>
            <a class="item" href="https://ati.woodlandtrust.org.uk/"
              >Ancient Tree Inventory</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-18 @ 11:14:57</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38318132"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38317722">
          <h3>
            <a class="item" href="https://heather.cs.ucdavis.edu/parprocbook"
              >Programming on Parallel Machines; GPU, Multicore, Clusters and
              More</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-18 @ 10:18:49</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38317722"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38315575">
          <h3>
            <a
              class="item"
              href="https://brooker.co.za/blog/2023/10/18/optimism.html"
              >Optimism vs. Pessimism in Distributed Systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-18 @ 05:12:35</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38315575"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38301087">
          <h3>
            <a class="item" href="https://www.ultorg.com"
              >Ultorg: A User Interface for Relational Data</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-17 @ 08:51:53</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38301087"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38300827">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2023/11/12/inversion-art/"
              >Inversion Art is trying to become the YC of the arts world</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-17 @ 08:06:55</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38300827"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
