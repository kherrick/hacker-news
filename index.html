<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="35453857">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/04/04/business/media/johnson-johnson-talc-settlement.html"
              >Johnson and Johnson Reaches Deal for $8.9B Talc Settlement</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 13:32:46</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35453857"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35453421">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/newsroom/2023/04/apple-and-global-suppliers-expand-renewable-energy-to-13-point-7-gigawatts/"
              >Apple and global suppliers expand renewable energy to 13.7
              gigawatts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 13:01:58</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35453421"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35453400">
          <h3>
            <a class="item" href="https://platform.openai.com/tokenizer"
              >OpenAI Tokenizer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 13:00:19</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35453400"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35452963">
          <h3>
            <a
              class="item"
              href="https://kentindell.github.io/2023/04/03/can-injection/"
              >Can Injection: keyless car theft</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 12:28:49</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35452963"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35452614">
          <h3>
            <a
              class="item"
              href="https://jobs.lever.co/circlemedical/1b3fcca6-6246-40d9-b7c9-096f8dc1871f"
              >Circle Medical (YC S15) Is Hiring Ruby/Rails Engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 12:00:22</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35452258">
          <h3>
            <a
              class="item"
              href="https://www.katevassgalerie.com/blog/harold-cohen-aaron-computer-art"
              >Aaron: AI Art Generator from 1973</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 11:18:00</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35452258"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35451863">
          <h3>
            <a
              class="item"
              href="https://security.stackexchange.com/questions/269507/is-ram-wiped-before-use-in-another-lxc-container"
              >Is RAM wiped before use in another LXC container?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 10:22:51</span
              ><span class="points-container"
                >Points: <span class="points">180</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35451863"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35451046">
          <h3>
            <a class="item" href="https://www.homerow.app"
              >Vim-like “jump” cursor for Mac OS Window Management</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 08:29:27</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35451046"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35450978">
          <h3>
            <a
              class="item"
              href="https://www.cosmos.esa.int/web/gaia/iow_20221104"
              >Gaia's first black hole discovery: GAIA-BH1 (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 08:18:20</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35450978"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35450175">
          <h3><a class="item" href="https://brlcad.org/">BRL-CAD</a></h3>
          <section>
            <h4>
              <span>2023-04-05 @ 06:34:24</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35450175"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35450007">
          <h3>
            <a class="item" href="https://github.com/cilium/pwru"
              >Packet, where are you? – eBPF-based Linux kernel networking
              debugger</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 06:11:32</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35450007"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35449831">
          <h3>
            <a class="item" href="https://course.fast.ai/Lessons/part2.html"
              >Deep Learning Foundations to Stable Diffusion</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 05:47:31</span
              ><span class="points-container"
                >Points: <span class="points">439</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35449831"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35449559">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2304.01373"
              >Pythia: A Suite for Analyzing Large Language Models Across
              Training and Scaling</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 05:10:55</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35449559"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35449494">
          <h3>
            <a
              class="item"
              href="https://well-typed.com/blog/2023/03/purgatory/"
              >Calling Purgatory from Heaven: Binding to Rust in Haskell</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 05:01:07</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35449494"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35448899">
          <h3>
            <a
              class="item"
              href="https://www.sfgate.com/bayarea/article/mill-valley-man-killed-sf-stabbing-17878809.php"
              >Bob Lee, former CTO of Square, has died after being stabbed in
              San Francisco</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 03:24:41</span
              ><span class="points-container"
                >Points: <span class="points">785</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35448899"
                  >Comments</a
                ><span class="descendants">: 935</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35448357">
          <h3>
            <a
              class="item"
              href="https://phoboslab.org/log/2021/11/qoi-fast-lossless-image-compression"
              >Lossless Image Compression in O(n) Time (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 02:05:20</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35448357"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35447914">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2304.01433"
              >TPU v4: An Optically Reconfigurable Supercomputer for Machine
              Learning</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 01:03:34</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35447914"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35447588">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/news/our-columnists/the-case-for-banning-children-from-social-media"
              >The case for banning children from social media</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 00:19:24</span
              ><span class="points-container"
                >Points: <span class="points">319</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35447588"
                  >Comments</a
                ><span class="descendants">: 489</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35447288">
          <h3>
            <a class="item" href="https://github.com/leetcode-mafia/cheetah"
              >Show HN: Live coaching app for remote SWE interviews, uses
              Whisper and GPT-4</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-04 @ 23:36:07</span
              ><span class="points-container"
                >Points: <span class="points">251</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35447288"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
            <div class="text">
              <p>
                This project is a salvo against leetcode-style interviews that
                require candidates to study useless topics and confidently write
                code in front of a live audience, in order to get a job where
                none of that stuff matters.
              </p>
              <p>
                Cheetah is an AI-powered macOS app designed to assist users
                during remote software engineering interviews by providing
                real-time, discreet coaching and integration with CoderPad. It
                uses Whisper for audio transcription and GPT-4 to generate
                hints/answers. The UI is intentionally minimal to allow for
                discreet use during a video call.
              </p>
              <p>
                It was fun dipping into the world of LLMs, prompt chaining, etc.
                I didn't find a Swift wrapper for whisper.cpp, so in the repo
                there's also a barebones Swift framework that wraps whisper.cpp
                and is designed for real-time transcription on M1/M2.
              </p>
              <p>I'll be around if anyone has questions or comments!</p>
            </div>
          </section>
        </section>
        <section id="35447094">
          <h3>
            <a class="item" href="http://ptere.com/wol/"
              >Using Wake on LAN (WOL) Across the Internet (2010)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-04 @ 23:12:01</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35447094"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35442103">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=35442103"
              >Launch HN: Type (YC W23) – AI-powered document editor</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-04 @ 16:23:52</span
              ><span class="points-container"
                >Points: <span class="points">180</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35442103"
                  >Comments</a
                ><span class="descendants">: 218</span></span
              >
            </h4>
            <div class="text">
              <a href="https://type.ai/">https://type.ai/</a>). We're building
              an AI-first document editor that helps you write. It's similar to
              Notion, but focused on building a solid authoring experience.
              <p>
                Here’s a general demo:
                <a href="https://www.youtube.com/watch?v=MpK9PWo0lUw"
                  >https://www.youtube.com/watch?v=MpK9PWo0lUw</a
                >
              </p>
              <p>
                And here’s a demo that includes math and code blocks:
                <a href="https://type.ai/code-math-demos"
                  >https://type.ai/code-math-demos</a
                >
              </p>
              <p>
                There are a lot of AI writing products out now, but we've found
                that most of them treat writing like a one-shot activity that
                should be delegated to AI. We don't think that's the optimal way
                to write. We think of great writing as the product of clear
                thinking, which requires a lot of time tinkering with and
                refining ideas. So we’re building a user-friendly document
                editor that puts the author front and center.
              </p>
              <p>
                As you write in Type, you can press cmd+k to summon simple AI
                commands. Most of our commands are grounded in familiar writing
                primitives (ex. “Write paragraph”) and attempt to understand the
                context of your document.
              </p>
              <p>
                Type supports multiple rich block types, including code and math
                and our commands are able to both interpret and output these
                block types. So if you're writing an introductory essay about
                machine learning, for example, you can use Type's chat feature
                to generate and refine equations and code blocks you'd like to
                include in your document. Once you’re satisfied with what Type
                has generated, you can drag and insert the block anywhere in
                your document (as seen in the demo video above).
              </p>
              <p>
                We’ve also built a "what to write about next" feature in the
                document sidebar that offers suggestions on ideas you may
                consider adding to your document.
              </p>
              <p>
                We’ve built some editor features that aren’t AI-specific but
                which we think make for an enjoyable authoring experience: (1)
                Type is built from the ground up to be offline-first. This means
                most interactions (search, loading documents, etc.) are instant;
                (2) Mobile support as installable PWA; (3) Keyboard shortcuts
                for the most useful commands; (4) Markdown copy/paste support.
              </p>
              <p>
                We designed Type to be most useful for longer-form writing, so
                we encourage you to try it out in the context of something like
                an essay or a technical tutorial. If you try it out at
                <a href="https://type.ai">https://type.ai</a>, we’d love to hear
                what you think. We think Type feels pretty different from other
                AI writing tools that produce fairly shallow content, but would
                love to get your honest feedback on whether we're hitting the
                mark.
              </p>
              <p>
                Each account comes with a free allocation of AI commands, after
                which you can activate a paid plan for unlimited AI usage (you
                can still create and access unlimited docs on the free plan). If
                you'd like some additional free credits, please just drop us a
                note at founders@type.ai and we'll refill your free credits.
              </p>
              <p>
                We'd love your feedback on what feels helpful and what feels
                confusing or missing. Thanks!
              </p>
            </div>
          </section>
        </section>
        <section id="35441759">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/chip-design-controversy"
              >Ending an Ugly Chapter in Chip Design</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-04 @ 16:02:38</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35441759"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35441337">
          <h3>
            <a class="item" href="https://www.ermine.ai/"
              >Show HN: Ermine.ai – Record and transcribe speech, 100%
              client-side (WASM)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-04 @ 15:34:54</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35441337"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35439958">
          <h3>
            <a class="item" href="https://martinheinz.dev/blog/94"
              >Make your CLI demos a breeze with zero stress and zero
              mistakes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-04 @ 14:14:11</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35439958"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35439916">
          <h3>
            <a
              class="item"
              href="https://blog.janetacarr.com/mindset-shifts-for-functional-programming-with-clojure/"
              >Mindset shifts for functional programming (with Clojure)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-04 @ 14:11:35</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35439916"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35438326">
          <h3>
            <a
              class="item"
              href="https://sparktoro.com/blog/who-will-amplify-this-and-why/"
              >Who Will Amplify This? and Why? (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-04 @ 12:11:53</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35438326"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35437397">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/04/04/siri_alexa_cortana_google_nuit/"
              >Using ultrasound attack to disarm a smart-home system</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-04 @ 10:16:56</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35437397"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35437070">
          <h3>
            <a
              class="item"
              href="https://boilingsteam.com/liberating-the-macbook-air-2013-with-linux-complete-guide/"
              >Liberating the MacBook Air 2013 with Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-04 @ 09:22:23</span
              ><span class="points-container"
                >Points: <span class="points">262</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35437070"
                  >Comments</a
                ><span class="descendants">: 176</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35434435">
          <h3>
            <a
              class="item"
              href="https://wcedmisten.fyi/post/visualizing-hospital-accessibility/"
              >Mapping hospital accessibility with OpenStreetMap</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-04 @ 03:00:30</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35434435"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35431328">
          <h3>
            <a
              class="item"
              href="https://tomcritchlow.com/2023/04/03/blog-maps/"
              >Building an interactive clickable map for my blog</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-03 @ 21:09:28</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35431328"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
