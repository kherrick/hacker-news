<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39827113">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/world/us/floridas-desantis-signs-law-restricting-social-media-people-under-16-2024-03-25"
              >Florida's DeSantis signs law restricting social media for people
              under 16</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-26 @ 12:41:02</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39827113"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39826990">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2024/03/26/hmrc_linux_paye_tools/"
              >Good news: HMRC offers a Linux version of Basic PAYE Tools. Bad
              news: It broke</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-26 @ 12:26:43</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39826990"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39826770">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/nimbus-3/jobs/SqMcSqM-founding-full-stack-engineer"
              >Nimbus (YC W21) Is Hiring Founding Engineer to Make Datadog
              Affordable Again</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-26 @ 12:00:18</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39826209">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2024/3/26/24112277/canva-affinity-acquisition-design-software-suite-adobe-rival"
              >Canva acquires Affinity to fill the Adobe-sized holes in its
              design suite</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-26 @ 10:41:48</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39826209"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39826176">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/media/2024/mar/26/julian-assange-granted-permission-to-appeal-against-extradition-to-us"
              >Julian Assange granted permission to appeal against extradition
              to US</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-26 @ 10:37:30</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39826176"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39825901">
          <h3>
            <a
              class="item"
              href="https://www.copetti.org/writings/consoles/sega-saturn/"
              >Sega Saturn Architecture – A practical analysis</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-26 @ 09:51:42</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39825901"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39825033">
          <h3>
            <a
              class="item"
              href="https://twitter.com/sentdefender/status/1772514015790477667"
              >The Francis Scott Key Bridge in Baltimore, Maryland Has
              Collapsed</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-26 @ 07:25:09</span
              ><span class="points-container"
                >Points: <span class="points">478</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39825033"
                  >Comments</a
                ><span class="descendants">: 327</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39824611">
          <h3>
            <a
              class="item"
              href="https://remyhax.xyz/posts/golang-packet-editing/"
              >Packet-Editing Games in Golang (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-26 @ 05:52:12</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39824611"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39824589">
          <h3>
            <a class="item" href="https://www.fluffytutor.com"
              >Show HN: Learn Any Language with an AI Tutor at Your Own Pace</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-26 @ 05:45:17</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39824589"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39824478">
          <h3>
            <a class="item" href="https://github.com/sugawarayuuta/charcoal"
              >Show HN: Charcoal – Faster utf8.Valid using multi-byte processing
              without SIMD</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-26 @ 05:20:13</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39824478"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39824100">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2020/8/6/21355674/human-genes-rename-microsoft-excel-misreading-dates"
              >Scientists rename genes to stop Microsoft Excel from misreading
              them as dates</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-26 @ 03:47:53</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39824100"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39824019">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2403.16341"
              >Nonlinearsolve.jl: Fast and Robust Solvers for Nonlinear
              Equations in Julia</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-26 @ 03:27:56</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39824019"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39823505">
          <h3>
            <a
              class="item"
              href="https://neuroscience.stanford.edu/news/unlocking-secrets-myelin-repair"
              >Unlocking the secrets of myelin repair</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-26 @ 01:52:41</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39823505"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39823373">
          <h3>
            <a class="item" href="https://github.com/omriharel/deej"
              >Deej: An open-source hardware volume mixer for Windows and
              Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-26 @ 01:29:07</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39823373"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39823146">
          <h3>
            <a
              class="item"
              href="https://apnews.com/article/tulips-netherlands-robot-technology-46ec590b882188ee6d7428df8f04bb9e"
              >An AI robot is destroying sick tulips in Dutch bulb fields</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-26 @ 00:57:44</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39823146"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39823104">
          <h3>
            <a class="item" href="https://blog.salesforceairesearch.com/moirai/"
              >Moirai: A time series foundation model for universal
              forecasting</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-26 @ 00:51:28</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39823104"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39823079">
          <h3>
            <a
              class="item"
              href="https://blog.wolfram.com/2024/03/25/computational-astronomy-exploring-the-cosmos-with-wolfram/"
              >Computational Astronomy: Exploring the Cosmos with Wolfram</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-26 @ 00:48:47</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39823079"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39822222">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/inkjet-printer"
              >Inkjets are for more than just printing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 23:00:40</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39822222"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39822184">
          <h3>
            <a
              class="item"
              href="https://thechipletter.substack.com/p/googles-first-tpu-architecture"
              >Google's First Tensor Processing Unit: Architecture</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 22:56:37</span
              ><span class="points-container"
                >Points: <span class="points">291</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39822184"
                  >Comments</a
                ><span class="descendants">: 147</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39819599">
          <h3>
            <a
              class="item"
              href="https://comsec.ethz.ch/research/dram/zenhammer/"
              >ZenHammer: Rowhammer attacks on AMD Zen-based platforms</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 18:20:05</span
              ><span class="points-container"
                >Points: <span class="points">300</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39819599"
                  >Comments</a
                ><span class="descendants">: 120</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39819458">
          <h3>
            <a class="item" href="https://github.com/TracecatHQ/tracecat"
              >Show HN: Tracecat – Open-source security alert automation / SOAR
              alternative</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 18:05:07</span
              ><span class="points-container"
                >Points: <span class="points">218</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39819458"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
            <div class="text">
              <a href="https://tracecat.com/">https://tracecat.com/</a>), an
              open source automation platform for security alerts. Tracecat
              automates the tasks a security analyst has to do when responding
              to a security alert: e.g. contact victims, investigate security
              logs, report vulnerability.
              <p>
                The average security analyst deals with 100 alerts per day. As
                soon as an alert comes in, you have to investigate and respond.
                An average alert takes ~30 minutes to analyze (and 100 x 30 min
                = 50 hours &gt; one whole day) Lots of things get dropped, and
                this creates vulnerabilities. Many breaches can be traced back
                to week old alerts that didn’t get properly investigated.
              </p>
              <p>
                Since the risks and costs are so high, top security teams
                currently pay Splunk SOAR $100,000/year to help automate alert
                processing. It’s a click-and-drag workflow builder with
                webhooks, REST API integrations, and JSON processors. A security
                engineer would use it to build alert automations that look like
                this: (1) webhook to receive alert (e.g. unusual powershell cmd)
                from Microsoft Defender; (2) send yes/no Slackbot to ask
                employee about the alert; (3) if confirmed as suspicious, send
                malware sample to VirusTotal for report (4) collect evidence
                from previous steps and dump it into a ticket.
              </p>
              <p>
                If $100k a year seems wildly expensive for a Zapier-like
                platform, you’d be half right. Splunk SOAR is actually a Zapier
                + log search + Jira ticketing system.
              </p>
              <p>
                Log storage—that’s how Splunk turns a $99/month workflow
                automation tool into a pricey enterprise product. Every piece of
                evidence collected (e.g. Slackbot response, malware report,
                GeoIP enrichment) and every past workflow trail has to be
                searchable by a human incident responder or auditor. Security
                teams need to know why every alert escalated to a SEV1 or not.
              </p>
              <p>
                My cofounder and I are data engineers who fell into this space.
                We heard our security friends constantly complain about being
                priced out of a SOAR (security orchestration, automation, and
                response platform) like Splunk SOAR.
              </p>
              <p>
                We both wrote a lot of event-driven code at school (Master’s
                thesis) and work (Meta / PwC). We’re also early adopters of
                Quickwit / Tantivy, an OSS alternative to Elasticsearch / Apache
                Lucene that is cheaper and faster. It didn’t seem that difficult
                to build a cheaper open source SOAR, so we decided to do it.
              </p>
              <p>
                Tracecat is also different as it can run in a single VM /
                laptop. Splunk SOAR and Tines are built for Fortune 10 needs,
                which means expensive Kubernetes clusters. Most security teams
                don’t need that scale, but are forced to pay the K8s “premium”
                (high complexity, hard to maintain). Tracecat uses OSS embedded
                databases (SQLite) and an event processing engine we built using
                Python 3.12 asyncio.
              </p>
              <p>
                So far, we’ve just got a bare-bones alpha but you can already do
                quite a few things with it. e.g. trigger event-driven workflows
                from webhooks; use REST API integrations; parse responses using
                JSONPath; control flow using conditional blocks; store logs
                cheaply in Tantivy; open cases directly from workflows;
                prioritize and manage cases in a Jira-like table.
              </p>
              <p>
                Tracecat uses Pydantic V2 for fast input / output validation and
                Zod for fast form validation. We care a lot about data quality!
                It’s also Apache-2.0 licensed so anyone can self-host the
                platform.
              </p>
              <p>
                On our roadmap: integrations with popular security tools
                (Crowdstrike, Microsoft defender); pre-built workflows (e.g.
                investigating phishing email); better docs; more AI features
                like auto-labeling tickets, extracting data from unstructured
                text etc.
              </p>
              <p>
                We’re still early so would love your feedback and opinions. Feel
                free to try us out or share it with your security friends. We
                have a cloud version up and running:
                <a href="https://platform.tracecat.com"
                  >https://platform.tracecat.com</a
                >.
              </p>
              <p>
                Dear HN readers, we’d love to hear your incident response
                stories and the software you use (or not) to automate the work.
                Stories from security, site reliability engineering, or even
                physical systems like critical infrastructure monitoring are all
                very welcome!
              </p>
            </div>
          </section>
        </section>
        <section id="39819409">
          <h3>
            <a class="item" href="https://johnjago.com/great-docs/"
              >Two open source projects with great architecture documentation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 17:58:56</span
              ><span class="points-container"
                >Points: <span class="points">306</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39819409"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39815936">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/film/2024/mar/25/martin-scorsese-vhs-video-collection-archive"
              >Martin Scorsese's secret life as an obsessive VHS archivist</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 13:20:20</span
              ><span class="points-container"
                >Points: <span class="points">223</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39815936"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39814334">
          <h3>
            <a
              class="item"
              href="https://kaveland.no/friends-dont-let-friends-export-to-csv.html"
              >Friends don't let friends export to CSV</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 09:57:18</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39814334"
                  >Comments</a
                ><span class="descendants">: 347</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39813978">
          <h3>
            <a
              class="item"
              href="https://esoteric.codes/blog/calculating-with-jss-undefined"
              >Computing with JavaScript's Undefined (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 08:52:44</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39813978"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39813724">
          <h3>
            <a
              class="item"
              href="https://blogs.gnome.org/rbultje/2017/07/14/writing-x86-simd-using-x86inc-asm/"
              >Writing x86 SIMD using x86inc.asm (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 08:04:59</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39813724"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39813679">
          <h3>
            <a
              class="item"
              href="https://lcamtuf.substack.com/p/radios-how-do-they-work"
              >Radios, how do they work?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 07:56:09</span
              ><span class="points-container"
                >Points: <span class="points">367</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39813679"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39813626">
          <h3>
            <a
              class="item"
              href="https://jornvernee.github.io/hotspot/jit/2023/08/18/debugging-jit.html"
              >Notes on debugging HotSpot's JIT compilation (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 07:48:34</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39813626"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39800678">
          <h3>
            <a class="item" href="https://visdeurbel.nl/en/the-fish-doorbell/"
              >See a Fish? Ring the Bell</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-23 @ 15:34:51</span
              ><span class="points-container"
                >Points: <span class="points">239</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39800678"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39786874">
          <h3>
            <a
              class="item"
              href="https://nouvelles.umontreal.ca/en/article/2024/03/15/ebola-scientists-reveal-a-new-way-it-replicates/"
              >A new way Ebola replicates</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-22 @ 02:27:03</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39786874"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
