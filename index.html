<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="46953136">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/is-particle-physics-dead-dying-or-just-hard-20260126/"
              >Is particle physics dead, dying, or just hard?</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-09 @ 23:31:15</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46953136"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46952987">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/articles/cddg885344do"
              >The shadowy world of abandoned oil tankers</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-09 @ 23:17:42</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46952987"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46952118">
          <h3>
            <a class="item" href="https://www.chainlift.io/liftkit"
              >LiftKit – UI where "everything derives from the golden ratio"</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-09 @ 22:01:34</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46952118"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46951057">
          <h3>
            <a class="item" href="https://www.noleary.com/blog/posts/1"
              >America has a tungsten problem</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-09 @ 20:49:21</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46951057"
                  >Comments</a
                ><span class="descendants">: 138</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46950915">
          <h3>
            <a
              class="item"
              href="https://truthout.org/articles/super-bowl-ad-for-ring-cameras-touted-ai-surveillance-network/"
              >Super Bowl Ad for Ring Cameras Touted AI Surveillance Network</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-09 @ 20:41:05</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46950915"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46950756">
          <h3>
            <a
              class="item"
              href="https://daeus.blog/2026/01/18/game-theory-patterns-at-work/"
              >Game Theory Patterns at Work (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-09 @ 20:30:10</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46950756"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46950634">
          <h3>
            <a
              class="item"
              href="https://www.promptarmor.com/resources/llm-data-exfiltration-via-url-previews-(with-openclaw-example-and-test)"
              >Data exfil from agents in messaging apps</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-09 @ 20:21:27</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46950634"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46949452">
          <h3>
            <a
              class="item"
              href="https://www.githubstatus.com/incidents/lcw3tg2f6zsd"
              >Another GitHub outage in the same day</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-09 @ 19:07:25</span
              ><span class="points-container"
                >Points: <span class="points">284</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46949452"
                  >Comments</a
                ><span class="descendants">: 210</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46948533">
          <h3>
            <a
              class="item"
              href="https://www.omnara.com/blog/what-is-an-async-agent-really"
              >Everyone’s building “async agents,” but almost no one can define
              them</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-09 @ 18:01:44</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46948533"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46948273">
          <h3>
            <a
              class="item"
              href="https://jsgroth.dev/blog/posts/gba-audio-interpolation/"
              >Game Boy Advance Audio Interpolation</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-09 @ 17:44:10</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46948273"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46947777">
          <h3>
            <a
              class="item"
              href="https://research.google/blog/hard-braking-events-as-indicators-of-road-segment-crash-risk/"
              >Hard-braking events as indicators of road segment crash risk</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-09 @ 17:09:37</span
              ><span class="points-container"
                >Points: <span class="points">228</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46947777"
                  >Comments</a
                ><span class="descendants">: 339</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46947096">
          <h3>
            <a
              class="item"
              href="https://github.com/jim11662418/ESP8266_WiFi_Analog_Clock"
              >Converting a $3.88 analog clock from Walmart into a ESP8266-based
              Wi-Fi clock</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-09 @ 16:26:31</span
              ><span class="points-container"
                >Points: <span class="points">429</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46947096"
                  >Comments</a
                ><span class="descendants">: 146</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46946401">
          <h3>
            <a
              class="item"
              href="https://explainers.blog/posts/why-is-the-sky-blue/"
              >Why is the sky blue?</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-09 @ 15:39:51</span
              ><span class="points-container"
                >Points: <span class="points">437</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46946401"
                  >Comments</a
                ><span class="descendants">: 165</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46946308">
          <h3>
            <a class="item" href="https://neal.fun/sandboxels/">Sandboxels</a>
          </h3>
          <section>
            <h4>
              <span>2026-02-09 @ 15:31:09</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46946308"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46946062">
          <h3>
            <a
              class="item"
              href="https://defusedcyber.com/ivanti-epmm-sleeper-shells-403jsp"
              >Sleeper Shells: Attackers Are Planting Dormant Backdoors in
              Ivanti EPMM</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-09 @ 15:11:07</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46946062"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46945663">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/tech/875309/discord-age-verification-global-roll-out"
              >Discord will require a face scan or ID for full access next
              month</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-09 @ 14:37:38</span
              ><span class="points-container"
                >Points: <span class="points">1367</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46945663"
                  >Comments</a
                ><span class="descendants">: 1357</span></span
              >
            </h4>
            <div class="text">
              <a
                href="https://discord.com/press-releases/discord-launches-teen-by-default-settings-globally"
                >https://discord.com/press-releases/discord-launches-teen-by-...</a
              >
              <p>
                <a
                  href="https://discord.com/safety/how-discord-is-building-safer-experiences-for-teens"
                  >https://discord.com/safety/how-discord-is-building-safer-exp...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="46945348">
          <h3>
            <a class="item" href="https://codeberg.org/smnx/promethee"
              >UEFI Bindings for JavaScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-09 @ 14:07:36</span
              ><span class="points-container"
                >Points: <span class="points">204</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46945348"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46945235">
          <h3>
            <a
              class="item"
              href="https://wingolog.org/archives/2026/02/09/six-thoughts-on-generating-c"
              >Thoughts on Generating C</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-09 @ 13:54:48</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46945235"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46943568">
          <h3>
            <a class="item" href="https://alltheviews.world"
              >Show HN: Algorithmically finding the longest line of sight on
              Earth</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-09 @ 10:05:55</span
              ><span class="points-container"
                >Points: <span class="points">382</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46943568"
                  >Comments</a
                ><span class="descendants">: 156</span></span
              >
            </h4>
            <div class="text">
              <p>
                We go into all the details at
                <a href="https://alltheviews.world"
                  >https://alltheviews.world</a
                >
              </p>
              <p>
                And there's an interactive map with over 1 billion longest
                lines, covering the whole world at
                <a href="https://map.alltheviews.world"
                  >https://map.alltheviews.world</a
                >
                Just click on any point and it'll load its longest line of
                sight.
              </p>
              <p>
                Some of you may remember Tom's post[1] from a few months ago
                about how to efficiently pack visibility tiles for computing the
                entire planet. Well now it's done. The compute run itself took
                100s of AMD Turin cores, 100s of GBs of RAM, a few TBs of disk
                and 2 days of constant runtime on multiple machines.
              </p>
              <p>
                If you are interested in the technical details, Ryan and I have
                written extensively about the algorithm and pipeline that got us
                here:
              </p>
              <p>
                * Tom's blog post:
                <a href="https://tombh.co.uk/longest-line-of-sight"
                  >https://tombh.co.uk/longest-line-of-sight</a
                >
              </p>
              <p>
                * Ryan's technical breakdown:
                <a href="https://ryan.berge.rs/posts/total-viewshed-algorithm"
                  >https://ryan.berge.rs/posts/total-viewshed-algorithm</a
                >
              </p>
              <p>
                This was a labor of love and we hope it inspires you both
                technically and naturally, to get you out seeing some of these
                vast views for yourselves!
              </p>
              <p>
                1.
                <a href="https://news.ycombinator.com/item?id=45485227"
                  >https://news.ycombinator.com/item?id=45485227</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="46937696">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=46937696"
              >Ask HN: What are you working on? (February 2026)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-08 @ 19:35:55</span
              ><span class="points-container"
                >Points: <span class="points">264</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46937696"
                  >Comments</a
                ><span class="descendants">: 897</span></span
              >
            </h4>
            <div class="text">
              What are you working on? Any new ideas that you're thinking about?
            </div>
          </section>
        </section>
        <section id="46933955">
          <h3>
            <a class="item" href="https://znah.net/graphs/"
              >Like Game-of-Life, but on Growing Graphs, with WASM and WebGL</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-08 @ 13:18:37</span
              ><span class="points-container"
                >Points: <span class="points">180</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46933955"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46901560">
          <h3>
            <a
              class="item"
              href="https://medium.com/@codythistleward/stop-using-icons-in-data-tables-7537af18ea0d"
              >Stop Using Icons in Data Tables</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-05 @ 16:42:55</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46901560"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46900796">
          <h3>
            <a
              class="item"
              href="https://github.com/villagesql/villagesql-server"
              >Show HN: VillageSQL = MySQL and Extensions</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-05 @ 15:35:28</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46900796"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <p>
                Look, MySQL is awesome [flamewar incoming?]. But the ecosystem
                has stagnated. Why?
              </p>
              <p>
                No permissionless innovation. Postgres has flourished because
                people can change the core of the database (look at pgvector and
                pg_textsearch), without having to get their changes accepted
                upstream.
              </p>
              <p>
                (This, btw, is what powered GitHub's early success: you can fork
                a repo and make changes without needing the owners' approval)
              </p>
              <p>
                VillageSQL is a tracking fork of MySQL (open source, ofc) that
                adds an extension framework: * Drop-in replacement
              </p>
              <p>
                * Add custom data types and functions (with indexes coming soon)
              </p>
              <p>
                * we wrote example extensions (vsql-ai, -uuid, crypto, etc.)
              </p>
              <p>* you have a better idea for an extension</p>
              <p>
                * my CEO submitted a Show HN post but linked to the announcement
                blog; help me show him hackers want code first
              </p>
              <p>
                * I'm particularly proud of the friendly C++ API to add custom
                functions (in func_builder.h)
              </p>
              <p>
                That link again is
                <a href="https://github.com/villagesql/villagesql-server"
                  >https://github.com/villagesql/villagesql-server</a
                >
              </p>
              <p>
                (Oh, and I get to work with the former TL of Google's BigTable
                and Colossus, so we care about doing databases Right)
              </p>
            </div>
          </section>
        </section>
        <section id="46900472">
          <h3>
            <a
              class="item"
              href="https://github.com/jnidzwetzki/pg-dev-container"
              >Pg-dev-container is a ready-to-run VS Code development container
              for PostgreSQL</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-05 @ 15:09:45</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46900472"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46898840">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/expansion-microscopy-has-transformed-how-we-see-the-cellular-world-20260204/"
              >Expansion Microscopy Has Transformed How We See the Cellular
              World</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-05 @ 12:18:59</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46898840"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46897804">
          <h3>
            <a
              class="item"
              href="https://quomodocumque.wordpress.com/2026/02/03/whats-the-entropy-of-a-random-integer/"
              >What's the Entropy of a Random Integer?</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-05 @ 09:47:53</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46897804"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46895089">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/articles/traffic-mimes-of-colombia"
              >The Traffic Mimes of Bogotá</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-05 @ 02:58:50</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46895089"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46890174">
          <h3>
            <a
              class="item"
              href="https://devblogs.microsoft.com/dotnet/introducing-fsharp-10/"
              >F# 10</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-04 @ 19:06:18</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46890174"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46878373">
          <h3>
            <a class="item" href="https://www.benkuhn.net/pjm/"
              >How I've run major projects (2025)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-03 @ 22:38:21</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46878373"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46877291">
          <h3>
            <a class="item" href="https://informationisbeautiful.net/"
              >Information Is Beautiful</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-03 @ 21:05:42</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46877291"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2026/index.md"
              >2026</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
