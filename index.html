<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38685782">
          <h3>
            <a
              class="item"
              href="https://madattheinternet.substack.com/p/a-handful-of-companies-rule-the-internet"
              >A Handful of Companies Rule the Internet with DDoS Mitigation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 17:49:55</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38685782"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38685607">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2023/12/18/nikola-founder-trevor-milton-sentencing-fraud-charges.html"
              >Nikola founder to be sentenced for federal fraud charges</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 17:38:06</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38685607"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38685598">
          <h3>
            <a
              class="item"
              href="https://flipboard.medium.com/flipboard-begins-to-federate-c56ec788feaa"
              >Flipboard Begins to Federate</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 17:37:47</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38685598"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38685458">
          <h3>
            <a
              class="item"
              href="https://research.unc.edu/2023/12/12/carolina-chemists-discover-eight-new-pfas-with-novel-testing-method/"
              >Carolina chemists discover eight new PFAS with novel testing
              method</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 17:27:20</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38685458"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38685393">
          <h3>
            <a class="item" href="https://fly.io/blog/fks/">Fly Kubernetes</a>
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 17:21:34</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38685393"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38685239">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/pumped-water-energy-storage"
              >Desalination Can Beat Out Batteries for Excess Energy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 17:11:00</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38685239"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38685101">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=38685101"
              >Show HN: DanswerChat – open-source GPTs with access to your org's
              knowledge</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 17:02:00</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38685101"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <p>
                Demo video:
                <a href="https://www.youtube.com/watch?v=6cDiv-TShh4"
                  >https://www.youtube.com/watch?v=6cDiv-TShh4</a
                >
              </p>
              <p>
                Code here:
                <a href="https://github.com/danswer-ai/danswer"
                  >https://github.com/danswer-ai/danswer</a
                >
              </p>
              <p>
                Setup docs:
                <a href="https://docs.danswer.dev/quickstart"
                  >https://docs.danswer.dev/quickstart</a
                >
              </p>
              <p>
                Danswer is self-hostable and comes ready to use out of the box
                with a UI, admin features, 20+ auto-syncing connectors, and
                user/access management. All your data is persisted on-prem and
                you can easily customize it to hook up to any LLM provider of
                your choice (though we recommend GPT-4 for best results).
              </p>
              <p>
                As you ask questions, the system runs retrieval as needed to
                fetch relevant documents and uses GenAI to help you find the
                answers you’re seeking. You can also select specific documents
                to chat with at any point and deselect them when you want the
                system to run more retrievals. You can further refine your
                search by applying time and source type filters.
              </p>
              <p>
                With Danswer you can also create document-sets for specific use
                cases. You can easily group together knowledge for different
                purposes like onboarding, HR answers, team specific knowledge,
                finance, etc. You can combine different sources at different
                granularities such as creating a document-set which is a
                combination of Slack channels + some set of Google Drive Folders
                + some workspaces from Confluence, etc. You get the picture.
              </p>
              <p>
                Finally, just like GPTs, you can configure custom prompts and
                create different assistants for varied tasks like debugging,
                summarizing, generating content, all while pulling in the
                context documents you want to include. Out of the box, Danswer
                comes with several pre-configured general use assistants.
              </p>
              <p>
                You can use Danswer to improve your operational efficiencies for
                any team that needs it. We’ve seen users use it for onboarding,
                customer support, cross-team communications, sales-call prep,
                and as an engineering assistant.
              </p>
              <p>
                We also have a Slack (<a
                  href="https://join.slack.com/t/danswer/shared_invite/zt-1u3h3ke3b-VGh1idW19R8oiNRiKBYv2w"
                  >https://join.slack.com/t/danswer/shared_invite/zt-1u3h3ke3b-...</a
                >) and a Discord (<a href="https://discord.gg/TDJ59cGV2X"
                  >https://discord.gg/TDJ59cGV2X</a
                >) community. Always looking forward to user feedback as this
                helps us improve our software! See you there :)
              </p>
            </div>
          </section>
        </section>
        <section id="38684925">
          <h3>
            <a class="item" href="https://openreview.net/forum?id=idpCdOWtqXd60"
              >Word2Vec Received 'Strong Reject' Four Times at ICLR2013</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 16:48:38</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38684925"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38684447">
          <h3>
            <a
              class="item"
              href="https://www.thenile.dev/blog/transaction-isolation-postgres"
              >Transaction Isolation in Postgres</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 16:13:46</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38684447"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38684368">
          <h3>
            <a class="item" href="https://pagedout.institute/?page=issues.php"
              >Paged Out Issue #3</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 16:09:01</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38684368"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38684102">
          <h3>
            <a
              class="item"
              href="https://lwn.net/SubscriberLink/954787/41470c731eda02a4/"
              >Progress toward a GCC-based Rust compiler</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 15:51:06</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38684102"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38683852">
          <h3>
            <a class="item" href="https://mtlynch.io/notes/zig-unit-test-c/"
              >Using Zig to Unit Test a C Application</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 15:36:03</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38683852"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38683493">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/2023/12/18/investing/us-steel-nippon-steel-deal/index.html"
              >US Steel, once the largest corporation, agrees to sell to Nippon
              Steel</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 15:12:15</span
              ><span class="points-container"
                >Points: <span class="points">153</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38683493"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38683256">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Send_Me_To_Heaven"
              >Send Me to Heaven</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 14:51:26</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38683256"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38682964">
          <h3>
            <a class="item" href="https://github.com/thingsboard/tbmq"
              >New scalable, fault-tolerant, and efficient open-source MQTT
              broker</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 14:28:56</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38682964"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38682931">
          <h3>
            <a
              class="item"
              href="https://ericnormand.me/article/church-vs-curry-types"
              >Church vs. Curry Types</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 14:25:53</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38682931"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38682623">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/2023/12/17/business/greyhound-buses-transportation-cities/index.html"
              >Greyhound bus stops are valuable assets</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 14:02:53</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38682623"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38681861">
          <h3>
            <a
              class="item"
              href="https://www.figma.com/blog/figma-adobe-abandon-proposed-merger/"
              >Figma and Adobe abandon proposed merger</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 13:04:34</span
              ><span class="points-container"
                >Points: <span class="points">1244</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38681861"
                  >Comments</a
                ><span class="descendants">: 646</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38681672">
          <h3>
            <a class="item" href="https://github.com/wasm3/wasm3"
              >Wasm3 entering a minimal maintenance phase</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 12:43:38</span
              ><span class="points-container"
                >Points: <span class="points">393</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38681672"
                  >Comments</a
                ><span class="descendants">: 96</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38681468">
          <h3>
            <a class="item" href="https://www.bl.uk/"
              >The British Library URL has been offline due to cyberattack for
              10 days</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 12:10:22</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38681468"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38681463">
          <h3>
            <a
              class="item"
              href="https://servo.org/blog/2023/12/18/this-year-in-servo/"
              >This year in Servo: over 1000 pull requests and beyond</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 12:09:48</span
              ><span class="points-container"
                >Points: <span class="points">198</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38681463"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38681437">
          <h3>
            <a class="item" href="https://potato.cheap">The "Cheap" Web</a>
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 12:06:07</span
              ><span class="points-container"
                >Points: <span class="points">185</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38681437"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38681115">
          <h3>
            <a class="item" href="https://antonz.org/code-cells/"
              >Interactive Code Cells</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 11:00:57</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38681115"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38679453">
          <h3>
            <a class="item" href="https://github.com/aymenfurter/microagents"
              >Show HN: Microagents: Agents capable of self-editing their
              prompts / Python code</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 05:13:39</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38679453"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38672133">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41467-023-37752-x"
              >Trumpet is an operating system for simple and robust cell-free
              biocomputing</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-17 @ 11:27:48</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38672133"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38672112">
          <h3>
            <a class="item" href="https://www.ventoy.net/en/index.html"
              >Ventoy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-17 @ 11:23:45</span
              ><span class="points-container"
                >Points: <span class="points">202</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38672112"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38671709">
          <h3>
            <a class="item" href="https://github.com/gilch/hissp">Hissp</a>
          </h3>
          <section>
            <h4>
              <span>2023-12-17 @ 09:54:32</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38671709"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38671540">
          <h3>
            <a
              class="item"
              href="https://nevadamagazine.com/issue/september-october-2019/11423/"
              >M Cave and the Unexplained Disappearance of Kenny Veach (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-17 @ 09:21:18</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38671540"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38671283">
          <h3>
            <a
              class="item"
              href="https://ntrs.nasa.gov/api/citations/19720005243/downloads/19720005243.pdf"
              >What made Apollo a success? (1971) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-17 @ 08:30:52</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38671283"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38662088">
          <h3>
            <a class="item" href="https://xlights.org/"
              >XLights – open source light sequencer and show scheduler</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 05:59:35</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38662088"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
