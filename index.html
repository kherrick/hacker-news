<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44126518">
          <h3>
            <a
              class="item"
              href="https://www.historytoday.com/archive/making-history/medieval-fogge-defence-middle-ages"
              >Medieval Fogge: In Defence of the Middle Ages</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 14:33:43</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44126518"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44126214">
          <h3>
            <a
              class="item"
              href="https://gygaxtest.com/posts/continued_pretraining_for-rules/"
              >Domain Adaptation of Base Models + ShadowdarkQA Bench</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 13:59:17</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44126214"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44125966">
          <h3>
            <a class="item" href="https://alloc.dev/2025/05/29/learning_c3"
              >Learning C3</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 13:33:31</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44125966"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44124808">
          <h3>
            <a class="item" href="https://tiki.li/apps/tut_learn.html?v=2505e"
              >Simple programming language with offline usable browser IDE</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 11:04:21</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44124808"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44124652">
          <h3>
            <a class="item" href="https://staying.fun/en"
              >Show HN: I made a Zero-config tool to visualize your code</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 10:29:31</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44124652"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
            <div class="text">
              I built Staying – a tool that instantly turns your code into
              interactive animations with no setup required. Just write or paste
              your code and hit "Visualize". No installs, no accounts, no
              configuration. *Supports*: Python, JavaScript &amp;amp;
              experimental C++
            </div>
          </section>
        </section>
        <section id="44123953">
          <h3>
            <a class="item" href="https://github.com/kahole/edamagit"
              >Edamagit: Magit for VSCode</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 07:58:55</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44123953"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44123852">
          <h3>
            <a class="item" href="https://cybercultural.com/p/web-design-1997/"
              >Gurus of 90s Web Design: Zeldman, Siegel, Nielsen</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 07:33:02</span
              ><span class="points-container"
                >Points: <span class="points">229</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44123852"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44123486">
          <h3>
            <a
              class="item"
              href="https://www.historytoday.com/archive/feature/maid-who-restored-charles-ii"
              >The Maid Who Restored Charles II</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 05:58:07</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44123486"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44123474">
          <h3>
            <a
              class="item"
              href="https://www.metropolitanreview.org/p/the-art-of-the-critic"
              >The Art of the Critic</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 05:55:12</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44123474"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44123289">
          <h3>
            <a class="item" href="https://github.com/rsyncOSX/RsyncUI"
              >RSyncUI – A SwiftUI based macOS GUI for rsync</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 05:05:43</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44123289"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44123098">
          <h3>
            <a class="item" href="https://github.com/livingbio/typed-ffmpeg"
              >Show HN: Typed-FFmpeg 3.0–Typed Interface to FFmpeg and Visual
              Filter Editor</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 04:23:11</span
              ><span class="points-container"
                >Points: <span class="points">259</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44123098"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
            <div class="text">
              <p>
                I built typed-ffmpeg, a Python package that lets you build
                FFmpeg filter graphs with full type safety, autocomplete, and
                validation. It’s inspired by ffmpeg-python, but addresses some
                long-standing issues like lack of IDE support and fragile CLI
                strings.
              </p>
              <p>
                What’s New in v3.0: • Source filter support (e.g. color,
                testsrc, etc.) • Input stream selection (e.g. [0:a], [1:v]) • A
                new interactive playground where you can: • Build filter graphs
                visually • Generate both FFmpeg CLI and typed Python code •
                Paste existing FFmpeg commands and reverse-parse them into
                graphs
              </p>
              <p>
                Playground link:
                <a href="https://livingbio.github.io/typed-ffmpeg-playground/"
                  >https://livingbio.github.io/typed-ffmpeg-playground/</a
                >
                (It’s open source and runs fully in-browser.)
              </p>
              <p>
                The internal core also supports converting CLI → graph → typed
                Python code. This is useful for building educational tools,
                FFmpeg IDEs, or visual editors.
              </p>
              <p>
                I’d love feedback, bug reports, or ideas for next steps. If
                you’ve ever struggled with FFmpeg’s CLI or tried to teach it,
                this might help.
              </p>
              <p>Thanks! — David (maintainer)</p>
            </div>
          </section>
        </section>
        <section id="44122582">
          <h3>
            <a
              class="item"
              href="https://devblogs.microsoft.com/dotnet/announcing-dotnet-run-app/"
              >Run a C# file directly using dotnet run app.cs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-29 @ 02:30:28</span
              ><span class="points-container"
                >Points: <span class="points">203</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44122582"
                  >Comments</a
                ><span class="descendants">: 168</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44121177">
          <h3>
            <a class="item" href="https://www.mooncake.dev/blog/htap-is-dead"
              >HTAP is Dead</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-28 @ 22:22:18</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44121177"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44120507">
          <h3>
            <a
              class="item"
              href="https://milwaukeerecord.com/city-life/long-live-american-science-surplus-which-needs-your-help/"
              >Long live American Science and Surplus</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-28 @ 20:47:30</span
              ><span class="points-container"
                >Points: <span class="points">335</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44120507"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44120241">
          <h3>
            <a
              class="item"
              href="https://prettygoodblog.com/p/what-threads-are-part-2"
              >A toy RTOS inside Super Mario Bros. using emulator save states</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-28 @ 20:15:43</span
              ><span class="points-container"
                >Points: <span class="points">229</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44120241"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
            <div class="text">
              <p>Essentially, this is:</p>
              <p>- A rudimentary preemptive RTOS</p>
              <p>- Using an unmodified NES emulator (FCEUX) as the CPU</p>
              <p></p>
              <pre><code>    - "Unmodified" depending on how you define terms
</code></pre>
              - With emulator save states as the thread contexts
              <p>
                - With support for (very basic) mutexes, interrupt masking, and
                condition variables
              </p>
              <p>
                - Demonstrated using Super Mario Bros. 1-1 with sections of the
                map dedicated to various synchronization primitives
              </p>
              <p>
                There are many simplifications and shortcuts taken (doesn't even
                have task priorities), and it doesn't map 1:1 to true
                multithreading (e.g., emulator save states represent the state
                of the entire machine including RAM, whereas thread contexts
                represent a much more minimal slice), but I think it's A) pretty
                interesting and B) a unique visceral explanation of threads.
              </p>
            </div>
          </section>
        </section>
        <section id="44119890">
          <h3>
            <a
              class="item"
              href="https://buttondown.com/hillelwayne/archive/what-does-undecidable-mean-anyway/"
              >What does “Undecidable” mean, anyway</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-28 @ 19:37:47</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44119890"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44118373">
          <h3>
            <a class="item" href="https://slightknack.dev/blog/difflogic/"
              >Compiling a neural net to C for a speedup</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-28 @ 17:22:47</span
              ><span class="points-container"
                >Points: <span class="points">267</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44118373"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44117779">
          <h3>
            <a
              class="item"
              href="https://www.japantimes.co.jp/business/2025/05/27/companies/japan-post-digital-address/"
              >Japan Post launches 'digital address' system</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-28 @ 16:33:49</span
              ><span class="points-container"
                >Points: <span class="points">380</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44117779"
                  >Comments</a
                ><span class="descendants">: 250</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44117722">
          <h3>
            <a
              class="item"
              href="https://xania.org/202505/compiler-explorer-urls-forever"
              >Compiler Explorer and the promise of URLs that last forever</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-28 @ 16:28:20</span
              ><span class="points-container"
                >Points: <span class="points">322</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44117722"
                  >Comments</a
                ><span class="descendants">: 157</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44114982">
          <h3>
            <a
              class="item"
              href="https://goodinternetmagazine.com/my-website-is-ugly-because-i-made-it/"
              >My website is ugly because I made it</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-28 @ 11:53:47</span
              ><span class="points-container"
                >Points: <span class="points">202</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44114982"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44112686">
          <h3>
            <a
              class="item"
              href="https://ericneyman.wordpress.com/2025/03/24/will-jesus-christ-return-in-an-election-year/"
              >The Polymarket users betting that Jesus will return this year</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-28 @ 04:13:00</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44112686"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44112149">
          <h3>
            <a
              class="item"
              href="https://www.sciencedaily.com/releases/2025/05/250521125055.htm"
              >High-quality OLED displays now enabling integrated thin and
              multichannel audio</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-28 @ 01:53:43</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44112149"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44111236">
          <h3>
            <a class="item" href="https://github.com/elliott-diy/Weather2Geo"
              >Show HN: Weather2Geo – Geolocate screenshots from weather
              widgets</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-27 @ 22:31:17</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44111236"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <p>
                I built an OSINT tool called Weather2Geo that helps locate where
                a screenshot was taken based on the weather widget data visible
                (e.g. temp, condition, and local time in the taskbar). People
                often post these without realizing how specific those values can
                be in combination.
              </p>
              <p>
                It works by comparing the given weather condition, temperature,
                and time against current data from thousands of cities. It’s
                timezone-aware, supports fuzzy matching, and groups results
                geographically to reduce noise.
              </p>
              <p>
                It’s most effective on recent screenshots, ideally taken within
                the last hour—since weather and daylight conditions change
                quickly.
              </p>
              <p>
                The tool helps pinpoint likely locations when screenshots lack
                EXIF data or other traditional OSINT clues.
              </p>
              <p>
                It’s open source here:
                <a href="https://github.com/elliott-diy/Weather2Geo"
                  >https://github.com/elliott-diy/Weather2Geo</a
                >
              </p>
              <p>
                Would love feedback, bug reports, or to hear if you think this
                has other use cases.
              </p>
              <p>- Elliott</p>
            </div>
          </section>
        </section>
        <section id="44106285">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2025-05-year-chimpanzees-stones-trees-communication.html"
              >Chimps strike stones against trees as communication, study
              suggests</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-27 @ 12:29:12</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44106285"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44102712">
          <h3>
            <a class="item" href="https://www.nasa.gov/history/alsj/"
              >Apollo Lunar Surface Journal</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-26 @ 23:49:11</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44102712"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44101175">
          <h3>
            <a class="item" href="https://velzie.rip/blog/celeste-wasm"
              >Show HN: Porting Terraria and Celeste to WebAssembly</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-26 @ 20:06:25</span
              ><span class="points-container"
                >Points: <span class="points">270</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44101175"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44099591">
          <h3>
            <a
              class="item"
              href="https://www.ft.com/content/3a64f96e-3214-48ba-9da4-76b3fb7ab8c1"
              >Walkers' Sensations Poppadoms vs. HMRC: The Chip of Theseus</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-26 @ 17:33:16</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44099591"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44097362">
          <h3>
            <a
              class="item"
              href="https://susam.net/from-finite-integral-domains-to-finite-fields.html"
              >From Finite Integral Domains to Finite Fields</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-26 @ 13:43:45</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44097362"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44087809">
          <h3>
            <a
              class="item"
              href="https://writings.stephenwolfram.com/2025/05/what-if-we-had-bigger-brains-imagining-minds-beyond-ours/"
              >What If We Had Bigger Brains? Imagining Minds Beyond Ours</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-25 @ 13:46:56</span
              ><span class="points-container"
                >Points: <span class="points">171</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44087809"
                  >Comments</a
                ><span class="descendants">: 199</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44086429">
          <h3>
            <a class="item" href="https://firedbg.sea-ql.org/"
              >Visualize and debug Rust programs with a new lens</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-25 @ 08:33:46</span
              ><span class="points-container"
                >Points: <span class="points">199</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44086429"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
