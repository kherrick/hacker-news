<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44647609">
          <h3>
            <a
              class="item"
              href="https://shkspr.mobi/blog/2025/07/1kb-js-numbers-station/"
              >1KB JavaScript Numbers Station</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-22 @ 14:47:54</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44647609"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44647489">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2025/07/22/trump_shoots_climate_messenger/"
              >Killing the Mauna Loa observatory over irrefutable evidence of
              increasing CO2</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-22 @ 14:40:28</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44647489"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44647190">
          <h3>
            <a
              class="item"
              href="https://www.anthes.is/font-comparison-review-atkinson-hyperlegible-mono.html"
              >Font Comparison: Atkinson Hyperlegible Mono vs. JetBrains Mono
              and Fira Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-22 @ 14:17:05</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44647190"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44647112">
          <h3>
            <a
              class="item"
              href="https://www.state.gov/releases/office-of-the-spokesperson/2025/07/the-united-states-withdraws-from-the-united-nations-educational-scientific-and-cultural-organization-unesco"
              >The United States Withdraws from UNESCO</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-22 @ 14:09:49</span
              ><span class="points-container"
                >Points: <span class="points">306</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44647112"
                  >Comments</a
                ><span class="descendants">: 274</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44646925">
          <h3>
            <a
              class="item"
              href="https://security.googleblog.com/2025/07/introducing-oss-rebuild-open-source.html"
              >OSS Rebuild: open-source, Rebuilt to Last</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-22 @ 13:53:46</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44646925"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44646901">
          <h3>
            <a class="item" href="https://github.com/pmarreck/yt-transcriber"
              >Yt-transcriber – Give a YouTube URL and get a transcription</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-22 @ 13:51:21</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44646901"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44646869">
          <h3>
            <a class="item" href="https://daisyui.com/"
              >DaisyUI: Tailwind CSS Components</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-22 @ 13:48:55</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44646869"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44646780">
          <h3>
            <a class="item" href="https://shafq.at/my-gpu-fan-saga.html"
              >Show HN: My GPU Fan Saga – A DIY ATX Fan Controller</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-22 @ 13:41:21</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44646780"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44646707">
          <h3>
            <a
              class="item"
              href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=5259763"
              >The Role of Blood Plasma Donation Centers in Crime Reduction</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-22 @ 13:35:24</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44646707"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44646356">
          <h3>
            <a
              class="item"
              href="https://blog.florianherrengt.com/vibe-coder-career-path.html"
              >The vibe coder's career path is doomed</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-22 @ 13:02:13</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44646356"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44646065">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2025-07-french-petition-bee-pesticide-1mn.html"
              >French petition against return of bee-killing pesticide passes
              1M</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-22 @ 12:31:11</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44646065"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44645846">
          <h3>
            <a class="item" href="https://themagicofcode.com/sample/"
              >Show HN: The Magic of Code – book about the wonders and weirdness
              of computation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-22 @ 12:05:44</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44645846"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
            <div class="text">
              <p>
                Right now there is so much worry and concern around technology
                that I feel like some people—though not the folks here—have
                forgotten how much fun that code and computation can also be. So
                I wanted to rekindle some of that sense of wonder.
              </p>
              <p>
                But, as I’ve written elsewhere, this is also the kind of book I
                wish I had when I was younger and getting interested in
                computers. I’ve always enjoyed the kinds of writing that talks
                about computing but in the context of so many other big ideas,
                especially ones I’ve explored at various points in my own life,
                from evolution to simulation. And that’s what I tried to do.
              </p>
              <p>
                But while “The Magic of Code” is certainly for a wide audience,
                and for people who are unfamiliar with programming and code,
                I’ve also (hopefully!) designed it to be of interest to those
                who are more expert in this realm, with lots of rabbit holes and
                strange ideas to pursue. And if there exists a genre of book to
                explain to outsiders why you love a topic, this is in that
                genre, for computing and code. I think the HN community will
                really enjoy it.
              </p>
            </div>
          </section>
        </section>
        <section id="44645353">
          <h3>
            <a class="item" href="https://kau.sh/blog/how-to-firefox/"
              >How to Firefox</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-22 @ 10:51:30</span
              ><span class="points-container"
                >Points: <span class="points">460</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44645353"
                  >Comments</a
                ><span class="descendants">: 262</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44644404">
          <h3>
            <a
              class="item"
              href="https://ritza.co/articles/migrate-from-openai-to-cerebrium-with-vllm-for-predictable-inference/"
              >How to Migrate from OpenAI to Cerebrium for Cost-Predictable AI
              Inference</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-22 @ 08:08:37</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44644404"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44643981">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/kapa-ai/jobs/JPE2ofG-software-engineer-full-stack"
              >Kapa.ai (YC S23) is hiring a software engineers (EU remote)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-22 @ 07:00:35</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44643564">
          <h3>
            <a
              class="item"
              href="https://github.com/openai/whisper/discussions/2608"
              >Complete silence is always hallucinated as "ترجمة نانسي قنقر" in
              Arabic</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-22 @ 05:42:10</span
              ><span class="points-container"
                >Points: <span class="points">465</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44643564"
                  >Comments</a
                ><span class="descendants">: 233</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44641961">
          <h3>
            <a
              class="item"
              href="https://maddie.wtf/posts/2025-07-21-jujutsu-for-busy-devs"
              >Jujutsu for busy devs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-22 @ 00:21:48</span
              ><span class="points-container"
                >Points: <span class="points">302</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44641961"
                  >Comments</a
                ><span class="descendants">: 392</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44641521">
          <h3>
            <a
              class="item"
              href="https://docs.astral.sh/uv/guides/scripts/#running-a-script-with-dependencies"
              >Uv: Running a script with dependencies</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-21 @ 23:26:40</span
              ><span class="points-container"
                >Points: <span class="points">444</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44641521"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44638580">
          <h3>
            <a
              class="item"
              href="https://www.lumafield.com/article/what-went-wrong-inside-these-recalled-power-banks"
              >What went wrong inside recalled Anker PowerCore 10000 power
              banks?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-21 @ 18:22:11</span
              ><span class="points-container"
                >Points: <span class="points">471</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44638580"
                  >Comments</a
                ><span class="descendants">: 240</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44637715">
          <h3>
            <a class="item" href="https://www.morphik.ai/blog/stop-parsing-docs"
              >Don't bother parsing: Just use images for RAG</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-21 @ 17:16:41</span
              ><span class="points-container"
                >Points: <span class="points">307</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44637715"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44637352">
          <h3>
            <a class="item" href="https://accounting.penrose.com/"
              >AccountingBench: Evaluating LLMs on real long-horizon business
              tasks</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-21 @ 16:48:28</span
              ><span class="points-container"
                >Points: <span class="points">509</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44637352"
                  >Comments</a
                ><span class="descendants">: 140</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44635808">
          <h3>
            <a class="item" href="https://github.com/KrishKrosh/TrackWeight"
              >TrackWeight: Turn your MacBook's trackpad into a digital weighing
              scale</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-21 @ 14:51:13</span
              ><span class="points-container"
                >Points: <span class="points">586</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44635808"
                  >Comments</a
                ><span class="descendants">: 141</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44629710">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/technology/2025/07/20/microsoft-sharepoint-hack/"
              >Global hack on Microsoft Sharepoint hits U.S., state agencies,
              researchers say</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-20 @ 21:58:06</span
              ><span class="points-container"
                >Points: <span class="points">743</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44629710"
                  >Comments</a
                ><span class="descendants">: 387</span></span
              >
            </h4>
            <div class="text">
              <a href="https://archive.ph/Ym2jZ">https://archive.ph/Ym2jZ</a>,
              <a
                href="https://web.archive.org/web/20250721135933/https://www.washingtonpost.com/technology/2025/07/20/microsoft-sharepoint-hack/"
                >https://web.archive.org/web/20250721135933/https://www.washi...</a
              >
              <p>
                <a href="https://research.eye.security/sharepoint-under-siege/"
                  >https://research.eye.security/sharepoint-under-siege/</a
                >
              </p>
              <p>
                <a
                  href="https://krebsonsecurity.com/2025/07/microsoft-fix-targets-attacks-on-sharepoint-zero-day/"
                  >https://krebsonsecurity.com/2025/07/microsoft-fix-targets-at...</a
                >
              </p>
              <p>
                <a
                  href="https://www.bleepingcomputer.com/news/microsoft/microsoft-releases-emergency-patches-for-sharepoint-rce-flaws-exploited-in-attacks/"
                  >https://www.bleepingcomputer.com/news/microsoft/microsoft-re...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="44616158">
          <h3>
            <a
              class="item"
              href="https://codeblog.jonskeet.uk/2025/07/19/unexpected-inconsistency-in-records/"
              >Unexpected inconsistency in records</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-19 @ 15:12:04</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44616158"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44615033">
          <h3>
            <a
              class="item"
              href="https://www.nasa.gov/image-article/nasas-x-59-quiet-supersonic-aircraft-begins-taxi-tests/"
              >Nasa’s X-59 quiet supersonic aircraft begins taxi tests</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-19 @ 12:41:15</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44615033"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44614837">
          <h3>
            <a
              class="item"
              href="https://www.usenix.org/conference/woot24/presentation/motallebighomi"
              >MakeShift: Security Analysis of Shimano Di2 Wireless Gear
              Shifting in Bicycles</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-19 @ 12:08:40</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44614837"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44613791">
          <h3>
            <a
              class="item"
              href="https://medium.com/@eyal.itkin/the-a-file-is-a-relic-why-static-archives-were-a-bad-idea-all-along-8cd1cf6310c5"
              >The .a file is a relic: Why static archives were a bad idea all
              along</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-19 @ 08:59:59</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44613791"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44609154">
          <h3>
            <a
              class="item"
              href="https://apnews.com/article/mars-rock-meteorite-auction-dinosaur-sothebys-01d7ccfc8dc580ad86f8e97a305fc8fa"
              >Largest piece of Mars on Earth fetches $5.3M at auction</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-18 @ 20:01:22</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44609154"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44604024">
          <h3>
            <a class="item" href="https://lwn.net/Articles/1027814/"
              >Python audio processing with pedalboard</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-18 @ 12:36:40</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44604024"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44602609">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2025-07-18/what-scientists-learned-scanning-the-bodies-of-100-000-brits"
              >An unprecedented window into how diseases take hold years before
              symptoms appear</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-18 @ 08:55:56</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44602609"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
            <div class="text">
              <a href="https://archive.md/0Fg1E">https://archive.md/0Fg1E</a>
            </div>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
