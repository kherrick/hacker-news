<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="35865855">
          <h3>
            <a
              class="item"
              href="https://electronics360.globalspec.com/article/11940/dutch-town-becomes-first-to-install-bat-friendly-red-led-street-lights"
              >Dutch Town Becomes First to Install Bat-Friendly Red LED Street
              Lights (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 19:18:20</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35865855"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35865712">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/world/2023/may/07/vietnam-records-highest-ever-temperature-of-441c"
              >Vietnam records highest ever temperature of 44.1C</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 19:03:20</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35865712"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35865678">
          <h3>
            <a
              class="item"
              href="https://www.minecraft.net/en-us/article/account-migration-last-call"
              >Last Call to Migrate Mojang Accounts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 19:00:32</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35865678"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35865257">
          <h3>
            <a
              class="item"
              href="https://www.thearchaeologist.org/blog/long-before-modern-humans-existed-100000-years-ago-neanderthals-built-boats-and-went-sailing"
              >Evidence that the Neanderthals were the first seafarers?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 18:28:56</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35865257"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35865010">
          <h3>
            <a
              class="item"
              href="https://incisive.vc/2022/12/23/fundraising-stages-defined-angel-pre-seed-seed-series-a/"
              >Fundraising Stages</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 18:10:06</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35865010"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35864698">
          <h3>
            <a
              class="item"
              href="https://sudoapps.substack.com/p/giving-gpt-infinite-knowledge"
              >Giving GPT “Infinite” Knowledge</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 17:48:28</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35864698"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35864661">
          <h3>
            <a class="item" href="https://cptn.io"
              >Show HN: Cptn.io – open-source integration platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 17:45:50</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35864661"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
            <div class="text">
              <a href="https://cptn.io">https://cptn.io</a>). The product is MIT
              licensed and the repo is at
              <a href="https://github.com/cptn-io/el-cptn"
                >https://github.com/cptn-io/el-cptn</a
              >.
              <p>
                I have started on my startup journey an year ago and launched a
                monitoring platform called DevRaven. Unfortunately the product
                did not takeoff as expected. That story is for another day.
              </p>
              <p>
                But during the course of building the product, I have built
                several integrations leveraging MQs and Cloud Functions. While
                building and deploying Cloud Functions for happy paths is easy,
                I had to monitor logs for failures, build retry mechanisms or
                manually process failed events, keep instances running to
                prevent cold start timeouts. It can also get expensive with
                charges for MQs, server time for running cloud functions etc and
                costs can be unpredictable.
              </p>
              <p>
                I thought of building a platform where I can build integrations
                quickly, have the ability to look at incoming/outgoing events,
                look at logs, retry any failed events etc. And finally,
                predictable costs for running the infrastructure. cptn.io
                provides all these capabilities and more. You can build
                pipelines to integrate with any cloud services, send data from
                your backend to data warehouses, listen to web hook events etc.
                The platform can be integrated into any stack by sending events
                to HTTP end points.
              </p>
              <p>
                Instead of trying to build a business first or launch an open
                source product under restrictive licenses, the platform will be
                available under MIT license so any user or customer can use it.
                There is no ee folder or complex dual licensing and I am also
                committing to releasing SSO under MIT. The plan is to offer a
                managed service in the cloud at a later time, accept sponsors
                for prioritizing features for enterprise customers and charge
                for enterprise support.
              </p>
              <p>
                It should take less than 5 minutes to get the platform running
                on your machine. Welcome any feedback, feature requests, PRs and
                bug reports.
              </p>
            </div>
          </section>
        </section>
        <section id="35864540">
          <h3>
            <a
              class="item"
              href="https://twitter.com/TurnerNovak/status/1654577231937544192"
              >"Coinbase (?) had a $65M Datadog bill per its Q1 earnings
              call"</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 17:38:15</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35864540"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35864484">
          <h3>
            <a
              class="item"
              href="https://foiaonline.gov/foiaonline/action/public/submissionDetails?trackingNumber=EPA-2023-004020&amp;type=Request"
              >[EPA] Interim Decision to Artificial Intelligence Tools</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 17:34:01</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35864484"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35864429">
          <h3>
            <a class="item" href="https://www.nextcomputers.org/"
              >NeXT Computers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 17:29:37</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35864429"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35864053">
          <h3>
            <a class="item" href="https://www.tesorio.com/careers#job-openings"
              >Tesorio (YC S15) Hiring Senior Back End Engineer, DevOps, Head of
              Data Science</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 17:01:39</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35863837">
          <h3>
            <a class="item" href="https://github.com/vadimdemedes/ink"
              >Ink: React for interactive command-line apps</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 16:46:41</span
              ><span class="points-container"
                >Points: <span class="points">267</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35863837"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35863746">
          <h3>
            <a
              class="item"
              href="https://www.damninteresting.com/colonels-of-truth/"
              >Colonels of Truth (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 16:41:25</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35863746"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35863309">
          <h3>
            <a
              class="item"
              href="https://aaronlou.com/blog/2023/reflected-diffusion/"
              >Reflected Diffusion Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 16:13:01</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35863309"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35863175">
          <h3>
            <a
              class="item"
              href="https://github.blog/2023-05-08-github-code-search-is-generally-available/"
              >GitHub code search is generally available</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 16:01:47</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35863175"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35863124">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/concrete"
              >Concrete goes carbon-negative</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 15:59:03</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35863124"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35862837">
          <h3>
            <a
              class="item"
              href="http://undeadly.org/cgi?action=article;sid=20230507122935"
              >OpenBSD cron(8) now supports random ranges with steps</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 15:40:33</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35862837"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35862799">
          <h3>
            <a
              class="item"
              href="https://qrper.com/2023/04/coax-cables-i-used-for-sota-pota-a-horror-story/"
              >A coax cable horror story</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 15:37:43</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35862799"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35862142">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/a-mutation-turned-ants-into-parasites-in-one-generation-20230508/"
              >A mutation turned ants into parasites in one generation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 14:50:47</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35862142"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35861435">
          <h3>
            <a
              class="item"
              href="https://b-fg.github.io/2023/05/07/waterlily-on-gpu.html"
              >GPU vendor-agnostic fluid dynamics solver in Julia</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 13:44:16</span
              ><span class="points-container"
                >Points: <span class="points">174</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35861435"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35860827">
          <h3>
            <a
              class="item"
              href="https://blog.sigma-star.at/post/2023/05/sandbox-netns/"
              >Restricting network access using Linux Network Namespaces</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 12:31:12</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35860827"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35859338">
          <h3>
            <a
              class="item"
              href="https://fabiensanglard.net/sf2_sheets/index.html"
              >Street Fighter II, paper trails (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 08:30:58</span
              ><span class="points-container"
                >Points: <span class="points">295</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35859338"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35858438">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/science/blog/2010/sep/08/slime-mould-physarum"
              >Let slime moulds do the thinking (2010)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 05:28:48</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35858438"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35858375">
          <h3>
            <a class="item" href="https://ivanish.ca/hest-time-travel/"
              >Hest, Time Travel (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 05:16:26</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35858375"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35858268">
          <h3>
            <a
              class="item"
              href="https://bigthink.com/health/unlucky-history-rapamycin-anti-aging/"
              >Rapamycin: The unlucky history of an anti-aging drug</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-08 @ 04:59:25</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35858268"
                  >Comments</a
                ><span class="descendants">: 142</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35856646">
          <h3>
            <a
              class="item"
              href="https://win-vector.com/2023/05/07/a-time-series-apologia/"
              >A Time Series Apologia</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-07 @ 23:38:37</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35856646"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35855104">
          <h3>
            <a
              class="item"
              href="https://github.com/papis/papis/releases/tag/v0.13"
              >Papis: A CLI document and bibliography manager</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-07 @ 20:04:31</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35855104"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35852710">
          <h3>
            <a
              class="item"
              href="https://gizmodo.com/casio-g-shock-digital-watch-fitness-tracking-heart-rate-1850357822"
              >Casio adds fitness features to original G-Shock digital watch</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-07 @ 15:52:43</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35852710"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35836221">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=35836221"
              >Ask HN: Suing Facebook in small claims?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-05 @ 23:08:45</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35836221"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
            <div class="text">
              <p>
                I am still paying monthly for Facebook Ads for my small
                business. However, I cannot log in to cancel these Ads. I tried
                contacting my credit card company, but FB uses a different
                vendor account for each bill posted, making it difficult for the
                credit card company to stop these transactions.
              </p>
              <p>
                I attempted emailing FB several time to legal@facebook.com. And
                I wrote a letter twice, and sent in the mail via postage, with
                tracking, which was delivered, to cancel my Ad services and
                provide a refund. No response however.
              </p>
              <p>
                Should I proceed to small claims court to recover about $300 of
                lost Ad revenue, for a service which I can no longer use? I am
                still being billed to. Does anybody have any experience with
                this?
              </p>
            </div>
          </section>
        </section>
        <section id="35836019">
          <h3>
            <a class="item" href="https://mashpoe.github.io/favicon-dino-game/"
              >Favicon Dino Game</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-05 @ 22:45:42</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35836019"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
