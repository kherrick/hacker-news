<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40909554">
          <h3>
            <a class="item" href="https://trigger.dev/blog/event-loop-lag"
              >How we tamed Node.js event loop lag: a deepdive</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 20:52:01</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40909554"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40909390">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Negative_temperature"
              >Negative Temperature</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 20:35:48</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40909390"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40909076">
          <h3>
            <a class="item" href="https://sqlitebrowser.org/"
              >DB Browser for SQLite (Windows, macOS, and Most Versions of
              Linux)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 20:08:03</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40909076"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40908878">
          <h3>
            <a
              class="item"
              href="https://torrentfreak.com/annas-archive-faces-millions-in-damages-and-a-permanent-injunction-240708/"
              >Anna's Archive Faces Millions in Damages and a Permanent
              Injunction</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 19:52:31</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40908878"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40908855">
          <h3>
            <a
              class="item"
              href="https://bitwarden.com/blog/how-to-use-the-bitwarden-forwarded-email-alias-generator/"
              >How to use the Bitwarden forwarded email alias generator</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 19:50:18</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40908855"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40908521">
          <h3>
            <a
              class="item"
              href="https://torrentfreak.com/z-library-admins-escape-house-arrest-after-judge-approves-u-s-extradition-240708/"
              >Z-Library admins "escape house arrest" after judge approves U.S.
              extradition</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 19:19:01</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40908521"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40908444">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/24188282/roku-tv-update-motion-smoothing-turn-off"
              >Dear Roku, you ruined my TV</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 19:12:22</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40908444"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40908273">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2309.04259"
              >C++ patterns for low-latency applications including
              high-frequency trading</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 18:58:56</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40908273"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40908187">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2024/7/8/24194281/affinity-creative-suite-six-month-free-trial-deal-announcement"
              >Affinity's Adobe-rivaling creative suite is now free for six
              months</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 18:51:10</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40908187"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40908178">
          <h3>
            <a class="item" href="https://github.com/stym06/rebuf"
              >Show HN: WAL Implementation in Golang</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 18:50:29</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40908178"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
            <div class="text">
              I wrote this simple WAL library in Golang that I use to write data
              that my kafka producer fails due to errors like Broker going down
              or some other issue. Took inspiration from etcd/wal
            </div>
          </section>
        </section>
        <section id="40907933">
          <h3>
            <a
              class="item"
              href="https://pretalx.com/devconf-cz-2024/talk/W3AVCT/"
              >No more boot loader: Please use the kernel instead</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 18:27:16</span
              ><span class="points-container"
                >Points: <span class="points">211</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40907933"
                  >Comments</a
                ><span class="descendants">: 121</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40907581">
          <h3>
            <a class="item" href="https://jvns.ca/blog/2024/07/08/readline/"
              >Entering text in the terminal is complicated</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 17:52:23</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40907581"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40907528">
          <h3>
            <a class="item" href="https://www.quicklang.app/en"
              >Show HN: I coded my own JSON translation tool to easily localize
              my side project</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 17:46:37</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40907528"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
            <div class="text">
              <p>
                I used to use ChatGPT to translate the JSON translation file
                changes before coding Quicklang. However, I realized that
                ChatGPT only allows you to input short content for translation
                into another language (even if you provide a .json file), and
                each time I had to request translations for one language at a
                time. So, I decided to build an app that only sends the changes
                I’ve made to the OpenAI API and easily translates them into all
                the target languages for my side projects.
              </p>
              <p>
                Technical details: I used Next.js to build the front end and
                backend, and I use a custom VPS (EC2 instance) on AWS to handle
                the translation process. This is because the translation can
                take several minutes, and Vercel Functions time out after 10
                seconds by default (up to 60 seconds on the Hobby plan).
                Finally, I save the translation files in an S3 bucket.
              </p>
              <p>
                What’s next? I want to add cool features like change history,
                the capability to add context to the OpenAI API to make
                translations as accurate as possible, and maybe allow developers
                to interact with the API in order to use the tool.
              </p>
              <p>
                Let me know your thoughts and feedback. It’s been a blast
                working on this so far, and I think it’s just neat :)
              </p>
            </div>
          </section>
        </section>
        <section id="40907269">
          <h3>
            <a class="item" href="https://imherefor.me/"
              >Dumb website only lets one user in at a time</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 17:16:47</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40907269"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40907155">
          <h3>
            <a class="item" href="https://paulgraham.com/persistence.html"
              >The Right Kind of Stubborn</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 17:05:08</span
              ><span class="points-container"
                >Points: <span class="points">199</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40907155"
                  >Comments</a
                ><span class="descendants">: 105</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40906401">
          <h3>
            <a class="item" href="https://github.com/Osiris-Team/1JPM"
              >1JPM: A Maven/Gradle alternative in a single Java file</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 15:45:40</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40906401"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40906148">
          <h3>
            <a class="item" href="https://conduition.io/coding/ticketmaster/"
              >Reverse engineering Ticketmaster's rotating barcodes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 15:14:06</span
              ><span class="points-container"
                >Points: <span class="points">851</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40906148"
                  >Comments</a
                ><span class="descendants">: 318</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40906112">
          <h3>
            <a
              class="item"
              href="https://www.usenix.org/publications/loginonline/understanding-software-dynamics"
              >Understanding Software Dynamics [book review]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 15:09:43</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40906112"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40905849">
          <h3>
            <a class="item" href="https://words.filippo.io/dispatches/geomys/"
              >Geomys, a blueprint for a sustainable open-source maintenance
              firm</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 14:39:35</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40905849"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40905719">
          <h3>
            <a class="item" href="https://github.com/victrixsoft/bashbro"
              >Bashbro – Make Any Comp a Web-Based File Server</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 14:24:24</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40905719"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40905686">
          <h3>
            <a class="item" href="https://swift-ai.vercel.app/"
              >Show HN: A fast OSS voice assistant</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 14:21:05</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40905686"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40905295">
          <h3>
            <a class="item" href="https://github.com/incidentalhq/incidental"
              >Show HN: I am building an open-source incident management
              platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 13:34:58</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40905295"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
            <div class="text">
              <p>
                I've been working on it for the past couple of months as a
                hobby, and now it's at a state where I'm comfortable sharing it.
                This is also my first open source project.
              </p>
              <p>
                Features: - Custom roles - Custom severities - Integrated with
                Slack - Web interface
              </p>
              <p>Todos: - Custom fields - Custom workflows</p>
              <p>
                Website:
                <a href="https://incidental.dev">https://incidental.dev</a>
                Github:
                <a href="https://github.com/incidentalhq/incidental"
                  >https://github.com/incidentalhq/incidental</a
                >
              </p>
              <p>I'd love to hear your feedback.</p>
              <p>Thanks!</p>
            </div>
          </section>
        </section>
        <section id="40904862">
          <h3>
            <a class="item" href="https://github.com/onlook-dev/studio"
              >Show HN: Open-sourced Webflow for your own app</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 12:36:10</span
              ><span class="points-container"
                >Points: <span class="points">242</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40904862"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
            <div class="text">
              <p>
                Technical details: This is technically a web browser that can
                point to your localhost, which injects some CSS into the page
                that allows you to select, drag, and drop DOM elements, then
                track and translate those changes back into React code.
                Theoretically, you could do this with any compiled framework but
                I wanted a reasonable scope for the launch (the first version
                was actually in Svelte).
              </p>
              <p>
                Some interesting challenges: 1. There is a React parser that is
                used to parse, insert the style, and serialize it back to code
                2. There is a React pre-processor that traces the DOM elements
                to the corresponding code 3. There's also CSS parsing,
                injection, and converting to Tailwind 4. This is also an
                Electron app so there’s a browser within a browser within a node
                app which makes message passing… interesting
              </p>
              <p>
                What’s next? We’ve already built a proof-of-concept for
                inspecting and selecting layers, dragging to reorder, and
                inserting new DOM elements that I’m working on porting over from
                our private codebase. We’re also exploring opening more tabs in
                new frames in order to A/B test the changes before committing to
                code. There’s a long tail of exciting features we can do but I
                want to put this out there first and see what others would need.
              </p>
              <p>
                Let me know what you think/feedback. It's been a blast working
                on this so far and I think it’s just neat :)
              </p>
            </div>
          </section>
        </section>
        <section id="40904587">
          <h3>
            <a class="item" href="https://up.codes/careers?utm_source=HN"
              >UpCodes (YC S17) is hiring remote SWEs, PMs to help make
              buildings cheap</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 12:00:34</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40903870">
          <h3>
            <a class="item" href="https://github.com/Xpra-org/xpra"
              >Xpra: Persistent Remote Applications for X11</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 09:15:47</span
              ><span class="points-container"
                >Points: <span class="points">174</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40903870"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40902740">
          <h3>
            <a
              class="item"
              href="https://brooker.co.za/misc-blog/2024/01/23/skis.html"
              >Do Skis Get Blunt?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 05:04:58</span
              ><span class="points-container"
                >Points: <span class="points">236</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40902740"
                  >Comments</a
                ><span class="descendants">: 168</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40887521">
          <h3>
            <a
              class="item"
              href="https://www.pcmag.com/news/hands-on-apple-final-cut-camera-final-cut-pro-2-multicam"
              >Record 4 Camera Angles at Once Using Only iPhones and iPads</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-06 @ 01:24:07</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40887521"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40887516">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=1idSEhUT4PM"
              >Modifying the OG Xbox to have 256M of RAM [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-06 @ 01:22:25</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40887516"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40882038">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/article/how-i-turned-seemingly-failed-experiments-into-a-successful-phd"
              >How I turned seemingly 'failed' experiments into a successful
              PhD</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-05 @ 12:16:12</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40882038"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40870756">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/history/why-ernest-hemingways-younger-brother-established-a-floating-republic-in-the-caribbean-180984635/"
              >Ernest Hemingway's brother established a floating republic in the
              Caribbean</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-03 @ 22:46:28</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40870756"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
