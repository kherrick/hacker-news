<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="45710366">
          <h3>
            <a class="item" href="https://www.southernamis.com/ataribbsconnect"
              >Connect to a 1980s Atari BBS through the web</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-26 @ 09:31:47</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45710366"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45710065">
          <h3>
            <a
              class="item"
              href="https://diamondgeezer.blogspot.com/2025/10/asbestosis.html"
              >Asbestosis</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-26 @ 08:34:38</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45710065"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45710021">
          <h3>
            <a
              class="item"
              href="https://www.swatch.com/en-en/what-if-tariffs-so34z106/SO34Z106.html"
              >What If Tariffs?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-26 @ 08:23:48</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45710021"
                  >Comments</a
                ><span class="descendants">: 89</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45710006">
          <h3>
            <a
              class="item"
              href="https://adventofcode.com/2025/about#faq_num_days"
              >Advent of Code 2025: Number of puzzles reduce from 25 to 12 for
              the first time</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-26 @ 08:19:48</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45710006"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45709988">
          <h3>
            <a class="item" href="https://clojure.land/"
              >Clojure Land – Discover open-source Clojure libraries and
              frameworks</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-26 @ 08:15:48</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45709988"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45709922">
          <h3>
            <a class="item" href="https://www.gaudi.ch/GaudiLabs/?page_id=578"
              >LaserTweezer – Optical Trap</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-26 @ 08:03:14</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45709922"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45709819">
          <h3>
            <a class="item" href="https://book.rvemu.app/"
              >Writing a RISC-V Emulator in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-26 @ 07:34:30</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45709819"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45709698">
          <h3>
            <a class="item" href="https://bitmovin.com/careers"
              >Bitmovin (YC S15) Is Hiring Engineering ICs and Managers in
              Europe</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-26 @ 07:00:33</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45708795">
          <h3>
            <a class="item" href="https://genai-showdown.specr.net/"
              >GenAI Image Editing Showdown</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-26 @ 02:57:57</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45708795"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45708686">
          <h3>
            <a class="item" href="https://github.com/AnasMalas/pcb-edge-usb-c"
              >PCB Edge USB C Connector Library</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-26 @ 02:31:54</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45708686"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45708524">
          <h3>
            <a class="item" href="https://github.com/apple/pico-banana-400k"
              >Pico-Banana-400k</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-26 @ 02:01:17</span
              ><span class="points-container"
                >Points: <span class="points">239</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45708524"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45708292">
          <h3>
            <a
              class="item"
              href="https://www.nrc.gov/reading-rm/doc-collections/event-status/event/2025/20251022en?brid=vscAjql9kZL1FfGE7TYHVw#en57996:~:text=TRANSPORT%20OF%20CONTAMINATED%20PERSON%20OFFSITE"
              >A worker fell into a nuclear reactor pool</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-26 @ 01:15:43</span
              ><span class="points-container"
                >Points: <span class="points">437</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45708292"
                  >Comments</a
                ><span class="descendants">: 267</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45707658">
          <h3>
            <a class="item" href="https://www.0xkato.xyz/linux-boot/"
              >The Linux Boot Process: From Power Button to Kernel</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-25 @ 23:04:23</span
              ><span class="points-container"
                >Points: <span class="points">265</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45707658"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45707539">
          <h3>
            <a class="item" href="https://d2lang.com/tour/intro/"
              >D2: Diagram Scripting Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-25 @ 22:40:00</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45707539"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45706938">
          <h3>
            <a class="item" href="https://lwn.net/Articles/631631/"
              >How programs get run: ELF binaries (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-25 @ 21:03:39</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45706938"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45706866">
          <h3>
            <a
              class="item"
              href="https://fwsgonzo.medium.com/an-update-on-tinykvm-7a38518e57e9"
              >An Update on TinyKVM</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-25 @ 20:51:16</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45706866"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45706792">
          <h3>
            <a class="item" href="https://github.com/RohanAdwankar/oxdraw"
              >Show HN: Diagram as code tool with draggable customizations</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-25 @ 20:38:58</span
              ><span class="points-container"
                >Points: <span class="points">191</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45706792"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
            <div class="text">
              <p>
                Therefore I am now working on this to combine the benefits of
                both into just one tool which can do both functions.
              </p>
              <p>
                The project is certainly in the early stages but if you find
                yourself making architecture diagrams I'd love to hear your
                thoughts on the idea or even a Github issue for a feature
                request!
              </p>
              <p>
                One of the workflows I'm targeting is when an AI generates the
                first draft of the diagram (all the LLMs know .mmd syntax) and
                then the user can then customize it to their liking which I
                think can drastically speed up making complex diagrams!
              </p>
            </div>
          </section>
        </section>
        <section id="45706765">
          <h3>
            <a
              class="item"
              href="https://about.nike.com/en/newsroom/releases/nike-project-amplify-official-images"
              >Project Amplify: Powered footwear for running and walking</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-25 @ 20:35:48</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45706765"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45706729">
          <h3>
            <a class="item" href="https://github.com/microsoft/agent-lightning"
              >Agent Lightning: Train agents with RL (no code changes needed)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-25 @ 20:30:25</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45706729"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
            <div class="text">
              <a href="https://microsoft.github.io/agent-lightning/stable/"
                >https://microsoft.github.io/agent-lightning/stable/</a
              >
            </div>
          </section>
        </section>
        <section id="45706527">
          <h3>
            <a
              class="item"
              href="https://www.latimes.com/environment/story/2025-10-17/california-made-it-through-another-summer-without-a-flex-alert"
              >California invests in battery energy storage, leaving rolling
              blackouts behind</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-25 @ 19:58:55</span
              ><span class="points-container"
                >Points: <span class="points">272</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45706527"
                  >Comments</a
                ><span class="descendants">: 211</span></span
              >
            </h4>
            <div class="text">
              <a
                href="https://web.archive.org/web/20251025210426/https://www.latimes.com/environment/story/2025-10-17/california-made-it-through-another-summer-without-a-flex-alert"
                >https://web.archive.org/web/20251025210426/https://www.latim...</a
              >
            </div>
          </section>
        </section>
        <section id="45706518">
          <h3>
            <a
              class="item"
              href="https://www.technologyreview.com/2025/09/25/1124005/ai-wikipedia-vulnerable-languages-doom-spiral/"
              >AI, Wikipedia, and uncorrected machine translations of vulnerable
              languages</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-25 @ 19:57:48</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45706518"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45706380">
          <h3>
            <a class="item" href="https://amit.prasad.me/blog/before-main"
              >The Journey Before main()</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-25 @ 19:33:22</span
              ><span class="points-container"
                >Points: <span class="points">233</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45706380"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45703196">
          <h3>
            <a
              class="item"
              href="https://huggingface.co/mirth/chonky_mmbert_small_multilingual_1"
              >Show HN: Chonky – a neural text semantic chunking goes
              multilingual</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-25 @ 12:01:44</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45703196"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
            <div class="text">
              <p>
                You can learn more about this neural approach in a previous
                post:
                <a href="https://news.ycombinator.com/item?id=43652968"
                  >https://news.ycombinator.com/item?id=43652968</a
                >
              </p>
              <p>
                Since the release of the first distilbert-based model I’ve
                released two more models based on a ModernBERT. All these models
                were pre-trained and fine-tuned primary on English texts.
              </p>
              <p>
                But recently mmBERT(<a href="https://huggingface.co/blog/mmbert"
                  >https://huggingface.co/blog/mmbert</a
                >) has been released. This model pre-trained on massive dataset
                that contains 1833 languages. So I had an idea of fine-tuning a
                new multilingual Chonky model.
              </p>
              <p>
                I’ve expanded training dataset (that previously contained
                bookcorpus and minipile datasets) with Project Gutenberg dataset
                which contains books in some widespread languages.
              </p>
              <p>
                To make the model more robust for real-world data I’ve removed
                punctuation for last word for every training chunk with
                probability of 0.15 (no ablation was made for this technique
                though).
              </p>
              <p>
                The hard part is evaluation. The real-world data are typically
                OCR'ed markdown, transcripts of calls, meeting notes etc. and
                not a clean book paragraphs. I didn’t find such labeled
                datasets. So I used what I had: already mentioned bookcorpus and
                Project Gutenberg validation, Paul Graham essays, concatenated
                20_newsgroups.
              </p>
              <p>
                I also tried to fine-tune the bigger mmBERT model (mmbert-base)
                but unfortunately it didn’t go well — metrics are weirdly lower
                in comparison with a small model.
              </p>
              <p>Please give it a try. I'll appreciate a feedback.</p>
              <p>
                The new multilingual model:
                <a
                  href="https://huggingface.co/mirth/chonky_mmbert_small_multilingual_1"
                  >https://huggingface.co/mirth/chonky_mmbert_small_multilingua...</a
                >
              </p>
              <p>
                All the Chonky models:
                <a href="https://huggingface.co/mirth"
                  >https://huggingface.co/mirth</a
                >
              </p>
              <p>
                Chonky wrapper library:
                <a href="https://github.com/mirth/chonky"
                  >https://github.com/mirth/chonky</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="45698070">
          <h3>
            <a
              class="item"
              href="https://blog.feld.me/posts/2025/09/webdav-isnt-dead-yet/"
              >WebDAV isn't dead yet</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-24 @ 19:09:08</span
              ><span class="points-container"
                >Points: <span class="points">189</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45698070"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45695979">
          <h3>
            <a
              class="item"
              href="https://www.assembled.com/blog/why-i-code-as-a-cto"
              >Why I code as a CTO</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-24 @ 16:03:53</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45695979"
                  >Comments</a
                ><span class="descendants">: 118</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45676376">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/business/nextsilicon-reveals-new-processor-chip-challenge-intel-amd-2025-10-22/"
              >NextSilicon reveals new processor chip in challenge to Intel,
              AMD</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-22 @ 23:18:52</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45676376"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45672085">
          <h3>
            <a class="item" href="http://ei3lh.eu/?p=88"
              >Cubical Quad Antennas and Margaret's Letter</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-22 @ 17:05:25</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45672085"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45650167">
          <h3>
            <a class="item" href="https://satcom.sysnet.ucsd.edu/"
              >Eavesdropping on Internal Networks via Unencrypted Satellites</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-20 @ 22:21:59</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45650167"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45639043">
          <h3>
            <a
              class="item"
              href="https://digitalseams.com/blog/any-decent-error-message-is-a-kind-of-oracle"
              >Any decent error message is a kind of oracle</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-19 @ 23:52:21</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45639043"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45638453">
          <h3>
            <a
              class="item"
              href="https://www.radiotimes.com/tv/sci-fi/doctor-who-missing-episodes-update-teases-announcement-newsupdate/"
              >Doctor Who archive expert shares positive update on missing
              episode</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-19 @ 22:04:10</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45638453"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
