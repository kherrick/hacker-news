<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37166986">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/08/17/science/climate-paleontology-mammals.html"
              >Ancient Fires Drove Large Mammals Extinct, Study Suggests</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 19:48:31</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37166986"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37166478">
          <h3>
            <a class="item" href="https://www.jobcorps.gov/"
              >JobCorps.Gov: free job training, food, housing and living
              allowance</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 19:07:45</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37166478"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37165933">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/tech/behind-the-curtain-of-elon-musks-secretive-spacex-revenue-growth-and-rising-costs-2c828e2b"
              >SpaceX Revenue Doubled to $4.6B in 2022 Versus 2021</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 18:24:03</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37165933"
                  >Comments</a
                ><span class="descendants">: 89</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37165713">
          <h3>
            <a class="item" href="https://www.permit.io/blog/policy-engines"
              >Policy Engines: Open Policy Agent vs. AWS Cedar vs. Google
              Zanzibar</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 18:06:44</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37165713"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37165697">
          <h3>
            <a class="item" href="https://marketmap.one"
              >Beautiful data visualization of the US stock market</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 18:05:20</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37165697"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37165119">
          <h3>
            <a
              class="item"
              href="https://bigdanzblog.wordpress.com/2023/08/16/too-many-fonts-in-windows-10-can-cause-slow-application-starts/"
              >Too many fonts in Windows 10 can cause slow application starts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 17:22:21</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37165119"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37165042">
          <h3>
            <a class="item" href="https://blog.regehr.org/archives/213"
              >A Guide to Undefined Behavior in C and C++</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 17:18:08</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37165042"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37164864">
          <h3>
            <a class="item" href="https://www.shadeform.ai/"
              >Show HN: Shadeform – Single Platform and API for Provisioning
              GPUs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 17:07:21</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37164864"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.shadeform.ai/">https://www.shadeform.ai/</a
              >), a GPU marketplace to see live availability and prices across
              the GPU market, as well as to deploy and reserve on-demand
              instances. We have aggregated 8+ GPU providers into a single
              platform and API, so you can easily provision instances like A100s
              and H100s where they are available.
              <p>
                From our experience working at AWS and Azure, we believe that
                cloud could evolve from all-encompassing hyperscalers (AWS,
                Azure, GCP) to specialized clouds for high-performance use
                cases. After the launch of ChatGPT, we noticed GPU capacity
                thinning across major providers and emerging GPU and HPC clouds,
                so we decided it was the right time to build a single interface
                for IaaS across clouds.
              </p>
              <p>
                With the explosion of Llama 2 and open source models, we are
                seeing individuals, startups, and organizations struggling to
                access A100s and H100s for model fine-tuning, training, and
                inference.
              </p>
              <p>
                This encouraged us to help everyone access compute and increase
                flexibility with their cloud infra. Right now, we’ve built a
                platform that allows users to find GPU availability and launch
                instances from a unified platform. Our long term goal is to
                build a hardwareless GPU cloud where you can leverage managed ML
                services to train and infer in different clouds, reducing vendor
                lock-in.
              </p>
              <p>We shipped a few features to help teams access GPUs today:</p>
              <p>
                - a “single plane of glass” for GPU availability and prices;
              </p>
              <p>
                - a “single control plane” for provisioning GPUs in any cloud
                through our platform and API;
              </p>
              <p>
                - a reservation system that monitors real time availability and
                launches GPUs as soon as they become available.
              </p>
              <p>
                Next up, we’re building multi-cloud load balanced inference,
                streamlining self hosting open source models, and more.
              </p>
              <p>
                You can try our platform at
                <a href="https://platform.shadeform.ai"
                  >https://platform.shadeform.ai</a
                >. You can provision instances in your accounts by adding your
                cloud credentials and api keys, or you can leverage “ShadeCloud”
                and provision GPUs in our accounts. If you deploy in your
                account, it is free. If you deploy in our accounts, we charge a
                5% platform fee.
              </p>
              <p>
                We’d love your feedback on how we’re approaching this problem.
                What do you think?
              </p>
            </div>
          </section>
        </section>
        <section id="37164650">
          <h3>
            <a class="item" href="https://notmycows.com/"
              >Show HN: Not My Cows – Save your cows. Blast the meteors. Giddy
              up</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 16:55:36</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37164650"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
            <div class="text">
              <p>
                <a href="https://github.com/jonfranco224/not-my-cows"
                  >https://github.com/jonfranco224/not-my-cows</a
                >
                if anyone wants to check the source.
              </p>
              <p>
                Edit: y'all seem to be enjoying this! I spun up a quick
                Twitter/X for game updates if anyone is interested -
                <a href="https://twitter.com/notmycowsgame"
                  >https://twitter.com/notmycowsgame</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="37164243">
          <h3>
            <a
              class="item"
              href="https://groups.google.com/g/scheme-reports-wg2/c/xGd0_eeKmGI/m/q-xM5fbuAQAJ"
              >My resignation letter as R7RS-large chair</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 16:31:56</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37164243"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37164155">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2023/8/16/23835116/have-you-seen-these-dehumidifiers-stop-using-them-or-you-might-die"
              >1.56M dehumidifiers recalled due to fire and burn hazards</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 16:27:26</span
              ><span class="points-container"
                >Points: <span class="points">213</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37164155"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37163489">
          <h3>
            <a
              class="item"
              href="https://www.thaitrainguide.com/2022/06/10/railway-safety-posters/"
              >Railway Safety Posters (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 15:47:52</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37163489"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37163187">
          <h3>
            <a
              class="item"
              href="https://tokio.rs/blog/2023-01-03-announcing-turmoil"
              >Turmoil, a framework for developing and testing distributed
              systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 15:28:39</span
              ><span class="points-container"
                >Points: <span class="points">177</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37163187"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37162898">
          <h3>
            <a
              class="item"
              href="https://rachit.pl/post/you-have-built-a-compiler/"
              >I am afraid to inform you that you have built a compiler
              (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 15:10:50</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37162898"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37162762">
          <h3>
            <a
              class="item"
              href="https://old.reddit.com/r/Amd/comments/15t0lsm/i_turned_a_95_amd_apu_into_a_16gb_vram_gpu_and_it/"
              >AMD Ryzen APU turned into a 16GB VRAM GPU and it can run Stable
              Diffusion</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 15:01:24</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37162762"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37161441">
          <h3>
            <a class="item" href="https://textfx.withgoogle.com/"
              >The TextFX Project</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 13:43:45</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37161441"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37161097">
          <h3>
            <a
              class="item"
              href="https://blog.google/products/search/google-search-generative-ai-learning-features/"
              >Learn as you search (and browse) using generative AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 13:17:16</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37161097"
                  >Comments</a
                ><span class="descendants">: 170</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37160783">
          <h3>
            <a
              class="item"
              href="https://blog.jgc.org/2023/08/retrieving-1tb-of-data-from-faulty.html"
              >Retrieving 1TB of data from a faulty drive with the help of
              woodworking tools</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 12:51:00</span
              ><span class="points-container"
                >Points: <span class="points">321</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37160783"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37160744">
          <h3>
            <a
              class="item"
              href="https://qz.com/ai-bots-recaptcha-turing-test-websites-authenticity-1850734350"
              >AI bots are now better than humans at decoding CAPTCHAs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 12:47:16</span
              ><span class="points-container"
                >Points: <span class="points">227</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37160744"
                  >Comments</a
                ><span class="descendants">: 174</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37160314">
          <h3>
            <a class="item" href="https://up.codes/careers"
              >UpCodes (YC S17) is hiring fullstack engineers to help make
              cheaper buildings</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 12:02:34</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37159744">
          <h3>
            <a
              class="item"
              href="https://blog.torproject.org/releasing-mullvad-browser/"
              >Mullvad Browser</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 10:51:56</span
              ><span class="points-container"
                >Points: <span class="points">266</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37159744"
                  >Comments</a
                ><span class="descendants">: 122</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37159680">
          <h3>
            <a
              class="item"
              href="https://www.australiangeographic.com.au/topics/science-environment/2023/08/asteroid-crater-520km-in-diameter-buried-deep-in-southeast-australia-scientists-say/"
              >Asteroid crater 520km in diameter buried in southeast Australia,
              scientists say</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 10:39:52</span
              ><span class="points-container"
                >Points: <span class="points">250</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37159680"
                  >Comments</a
                ><span class="descendants">: 141</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37158827">
          <h3>
            <a class="item" href="https://anoopdixith.com/disasters/"
              >Software engineering lessons from RCAs of greatest disasters</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 08:38:30</span
              ><span class="points-container"
                >Points: <span class="points">166</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37158827"
                  >Comments</a
                ><span class="descendants">: 112</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37158398">
          <h3>
            <a
              class="item"
              href="https://aheze.substack.com/p/getting-a-job-at-apple-without-going"
              >Getting a job at Apple without going to college or doing
              LeetCode</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 07:33:35</span
              ><span class="points-container"
                >Points: <span class="points">225</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37158398"
                  >Comments</a
                ><span class="descendants">: 295</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37158317">
          <h3>
            <a
              class="item"
              href="https://www.fourbardesign.com/2020/10/diy-espresso.html"
              >DIY Espresso (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 07:21:40</span
              ><span class="points-container"
                >Points: <span class="points">222</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37158317"
                  >Comments</a
                ><span class="descendants">: 176</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37158068">
          <h3>
            <a
              class="item"
              href="https://medium.com/dartlang/dart-3-1-a-retrospective-on-functional-style-programming-in-dart-3-a1f4b3a7cdda"
              >Dart 3.1 and a retrospective on functional style programming in
              Dart</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-17 @ 06:46:30</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37158068"
                  >Comments</a
                ><span class="descendants">: 157</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37149349">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-023-02585-7"
              >LK-99 isn’t a superconductor</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-16 @ 16:17:17</span
              ><span class="points-container"
                >Points: <span class="points">1984</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37149349"
                  >Comments</a
                ><span class="descendants">: 654</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37148062">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Fred_Fish"
              >Fred Fish (Fish Disks)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-16 @ 14:56:18</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37148062"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37142513">
          <h3>
            <a
              class="item"
              href="https://matt-rickard.com/learning-via-negativa"
              >Learning via Negativa</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-16 @ 03:21:50</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37142513"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37140831">
          <h3>
            <a
              class="item"
              href="https://news.mongabay.com/2023/08/bali-rice-experiment-cuts-greenhouse-gas-emissions-and-increases-yields/"
              >Bali rice experiment cuts greenhouse gas emissions and increases
              yields</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 23:39:30</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37140831"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
