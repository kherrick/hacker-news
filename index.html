<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39281178">
          <h3>
            <a class="item" href="https://gvwilson.github.io/sql-tutorial/"
              >SQL for data scientists in 100 queries</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 21:50:26</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39281178"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39280756">
          <h3>
            <a
              class="item"
              href="https://www.ntsb.gov/investigations/Documents/DCA24MA063%20Preliminary%20report.pdf"
              >Alaska Airlines flight 1282 NTSB preliminary report [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 21:17:35</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39280756"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39280537">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/spine-ai/jobs/Z1hz3BZ-lead-applied-ml-scientist"
              >Spine AI (YC S23) Is Hiring a Lead ML Scientist</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 21:01:02</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39280024">
          <h3>
            <a class="item" href="https://github.com/parallelvirtualcluster/pvc"
              >PVC: A KVM/Zookeeper/Ceph-based hyperconverged infrastructure
              manager</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 20:23:17</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39280024"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39279431">
          <h3>
            <a
              class="item"
              href="https://newsroom.ibm.com/2024-02-06-New-IBM-LinuxONE-4-Express-to-Offer-Cost-Savings-and-Client-Value-through-a-Cyber-Resilient-Hybrid-Cloud-and-AI-Platform"
              >New IBM LinuxONE 4 Express â€“ Rack-mounted pre-configured Linux
              mainframe</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 19:39:13</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39279431"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39279428">
          <h3>
            <a
              class="item"
              href="https://aaronparecki.com/2015/08/29/8/why-i-live-in-irc"
              >Why I Live in IRC (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 19:39:08</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39279428"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39279163">
          <h3>
            <a
              class="item"
              href="https://thechipletter.substack.com/p/demystifying-gpu-compute-architectures"
              >Demystifying GPU compute architectures</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 19:20:32</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39279163"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39278631">
          <h3>
            <a
              class="item"
              href="https://ourworldindata.org/much-better-awful-can-be-better"
              >The world is awful. The world is much better. The world can be
              much better</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 18:46:25</span
              ><span class="points-container"
                >Points: <span class="points">289</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39278631"
                  >Comments</a
                ><span class="descendants">: 174</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39277990">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/networking/three-million-malware-infected-smart-toothbrushes-used-in-swiss-ddos-attacks-botnet-causes-millions-of-euros-in-damages"
              >Three million malware-infected smart toothbrushes used in Swiss
              DDoS attacks</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 18:07:32</span
              ><span class="points-container"
                >Points: <span class="points">210</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39277990"
                  >Comments</a
                ><span class="descendants">: 120</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39277451">
          <h3>
            <a class="item" href="https://depot.dev/blog/buildkit-in-depth"
              >BuildKit in depth: Docker's build engine explained</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 17:31:24</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39277451"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39277079">
          <h3>
            <a
              class="item"
              href="https://logdy.dev/blog/post/web-based-logs-viewer-ui-for-local-development-environment"
              >Show HN: Logdy.dev â€“ web based log viewer UI for local
              development environments</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 17:11:15</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39277079"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39276687">
          <h3>
            <a class="item" href="https://github.com/AdguardTeam/AdGuardHome"
              >AdGuard Home: Network-wide ad- and tracker-blocking DNS server</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 16:48:27</span
              ><span class="points-container"
                >Points: <span class="points">186</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39276687"
                  >Comments</a
                ><span class="descendants">: 133</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39276623">
          <h3>
            <a class="item" href="https://github.com/deepseek-ai/DeepSeek-Math"
              >DeepSeekMath 7B achieved 51.7% on MATH benchmark</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 16:45:16</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39276623"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39276452">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/2024/02/05/the-perverse-policies-that-fuel-wildfires"
              >The perverse policies that fuel wildfires</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 16:35:28</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39276452"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39275314">
          <h3>
            <a class="item" href="https://github.com/apple/ml-mgie"
              >Instruction-Based Image Editing via LLM</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 15:30:48</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39275314"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39274918">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2401.16212"
              >Better Call GPT: Comparing large language models against lawyers
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 15:04:39</span
              ><span class="points-container"
                >Points: <span class="points">286</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39274918"
                  >Comments</a
                ><span class="descendants">: 199</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39274521">
          <h3>
            <a class="item" href="https://pika.page"
              >Show HN: Pika â€“ Simple blogging software</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 14:28:15</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39274521"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
            <div class="text">
              <p>
                I wanted to share something we at Good Enough (<a
                  href="https://goodenough.us"
                  >https://goodenough.us</a
                >) built over the past month.
              </p>
              <p>Pika! <a href="https://pika.page">https://pika.page</a></p>
              <p>
                I know, I know, who needs more blogging software? In this case,
                _I DO_. I find that the big players in the market have a
                distracting number of dials and knobs. I greatly appreciate the
                indieweb players in the space, but none of those solutions quite
                fit my way of blogging and so I'd bounce from one to the other
                to the other. I tried SSGs and my goodness do I dislike the
                experience of maintaining a website with them. I dislike the SSG
                experience so much that before convincing the team to build Pika
                with me, I was actually blogging by writing straight HTML!
              </p>
              <p>
                Pika is about simplifying blogging down to writing. Pika
                provides a great editor that doesn't _require_ Markdown (but
                accepts it) and a light bit of easy-to-use customizability
                without distracting you. With that baseline, we hope Pika can be
                a nice place for semi-technical folks to start or continue their
                blogging journey without all of the fiddly bits. In the longer
                term we'd like to make blogging more and more accessible to
                those who are non-technical, and we will grow our feature set
                and UX accordingly.
              </p>
              <p>
                We would love to hear thoughts from anyone that is an active
                blogger or considering starting a blog. Also, if you know
                someone who is on the hunt for easy, beautiful blogging software
                we'd appreciate you letting them know about Pika. Thank you!
              </p>
            </div>
          </section>
        </section>
        <section id="39274455">
          <h3>
            <a
              class="item"
              href="https://chriscoyier.net/2024/01/24/what-happened-with-the-web-monetization-api/"
              >What happened with the Web Monetization API?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 14:23:24</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39274455"
                  >Comments</a
                ><span class="descendants">: 162</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39274125">
          <h3>
            <a class="item" href="https://netbox.dev/"
              >NetBox: a source of truth for everything on your network</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 13:49:38</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39274125"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39274004">
          <h3>
            <a class="item" href="https://www.futureme.org/"
              >Write a Letter to Your Future Self</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 13:34:55</span
              ><span class="points-container"
                >Points: <span class="points">151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39274004"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39273308">
          <h3>
            <a
              class="item"
              href="https://longform.asmartbear.com/survivor-bias/"
              >Business advice plagued by survivor bias (2009)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 11:57:26</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39273308"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39272952">
          <h3>
            <a
              class="item"
              href="https://utcc.utoronto.ca/~cks/space/blog/sysadmin/TrackingMachineImportance"
              >We might want to regularly keep track of how important each
              server is</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 10:51:37</span
              ><span class="points-container"
                >Points: <span class="points">194</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39272952"
                  >Comments</a
                ><span class="descendants">: 112</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39272698">
          <h3>
            <a
              class="item"
              href="https://medium.com/@.anders/learnings-from-our-8-years-of-kubernetes-in-production-two-major-cluster-crashes-ditching-self-0257c09d36cd"
              >Learnings from our 8 years of Kubernetes in production</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-06 @ 10:10:18</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39272698"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39267883">
          <h3>
            <a
              class="item"
              href="https://huggingface.co/blog/TimothyAlexisVass/explaining-the-sdxl-latent-space"
              >Explaining the SDXL Latent Space</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 22:04:33</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39267883"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39266701">
          <h3>
            <a
              class="item"
              href="https://www.noemamag.com/the-potent-pollution-of-noise/"
              >The Potent Pollution of Noise</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 20:30:33</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39266701"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39260738">
          <h3>
            <a
              class="item"
              href="https://www.semafor.com/article/02/04/2024/inside-conde-nasts-breakup-with-pitchfork"
              >How CondÃ© Nast bought and destroyed Pitchfork</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-05 @ 12:54:15</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39260738"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39248892">
          <h3>
            <a
              class="item"
              href="https://devblogs.microsoft.com/oldnewthing/20240116-00/?p=109274"
              >What is a hard error, and what makes it harder than an easy
              error?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-04 @ 09:45:33</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39248892"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39248326">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/future/article/20240131-how-the-pennsylvania-dutch-created-groundhog-day"
              >The ancient Germanic history of Groundhog Day</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-04 @ 07:20:03</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39248326"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39242213">
          <h3>
            <a
              class="item"
              href="http://oldvcr.blogspot.com/2024/02/thou-shalt-follow-these-vintage.html"
              >Thou shalt follow these vintage computing commandments</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-03 @ 17:00:20</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39242213"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39235153">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/history/these-paintings-reveal-how-the-dutch-adapted-to-extreme-weather-during-the-little-ice-age-180983671/"
              >Paintings reveal how the Dutch adapted to extreme weather in the
              little Ice Age</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-02 @ 22:12:35</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39235153"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
