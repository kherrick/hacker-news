<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40073673">
          <h3>
            <a class="item" href="https://langfuse.com/careers"
              >Langfuse (YC W23) Is Hiring [Engineers, DevRel] in Berlin,
              Germany</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-18 @ 07:00:20</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40073139">
          <h3>
            <a
              class="item"
              href="https://www.undeadly.org/cgi?action=article;sid=20240418050520"
              >OpenBSD – Coming soon to a -current system near you: parallel raw
              IP input</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-18 @ 05:05:54</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40073139"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40072731">
          <h3>
            <a
              class="item"
              href="https://trustworthy.systems/publications/papers/Heiser_24:eo.abstract"
              >Lions OS: secure – fast – adaptable</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-18 @ 03:39:25</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40072731"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40071956">
          <h3>
            <a
              class="item"
              href="https://liu.se/en/news-item/ett-atomlager-guld-liu-forskare-skapar-gulden"
              >Goldene: A single atom layer of gold</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-18 @ 01:09:51</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40071956"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40071843">
          <h3>
            <a
              class="item"
              href="https://seanmoriarity.com/2024/02/25/implementing-natural-conversational-agents-with-elixir/"
              >Implementing Natural Conversational Agents with Elixir</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-18 @ 00:53:05</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40071843"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40071826">
          <h3>
            <a class="item" href="https://github.com/loopj/short-stack"
              >Short Stack: World’s smallest Nintendo Wii</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-18 @ 00:51:16</span
              ><span class="points-container"
                >Points: <span class="points">340</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40071826"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40071773">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/2024/04/22/can-the-world-be-simulated"
              >How Perfectly Can Reality Be Simulated?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-18 @ 00:43:30</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40071773"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40071728">
          <h3>
            <a
              class="item"
              href="https://chemistry-europe.onlinelibrary.wiley.com/doi/10.1002/cmdc.202400074"
              >Chemists Invent Drugs and Drugs Save Lives</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-18 @ 00:37:21</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40071728"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40071463">
          <h3>
            <a class="item" href="https://jrmf.org/puzzle/">Math Puzzles</a>
          </h3>
          <section>
            <h4>
              <span>2024-04-17 @ 23:59:30</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40071463"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40070566">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40070566"
              >Wayfair fired a bunch of people again today, after using them to
              train AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-17 @ 22:07:48</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40070566"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
            <div class="text">
              <p>
                After being shown some stupid bullshit video about how Wayfair
                is "moving in a new direction" or whatever, they were locked out
                of their accounts almost without warning. Friends barely got a
                chance to say goodbye to each other.
              </p>
              <p>
                For the last few months, they've been training an absolutely
                useless AI to replace themselves.
              </p>
              <p>
                They made all the managers wait till later in the day to come
                into work so they could be fired separately. Of course, they
                kept the one manager who lives in a place with underpaid labor,
                where they are offshoring the work for managing this new AI to
                near-slaves.
              </p>
              <p>
                Of course they were told not to go posting about it on social
                media, and I couldn't find anything yet, so I took it upon
                myself. What a trash company that doesn't care about its people
                one bit.
              </p>
            </div>
          </section>
        </section>
        <section id="40069987">
          <h3>
            <a
              class="item"
              href="https://neverwasmag.com/2019/08/flying-aircraft-carriers/"
              >Flying Aircraft Carriers (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-17 @ 20:57:44</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40069987"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40069599">
          <h3>
            <a class="item" href="https://tonsky.me/blog/centering/"
              >Hardest problem in computer science: centering things</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-17 @ 20:17:11</span
              ><span class="points-container"
                >Points: <span class="points">557</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40069599"
                  >Comments</a
                ><span class="descendants">: 193</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40069583">
          <h3>
            <a
              class="item"
              href="https://bencher.dev/learn/engineering/sqlite-performance-tuning/"
              >Why SQLite Performance Tuning Made Bencher 1200x Faster</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-17 @ 20:15:16</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40069583"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40069298">
          <h3>
            <a
              class="item"
              href="https://outsiderart.substack.com/p/cyc-historys-forgotten-ai-project"
              >Cyc: History's Forgotten AI Project</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-17 @ 19:46:46</span
              ><span class="points-container"
                >Points: <span class="points">202</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40069298"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40069053">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/smart-news/florida-fish-are-mysteriously-dying-after-spinning-and-whirling-and-scientists-cant-explain-it-180984073/"
              >Florida Fish Are Mysteriously Dying After 'Spinning and
              Whirling,'</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-17 @ 19:24:04</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40069053"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40068187">
          <h3>
            <a class="item" href="https://antithesis.com/blog/sdtalk/"
              >How Antithesis finds bugs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-17 @ 18:07:01</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40068187"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40067939">
          <h3>
            <a
              class="item"
              href="https://www.consumerfinance.gov/about-us/newsroom/cfpb-takes-action-against-coding-boot-camp-bloomtech-and-ceo-austen-allred-for-deceiving-students-and-hiding-loan-costs/"
              >CFPB Takes Action Against Coding Boot Camp BloomTech and CEO
              Austen Allred</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-17 @ 17:48:31</span
              ><span class="points-container"
                >Points: <span class="points">501</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40067939"
                  >Comments</a
                ><span class="descendants">: 217</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40067677">
          <h3>
            <a
              class="item"
              href="https://asciinema.org/a/piP22yYwcaohu5cA2gyuv1W61"
              >Show HN: Speeding up LLM inference 2x times (possibly)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-17 @ 17:26:09</span
              ><span class="points-container"
                >Points: <span class="points">312</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40067677"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
            <div class="text">
              <p>
                It's a new (I think) algorithm, that allows to adjust smoothly -
                and in real time - how many calculations you'd like to do during
                inference of an LLM model.
              </p>
              <p>
                It seems that it's possible to do just 20-25% of weight
                multiplications instead of all of them, and still get good
                inference results.
              </p>
              <p>
                I implemented it to run on M1/M2/M3 GPU. The mmul approximation
                itself can be pushed to run 2x fast before the quality of output
                collapses.
              </p>
              <p>
                The inference speed is just a bit faster than Llama.cpp's,
                because the rest of implementation could be better, but with a
                better development I think it can be a new method to speed up
                inference - in addition to quantization.
              </p>
              <p>You could call it ad-hoc model distillation :)</p>
              <p>
                You can change the speed / accuracy of a model at will, in real
                time.
              </p>
              <p>
                Oh, and as a side effect, the data format allows to also choose
                how much of the model you want to load into the memory. You can
                decide to skip say 10-20-40% of the least important weights.
              </p>
              <p>
                It's implemented for Mistral, it was also tested slightly on
                Mixtral and Llama. It's for FP16 for now, but Q8 is in the
                works.
              </p>
              <p>
                The algorithm is described here, and the implementation is open
                source.
              </p>
              <p>
                <a href="https://kolinko.github.io/effort/"
                  >https://kolinko.github.io/effort/</a
                >
              </p>
              <p>
                I know these are bold claims, but I hope they survive the
                scrutiny :)
              </p>
            </div>
          </section>
        </section>
        <section id="40067605">
          <h3>
            <a
              class="item"
              href="https://www.businessinsider.com/why-reddit-is-taking-over-google-right-now-2024-4"
              >Reddit is taking over Google</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-17 @ 17:20:32</span
              ><span class="points-container"
                >Points: <span class="points">224</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40067605"
                  >Comments</a
                ><span class="descendants">: 292</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40067486">
          <h3>
            <a
              class="item"
              href="https://bawolf.substack.com/p/embeddings-are-a-good-starting-point"
              >Embeddings are a good starting point for the AI curious app
              developer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-17 @ 17:09:14</span
              ><span class="points-container"
                >Points: <span class="points">538</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40067486"
                  >Comments</a
                ><span class="descendants">: 149</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40067206">
          <h3>
            <a
              class="item"
              href="https://newsletter.pessimistsarchive.org/p/the-forgotten-war-on-beepers"
              >The forgotten war on beepers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-17 @ 16:47:21</span
              ><span class="points-container"
                >Points: <span class="points">219</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40067206"
                  >Comments</a
                ><span class="descendants">: 298</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40065821">
          <h3>
            <a class="item" href="https://github.com/mitchellh/libxev"
              >libxev: A cross-platform, high-performance event loop</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-17 @ 15:11:26</span
              ><span class="points-container"
                >Points: <span class="points">218</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40065821"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40064105">
          <h3>
            <a
              class="item"
              href="https://bostondynamics.com/blog/electric-new-era-for-atlas/"
              >An electric new era for Atlas</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-17 @ 13:12:14</span
              ><span class="points-container"
                >Points: <span class="points">382</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40064105"
                  >Comments</a
                ><span class="descendants">: 384</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40063803">
          <h3>
            <a class="item" href="https://github.com/WINSDK/bite"
              >Show HN: BiTE – Cross-platform executable viewer and reverse
              engineering tool</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-17 @ 12:39:49</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40063803"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
            <div class="text">
              <p>
                I’m excited to share a project I’ve been working on throughout
                my university studies. It’s called BiTE (<a
                  href="https://github.com/WINSDK/bite"
                  >https://github.com/WINSDK/bite</a
                >) and it's a tool primarily focused on being an executable
                viewer with reverse engineering capabilities.
              </p>
              <p>
                BiTE supports Windows, MacOS, and Linux, along with their
                associated executable formats. It’s also capable of parsing and
                displaying debug information using DWARF/PDB formats, which I
                hope will be useful even for just comparing codegen.
              </p>
              <p>
                I’ve put a lot of effort into this and it's the first time I'm
                releasing something like this publicly. Any feedback, bug
                reports, or feature suggestions would be greatly appreciated!
              </p>
            </div>
          </section>
        </section>
        <section id="40063367">
          <h3>
            <a
              class="item"
              href="https://johnhawks.net/weblog/how-many-bathrooms-have-neandertals-in-the-tile/"
              >How many bathrooms have Neanderthals in the tile?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-17 @ 12:00:32</span
              ><span class="points-container"
                >Points: <span class="points">447</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40063367"
                  >Comments</a
                ><span class="descendants">: 210</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40062867">
          <h3>
            <a
              class="item"
              href="https://newatlas.com/biology/fractal-molecule-natural-mathematical-marvel/"
              >First known fractal molecule</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-17 @ 10:57:52</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40062867"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40060939">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/features/2024-streits-matzo-factory-passover/"
              >How Matzo Is Made</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-17 @ 05:52:57</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40060939"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40060838">
          <h3>
            <a class="item" href="https://www.fon.hum.uva.nl/praat/"
              >Praat: Doing Phonetics by Computer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-17 @ 05:33:55</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40060838"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40049258">
          <h3>
            <a class="item" href="https://onlyspans.net/"
              >Only &lt;span&gt;s&lt;/span&gt;</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-16 @ 07:29:03</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40049258"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40045940">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-04-scientists-mystery-moon-lopsided-geology.html"
              >Scientists solve long-standing mystery surrounding the moon's
              'lopsided' geology</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-15 @ 21:39:03</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40045940"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
