<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40138830">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2024/04/the-spam-came-from-inside-the-house-how-a-smart-tv-can-choke-a-windows-pc/"
              >The spam came from inside the house: How a smart TV can choke a
              Windows PC</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-24 @ 00:03:06</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40138830"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40138676">
          <h3>
            <a
              class="item"
              href="https://www.anthropic.com/research/probes-catch-sleeper-agents"
              >Simple probes can catch sleeper agents</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-23 @ 23:40:36</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40138676"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40138579">
          <h3>
            <a
              class="item"
              href="https://xlinux.nist.gov/dads/HTML/americanFlagSort.html"
              >American Flag Sort</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-23 @ 23:26:58</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40138579"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40138549">
          <h3>
            <a
              class="item"
              href="https://apnews.com/article/noisy-cicadas-south-carolina-police-39f2bd760a51c8c1d28d88b12473840e"
              >Cicadas are so noisy in South Carolina that residents are calling
              the police</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-23 @ 23:23:50</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40138549"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40138193">
          <h3>
            <a
              class="item"
              href="http://www.lel.ed.ac.uk/~gpullum/loopsnoop.html"
              >Scooping the Loop Snooper (2000)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-23 @ 22:42:12</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40138193"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40137952">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/smart-news/music-is-now-illegal-in-chechnyaif-it-doesnt-meet-authorities-tempo-restrictions-180984159/"
              >Chechnya bans music outside the range of 80-116 beats per
              minute</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-23 @ 22:09:58</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40137952"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40137201">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/shortbread/jobs/8jV0RY9-founding-engineer"
              >Shortbread (YC W23) is hiring a founding engineer in SF for AI
              comics creation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-23 @ 21:01:02</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40137027">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40137027"
              >Ask HN: How to improve PCB prototyping iteration time?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-23 @ 20:42:53</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40137027"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
            <div class="text">
              I'm building wearable tech, and the JLCPCB lead times are my
              biggest bottleneck for iteration. 3-4 weeks is way too long. Has
              anyone figured out a way to make this quicker? Strongly
              considering moving to Shenzen to build the prototype. Has anyone
              done this, and was it quicker/worth it?
            </div>
          </section>
        </section>
        <section id="40136440">
          <h3>
            <a
              class="item"
              href="https://agupubs.onlinelibrary.wiley.com/doi/10.1029/2023SW003807"
              >Digitized Continuous Magnetic Recordings for the 1859 Carrington
              Event</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-23 @ 19:50:45</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40136440"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40136208">
          <h3>
            <a class="item" href="https://graph.henryn.ca"
              >Network visualization of 50k blogs and links</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-23 @ 19:33:21</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40136208"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40136076">
          <h3>
            <a
              class="item"
              href="https://www.willusher.io/graphics/2024/04/22/webgpu-marching-cubes"
              >GPU compute in the browser at the speed of native: WebGPU
              marching cubes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-23 @ 19:22:22</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40136076"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40136026">
          <h3>
            <a class="item" href="https://github.com/dafny-lang/dafny"
              >Dafny is a verification-aware programming language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-23 @ 19:18:00</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40136026"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40136010">
          <h3>
            <a
              class="item"
              href="https://www.ftc.gov/news-events/news/press-releases/2024/04/ftc-announces-rule-banning-noncompetes"
              >FTC announces rule banning noncompetes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-23 @ 19:17:07</span
              ><span class="points-container"
                >Points: <span class="points">923</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40136010"
                  >Comments</a
                ><span class="descendants">: 363</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40135942">
          <h3>
            <a
              class="item"
              href="https://spritely.institute/news/spritely-goblins-v0130-object-persistence-and-easier-io.html"
              >Spritely Goblins v0.13.0: Object persistence and easier IO</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-23 @ 19:11:10</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40135942"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40135458">
          <h3>
            <a class="item" href="https://github.com/thomiceli/opengist"
              >Opengist: Open-source alternative to GitHub Gists</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-23 @ 18:33:12</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40135458"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40134921">
          <h3>
            <a
              class="item"
              href="https://www.theturnsignalblog.com/apples-risky-bet-on-carplay/"
              >Apple's risky bet on CarPlay</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-23 @ 17:54:52</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40134921"
                  >Comments</a
                ><span class="descendants">: 206</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40134534">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/2024/04/22/intel-meteor-lakes-npu/"
              >Intel Meteor Lake's NPU</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-23 @ 17:24:04</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40134534"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40133976">
          <h3>
            <a
              class="item"
              href="https://www.wheresyoured.at/the-men-who-killed-google/"
              >The man who killed Google Search?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-23 @ 16:43:59</span
              ><span class="points-container"
                >Points: <span class="points">1054</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40133976"
                  >Comments</a
                ><span class="descendants">: 478</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40132719">
          <h3>
            <a
              class="item"
              href="https://twitter.com/gf_256/status/1782656618015904103"
              >Reverse engineering a software crack</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-23 @ 14:58:23</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40132719"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40132373">
          <h3>
            <a class="item" href="https://getada.dev"
              >Show HN: Getada: rustup-like installer for Ada's
              toolchain/package manager</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-23 @ 14:26:26</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40132373"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
            <div class="text">
              <p>
                Getada was inspired by Rustup[2] and aside from the init script
                is written entirely in Ada.
              </p>
              <p>
                It's completely open source and you can check out the readme and
                code on github[3]. It currently supports all non-windows
                platforms that Alire has an official release for, which at
                present is Linux (glibc) and MacOS. If you try running it on an
                unsupported platform, it tries to point you in the right
                direction. For example, you can install Alire on windows with an
                already-existing installer.
              </p>
              <p>
                It downloads the latest version of Alire[4] (Ada's toolchain and
                package manager, similar to Cargo) for your platform as a zip
                file to a temporary directory and then extracts it to a binary
                directory. By default the temporary directory (configure with
                "-t /directory" or "--tmp=/directory") defaulted to $TMPDIR or
                /tmp. The config directory is ~/.getada (change via "-c
                /directory", "--cfg=/directory", or $GETADA_CFG), and the alr
                and getada binaries go in ~/.getada/bin (configure with ""-b
                /directory", "--bin=/directory", or $GETADA_BIN). It also tries
                to add the file to your path by dropping a "env.sh" file into
                ~/.profile/ (disable with -p or --no-path).
              </p>
              <p>
                If you don't allow executables in temporary or home directories,
                you can change all of these via environmental variables or
                passing parameters.
              </p>
              <p>You can remove it all by running: getada --uninstall</p>
              <p>
                Now you can create a brand new Ada project with: alr init --bin
                my_project (How to use Alire[5] for more details)
              </p>
              <p>
                Since one of the biggest complaints about Ada is getting the
                toolchain [6], I hope this can solve a lot of problems for
                newcomers to the language.
              </p>
              <p>
                [1] <a href="https://www.getada.dev">https://www.getada.dev</a>
              </p>
              <p>[2] <a href="https://rustup.rs/">https://rustup.rs/</a></p>
              <p>
                [3]
                <a href="https://github.com/aj-ianozi/getada"
                  >https://github.com/aj-ianozi/getada</a
                >
              </p>
              <p>
                [4] <a href="https://alire.ada.dev/">https://alire.ada.dev/</a>
              </p>
              <p>
                [5]
                <a href="https://www.getada.dev/how-to-use-alire.html"
                  >https://www.getada.dev/how-to-use-alire.html</a
                >
              </p>
              <p>
                [6]
                <a href="https://programming.dev/comment/9438211"
                  >https://programming.dev/comment/9438211</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="40132281">
          <h3>
            <a
              class="item"
              href="https://aethermug.com/posts/the-beautiful-dissociation-of-the-japanese-language"
              >The beautiful dissociation of the Japanese language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-23 @ 14:17:20</span
              ><span class="points-container"
                >Points: <span class="points">248</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40132281"
                  >Comments</a
                ><span class="descendants">: 167</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40131674">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/mathematicians-marvel-at-crazy-cuts-through-four-dimensions-20240422/"
              >Mathematicians marvel at 'crazy' cuts through four dimensions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-23 @ 13:21:14</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40131674"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40130924">
          <h3>
            <a
              class="item"
              href="https://leanprover-community.github.io/con-nf//"
              >New Foundations is consistent â€“ a difficult mathematical proof
              proved using Lean</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-23 @ 12:01:03</span
              ><span class="points-container"
                >Points: <span class="points">246</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40130924"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40130304">
          <h3>
            <a class="item" href="https://www.balanc3dgame.com/"
              >Show HN: Balancing game for the mobile browser with increasing
              difficulty</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-23 @ 10:22:15</span
              ><span class="points-container"
                >Points: <span class="points">271</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40130304"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
            <div class="text">
              I made this 10 level Game. Excited for people to try it. :) Stay
              Balanced :)
            </div>
          </section>
        </section>
        <section id="40130148">
          <h3>
            <a
              class="item"
              href="https://webkit.org/blog/15269/help-us-invent-masonry-layouts-for-css-grid-level-3/"
              >Help us invent CSS Grid Level 3, a.k.a. "Masonry" layout</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-23 @ 09:32:30</span
              ><span class="points-container"
                >Points: <span class="points">482</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40130148"
                  >Comments</a
                ><span class="descendants">: 314</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40129225">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40129225"
              >Ask HN: How does deploying a fine-tuned model work</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-23 @ 06:48:32</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40129225"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
            <div class="text">
              If I've managed to build my own model, say a fine-tuned version of
              Llama and trained it on some GPUs, how do I then deploy it and use
              it in an app. Does it need to be running on the GPUs all the time
              or can I host the model on a web server or something. Sorry if
              this is an obvious/misinformed question, I'm a beginner in this
              space
            </div>
          </section>
        </section>
        <section id="40128837">
          <h3>
            <a class="item" href="https://sfxr.me/"
              >Jsfxr: 8-Bit sound maker and sfx generator</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-23 @ 05:35:25</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40128837"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40126751">
          <h3><a class="item" href="https://www.krazam.tv/">Krazam OS</a></h3>
          <section>
            <h4>
              <span>2024-04-22 @ 23:38:43</span
              ><span class="points-container"
                >Points: <span class="points">861</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40126751"
                  >Comments</a
                ><span class="descendants">: 169</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40114127">
          <h3>
            <a
              class="item"
              href="https://vgnotepad.blogspot.com/2024/04/bottle-plotter.html"
              >Bottle Plotter</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-22 @ 13:26:02</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40114127"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40113575">
          <h3>
            <a
              class="item"
              href="https://petapixel.com/2024/04/21/how-a-photographer-captured-his-spectacular-dream-eclipse-photo/"
              >How a photographer captured his eclipse photo</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-22 @ 12:11:02</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40113575"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
