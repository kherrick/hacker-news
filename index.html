<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="35889743">
          <h3>
            <a
              class="item"
              href="https://huggingface.co/docs/transformers/transformers_agents"
              >Hugging Face Releases Agents</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 16:33:41</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35889743"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35889627">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=35889627"
              >Ask HN: Resources to Grow Breadth and Depth as a Software
              Engineer?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 16:25:11</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35889627"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
            <div class="text">
              <p>
                Whether it's about specific programming languages, design
                patterns, algorithms, data structures, software architecture, or
                even soft skills related to engineering, I'd love to hear about
                the resources you've found most valuable in your own journey.
              </p>
              <p>
                I'd appreciate any pointers to recent threads discussing the
                same topic. If there's already an active discussion, please let
                me know, and I'll happily remove this post to avoid redundancy.
              </p>
              <p>Thanks all in advance!</p>
            </div>
          </section>
        </section>
        <section id="35889507">
          <h3>
            <a
              class="item"
              href="https://icing.space/2022/the-missing-app-economy"
              >The Missing App Economy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 16:16:00</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35889507"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35889319">
          <h3>
            <a
              class="item"
              href="https://www.foxnews.com/world/spain-asks-us-clean-1966-nuclear-accident-site"
              >Spain asks US to clean up site of 1966 nuclear accident</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 16:03:06</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35889319"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35888853">
          <h3>
            <a
              class="item"
              href="https://stackdiary.com/githubs-new-code-search-is-bad/"
              >GitHub's New Code Search Is Bad for Finding Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 15:32:14</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35888853"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35888644">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=35888644"
              >Launch HN: Clearspace (YC W23) – Cut back on screen time</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 15:19:16</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35888644"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.getclearspace.com"
                >https://www.getclearspace.com</a
              >). We make an iPhone app that helps you reduce compulsive phone
              use. It regulates your social media experiences and app usage,
              saving you from impulse opens and mindless scrolls. Here’s a demo:
              <a
                href="https://drive.google.com/file/d/1zXLYvtG1zZ6ZRq01eGc8jlsn70vlUZLj/view"
                >https://drive.google.com/file/d/1zXLYvtG1zZ6ZRq01eGc8jlsn70v...</a
              >
              <p>
                During the pandemic, we found ourselves spending more and more
                of our lives on digital content. Youtube, Instagram, Twitter,
                even HN were always <i>right</i> there, and the impulse to open
                and consume became stronger than ever. We realized how much of
                our technology use was compulsive rather than intentional.
                Willpower alone was not enough to solve the problem. Most of
                these products have been designed to activate dopamine feedback
                loops and, to be blunt, keep users hooked [1].
              </p>
              <p>
                Not wanting to be addicted, we started cobbling together
                "attention protection stacks": iPhone shortcuts, Chrome
                Extensions, custom /etc/ files, anything to create digital
                environments that aligned with our own goals rather than the
                engagement metrics of big tech. We had some surprising successes
                with that, so we decided to build a comprehensive and
                approachable solution. We began with our worst pain point:
                mindless scrolling on our phones.
              </p>
              <p>
                How it works: you tell us what apps you want to reduce your
                usage of, and we do the following to train better habits:
              </p>
              <p>
                (1) App Intercepts: we inject a mandatory 15 second breathing
                exercise before opening apps you’ve added to Clearspace. This
                helps to break the dopamine feedback loop that your brain has
                learned, where tapping an app icon yields an instant reward.
              </p>
              <p>
                (2) Intentional Sessions: at the end of said breathing exercise,
                you tell us how long you want to use an app for. Then you enter
                and we'll pull you out after that amount of time.
              </p>
              <p>
                (3) Cumulative Progress: each day you stay below your intended
                time limit adds to your streak of successes. Over time,
                protecting your streak frequently becomes more important than a
                "quick scroll" before bed (and if you get a 100 day under-budget
                streak, we'll send you a hat).
              </p>
              <p>
                (4) Teammates: you can add “teammates” who will receive
                automatic texts if you exceed your budget on an app, remove it
                from Clearspace, or delete Clearspace entirely.
              </p>
              <p>
                You may notice how this is fighting fire with fire: we use tech
                to limit your tech use, social features to curtail social media,
                and so on. The mechanisms built into the big apps have such a
                conditioning effect on the brain, they’re nearly impossible for
                most people to resist. We invoke similarly powerful mechanisms
                on <i>your</i> behalf, to help your life be less dominated by
                these things.
              </p>
              <p>
                Some of this only recently became technically possible. The new
                ScreenTime API from Apple allows users to connect apps on their
                phone to third party apps (like us). We receive opaque "tokens"
                for each user app selection and we can perform actions on the
                tokens, which affects the apps without us knowing what the
                actual apps are. We can add and remove "shields" to a token,
                which presents an obstructing interface over an app or website.
                We can display a user's usage of a token over a time period and
                display that data to them.
              </p>
              <p>
                Btw, after 3M "app intercepts" (a 15 second wait), we’ve found
                that people opt <i>not</i> to continue to the app they tried to
                open 54% of the time. We think that says something about how
                much of our social media use as a society is compulsive rather
                than intentional.
              </p>
              <p>
                Here are some typical testimonials from users who have been
                recovering their time by using our app:
                <a
                  href="https://twitter.com/martindaniel4/status/1630175865496584193"
                  >https://twitter.com/martindaniel4/status/1630175865496584193</a
                >,
                <a href="https://twitter.com/timzyu/status/1632551744340123650"
                  >https://twitter.com/timzyu/status/1632551744340123650</a
                >,
                <a
                  href="https://twitter.com/jandralee/status/1650674167174377473"
                  >https://twitter.com/jandralee/status/1650674167174377473</a
                >
              </p>
              <p>
                If you're an iPhone user, we'd love for you to try our app and
                let us know what you think! We have a freemium model: adding one
                app is free, paid tier gives you unlimited apps. Your feedback
                on the app would be deeply appreciated and more broadly we’d
                love to hear about how you’ve navigated this problem in your
                life.
              </p>
              <p>
                [1] though maybe not HN:
                <a href="https://news.ycombinator.com/item?id=77173"
                  >https://news.ycombinator.com/item?id=77173</a
                >,
                <a href="https://news.ycombinator.com/item?id=372593"
                  >https://news.ycombinator.com/item?id=372593</a
                >.
              </p>
            </div>
          </section>
        </section>
        <section id="35888509">
          <h3>
            <a class="item" href="https://maia.crimew.gay/posts/optimeyes-leak/"
              >Infosec company owned completely by 4chan user</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 15:10:19</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35888509"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35888024">
          <h3>
            <a
              class="item"
              href="https://fortune.com/2023/05/10/exclusive-google-recruitment-ghire-gdpr-violation-whistleblower/"
              >Google breaking European privacy law by hoarding personal data of
              job candidates</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 14:37:48</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35888024"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35887983">
          <h3>
            <a
              class="item"
              href="https://ashvardanian.com/posts/abusing-vector-search/"
              >Abusing Vector Search for Texts, Maps, and Chess</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 14:34:27</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35887983"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35887766">
          <h3>
            <a
              class="item"
              href="https://www.saaspegasus.com/about/how-pegasus-works/"
              >A Codebase That Makes Codebases</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 14:20:27</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35887766"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35887734">
          <h3>
            <a
              class="item"
              href="https://www.helionenergy.com/articles/announcing-helion-fusion-ppa-with-microsoft-constellation/"
              >Helion’s fusion power purchase agreement with Microsoft</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 14:18:31</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35887734"
                  >Comments</a
                ><span class="descendants">: 155</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35887680">
          <h3>
            <a
              class="item"
              href="https://wasmlabs.dev/articles/wasm-host-to-python/"
              >Extending web applications with WebAssembly and Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 14:13:42</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35887680"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35887349">
          <h3>
            <a
              class="item"
              href="https://hakaimagazine.com/features/shining-the-light-on-baby-crabs/"
              >Shining the Light on Baby Crabs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 13:51:12</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35887349"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35887239">
          <h3>
            <a
              class="item"
              href="https://thebaffler.com/outbursts/bad-manors-wagner"
              >Bad Manors: The McMansion as Harbinger</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 13:42:29</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35887239"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35886900">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=35886900"
              >Ask HN: What is new in Algorithms / Data Structures these
              days?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 13:16:21</span
              ><span class="points-container"
                >Points: <span class="points">196</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35886900"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
            <div class="text">
              <p>Care to share any of the favorite recent results?</p>
              <p>
                Are there big fields still making gains behind all this
                computing surge?
              </p>
            </div>
          </section>
        </section>
        <section id="35886559">
          <h3>
            <a class="item" href="https://io.google/2023/">Google I/O 2023</a>
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 12:49:06</span
              ><span class="points-container"
                >Points: <span class="points">248</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35886559"
                  >Comments</a
                ><span class="descendants">: 175</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35886288">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=35886288"
              >We should start to add “ai.txt” as we do for “robots.txt”</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 12:20:05</span
              ><span class="points-container"
                >Points: <span class="points">339</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35886288"
                  >Comments</a
                ><span class="descendants">: 179</span></span
              >
            </h4>
            <div class="text">
              <p>
                It can be great if the website somehow ends up in a training
                dataset (who knows), and it can be super helpful for AI website
                crawlers, instead of using thousands of tokens to know what your
                website is about, they can do it with just a few hundred.
              </p>
            </div>
          </section>
        </section>
        <section id="35886103">
          <h3>
            <a class="item" href="https://github.com/DNedic/lockfree"
              >A collection of lock-free data structures written in standard
              C++11</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 11:56:14</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35886103"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35886033">
          <h3>
            <a class="item" href="https://trygalaxy.com/"
              >Try Galaxy: A web app to demo Samsung’s OS on an iPhone</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 11:42:18</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35886033"
                  >Comments</a
                ><span class="descendants">: 123</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35885797">
          <h3>
            <a
              class="item"
              href="https://mazzzystar.github.io/2023/05/10/LLM-for-individual/"
              >The Leverage of LLMs for Individuals</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 11:01:25</span
              ><span class="points-container"
                >Points: <span class="points">349</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35885797"
                  >Comments</a
                ><span class="descendants">: 214</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35885342">
          <h3>
            <a
              class="item"
              href="https://www.teamblind.com/post/My-friends-who-cheated-in-interviews-are-getting-promoted-😡😡😡😡-XnYM4nLs"
              >My friends who cheated in interviews are getting promoted
              (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 09:26:31</span
              ><span class="points-container"
                >Points: <span class="points">285</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35885342"
                  >Comments</a
                ><span class="descendants">: 536</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35885066">
          <h3>
            <a class="item" href="https://github.com/ipyflow/ipyflow"
              >IPyflow: Reactive Python Notebooks in Jupyter(Lab)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 08:30:03</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35885066"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35884668">
          <h3>
            <a
              class="item"
              href="https://blog.koehntopp.info/2023/05/06/50-years-in-filesystems-1984.html"
              >50 years in filesystems: 1984 BSD FFS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 07:23:23</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35884668"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35884437">
          <h3>
            <a class="item" href="https://subtls.pages.dev/"
              >See this page fetch itself, byte by byte, over TLS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 06:51:33</span
              ><span class="points-container"
                >Points: <span class="points">898</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35884437"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35884083">
          <h3>
            <a class="item" href="https://twinbasic.com/preview.html"
              >TwinBASIC is a modern BASIC compiler</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 05:50:14</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35884083"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35883910">
          <h3>
            <a
              class="item"
              href="https://groups.google.com/a/chromium.org/g/ct-policy/c/S17_j-WJ6dI"
              >Random bit-flip invalidates certificate transparency log –
              again?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 05:18:22</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35883910"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35883891">
          <h3>
            <a class="item" href="https://compute.toys/"
              >An experimental editor for WebGPU compute shaders</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 05:15:50</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35883891"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35883777">
          <h3>
            <a class="item" href="https://physics.aps.org/articles/v16/s64"
              >Large Photonic Processor Solves Graph Problems</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 04:55:31</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35883777"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35882985">
          <h3>
            <a
              class="item"
              href="https://github.com/wqweto/VbAsyncSocket/blob/master/src/mdTlsThunks.bas"
              >A TLS 1.3 stack written in Visual Basic 6</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 02:34:52</span
              ><span class="points-container"
                >Points: <span class="points">255</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35882985"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35873686">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Darvaza_gas_crater"
              >Darvaza Gas Crater</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 12:59:39</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35873686"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
