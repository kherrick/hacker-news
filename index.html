<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40925025">
          <h3>
            <a class="item" href="https://www.simsig.co.uk/"
              >SimSig: Railway Signalling Simulations</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-10 @ 09:02:16</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40925025"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40924915">
          <h3>
            <a
              class="item"
              href="https://www.esa.int/Enabling_Support/Space_Transportation/Ariane/Europe_s_new_Ariane_6_rocket_powers_into_space"
              >Europe's new Ariane 6 rocket powers into space</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-10 @ 08:42:12</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40924915"
                  >Comments</a
                ><span class="descendants">: 122</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40924368">
          <h3>
            <a
              class="item"
              href="https://jobs.lever.co/photoroom/fc379626-eb33-4eb6-839c-10e5d578e2ed?lever-origin=applied&amp;lever-source%5B%5D=yc"
              >Photoroom (YC S20) Is Hiring Rust Developers in Paris
              (X-Platform, Wgpu, WASM)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-10 @ 07:00:40</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40922884">
          <h3>
            <a
              class="item"
              href="https://www.jetify.com/blog/automated-dev-envs-with-devbox-and-direnv/"
              >Automate Project Environments with Devbox and Direnv</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-10 @ 01:13:11</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40922884"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40922874">
          <h3>
            <a
              class="item"
              href="https://exrocketman.blogspot.com/2021/12/the-seal-failure-in-srb-that-doomed.html"
              >The Seal Failure in the SRB That Doomed Challenger (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-10 @ 01:11:00</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40922874"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40922740">
          <h3>
            <a class="item" href="https://www.awsviz.dev/"
              >Awsviz.dev simplifying AWS IAM policies</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-10 @ 00:35:48</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40922740"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40922739">
          <h3>
            <a class="item" href="https://github.com/lm-sys/RouteLLM"
              >RouteLLM: A framework for serving and evaluating LLM routers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-10 @ 00:35:38</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40922739"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40921038">
          <h3>
            <a
              class="item"
              href="https://aiencoder.substack.com/p/graphrag-analysis-part-1-how-indexing"
              >Knowledge Graphs in RAG: Hype vs. Ragas Analysis</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-09 @ 21:00:00</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40921038"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40920681">
          <h3>
            <a
              class="item"
              href="https://github.com/maelstrom-software/maelstrom"
              >Show HN: Maelstrom â€“ A Hermetic, Clustered Test Runner for Python
              and Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-09 @ 20:23:12</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40920681"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
            <div class="text">
              <p>
                Maelstrom is a suite of tools for running tests in hermetic
                micro-containers locally on your machine or distributed across
                arbitrarily large clusters. Maelstrom currently has test runners
                for Rust and Python, with more on the way. You might use
                Maelstrom to run your tests because:
              </p>
              <p></p>
              <pre><code>  * It's easy. Maelstrom functions as a drop-in replacement for cargo test and pytest. In most cases, it just works with your existing tests with minimal configuration.
  * It's reliable. Maelstrom runs every test hermetically in its own lightweight container, eliminating confusing errors caused by inter-test or implicit test-environment dependencies.
  * It's scalable. Maelstrom can be run as a cluster. You can add more worker machines to linearly increase test throughput.
  * It's clean. Maelstrom has built a rootless container implementation (not relying on Docker or RunC) from scratch, in Rust, optimized to be low-overhead and start quickly.
  * It's fast. In most cases, Maelstrom is faster than cargo test, even without using clustering. Maelstromâ€™s test-per-process model is inherently slower than pytestâ€™s shared-process model, but Maelstrom provides test isolation at a low performance cost.
</code></pre>
              While our focus thus far has been on running tests, Maelstrom's
              underlying job execution system is general-purpose. We provide a
              command line utility to run arbitrary commands, as well a
              gRPC-based API and Rust bindings for programmatic access and
              control.
              <p>
                Feedback and questions are welcome! Thanks for giving it a
                whirl.
              </p>
            </div>
          </section>
        </section>
        <section id="40920246">
          <h3>
            <a
              class="item"
              href="https://flyingcarcomputer.com/posts/how-to-validate-market-with-development-board/"
              >How to validate a market with development boards and SD cards</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-09 @ 19:47:32</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40920246"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40920122">
          <h3>
            <a
              class="item"
              href="https://tedium.co/2024/07/06/compact-disc-pregap-history/"
              >How CD pregaps gained their hidden track superpowers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-09 @ 19:38:36</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40920122"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40919288">
          <h3>
            <a
              class="item"
              href="https://allaboutperformance.wordpress.com/2016/05/11/the-price-of-gold-how-bad-do-you-really-want-it/"
              >The price of gold â€“ how bad do you want it? (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-09 @ 18:28:49</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40919288"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40919253">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2024/07/08/github_copilot_dmca/"
              >Judge dismisses DMCA copyright claim in GitHub Copilot suit</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-09 @ 18:25:03</span
              ><span class="points-container"
                >Points: <span class="points">259</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40919253"
                  >Comments</a
                ><span class="descendants">: 291</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40918152">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40918152"
              >Ask HN: How do browsers isolate internal audio from microphone
              input?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-09 @ 16:45:01</span
              ><span class="points-container"
                >Points: <span class="points">194</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40918152"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
            <div class="text">
              <p>
                Does anyone know how Chrome and Chromium achieve this audio
                isolation?
              </p>
              <p>
                Given that Chromium is open source, it would be helpful if
                someone could point me to the specific part of the codebase that
                handles this. Any insights or technical details would be greatly
                appreciated!
              </p>
            </div>
          </section>
        </section>
        <section id="40916786">
          <h3>
            <a class="item" href="https://turbopuffer.com/blog/turbopuffer"
              >Turbopuffer: Fast search on object storage</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-09 @ 14:48:59</span
              ><span class="points-container"
                >Points: <span class="points">243</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40916786"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40916193">
          <h3>
            <a
              class="item"
              href="https://www.orionreed.com/posts/scoped-propagators"
              >Scoped Propagators</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-09 @ 13:54:59</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40916193"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40915082">
          <h3>
            <a class="item" href="https://robertheaton.com/pyskywifi/"
              >PySkyWiFi: Free stupid wi-fi on long-haul flights</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-09 @ 12:01:37</span
              ><span class="points-container"
                >Points: <span class="points">764</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40915082"
                  >Comments</a
                ><span class="descendants">: 366</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40915005">
          <h3>
            <a class="item" href="https://github.com/facebookresearch/MobileLLM"
              >MobileLLM: Optimizing Sub-Billion Parameter Language Models for
              On-Device Use</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-09 @ 11:48:42</span
              ><span class="points-container"
                >Points: <span class="points">223</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40915005"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40914958">
          <h3>
            <a class="item" href="https://circos.ca/"
              >Circos â€“ Circular Visualization</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-09 @ 11:44:40</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40914958"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40914475">
          <h3>
            <a
              class="item"
              href="https://thiscontext.com/2023/07/26/dynamic-translation-of-smalltalk-to-webassembly/"
              >Dynamic translation of Smalltalk to WebAssembly</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-09 @ 10:34:20</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40914475"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40913138">
          <h3>
            <a
              class="item"
              href="https://blog.westerndigital.com/race-to-seal-helium/"
              >The Race to Seal Helium HDDs (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-09 @ 06:42:34</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40913138"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40911500">
          <h3>
            <a class="item" href="https://github.com/zherczeg/sljit"
              >Sljit: Platform independent low-level JIT compiler</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-09 @ 00:54:13</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40911500"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40906210">
          <h3>
            <a class="item" href="http://spotthedrowningchild.com/"
              >Spot the Drowning Child (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 15:21:01</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40906210"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40906148">
          <h3>
            <a class="item" href="https://conduition.io/coding/ticketmaster/"
              >Reverse engineering Ticketmaster's rotating barcodes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-08 @ 15:14:06</span
              ><span class="points-container"
                >Points: <span class="points">2036</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40906148"
                  >Comments</a
                ><span class="descendants">: 666</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40901224">
          <h3>
            <a
              class="item"
              href="https://www.otherbranch.com/blog/rebooting-something-like-triplebyte"
              >Rebooting (something like) early Triplebyte</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-07 @ 23:01:47</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40901224"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40898715">
          <h3>
            <a
              class="item"
              href="https://garrettdbates.com/2024/07/07/why-use-onion-layering.html"
              >Why Use Onion Layering?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-07 @ 16:44:04</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40898715"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40898525">
          <h3>
            <a
              class="item"
              href="https://www.amiplus.ca/m/eCGPTwFA/deep-sky-eye?seriesId=Show%2FOur+Community"
              >Tim Doucette, a blind astronomer who built the Deep Sky Eye
              Observatory</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-07 @ 16:04:41</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40898525"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40895026">
          <h3>
            <a
              class="item"
              href="https://www.key.aero/article/did-germanys-lockheed-f-104-deserve-its-bad-name"
              >Starfighter Scandal: Did Germany's Lockheed F-104</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-07 @ 03:16:37</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40895026"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40889272">
          <h3>
            <a
              class="item"
              href="https://medium.com/@abdulgh/compile-time-json-deserialization-in-c-1e3d41a73628"
              >Compile-time JSON deserialization in C++</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-06 @ 09:35:33</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40889272"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40883942">
          <h3>
            <a
              class="item"
              href="https://www.alexreichert.com/blog/graph-based-ceramics"
              >Graph-Based Ceramics</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-05 @ 16:09:51</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40883942"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
