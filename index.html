<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="45467886">
          <h3>
            <a
              class="item"
              href="https://responsiblestatecraft.org/oracle-tiktok-israel-2674151514/"
              >Oracle employees who criticise Israel referred to mental health
              services</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 21:16:12</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45467717">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/truevault/jobs/FaC8Apo-ecommerce-manager-bdr"
              >TrueVault (YC W14) Is Hiring a BDR (Ex-ECommerce Manager)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 21:00:32</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45467543">
          <h3>
            <a
              class="item"
              href="https://earthsky.org/space/new-interstellar-object-candidate-heading-toward-the-sun-a11pl3z/"
              >Interstellar Object 3I/Atlas Passed Mars Last Night</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 20:40:52</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45467543"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45467503">
          <h3>
            <a class="item" href="https://github.com/gianni-rosato/fssimu2"
              >Fast SSIMULACRA2 Implementation in Zig</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 20:36:44</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45467503"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45467500">
          <h3>
            <a
              class="item"
              href="https://www.riksbank.se/en-gb/press-and-published/notices-and-press-releases/press-releases/2025/offline-card-payments-should-be-possible-no-later-than-1-july-2026/"
              >Offline card payments should be possible no later than 1 July
              2026</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 20:36:03</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45467500"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45467166">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/p/amds-epyc-9355p-inside-a-32-core"
              >AMD's EPYC 9355P: Inside a 32 Core Zen 5 Server Chip</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 20:01:36</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45467166"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45467032">
          <h3>
            <a class="item" href="https://russellw.github.io/arenas"
              >Arenas in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 19:47:53</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45467032"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45466675">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=45466675"
              >Ask HN: One-person SaaS apps that are profitable?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 19:15:37</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45466675"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
            <div class="text">
              <p>Editions:</p>
              <p>
                2019 -
                <a href="https://news.ycombinator.com/item?id=19701783"
                  >https://news.ycombinator.com/item?id=19701783</a
                >
              </p>
              <p>
                2016 -
                <a href="https://news.ycombinator.com/item?id=11924009"
                  >https://news.ycombinator.com/item?id=11924009</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="45466655">
          <h3>
            <a
              class="item"
              href="https://www.gridbugs.org/wave-function-collapse/"
              >Procedural Generation with Wave Function Collapse</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 19:13:34</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45466655"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45466588">
          <h3>
            <a class="item" href="https://jules.google/docs/changelog/"
              >Jules, remote coding agent from Google Labs, announces API</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 19:08:11</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45466588"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45466086">
          <h3>
            <a
              class="item"
              href="https://pep-previews--4622.org.readthedocs.build/pep-0810/"
              >PEP 810 – Explicit lazy imports</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 18:24:58</span
              ><span class="points-container"
                >Points: <span class="points">200</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45466086"
                  >Comments</a
                ><span class="descendants">: 115</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45465392">
          <h3>
            <a
              class="item"
              href="https://buttondown.com/blog/ringo-email-as-an-ai-interface"
              >Email was the user interface for the first AI recommendation
              engines</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 17:27:02</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45465392"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45465276">
          <h3>
            <a class="item" href="https://github.com/jackielii/skhd.zig"
              >Simple Hotkey Daemon for macOS, Ported to Zig</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 17:18:21</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45465276"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45464632">
          <h3>
            <a
              class="item"
              href="https://sunshowers.io/posts/cancelling-async-rust/"
              >Cancelling async Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 16:18:29</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45464632"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45464429">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2025/10/03/jeff-bezos-ai-in-an-industrial-bubble-but-society-to-benefit.html"
              >Jeff Bezos says AI is in a bubble but society will get 'gigantic'
              benefits</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 16:00:00</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45464429"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45464360">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=45464360"
              >Ask HN: Why did COM/SOAP/other protocols fail?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 15:54:01</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45464360"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
            <div class="text">
              <p>
                With the recent buzz around MCP, it made me think about what
                I've read about other unifying protocol attempts in the past.
                Why did these 2000s era interoperability protocols fail, and
                what does MCP do different? Was it a matter of security issues
                in a newly networked world? A matter of bad design? A matter of
                being too calcified? I would love to hear from those who were
                around that time.
              </p>
            </div>
          </section>
        </section>
        <section id="45464145">
          <h3>
            <a
              class="item"
              href="https://www.nango.dev/blog/lessons-learned-building-infrastructure-devtool"
              >Lessons learned from building an infrastructure devtool</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 15:33:43</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45464145"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45463319">
          <h3>
            <a
              class="item"
              href="https://blog.nataliethenerd.com/i-turned-the-lego-game-boy-into-a-working-game-boy-part-1/"
              >I turned the Lego Game Boy into a working Game Boy</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 14:18:56</span
              ><span class="points-container"
                >Points: <span class="points">181</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45463319"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45463251">
          <h3>
            <a class="item" href="https://github.com/jmsdnns/webbol"
              >Webbol: A minimal static web server written in COBOL</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 14:13:03</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45463251"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45462713">
          <h3>
            <a
              class="item"
              href="https://flatt.tech/research/posts/arbitrary-code-execution-in-unity-runtime/"
              >Arbitrary code execution in Unity Runtime</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 13:21:44</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45462713"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45462297">
          <h3>
            <a
              class="item"
              href="https://photoblog.nk412.com/Faroe2025/Faroes/n-cPCNFr"
              >The Faroes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 12:41:03</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45462297"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45461500">
          <h3>
            <a class="item" href="https://github.com/YaLTeR/niri"
              >Niri – A scrollable-tiling Wayland compositor</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 11:08:42</span
              ><span class="points-container"
                >Points: <span class="points">402</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45461500"
                  >Comments</a
                ><span class="descendants">: 201</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45458948">
          <h3>
            <a
              class="item"
              href="https://github.com/triton-lang/triton/pull/7298"
              >Fp8 runs ~100 tflops faster when the kernel name has "cutlass" in
              it</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 04:21:23</span
              ><span class="points-container"
                >Points: <span class="points">328</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45458948"
                  >Comments</a
                ><span class="descendants">: 145</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45453936">
          <h3>
            <a class="item" href="https://fly.io/blog/litestream-v050-is-here/"
              >Litestream v0.5.0</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-02 @ 19:02:57</span
              ><span class="points-container"
                >Points: <span class="points">332</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45453936"
                  >Comments</a
                ><span class="descendants">: 154</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45437903">
          <h3>
            <a class="item" href="https://vincentrolfs.dev/blog/ts-var"
              >The Temporal Dead Zone, or why the TypeScript codebase is full of
              var statements</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-01 @ 14:06:45</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45437903"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45427774">
          <h3>
            <a
              class="item"
              href="https://jacobsherin.com/posts/2025-08-16-bplustree-compare-borrow-merge/"
              >A B+Tree Node Underflows: Merge or Borrow?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-30 @ 16:41:25</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45427774"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45423954">
          <h3>
            <a
              class="item"
              href="https://despairlabs.com/blog/posts/2021-06-16-io-uring-is-not-an-event-system/"
              >Io_uring is not an event system (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-30 @ 10:43:01</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45423954"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45423404">
          <h3>
            <a
              class="item"
              href="https://www.notebookcheck.net/Open-Printer-is-an-open-source-inkjet-printer-with-DRM-free-ink-and-roll-paper-support.1126929.0.html"
              >Open Printer is an open source inkjet printer with DRM-free
              ink</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-30 @ 08:57:11</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45423404"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45420722">
          <h3>
            <a class="item" href="https://modernfontstacks.com/"
              >Modern Font Stacks</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-30 @ 00:49:54</span
              ><span class="points-container"
                >Points: <span class="points">292</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45420722"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45417070">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2509.22602"
              >Small Near-Earth Objects in the Taurid Resonant Swarm</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-29 @ 18:25:10</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45417070"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
