<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="45742419">
          <h3>
            <a
              class="item"
              href="https://blog.j11y.io/2025-10-29_stroke_tips_for_engineers/"
              >Tips for stroke-surviving software engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-29 @ 03:51:56</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45742419"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45741391">
          <h3>
            <a class="item" href="https://shadowglassgame.com"
              >Project Shadowglass</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-29 @ 01:06:32</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45741391"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45740214">
          <h3>
            <a class="item" href="https://blog.cloudflare.com/bootstrap-mtc/"
              >Keeping the Internet fast and secure: introducing Merkle Tree
              Certificates</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-28 @ 22:39:24</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45740214"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45739499">
          <h3>
            <a class="item" href="https://seated.ro/blog/tinkering-a-lost-art"
              >Tinkering is a way to acquire good taste</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-28 @ 21:31:50</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45739499"
                  >Comments</a
                ><span class="descendants">: 147</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45739080">
          <h3>
            <a
              class="item"
              href="https://genai-showdown.specr.net/image-editing"
              >Generative AI Image Editing Showdown</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-28 @ 20:58:22</span
              ><span class="points-container"
                >Points: <span class="points">201</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45739080"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45738247">
          <h3>
            <a
              class="item"
              href="https://512pixels.net/2025/10/boring-is-what-we-wanted/"
              >Boring is what we wanted</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-28 @ 19:57:16</span
              ><span class="points-container"
                >Points: <span class="points">255</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45738247"
                  >Comments</a
                ><span class="descendants">: 138</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45737948">
          <h3>
            <a class="item" href="https://www.butter.dev/"
              >Show HN: Butter – A Behavior Cache for LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-28 @ 19:39:51</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45737948"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
            <div class="text">
              <p>
                - It’s a chat completions compatible endpoint, making it easy to
                drop into existing agents with a custom base_url
              </p>
              <p>
                - The cache is template-aware, meaning lookups can treat dynamic
                content (names, addresses, etc.) as variables
              </p>
              <p>
                You can see it in action in this demo where it memorizes
                tic-tac-toe games:
                <a href="https://www.youtube.com/watch?v=PWbyeZwPjuY"
                  >https://www.youtube.com/watch?v=PWbyeZwPjuY</a
                >
              </p>
              <p>
                Why we built this: before Butter, we were Pig.dev (YC W25),
                where we built computer-use agents to automate legacy Windows
                applications. The goal was to replace RPA. But in practice,
                these agents were slow, expensive, and unpredictable - a major
                downgrade from deterministic RPA, and unacceptable in the worlds
                of healthcare, lending, and government. We realized users don't
                want to replace RPA with AI, they just want AI to handle the
                edge cases.
              </p>
              <p>
                We set out to build a system for "muscle memory" for AI
                automations (general purpose, not just computer-use), where
                agent trajectories get baked into reusable code. You may recall
                our first iteration of this in May, a library called Muscle Mem:
                <a href="https://news.ycombinator.com/item?id=43988381"
                  >https://news.ycombinator.com/item?id=43988381</a
                >
              </p>
              <p>
                Today we're relaunching it as a chat completions proxy. It
                emulates scripted automations by storing observed message
                histories in a tree structure, where each fork in the tree
                represents some conditional branch in the workflow's "code". We
                replay behaviors by walking the agent down the tree, falling
                back to AI to add new branches if the next step is not yet
                known.
              </p>
              <p>
                The proxy is live and free to use while we work through making
                the template-aware engine more flexible and accurate. Please try
                it out and share how it went, where it breaks, and if it’s
                helpful.
              </p>
            </div>
          </section>
        </section>
        <section id="45737941">
          <h3>
            <a
              class="item"
              href="https://www.jeffgeerling.com/blog/2025/why-do-some-radio-towers-blink"
              >Why do some radio towers blink?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-28 @ 19:38:53</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45737941"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45737338">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2025/10/samsung-makes-ads-on-3499-smart-fridges-official-with-upcoming-software-update/"
              >Samsung makes ads on smart fridges official with upcoming
              software update</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-28 @ 19:02:48</span
              ><span class="points-container"
                >Points: <span class="points">473</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45737338"
                  >Comments</a
                ><span class="descendants">: 378</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45736608">
          <h3>
            <a
              class="item"
              href="https://www.owlposting.com/p/mapping-the-off-target-effects-of"
              >Mapping the off-target effects of every FDA-approved drug in
              existence</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-28 @ 18:12:10</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45736608"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45736499">
          <h3>
            <a
              class="item"
              href="https://security.googleblog.com/2025/10/https-by-default.html"
              >HTTPS by default</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-28 @ 18:04:00</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45736499"
                  >Comments</a
                ><span class="descendants">: 141</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45736479">
          <h3>
            <a
              class="item"
              href="https://f-droid.org/2025/10/28/sideloading.html"
              >What we talk about when we talk about sideloading</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-28 @ 18:02:36</span
              ><span class="points-container"
                >Points: <span class="points">860</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45736479"
                  >Comments</a
                ><span class="descendants">: 398</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45736457">
          <h3>
            <a class="item" href="https://www.1x.tech/order"
              >1X Neo – Home Robot - Pre Order</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-28 @ 18:01:40</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45736457"
                  >Comments</a
                ><span class="descendants">: 108</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45735877">
          <h3>
            <a
              class="item"
              href="https://lwn.net/SubscriberLink/1042938/658ade3768dd4758/"
              >Fil-C: A memory-safe C implementation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-28 @ 17:25:04</span
              ><span class="points-container"
                >Points: <span class="points">166</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45735877"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45735491">
          <h3>
            <a
              class="item"
              href="https://jobs.ashbyhq.com/SigNoz/8447522c-1163-48d0-8f55-fac25f64a0f3"
              >SigNoz (YC W21) Is Hiring DevRel Engineers in the US – Open
              Source O11y Platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-28 @ 17:00:31</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45735264">
          <h3>
            <a class="item" href="https://ben.page/claude-code-web"
              >I've been loving Claude Code on the web</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-28 @ 16:46:57</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45735264"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45734620">
          <h3>
            <a
              class="item"
              href="https://www.experimental-history.com/p/the-decline-of-deviance"
              >The decline of deviance</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-28 @ 16:01:00</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45734620"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45734582">
          <h3>
            <a
              class="item"
              href="https://www.threads.com/@nthmonkey/post/DQVdAD1gHhw"
              >Using AI to negotiate a $195k hospital bill down to $33k</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-28 @ 15:58:58</span
              ><span class="points-container"
                >Points: <span class="points">874</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45734582"
                  >Comments</a
                ><span class="descendants">: 777</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45734486">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2025/10/28/nvidia-nokia-ai.html"
              >Nvidia takes $1B stake in Nokia</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-28 @ 15:53:52</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45734486"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45733707">
          <h3>
            <a class="item" href="https://eurollm.io/"
              >EuroLLM: LLM made in Europe built to support all 24 official EU
              languages</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-28 @ 14:58:04</span
              ><span class="points-container"
                >Points: <span class="points">551</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45733707"
                  >Comments</a
                ><span class="descendants">: 429</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45733412">
          <h3>
            <a
              class="item"
              href="https://crates.io/crates/oorandom#a-brief-history-of-random-numbers"
              >A brief history of random numbers (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-28 @ 14:34:18</span
              ><span class="points-container"
                >Points: <span class="points">187</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45733412"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45733329">
          <h3>
            <a
              class="item"
              href="https://basicappleguy.com/basicappleblog/the-airpods-pro-3-flight-problem"
              >The AirPods Pro 3 flight problem</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-28 @ 14:27:37</span
              ><span class="points-container"
                >Points: <span class="points">369</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45733329"
                  >Comments</a
                ><span class="descendants">: 211</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45733169">
          <h3>
            <a class="item" href="https://andonlabs.com/evals/butter-bench"
              >Our LLM-controlled office robot can't pass butter</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-28 @ 14:13:25</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45733169"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
            <div class="text">
              <p>
                1. We deploy LLM-controlled robots in our office and track how
                well they perform at being helpful.
              </p>
              <p>
                2. We systematically test the robots on tasks in our office. We
                benchmark different LLMs against each other. You can read our
                paper "Butter-Bench" on arXiv:
                <a href="https://arxiv.org/pdf/2510.21860"
                  >https://arxiv.org/pdf/2510.21860</a
                >
              </p>
              <p>
                The link in the title above (<a
                  href="https://andonlabs.com/evals/butter-bench"
                  >https://andonlabs.com/evals/butter-bench</a
                >) leads to a blog post + leaderboard comparing which LLM is the
                best at our robotic tasks.
              </p>
            </div>
          </section>
        </section>
        <section id="45732874">
          <h3>
            <a
              class="item"
              href="https://blog.ui.com/article/welcome-to-sfp-liberation-day"
              >Ubiquiti SFP Wizard</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-28 @ 13:48:51</span
              ><span class="points-container"
                >Points: <span class="points">220</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45732874"
                  >Comments</a
                ><span class="descendants">: 164</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45731321">
          <h3>
            <a
              class="item"
              href="https://samsaffron.com/archive/2025/10/27/your-vibe-coded-slop-pr-is-not-welcome"
              >We need a clearer framework for AI-assisted contributions to open
              source</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-28 @ 11:03:59</span
              ><span class="points-container"
                >Points: <span class="points">229</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45731321"
                  >Comments</a
                ><span class="descendants">: 118</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45709499">
          <h3>
            <a class="item" href="https://river.me/blog/puzzle-glue-9000/"
              >Gluing and framing a 9000-piece jigsaw</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-26 @ 06:03:24</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45709499"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45702397">
          <h3>
            <a
              class="item"
              href="https://www.anildash.com//2025/10/22/atlas-anti-web-browser/"
              >ChatGPT's Atlas: The Browser That's Anti-Web</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-25 @ 09:08:26</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45702397"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45692116">
          <h3>
            <a
              class="item"
              href="https://developer.apple.com/documentation/apple-silicon/about-the-rosetta-translation-environment"
              >Apple will phase out Rosetta 2 in macOS 28</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-24 @ 08:04:28</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45692116"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45682046">
          <h3>
            <a class="item" href="https://words.filippo.io/standard-of-care/"
              >The Geomys Standard of Care</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-23 @ 14:14:10</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45682046"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45681913">
          <h3>
            <a class="item" href="https://snipettemag.com/cheese-crystals/"
              >Cheese Crystals (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-23 @ 14:00:37</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45681913"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
