<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38667654">
          <h3>
            <a class="item" href="https://www.tesorio.com/careers#job-openings"
              >Tesorio (YC S15) Is Hiring a Senior Data Engineer in Latam</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 21:03:09</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38667596">
          <h3>
            <a class="item" href="https://www.mongodb.com/alerts"
              >MongoDB is actively investigating a security incident</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 20:57:02</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38667596"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38667509">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=38667509"
              >Ask HN: Stories of political intrigue in large companies</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 20:45:54</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38667509"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
            <div class="text">
              <p>
                When I realized this, I was pretty bitter and contemplated
                quitting. After being angry for a few days, I started to smile.
                Over my career, I saw some other people being secretive and
                protective of their team's work, and I always thought those
                people acted in a silly way. I just realized I now understand
                why those folks behaved in that manner!
              </p>
              <p>
                So this was clearly my first corporate knife fight and I got
                bruised (and who knows, maybe my team and I get buried). I am
                very fascinated by the political intrigue itself. There was
                lying, there was delay tactics, communication BS, and so on by
                the other party. I'd like to learn more about such tricks, not
                to use them, but frankly to catch onto them in the future
                faster. Any stories people have to share or pointers to material
                (books/videos)?
              </p>
            </div>
          </section>
        </section>
        <section id="38667266">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/world/2023/dec/08/paris-mayor-plans-to-triple-suv-parking-tariffs-cut-air-pollution"
              >Paris mayor plans to triple SUV parking tariffs to cut air
              pollution</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 20:10:51</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38667266"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38667206">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2023/12/16/ai-job-losses-are-rising-but-the-numbers-dont-tell-the-full-story.html"
              >Recent data shows AI job losses rising, but the numbers don't
              tell full story</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 20:01:04</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38667206"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38667142">
          <h3>
            <a
              class="item"
              href="https://www.ft.com/content/6f6e3e62-c06c-42b3-8b1b-a4dabbf2334c"
              >Apple workers deserve iDorms as good as the technology</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 19:50:28</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38667142"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38667063">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/pc-components/gpus/amd-fsr-is-the-building-block-for-apples-metalfx-upscaling-tech-the-apps-legal-info-references-the-usage-of-amd-fsr"
              >AMD FSR is the building block for Apple's hybrid MetalFX
              upscaling tech</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 19:37:46</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38667063"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38667006">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2023-12-12/solar-and-wind-to-top-coal-power-in-us-for-first-time-in-2024"
              >Solar and Wind to Top Coal Power in US for First Time in 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 19:29:03</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38667006"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38666340">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/australia-news/2023/dec/15/you-didnt-just-succeed-you-exceled-sydney-man-dubbed-the-annihilator-wins-excel-world-championship"
              >Sydney man dubbed the 'Annihilator' wins spreadsheet world
              championship</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 17:59:48</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38666340"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38666287">
          <h3>
            <a class="item" href="https://github.com/tlack/atree"
              >Atree: A simple and efficient pointer-free tree implementation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 17:52:48</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38666287"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38666032">
          <h3>
            <a class="item" href="https://www.bunniestudios.com/blog/?p=6886"
              >The New Essential Guide to Electronics in Shenzhen</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 17:25:04</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38666032"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38666016">
          <h3>
            <a
              class="item"
              href="https://newatlas.com/bicycles/penn-e-farthing-hubless-wheel-electric-penny-farthing/"
              >Hubless-wheel electric penny farthing is a one-of-a-kind
              masterpiece</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 17:24:03</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38666016"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38665918">
          <h3>
            <a
              class="item"
              href="https://smist08.wordpress.com/2023/12/15/my-raspberry-pi-learns-to-drive/"
              >My Raspberry Pi Learns to Drive</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 17:14:57</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38665918"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38665334">
          <h3>
            <a
              class="item"
              href="https://cs.uwaterloo.ca/~shallit/Papers/change2.pdf"
              >What This Country Needs is an 18¢ Piece (2002) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 16:17:33</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38665334"
                  >Comments</a
                ><span class="descendants">: 154</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38664729">
          <h3>
            <a class="item" href="https://github.com/francoismichel/ssh3"
              >SSH3: SSHv2 using HTTP/3 and QUIC</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 15:06:42</span
              ><span class="points-container"
                >Points: <span class="points">254</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38664729"
                  >Comments</a
                ><span class="descendants">: 137</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38664412">
          <h3>
            <a
              class="item"
              href="https://event-driven.io/en/the_end_is_near_for_crud_data/"
              >Moving from relational data to events</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 14:27:18</span
              ><span class="points-container"
                >Points: <span class="points">184</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38664412"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38663717">
          <h3>
            <a class="item" href="https://codapi.org/sql/"
              >Show HN: SQL Polyglot</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 12:21:38</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38663717"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
            <div class="text">
              Try running a query anywhere from PostgreSQL to DuckDB without
              leaving your browser.
            </div>
          </section>
        </section>
        <section id="38663713">
          <h3>
            <a
              class="item"
              href="https://www.bitecode.dev/p/preparing-for-missions-in-difficult"
              >Preparing for missions in difficult places</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 12:20:56</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38663713"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38663619">
          <h3>
            <a class="item" href="https://www.nsl.com/">No Stinking Loops</a>
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 11:59:06</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38663619"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38663590">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Island_gigantism"
              >Island gigantism</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 11:51:59</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38663590"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38662900">
          <h3>
            <a class="item" href="https://darksi.de/13.sqlite-fts5-structure/"
              >Structure of FTS5 Index in SQLite</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 09:09:07</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38662900"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38661903">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-12-nasa-life-sparking-energy-source-molecule.html"
              >NASA study finds life-sparking energy source and molecule at
              Enceladus</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 05:07:21</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38661903"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38661890">
          <h3>
            <a class="item" href="https://github.com/wesql/wescale"
              >Show HN: I've built a MySQL proxy that supports online DDL</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 05:03:34</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38661890"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
            <div class="text">
              Hi everyone. Over the past year, I've built a MySQL Proxy that
              supports Online DDL. I'm not sure if there are other proxies out
              there with this feature, but I found it fascinating and thought it
              was worth sharing. Of course, this proxy also supports many other
              features, such as Read Write Split, Read After Write Consistency,
              Load Balancing, and Transparent Failover. I didn't build this
              database from the bottom up; instead, I forked Vitess and put a
              lot of effort into overhauling its architecture and SQL Engine
              Layer. Moving forward, I hope to introduce more developer-friendly
              features into this Proxy. The next major feature should be
              something similar to the Branch functionality of PlanetScale.
            </div>
          </section>
        </section>
        <section id="38657126">
          <h3>
            <a
              class="item"
              href="https://www.whizzy.org/2023-12-14-bricked-xmas/"
              >I bricked my Christmas lights</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-15 @ 18:41:10</span
              ><span class="points-container"
                >Points: <span class="points">532</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38657126"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38653711">
          <h3>
            <a class="item" href="https://fs.blog/chestertons-fence/"
              >Chesterton's Fence: A lesson in second order thinking (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-15 @ 13:01:19</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38653711"
                  >Comments</a
                ><span class="descendants">: 105</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38652773">
          <h3>
            <a
              class="item"
              href="https://www.nicolamarras.it/Was-There-Life-Before-Computer-en.pdf"
              >Calculation before we went digital [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-15 @ 10:25:44</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38652773"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38652626">
          <h3>
            <a
              class="item"
              href="https://hyperallergic.com/861508/what-we-lose-when-curating-follows-the-money-capturing-moment-tate-modern/"
              >What we lose when curating follows the money</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-15 @ 09:54:43</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38652626"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38651690">
          <h3>
            <a
              class="item"
              href="https://belkadan.com/blog/2022/10/Swift-in-the-OS/"
              >Swift was always going to be part of the OS (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-15 @ 06:50:17</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38651690"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38651346">
          <h3>
            <a class="item" href="https://github.com/Card-Forge/forge/wiki"
              >Open source rules engine for Magic: The Gathering</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-15 @ 05:40:06</span
              ><span class="points-container"
                >Points: <span class="points">152</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38651346"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38639279">
          <h3>
            <a
              class="item"
              href="https://blog.des.no/2020/08/netlink-auditing-and-counting-bytes/"
              >Netlink, auditing, and counting bytes (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-14 @ 08:56:20</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38639279"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
