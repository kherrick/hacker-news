<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40644745">
          <h3>
            <a
              class="item"
              href="https://www.technologyreview.com/2024/06/11/1093465/battery-swap-gogoro-taiwan-earthquake/"
              >Battery-swap networks are preventing emergency blackouts</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 10:54:08</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40644745"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40644323">
          <h3>
            <a class="item" href="https://lenas-fieldnotes.de/minimal-tz/"
              >Exploring TrustZone-M on the NRF9160</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 09:43:51</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40644323"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40643207">
          <h3>
            <a class="item" href="http://www.povray.org/"
              >POV-Ray – The Persistence of Vision Raytracer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 06:36:44</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40643207"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40643167">
          <h3>
            <a
              class="item"
              href="https://christopher.engineering/en/blog/gleam-overview/"
              >Exploring Gleam, a type-safe language on the BEAM</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 06:29:49</span
              ><span class="points-container"
                >Points: <span class="points">154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40643167"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40643071">
          <h3>
            <a
              class="item"
              href="https://lcamtuf.substack.com/p/spotify-droppin-some-fake-beats"
              >Spotify: Droppin' Some Fake Beats</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 06:18:16</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40643071"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40641795">
          <h3>
            <a
              class="item"
              href="https://www.newsshooter.com/2024/06/10/blackmagic-ursa-cine-immersive-capture-content-for-apple-vision-pro-with-8160-x-7200-resolution-per-eye/"
              >Blackmagic Cine Immersive Capture for Vision Pro 8160x7200
              Resolution per Eye</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 02:55:17</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40641795"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40641704">
          <h3>
            <a
              class="item"
              href="https://www.science.org/doi/10.1126/sciadv.aba2578"
              >Biodiversity enhances immune regulation among daycare children</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 02:38:36</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40641704"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40641615">
          <h3>
            <a
              class="item"
              href="https://www.health.harvard.edu/blog/genes-protective-during-the-black-death-may-now-be-increasing-autoimmune-disorders-202212012859"
              >Genes protective during Black Death may now be increasing
              autoimmune disorders (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 02:23:50</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40641615"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40640927">
          <h3>
            <a class="item" href="https://maxleiter.com/blog/ship-every-day"
              >Ship Something Every Day</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 00:28:25</span
              ><span class="points-container"
                >Points: <span class="points">177</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40640927"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40640833">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-06-siberia-mammoth-graveyard-reveals-year.html"
              >Siberia's 'mammoth graveyard' reveals 800-year human interactions
              with mammoths</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 00:15:00</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40640833"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40640424">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2406.01506"
              >The Geometry of Categorical and Hierarchical Concepts in Large
              Language Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 23:18:06</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40640424"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40639628">
          <h3>
            <a
              class="item"
              href="https://iandanielstewart.com/2024/06/09/engage-your-audience-by-getting-to-the-point-using-story-structure-and-forcing-specificity/"
              >Engage your audience: get to the point, use story structure,
              force specificity</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 21:55:13</span
              ><span class="points-container"
                >Points: <span class="points">150</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40639628"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40639606">
          <h3>
            <a
              class="item"
              href="https://security.apple.com/blog/private-cloud-compute/"
              >Private Cloud Compute: A new frontier for AI privacy in the
              cloud</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 21:53:07</span
              ><span class="points-container"
                >Points: <span class="points">498</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40639606"
                  >Comments</a
                ><span class="descendants">: 248</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40639506">
          <h3>
            <a
              class="item"
              href="https://machinelearning.apple.com/research/introducing-apple-foundation-models"
              >Apple's On-Device and Server Foundation Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 21:42:11</span
              ><span class="points-container"
                >Points: <span class="points">742</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40639506"
                  >Comments</a
                ><span class="descendants">: 395</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40638764">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/the-new-math-of-how-large-scale-order-emerges-20240610/"
              >The new math of how large-scale order emerges</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 20:42:04</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40638764"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40637374">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Pyrophone"
              >Pyrophone</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 19:13:39</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40637374"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40637102">
          <h3>
            <a
              class="item"
              href="https://www.afterbabel.com/p/community-based-childhood"
              >Deterioration of local community a major driver of loss of
              play-based childhood</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 19:00:26</span
              ><span class="points-container"
                >Points: <span class="points">337</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40637102"
                  >Comments</a
                ><span class="descendants">: 293</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40636883">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=iDnW0WiCqNc"
              >The rarest move in chess [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 18:50:53</span
              ><span class="points-container"
                >Points: <span class="points">190</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40636883"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40636844">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/newsroom/2024/06/introducing-apple-intelligence-for-iphone-ipad-and-mac/"
              >Apple Intelligence for iPhone, iPad, and Mac</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 18:48:47</span
              ><span class="points-container"
                >Points: <span class="points">978</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40636844"
                  >Comments</a
                ><span class="descendants">: 1097</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40636292">
          <h3>
            <a
              class="item"
              href="https://www.zdnet.com/article/forget-lastpass-apple-unveils-passwords-manager-app-at-wwdc-2024/"
              >Apple unveils 'Passwords' manager app at WWDC 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 18:04:10</span
              ><span class="points-container"
                >Points: <span class="points">227</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40636292"
                  >Comments</a
                ><span class="descendants">: 446</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40635697">
          <h3>
            <a class="item" href="https://github.com/visrealm/pico9918"
              >pico9918: A replacement TMS9918A/TMS9929A VDP using a Raspberry
              Pi Pico</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 17:09:52</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40635697"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40633773">
          <h3>
            <a class="item" href="https://github.com/squaredtechnologies/thread"
              >Show HN: Thread – AI-powered Jupyter Notebook built using
              React</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 13:59:22</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40633773"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
            <div class="text">
              <a href="https://thread.dev/">https://thread.dev/</a>) an
              open-source Jupyter Notebook that has a bunch of AI features built
              in. The easiest way to think of Thread is if the chat interface of
              OpenAI code interpreter was fused into a Jupyter Notebook
              development environment where you could still edit code or re-run
              cells. To check it out, you can see a video demo here:
              <a href="https://www.youtube.com/watch?v=Jq1_eoO6w-c"
                >https://www.youtube.com/watch?v=Jq1_eoO6w-c</a
              >
              <p>
                We initially got the idea when building Vizly (<a
                  href="https://vizly.fyi/"
                  >https://vizly.fyi/</a
                >) a tool that lets non-technical users ask questions from their
                data. While Vizly is powerful at performing data
                transformations, as engineers, we often felt that natural
                language didn't give us enough freedom to edit the code that was
                generated or to explore the data further for ourselves. That is
                what gave us the inspiration to start Thread.
              </p>
              <p>
                We made Thread a pip package (`pip install thread-dev`) because
                we wanted to make Thread as easily accessible as possible. While
                there are a lot of notebooks that improve on the notebook
                development experience, they are often cloud hosted tools that
                are hard to access as an individual contributor unless your
                company has signed an enterprise agreement.
              </p>
              <p>
                With Thread, we are hoping to bring the power of LLMs to the
                local notebook development environment while blending the
                editing experience that you can get in a cloud hosted notebook.
                We have many ideas on the roadmap but instead of building in a
                vacuum (which we have made the mistake of before) our hope was
                to get some initial feedback to see if others are as interested
                in a tool like this as we are.
              </p>
              <p>Would love to hear your feedback and see what you think!</p>
            </div>
          </section>
        </section>
        <section id="40633003">
          <h3>
            <a class="item" href="https://xorvoid.com/forsp.html"
              >Forsp: A Forth+Lisp Hybrid Lambda Calculus Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 12:47:48</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40633003"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40632533">
          <h3>
            <a class="item" href="https://github.com/potahtml/mpa-archive"
              >Show HN: Crawl a modern website to a zip, serve the website from
              the zip</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 11:47:00</span
              ><span class="points-container"
                >Points: <span class="points">176</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40632533"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40632064">
          <h3>
            <a
              class="item"
              href="https://www.abortretry.fail/p/a-short-history-of-cpm-86"
              >A Short History of CP/M-86 – By Bradford Morgan White</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 10:36:33</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40632064"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40631931">
          <h3>
            <a class="item" href="https://mattmahoney.net/dc/dce.html"
              >Data Compression Explained (2011)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 10:10:55</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40631931"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40631614">
          <h3>
            <a class="item" href="https://github.com/dbalsom/arduino_8088"
              >An Arduino interface for 8088 CPUs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 09:14:08</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40631614"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40631186">
          <h3>
            <a
              class="item"
              href="https://www.join.tech/blog/2024-0x10-the-backbone-of-cybersecurity-hardware-security-modules.php"
              >The Backbone of Cybersecurity: Hardware Security Modules</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 07:46:12</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40631186"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40623864">
          <h3>
            <a
              class="item"
              href="https://suanto.com/2024/06/06/the-time-I-built-an-ROV-01/"
              >I built an ROV to solve missing person cases</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 12:02:19</span
              ><span class="points-container"
                >Points: <span class="points">533</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40623864"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40615002">
          <h3>
            <a
              class="item"
              href="https://www.u.arizona.edu/~jbausch1/cv/BauschatzFullDissertation.pdf"
              >Policing the Chôra: Law Enforcement in Ptolemaic Egypt (2005)
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-08 @ 03:15:39</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40615002"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
