<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="45228766">
          <h3>
            <a
              class="item"
              href="https://github.com/chatboxai/chatbox/issues/2644"
              >Chatbox app is back on the US app store</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-13 @ 02:13:40</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45228766"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45228692">
          <h3>
            <a class="item" href="https://ma.tt/2025/09/legal-win/"
              >Legal win</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-13 @ 01:55:23</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45228692"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45228552">
          <h3>
            <a
              class="item"
              href="https://www.latimes.com/california/story/2025-09-12/california-lawmakers-pass-sb-79-housing-bill-that-brings-dense-housing-to-transit-hubs"
              >California lawmakers pass SB 79, housing bill that brings dense
              housing</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-13 @ 01:32:33</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45228552"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45228472">
          <h3>
            <a
              class="item"
              href="https://acoup.blog/2025/09/12/collections-life-work-death-and-the-peasant-part-ivc-rent-and-extraction/"
              >Life, work, death and the peasant: Rent and extraction</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-13 @ 01:15:37</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45228472"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45228396">
          <h3>
            <a class="item" href="https://github.com/meow-edit/meow"
              >Meow: Yet another modal editing on Emacs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-13 @ 01:00:22</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45228396"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45227749">
          <h3>
            <a
              class="item"
              href="https://sporks.space/2025/08/28/tips-for-installing-windows-98-in-qemu-utm/"
              >Tips for installing Windows 98 in QEMU/UTM</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-12 @ 23:04:08</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45227749"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45227212">
          <h3>
            <a class="item" href="https://ffglitch.org/gallery/"
              >FFglitch, FFmpeg fork for glitch art</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-12 @ 21:54:34</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45227212"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45227134">
          <h3>
            <a class="item" href="https://www.aris.chat"
              >Show HN: Aris – a free AI-powered answer engine for kids</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-12 @ 21:44:47</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45227134"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.aris.chat/">https://www.aris.chat/</a>).
              <p>
                Aris is a minimalist tool that answers any questions a child
                has.
              </p>
              <p>
                Encyclopedias, periodicals, field guides, cookbooks, and other
                print resources we used as kids to find knowledge, learn, and
                pursue our curiosities have been replaced in most households by
                something that is not safe for kids: the internet. So instead,
                kids get Fortnite, Minecraft, and ‘edutainment’ options that
                don’t compare to the knowledge resources that past generations
                have had access to.
              </p>
              <p>
                With this in mind, many of the smartest people I know raise (or
                plan to raise) their kids with access to only a 1990s level of
                consumer technology, without smartphones, tablets, social media,
                online gaming, etc. Many of these people believe the last three
                decades of technological development have been a net negative
                for kids. When my child was born, I had a similar sentiment.
                However, there are some major problems with limiting a kid’s
                access to technology today. To name a couple: 1.) a set of World
                Book encyclopedias now costs $1,200, and 2.) many print
                resources aren’t as good as they used to be, if they are even
                still in print, since the market changed. As parents, we need a
                safe, simple, nonaddictive way for kids to access and explore
                the world’s knowledge easily and independently.
              </p>
              <p>
                Aris uses a combination of large language models with policy
                engines and web search tools to find relevant, timely answers to
                their questions and only returns the stripped-down answers. It
                does not return links for them to click on or images or
                advertisements. Parents can tune the moderation settings as
                finely as they’d like, preventing discussions about banned
                topics and even getting as specific as making sure Aris doesn’t
                tell their second child that Santa isn’t real.
              </p>
              <p>
                The model context handling and system instructions are designed
                to prevent kids from building emotional reliance or
                relationships with it. Rather than trying to pull a child into
                the experience to maximize engagement, Aris is meant to gently
                redirect the child out of the device into the real world after
                their question has been answered.
              </p>
              <p>
                We are available as a web app and iPhone/iPad app in the Apple
                App store, but we have also made our Apple Watch app available
                in the iOS store as well. We believe minimalist wearables are a
                good device substitute for younger humans, and we hope Aris can
                be a healthy addition to those wearables.
              </p>
              <p>
                We plan to make money through premium features that include
                creating multiple child accounts, accessing premium models for
                better answers, and for ultra-high usage limits.
              </p>
              <p>
                Come use the app for free on our website or by downloading it in
                the iOS store by searching for “Aris AI”. We’d love to hear your
                ideas, experiences, and feedback. Thanks!
              </p>
            </div>
          </section>
        </section>
        <section id="45226903">
          <h3>
            <a
              class="item"
              href="https://theintercept.com/2025/09/12/proton-mail-journalist-accounts-suspended/"
              >Proton Mail suspended journalist accounts at request of
              cybersecurity agency</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-12 @ 21:20:36</span
              ><span class="points-container"
                >Points: <span class="points">186</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45226903"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45226639">
          <h3>
            <a
              class="item"
              href="https://edoput.it/2025/04/16/emacs-paradigm-shift.html"
              >I used standard Emacs extension-points to extend org-mode</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-12 @ 20:53:33</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45226639"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45225098">
          <h3>
            <a
              class="item"
              href="https://iamvishnu.com/posts/utf8-is-brilliant-design"
              >UTF-8 is a brilliant design</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-12 @ 18:30:15</span
              ><span class="points-container"
                >Points: <span class="points">426</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45225098"
                  >Comments</a
                ><span class="descendants">: 175</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45224967">
          <h3>
            <a
              class="item"
              href="https://www.weplanet.org/post/eu-court-rules-nuclear-energy-is-clean-energy"
              >EU court rules nuclear energy is clean energy</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-12 @ 18:18:00</span
              ><span class="points-container"
                >Points: <span class="points">664</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45224967"
                  >Comments</a
                ><span class="descendants">: 505</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45224421">
          <h3>
            <a
              class="item"
              href="https://f-droid.org/2025/09/10/how-foss-projects-handle-legal-takedown-requests.html"
              >How FOSS Projects Handle Legal Takedown Requests</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-12 @ 17:22:38</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45224421"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45224246">
          <h3>
            <a
              class="item"
              href="https://flak.tedunangst.com/post/humanely-dealing-with-humungus-crawlers"
              >Humanely dealing with humungus crawlers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-12 @ 17:06:52</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45224246"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45224156">
          <h3>
            <a class="item" href="https://github.com/qgis/QGIS"
              >QGIS is a free, open-source, cross platform geographical
              information system</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-12 @ 16:57:17</span
              ><span class="points-container"
                >Points: <span class="points">327</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45224156"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45223719">
          <h3>
            <a
              class="item"
              href="https://thehill.com/opinion/finance/5498346-corporate-america-has-been-trying-to-hide-job-openings-now-it-is-failing/"
              >Corporations are trying to hide job openings from US citizens</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-12 @ 16:13:49</span
              ><span class="points-container"
                >Points: <span class="points">423</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45223719"
                  >Comments</a
                ><span class="descendants">: 322</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45223660">
          <h3>
            <a class="item" href="https://openai.com/index/openai-grove/"
              >OpenAI Grove</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-12 @ 16:05:58</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45223660"
                  >Comments</a
                ><span class="descendants">: 116</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45222799">
          <h3>
            <a class="item" href="https://github.com/plutov/oq"
              >Oq: Terminal OpenAPI Spec Viewer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-12 @ 14:53:45</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45222799"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45222695">
          <h3>
            <a
              class="item"
              href="https://buttondown.com/hillelwayne/archive/many-hard-leetcode-problems-are-easy-constraint/"
              >Many hard LeetCode problems are easy constraint problems</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-12 @ 14:44:05</span
              ><span class="points-container"
                >Points: <span class="points">429</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45222695"
                  >Comments</a
                ><span class="descendants">: 371</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45222369">
          <h3>
            <a
              class="item"
              href="https://www.arvinpoddar.com/blog/3d-modeling-with-paper"
              >3D modeling with paper</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-12 @ 14:12:23</span
              ><span class="points-container"
                >Points: <span class="points">252</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45222369"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45221274">
          <h3>
            <a
              class="item"
              href="https://www.tftc.io/treasury-iexpanding-patriot-act/"
              >The treasury is expanding the Patriot Act to attack Bitcoin self
              custody</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-12 @ 12:10:29</span
              ><span class="points-container"
                >Points: <span class="points">621</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45221274"
                  >Comments</a
                ><span class="descendants">: 456</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45219817">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=k_-6KI3m31M"
              >Rust: A quest for performant, reliable software [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-12 @ 07:58:55</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45219817"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
            <div class="text">
              <a
                href="https://docs.google.com/presentation/d/1SoDsm_m_pb_gS6Y98HghhzBviYZxp3F2XawhIppJQQo/edit?usp=sharing"
                >https://docs.google.com/presentation/d/1SoDsm_m_pb_gS6Y98Hgh...</a
              >
            </div>
          </section>
        </section>
        <section id="45218017">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2025-09-discovery-moon-orbiting-mysterious-distant.html"
              >Discovery of a new satellite or ring arc around Quaoar</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-12 @ 02:17:54</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45218017"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <a
                href="https://iopscience.iop.org/article/10.3847/2515-5172/adfeda"
                >https://iopscience.iop.org/article/10.3847/2515-5172/adfeda</a
              >
            </div>
          </section>
        </section>
        <section id="45183191">
          <h3>
            <a
              class="item"
              href="https://www.timeplus.com/post/ai-chess-hallucination-detection"
              >Real-time AI hallucination detection with timeplus: A chess
              example</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-09 @ 15:20:38</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45183191"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45183008">
          <h3>
            <a
              class="item"
              href="https://virtuallyfun.com/2025/09/06/unauthorized-windows-386/"
              >Unauthorized Windows/386</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-09 @ 15:09:34</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45183008"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45182098">
          <h3>
            <a class="item" href="https://www.antlr-ng.org/"
              >Antlr-Ng Parser Generator</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-09 @ 14:04:28</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45182098"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45180876">
          <h3>
            <a
              class="item"
              href="https://devcenter.upsun.com/posts/cut-aws-bandwidth-costs-95-with-dm-cache/"
              >Reduce bandwidth costs with dm-cache: fast local SSD caching for
              network storage</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-09 @ 12:14:58</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45180876"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45178541">
          <h3>
            <a class="item" href="http://hbpms.blogspot.com/"
              >How to become a pure mathematician or statistician (2008)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-09 @ 07:10:53</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45178541"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45176471">
          <h3>
            <a
              class="item"
              href="https://news.northwestern.edu/stories/2025/09/first-perovskite-camera-can-see-inside-the-human-body/"
              >First 'perovskite camera' can see inside the human body</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-09 @ 01:49:08</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45176471"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45175982">
          <h3>
            <a class="item" href="https://github.com/CursorTouch/Windows-Use"
              >Windows-Use: an AI agent that interacts with Windows at GUI
              layer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-09 @ 00:33:56</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45175982"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
