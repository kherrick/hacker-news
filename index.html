<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="45479103">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/technology/2025/oct/05/way-past-its-prime-how-did-amazon-get-so-rubbish"
              >Way past its prime: how did Amazon get so rubbish?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-05 @ 05:47:55</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45479103"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45478749">
          <h3>
            <a
              class="item"
              href="https://www.pewresearch.org/short-reads/2025/10/02/americans-increasingly-see-legal-sports-betting-as-a-bad-thing-for-society-and-sports/"
              >Americans increasingly see legal sports betting as a bad thing
              for society</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-05 @ 04:01:57</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45478749"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45478033">
          <h3>
            <a class="item" href="https://github.com/daniellionel01/parrot"
              >Parrot – type-safe SQL in Gleam, supports SQlite, PostgreSQL and
              MySQL</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-05 @ 00:51:44</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45478033"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45477971">
          <h3>
            <a
              class="item"
              href="https://richardsapperdesign.com/products/mod-5140/"
              >Mod. 5140 - IBM's First Laptop Computer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-05 @ 00:35:10</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45477971"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45477742">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2509.12351"
              >Space Mission Options for Reconnaissance and Mitigation of
              Asteroid 2024 YR4</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-04 @ 23:42:55</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45477742"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45477516">
          <h3>
            <a
              class="item"
              href="https://www.gregegan.net/SCIENCE/Borehole/Borehole.html"
              >Borehole Oscillators</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-04 @ 23:02:32</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45477516"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45477394">
          <h3>
            <a
              class="item"
              href="https://jrfernandez.com/whiteboarding-with-ai/"
              >Whiteboarding with AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-04 @ 22:41:04</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45477394"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45477206">
          <h3>
            <a class="item" href="https://blog.cr.yp.to/20251004-weakened.html"
              >NSA and IETF: Can an attacker purchase standardization of
              weakened cryptography?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-04 @ 22:16:33</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45477206"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45477118">
          <h3>
            <a
              class="item"
              href="https://docs.xiangshan.cc/projects/design/en/latest/backend/VFPU/"
              >XiangShan Vector Floating-Point Unit Design</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-04 @ 22:02:28</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45477118"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45476821">
          <h3>
            <a class="item" href="https://salykova.github.io/matrix-cores-cdna"
              >Matrix Core Programming on AMD GPUs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-04 @ 21:22:11</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45476821"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45476820">
          <h3>
            <a class="item" href="https://sunboxlabs.com/"
              >$912 energy independence without red tape</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-04 @ 21:22:05</span
              ><span class="points-container"
                >Points: <span class="points">160</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45476820"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45475808">
          <h3><a class="item" href="https://blogfeeds.net">Blog Feeds</a></h3>
          <section>
            <h4>
              <span>2025-10-04 @ 19:08:46</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45475808"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45475529">
          <h3>
            <a class="item" href="https://github.com/DebarghaG/proofofthought"
              >ProofOfThought: LLM-based reasoning using Z3 theorem proving</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-04 @ 18:34:23</span
              ><span class="points-container"
                >Points: <span class="points">246</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45475529"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
            <div class="text">
              <a href="https://arxiv.org/abs/2409.17270"
                >https://arxiv.org/abs/2409.17270</a
              >
            </div>
          </section>
        </section>
        <section id="45475528">
          <h3>
            <a class="item" href="https://github.com/Esubaalew/run"
              >Show HN: Run – a CLI universal code runner I built while learning
              Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-04 @ 18:34:13</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45475528"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
            <div class="text">
              <p>
                I designed it to support both interpreted languages (Python, JS,
                Ruby, etc.) and compiled languages (Rust, Go, C/C++). It detects
                languages from flags or file extensions, can compile temporary
                files for compiled languages, and exposes a unified REPL
                experience with commands like :help, :lang, and :quit.
              </p>
              <p>
                Install: cargo install run-kit (or use the platform downloads on
                GitHub). Source &amp; releases:
                <a href="https://github.com/Esubaalew/run"
                  >https://github.com/Esubaalew/run</a
                >
              </p>
              <p>
                I used Rust while following the official learning resources and
                used AI to speed up development, so I expect there are bugs and
                rough edges. I’d love feedback on: usability and UX of the REPL,
                edge cases for piping input to language runtimes, security
                considerations (sandboxing/resource limits), packaging and
                cross-platform distribution.
              </p>
              <p>
                Thanks — I’ll try to answer questions and share design notes.
              </p>
            </div>
          </section>
        </section>
        <section id="45474900">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2509.19371"
              >How to inject knowledge efficiently? Knowledge infusion scaling
              law for LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-04 @ 17:18:07</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45474900"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45473861">
          <h3>
            <a
              class="item"
              href="https://github.com/johnperry-math/AoC2023/blob/master/More_Detailed_Comparison.md"
              >A comparison of Ada and Rust, using solutions to the Advent of
              Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-04 @ 15:10:49</span
              ><span class="points-container"
                >Points: <span class="points">225</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45473861"
                  >Comments</a
                ><span class="descendants">: 147</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45473852">
          <h3>
            <a
              class="item"
              href="https://www.seangoedecke.com/how-to-influence-politics/"
              >How I influence tech company politics as a staff software
              engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-04 @ 15:09:41</span
              ><span class="points-container"
                >Points: <span class="points">301</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45473852"
                  >Comments</a
                ><span class="descendants">: 168</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45473730">
          <h3>
            <a
              class="item"
              href="https://maxadamski.com/blog/2025/10/email.html"
              >Self-hosting email like it's 1984</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-04 @ 14:53:32</span
              ><span class="points-container"
                >Points: <span class="points">222</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45473730"
                  >Comments</a
                ><span class="descendants">: 147</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45472765">
          <h3>
            <a class="item" href="https://www.folklore.org/Thunderscan.html"
              >Thunderscan: A clever device transforms a printer into a scanner
              (2004)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-04 @ 12:16:37</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45472765"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45472678">
          <h3>
            <a class="item" href="https://www.buchstabenmuseum.de/en/"
              >The Buchstabenmuseum Berlin is closing</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-04 @ 11:58:58</span
              ><span class="points-container"
                >Points: <span class="points">172</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45472678"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45472319">
          <h3>
            <a
              class="item"
              href="https://pagedout.institute/download/PagedOut_007.pdf"
              >Paged Out Issue #7 [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-04 @ 10:38:06</span
              ><span class="points-container"
                >Points: <span class="points">250</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45472319"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45444062">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2509.18103"
              >Machine Learnability as a Measure of Order in Aperiodic
              Sequences</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-01 @ 22:01:20</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45444062"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45442752">
          <h3>
            <a
              class="item"
              href="https://dancharblog.wordpress.com/2017/05/29/surface-pen-compatibility-interoperability-faq/"
              >Microsoft Surface Pen Compatibility / Interoperability FAQ
              (2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-01 @ 20:08:27</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45442752"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45440180">
          <h3>
            <a class="item" href="https://github.com/lsartory/Clavier"
              >Clavier: An FPGA-based mechanical keyboard with USB hub and comms
              interfaces</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-01 @ 17:05:38</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45440180"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45440071">
          <h3>
            <a class="item" href="https://github.com/newton-physics/newton"
              >Newton: physics simulation engine built upon NVIDIA Warp</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-01 @ 16:57:11</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45440071"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45438713">
          <h3>
            <a
              class="item"
              href="https://backend.orbit.dtu.dk/ws/portalfiles/portal/236623063/PhD_Thesis_Torkil_Kollsker.pdf"
              >Mathematical Models/Algorithms for Optimization of Lego
              Construction Problems [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-01 @ 15:16:44</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45438713"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45435606">
          <h3>
            <a
              class="item"
              href="https://roxeem.com/2025/09/30/what-net-10-gc-changes-mean-for-developers/"
              >What .NET 10 GC Changes Mean for Developers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-01 @ 08:40:35</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45435606"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45433936">
          <h3>
            <a
              class="item"
              href="https://leancrew.com/all-this/2025/09/baseball-durations-after-the-pitch-clock/"
              >Baseball durations after the pitch clock</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-01 @ 03:15:23</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45433936"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45431115">
          <h3>
            <a class="item" href="https://benbridle.com/projects/cobalt.html"
              >Show HN: Cobalt – a pixel-art painting studio for the Nintendo
              DS</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-30 @ 20:54:45</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45431115"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
            <div class="text">
              <p>
                Cobalt is a program for painting textural and expressive
                pixel-art on Windows, Linux, Nintendo DS, and in-browser. The
                same 46KB core executable runs on all platforms, with a thin
                emulator layer sitting on top to handle differences in inputs
                and filesystem access (which makes it easy to port between
                systems). It's built on Bedrock[0], an 8-bit virtual computer
                system I posted about here in July.
              </p>
              <p>
                I created Cobalt because I wanted to draw messy, gritty pixel
                art without smooth gradients, and the smaller colour palette
                helped with making bolder colour choices. Images can be moved
                back and forth between platforms, so you can copy
                works-in-progress to the DS to keep working away on the bus or
                train. It's like a 2004-era vision of the future.
              </p>
              <p>
                There's a live demo on the linked page that runs in the browser,
                and there are downloadable demos for every platform here[1]. Let
                me know if you try it out or have any questions!
              </p>
              <p>
                [0]
                <a href="https://benbridle.com/bedrock"
                  >https://benbridle.com/bedrock</a
                >
              </p>
              <p>
                [1]
                <a href="https://derelict-engineering.itch.io/cobalt"
                  >https://derelict-engineering.itch.io/cobalt</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="45427972">
          <h3>
            <a
              class="item"
              href="https://www.sciencedaily.com/releases/2025/09/250928095654.htm"
              >Earth was born dry until a cosmic collision made it a blue
              planet</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-30 @ 16:54:43</span
              ><span class="points-container"
                >Points: <span class="points">220</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45427972"
                  >Comments</a
                ><span class="descendants">: 212</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
