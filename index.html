<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40281588">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2024/05/07/apple_fingerprinting_rules/"
              >Google, Meta 'break' Apple's device fingerprinting rules</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-07 @ 02:11:20</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40281588"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40281340">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-05-black-hole-visualization-viewers-brink.html"
              >New black hole visualization takes viewers beyond the brink</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-07 @ 01:32:23</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40281340"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40281314">
          <h3>
            <a class="item" href="https://github.com/baweaver/refactor"
              >Utilities for refactoring and upgrading Ruby code based on
              ASTs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-07 @ 01:26:10</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40281314"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40281274">
          <h3>
            <a
              class="item"
              href="https://stateline.org/2024/03/29/vets-fret-as-private-equity-snaps-up-clinics-pet-care-companies/"
              >Vets fret as private equity snaps up clinics, pet care
              companies</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-07 @ 01:18:34</span
              ><span class="points-container"
                >Points: <span class="points">162</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40281274"
                  >Comments</a
                ><span class="descendants">: 132</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40281272">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2024/05/06/boeing-starliners-first-crewed-mission-scrubbed/"
              >Boeing Starliner's first crewed mission scrubbed</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-07 @ 01:18:19</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40281272"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40281139">
          <h3>
            <a
              class="item"
              href="https://jacobpadilla.com/articles/recreating-asyncio"
              >How Python Asyncio Works: Recreating It from Scratch</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-07 @ 00:50:11</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40281139"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40280875">
          <h3>
            <a
              class="item"
              href="https://eli.thegreenplace.net/2019/faster-xml-stream-processing-in-go/"
              >Eli Bendersky: Faster XML Stream Processing in Go (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-07 @ 00:01:44</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40280875"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40280689">
          <h3>
            <a
              class="item"
              href="https://restoreprivacy.com/protonmail-discloses-user-data-leading-to-arrest-in-spain/"
              >Proton Mail Discloses User Data Leading to Arrest in Spain</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-06 @ 23:34:58</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40280689"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40280490">
          <h3>
            <a class="item" href="https://www.caniemail.com/"
              >Caniemail.com – like caniuse but for email content</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-06 @ 23:03:34</span
              ><span class="points-container"
                >Points: <span class="points">205</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40280490"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40280161">
          <h3>
            <a
              class="item"
              href="https://www.nyu.edu/about/news-publications/news/2024/april/how-do-birds-flock--researchers-do-the-math-to-reveal-previously.html"
              >How do birds flock? Research reveals previously unknown
              aerodynamic phenomenon</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-06 @ 22:19:22</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40280161"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40279632">
          <h3>
            <a
              class="item"
              href="https://www.leviathansecurity.com/blog/tunnelvision"
              >Attackers can decloak routing-based VPNs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-06 @ 21:19:55</span
              ><span class="points-container"
                >Points: <span class="points">176</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40279632"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40279499">
          <h3>
            <a class="item" href="https://territory.dev"
              >An infinite canvas for code exploration</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-06 @ 21:03:54</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40279499"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40279464">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/continue/jobs/smcxRnM-founding-engineer"
              >Continue (YC S23) is hiring a founding engineer in San
              Francisco</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-06 @ 21:00:31</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40279305">
          <h3>
            <a
              class="item"
              href="https://www.nkorth.com/palm/apps/#totp-authenticator"
              >TOTP Authenticator for PalmOS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-06 @ 20:45:57</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40279305"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40277547">
          <h3>
            <a
              class="item"
              href="https://cq2.co/blog/the-best-way-to-have-complex-discussions"
              >The best way to have complex discussions?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-06 @ 18:02:59</span
              ><span class="points-container"
                >Points: <span class="points">312</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40277547"
                  >Comments</a
                ><span class="descendants">: 154</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40277469">
          <h3>
            <a
              class="item"
              href="https://tgceec.tumblr.com/post/74534916370/results-of-the-grand-c-error-explosion"
              >Results of the Grand C++ Error Explosion Competition (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-06 @ 17:57:39</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40277469"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40276768">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40276768"
              >Show HN: Peerdb Streams – Simple, native Postgres change data
              capture</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-06 @ 17:00:42</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40276768"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/PeerDB-io/peerdb"
                >https://github.com/PeerDB-io/peerdb</a
              >). We spent the past 7 months building a solid experience to
              replicate data from Postgres to data warehouses. Now we're
              expanding to queues.
              <p>
                PeerDB Streams provides a simple and native way to replicate
                changes as they happen in Postgres to Queues (Kafka, Redpanda,
                Google PubSub, etc). We use Postgres logical decoding to enable
                Change Data Capture (CDC).
              </p>
              <p>
                Blog post here:
                <a
                  href="https://blog.peerdb.io/peerdb-streams-simple-native-postgres-change-data-capture"
                  >https://blog.peerdb.io/peerdb-streams-simple-native-postgres...</a
                >. 10-min quickstart here:
                <a href="https://docs.peerdb.io/quickstart/streams-quickstart"
                  >https://docs.peerdb.io/quickstart/streams-quickstart</a
                >.
              </p>
              <p>
                We chose queues as many users found that existing tools are
                complex. Debezium is the most used tool for this use-case. It
                has large production usage. However, a common pain point among
                our users is that it has a significant learning curve taking
                months to productionize.
              </p>
              <p>
                A few issues are: a) Interacting through a command line
                interface, understanding the various settings, and learning best
                practices for running it in production is not trivial. Debezium
                UI, released to address usability concerns [1], is still in an
                incubating state [2]. Additionally, reading Debezium resources
                to get started can be overwhelming [3]. b) Supporting data
                formats and transformations isn’t easy. It needs a Java project,
                building JAR packages and setting up a runtime path on the kafka
                connect plugin. c)Debezium is not as native as Kafka for other
                queues and doesn’t offer the same level of configurability. For
                example, with Event Hubs, it is difficult to stream to topics
                spread across namespaces and subscriptions.
              </p>
              <p>
                TL;DR Debezium aims to provide a comprehensive experience for
                engineers to implement CDC rather than making it dead simple for
                them. So you can do a lot with Debezium but need to know a lot
                about it.
              </p>
              <p>
                At PeerDB, we are building a simple yet comprehensive experience
                for Postgres CDC. The goal is to enable engineers to build
                prod-grade Postgres CDC with a minimal learning curve, within a
                few days.
              </p>
              <p>
                PeerDB’s feature-set isn't at Debezium's level yet, and as we
                evolve, we might face similar challenges. However, we're putting
                usability at the forefront and we believe that we can achieve
                the above goal.
              </p>
              <p>
                First, PeerDB offers a simple UI to set up Postgres and Kafka by
                creating PEERs and initiating CDC by creating a MIRROR. Through
                the UI, users can monitor the progress of CDC, including
                throughput and latency; set up alerts to Slack/Email based on
                replication slot growth; investigate Postgres-native metrics,
                including slot size, etc. Here is a demo showing of PeerDB UI in
                action:
              </p>
              <p>
                <a
                  href="https://www.loom.com/share/ebcfb7646a1e48738835853b760e5d04"
                  >https://www.loom.com/share/ebcfb7646a1e48738835853b760e5d04</a
                >
              </p>
              <p>
                Second, for users who prefer a CLI, we provide a
                Postgres-compatible SQL layer to manage CDC. This offers the
                same level of features as the UI and is more intuitive compared
                to bash scripts.
              </p>
              <p>
                Third, users can perform row-level transformations using Lua
                scripts executed at runtime. This enables features such as
                encrypting/masking PII data, supporting various data formats
                (JSON, MsgPack, Protobuf, etc.), and more. We offer a script
                editor along with a bunch of useful templates [5].
              </p>
              <p>
                Fourth, we provide native connectors to non-Kafka targets. We
                also provide native configurability options tailored to these
                platforms. For example, with Event Hubs, users can perform CDC
                to topics distributed across different namespaces and
                subscriptions [4].
              </p>
              <p>
                Finally, We are laser focused on Postgres, enabling specific
                optimizations like native metrics for replication, wait-events,
                and # of connections. Features like faster initial loads through
                parallel snapshotting and decoding transactions in-flight are in
                private beta.
              </p>
              <p>
                Our hope is to provide the best data-movement experience for
                Postgres. PeerDB Streams is another step in that direction. We
                would love to get your feedback on product experience, our
                thesis and anything else that comes to your mind. It would be
                super useful for us. Thank you!
              </p>
              <p>References:</p>
              <p>
                [1]
                <a
                  href="https://debezium.io/blog/2020/10/22/towards-debezium-ui/"
                  >https://debezium.io/blog/2020/10/22/towards-debezium-ui/</a
                >
                [2]
                <a
                  href="https://debezium.io/documentation/reference/stable/operations/debezium-ui.html"
                  >https://debezium.io/documentation/reference/stable/operation...</a
                >
                [3]
                <a
                  href="https://medium.com/@cooper.wolfe/i-hated-debezium-so-much-i-did-it-myself-b43b0efc20a9"
                  >https://medium.com/@cooper.wolfe/i-hated-debezium-so-much-i-...</a
                >
                [4]
                <a
                  href="https://blog.peerdb.io/enterprise-grade-replication-from-postgres-to-azure-event-hubs"
                  >https://blog.peerdb.io/enterprise-grade-replication-from-pos...</a
                >
                [5]
                <a href="https://github.com/PeerDB-io/examples"
                  >https://github.com/PeerDB-io/examples</a
                >
                [5]
                <a href="https://app.peerdb.cloud">https://app.peerdb.cloud</a>
                [6]
                <a href="https://github.com/PeerDB-io/PeerDB"
                  >https://github.com/PeerDB-io/PeerDB</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="40276442">
          <h3>
            <a
              class="item"
              href="https://www.bentasker.co.uk/posts/blog/general/an-afternoon-in-sizewell-b-control-room-simulator.html"
              >Spending an afternoon in the Sizewell control-room simulator</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-06 @ 16:27:49</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40276442"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40276399">
          <h3>
            <a class="item" href="https://physics.aps.org/articles/v17/65"
              >Quantum gravity gets a new test</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-06 @ 16:24:09</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40276399"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40275997">
          <h3>
            <a
              class="item"
              href="https://andersmurphy.com/2024/05/06/clojure-managing-throughput-with-virtual-threads.html"
              >Clojure: Managing throughput with virtual threads</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-06 @ 15:48:09</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40275997"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40275973">
          <h3>
            <a class="item" href="http://www.nukefix.org/nukepix.html"
              >Nukefix: Simulating your nuclear weapons program</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-06 @ 15:45:50</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40275973"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40275759">
          <h3>
            <a
              class="item"
              href="https://www.science.org/doi/10.1126/sciadv.adl2524"
              >Evaluating bias and noise induced by the U.S. Census Bureau's
              privacy protection</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-06 @ 15:24:30</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40275759"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40274777">
          <h3>
            <a class="item" href="https://voidstarsec.com/blog/jtag-pifex"
              >PiFex: JTAG Hacking with a Raspberry Pi</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-06 @ 13:59:42</span
              ><span class="points-container"
                >Points: <span class="points">176</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40274777"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40273470">
          <h3>
            <a class="item" href="https://www.getanyplant.com/plants"
              >Show HN: A free site to explore and discover 6k plants</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-06 @ 11:42:41</span
              ><span class="points-container"
                >Points: <span class="points">344</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40273470"
                  >Comments</a
                ><span class="descendants">: 111</span></span
              >
            </h4>
            <div class="text">
              <p>
                I’m a data scientist by profession, so probably 80% of the work
                was totally new to me. I built v1 using wordpress , v2 using
                django, and v3 I pivoted to using react and next js for
                frontend.
              </p>
              <p>
                I would greatly appreciate any feedback on the site as well as
                any advice on how to grow it.
              </p>
            </div>
          </section>
        </section>
        <section id="40272577">
          <h3>
            <a class="item" href="https://www.tasteatlas.com/map"
              >World Food Atlas: Discover local dishes and ingredients</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-06 @ 08:50:28</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40272577"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40272186">
          <h3>
            <a
              class="item"
              href="https://www.jamesshore.com/v2/blog/2024/a-useful-productivity-measure"
              >A useful productivity measure?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-06 @ 07:39:52</span
              ><span class="points-container"
                >Points: <span class="points">184</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40272186"
                  >Comments</a
                ><span class="descendants">: 149</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40265904">
          <h3>
            <a
              class="item"
              href="https://arslan.io/2024/05/05/braun-borse-2024/"
              >Visiting the annual Braun collectors fair</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-05 @ 16:09:54</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40265904"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40263109">
          <h3>
            <a
              class="item"
              href="https://yosefk.com/blog/a-100x-speedup-with-unsafe-python.html"
              >A 100x speedup with unsafe Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-05 @ 08:08:13</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40263109"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40262289">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/05/04/arts/frank-stella-dead.html"
              >Frank Stella, Towering Artist and Master of Reinvention, Dies at
              87</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-05 @ 04:39:44</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40262289"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40252784">
          <h3>
            <a
              class="item"
              href="https://fzakaria.com/2024/05/03/speeding-up-elf-relocations-for-store-based-systems.html"
              >Speeding up ELF relocations for store-based systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-03 @ 21:48:43</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40252784"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
