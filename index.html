<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="47168726">
          <h3>
            <a
              class="item"
              href="https://cs.uml.edu/~fredm/courses/91.308-spr05/files/palmdocs/uiguidelines.pdf"
              >Palm OS User Interface Guidelines [pdf, 2003]</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-26 @ 17:01:05</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47168726"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="47168721">
          <h3>
            <a class="item" href="https://www.workatastartup.com/jobs/80596"
              >Bild AI (YC W25) Is Hiring Interns to Make Housing Affordable</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-26 @ 17:00:25</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="47168165">
          <h3>
            <a
              class="item"
              href="https://foreignpolicy.com/2026/02/25/anthropic-pentagon-feud-ai/"
              >The Pentagon Feuding with an AI Company Is a Bad Sign</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-26 @ 16:23:07</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47168165"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="47168012">
          <h3>
            <a class="item" href="https://endowment.dev/"
              >Open Source Endowment – new funding source for open source
              maintainers</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-26 @ 16:13:06</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47168012"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="47167931">
          <h3>
            <a
              class="item"
              href="https://read.technically.dev/p/vibe-coding-and-the-maker-movement"
              >Will vibe coding end like the maker movement?</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-26 @ 16:07:11</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47167931"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="47167858">
          <h3>
            <a
              class="item"
              href="https://blog.google/innovation-and-ai/technology/ai/nano-banana-2/"
              >Nano Banana 2: Google's latest AI image generation model</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-26 @ 16:02:37</span
              ><span class="points-container"
                >Points: <span class="points">270</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47167858"
                  >Comments</a
                ><span class="descendants">: 261</span></span
              >
            </h4>
          </section>
        </section>
        <section id="47167763">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/security/2026/02/new-airsnitch-attack-breaks-wi-fi-encryption-in-homes-offices-and-enterprises/"
              >New AirSnitch attack breaks Wi-Fi encryption in homes, offices,
              and enterprises</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-26 @ 15:55:48</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47167763"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="47166473">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=aoag03mSuXQ"
              >Story of XZ Backdoor [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-26 @ 14:21:05</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47166473"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="47166264">
          <h3>
            <a
              class="item"
              href="https://tuananh.net/2026/02/25/buildkit-docker-hidden-gem/"
              >BuildKit: Docker's Hidden Gem That Can Build Almost Anything</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-26 @ 14:05:46</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47166264"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="47165792">
          <h3>
            <a
              class="item"
              href="https://shkspr.mobi/blog/2026/02/this-time-is-different/"
              >Time Is Different</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-26 @ 13:28:59</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47165792"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="47165648">
          <h3>
            <a class="item" href="https://github.com/vercel-labs/just-bash"
              >just-bash: Bash for Agents</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-26 @ 13:16:30</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47165648"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="47165397">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/2026/02/25/tech/anthropic-safety-policy-change"
              >Anthropic ditches its core safety promise</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-26 @ 12:52:50</span
              ><span class="points-container"
                >Points: <span class="points">515</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47165397"
                  >Comments</a
                ><span class="descendants">: 291</span></span
              >
            </h4>
          </section>
        </section>
        <section id="47164270">
          <h3>
            <a
              class="item"
              href="https://gitlab.com/here_forawhile/terminalphone"
              >Show HN: Terminal Phone – E2EE Walkie Talkie from the Command
              Line</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-26 @ 10:40:45</span
              ><span class="points-container"
                >Points: <span class="points">236</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47164270"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
            <div class="text">
              TerminalPhone is a single, self-contained Bash script that
              provides anonymous, end-to-end encrypted voice and text
              communication between two parties over the Tor network. It
              operates as a walkie-talkie: you record a voice message, and it is
              compressed, encrypted, and transmitted to the remote party as a
              single unit. You can also send encrypted text messages during a
              call. No server infrastructure, no accounts, no phone numbers.
              Your Tor hidden service .onion address is your identity.
            </div>
          </section>
        </section>
        <section id="47163885">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=47163885"
              >Tell HN: YC companies scrape GitHub activity, send spam emails to
              users</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-26 @ 09:35:08</span
              ><span class="points-container"
                >Points: <span class="points">451</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47163885"
                  >Comments</a
                ><span class="descendants">: 155</span></span
              >
            </h4>
            <div class="text">
              <p>
                I recently noticed that an YC company (Run ANywhere, W26) sent
                me the following email:
              </p>
              <p>From: Aditya &lt;aditya@buildrunanywhere.org&gt;</p>
              <p>Subject: Mikołaj, think you'd like this</p>
              <p>[snip]</p>
              <p>Hi Mikołaj,</p>
              <p>
                I found your GitHub and thought you might like what we're
                building.
              </p>
              <p>[snip]</p>
              <p>
                I have also received a deluge of similar emails from another AI
                company, Voice.AI (doesn't seem to be YC affiliated). These
                emails indicate that those companies scrape people's Github
                activity, and if they notice users contributing to repos in
                their field of business, send marketing emails to those users
                without receiving their consent. My guess is that they use
                commit metadata for this purpose. This includes recipients under
                the GDPR (AKA me).
              </p>
              <p>
                I've sent complaints to both organizations, no response so far.
              </p>
              <p>
                I have just contacted both Github and YC Ethics on this issue,
                I'll update here if I get a response.
              </p>
            </div>
          </section>
        </section>
        <section id="47159430">
          <h3>
            <a class="item" href="https://www.bannedincalifornia.org/"
              >Banned in California</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-25 @ 23:16:40</span
              ><span class="points-container"
                >Points: <span class="points">413</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47159430"
                  >Comments</a
                ><span class="descendants">: 486</span></span
              >
            </h4>
          </section>
        </section>
        <section id="47159302">
          <h3>
            <a class="item" href="https://info.cern.ch">First Website (1992)</a>
          </h3>
          <section>
            <h4>
              <span>2026-02-25 @ 23:02:58</span
              ><span class="points-container"
                >Points: <span class="points">292</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47159302"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="47158975">
          <h3>
            <a
              class="item"
              href="https://www.ben-evans.com/benedictevans/2026/2/19/how-will-openai-compete-nkg2x"
              >How will OpenAI compete?</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-25 @ 22:29:25</span
              ><span class="points-container"
                >Points: <span class="points">407</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47158975"
                  >Comments</a
                ><span class="descendants">: 572</span></span
              >
            </h4>
          </section>
        </section>
        <section id="47157398">
          <h3>
            <a
              class="item"
              href="https://kanyilmaz.me/2026/02/23/cli-vs-mcp.html"
              >Making MCP cheaper via CLI</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-25 @ 20:29:37</span
              ><span class="points-container"
                >Points: <span class="points">293</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47157398"
                  >Comments</a
                ><span class="descendants">: 112</span></span
              >
            </h4>
          </section>
        </section>
        <section id="47157224">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/jimi-hendrix-systems-engineer"
              >Jimi Hendrix was a systems engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-25 @ 20:16:47</span
              ><span class="points-container"
                >Points: <span class="points">617</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47157224"
                  >Comments</a
                ><span class="descendants">: 205</span></span
              >
            </h4>
          </section>
        </section>
        <section id="47156925">
          <h3>
            <a
              class="item"
              href="https://trufflesecurity.com/blog/google-api-keys-werent-secrets-but-then-gemini-changed-the-rules"
              >Google API keys weren't secrets, but then Gemini changed the
              rules</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-25 @ 19:54:14</span
              ><span class="points-container"
                >Points: <span class="points">1081</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47156925"
                  >Comments</a
                ><span class="descendants">: 259</span></span
              >
            </h4>
          </section>
        </section>
        <section id="47154399">
          <h3>
            <a
              class="item"
              href="https://blogs.windows.com/windows-insider/2026/01/21/notepad-and-paint-updates-begin-rolling-out-to-windows-insiders/"
              >Windows 11 Notepad to support Markdown</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-25 @ 17:14:19</span
              ><span class="points-container"
                >Points: <span class="points">338</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47154399"
                  >Comments</a
                ><span class="descendants">: 505</span></span
              >
            </h4>
          </section>
        </section>
        <section id="47153798">
          <h3>
            <a
              class="item"
              href="https://worksinprogress.co/issue/the-united-states-needs-fewer-bus-stops/"
              >Bus stop balancing is fast, cheap, and effective</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-25 @ 16:31:26</span
              ><span class="points-container"
                >Points: <span class="points">407</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47153798"
                  >Comments</a
                ><span class="descendants">: 592</span></span
              >
            </h4>
          </section>
        </section>
        <section id="47139716">
          <h3>
            <a
              class="item"
              href="https://simonlermen.substack.com/p/large-scale-online-deanonymization"
              >Large-Scale Online Deanonymization with LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-24 @ 17:18:17</span
              ><span class="points-container"
                >Points: <span class="points">329</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47139716"
                  >Comments</a
                ><span class="descendants">: 233</span></span
              >
            </h4>
            <div class="text">
              <a href="https://arxiv.org/pdf/2602.16800"
                >https://arxiv.org/pdf/2602.16800</a
              >
              (via
              <a href="https://arxiv.org/abs/2602.16800"
                >https://arxiv.org/abs/2602.16800</a
              >)
            </div>
          </section>
        </section>
        <section id="47125044">
          <h3>
            <a class="item" href="https://www.hillelwayne.com/post/z3-examples/"
              >Some silly Z3 scripts I wrote</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-23 @ 17:01:26</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47125044"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="47122272">
          <h3>
            <a
              class="item"
              href="https://boilingsteam.com/poll-better-to-skip-a-year-for-pc-upgrades/"
              >Better to Skip a Year for Hardware Upgrades?</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-23 @ 13:46:45</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47122272"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="47112299">
          <h3>
            <a class="item" href="https://simonbergerart.com"
              >Artist who “paints” portraits on glass by hitting it with a
              hammer</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-22 @ 16:25:48</span
              ><span class="points-container"
                >Points: <span class="points">234</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47112299"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="47111164">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2602.06811"
              >A 26-Gram Butterfly-Inspired Robot Achieving Autonomous Tailless
              Flight</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-22 @ 14:15:09</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47111164"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="47110393">
          <h3>
            <a
              class="item"
              href="https://lithub.com/the-work-behind-the-writing-on-writers-and-their-day-jobs/"
              >Writers and Their Day Jobs</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-22 @ 12:13:15</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47110393"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="47107974">
          <h3>
            <a
              class="item"
              href="https://machinelearning.apple.com/research/ferret-ui"
              >Ferret-UI Lite: Lessons from Building Small On-Device GUI
              Agents</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-22 @ 03:54:01</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47107974"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="47106275">
          <h3>
            <a
              class="item"
              href="https://www.historytoday.com/archive/making-history/those-who-can-teach-history"
              >Those who can, teach history</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-02-21 @ 23:37:04</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=47106275"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2026/index.md"
              >2026</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
