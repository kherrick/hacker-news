<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44490588">
          <h3>
            <a class="item" href="https://buildmytransit.nyc"
              >Show HN: NYC Subway Simulator and Route Designer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-07 @ 14:13:56</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44490588"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <p>
                As a long term NYC resident, I have read countless articles on
                ideas tweaking subway services, but always found them hard to
                follow without visual aid. So over the long weekend I decided to
                build one. It has all the basic features: trains would spawn at
                their origin, stop at stations, and slow down if it gets too
                close to another. You can also design custom routes by piecing
                tracks together.
              </p>
              <p>Have fun, and let me know what you think!</p>
            </div>
          </section>
        </section>
        <section id="44490299">
          <h3>
            <a class="item" href="https://github.com/joelburget/microjax"
              >Showh HN: Microjax – JAX in two classes and six functions</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-07 @ 13:41:55</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44490299"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44489803">
          <h3>
            <a
              class="item"
              href="https://noperator.dev/posts/o3-pocket-profile/"
              >I used o3 to profile myself from my saved Pocket links</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-07 @ 12:44:19</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44489803"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44489690">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2506.17298"
              >Mercury: Ultra-Fast Language Models Based on Diffusion</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-07 @ 12:31:08</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44489690"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44488331">
          <h3>
            <a
              class="item"
              href="https://www.businessinsider.com/anthropic-cut-pirated-millions-used-books-train-claude-copyright-2025-6"
              >Anthropic cut up millions of used books, and downloaded 7M
              pirated ones – judge</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-07 @ 09:20:38</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44488331"
                  >Comments</a
                ><span class="descendants">: 144</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44486235">
          <h3>
            <a
              class="item"
              href="https://oda.uni-obuda.hu/bitstream/handle/20.500.14044/10350/Gabor_S_Becker_ertekezes.pdf"
              >High Performance Image Sensor Processing Using FPGAs [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-07 @ 02:36:57</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44486235"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44485342">
          <h3>
            <a class="item" href="https://github.com/jackjackbits/bitchat"
              >Bitchat – A decentralized messaging app that works over Bluetooth
              mesh networks</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-07 @ 00:05:46</span
              ><span class="points-container"
                >Points: <span class="points">526</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44485342"
                  >Comments</a
                ><span class="descendants">: 227</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44484688">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/p/intels-lion-cove-p-core-and-gaming"
              >Intel's Lion Cove P-Core and Gaming Workloads</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 22:27:39</span
              ><span class="points-container"
                >Points: <span class="points">226</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44484688"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44484682">
          <h3>
            <a
              class="item"
              href="http://addxorrol.blogspot.com/2025/07/a-non-anthropomorphized-view-of-llms.html"
              >A non-anthropomorphized view of LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 22:26:44</span
              ><span class="points-container"
                >Points: <span class="points">304</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44484682"
                  >Comments</a
                ><span class="descendants">: 288</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44484363">
          <h3>
            <a
              class="item"
              href="https://fractalfir.github.io/generated_html/cg_gcc_bootstrap.html"
              >Building the Rust Compiler with GCC</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 21:46:02</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44484363"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44484207">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2504.18412"
              >LLMs should not replace therapists</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 21:27:28</span
              ><span class="points-container"
                >Points: <span class="points">187</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44484207"
                  >Comments</a
                ><span class="descendants">: 247</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44484137">
          <h3>
            <a
              class="item"
              href="https://www.deadlanguagesociety.com/p/why-english-doesnt-use-accents"
              >Why English doesn't use accents</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 21:18:26</span
              ><span class="points-container"
                >Points: <span class="points">227</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44484137"
                  >Comments</a
                ><span class="descendants">: 316</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44484026">
          <h3>
            <a
              class="item"
              href="https://remark.ing/rob/rob/Thesis-interesting-work-ie"
              >Thesis: Interesting work is less amenable to the use of AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 21:01:51</span
              ><span class="points-container"
                >Points: <span class="points">115</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44484026"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44482965">
          <h3>
            <a class="item" href="https://alpha.lisagui.com/"
              >Show HN: I wrote a "web OS" based on the Apple Lisa's UI, with
              1-bit graphics</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 18:32:55</span
              ><span class="points-container"
                >Points: <span class="points">419</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44482965"
                  >Comments</a
                ><span class="descendants">: 122</span></span
              >
            </h4>
            <div class="text">
              <a href="https://lisagui.com/info.html"
                >https://lisagui.com/info.html</a
              >
              <p>
                This is a web OS I wrote in vanilla JS that looks like the Apple
                Lisa Office System (1983-85), with other contemporaneous
                influences and additional improvements and features. It's
                currently in alpha and isn't remotely bug free. I had been
                holding off on posting this here until it was somewhat
                presentable and useful. Please note; the Lisa conforms more
                literally to the desktop metaphor than most modern GUIs - some
                of the important differences are mentioned in the readme.
              </p>
              <p>
                This is a complete recreation of the UI in JS; it all renders to
                a single canvas element. It's not a CSS theme, and not an
                emulator ported to JS. None of the code is written by Apple.
                I'll be happy to elaborate more in the comments, but the short
                version is the entire UI is defined outside the DOM using JS
                objects. Thus, every interface element - menus, windows,
                controls, and even typefaces - was recreated from scratch. There
                are no font files - I wrote my own typesetting system, which
                supports combining multiple text styles and generates new glyph
                variants on the fly.
              </p>
              <p>
                Many of the technical decisions I made were motivated by a
                desire to have this look the same in every browser. That's
                harder to do with the DOM and CSS, and why I moved as much logic
                as I could to JS. Also, the only part of the project outside of
                vanilla JS and standard web APIs is the Gulp toolkit, which I'm
                using as a minification/build tool. No vibe coding was used to
                make this!
              </p>
              <p>
                This is based on a UI from the 80s, and won't work well on your
                phone. If you insist on running it that way, turn on trackpad
                mode in the touchscreen settings panel of the preferences app.
                For best results, install it as a PWA (add it to your home
                screen). Also there are some odd Android bugs; the native
                touchscreen keyboard is currently broken, and there's an issue
                with the cursor when dragging windows.
              </p>
              <p>
                I realize there's not a whole lot to do within LisaGUI right
                now; I've got a big list of additional features and apps I'll be
                adding in the future. I've been working on this project for a
                while, and I'm eager to hear people's feedback and answer
                questions about it.
              </p>
            </div>
          </section>
        </section>
        <section id="44482504">
          <h3>
            <a class="item" href="https://github.com/sst/opencode"
              >Opencode: AI coding agent, built for the terminal</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 17:26:47</span
              ><span class="points-container"
                >Points: <span class="points">271</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44482504"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44482194">
          <h3>
            <a
              class="item"
              href="https://davidgomes.com/async-queue-interview-ai/"
              >Async Queue – One of my favorite programming interview
              questions</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 16:46:01</span
              ><span class="points-container"
                >Points: <span class="points">190</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44482194"
                  >Comments</a
                ><span class="descendants">: 204</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44480223">
          <h3>
            <a
              class="item"
              href="https://shkspr.mobi/blog/2025/07/get-the-location-of-the-iss-using-dns/"
              >Get the location of the ISS using DNS</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 12:32:46</span
              ><span class="points-container"
                >Points: <span class="points">317</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44480223"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44479502">
          <h3>
            <a
              class="item"
              href="https://designsystems.international/ideas/when-figma-starts-designing-us/"
              >When Figma starts designing us</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-06 @ 10:38:27</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44479502"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44476382">
          <h3>
            <a
              class="item"
              href="https://mildbyte.xyz/blog/solving-wordle-with-uv-dependency-resolver/"
              >Solving Wordle with uv's dependency resolver</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-05 @ 23:28:30</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44476382"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44468833">
          <h3>
            <a
              class="item"
              href="https://publicdomainreview.org/essay/the-cats-meat-man/"
              >The Cat's Meat Man: Feeding Felines in Victorian London</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-04 @ 23:28:48</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44468833"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44468753">
          <h3>
            <a
              class="item"
              href="https://sarahrenaeclark.com/lightfast-testing-pencils/"
              >Lightfastness Testing of Colored Pencils</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-04 @ 23:15:18</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44468753"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44468114">
          <h3>
            <a
              class="item"
              href="https://johnnysswlab.com/the-messy-reality-of-simd-vector-functions/"
              >The messy reality of SIMD (vector) functions</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-04 @ 21:49:03</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44468114"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44467838">
          <h3>
            <a class="item" href="https://github.com/ZaneH/piano-trainer"
              >Show HN: Piano Trainer – Learn piano scales, chords and more
              using MIDI</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-04 @ 20:58:53</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44467838"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44463063">
          <h3>
            <a
              class="item"
              href="https://www.engineersneedart.com/blog/almostfired/almostfired.html"
              >The first time I was almost fired from Apple</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-04 @ 09:59:43</span
              ><span class="points-container"
                >Points: <span class="points">281</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44463063"
                  >Comments</a
                ><span class="descendants">: 116</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44461082">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2025-07-hymn-babylon-millennium.html"
              >Hymn to Babylon, missing for a millennium, has been discovered</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-04 @ 04:16:12</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44461082"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44460498">
          <h3>
            <a
              class="item"
              href="https://archaeologymag.com/2025/07/neanderthals-operated-fat-factory-125000-years-ago/"
              >Neanderthals operated prehistoric “fat factory” on German
              lakeshore</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-04 @ 01:45:15</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44460498"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44459877">
          <h3>
            <a
              class="item"
              href="https://eugeneyan.com/writing/uncommon-python/"
              >Uncommon Uses of Python in Commonly Used Libraries (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-03 @ 23:12:07</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44459877"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44458896">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=-HNpim5x-IE"
              >What every programmer should know about how CPUs work [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-03 @ 20:29:45</span
              ><span class="points-container"
                >Points: <span class="points">165</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44458896"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44455240">
          <h3>
            <a class="item" href="https://gitlab.com/w0utert/cpparinfer"
              >Cpparinfer: A C++23 implementation of the parinfer algorithm</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-03 @ 14:07:48</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44455240"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44455175">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=5QcCeSsNRks"
              >François Chollet: The Arc Prize and How We Get to AGI [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-03 @ 14:00:16</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44455175"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
