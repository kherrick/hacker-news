<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39861680">
          <h3>
            <a class="item" href="https://m6n.io/@fuzzychef/112172393647826741"
              >PostgreSQL maintainer Simon Riggs has died in a small airplane
              crash</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 08:08:54</span
              ><span class="points-container"
                >Points: <span class="points">171</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39861680"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39861578">
          <h3>
            <a class="item" href="https://research.myshell.ai/open-voice"
              >OpenVoice: Versatile Instant Voice Cloning</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 07:50:29</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39861578"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39861398">
          <h3>
            <a class="item" href="https://lwn.net//Articles/965434/"
              >Managing Linux Servers with Cockpit</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 07:07:05</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39861398"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39861367">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/capi-money/jobs/OTaPesL-senior-fullstack-engineer"
              >Capi Money (YC S23) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 07:00:52</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39860769">
          <h3>
            <a
              class="item"
              href="https://infisical.com/blog/postgresql-migration-technical"
              >The Great Migration from MongoDB to PostgreSQL</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 04:38:00</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39860769"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39860498">
          <h3>
            <a class="item" href="https://mwl.io/archives/23498"
              >Vultr Just Betrayed Us</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 03:49:12</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39860498"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39860365">
          <h3>
            <a class="item" href="https://github.com/mratsim/Arraymancer"
              >Arraymancer – Deep Learning Nim Library</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 03:26:07</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39860365"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39860270">
          <h3>
            <a class="item" href="https://hindenburgresearch.com/equinix/"
              >Equinix: Major Accounting Manipulation, Core Business Decay</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 03:12:30</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39860270"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39859801">
          <h3>
            <a
              class="item"
              href="https://golem.ph.utexas.edu/category/2024/03/why_mathematics_is_boring_1.html"
              >Math writing is dull when it neglects the human dimension</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 02:03:13</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39859801"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39859710">
          <h3>
            <a class="item" href="https://github.com/monogon-dev/monogon"
              >Monogon: A Linux userland in pure Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 01:48:44</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39859710"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39859119">
          <h3>
            <a class="item" href="http://thirty-seven.org/">Thirty Seven</a>
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 00:19:05</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39859119"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39859000">
          <h3>
            <a
              class="item"
              href="https://rev.ng/blog/open-sourcing-renvg-decompiler-ui-closed-beta"
              >The rev.ng decompiler goes open source</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-29 @ 00:01:03</span
              ><span class="points-container"
                >Points: <span class="points">163</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39859000"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39858941">
          <h3>
            <a
              class="item"
              href="https://www.sheldrake.org/files/pdfs/papers/Is_the_Sun_Conscious.pdf"
              >Is the Sun Conscious? (2021) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-28 @ 23:54:34</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39858941"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39858850">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2024/03/netflix-ad-spend-led-to-facebook-dm-access-end-of-facebook-streaming-biz-lawsuit/"
              >Facebook let Netflix see user DMs, quit streaming to keep Netflix
              happy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-28 @ 23:44:57</span
              ><span class="points-container"
                >Points: <span class="points">398</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39858850"
                  >Comments</a
                ><span class="descendants">: 158</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39858750">
          <h3>
            <a class="item" href="https://vivirenremoto.github.io/doomcaptcha/"
              >Doom Captcha (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-28 @ 23:32:29</span
              ><span class="points-container"
                >Points: <span class="points">294</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39858750"
                  >Comments</a
                ><span class="descendants">: 89</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39858219">
          <h3>
            <a class="item" href="https://github.com/eduardoleao052/js-torch"
              >Deep Learning in JavaScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-28 @ 22:35:39</span
              ><span class="points-container"
                >Points: <span class="points">172</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39858219"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39858144">
          <h3>
            <a
              class="item"
              href="https://lwn.net/SubscriberLink/966631/6bf2063136effa1e/"
              >The race to replace Redis</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-28 @ 22:27:29</span
              ><span class="points-container"
                >Points: <span class="points">470</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39858144"
                  >Comments</a
                ><span class="descendants">: 298</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39857837">
          <h3>
            <a
              class="item"
              href="https://www.thisismoney.co.uk/money/bills/article-13244469/Why-people-hit-5-fines-counterfeit-stamps.html"
              >Why are so many people being hit with £5 fines for 'counterfeit'
              stamps?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-28 @ 21:55:58</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39857837"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39857433">
          <h3>
            <a
              class="item"
              href="https://seancoates.com/blogs/matter-and-privacy"
              >You can't leak users' data if you don't hold it</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-28 @ 21:19:10</span
              ><span class="points-container"
                >Points: <span class="points">377</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39857433"
                  >Comments</a
                ><span class="descendants">: 129</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39856413">
          <h3>
            <a
              class="item"
              href="https://prospect.org/infrastructure/transportation/2024-03-28-suicide-mission-boeing/"
              >What Boeing did to all the guys who remember how to build a
              plane</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-28 @ 19:42:21</span
              ><span class="points-container"
                >Points: <span class="points">731</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39856413"
                  >Comments</a
                ><span class="descendants">: 440</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39854921">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39854921"
              >Launch HN: Thorntale (YC W24) – Presentation software that works
              with your data</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-28 @ 17:39:17</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39854921"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.thorntale.com/">https://www.thorntale.com/</a
              >, a new tool for making data driven presentations. We make it
              easier for product, engineering, and data teams to communicate
              their work. Here’s a video demo:
              <a href="https://youtu.be/yLCIo3jG2GM"
                >https://youtu.be/yLCIo3jG2GM</a
              >, and you can try it now at
              <a href="https://app.sandbox.thorntale.com"
                >https://app.sandbox.thorntale.com</a
              >
              without signing in.
              <p>
                Why? Because one of us (the data scientist) kept asking the
                other (a backend engineer) to move metrics from ClickHouse and
                CockroachDB, to Snowflake, to Looker, and then to Excel, so that
                she could make a chart in Excel for the BizOps team to
                screenshot, and finally stick in Google Slides. Besides being
                annoying for everyone, this produces inconsistencies and
                inaccuracies between the actual data and what got presented. We
                wasted three peoples’ time tracking down queries, going back and
                forth, and reformatting the same information. We’re building
                something that can replace PowerPoint/Google Slides for this
                kind of recurring presentation, with direct data connections and
                native charting, so that we can all stop screenshotting.
              </p>
              <p>Here are some example presentations:</p>
              <p>
                - A postmortem report:
                <a
                  href="https://app.thorntale.com/report/Postmortem-Template-1755293100"
                  >https://app.thorntale.com/report/Postmortem-Template-1755293...</a
                >
              </p>
              <p>
                - A product weekly OKR update:
                <a
                  href="https://app.thorntale.com/report/Weekly-Product-OKR-Update-87324231"
                  >https://app.thorntale.com/report/Weekly-Product-OKR-Update-8...</a
                >
              </p>
              <p>
                - An exoplanet analysis:
                <a
                  href="https://app.thorntale.com/report/Exoplanet-Analysis-demo-report-1627720912"
                  >https://app.thorntale.com/report/Exoplanet-Analysis-demo-rep...</a
                >
              </p>
              <p>
                Thorntale has direct data connections and native charting,
                eliminating the need for screenshotting or pixel pushing.
                Currently, we can connect to and visualize data from Google
                Sheets, Snowflake, and Postgres, with plans to add more source
                types. We can create or update decks for recurring meetings
                (like weekly product updates) in minutes instead of hours, and
                our charts can be re-segmented to answer questions
                mid-presentation, instead of as a followup days later.
              </p>
              <p>
                Another thing we’re trying to fix is the need to write a report
                in a document, only to recreate that report later in a slide
                deck. This is duplicate work, and splits what should be a single
                point of truth. Every Thorntale report is actually both a
                presentation and a document, in one. You can write your long
                version, choose which points are the most important, and include
                only those points in the presentation view. When people go back
                to read your work later, they can see the full context you
                started with. Try it with the /reportonly command in the tool.
              </p>
              <p>
                We have grand plans for more — dbt support, more datasource
                connectors, direct embedding from BI tools like Looker and
                Tableau, contextual search, and more graph types — but right now
                we’ve got an early beta. You can check out our sandbox at
                <a href="https://app.sandbox.thorntale.com"
                  >https://app.sandbox.thorntale.com</a
                >. Some features are restricted in sandbox mode, but if you like
                it, we’ve also got free and open signups at
                <a href="https://app.thorntale.com">https://app.thorntale.com</a
                >.
              </p>
              <p>
                We’re really excited to share this with you all, and looking
                forward to your comments and feedback!
              </p>
            </div>
          </section>
        </section>
        <section id="39853958">
          <h3>
            <a
              class="item"
              href="https://www.maginative.com/article/ai21-labs-unveils-jamba-the-first-production-grade-mamba-based-ai-model/"
              >Jamba: Production-grade Mamba-based AI model</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-28 @ 16:36:56</span
              ><span class="points-container"
                >Points: <span class="points">299</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39853958"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39853474">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39853474"
              >Launch HN: Eggnog (YC W24) – AI videos with consistent
              characters</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-28 @ 16:14:16</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39853474"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.eggnog.ai">https://www.eggnog.ai</a>, an AI
              video platform where your characters look the same across every
              scene. Eggnog lets you create characters, use them in scene
              generations, and share them with others for remixing. Here are
              some videos made with Eggnog:
              <p>
                - Fanfiction:
                <a
                  href="https://www.reddit.com/r/harrypotterfanfiction/comments/1bn6cdb/im_making_some_hp_short_videos_let_me_know_what/"
                  >https://www.reddit.com/r/harrypotterfanfiction/comments/1bn6...</a
                >
                (includes some sounds from outside Eggnog)
              </p>
              <p>
                - Comedy:
                <a href="https://x.com/jitsvm/status/1771609353725919316?s=20"
                  >https://x.com/jitsvm/status/1771609353725919316?s=20</a
                >
              </p>
              <p>
                - Post-apocalyptic vibes:
                <a
                  href="https://x.com/saucebook/status/1771212617601659279?s=20"
                  >https://x.com/saucebook/status/1771212617601659279?s=20</a
                >
              </p>
              <p>
                We got into making funny AI videos over the last year, but felt
                annoyed that the characters always looked different in each
                scene. It made it harder to make cool videos and for our friends
                to understand the plot.
              </p>
              <p>
                Diffusion models, like those that make AI videos, start with
                random noise, then add detail. So the little things that make a
                character recognizable will almost always come out looking
                different across generations, no matter how many tricks you add
                into the prompt. For instance, if you want your wizard to have a
                red hat, it might be crooked in one generation and straight in
                the next.
              </p>
              <p>
                Eggnog allows users to make consistent characters by using
                Low-Rank Adaption (LoRA). LoRA takes in a set of images of a
                character in different scenarios and uses those images to teach
                the model that character as a concept. We do this by taking a
                single prompt that a user writes for a character (e.g., an
                ancient Greek soldier with dark hair and bushy beard) and
                turning it into a training set of images of the character in
                different poses, shot from different angles. Once the character
                is trained into the model, the user can then invoke that
                character concept in the prompt and get consistent generations
                about 80% of the time.
              </p>
              <p>
                There is still a lot of room to make Eggnog generations more
                consistent and controllable. Generations sometimes come out with
                the wrong gender, missing key details from the costume, or fail
                in a long tail of other ways. We also often struggle to control
                the character’s exact body movement. We’re planning to address
                these cases with more optimization of the prompt that invokes
                the character concept and by using new open source video models
                that bake in 3D representations of humans.
              </p>
              <p>
                The other fun thing about making characters with Eggnog is that
                you can share them. We already made one San Francisco “American
                Psycho” video that got over 100k views on Twitter (<a
                  href="https://x.com/jitsvm/status/1766987382916894966?s=20"
                  >https://x.com/jitsvm/status/1766987382916894966?s=20</a
                >). Then we expanded on the SF universe by making another video
                with the same character and a new friend for him (<a
                  href="https://x.com/SamuelMGPlank/status/1767405784986718406?s=20"
                  >https://x.com/SamuelMGPlank/status/1767405784986718406?s=20</a
                >). Eventually, you’ll be able to create and remix all the
                components of a good video—the characters, the costumes, the
                sets, and the sounds will all be part of a library of assets
                built up by the Eggnog community.
              </p>
              <p>
                Eggnog is free to use, and you can try it out in the playground:
                <a href="https://www.eggnog.ai/playground"
                  >https://www.eggnog.ai/playground</a
                >. If you’re looking for some inspiration, you can try using the
                character “herm” waving a glowing wand or the character “lep”
                walking down a Dublin street. We’ll make money eventually by
                showing ads to viewers who come to Eggnog to watch AI videos.
              </p>
              <p>
                We’re really excited to see all the fun videos and characters
                people are making with Eggnog, and looking forward to hearing
                what you all think!
              </p>
            </div>
          </section>
        </section>
        <section id="39850972">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/quansheng-uv-k5-hacking"
              >UV-K5 is the most hackable handheld ham radio yet</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-28 @ 13:18:07</span
              ><span class="points-container"
                >Points: <span class="points">257</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39850972"
                  >Comments</a
                ><span class="descendants">: 143</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39845104">
          <h3>
            <a
              class="item"
              href="https://lflank.wordpress.com/2024/03/26/the-cias-cold-war-plan-to-use-stray-cats-as-spies/"
              >The CIA's Cold War plan to use stray cats as spies</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-27 @ 21:58:15</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39845104"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39844532">
          <h3>
            <a
              class="item"
              href="https://www.arcgis.com/apps/dashboards/fe88b5e18c6443c7afaf6e32f8432687"
              >Sunken Ships of the Second World War</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-27 @ 21:00:56</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39844532"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39835817">
          <h3>
            <a class="item" href="https://friesian.com"
              >The Proceedings of the Friesian School, Fourth Series</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-27 @ 04:57:46</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39835817"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39832272">
          <h3>
            <a
              class="item"
              href="https://512pixels.net/2024/03/apple-jonathan-modular-concept/"
              >The Apple Jonathan: A 1980s concept computer that never
              shipped</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-26 @ 20:09:24</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39832272"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39826661">
          <h3>
            <a
              class="item"
              href="https://www.frontiersin.org/journals/physiology/articles/10.3389/fphys.2020.580171/full"
              >Acetate Revisited: A Key Biomolecule at the Nexus of Metabolism,
              Epigenetics</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-26 @ 11:46:02</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39826661"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39826552">
          <h3>
            <a
              class="item"
              href="https://worldsensorium.com/chocolate-and-the-hawaiian-dream-comes-true/"
              >Chocolate and the Hawaiian Dream Comes True</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-26 @ 11:32:05</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39826552"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
