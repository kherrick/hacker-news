<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37365485">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/mindsdb/jobs/wnUfBhO-senior-frontend-engineer"
              >MindsDB (YC W20) Is Hiring a Senior Front End Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-02 @ 21:00:47</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37364885">
          <h3>
            <a class="item" href="https://anarc.at/software/desktop/calibre/"
              >Calibre Replacement Considerations (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-02 @ 19:48:14</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37364885"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37364624">
          <h3>
            <a
              class="item"
              href="https://rodrigodd.github.io/2023/09/02/gameroy-jit.html"
              >GameRoy: JIT Compilation in High-Accuracy Game Boy Emulation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-02 @ 19:20:24</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37364624"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37364611">
          <h3>
            <a class="item" href="https://www.dosgameclub.com/"
              >DOS Game Club</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-02 @ 19:19:21</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37364611"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37364605">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=37364605"
              >PSA: Don't base your business around Discord.7yr account banned
              for posting ASNs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-02 @ 19:18:55</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37364605"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
            <div class="text">
              <p>
                Well just a few days ago I found out that my account of 7 years
                was just banned without a warning for a very obvious error on
                their part. Just hours before my account was banned I posted a
                list of ASNs (basically ISPs) connected to a non-discord server
                I had that looked like this:
              </p>
              <p>22773 ASN-CXA-ALL-CCI-22773-RDC, US</p>
              <p>5432 PROXIMUS-ISP-AS, BE</p>
              <p>577 BACOM, CA</p>
              <p>
                To someone who doesn't know what ASNs are, they would probably
                assume they are addresses. This is not personal information, and
                there's no way to tie this information to any individual.
              </p>
              <p>
                I opened a ticket and the only reply I get is that the ban will
                not be reversed and that the account will be deleted in 14 days.
                I've tried posting on Twitter and they have selectively ignored
                me while replying to everyone else. Any submission I make on the
                subreddit gets instantly deleted.
              </p>
              <p>Screenshots for proof.</p>
              <p>
                https://pbs.twimg.com/media/F49XZ4zaEAA_7mR?format=png&amp;name=small
              </p>
              <p>
                https://pbs.twimg.com/media/F49XZ4zaEAErD3J?format=png&amp;name=small
              </p>
              <p>
                https://pbs.twimg.com/media/F49XtAiaEAMmDdK?format=png&amp;name=900x900
              </p>
              <p>
                This also isn't the first issue we've had with Discord. They
                threatened to delete my server a few years ago because 1 person
                said they were underage amongst thousands of lines of chat and
                we did not see it and ban them. They refused to tell us who it
                was so I had to spend hours looking through chat to find the
                offending user.
              </p>
              <p>
                Think twice before you decide to base your business around
                Discord.
              </p>
            </div>
          </section>
        </section>
        <section id="37364388">
          <h3>
            <a
              class="item"
              href="https://oaklandlibrary.org/found-in-a-library-book/"
              >Found in a Library Book</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-02 @ 18:56:08</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37364388"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37364290">
          <h3>
            <a class="item" href="https://py-code.org/stats"
              >Show HN: I mirrored all the code from PyPI to GitHub and analysed
              it</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-02 @ 18:45:07</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37364290"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
            <div class="text">
              <p>
                1. Scanning of all new Python packages for accidentally
                published credentials
              </p>
              <p>
                2. A browsable/searchable index of published code with a nice UI
              </p>
              <p>
                3. Large-scale analysis of <i>all</i> published code to see how
                the language is evolving
              </p>
              <p>
                Using this project anyone is able to download the contents of
                PyPI to their personal machine and analyse every piece of code
                ever published in a matter of hours.
              </p>
              <p>
                I hope it enables people to do things with the worlds largest
                and oldest corpus of Python code that wasn't possible before,
                and while this is likely totally useless to most people I think
                that is kind of cool and unique.
              </p>
            </div>
          </section>
        </section>
        <section id="37364124">
          <h3>
            <a
              class="item"
              href="https://blog.yossarian.net/2023/07/27/Introducing-shaq-a-CLI-for-shazam"
              >Show HN: Shaq, a CLI for Shazam</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-02 @ 18:27:02</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37364124"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37363623">
          <h3>
            <a
              class="item"
              href="https://memgraph.com/blog/in-memory-vs-disk-based-databases-larger-than-memory-architecture"
              >In-memory vs. disk-based DB: Why do you need a larger than memory
              architecture?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-02 @ 17:33:15</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37363623"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37363616">
          <h3>
            <a
              class="item"
              href="https://www.opensecrets.org/news/2023/09/tax-prep-companies-lobbying-against-free-file-face-scrutiny-from-lawmakers/"
              >Tax prep companies: $90M lobbying against free tax-filing</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-02 @ 17:32:55</span
              ><span class="points-container"
                >Points: <span class="points">307</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37363616"
                  >Comments</a
                ><span class="descendants">: 160</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37363362">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2308.15022"
              >Recursively Summarizing Enables Long-Term Dialogue Memory in
              LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-02 @ 17:08:46</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37363362"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37362151">
          <h3>
            <a class="item" href="https://xrss.infogulch.com/"
              >Show HN: XRss: An RSS Reader and web stack demo powered by
              Htmx</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-02 @ 15:02:52</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37362151"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
            <div class="text">
              <p>
                The entire site UI for XRss comes from
                <i>a single HTML template file</i>. This index.html includes
                everything from SQL queries and route definitions and handlers
                to htmx state transition attributes and tailwindcss classes, and
                developing it requires <i>zero build steps</i> (amortized).
              </p>
              <p>
                Check out the source which manages to be at once banal and
                gnarly:
                <a
                  href="https://github.com/infogulch/xrss/blob/master/templates/index.html"
                  >https://github.com/infogulch/xrss/blob/master/templates/inde...</a
                >
              </p>
              <p>
                xtemplate preloads the whole template structure into memory and
                builds the router at startup, so responses to matching requests
                are rendered after a single lookup. Combined with direct queries
                to sqlite makes for a very snappy experience typically
                responding in less than 5ms. (Fingers crossed.)
              </p>
              <p>
                There are various places where XRss could be improved (PRs
                welcome!), but it already delivers on its purpose of
                demonstrating the plausibility of xtemplate. See the xtemplate
                readme for an overview of what you can do with it. I think of it
                as 'PHP but the syntax looks like Go templates'.
              </p>
              <p>
                <a href="https://github.com/infogulch/caddy-xtemplate"
                  >https://github.com/infogulch/caddy-xtemplate</a
                >
              </p>
              <p>
                Let me know what you think! Does remaking PHP from scratch out
                of Go templates make me a lunatic? (yes) Is it a good idea
                anyway? (yes) What kind of web application do you think would be
                a good fit for a platform like this?
              </p>
            </div>
          </section>
        </section>
        <section id="37362132">
          <h3>
            <a
              class="item"
              href="https://www.ucsf.edu/news/2023/08/426056/can-artificial-kidney-finally-free-patients-dialysis"
              >Can an artificial kidney finally free patients from dialysis?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-02 @ 15:00:30</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37362132"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37362088">
          <h3><a class="item" href="https://forgefed.org/">ForgeFed</a></h3>
          <section>
            <h4>
              <span>2023-09-02 @ 14:56:00</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37362088"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37361947">
          <h3>
            <a
              class="item"
              href="https://dannorth.net/2023/09/02/the-worst-programmer/"
              >The worst programmer I know</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-02 @ 14:41:45</span
              ><span class="points-container"
                >Points: <span class="points">833</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37361947"
                  >Comments</a
                ><span class="descendants">: 400</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37361840">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-08-behavior-male-fruit-flies-intense.html"
              >The surprising behavior of male fruit flies under intense light
              conditions</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-02 @ 14:30:35</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37361840"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37361736">
          <h3>
            <a
              class="item"
              href="https://github.com/cabralpinto/modular-diffusion"
              >Show HN: Modular Diffusion – A modular Python library for
              diffusion models</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-02 @ 14:16:53</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37361736"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
            <div class="text">
              <p>
                The base idea is to have a Model class that takes different
                modules corresponding to the different aspects of the Diffusion
                Model process (noise schedule, noise type, denoising network,
                loss function, guidance, etc.) and allow the user to mix and
                match different modules to achieve different results. The
                library ships with a bunch of prebuilt modules and the plan is
                to add many more. I also made it super easy to implement your
                own modules, you just need to extend from one of the base
                classes available.
              </p>
              <p>
                Contrary to HuggingFace Diffusers, this library is focused on
                designing and training your own Diffusion Models rather than
                finetuning pretrained ones (although this is possible).
              </p>
              <p>I would really appreciate your feedback.</p>
            </div>
          </section>
        </section>
        <section id="37361462">
          <h3>
            <a
              class="item"
              href="https://www.techdirt.com/2023/09/01/tesla-rivian-put-on-fake-show-of-support-for-right-to-repair/"
              >Tesla, Rivian Put on Fake Show of Support for ‘Right to
              Repair’</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-02 @ 13:41:54</span
              ><span class="points-container"
                >Points: <span class="points">238</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37361462"
                  >Comments</a
                ><span class="descendants">: 183</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37361094">
          <h3>
            <a class="item" href="https://www.drcathicks.com/post/on-craft"
              >On Craft</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-02 @ 12:55:11</span
              ><span class="points-container"
                >Points: <span class="points">178</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37361094"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37361050">
          <h3>
            <a class="item" href="https://alexanderobenauer.com/labnotes/038/"
              >Semantic Zoom</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-02 @ 12:50:09</span
              ><span class="points-container"
                >Points: <span class="points">152</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37361050"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37360251">
          <h3>
            <a
              class="item"
              href="https://nicholas.carlini.com/writing/llm-forecast/question/Capital-of-Paris"
              >A GPT-4 capability forecasting challenge</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-02 @ 10:40:26</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37360251"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37360249">
          <h3>
            <a
              class="item"
              href="https://stytch.com/blog/open-sourcing-sqx-a-way-to-build-flexible-database-models-in-go/"
              >Open-sourcing SQX, a way to build flexible database models in
              Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-02 @ 10:39:50</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37360249"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37359250">
          <h3>
            <a class="item" href="https://holly.witteman.ca/the-b-lane-swimmer/"
              >The B Lane Swimmer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-02 @ 07:29:48</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37359250"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37359193">
          <h3>
            <a
              class="item"
              href="https://tylervigen.com/the-mystery-of-the-bloomfield-bridge"
              >The Mystery of the Bloomfield Bridge</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-02 @ 07:12:34</span
              ><span class="points-container"
                >Points: <span class="points">532</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37359193"
                  >Comments</a
                ><span class="descendants">: 144</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37358468">
          <h3>
            <a
              class="item"
              href="http://www.jameshedberg.com/writing/2015/02/01/the-craft-of-experimental-physics.html"
              >The Craft of Experimental Physics (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-02 @ 03:58:45</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37358468"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37358063">
          <h3>
            <a
              class="item"
              href="https://archive.org/details/build-your-own-flight-sim-in-c-dos-game-dev-michael-radtke-chris-lampton"
              >Build Your Own Flight Sim in C++ (1996)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-02 @ 02:19:39</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37358063"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37355429">
          <h3>
            <a
              class="item"
              href="https://notes.alinpanaitiu.com/Restarting-macOS-apps-automatically-on-crash"
              >Restarting macOS apps automatically on crash</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-01 @ 19:50:16</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37355429"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37354377">
          <h3>
            <a
              class="item"
              href="https://www.palladiummag.com/2022/10/10/the-transformations-of-science/"
              >The Transformations of Science</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-01 @ 18:14:41</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37354377"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37349696">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/09/01/intel_graph_analytics_chip/"
              >Intel shows off 8-core, 528-thread processor with 1TB/s of
              co-packaged optics</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-01 @ 12:05:15</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37349696"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37344191">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/2004/05/24/the-squid-hunter"
              >The Hunt for the Giant Squid (2004)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-31 @ 21:57:48</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37344191"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
