<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42589863">
          <h3>
            <a
              class="item"
              href="https://twitter.com/damengchen/status/1875296442417607072"
              >Perplexity Got Ads</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 21:54:42</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42589863"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42589431">
          <h3>
            <a
              class="item"
              href="https://jobs.ashbyhq.com/extend/9d4d8974-bd9b-432d-84ec-8268e5a8ed37"
              >Extend (YC W23) is hiring engineers to build LLM document
              processing</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 21:01:16</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42589054">
          <h3>
            <a
              class="item"
              href="https://jvernay.fr/en/blog/polyline-triangulation/"
              >Triangulation of a polyline with thickness (a.k.a. line strip)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 20:12:59</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42589054"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42588956">
          <h3>
            <a class="item" href="https://github.com/s-macke/VoxelSpace"
              >VoxelSpace: Terrain rendering algorithm in less than 20 lines of
              code (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 20:01:29</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42588956"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42588151">
          <h3>
            <a
              class="item"
              href="https://www.hubrecht.eu/zebrafish-protein-unlocks-dormant-genes-for-heart-repair/"
              >Zebrafish protein unlocks dormant genes for heart repair</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 18:24:41</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42588151"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42587883">
          <h3>
            <a
              class="item"
              href="https://goodfuzzysounds.com/ma/docs/funnyversion.htm"
              >Two Turntables and a Microphone (2006)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 17:56:00</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42587883"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42587829">
          <h3>
            <a
              class="item"
              href="https://www.rollingstone.com/culture/rs-gaming/world-of-warcraft-onlyfangs-twitch-roleplay-1235222436/"
              >OnlyFangs has made 'World of Warcraft' into Twitch's best soap
              opera</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 17:50:50</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42587829"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42587383">
          <h3>
            <a
              class="item"
              href="https://www.journals.uchicago.edu/doi/full/10.1086/716634"
              >Adaptation to a Viscous Snowball Earth Ocean as Path to Complex
              Multicellularity (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 17:08:35</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42587383"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42587356">
          <h3>
            <a class="item" href="https://pavelsevecek.github.io/">SpaceSim</a>
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 17:05:17</span
              ><span class="points-container"
                >Points: <span class="points">210</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42587356"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42587014">
          <h3>
            <a
              class="item"
              href="https://swungover.wordpress.com/2011/06/15/savoy-style-vs-hollywood-style-a-fight-to-the-death-hopefully/"
              >Savoy Style vs. Hollywood Style: A Fight to the Death
              (Hopefully?) (2011)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 16:31:00</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42587014"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42586879">
          <h3>
            <a class="item" href="https://blog.schwad.org/schwogs/6"
              >In Memoriam: Noah Gibbs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 16:17:22</span
              ><span class="points-container"
                >Points: <span class="points">220</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42586879"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42586590">
          <h3>
            <a
              class="item"
              href="https://mathr.co.uk/blog/2021-05-14_deep_zoom_theory_and_practice.html"
              >Mandelbrot deep zoom theory and practice (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 15:42:02</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42586590"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42586042">
          <h3>
            <a class="item" href="https://blog.val.town/blog/fast-follow/"
              >What we learned copying all the best code assistants</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 14:45:52</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42586042"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42585332">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=RikO_3jedlY"
              >Oral history of Caroline Rose, writer of Inside Macintosh (2023)
              [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 13:08:08</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42585332"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              Caroline Rose was a technical writer at Apple from 1982, lead
              writer and editor of "Inside Macintosh". Apple-era starts at 1h22m
              in the video, NeXT-era at 1h58m.
            </div>
          </section>
        </section>
        <section id="42584750">
          <h3>
            <a
              class="item"
              href="https://www.usenix.org/publications/loginonline/evolution-sre-google"
              >The Evolution of SRE at Google</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 11:38:49</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42584750"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42584400">
          <h3>
            <a
              class="item"
              href="https://minimaxir.com/2025/01/write-better-code/"
              >Can LLMs write better code if you keep asking them to “write
              better code”?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 10:30:44</span
              ><span class="points-container"
                >Points: <span class="points">569</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42584400"
                  >Comments</a
                ><span class="descendants">: 333</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42583688">
          <h3>
            <a
              class="item"
              href="https://sites.pitt.edu/~jdnorton/Goodies/Dome/"
              >The Dome (2005)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 08:20:44</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42583688"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42583297">
          <h3>
            <a
              class="item"
              href="https://www.economist.com/europe/2025/01/02/why-canada-should-join-the-eu"
              >Why Canada Should Join the EU</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 07:07:14</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42583297"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42583141">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/article/laser-mapping-reveals-oldest-amazonian-cities-built-2500-years-ago"
              >Laser mapping reveals oldest Amazonian cities, built 2500 years
              ago (2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 06:36:35</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42583141"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42582203">
          <h3>
            <a class="item" href="https://streamer.kuvasz.io/"
              >Kuvasz-streamer: open-source CDC for Postgres for low latency
              replication</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-03 @ 03:52:42</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42582203"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42577736">
          <h3>
            <a
              class="item"
              href="http://databasearchitects.blogspot.com/2024/12/advent-of-code-2024-in-pure-sql.html"
              >Advent of Code 2024 in pure SQL</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-02 @ 19:20:50</span
              ><span class="points-container"
                >Points: <span class="points">451</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42577736"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42570609">
          <h3>
            <a
              class="item"
              href="https://fractalfir.github.io/generated_html/refl_priv.html"
              >Rust, Reflection and Access Rules</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-02 @ 00:48:57</span
              ><span class="points-container"
                >Points: <span class="points">3</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42570609"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42570429">
          <h3>
            <a class="item" href="https://obnakwa.itch.io/dimityjones"
              >Show HN: Dimity Jones in Puzzle Castle: An Electronic Escape
              Novel</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-02 @ 00:17:52</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42570429"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <a href="https://news.ycombinator.com/item?id=39972586"
                >https://news.ycombinator.com/item?id=39972586</a
              >
              ... I was humbled by and am wholeheartedly grateful to several
              brilliant proofreaders; their names appear at the end of the
              second chapter.)
              <p>
                _Dimity Jones In Puzzle Castle: An Electronic Escape Novel in
                Eighty-Nine Ciphertexts_ is a (mostly) fictional story,
                contained in a single text file, that requires the reader to
                solve puzzles as they go along, and to use each chapter's
                solution as a key to decipher the next.
              </p>
              <p>
                Think: escape room in the form of a novel -- or, as one reader
                put it, "Interactive Fiction meets Advent of Code."
              </p>
              <p>
                A computer, and rudimentary coding skills in a language of your
                choice, will be indispensable for performing the transformations
                -- and might help with the solving too!
              </p>
              <p>
                My wife, the author, passed away six years ago. This is not the
                last thing she wrote, but it is the most unusual,
                unapproachable, and personal of her major works. It is also, as
                the only novel of hers that I cannot breeze through in an
                afternoon (and despite my unflattering appearance in it), my
                favorite.
              </p>
              <p>
                Though _Dimity Jones_ was left unfinished, and perhaps
                abandoned, at the time of my wife's death, its elements were all
                there, on her hard disk, awaiting only a final compiling. My
                contribution to this text has therefore been little more than
                that of an occasional copyeditor (my wife was a meticulous
                speller and self-proofreader) and playtester.
              </p>
              <p>Thank you for checking it out.</p>
            </div>
          </section>
        </section>
        <section id="42558496">
          <h3>
            <a class="item" href="https://github.com/turbolytics/sql-flow"
              >Show HN: Execute SQL against Bluesky firehose</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-31 @ 13:13:20</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42558496"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42558143">
          <h3>
            <a class="item" href="https://github.com/yibie/org-supertag"
              >Show HN: Org-Supertag</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-31 @ 11:44:14</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42558143"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
            <div class="text">
              Enhance org-mode tag system, borrow idea from tana.
            </div>
          </section>
        </section>
        <section id="42557947">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42557947"
              >Ask HN: How to learn marketing and sales as a solo
              entrepreneur?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-31 @ 11:01:13</span
              ><span class="points-container"
                >Points: <span class="points">408</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42557947"
                  >Comments</a
                ><span class="descendants">: 157</span></span
              >
            </h4>
            <div class="text">
              <p>
                Many of you succeed in this field, so I'm genuinely curious how
                to learn it? What are decent learning resources out there?
              </p>
              <p>Thanks in advance</p>
            </div>
          </section>
        </section>
        <section id="42557920">
          <h3>
            <a
              class="item"
              href="https://nicollet.net/blog/darklaga/remake.html"
              >Show HN: A remake of my 2004 PDA video game</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-31 @ 10:55:56</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42557920"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
            <div class="text">
              <p>
                Play the game online:
                <a href="https://nicollet.net/blog/darklaga/darklaga.html"
                  >https://nicollet.net/blog/darklaga/darklaga.html</a
                >
              </p>
              <p>
                Technical article about the remake:
                <a href="https://nicollet.net/blog/darklaga/remake.html"
                  >https://nicollet.net/blog/darklaga/remake.html</a
                >
              </p>
              <p>
                I have tested Firefox, Chrome and Edge on desktop and mobile (no
                access to a device capable of running Safari).
              </p>
              <p>
                It's amazing how much difference 20 years makes: the hardware is
                so much more powerful, the web as a deployment platform is so
                much easier than side-loading onto a PDA through a serial cable
                or sharing .exe files through e-mail, and my experience as a
                professional developer makes almost everything so much easier...
                but at the same, it didn't feel that the language, editor or
                debugger (TypeScript on Visual Studio Code) were significantly
                better than good old Visual C++ 6.
              </p>
              <p>
                Repository with the code of the remake:
                <a href="https://github.com/VictorNicollet/Darklaga"
                  >https://github.com/VictorNicollet/Darklaga</a
                >
                (sadly, I cannot provide the video and audio assets themselves
                under any open license).
              </p>
            </div>
          </section>
        </section>
        <section id="42557850">
          <h3>
            <a class="item" href="https://github.com/acaudwell/Gource"
              >Gource: Software Version Control Visualization</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-31 @ 10:37:02</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42557850"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42549195">
          <h3>
            <a class="item" href="https://ssd.jpl.nasa.gov/horizons/"
              >JPL Horizons on-line solar system data and ephemeris computation
              service</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-30 @ 13:45:51</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42549195"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42546246">
          <h3>
            <a
              class="item"
              href="https://byroot.github.io/ruby/json/2024/12/29/optimizing-ruby-json-part-4.html"
              >Optimizing Ruby's JSON, Part 4</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-30 @ 03:45:14</span
              ><span class="points-container"
                >Points: <span class="points">198</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42546246"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
