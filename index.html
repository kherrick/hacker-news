<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38509956">
          <h3>
            <a
              class="item"
              href="https://www.salon.com/2023/12/02/why-does-sleep-become-more-elusive-as-we-age-it-has-to-do-with-shifts-in-sleep-architecture/"
              >Why does sleep becomes more elusive as we age? Shifts in "sleep
              architecture"</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 19:31:20</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38509956"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38509780">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Embrace,_extend,_and_extinguish"
              >Embrace, Extend, and Extinguish</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 19:08:06</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38509780"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38509739">
          <h3>
            <a
              class="item"
              href="https://daily.jstor.org/how-american-librarians-helped-defeat-the-nazis/"
              >American Librarians Helped Defeat the Nazis</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 19:02:47</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38509739"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38509678">
          <h3>
            <a class="item" href="https://blitiri.com.ar/p/chasquid/"
              >Chasquid – SMTP server focused on simplicity</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 18:55:47</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38509678"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38509255">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2311.02206"
              >GDlog: A GPU-Accelerated Deductive Engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 18:08:23</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38509255"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38509173">
          <h3>
            <a class="item" href="https://wildergardenaudio.com/maim/"
              >Show HN: Audio plugin for circuit-bent MP3 compression sounds</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 18:01:36</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38509173"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
            <div class="text">
              <p>
                The plugin lets you switch between two MP3 encoders, since under
                the MP3 standard, the specifics of what to lose in MP3 lossy
                compression is left up to the encoder. The encoders are LAME,
                the gold standard for open-source MP3 encoders, and BladeEnc, an
                old open-source MP3 encoder that has a really bubbly sound and
                was fun to work with.
              </p>
              <p>
                I'd love any feedback, and I'll be around to answer questions!
              </p>
            </div>
          </section>
        </section>
        <section id="38509011">
          <h3>
            <a
              class="item"
              href="https://kffhealthnews.org/news/article/medicare-advantage-payment-rates-friction/"
              >Medicare Advantage Popular with Seniors – But Not Hospitals and
              Doctors</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 17:46:26</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38509011"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38508779">
          <h3>
            <a class="item" href="https://github.com/mattwparas/steel"
              >Steel – An embeddable and extensible scheme dialect built in
              Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 17:24:18</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38508779"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38508532">
          <h3>
            <a
              class="item"
              href="https://jobs.ashbyhq.com/motion/4f5f6a29-3af0-4d79-99a4-988ff7c5ba05?utm_source=hn"
              >Motion (YC W20) Is Hiring Front End Engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 17:00:02</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38508518">
          <h3>
            <a
              class="item"
              href="https://www.cvedetails.com/vulnerability-list/vendor_id-16203/Tesla.html?page=1&amp;order=1&amp;trc=13&amp;sha=73e27d3898b2b240263e0f443513b5e8f9073841"
              >Tesla: Security Vulnerabilities</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 16:58:55</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38508518"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38508418">
          <h3>
            <a
              class="item"
              href="https://johnhawks.net/weblog/all-the-hominins-made-tools/"
              >All the hominins made tools</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 16:49:36</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38508418"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38508324">
          <h3>
            <a class="item" href="https://github.com/good-lly/lowstorage"
              >Lowstorage: JSON-based database for Cloudflare Workers and R2
              buckets</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 16:38:39</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38508324"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38508282">
          <h3>
            <a class="item" href="https://github.com/lobsters/lobsters"
              >Lobsters</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 16:34:49</span
              ><span class="points-container"
                >Points: <span class="points">170</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38508282"
                  >Comments</a
                ><span class="descendants">: 112</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38508276">
          <h3>
            <a class="item" href="https://github.com/aws/s2n-tls"
              >S2n-TLS – A C99 implementation of the TLS/SSL protocol</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 16:34:21</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38508276"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38508250">
          <h3>
            <a
              class="item"
              href="https://www.pcmag.com/articles/ibms-plan-to-update-cobol-with-watson"
              >Watsonx: IBM's code assistant for turning COBOL into Java</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 16:31:31</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38508250"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38507672">
          <h3>
            <a class="item" href="https://bbycroft.net/llm"
              >LLM Visualization</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 15:22:39</span
              ><span class="points-container"
                >Points: <span class="points">714</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38507672"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38507594">
          <h3>
            <a
              class="item"
              href="https://blog.scottlogic.com/2019/05/17/webassembly-compiler.html"
              >Build your own WebAssembly Compiler (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 15:11:29</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38507594"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38507446">
          <h3>
            <a class="item" href="https://reportphonespam.org/"
              >Report Phone Spam – Shut down robocallers and text spammers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 14:49:51</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38507446"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
            <div class="text">
              <p>It works, and it feels like magic.</p>
              <p>
                Background: Earlier this year, I wrote an HN comment[1]
                explaining how to find the telecom carrier responsible for a
                robocall or SMS spam campaign. Those steps aren't documented
                anywhere else, even though they're actually pretty easy.
              </p>
              <p>
                This info deserved to be much more visible, so now it is:
                <a href="https://reportphonespam.org/"
                  >https://reportphonespam.org/</a
                >
              </p>
              <p>
                As my site says, most reputable telecom carriers don't want
                unsolicited messages on their network or phone numbers. In order
                to disconnect their abusive customers, they need to hear about
                the abuse. That's where you come in. In a few minutes, you can
                report abuse to the responsible carrier, who will investigate
                and often shut off the spammer's phone number(s).
              </p>
              <p>
                [1]:
                <a href="https://news.ycombinator.com/item?id=34570065#34570835"
                  >https://news.ycombinator.com/item?id=34570065#34570835</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="38507381">
          <h3>
            <a
              class="item"
              href="http://twitchard.github.io/posts/2019-06-21-life-is-too-short-for-jenkins.html"
              >The worst thing about Jenkins is that it works (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 14:40:36</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38507381"
                  >Comments</a
                ><span class="descendants">: 142</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38507116">
          <h3>
            <a class="item" href="https://precondition.github.io/home-row-mods"
              >A guide to home row mods</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 13:58:17</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38507116"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38506900">
          <h3>
            <a class="item" href="https://www.onsites.fyi/"
              >Show HN: Onsites.fyi - Curated Big Tech Interview Experiences</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 13:29:53</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38506900"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
            <div class="text">
              <p>
                While Glassdoor and other employment discussion boards offer
                valuable interview experience data, navigating it to prepare for
                interviews can be difficult.
              </p>
              <p>
                Onsites.fyi curates interview experiences and insights from Big
                Tech hiring across various positions and levels.
              </p>
              <p>
                Our collection currently includes interview experiences from
                top-tier companies like Apple, Google, Meta, Microsoft, and
                Amazon.
              </p>
              <p>
                Reviewing real interview experiences (rounds, questions, format)
                of others could be an invaluable preparation tool for
                interviews.
              </p>
              <p>Try it out and please share any feedback!</p>
            </div>
          </section>
        </section>
        <section id="38506835">
          <h3>
            <a
              class="item"
              href="https://github.com/ikatson/rqbit/releases/tag/v4.0.0"
              >Show HN: Rqbit – bittorent CLI and desktop app written in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 13:17:53</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38506835"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38506705">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/quadruped-robot-wheels"
              >Wheel-Hand-Leg-Arms Open Doors Playfully</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 12:50:38</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38506705"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38506166">
          <h3>
            <a class="item" href="https://plant.max-richter.dev"
              >Show HN: Simulate 3D Plants in the Browser</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 10:55:35</span
              ><span class="points-container"
                >Points: <span class="points">219</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38506166"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38506078">
          <h3>
            <a class="item" href="http://brinch-hansen.net/papers/"
              >Concurrent Pascal and SuperPascal programming languages, and
              more</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 10:27:38</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38506078"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38505138">
          <h3>
            <a class="item" href="https://ed-thelen.org/comp-hist/APL-hist.html"
              >A Personal History of APL (1982)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-03 @ 05:46:18</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38505138"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38499684">
          <h3>
            <a
              class="item"
              href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4298934"
              >How are startups shaped by macro conditions at birth?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-02 @ 16:25:18</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38499684"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38498109">
          <h3>
            <a class="item" href="https://mitxela.com/projects/candle"
              >Tiny volumetric display</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-02 @ 12:23:05</span
              ><span class="points-container"
                >Points: <span class="points">1446</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38498109"
                  >Comments</a
                ><span class="descendants">: 165</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38497963">
          <h3>
            <a
              class="item"
              href="https://justcreative.com/why-do-everyones-logo-fonts-look-the-same/"
              >Why do everyone's logo fonts look the same? (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-02 @ 11:56:02</span
              ><span class="points-container"
                >Points: <span class="points">218</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38497963"
                  >Comments</a
                ><span class="descendants">: 134</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38497549">
          <h3>
            <a
              class="item"
              href="https://blog.research.google/2023/12/unsupervised-speech-to-speech.html"
              >Unsupervised speech-to-speech translation from monolingual
              data</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-02 @ 10:24:07</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38497549"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
