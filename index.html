<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44090815">
          <h3>
            <a
              class="item"
              href="https://timesofindia.indiatimes.com/technology/tech-news/microsoft-software-engineer-fired-for-disrupting-ceo-satya-nadellas-speech-at-build-2025-says-cant-open-/articleshow/121360389.cms"
              >Microsoft engineer fired for disrupting CEO Nadella's speech at
              Build 2025</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-25 @ 20:29:36</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44090815"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44090387">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=44090387"
              >Ask HN: What are you working on? (May 2025)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-25 @ 19:36:58</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44090387"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
            <div class="text">
              What are you working on? Any new ideas that you're thinking about?
            </div>
          </section>
        </section>
        <section id="44090302">
          <h3>
            <a
              class="item"
              href="https://chrlschn.dev/blog/2025/05/beware-the-complexity-merchants/"
              >Beware the Complexity Merchants</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-25 @ 19:25:58</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44090302"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44089424">
          <h3>
            <a class="item" href="https://github.com/Seeker04/plwm"
              >Plwm – An X11 window manager written in Prolog</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-25 @ 17:41:11</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44089424"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44089150">
          <h3>
            <a class="item" href="https://github.com/ossu/computer-science"
              >Path to a free self-taught education in Computer Science</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-25 @ 17:06:55</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44089150"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44089134">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/planes/673462/newark-airport-delay-air-traffic-control-tracon-radar"
              >The Newark airport crisis</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-25 @ 17:04:54</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44089134"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44089108">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/martin/jobs"
              >Martin (YC S23) Is Hiring Founding AI/Product Engineers to Build
              a Better Siri</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-25 @ 17:00:38</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44089106">
          <h3>
            <a
              class="item"
              href="https://ephemeral.cx/2013/12/writing-a-self-mutating-x86_64-c-program/"
              >Writing a Self-Mutating x86_64 C Program (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-25 @ 17:00:26</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44089106"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44089054">
          <h3>
            <a class="item" href="https://github.com/xcaeser/zli"
              >Show HN: Zli – A Batteries-Included CLI Framework for Zig</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-25 @ 16:52:14</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44089054"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
            <div class="text">
              <p>Key features:</p>
              <p>
                - Typed flags with default values and help output - Rich
                formatting, and layout support - Command trees with isolated
                execution logic - It’s designed to feel good to use, not just to
                work. - Built for real-world CLI apps, not toy examples.
              </p>
              <p>
                Would love feedback, feature ideas, or thoughts from other Zig
                devs.
              </p>
              <p>
                repo here:
                <a href="https://github.com/xcaeser/zli"
                  >https://github.com/xcaeser/zli</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="44088957">
          <h3>
            <a
              class="item"
              href="https://www.telegraph.co.uk/world-news/2025/05/23/denmark-raise-retirement-age-70/"
              >Denmark to raise retirement age to 70</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-25 @ 16:34:28</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44088957"
                  >Comments</a
                ><span class="descendants">: 383</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44088926">
          <h3>
            <a
              class="item"
              href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=5202339"
              >Can a corporation be pardoned?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-25 @ 16:28:58</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44088926"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44088777">
          <h3>
            <a class="item" href="https://github.com/DustinBrett/daedalOS"
              >Show HN: DaedalOS – Desktop Environment in the Browser</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-25 @ 16:06:12</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44088777"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
            <div class="text">
              <a href="https://dustinbrett.com">https://dustinbrett.com</a>
              <p>Hey HN!</p>
              <p>
                I've been building my passion project daedalOS for over 4 years
                now.
              </p>
              <p>
                The original idea was to give visitors to my website the
                experience as if they had remotely connected to my personal
                machine. To do this I decided I would attempt to recreate as
                much of the functionality as possible.
              </p>
              <p>
                My hope is to keep working on this project for the rest of my
                life and continue to evolve it's capabilities as technologies
                progress.
              </p>
              <p>Thanks for checking it out!</p>
            </div>
          </section>
        </section>
        <section id="44088682">
          <h3>
            <a
              class="item"
              href="https://behind.pretix.eu/2018/01/20/cups-driver/"
              >Writing your own CUPS printer driver in 100 lines of Python
              (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-25 @ 15:52:48</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44088682"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44088216">
          <h3>
            <a class="item" href="https://lottie.github.io/"
              >Lottie is an open format for animated vector graphics</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-25 @ 14:45:47</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44088216"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44087916">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/article/strange-metals-point-whole-new-way-understand-electricity"
              >'Strange metals' point to a whole new way to understand
              electricity</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-25 @ 14:02:19</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44087916"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44087844">
          <h3>
            <a class="item" href="https://hynek.me/talks/design-pressure/"
              >Design Pressure: The Invisible Hand That Shapes Your Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-25 @ 13:51:55</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44087844"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44087373">
          <h3>
            <a class="item" href="https://oppi.li/posts/programming_on_34_keys/"
              >Programming on 34 Keys (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-25 @ 12:35:30</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44087373"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44087183">
          <h3>
            <a
              class="item"
              href="https://drops.dagstuhl.de/storage/00lipics/lipics-vol316-aft2024/LIPIcs.AFT.2024.24/LIPIcs.AFT.2024.24.pdf"
              >Wrench Attacks: Physical attacks targeting cryptocurrency users
              (2024) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-25 @ 11:56:16</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44087183"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44087049">
          <h3>
            <a class="item" href="https://expressive.app/expressive-animator/"
              >Show HN: SVG Animation Software</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-25 @ 11:21:22</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44087049"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
            <div class="text">
              Expressive Animator is an SVG vector animation software that helps
              users create and export animated icons, logos, and illustrations.
              Users can import SVG, PDF, Adobe Illustrator files, and Figma
              designs, and animate them using easing controls, motion paths,
              masking, and other techniques. Expressive Animator also allow
              users to export their animations in other formats as Lottie, GIF,
              PNG, and video.
            </div>
          </section>
        </section>
        <section id="44086530">
          <h3>
            <a
              class="item"
              href="https://www.swlondoner.co.uk/news/16052025-is-tfl-losing-the-battle-against-heat-on-the-victoria-line"
              >Is TfL losing the battle against heat on the Victoria line?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-25 @ 09:01:34</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44086530"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44086235">
          <h3>
            <a class="item" href="http://rednafi.com/go/di_frameworks_bleh/"
              >Dependency injection frameworks add confusion</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-25 @ 07:41:07</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44086235"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44085920">
          <h3>
            <a
              class="item"
              href="https://simonwillison.net/2025/May/25/claude-4-system-card/"
              >Claude 4 System Card</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-25 @ 06:06:39</span
              ><span class="points-container"
                >Points: <span class="points">484</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44085920"
                  >Comments</a
                ><span class="descendants">: 191</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44084677">
          <h3>
            <a
              class="item"
              href="https://behind.pretix.eu/2025/05/23/captchas-are-over/"
              >CAPTCHAs are over (in ticketing)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-25 @ 00:37:08</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44084677"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44083467">
          <h3>
            <a class="item" href="https://endler.dev/2025/reinvent-the-wheel/"
              >Reinvent the Wheel</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-24 @ 20:05:12</span
              ><span class="points-container"
                >Points: <span class="points">549</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44083467"
                  >Comments</a
                ><span class="descendants">: 209</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44080237">
          <h3>
            <a
              class="item"
              href="https://imprimis.hillsdale.edu/tariffs-in-american-history/"
              >Tariffs in American History</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-24 @ 11:02:22</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44080237"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44072137">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/news/672682/internet-archive-microfiche-lo-fi-beats-channel"
              >Now you can watch the Internet Archive preserve documents in real
              time</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-23 @ 12:14:22</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44072137"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44059994">
          <h3>
            <a class="item" href="https://flownet.com/gat/jpl-lisp.html"
              >Lisping at JPL (2002)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-22 @ 08:31:36</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44059994"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44059657">
          <h3>
            <a class="item" href="https://github.com/JetBrains/koog"
              >Koog, a Kotlin-based framework to build and run Al agents in
              idiomatic Kotlin</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-22 @ 07:40:23</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44059657"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44051386">
          <h3>
            <a class="item" href="https://github.com/zeenolife/ai-baby-monitor"
              >Show HN: AI Baby Monitor – local Video-LLM that beeps when safety
              rules break</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 13:43:48</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44051386"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
            <div class="text">
              <p>Why?</p>
              <p>
                When we bought a crib for our daughter, the first thing she
                tried was climbing over the rail :/ I got a bit paranoid about
                constantly watching her over, so I thought of a helper that can
                *actively* watch the baby, while parents could stay
                *semi-actively* alert. It’s meant to be an additional set of
                eyes, and *not* a replacement for the adult. Thus, just a beep
                sound and not phone notifications.
              </p>
              <p>How it works</p>
              <p>
                * *stream_to_redis.py* captures video stream frames → Redis
                streams
              </p>
              <p>
                * *run_watcher.py* pulls the latest N frames, injects them + the
                rules into a prompt and hits a local *vLLM* server running *Qwen
                2.5 VL*
              </p>
              <p>
                * Model returns structured JSON (`should_alert`, `reasoning`,
                `awareness_level`)
              </p>
              <p>* If `should_alert=True` → `playsound` beep</p>
              <p>* Streamlit page displays both camera and LLM logs</p>
            </div>
          </section>
        </section>
        <section id="44049252">
          <h3>
            <a
              class="item"
              href="https://solhsa.com/oldernews2025.html#ON-FILE-FORMATS"
              >On File Formats</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-21 @ 07:48:38</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44049252"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
