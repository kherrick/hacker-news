<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37142065">
          <h3>
            <a
              class="item"
              href="https://www.sfgate.com/tech/article/cruise-stuck-wet-concrete-sf-18297946.php"
              >Cruise vehicle gets stuck in wet concrete while driving in San
              Francisco</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-16 @ 02:16:54</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37142065"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37141821">
          <h3>
            <a
              class="item"
              href="https://www.phoronix.com/review/amd-inception-benchmarks"
              >AMD Inception Mitigations Cause 20% Performance Drop in Database
              Servers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-16 @ 01:47:39</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37141821"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37141463">
          <h3>
            <a
              class="item"
              href="https://www.oryxspioenkop.com/2023/08/putting-down-pen-reflecting-on-oryxs.html"
              >Putting Down the Pen: Reflecting on Oryx’s Journey</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-16 @ 01:01:24</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37141463"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37140998">
          <h3>
            <a class="item" href="https://opensanctuary.org/"
              >The Open (Animal) Sanctuary Project</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-16 @ 00:02:20</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37140998"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37140681">
          <h3>
            <a class="item" href="https://toyrus.ngrok.io/~ted/pawpaws/"
              >Ted's Notes on Pawpaws (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 23:26:02</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37140681"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37140320">
          <h3>
            <a
              class="item"
              href="https://www.independent.ie/business/personal-finance/bank-of-ireland-it-blunder-allows-customers-who-have-no-money-get-access-to-cash-at-atms/a510070628.html"
              >Bank of Ireland IT blunder allows customers who have no money get
              access to cash</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 22:50:54</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37140320"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37140159">
          <h3>
            <a
              class="item"
              href="https://www.moderncsv.com/modern-csv-2-is-now-available/"
              >Modern CSV version 2</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 22:35:09</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37140159"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
            <div class="text">
              <p>
                Modern CSV is a tabular file editor/viewer for Windows, Mac, and
                Linux. I developed it out of frustration with how spreadsheet
                programs handle CSV files. Plain text editors, on the other job,
                do a poor job of handling columns. With Modern CSV, I attempt to
                combine the best of both worlds.
              </p>
              <p>
                With version 2, you can expect to see an improved UI/UX, better
                performance, more useful features, updated documentation, and
                for Mac users, native Apple Silicon support.
              </p>
              <p>
                If you haven't tried it yet, give it a shot and let me know what
                you think!
              </p>
            </div>
          </section>
        </section>
        <section id="37140013">
          <h3>
            <a class="item" href="https://finbarr.ca/how-is-llama-cpp-possible/"
              >How Is LLaMa.cpp Possible?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 22:18:17</span
              ><span class="points-container"
                >Points: <span class="points">291</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37140013"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37138807">
          <h3>
            <a
              class="item"
              href="https://langdev.stackexchange.com/questions/2692/how-should-i-read-type-system-notation"
              >How should I read type system notation?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 20:15:27</span
              ><span class="points-container"
                >Points: <span class="points">177</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37138807"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37138681">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/tech-policy/2023/08/isps-complain-that-listing-every-fee-is-too-hard-urge-fcc-to-scrap-new-rule/"
              >ISPs complain that listing every fee is too hard, urge FCC to
              scrap new rule</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 20:05:43</span
              ><span class="points-container"
                >Points: <span class="points">305</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37138681"
                  >Comments</a
                ><span class="descendants">: 233</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37138672">
          <h3>
            <a
              class="item"
              href="https://nonint.com/2022/05/30/my-deep-learning-rig/"
              >My deep learning rig (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 20:05:06</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37138672"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37137810">
          <h3>
            <a class="item" href="https://probml.github.io/pml-book/book2.html"
              >Probabilistic Machine Learning: Advanced Topics</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 18:57:16</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37137810"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37137110">
          <h3>
            <a
              class="item"
              href="https://blog.redplanetlabs.com/2023/08/15/how-we-reduced-the-cost-of-building-twitter-at-twitter-scale-by-100x/"
              >We reduced the cost of building Mastodon at Twitter-scale by
              100x</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 17:54:13</span
              ><span class="points-container"
                >Points: <span class="points">733</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37137110"
                  >Comments</a
                ><span class="descendants">: 287</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37136898">
          <h3>
            <a class="item" href="https://github.com/varunshenoy/opendream"
              >Opendream: A layer-based UI for Stable Diffusion</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 17:38:10</span
              ><span class="points-container"
                >Points: <span class="points">326</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37136898"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37136340">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/seam/jobs/9VKC412-product-manager"
              >Seam (YC S20), API for IoT, Is Hiring a Founding PM</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 17:00:32</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37134293">
          <h3>
            <a class="item" href="https://github.com/ergomake/layerform"
              >Show HN: Layerform – Open-source development environments using
              Terraform files</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 14:15:51</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37134293"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
            <div class="text">
              <p>
                Whenever engineers run layerform spawn, we use plain .tf files
                to give them their own "staging" environment that looks just
                like production.
              </p>
              <p>
                Many teams have a single (or too few) staging environments,
                which developers have to queue to use. This is particularly a
                problem when a system is large, because then engineers can't run
                it on their machines and cannot easily test their changes in a
                production-like environment. Often they end up with a cluttered
                Slack channel in which engineers wait for their turn to use
                staging. Sometimes, they don't even have that clunky channel and
                end up merging broken code or shipping bugs to production. Lucas
                and I decided to solve this because we previously suffered with
                shared staging environments.
              </p>
              <p>
                Layerform gives each developer their own production-like
                environment.This eliminates the bottleneck, increasing the
                number of deploys engineers make. Additionally, it reduces the
                amount of bugs and rework because developers have a
                production-like environment to develop and test against. They
                can just run "layerform spawn" and get their own staging.
              </p>
              <p>
                We wrap the MPL-licensed Terraform and allow engineers to
                encapsulate each part of their infrastructure into layers. They
                can then create multiple instances of a particular layer to
                create a development environment.The benefit of using layers
                instead of raw Terraform modules is that they're much easier to
                write and reuse, meaning multiple development environments can
                run on top of the same infrastructure.
              </p>
              <p>
                Layerform's environments are quick and cheap to spin up because
                they share core pieces of infrastructure. Additionally,
                Layerform can automatically tag components in each layer, making
                it easier for FinOps teams to manage costs and do chargebacks.
              </p>
              <p>
                For example: with Layerform, a product developer can spin up
                their own lambdas and pods for staging while still using a
                shared Kubernetes cluster and Kafka instance. That way,
                development environments are quicker to spin up and cheaper to
                maintain. Each developer's layer also gets a tag, meaning FinOps
                teams know how much each team's environments cost.
              </p>
              <p>
                For the sake of transparency, the way we intend to make money is
                by providing a managed service with governance, management, and
                cost-control features, including turning off environments
                automatically on inactivity or after business hours. The
                Layerform CLI itself will remain free and open (GPL).
              </p>
              <p>
                You can download the Layerform CLI right now and use it for
                free. Currently, all the state, permissions, and layer
                definitions stay in your cloud, under your control.
              </p>
              <p>
                After the whole license change thing, I think it's also worth
                mentioning we'll be building on top of the community's fork and
                will consider adding support for Pulumi too.
              </p>
              <p>
                We'd love your feedback on our solution to eliminate “the
                staging bottleneck". What do you think?
              </p>
            </div>
          </section>
        </section>
        <section id="37134089">
          <h3>
            <a
              class="item"
              href="https://thenewstack.io/entrepreneurship-for-engineers-selling-open-source-software/"
              >Selling open-source software</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 13:58:17</span
              ><span class="points-container"
                >Points: <span class="points">165</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37134089"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37133163">
          <h3>
            <a
              class="item"
              href="https://github.com/Dicklesworthstone/llama_embeddings_fastapi_service"
              >Show HN: Llama2 Embeddings FastAPI Server</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 12:31:27</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37133163"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
            <div class="text">
              <p>
                It lets you not only submit text strings and get back the
                embeddings, but also to compare two strings and get back their
                similarity score (i.e., the cosine similarity of their embedding
                vectors). You can also upload a plaintext file or PDF and get
                back all the embeddings for every sentence in the file as a
                zipped JSON file (and you can specify the layout of this JSON
                file).
              </p>
              <p>
                Each time an embedding is computed for a given string with a
                given LLM, that vector is stored in the SQlite database and can
                be returned immediately. You can also search across all stored
                vectors easily using a query string; this uses FAISS which is
                integrated.
              </p>
              <p>
                There are lots of nice performance enhancements, including
                parallel inference, db write queue, fully async everything, and
                even a RAM Disk feature to speed up model loading.
              </p>
              <p>
                I’m working now on adding additional API endpoints for easily
                generating sentiment scores using presets for different focus
                areas, but that’s still work-in-progress (the code for this so
                far is in the repo though).
              </p>
            </div>
          </section>
        </section>
        <section id="37133128">
          <h3>
            <a class="item" href="https://www.lottielab.com/"
              >Show HN: Lottielab – Create product animations in the browser
              easily</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 12:28:20</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37133128"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
            <div class="text">
              Hi HN! Today we are releasing Lottielab, a web-based animation
              tool, to the public as an open beta. The main tool for editing and
              exporting Lottie animations today is Adobe After Effects, a
              30-year-old visual effects tool that’s not fit for this purpose,
              has a steep learning curve, and requires a patchwork of
              error-prone plugins. With Lottielab, we are aiming to reduce the
              friction of creating and editing product animations by providing
              an easy-to-use editor with out-of-the-box support for import and
              export of the Lottie format and many others. Feel free to play
              around with the tool and let me know what you think - I'm here to
              answer your questions. Happy animating!
            </div>
          </section>
        </section>
        <section id="37133054">
          <h3>
            <a class="item" href="https://opentf.org/">The OpenTF Manifesto</a>
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 12:19:33</span
              ><span class="points-container"
                >Points: <span class="points">520</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37133054"
                  >Comments</a
                ><span class="descendants">: 300</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37133023">
          <h3>
            <a
              class="item"
              href="https://nautil.us/why-darwin-admired-the-humble-earthworm-361515/"
              >Why Darwin admired the earthworm</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 12:16:10</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37133023"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37131812">
          <h3>
            <a
              class="item"
              href="https://pluralistic.net/2023/08/14/hidden-worlds/#making-the-invisible-visible-and-beautiful"
              >Open Circuits: The Inner Beauty of Electronic Components</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 09:20:15</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37131812"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37131808">
          <h3>
            <a
              class="item"
              href="http://sims.durgadas.com/punchcards/ibm029.html"
              >Virtual IBM Punch Card Data Processing (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 09:19:00</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37131808"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37131027">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=5kxRi34PqWo"
              >Love Notes to Newton [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 06:57:26</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37131027"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37130331">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-08-antiferromagnets-memory.html"
              >New way to read data in antiferromagnets unlocks their use as
              computer memory</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 04:51:41</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37130331"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37130200">
          <h3>
            <a class="item" href="https://rtheunissen.github.io/bst/"
              >Exploring the design space of binary search trees</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 04:28:43</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37130200"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
            <div class="text">
              <p>
                The more I read about binary search trees, the more I thought
                about them, and so down the rabbit hole I went. When you read
                everything you can find about a topic for several years,
                eventually you develop a deep enough understanding to compose
                new ideas from different sources.
              </p>
              <p>
                This project is the result of many rejected ideas and countless
                experiments. I tried my best to distill everything I consider
                important enough to keep, and will continue to develop other
                ideas as they come along. I had no intention to implement
                anything other than weight-balanced strategies to support
                positional access, but when I read about rank-balanced trees I
                knew I had to take on the challenge to implement them.
              </p>
              <p>
                I've been in contact with various authors along the way,
                specifically Bob Tarjan and Salvador Roura, but have otherwise
                not received any feedback yet. Implementing all the algorithms
                was incredibly hard work, by far the hardest work I've ever
                done, so I hope that others may find value in their
                presentation.
              </p>
              <p>
                There is still so much work that could be done, but there comes
                a time when working on something alone begins to yield
                diminishing returns. I hope to continue this project as an
                open-source collaborative effort, so please feel free to ask
                questions or suggest changes, however small.
              </p>
              <p>
                [1]
                <a href="https://github.com/php-ds/ext-ds"
                  >https://github.com/php-ds/ext-ds</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="37128935">
          <h3>
            <a class="item" href="https://github.com/scotws/265SXB-Guide"
              >A most very unofficial guide to the W65C265SXB</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 01:12:10</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37128935"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37128929">
          <h3>
            <a
              class="item"
              href="https://www.gosh.org/about-us/peter-pan/copyright/"
              >Peter Pan Copyright</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 01:10:56</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37128929"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37128885">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-023-02555-z"
              >How to be successful as a research mathematician? Follow your
              gut</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-15 @ 01:06:03</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37128885"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37118239">
          <h3>
            <a
              class="item"
              href="https://leancrew.com/all-this/2023/08/decimal-to-fraction/"
              >Decimal to fraction</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-14 @ 06:56:11</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37118239"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
