<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41409006">
          <h3>
            <a
              class="item"
              href="https://fred.stlouisfed.org/series/IHLIDXUSTPSOFTDEVE"
              >Fred: Software Development Job Postings on Indeed in the United
              States</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-31 @ 14:13:33</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41409006"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41408851">
          <h3>
            <a
              class="item"
              href="https://news.ubc.ca/2024/08/ubc-pfas-forever-chemicals-solution/"
              >UBC engineers develop all-in-one solution to catch and destroy
              forever chemicals</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-31 @ 13:48:31</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41408851"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41408792">
          <h3>
            <a
              class="item"
              href="https://www.palladiummag.com/2024/08/30/when-the-mismanagerial-class-destroys-great-companies/"
              >When the Mismanagerial Class Destroys Great Companies</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-31 @ 13:40:21</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41408792"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41408738">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2024/8/30/24232561/brazil-x-ban-sending-people-bluesky"
              >Brazil's X ban is sending lots of people to Bluesky</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-31 @ 13:28:25</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41408738"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41408732">
          <h3>
            <a
              class="item"
              href="https://gizmodo.com/deepwater-submarine-recovers-roman-battering-ram-from-ancient-battle-2000493180"
              >Deepwater Sub Recovers Roman Battering Ram Used in Carthage in
              Punic Wars Battle</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-31 @ 13:27:21</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41408732"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41407774">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/science/article/2024/aug/31/alexander-grothendieck-huawei-ai-artificial-intelligence"
              >Alexander Grothendieck: a forgotten geniusâ€“ or a lonely
              madman?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-31 @ 10:24:07</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41407774"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41407768">
          <h3>
            <a
              class="item"
              href="https://jonathancarter.org/2024/08/29/orphaning-bcachefs-tools-in-debian/"
              >Orphaning bcachefs-tools in Debian</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-31 @ 10:22:10</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41407768"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41407469">
          <h3>
            <a
              class="item"
              href="https://cloud.google.com/compute/docs/disks/about-regional-persistent-disk"
              >About synchronous disk replication</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-31 @ 09:00:01</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41407469"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41406752">
          <h3>
            <a
              class="item"
              href="https://little-maps.com/2022/01/12/the-great-vic-gravel-route-exploring-victoria-on-unsealed-roads/"
              >The Great Vic Gravel Route: Crossing Victoria on Unsealed
              Roads</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-31 @ 05:29:35</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41406752"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41406669">
          <h3>
            <a
              class="item"
              href="https://ethz.ch/en/news-and-events/eth-news/news/2024/08/iron-as-an-inexpensive-storage-medium-for-hydrogen.html"
              >Iron as an inexpensive storage medium for hydrogen</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-31 @ 05:03:51</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41406669"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41406550">
          <h3>
            <a
              class="item"
              href="https://martin.wojtczyk.de/2024/08/31/is-my-vision-that-bad-no-its-just-a-bug-in-apples-calculator/"
              >Is my vision that bad? No, it's just a bug in Apple's
              Calculator</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-31 @ 04:29:09</span
              ><span class="points-container"
                >Points: <span class="points">411</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41406550"
                  >Comments</a
                ><span class="descendants">: 170</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41406453">
          <h3>
            <a class="item" href="https://neustadt.fr/essays/the-small-web/"
              >Rediscovering the Small Web (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-31 @ 03:56:38</span
              ><span class="points-container"
                >Points: <span class="points">154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41406453"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41406281">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2408.14425"
              >Radiance Cascades: A Novel High-Res Sol. For Multidim Non-LTE
              Radiative Transfer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-31 @ 02:59:13</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41406281"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41405364">
          <h3>
            <a class="item" href="https://linux.die.net/man/1/expect"
              >Expect â€“ Linux tool for automating interactive programs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-30 @ 23:17:38</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41405364"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41405243">
          <h3>
            <a
              class="item"
              href="https://funloop.org/post/2021-03-15-bresenham-circle-drawing-algorithm.html"
              >Bresenham's Circle Drawing Algorithm (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-30 @ 22:53:00</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41405243"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41405195">
          <h3>
            <a
              class="item"
              href="https://nautil.us/crows-are-even-smarter-than-we-thought-820066/"
              >Crows are even smarter than we thought</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-30 @ 22:46:59</span
              ><span class="points-container"
                >Points: <span class="points">434</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41405195"
                  >Comments</a
                ><span class="descendants">: 233</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41404360">
          <h3>
            <a class="item" href="https://github.com/velorek1/C-edit"
              >Show HN: A retro terminal text editor for GNU/Linux coded in C
              (C-edit)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-30 @ 20:58:17</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41404360"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.youtube.com/watch?v=H7bneUX_kVA"
                >https://www.youtube.com/watch?v=H7bneUX_kVA</a
              >
            </div>
          </section>
        </section>
        <section id="41404117">
          <h3>
            <a
              class="item"
              href="https://bellmar.medium.com/three-critical-questions-to-turn-the-table-during-technical-interviews-dd1594c278b8"
              >Three questions to turn the table during technical interviews</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-30 @ 20:25:14</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41404117"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41404020">
          <h3>
            <a class="item" href="https://github.com/pyrustic/asyncpal"
              >Show HN: Asyncpal: Preemptive concurrency and parallelism for
              sporadic workloads</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-30 @ 20:12:41</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41404020"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/pyrustic/asyncpal"
                >https://github.com/pyrustic/asyncpal</a
              >), a Python library for parallelism [1] and preemptive
              concurrency [2] tailored for sporadic workloads [3].
              <p>
                I've been working on a private project where it would be
                convenient to have asynchronous versions of some operations
                without using `async/await` [4]. Besides `async/await`, which
                represents cooperative concurrency via the `asyncio` package,
                Python also provides preemptive concurrency through its
                `threading` package. Additionally, the `concurrent.futures`
                package builds upon the `threading` package to provide a thread
                pool [5], which is the design pattern my project needed for
                managing concurrent tasks.
              </p>
              <p>
                Although a thread pool is the right tool for the problems it
                solves, its creation and usage involve the allocation of
                resources that must be properly released. For this reason, it is
                recommended to use a thread pool with a context manager [6] to
                ensure that resources are properly released once the pool
                executor has finished its tasks.
              </p>
              <p>
                However, this strategy can introduce overhead in programs that
                sporadically submit tasks to a thread pool, as multiple pools
                may be created and destroyed throughout the execution of these
                programs.
              </p>
              <p>
                Maintaining one or a few thread pools for the duration of a
                program can be an effective solution, assuming these thread
                pools can automatically shrink after workers have been idle for
                a short period defined by the programmer.
              </p>
              <p>
                I developed Asyncpal to meet the requirements and extended it
                with processes to achieve parallelism. For more details about
                this project, please refer to the README. You can download the
                lightweight package on PyPI, try the examples provided in the
                README, or run the tests on your machine.
              </p>
              <p>Let me know what you think about this project.</p>
              <p>
                [1]
                <a href="https://en.wikipedia.org/wiki/Parallel_computing"
                  >https://en.wikipedia.org/wiki/Parallel_computing</a
                >
              </p>
              <p>
                [2]
                <a href="https://en.wikipedia.org/wiki/Concurrent_computing"
                  >https://en.wikipedia.org/wiki/Concurrent_computing</a
                >
              </p>
              <p>
                [3]
                <a
                  href="https://www.cloudcomputingpatterns.org/unpredictable_workload/"
                  >https://www.cloudcomputingpatterns.org/unpredictable_workloa...</a
                >
                (related)
              </p>
              <p>
                [4]
                <a href="https://en.wikipedia.org/wiki/Async/await"
                  >https://en.wikipedia.org/wiki/Async/await</a
                >
              </p>
              <p>
                [5]
                <a href="https://en.wikipedia.org/wiki/Thread_pool"
                  >https://en.wikipedia.org/wiki/Thread_pool</a
                >
              </p>
              <p>
                [6]
                <a
                  href="https://superfastpython.com/threadpoolexecutor-context-manager/"
                  >https://superfastpython.com/threadpoolexecutor-context-manag...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="41403286">
          <h3>
            <a
              class="item"
              href="https://izzys.casa/2024/08/463-python-interpreters/"
              >500 Python Interpreters</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-30 @ 18:26:46</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41403286"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41401463">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=YzIiUjgnSsA"
              >Language and shell in Go with 92% test coverage and instant CI/CD
              [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-30 @ 15:09:03</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41401463"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41401415">
          <h3>
            <a class="item" href="http://ciel-lang.org/"
              >CIEL Is an Extended Lisp</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-30 @ 15:04:19</span
              ><span class="points-container"
                >Points: <span class="points">346</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41401415"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41400723">
          <h3>
            <a class="item" href="https://www.firstmenonthemoon.com"
              >Experience the Apollo 11 Lunar Landing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-30 @ 13:52:46</span
              ><span class="points-container"
                >Points: <span class="points">221</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41400723"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41399872">
          <h3>
            <a
              class="item"
              href="https://www.anandtech.com/show/21542/end-of-the-road-an-anandtech-farewell"
              >AnandTech Farewell</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-30 @ 12:05:23</span
              ><span class="points-container"
                >Points: <span class="points">2717</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41399872"
                  >Comments</a
                ><span class="descendants">: 542</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41379500">
          <h3>
            <a
              class="item"
              href="https://catonmat.net/fibonacci-miles-kilometers"
              >Using Fibonacci numbers to convert from miles to kilometers and
              vice versa</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-28 @ 13:48:41</span
              ><span class="points-container"
                >Points: <span class="points">287</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41379500"
                  >Comments</a
                ><span class="descendants">: 108</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41378287">
          <h3>
            <a
              class="item"
              href="https://img.ly/blog/designing-a-timeline-for-mobile-video-editing/"
              >Designing a Timeline for Mobile Video Editing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-28 @ 11:19:07</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41378287"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41377328">
          <h3>
            <a class="item" href="https://pages.stern.nyu.edu/~bakos/big.pdf"
              >Bundling Information Goods: Pricing, Profits, and Efficiency
              (1999) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-28 @ 08:34:38</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41377328"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41369065">
          <h3>
            <a
              class="item"
              href="https://leg100.github.io/en/posts/building-bubbletea-programs/"
              >Building Bubbletea Programs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 16:07:28</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41369065"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41367820">
          <h3>
            <a
              class="item"
              href="https://online.ucpress.edu/collabra/article/10/1/121937/202992/Changes-in-Need-for-Uniqueness-From-2000-Until"
              >Changes in Need for Uniqueness From 2000 Until 2020</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 14:18:18</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41367820"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41367658">
          <h3>
            <a class="item" href="https://docs.basex.org/12/Main_Page"
              >BaseX â€“ a highly W3C compliant XQuery processor</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 14:04:37</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41367658"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
