<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39934956">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2404.02575"
              >Language models as compilers: Simulating pseudocode execution</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 19:46:44</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39934956"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39934684">
          <h3>
            <a
              class="item"
              href="https://developer.apple.com/tutorials/develop-in-swift"
              >Develop in Swift Tutorials</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 19:21:59</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39934684"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39934584">
          <h3>
            <a class="item" href="https://www.w3.org/reports/ai-web-impact/"
              >Understanding and managing the impact of machine learning models
              on the web</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 19:11:41</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39934584"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39934480">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39934480"
              >Ask HN: Most efficient way to fine-tune an LLM in 2024?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 19:01:37</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39934480"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
            <div class="text">
              <p>
                In particular we are trying to understand performance vs. cost
                trade-offs. We don't have a budget to train from scratch.
              </p>
              <p>
                We are working with a proprietary data set on the order of 100M
                tokens and are looking to fine-tune a general purpose language
                model and also create task-specific models based on the same
                corpus.
              </p>
              <p>Any help would be appreciated!</p>
            </div>
          </section>
        </section>
        <section id="39934434">
          <h3>
            <a
              class="item"
              href="https://unikraft.io/blog/containers-and-unikernels/"
              >Containers and Unikernels: Similar, different, and intertwined</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 18:58:05</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39934434"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39934322">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2403.17199"
              >Rule-based NLP system beats LLM for analysis of psychiatric
              clinical notes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 18:47:19</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39934322"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39934320">
          <h3>
            <a
              class="item"
              href="https://thenewstack.io/how-should-we-define-open-ai/"
              >How should we define ‘open’ AI?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 18:47:07</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39934320"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39933833">
          <h3>
            <a
              class="item"
              href="https://posit-dev.github.io/great-tables/blog/design-philosophy/"
              >The design philosophy of Great Tables</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 18:00:28</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39933833"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39933660">
          <h3>
            <a
              class="item"
              href="https://mas-bandwidth.com/xdp-for-game-programmers/"
              >XDP for game programmers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 17:46:43</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39933660"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39933076">
          <h3>
            <a class="item" href="https://research.myshell.ai/jetmoe"
              >JetMoE: Reaching LLaMA2 performance with 0.1M dollars</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 17:04:21</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39933076"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39933016">
          <h3>
            <a class="item" href="https://markprompt.com/jobs"
              >Markprompt (YC W24) – Stripe for customer support – is hiring an
              engineer in SF</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 17:00:15</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39931315">
          <h3>
            <a class="item" href="https://runtipi.io"
              >Runtipi: Docker-based home server management</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 15:02:59</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39931315"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39931250">
          <h3>
            <a
              class="item"
              href="https://openai.com/blog/introducing-improvements-to-the-fine-tuning-api-and-expanding-our-custom-models-program"
              >Improvements to the fine-tuning API and expanding our custom
              models program</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 14:58:06</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39931250"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39930919">
          <h3>
            <a
              class="item"
              href="https://nowotarski.info/http2-continuation-flood-technical-details/"
              >HTTP/2 Continuation Flood: Technical Details</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 14:32:50</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39930919"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39930908">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39930908"
              >Show HN: Managed GitHub Actions Runners for AWS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 14:32:20</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39930908"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
            <div class="text">
              <a href="https://depot.dev">https://depot.dev</a>), a build
              service for Docker images, and I'm excited to show what we’ve been
              working on for the past few months: run GitHub Actions jobs in
              AWS, orchestrated by Depot!
              <p>
                Here's a video demo:
                <a href="https://www.youtube.com/watch?v=VX5Z-k1mGc8"
                  >https://www.youtube.com/watch?v=VX5Z-k1mGc8</a
                >, and here’s our blog post:
                <a href="https://depot.dev/blog/depot-github-actions-runners"
                  >https://depot.dev/blog/depot-github-actions-runners</a
                >.
              </p>
              <p>
                While GitHub Actions is one of the most prevalent CI providers,
                Actions is slow, for a few reasons: GitHub uses underpowered
                CPUs, network throughput for cache and the internet at large is
                capped at 1 Gbps, and total cache storage is limited to 10GB per
                repo. It is also rather expensive for runners with more than 2
                CPUs, and larger runners frequently take a long time to start
                running jobs.
              </p>
              <p>
                Depot-managed runners solve this! Rather than your CI jobs
                running on GitHub's slow compute, Depot routes those same jobs
                to fast EC2 instances. And not only is this faster, it’s also
                1/2 the cost of GitHub Actions!
              </p>
              <p>
                We do this by launching a dedicated instance for each job,
                registering that instance as a self-hosted Actions runner in
                your GitHub organization, then terminating the instance when the
                job is finished. Using AWS as the compute provider has a few
                advantages:
              </p>
              <p>
                - CPUs are typically 30%+ more performant than alternatives (the
                m7a instance type).
              </p>
              <p>
                - Each instance has high-throughput networking of up to 12.5
                Gbps, hosted in us-east-1, so interacting with artifacts, cache,
                container registries, or the internet at large is quick.
              </p>
              <p>
                - Each instance has a public IPv4 address, so it does not share
                rate limits with anyone else.
              </p>
              <p>
                We integrated the runners with the distributed cache system
                (backed by S3 and Ceph) that we use for Docker build cache, so
                jobs automatically save / restore cache from this cache system,
                with speeds of up to 1 GB/s, and without the default 10 GB per
                repo limit.
              </p>
              <p>
                Building this was a fun challenge; some matrix workflows start
                40+ jobs at once, then requiring 40 EC2 instances to launch at
                once.
              </p>
              <p>
                We’ve effectively gotten very good at starting EC2 instances
                with a "warm pool" system which allows us to prepare many EC2
                instances to run a job, stop them, then resize and start them
                when an actual job request arrives, to keep job queue times
                around 5 seconds. We're using a homegrown orchestration system,
                as alternatives like autoscaling groups or Kubernetes weren't
                fast or secure enough.
              </p>
              <p>
                There are three alternatives to our managed runners currently:
              </p>
              <p>
                1. GitHub offers larger runners: these have more CPUs, but still
                have slow network and cache. Depot runners are also 1/2 the cost
                per minute of GitHub's runners.
              </p>
              <p>
                2. You can self-host the Actions runner on your own compute:
                this requires ongoing maintenance, and it can be difficult to
                ensure that the runner image or container matches GitHub's.
              </p>
              <p>
                3. There are other companies offering hosted GitHub Actions
                runners, though they frequently use cheaper compute hosting
                providers that are bottlenecked on network throughput or
                geography.
              </p>
              <p>
                Any feedback is very welcome! You can sign up at
                <a href="https://depot.dev/sign-up"
                  >https://depot.dev/sign-up</a
                >
                for a free trial if you'd like to try it out on your own
                workflows. We aren't able to offer a trial without a signup
                gate, both because using it requires installing a GitHub app,
                and we're offering build compute, so we need some way to keep
                out the cryptominers :)
              </p>
            </div>
          </section>
        </section>
        <section id="39930887">
          <h3>
            <a
              class="item"
              href="https://www.railstotrails.org/site/greatamericanrailtrail/content/route/"
              >The Great American Rail-Trail</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 14:30:32</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39930887"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39930809">
          <h3>
            <a class="item" href="https://v8.dev/blog/sandbox"
              >The V8 Sandbox</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 14:24:53</span
              ><span class="points-container"
                >Points: <span class="points">186</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39930809"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39930493">
          <h3>
            <a class="item" href="https://github.com/LottieFiles/dotlottie-rs"
              >Show HN: DotLottie Player – A New Universal Lottie Player Built
              with Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 13:59:34</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39930493"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
            <div class="text">
              <p>
                For the past few months we’ve been building dotlottie-rs, a new
                Lottie and dotLottie player that aims to run everywhere with
                smooth, high frame rate rendering and guarantee visual and
                feature support consistency across a large number of platforms
                and device types. It is lightweight, has low resource
                requirements and is performant.
              </p>
              <p>
                It is MIT-licensed and is available at:
                <a href="https://github.com/LottieFiles/dotlottie-rs"
                  >https://github.com/LottieFiles/dotlottie-rs</a
                >
              </p>
              <p>
                The player is written in Rust and uses a minimal number of
                external dependencies. We utilize uniffi-rs to generate FFI
                bindings for Kotlin, Swift, and WASM, which are then used in our
                platform native distributions for Android, iOS and Web while
                maintaining a consistent API and experience across them. We also
                provide distributions for React and Vue to make it easy to adopt
                in many existing web projects. The player is also ideal for use
                in backend systems and pipelines for high performance
                server-side rendering of Lottie/dotLottie, and can be used
                easily in NodeJS projects.
              </p>
              <p>
                The player is named dotlottie-rs because, apart from the first
                class Lottie support, we aim to have first class support for
                dotLottie (<a href="https://www.dotlottie.io"
                  >https://www.dotlottie.io</a
                >), a superset of Lottie we developed that builds on Lottie to
                add enhanced features like multi-animation support, improved
                resource bundling, theming, state machines and interactivity
                (latter two are currently in development).
              </p>
              <p>
                Under the hood, the player uses the open-source, lightweight,
                high performance ThorVG library (<a
                  href="https://www.thorvg.org/"
                  >https://www.thorvg.org/</a
                >) for vector graphics and Lottie rendering, supporting
                software, OpenGL, and WebGPU (currently in beta) rasterization
                backends. We are working towards landing complete support of the
                Lottie format spec (<a href="https://lottie.github.io/"
                  >https://lottie.github.io/</a
                >) as soon as possible.
              </p>
              <p>
                We are starting to test and deploy it across our platform and
                hope it helps achieve similar improvements in performance and
                support as we are seeing!
              </p>
              <p>
                There’s a few demos: Rust project:
                <a
                  href="https://github.com/LottieFiles/dotlottie-rs/tree/main/demo-player"
                  >https://github.com/LottieFiles/dotlottie-rs/tree/main/demo-p...</a
                >
                Web:
                <a
                  href="https://github.com/LottieFiles/dotlottie-web?tab=readme-ov-file#live-examples"
                  >https://github.com/LottieFiles/dotlottie-web?tab=readme-ov-f...</a
                >
              </p>
              <p>Would love to hear your thoughts and feedback :)</p>
            </div>
          </section>
        </section>
        <section id="39930463">
          <h3>
            <a
              class="item"
              href="https://twitter.com/goodside/status/1775713487529922702"
              >AI-generated sad girl with piano performs the text of the MIT
              License</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 13:57:51</span
              ><span class="points-container"
                >Points: <span class="points">497</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39930463"
                  >Comments</a
                ><span class="descendants">: 187</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39930195">
          <h3>
            <a
              class="item"
              href="https://hforsten.com/homemade-6-ghz-pulse-compression-radar.html"
              >Homemade 6 GHz pulse compression radar</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 13:32:03</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39930195"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39929842">
          <h3>
            <a
              class="item"
              href="https://www.pv-magazine.com/2024/04/04/us-government-funds-pilot-project-for-heated-sand-energy-storage/"
              >US Government funds pilot project for heated sand energy
              storage</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 12:59:26</span
              ><span class="points-container"
                >Points: <span class="points">163</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39929842"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39928913">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/features/2024-04-03/hertz-htz-selling-electric-cars-ends-its-failed-tesla-bet"
              >How Hertz’s bet on Teslas went sideways</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 11:23:09</span
              ><span class="points-container"
                >Points: <span class="points">162</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39928913"
                  >Comments</a
                ><span class="descendants">: 443</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39928604">
          <h3>
            <a
              class="item"
              href="https://www.bitsaboutmoney.com/archive/anatomy-of-credit-card-rewards-programs/"
              >Anatomy of a credit card rewards program</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 10:35:17</span
              ><span class="points-container"
                >Points: <span class="points">697</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39928604"
                  >Comments</a
                ><span class="descendants">: 457</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39928558">
          <h3>
            <a
              class="item"
              href="https://lutrasecurity.com/en/articles/kobold-letters/"
              >Kobold letters: HTML emails are a risk</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 10:27:19</span
              ><span class="points-container"
                >Points: <span class="points">281</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39928558"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39927682">
          <h3>
            <a class="item" href="https://www6.slac.stanford.edu/lsst"
              >LSST Camera: largest camera for astronomy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 07:57:47</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39927682"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39927246">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/culture/article/20240403-dark-star-at-50-how-a-micro-budget-student-film-changed-sci-fi-forever"
              >Dark Star at 50: How a micro-budget student film changed sci-fi
              forever</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-04 @ 06:40:47</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39927246"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39909436">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41467-024-46741-7"
              >Landslide topology uncovers failure movements</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-02 @ 18:47:00</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39909436"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39904205">
          <h3>
            <a
              class="item"
              href="https://blog.bracha.org/primordialsoup.html?snapshot=AmpleforthViewer.vfuel&amp;docName=BreakingSilos"
              >Breaking Silos</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-02 @ 10:37:45</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39904205"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39903514">
          <h3>
            <a class="item" href="https://emacsconf.org/2023/talks/collab/"
              >Collaborative data processing and documenting using org-babel</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-02 @ 08:34:54</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39903514"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39903494">
          <h3>
            <a
              class="item"
              href="https://miyuki.github.io/2016/10/21/std-launder.html"
              >std::launder: the most obscure new feature of C++17 (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-02 @ 08:27:37</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39903494"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
