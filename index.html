<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41199006">
          <h3>
            <a class="item" href="https://ai-pastor.com"
              >AI Pastor: Your Guide to Spiritual Growth</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-09 @ 05:27:54</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41199006"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41198491">
          <h3>
            <a class="item" href="https://bhmt.dev/blog/sonic_pi/"
              >Sonic Pi: Ruby as a Composition Tool</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-09 @ 03:08:48</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41198491"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41198422">
          <h3>
            <a class="item" href="https://www.sqlite.org/fts5.html"
              >SQLite FTS5 Extension</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-09 @ 02:49:18</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41198422"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41198151">
          <h3>
            <a
              class="item"
              href="https://slimsaas.com/blog/saas-copy-writing-saas-marketing-framework-works"
              >SaaS Copywriting: Marketing SaaS Framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-09 @ 01:49:22</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41198151"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41197300">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/usps-scam-text-smishing-triad/"
              >USPS Text Scammers Duped His Wife, So He Hacked Their
              Operation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-08 @ 23:00:21</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41197300"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41196916">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/charge-robotics/jobs/ml4f9l4-senior-mechanical-engineer"
              >Charge Robotics (YC S21) is hiring MechEs to build robots that
              build solar farms</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-08 @ 22:13:46</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41196554">
          <h3>
            <a
              class="item"
              href="https://jalopnik.com/national-park-service-will-cite-drivers-of-awd-cars-for-1851617315"
              >National Park Service Will Cite AWD Drivers for Driving on
              4WD-Only Trails</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-08 @ 21:33:53</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41196554"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41195988">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2408.01584"
              >GPUDrive: Data-driven, multi-agent driving simulation at 1M
              FPS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-08 @ 20:40:21</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41195988"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41195584">
          <h3>
            <a
              class="item"
              href="https://www.semiconductor-digest.com/apple-is-americas-semiconductor-problem/"
              >Apple is America's semiconductor problem</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-08 @ 20:00:20</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41195584"
                  >Comments</a
                ><span class="descendants">: 171</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41195225">
          <h3>
            <a
              class="item"
              href="https://blog.codingconfessions.com/p/are-function-calls-still-slow-in-python"
              >Recent Performance Improvements in Function Calls in CPython</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-08 @ 19:23:36</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41195225"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41195124">
          <h3>
            <a
              class="item"
              href="https://thechipletter.substack.com/p/intels-immiseration"
              >Intel's Immiseration</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-08 @ 19:11:49</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41195124"
                  >Comments</a
                ><span class="descendants">: 131</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41194673">
          <h3>
            <a class="item" href="https://github.com/stack-auth/stack"
              >Launch HN: Stack Auth (YC S24) – An Open-Source Auth0/Clerk
              Alternative</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-08 @ 18:23:57</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41194673"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
            <div class="text">
              <a href="https://stack-auth.com/">https://stack-auth.com/</a>), an
              open-source managed authentication and authorization platform.
              Basically, we build your login and signup pages, and everything
              that comes with that.
              <p>
                Our GitHub repo is at
                <a href="https://github.com/stack-auth/stack"
                  >https://github.com/stack-auth/stack</a
                >, and there’s a zero-budget demo video here:
                <a href="https://www.youtube.com/watch?v=LTkjdPf2E2Q"
                  >https://www.youtube.com/watch?v=LTkjdPf2E2Q</a
                >
              </p>
              <p>
                Stack Auth was born out of years of frustration with the
                incumbents. We wanted to build something that is
                developer-friendly and open-source at the same time.
              </p>
              <p>
                The dominant player in this space is Auth0, who appeals to
                enterprises but lags behind in developer-friendliness and has
                strong vendor lock-in. A newer one is Clerk, which markets
                directly to devs, but is still entirely proprietary. Open-source
                solutions like Supabase Auth or Auth.js/NextAuth are only authN,
                and don't provide the rest of the toolchain.
              </p>
              <p>
                On the other hand, building your own auth infrastructure is
                tedious work. Rolling your own crypto is already hard enough,
                but on top you'll have to deal with OAuth flows, access tokens,
                RBAC, permission syncing, API keys, and so on. Most handcrafted
                OAuth or password-based applications in the wild are vulnerable
                in at least some of these areas.
              </p>
              <p>
                To us, the solution to this was obvious, so we decided to build
                it. Stack Auth is 100% open-source, licensed under MIT and AGPL.
                You can self-host, or choose to use our managed hosting. If you
                choose the latter, there's no lockin. You can export all your
                data and/or start self-hosting at any time.
              </p>
              <p>
                Also, we're more than just authentication — we have
                authorization (orgs, teams, permissions, RBAC) and user
                management (impersonation, user dashboard, webhooks).
              </p>
              <p>
                One interesting feature is what we call "connected accounts": we
                can manage and refresh your OAuth access tokens even for
                services that your users don't use for sign in, such as when
                accessing GMail or OneDrive APIs.
              </p>
              <p>
                We also put a lot of weight into integrating deeply into the
                tech stack itself. For now, we support Next.js frontends with a
                bunch of components and hooks for sign-in, password reset, and
                organizations. Though, we do have a well-documented REST API (<a
                  href="https://docs.stack-auth.com/rest-api/auth"
                  >https://docs.stack-auth.com/rest-api/auth</a
                >), so you can access Stack from any language.
              </p>
              <p>
                For more info, check out our GitHub repo above, or our
                documentation (<a href="https://docs.stack-auth.com"
                  >https://docs.stack-auth.com</a
                >).
              </p>
              <p>
                Would love to hear about your own stories and opinions on auth.
                Thanks all!
              </p>
            </div>
          </section>
        </section>
        <section id="41194431">
          <h3>
            <a
              class="item"
              href="https://www.raptitude.com/2024/08/do-quests-not-goals/"
              >Do quests, not goals</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-08 @ 18:02:12</span
              ><span class="points-container"
                >Points: <span class="points">335</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41194431"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41194024">
          <h3>
            <a class="item" href="https://github.com/mikex86/LibreCuda"
              >LibreCUDA – Launch CUDA code on Nvidia GPUs without the
              proprietary runtime</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-08 @ 17:24:40</span
              ><span class="points-container"
                >Points: <span class="points">442</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41194024"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41193045">
          <h3>
            <a
              class="item"
              href="https://www.figma.com/blog/migrating-onto-kubernetes/"
              >How we migrated onto K8s in less than 12 months</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-08 @ 16:07:54</span
              ><span class="points-container"
                >Points: <span class="points">175</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41193045"
                  >Comments</a
                ><span class="descendants">: 198</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41192118">
          <h3>
            <a
              class="item"
              href="https://blog.nightly.mozilla.org/2024/08/07/firefox-sidebar-and-vertical-tabs-try-them-out-in-nightly-firefox-labs-131/"
              >Firefox Sidebar and Vertical tabs: try them out</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-08 @ 14:46:48</span
              ><span class="points-container"
                >Points: <span class="points">478</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41192118"
                  >Comments</a
                ><span class="descendants">: 282</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41191540">
          <h3>
            <a
              class="item"
              href="https://www.statsignificant.com/p/how-long-does-music-stardom-last"
              >How long does music stardom last? A statistical analysis</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-08 @ 13:55:09</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41191540"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41191069">
          <h3>
            <a
              class="item"
              href="https://dmitry.gr/?r=06.%20Thoughts&amp;proj=11.%20RP2350"
              >I got almost all of my wishes granted with RP2350</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-08 @ 13:03:22</span
              ><span class="points-container"
                >Points: <span class="points">510</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41191069"
                  >Comments</a
                ><span class="descendants">: 234</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41189971">
          <h3>
            <a
              class="item"
              href="https://bughunters.google.com/blog/6303226026131456/a-deep-dive-into-cve-2023-2163-how-we-found-and-fixed-an-ebpf-linux-kernel-vulnerability"
              >How we found and fixed an eBPF Linux kernel vulnerability</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-08 @ 10:39:06</span
              ><span class="points-container"
                >Points: <span class="points">239</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41189971"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41185945">
          <h3>
            <a
              class="item"
              href="https://lflank.wordpress.com/2024/08/06/the-third-atomic-bomb/"
              >The Third Atomic Bomb</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-07 @ 21:48:43</span
              ><span class="points-container"
                >Points: <span class="points">150</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41185945"
                  >Comments</a
                ><span class="descendants">: 145</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41171187">
          <h3>
            <a class="item" href="https://github.com/magiblot/tvision"
              >Tvision – A modern port of Turbo Vision 2.0</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-06 @ 14:31:47</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41171187"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41168344">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/articles/the-ancient-art-of-roasting-agave"
              >The ancient art of roasting agave</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-06 @ 06:35:10</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41168344"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41167899">
          <h3>
            <a class="item" href="https://jackw01.github.io/scanlight/"
              >A Better Light Source for Scanning Color Negative Film</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-06 @ 04:58:59</span
              ><span class="points-container"
                >Points: <span class="points">220</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41167899"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41166512">
          <h3><a class="item" href="https://neal.fun/eyechat/">Eyechat</a></h3>
          <section>
            <h4>
              <span>2024-08-05 @ 23:23:17</span
              ><span class="points-container"
                >Points: <span class="points">178</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41166512"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41163576">
          <h3>
            <a
              class="item"
              href="https://gist.github.com/SMUsamaShah/e7c9ed3936ba69e522f8cb38671f1da7"
              >Show HN: Indicate new stories on HN frontpage
              (Bookmarklet/UserScript)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-05 @ 17:48:38</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41163576"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41162216">
          <h3>
            <a class="item" href="https://public.work"
              >Public Work: a search engine for public domain images</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-05 @ 15:22:35</span
              ><span class="points-container"
                >Points: <span class="points">177</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41162216"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41161315">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41161315"
              >Ask HN: Should we bring software dev in-house?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-05 @ 13:43:40</span
              ><span class="points-container"
                >Points: <span class="points">351</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41161315"
                  >Comments</a
                ><span class="descendants">: 307</span></span
              >
            </h4>
            <div class="text">
              <p>
                We're using a third-party product that functions, but barely.
                The provider is understaffed and unresponsive and the platform
                is stagnant. It's a fight getting basic bugs fixed let alone new
                features implemented. We're having to resort to a separate
                low-code platform to fill in the gaps. Our business operates in
                a specific niche and there are no other providers who cater
                specifically to our industry.
              </p>
              <p>
                As we are growing we're running in to the limits of what this
                product can offer. We're being hampered in our speed of
                execution and missing crucial insights. I feel like we could do
                much better with a product catered specifically to us.
              </p>
              <p>
                On the other hand, while our current solution seems like a
                straightforward CRUD app, I fear the devil is in the details.
                Will we get stuck at 80% completion? We do a lot of data
                exchange via EDIFACT, for instance, with various government
                institutions all over Europe. This feels like a quagmire in
                which development can quickly stall.
              </p>
              <p>
                Besides, can we even attract experienced developers to a
                non-glamorous industry like logistics?
              </p>
              <p>We'd particularly appreciate input on:</p>
              <p>
                Strategies for attracting and retaining tech talent in a
                non-tech industry Experiences transitioning from third-party to
                in-house software (success stories and cautionary tales).
                Potential pitfalls we might not be considering. Alternative
                solutions we should explore.
              </p>
              <p>
                Has anyone here navigated a similar transition? What worked?
                What didn't? Any advice would be appreciated.
              </p>
            </div>
          </section>
        </section>
        <section id="41160292">
          <h3>
            <a
              class="item"
              href="https://www.projectgus.com/2023/04/griffin-imate/"
              >Mysteries of the Griffin iMate and the Apple Extended Keyboard
              II</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-05 @ 11:42:03</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41160292"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41156929">
          <h3>
            <a
              class="item"
              href="https://infovis-wiki.net/wiki/Visual_Variables"
              >Visual Variables are a specified set of symbols that can be
              applied to data</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 23:10:47</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41156929"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41156638">
          <h3>
            <a
              class="item"
              href="https://liliputing.com/diy-raspberry-pi-1000-turns-a-raspberry-pi-5-into-a-pc-in-a-keyboard/"
              >DIY Raspberry Pi 1000 turns a Raspberry Pi 5 into a
              PC-in-a-keyboard</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 22:04:36</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41156638"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
