<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44561354">
          <h3>
            <a
              class="item"
              href="https://www.panasiti.me/blog/modular-rails-applications-rails-engines-active-storage-dashboard/"
              >Building Modular Rails Applications: A Deep Dive into Rails
              Engines</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-14 @ 15:30:31</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44561354"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44561284">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2025/07/14/gm-lg-ultium-spring-hill-tennessee-plant-ev-batteries.html"
              >GM, LG to upgrade Tennessee plant to make low-cost EV
              batteries</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-14 @ 15:24:57</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44561284"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44561104">
          <h3>
            <a
              class="item"
              href="https://techlib.com/electronics/lightningnew.htm"
              >Lightning Detector Circuits</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-14 @ 15:07:31</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44561104"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44561060">
          <h3>
            <a class="item" href="https://jyn.dev/you-are-in-a-box/"
              >You Are in a Box</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-14 @ 15:02:43</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44561060"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44560913">
          <h3>
            <a
              class="item"
              href="https://boilingsteam.com/lenovo-legion-go-s-windows-vs-steam-os-performance/"
              >Lenovo Legion Go S: Windows 11 vs. SteamOS Performance, and
              General Availability</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-14 @ 14:47:54</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44560913"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44560871">
          <h3>
            <a
              class="item"
              href="https://xnacly.me/posts/2025/fast-lexer-strategies/"
              >Strategies for Fast Lexers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-14 @ 14:42:54</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44560871"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44560740">
          <h3>
            <a
              class="item"
              href="https://johnwhiles.com/posts/mental-models-vs-ai-tools"
              >AI slows down open source developers. Peter Naur can teach us
              why</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-14 @ 14:32:08</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44560740"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44560662">
          <h3>
            <a class="item" href="https://kiro.dev/blog/introducing-kiro/"
              >AWS launches Kiro, its Cursor clone</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-14 @ 14:24:40</span
              ><span class="points-container"
                >Points: <span class="points">184</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44560662"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44558646">
          <h3>
            <a class="item" href="https://www.jstor.org/stable/26169128"
              >Impacts of adding PV solar system to internal combustion engine
              vehicles</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-14 @ 11:00:21</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44558646"
                  >Comments</a
                ><span class="descendants">: 153</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44557348">
          <h3>
            <a
              class="item"
              href="https://open-web-advocacy.org/blog/apples-browser-engine-ban-persists-even-under-the-dma/"
              >Apple's Browser Engine Ban Persists, Even Under the DMA</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-14 @ 07:27:02</span
              ><span class="points-container"
                >Points: <span class="points">397</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44557348"
                  >Comments</a
                ><span class="descendants">: 260</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44557115">
          <h3>
            <a
              class="item"
              href="https://evanhahn.com/how-i-build-software-quickly/"
              >How I build software quickly</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-14 @ 06:41:51</span
              ><span class="points-container"
                >Points: <span class="points">304</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44557115"
                  >Comments</a
                ><span class="descendants">: 154</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44556684">
          <h3>
            <a class="item" href="https://refine.sh"
              >Show HN: Refine – A Local Alternative to Grammarly</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-14 @ 05:12:18</span
              ><span class="points-container"
                >Points: <span class="points">314</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44556684"
                  >Comments</a
                ><span class="descendants">: 165</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44554865">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2502.17424"
              >Emergent Misalignment: Narrow finetuning can produce broadly
              misaligned LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 23:46:12</span
              ><span class="points-container"
                >Points: <span class="points">160</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44554865"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44554307">
          <h3>
            <a class="item" href="https://gpfault.net/posts/asm-tut-0.txt.html"
              >Let's Learn x86-64 Assembly (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 22:22:15</span
              ><span class="points-container"
                >Points: <span class="points">364</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44554307"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44553752">
          <h3>
            <a class="item" href="https://github.com/OpenCut-app/OpenCut"
              >OpenCut: The open-source CapCut alternative</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 21:08:47</span
              ><span class="points-container"
                >Points: <span class="points">417</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44553752"
                  >Comments</a
                ><span class="descendants">: 135</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44553747">
          <h3>
            <a class="item" href="https://github.com/APKLab/APKLab"
              >APKLab: Android Reverse-Engineering Workbench for VS Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 21:08:14</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44553747"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44553257">
          <h3>
            <a
              class="item"
              href="https://blog.johnluttig.com/p/hypercapitalism-and-the-ai-talent"
              >Hypercapitalism and the AI talent wars</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 20:09:34</span
              ><span class="points-container"
                >Points: <span class="points">153</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44553257"
                  >Comments</a
                ><span class="descendants">: 153</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44552500">
          <h3>
            <a
              class="item"
              href="https://www.djangoproject.com/weblog/2025/jul/13/happy-20th-birthday-django/"
              >Happy 20th Birthday, Django</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 18:44:56</span
              ><span class="points-container"
                >Points: <span class="points">248</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44552500"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44551652">
          <h3>
            <a
              class="item"
              href="https://zola.ink/blog/posts/a-technical-look-at-irans-internet-shutdown"
              >A technical look at Iran's internet shutdowns</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 16:45:02</span
              ><span class="points-container"
                >Points: <span class="points">239</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44551652"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44550572">
          <h3>
            <a
              class="item"
              href="https://www.makingsoftware.com/chapters/how-a-screen-works"
              >How does a screen work?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-13 @ 14:09:06</span
              ><span class="points-container"
                >Points: <span class="points">514</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44550572"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44546265">
          <h3>
            <a class="item" href="https://github.com/katanemo/archgw/"
              >Show HN: ArchGW – An intelligent edge and service proxy for
              agents</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-12 @ 23:55:39</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44546265"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
            <div class="text">
              <p>
                This is Adil, Salman and Jose and and we’re behind archgw [1].
                An intelligent proxy server designed as an edge and AI gateway
                for agents - one that natively know how to handle prompts, not
                just network traffic. We’ve made several sweeping changes so
                sharing the project again.
              </p>
              <p>
                A bit of background on why we’ve built this project. Building AI
                agent demos is easy, but to create something production-ready
                there is a lot of repeat low-level plumbing work that everyone
                is doing. You’re applying guardrails to make sure unsafe or
                off-topic requests don’t get through. You’re clarifying vague
                input so agents don’t make mistakes. You’re routing prompts to
                the right expert agent based on context or task type. You’re
                writing integration code to quickly and safely add support for
                new LLMs. And every time a new framework hits the market or is
                updated, you’re validating or re-implementing that same
                logic—again and again.
              </p>
              <p>
                Putting all the low-level plumbing code in a framework gets
                messy to manage, harder to update and scale. Low-level work
                isn't business logic. That’s why we built archgw - an
                intelligent proxy server that handles prompts during ingress and
                egress and offers several related capabilities from a single
                software service. It lives outside your app runtime, so you can
                keep your business logic clean and focus on what matters. Think
                of it like a service mesh, but for AI agents.
              </p>
              <p>
                Prior to building archgw, the team spent time building Envoy [2]
                at Lyft, API Gateway at AWS, specialized NLP models at Microsoft
                Research and worked on safety at Meta. archgw was born out of
                the belief that rule-based, single-purpose tools that handle the
                work around resiliency, processing and routing prompts should
                move into a dedicated infrastructure layer for agents, but built
                on the battle-tested foundational of Envoy Proxy.
              </p>
              <p>
                The intelligence in archgw comes from our fast Task-specific
                LLMs [3] that can handle things like agent routing and hand off,
                guardrails and preference-based intelligent LLM calling. Here
                are some additional details about the open source project.
                archgw is written in rust, and the request path has three main
                parts:
              </p>
              <p>
                * Listener subsystem which handles downstream (ingress) and
                upstream (egress) request processing. * Prompt handler
                subsystem. This is where archgw makes decisions on the safety of
                the incoming request via its prompt_guard hooks and identifies
                where to forward the conversation to via its prompt_target
                primitive. * Model serving subsystem is the interface that hosts
                all the lightweight LLMs engineered in archgw and offers a
                framework for things like hallucination detection of our these
                models
              </p>
              <p>
                We loved building this open source project, and our belief is
                that this infra primitive would help developers build faster,
                safer and more personalized agents without all the manual prompt
                engineering and systems integration work needed to get there. We
                hope to invite other developers to use and improve Arch. Please
                give it a shot and leave feedback here, or at our discord
                channel [4] Also here is a quick demo of the project in action
                [5]. You can check out our public docs here at [6]. Our models
                are also available here [7].
              </p>
              <p>
                [1]
                <a href="https://github.com/katanemo/archgw"
                  >https://github.com/katanemo/archgw</a
                >
                [2]
                <a href="https://www.envoyproxy.io/"
                  >https://www.envoyproxy.io/</a
                >
                [3]
                <a
                  href="https://huggingface.co/collections/katanemo/arch-function-66"
                  >https://huggingface.co/collections/katanemo/arch-function-66</a
                >... [4]
                <a
                  href="https://discord.com/channels/1292630766827737088/12926307682"
                  >https://discord.com/channels/1292630766827737088/12926307682</a
                >... [5]
                <a href="https://www.youtube.com/watch?v=I4Lbhr-NNXk"
                  >https://www.youtube.com/watch?v=I4Lbhr-NNXk</a
                >
                [6]
                <a href="https://docs.archgw.com/">https://docs.archgw.com/</a>
                [7]
                <a href="https://huggingface.co/katanemo"
                  >https://huggingface.co/katanemo</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="44535378">
          <h3>
            <a
              class="item"
              href="https://computeradsfromthepast.substack.com/p/six-game-devs-speak-to-computer-games"
              >Six Game Devs Speak to Computer Games Mag (1984)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-11 @ 18:17:22</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44535378"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44529645">
          <h3>
            <a class="item" href="https://github.com/alex-moon/ban"
              >Self-imposed ban – a lightweight bash script to block commands</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-11 @ 08:28:53</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44529645"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44527525">
          <h3>
            <a class="item" href="https://harmony.cs.cornell.edu/book/"
              >Concurrent Programming with Harmony</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-11 @ 01:22:12</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44527525"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44526728">
          <h3>
            <a
              class="item"
              href="https://andrevidela.com/blog/2025/binding-application/"
              >Binding Application in Idris</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-10 @ 23:08:14</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44526728"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44524537">
          <h3>
            <a
              class="item"
              href="https://amazingribs.com/more-technique-and-science/more-cooking-science/reactive-pans/"
              >Lasagna Battery Cell</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-10 @ 19:19:58</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44524537"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44523876">
          <h3>
            <a
              class="item"
              href="https://aras-p.info/blog/2025/07/08/Lossless-Float-Image-Compression/"
              >Lossless Float Image Compression</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-10 @ 18:12:21</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44523876"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44523372">
          <h3>
            <a class="item" href="https://simson.net/ref/1993/cubefire.html"
              >Burning a Magnesium NeXT Cube (1993)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-10 @ 17:30:33</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44523372"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44522683">
          <h3>
            <a class="item" href="https://nodaysoff.run"
              >Show HN: Ten years of running every day, visualized</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-10 @ 16:21:13</span
              ><span class="points-container"
                >Points: <span class="points">758</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44522683"
                  >Comments</a
                ><span class="descendants">: 333</span></span
              >
            </h4>
            <div class="text">
              <p>
                Running has truly changed my life: I've made lifelong friends,
                explored beautiful places, and more importantly invested into my
                own health and fitness, which I'm starting to see the positive
                benefits as I get older.
              </p>
              <p>
                The stack is pretty simple: a NextJS app, with a Postgres
                database to keep all my running data, and all the stats are
                pre-computed and cached in Redis, so I effectively only hit the
                database once a day when a new run is ingested. On the fronted,
                I toyed with the idea of using D3 or pre-existing data viz
                libraries, but ended up rolling my own using SVGs directly, it
                gave me more control on the visualizations.
              </p>
              <p>
                I used the Strava bulk export to pre-populate the database, and
                I'm using their webhook API to do incremental updates. I have to
                tap into OpenWeatherMap and OpenCageDate to enrich the running
                data a little bit.
              </p>
              <p>
                Happy to answer anything about the stack, data pipeline, or how
                I stayed motivated for 10 years!
              </p>
              <p>
                [1]
                <a href="https://www.runeveryday.com"
                  >https://www.runeveryday.com</a
                >
                Run Streak Association rules: ≥ 1 mile per day
              </p>
            </div>
          </section>
        </section>
        <section id="44519395">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/future/article/20181129-the-underground-cathedral-protecting-tokyo-from-floods"
              >The underground cathedral protecting Tokyo from floods (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-10 @ 10:30:42</span
              ><span class="points-container"
                >Points: <span class="points">152</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44519395"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
