<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36837273">
          <h3>
            <a
              class="item"
              href="https://lowendbox.com/blog/man-found-guilty-of-child-porn-because-he-ran-a-tor-exit-node-the-story-of-william-weber/"
              >Man Found Guilty of Child Porn, Because He Ran a Tor Exit Node</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 17:03:23</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36837273"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36836729">
          <h3>
            <a class="item" href="https://sourceacademy.org/sicpjs/"
              >MIT SICP Book in JavaScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 16:15:26</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36836729"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36836649">
          <h3>
            <a class="item" href="https://github.com/GSA/govt-urls"
              >Government URLs that don't end in .gov</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 16:08:22</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36836649"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36836639">
          <h3>
            <a
              class="item"
              href="https://www.scientificamerican.com/article/why-dont-we-get-our-drinking-water-from-the-ocean/"
              >Why don't we get our drinking water from the ocean by taking salt
              out seawater?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 16:07:40</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36836639"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36836596">
          <h3>
            <a class="item" href="https://cc.dev"
              >Show HN: I made a MailChimp alternative that connects to your
              database</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 16:03:31</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36836596"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
            <div class="text">
              <p>
                The idea for this product came from trying to do email marketing
                for my side project, CubeDesk, a site where Rubik's Cube
                enthusiasts can time themselves, race with one another, train
                algorithms — it's a fun niche!
              </p>
              <p>
                With over 40k users, sending even a single campaign was becoming
                expensive with MailChimp. I knew AWS SES would be much cheaper,
                but it’s just an API with none of the other necessities you need
                for a robust email marketing platform.
              </p>
              <p>
                Beyond cost, I was also frustrated with having to make sure my
                database was always in sync with MailChimp and the audience
                schema they enforced. If I wanted to email every user who had
                completed 10 solves, that would be a whole ordeal and eat up
                hours of my day.
              </p>
              <p>So, I started (and am now launching):</p>
              <p><a href="https://cc.dev">https://cc.dev</a></p>
              <p>
                cc.dev connects directly to your database and lets you write SQL
                queries to target your audience. It's backed by AWS SES, so the
                cost to send emails is significantly less than what you're used
                to seeing. Combined with a template builder, media management,
                and campaign monitoring, cc.dev is meant to be your final
                destination whenever you need to send marketing emails to your
                users.
              </p>
              <p>
                Would love to hear your feedback on this! If you're interested
                in trying out cc.dev as your email marketing platform, shoot me
                an email and let's have a chat: kash at cc.dev
              </p>
            </div>
          </section>
        </section>
        <section id="36836538">
          <h3>
            <a
              class="item"
              href="https://twitter.com/ylecun/status/1683138295155372032"
              >LeCun: Qualcomm working with Meta to run Llama-2 on mobile
              devices</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 15:58:11</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36836538"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36836530">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/07/23/us/politics/medicare-drug-price-negotiations-lawsuits.html"
              >Drugmakers Are ‘Throwing the Kitchen Sink’ to Halt Medicare Price
              Negotiations</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 15:57:51</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36836530"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36836433">
          <h3>
            <a
              class="item"
              href="https://jjain.substack.com/p/interfaces-all-the-way-down"
              >Interfaces All the Way Down</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 15:48:28</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36836433"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36836368">
          <h3>
            <a
              class="item"
              href="https://www.science.org/doi/10.1126/science.adh4920"
              >Biasing the quantum vacuum to control macroscopic probability
              distributions</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 15:40:23</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36836368"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36836358">
          <h3>
            <a
              class="item"
              href="https://www.maths.ed.ac.uk/~tl/genova/genova_talk.pdf"
              >An invariant from category theory solves a problem in
              mathematical ecology [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 15:39:38</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36836358"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36836258">
          <h3>
            <a
              class="item"
              href="https://phoenixonrails.com/blog/elixir-for-ruby-developers-the-three-most-important-differences"
              >Elixir for Ruby developers: the three most important
              differences</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 15:29:35</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36836258"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36836189">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36836189"
              >Ask HN: Why do web sites not place the cursor for input?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 15:23:11</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36836189"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
            <div class="text">
              To their credit, Microsoft puts the cursor in the text field ready
              for me to type in my authenticator code. Most web sites I've
              found, do not. So I look up with my shiny new code, ready to start
              typing, realize I need to move my hand to the mouse, place the
              cursor into the field then there's a 50% change I've forgotten the
              code and have to look back at my phone.
            </div>
          </section>
        </section>
        <section id="36836020">
          <h3>
            <a
              class="item"
              href="https://www.bytesnap.com/news-blog/debian-vs-yocto-for-embedded-systems/"
              >Debian vs. Yocto for Embedded Systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 15:05:39</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36836020"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36835735">
          <h3>
            <a
              class="item"
              href="https://www.loudersound.com/features/what-happened-the-night-an-audience-member-filled-in-for-keith-moon"
              >What Happened the Night an Audience Member Filled in for Keith
              Moon (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 14:38:22</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36835735"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36835412">
          <h3>
            <a
              class="item"
              href="https://www.swift.org/documentation/cxx-interop/"
              >Mixing Swift and C++</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 14:04:53</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36835412"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36835293">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/07/20/moveit_victim_count/"
              >MOVEit body count closes in on 400 orgs, 20M+ individuals</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 13:52:21</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36835293"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36834701">
          <h3>
            <a
              class="item"
              href="https://lists.debian.org/debian-riscv/2023/07/msg00053.html"
              >riscv64 is now an official Debian architecture (rebootstrap in
              progress)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 12:25:42</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36834701"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36834675">
          <h3>
            <a
              class="item"
              href="https://fosstodon.org/@sourceware/110760408112704937"
              >Valgrind recieves a development microgrant from FUTO</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 12:22:05</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36834675"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36834415">
          <h3>
            <a
              class="item"
              href="https://thehustle.co/the-man-who-won-the-lottery-14-times/"
              >A Romanian economist legally gamed the lottery</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 11:33:57</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36834415"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36833951">
          <h3>
            <a
              class="item"
              href="https://www.gutenberg.org/files/8086/8086-h/8086-h.htm"
              >Down and Out in the Magic Kingdom (2003)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 10:07:11</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36833951"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36833836">
          <h3>
            <a
              class="item"
              href="https://www.topspeed.com/toyota-745-mile-solid-state-battery/"
              >Toyota has been developing a solid-state battery for EVs with a
              range of 745mi</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 09:42:39</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36833836"
                  >Comments</a
                ><span class="descendants">: 307</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36833393">
          <h3>
            <a
              class="item"
              href="https://nxdomain.no/~peter/what_every_it_person_needs_to_know_about_openbsd.html"
              >What every IT person needs to know about OpenBSD (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 07:51:33</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36833393"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36833089">
          <h3>
            <a
              class="item"
              href="https://giuliomagnifico.blog/misc/2023/07/22/I-found-a-IT-job-thanks-to-this-blog.html"
              >I found an IT job thanks to this blog</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 06:44:36</span
              ><span class="points-container"
                >Points: <span class="points">205</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36833089"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36832433">
          <h3>
            <a class="item" href="https://github.com/easy-graph/Easy-Graph"
              >EasyGraph: A Comprehensive Tool for Graph Analysis and Social
              Computing</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 03:58:43</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36832433"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36832293">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/science/2023/jul/18/mesozoic-fossil-dinosaur-mammal-fight"
              >‘Not always king’: fossil shows mammal sinking teeth into
              dinosaur</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 03:22:26</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36832293"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36831946">
          <h3>
            <a
              class="item"
              href="https://butwhatfor.beehiiv.com/p/simple-sabotage-field-manual-destroy-organizations"
              >Simple Sabotage Field Manual – How to Destroy Your
              Organizations</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 02:11:04</span
              ><span class="points-container"
                >Points: <span class="points">209</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36831946"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36820835">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=MAP-VA1m-A4"
              >Electrolytic capacitors: overview, teardown and experiments
              [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 22:30:49</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36820835"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36817851">
          <h3>
            <a class="item" href="https://stemformulas.com/formulas/"
              >Stem Formulas</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 18:49:04</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36817851"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36811460">
          <h3>
            <a
              class="item"
              href="https://www.medievalists.net/2023/06/medieval-table-manners/"
              >Medieval Table Manners: The Messiest Myth?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 08:35:18</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36811460"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36810937">
          <h3>
            <a
              class="item"
              href="https://www.world-architects.com/en/architecture-news/found/inside-the-worlds-tallest-atrium"
              >The Tallest Atrium (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 07:17:51</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36810937"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
