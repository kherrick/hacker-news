<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40725214">
          <h3>
            <a
              class="item"
              href="https://practical.engineering/blog/2024/6/18/this-bridge-should-have-been-closed-years-before-it-collapsed"
              >Fern Hollow Bridge should have been closed years before it
              collapsed</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-19 @ 05:45:53</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40725214"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40725096">
          <h3>
            <a
              class="item"
              href="https://old.reddit.com/r/IAmA/comments/1divlp3/im_the_hacker_that_brought_down_north_koreas/"
              >I'm the hacker that brought down North Korea's Internet for over
              a week. AMA</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-19 @ 05:18:53</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40725096"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40724774">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40724774"
              >Ask HN: Who has had a successful PWA product?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-19 @ 04:20:14</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40724774"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
            <div class="text">
              <p>
                If youâ€™ve had success, maybe you would be willing to exchange
                some email?
              </p>
            </div>
          </section>
        </section>
        <section id="40723758">
          <h3>
            <a
              class="item"
              href="https://www.sfchronicle.com/sports/giants/article/willie-mays-dead-obituary-17815215.php"
              >Willie Mays, SF Giants baseball player, has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-19 @ 01:11:00</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40723758"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40723356">
          <h3>
            <a class="item" href="https://amphi.ai/">Open Source Python ETL</a>
          </h3>
          <section>
            <h4>
              <span>2024-06-19 @ 00:02:23</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40723356"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40723302">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40723302"
              >Ask HN: Why do message queue-based architectures seem less
              popular now?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 23:50:39</span
              ><span class="points-container"
                >Points: <span class="points">174</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40723302"
                  >Comments</a
                ><span class="descendants">: 168</span></span
              >
            </h4>
            <div class="text">
              <p>
                Now, I almost never see engineering blog posts or HN posts
                highlighting use of message queues. I see occasional content
                related to Kafka, but nothing like the hype that message queues
                used to have.
              </p>
              <p>What changed? Possible theories I'm aware of:</p>
              <p>
                * Redis tackled most of the use-case, plus caching, so it no
                longer made sense to pay the operational cost of running a
                separate message broker. Kafka picked up the really high-scale
                applications.
              </p>
              <p>
                * Databases (broadly defined) got a lot better at handling high
                scale, so system designers moved more of the "transient"
                application state into the main data stores.
              </p>
              <p>
                * We collectively realize that message queues-based
                architectures don't work as well as we hoped, so we build most
                things in other ways now.
              </p>
              <p>
                * The technology just got mature enough that it's not exciting
                to write about, but it's still really widely used.
              </p>
              <p>
                If people have experience designing or implementing greenfield
                systems based on message queues, I'd be curious to hear about
                it. I'd also be interested in understanding any war stories or
                pain points people have had from using message queues in
                production systems.
              </p>
            </div>
          </section>
        </section>
        <section id="40723251">
          <h3>
            <a
              class="item"
              href="https://blog.christianperone.com/2023/06/appreciating-llms-data-pipelines/"
              >Large language model data pipelines and Common Crawl</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 23:42:48</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40723251"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40723220">
          <h3><a class="item" href="https://kidpix.app">KidPix</a></h3>
          <section>
            <h4>
              <span>2024-06-18 @ 23:38:40</span
              ><span class="points-container"
                >Points: <span class="points">472</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40723220"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40723150">
          <h3>
            <a
              class="item"
              href="https://blog.apnic.net/2024/06/18/off-path-tcp-hijacking-in-nat-enabled-wi-fi-networks/"
              >Off-path TCP hijacking in NAT-enabled Wi-Fi networks</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 23:27:36</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40723150"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40722850">
          <h3>
            <a
              class="item"
              href="https://3tilley.github.io/posts/simple-ipc-ping-pong/"
              >IPC in Rust â€“ A Ping Pong Comparison</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 22:40:18</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40722850"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40722317">
          <h3>
            <a class="item" href="https://github.com/niedev/RTranslator"
              >Show HN: I made an open source and local translation app</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 21:26:51</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40722317"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
            <div class="text">
              A few years ago, right after high school, I decided to try to make
              a simultaneous translation app for Android as a side project, it
              took longer than expected (about 2 years) and I had to make a lot
              of compromises (I had to use Google's API and therefore make users
              use a developer key because at the time there were no free
              solutions for speech recognition and translation that had good
              quality). At the end of university, I decided to pick it up again
              and finally, using OpenAi's Whisper for speech recognition and
              Meta's NLLB for translation (with both running locally on the
              phone), I managed to make it free and totally open-source (as it
              was meant to be from the beginning). The app is still in beta, so
              I would love your feedback.
            </div>
          </section>
        </section>
        <section id="40722164">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/hadrius/jobs/1z3APsX-founding-engineer"
              >Hadrius (YC W23) is hiring engineers looking to grow into future
              founders</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 21:00:51</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40720629">
          <h3>
            <a
              class="item"
              href="https://retractionwatch.com/2024/06/18/nature-retracts-highly-cited-2002-paper-that-claimed-adult-stem-cells-could-become-any-type-of-cell/"
              >Nature retracts paper that claimed adult stem cell could become
              any type of cell</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 18:23:10</span
              ><span class="points-container"
                >Points: <span class="points">251</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40720629"
                  >Comments</a
                ><span class="descendants">: 153</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40719981">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2406.11717"
              >Refusal in language models is mediated by a single direction</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 17:09:26</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40719981"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40719975">
          <h3>
            <a class="item" href="https://ubc-vision.github.io/3dgs-mcmc/"
              >3D Gaussian Splatting as Markov Chain Monte Carlo</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 17:08:36</span
              ><span class="points-container"
                >Points: <span class="points">200</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40719975"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40719905">
          <h3>
            <a
              class="item"
              href="https://www.jpl.nasa.gov/news/ow-glowing-plants-could-help-scientists-predict-flash-drought"
              >'Glowing' plants could help scientists predict flash drought</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 17:00:34</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40719905"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40719782">
          <h3>
            <a class="item" href="https://billard.medusis.com/"
              >Show HN: Billard â€“ Generate music from ball collisions in 2D
              space</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 16:45:45</span
              ><span class="points-container"
                >Points: <span class="points">225</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40719782"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
            <div class="text">
              <p>
                Most traditional music composition tools revolve around the idea
                of a repeatable pattern. Billard is a webapp that never repeats
                itself. It generates music automatically based on the collisions
                of balls in a 2D space. Collisions trigger notes (or chords) in
                a given key. One can add balls or move them (y-position is
                pitch); the app remembers its state between reloads; or it can
                be reset with the 'init' button on the top left. Gravity can be
                adjusted in real time to change the behavior of the balls.
              </p>
              <p>
                It owes a lot of inspiration to Brian Eno and Erik Satie
                (inventor of <i>musique d'ameublement</i>, or "furniture
                music"). Some may think the lack of pattern makes it not musical
                enough -- but this lets it be listened to â€”and watchedâ€” for a
                while without boredom.
              </p>
              <p>
                The webapp is made using plain JavaScript. (All SVG icons were
                made 'by hand'.) It uses Tone.js only for triggering piano
                samples. Beyond piano, it's MIDI-enabled and works well at slow
                speed with haunting, dark synth sounds.
              </p>
              <p>Hope you like it!</p>
            </div>
          </section>
        </section>
        <section id="40718124">
          <h3>
            <a
              class="item"
              href="https://frame.work/blog/introducing-a-new-risc-v-mainboard-from-deepcomputing"
              >A new RISC-V Mainboard from DeepComputing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 14:15:16</span
              ><span class="points-container"
                >Points: <span class="points">497</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40718124"
                  >Comments</a
                ><span class="descendants">: 138</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40717804">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/immersive/d41586-024-02011-6/index.html"
              >Tiny beauty: how I make scientific art from behind the
              microscope</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 13:45:07</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40717804"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40717519">
          <h3>
            <a
              class="item"
              href="https://www.tylermw.com/posts/rayverse/displacement-mapping.html"
              >Sculpting the moon in R: Subdivision surfaces and displacement
              mapping</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 13:19:34</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40717519"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40705956">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/the-enduring-mystery-of-how-water-freezes-20240617/"
              >The enduring mystery of how water freezes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 14:26:18</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40705956"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40702895">
          <h3>
            <a
              class="item"
              href="https://www.sciencealert.com/mathematician-reveals-equals-has-more-than-one-meaning-in-math"
              >'Equals' has more than one meaning in math</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 06:42:12</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40702895"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40685427">
          <h3>
            <a
              class="item"
              href="https://chickensoft.games/blog/serialization-for-csharp-games/"
              >Serialization for C# Games</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-14 @ 21:44:33</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40685427"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40683862">
          <h3>
            <a
              class="item"
              href="https://commonedge.org/in-praise-of-5-over-1-buildings/"
              >In Praise of 5-Over-1 Buildings (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-14 @ 19:02:09</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40683862"
                  >Comments</a
                ><span class="descendants">: 118</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40683523">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/2024/03/23/business/curious-consumer-capers-tiny-jars/index.html"
              >A market mystery: Why do capers come in such tiny jars?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-14 @ 18:30:27</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40683523"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40682632">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40682632"
              >Ask HN: How do you find developers for open source bug
              bounties?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-14 @ 17:11:46</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40682632"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
            <div class="text">
              <i
                >Background: There's a WebRTC Chromium bug that is making life
                difficult for us. I'd like to pay a developer to fix it, but I
                don't know where/how to find people.</i
              >
              <p>
                But this leads to a higher level question. When you want to
                sponsor open source bug fixes and/or feature and there isn't a
                clear "sponsor" link or button, how do you find qualified
                people? For example, is there a site/app you typically search?
              </p>
            </div>
          </section>
        </section>
        <section id="40682212">
          <h3>
            <a class="item" href="https://cdm.link/2024/06/labor-diy/"
              >Erica Synths DIY Prototyping Breadboard</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-14 @ 16:26:48</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40682212"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40682013">
          <h3>
            <a
              class="item"
              href="https://www.filfre.net/2018/09/agrippa-a-book-of-the-dead/"
              >Agrippa (A Book of the Dead)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-14 @ 16:03:29</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40682013"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40680414">
          <h3>
            <a
              class="item"
              href="https://www.gibney.org/does_anybody_know_this_fractal"
              >Does anybody know this fractal? (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-14 @ 12:49:28</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40680414"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40677541">
          <h3>
            <a
              class="item"
              href="https://raymii.org/s/blog/Using_a_1965_Dutch_Rotaty_Phone_T65_via_VoIP_in_2024.html"
              >Using a 1965 Dutch Rotary Phone via VoIP (T65) in 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-14 @ 04:43:16</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40677541"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
