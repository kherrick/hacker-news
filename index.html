<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="45063874">
          <h3>
            <a class="item" href="https://sosumi.ai/"
              >Show HN: Sosumi.ai – Convert Apple Developer docs to AI-readable
              Markdown</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-29 @ 13:30:16</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45063874"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
            <div class="text">
              <p>
                The problem? Apple's docs are JavaScript-rendered, so when you
                paste URLs into AI tools, they just see a blank page.
                Copy-pasting works but... c'mon.
              </p>
              <p>
                So I built something that converts Apple Developer docs to clean
                markdown. Just swap developer.apple.com with sosumi.ai in any
                Apple docs URL and you get AI-readable content.
              </p>
              <p>For example:</p>
              <p>
                - Before:
                <a href="https://developer.apple.com/documentation/swift/double"
                  >https://developer.apple.com/documentation/swift/double</a
                >
              </p>
              <p>
                - After:
                <a href="https://sosumi.ai/documentation/swift/double"
                  >https://sosumi.ai/documentation/swift/double</a
                >
              </p>
              <p>
                The site itself is a small Hono app running on Cloudflare
                Workers. Apple's docs are actually available as structured data,
                but Apple doesn't make it obvious how to get it. So what this
                does is map the URLs, fetch the original JSON, and render as
                Markdown.
              </p>
              <p>
                It also provides an MCP interface that includes a tool to search
                the Apple developer website, which is helpful.
              </p>
              <p>
                Anyway, please give this a try and let me know what you think!
              </p>
            </div>
          </section>
        </section>
        <section id="45063547">
          <h3>
            <a class="item" href="https://prompt-injector.blueprintlab.io/"
              >Show HN: A minimal TS library that generates prompt injection
              attacks</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-29 @ 13:00:49</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45063547"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <p>
                Keen to hear your thoughts and please be responsible and only
                pen test systems where you have permission to pen test!
              </p>
            </div>
          </section>
        </section>
        <section id="45063526">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/dark-money-group-secret-funding-democrat-influencers/"
              >A Dark Money Group Is Funding High-Profile Democratic
              Influencers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-29 @ 12:58:35</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45063526"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45063431">
          <h3>
            <a
              class="item"
              href="https://practicalshootinginsights.com/eighth-circuit-fmeca-update/"
              >Gun Maker Sig Sauer Citing National Security to Keep Documents
              from Public</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-29 @ 12:51:01</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45063431"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45062914">
          <h3>
            <a class="item" href="https://deepnote.com/join-us"
              >Deepnote (YC S19) is hiring engineers to build a better Jupyter
              notebook</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-29 @ 12:01:52</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45062910">
          <h3>
            <a
              class="item"
              href="https://www.zdnet.com/article/meta-might-be-secretly-scanning-your-phones-camera-roll-how-to-check-and-turn-it-off/"
              >Meta might be secretly scanning your phone's camera roll</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-29 @ 12:01:31</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45062910"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45062738">
          <h3>
            <a
              class="item"
              href="https://old.reddit.com/r/LocalLLaMA/comments/1n2ubjx/if_you_have_a_claude_personal_account_they_are/"
              >If you have a Claude account, they're going to train on your data
              moving forward</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-29 @ 11:39:26</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45062738"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45062683">
          <h3>
            <a
              class="item"
              href="https://www.perplexity.ai/page/anthropic-reverses-privacy-sta-xH4KWU9nS3KH4Aj9F12dvQ"
              >Anthropic reverses privacy stance, will train on Claude chats</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-29 @ 11:29:10</span
              ><span class="points-container"
                >Points: <span class="points">431</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45062683"
                  >Comments</a
                ><span class="descendants">: 257</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45062614">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/technology/2025/08/29/tesla-autopilot-crashes-evidence-testimony-wrongful-death/"
              >Tesla said it didn't have key data in a fatal crash. Then a
              hacker found it</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-29 @ 11:15:39</span
              ><span class="points-container"
                >Points: <span class="points">273</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45062614"
                  >Comments</a
                ><span class="descendants">: 146</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45061980">
          <h3>
            <a
              class="item"
              href="https://www.johndcook.com/blog/2025/08/28/wrong-address/"
              >Probability of typing a wrong Bitcoin address</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-29 @ 09:28:50</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45061980"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45061689">
          <h3>
            <a class="item" href="https://princeton-rl.github.io/CRTR/"
              >Contrastive Representations for Temporal Reasoning</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-29 @ 08:42:40</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45061689"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45060920">
          <h3>
            <a
              class="item"
              href="https://lowendbox.com/blog/they-used-to-be-good-but-now-theyve-turned-to-evil-the-synology-end-game/"
              >The Synology End Game</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-29 @ 06:37:21</span
              ><span class="points-container"
                >Points: <span class="points">234</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45060920"
                  >Comments</a
                ><span class="descendants">: 193</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45060161">
          <h3>
            <a
              class="item"
              href="https://sites.google.com/site/oh6dccw/strangecwkeys"
              >Strange CW Keys</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-29 @ 04:22:48</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45060161"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45060004">
          <h3>
            <a
              class="item"
              href="https://vuxml.freebsd.org/freebsd/b0a3466f-5efc-11f0-ae84-99047d0a6bcc.html"
              >PSA: Libxslt is unmaintained and has 5 unpatched security bugs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-29 @ 03:57:46</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45060004"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45059160">
          <h3>
            <a class="item" href="https://lwn.net/Articles/1033474/"
              >Lucky 13: a look at Debian trixie</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-29 @ 01:55:14</span
              ><span class="points-container"
                >Points: <span class="points">153</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45059160"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45058688">
          <h3>
            <a
              class="item"
              href="https://developer.apple.com/documentation/xcode-release-notes/xcode-26-release-notes"
              >Claude Sonnet will ship in Xcode</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-29 @ 00:44:27</span
              ><span class="points-container"
                >Points: <span class="points">404</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45058688"
                  >Comments</a
                ><span class="descendants">: 319</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45057404">
          <h3>
            <a
              class="item"
              href="https://mcdreeamiemusings.com/blog/2019/4/13/gsux1h6bnt8lqjd7w2t2mtvfg81uhx"
              >The Space Shuttle Columbia disaster and the over-reliance on
              PowerPoint (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-28 @ 21:44:47</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45057404"
                  >Comments</a
                ><span class="descendants">: 140</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45057322">
          <h3>
            <a class="item" href="https://github.com/elixir-lang/expert"
              >Expert: LSP for Elixir</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-28 @ 21:36:36</span
              ><span class="points-container"
                >Points: <span class="points">193</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45057322"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45057020">
          <h3>
            <a
              class="item"
              href="https://www.fuckupmysite.com/?url=https%3A%2F%2Fnews.ycombinator.com&amp;torchCursor=true&amp;comicSans=true&amp;fakeCursors=true&amp;peskyFly=true"
              >Fuck up my site – Turn any website into beautiful chaos</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-28 @ 21:04:36</span
              ><span class="points-container"
                >Points: <span class="points">286</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45057020"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45056177">
          <h3>
            <a
              class="item"
              href="https://mitchellh.com/writing/my-startup-banking-story"
              >My startup banking story (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-28 @ 19:38:20</span
              ><span class="points-container"
                >Points: <span class="points">292</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45056177"
                  >Comments</a
                ><span class="descendants">: 138</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45055641">
          <h3>
            <a
              class="item"
              href="https://martinfowler.com/articles/202508-ai-thoughts.html"
              >Some thoughts on LLMs and software development</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-28 @ 18:52:00</span
              ><span class="points-container"
                >Points: <span class="points">356</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45055641"
                  >Comments</a
                ><span class="descendants">: 312</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45054703">
          <h3>
            <a class="item" href="https://nshipster.com/uncertainty/"
              >Uncertain</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-28 @ 17:22:54</span
              ><span class="points-container"
                >Points: <span class="points">391</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45054703"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45054260">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=45054260"
              >Ask HN: The government of my country blocked VPN access. What
              should I use?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-28 @ 16:43:05</span
              ><span class="points-container"
                >Points: <span class="points">1171</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45054260"
                  >Comments</a
                ><span class="descendants">: 635</span></span
              >
            </h4>
            <div class="text">
              Indonesia is currently in chaos. Earlier today, the government
              blocked access to Twitter &amp;amp; Discord knowing news spread
              mainly through those channels. Usually we can use Cloudflare's
              WARP to avoid it, but just today they blocked the access as well.
              What alternative should we use?
            </div>
          </section>
        </section>
        <section id="45052423">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2025/08/28/generative-ai-reshapes-us-job-market-stanford-study-shows-entry-level-young-workers.html"
              >AI adoption linked to 13% decline in jobs for young U.S. workers:
              study</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-28 @ 14:13:44</span
              ><span class="points-container"
                >Points: <span class="points">371</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45052423"
                  >Comments</a
                ><span class="descendants">: 548</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45036944">
          <h3>
            <a
              class="item"
              href="https://github.com/VectifyAI/PageIndex/blob/main/cookbook/pageindex_RAG_simple.ipynb"
              >Show HN: Vectorless RAG</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-27 @ 08:39:32</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45036944"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
            <div class="text">
              <p>
                PageIndex takes a different approach to RAG. Instead of relying
                on vector databases or artificial chunking, it builds a
                hierarchical tree structure from documents and uses
                reasoning-based tree search to locate the most relevant
                sections. This mirrors how humans approach reading: navigating
                through sections and context rather than matching embeddings.
              </p>
              <p>
                As a result, the retrieval feels transparent, structured, and
                explainable. It moves RAG away from approximate "semantic vibes"
                and toward explicit reasoning about where information lives.
                That clarity can help teams trust outputs and debug workflows
                more effectively.
              </p>
              <p>
                The broader implication is that retrieval doesn't need to scale
                endlessly in vectors to be powerful. By leaning on document
                structure and reasoning, it reminds us that efficiency and
                human-like logic can be just as transformative as raw
                horsepower.
              </p>
            </div>
          </section>
        </section>
        <section id="45036761">
          <h3>
            <a
              class="item"
              href="https://midday.ai/updates/automatic-reconciliation-engine/"
              >Show HN: Auto-Match – How We Built Receipt-to-Transaction
              Matching (Open Source)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-27 @ 08:05:09</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45036761"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
            <div class="text">
              <p>It's built into Midday and fully open-source.</p>
              <p>Let me know if you have any questions!</p>
            </div>
          </section>
        </section>
        <section id="45035684">
          <h3>
            <a class="item" href="https://www.praf.me/ai-coding"
              >AI coding made me faster, but I can't code to music anymore</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-27 @ 05:10:53</span
              ><span class="points-container"
                >Points: <span class="points">196</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45035684"
                  >Comments</a
                ><span class="descendants">: 217</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45017177">
          <h3>
            <a
              class="item"
              href="https://einarwh.no/blog/2025/08/25/nullable-vs-nullable/"
              >Nullable vs. Nullable in C#</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-25 @ 18:27:31</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45017177"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45016263">
          <h3>
            <a
              class="item"
              href="https://zaerl.com/2025/08/24/its-not-wrong-that-for-hn-%f0%9f%a4%a6%f0%9f%8f%bc%e2%99%82%ef%b8%8f-length-36/"
              >It's Not Wrong that (for HN) " ".length == 36</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-25 @ 17:20:05</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45016263"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45012080">
          <h3>
            <a class="item" href="https://oxism.com/trystero/"
              >Make any site multiplayer in a few lines. Serverless WebRTC
              matchmaking</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-25 @ 09:48:53</span
              ><span class="points-container"
                >Points: <span class="points">153</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45012080"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
