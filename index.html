<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43888803">
          <h3>
            <a class="item" href="https://claytonwramsey.com/blog/prompt/"
              >I'd rather read the prompt</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-04 @ 19:17:28</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43888803"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43888501">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2025/05/03/how-riot-games-is-fighting-the-war-against-video-game-hackers/"
              >How Riot Games is fighting the war against video game hackers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-04 @ 18:35:31</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43888501"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43888239">
          <h3>
            <a
              class="item"
              href="https://terrytao.wordpress.com/2025/05/04/orders-of-infinity/"
              >Orders of Infinity</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-04 @ 17:55:27</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43888239"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43888225">
          <h3>
            <a
              class="item"
              href="https://text-incubation.com/AI+code+is+legacy+code+from+day+one"
              >AI code is legacy code from day one</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-04 @ 17:53:59</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43888225"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43888191">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=7hdJQkn8rtA"
              >Critical Program Reading (1975) [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-04 @ 17:48:47</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43888191"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43888117">
          <h3>
            <a class="item" href="https://blog.rahix.de/design-for-3d-printing/"
              >Design for 3D-Printing</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-04 @ 17:38:13</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43888117"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43888005">
          <h3>
            <a
              class="item"
              href="https://zeux.io/2025/05/03/load-store-conflicts/"
              >Load-Store Conflicts</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-04 @ 17:18:42</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43888005"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43887876">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/hightouch/jobs/kIoY0yH-machine-learning-engineer-ai-decisioning"
              >Hightouch (YC S19) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-04 @ 17:00:38</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43887708">
          <h3>
            <a
              class="item"
              href="https://raw.githubusercontent.com/Stefan20162016/linux-insides-code/master/bootloader.asm"
              >Minimal Linux Bootloader</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-04 @ 16:36:02</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43887708"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43887637">
          <h3>
            <a class="item" href="https://rentry.co/samplers"
              >Dummy's Guide to Modern LLM Sampling</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-04 @ 16:26:28</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43887637"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43887546">
          <h3>
            <a class="item" href="https://github.com/benb0jangles/EzTrak"
              >Show HN: EZ-TRAK Satellite Hand Tracking Suite</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-04 @ 16:10:41</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43887546"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
            <div class="text">
              EZ-TRAK is a comprehensive satellite tracking suite designed for
              amateur radio operators, weather satellite enthusiasts, and
              educational purposes. The software interfaces with an EZ-TRAK BLE
              device which is mounted to a lightweight foldable portable
              satellite dish antenna to hand track satellites in real-time,
              providing azimuth and elevation data for optimal antenna
              positioning.
            </div>
          </section>
        </section>
        <section id="43887073">
          <h3>
            <a
              class="item"
              href="https://ostechnix.com/why-flatpak-apps-use-so-much-disk-space/"
              >Why Flatpak apps use so much disk space on Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-04 @ 14:57:59</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43887073"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43886601">
          <h3>
            <a class="item" href="https://github.com/Foreseerr/TScale"
              >TScale â€“ distributed training on consumer GPUs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-04 @ 13:29:55</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43886601"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43886552">
          <h3>
            <a
              class="item"
              href="https://www.texasmonthly.com/news-politics/ecstasy-starck-club-drugs-eighties-dallas/"
              >The Texan who built an empire of ecstasy</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-04 @ 13:21:33</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43886552"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43886368">
          <h3>
            <a class="item" href="https://farina00.github.io/essays/nevermind/"
              >Nevermind, an album on major chords</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-04 @ 12:37:52</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43886368"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
            <div class="text">
              Here is a thing. If you are okay with HTML, you might want to
              write an article using GitHub pages instead of any blogging
              platform (e.g. medium.com) The only constrains then become your
              skills instead of what your chosen platform has decided to support
              (typically embedding videos, code snippets, ...)
            </div>
          </section>
        </section>
        <section id="43886271">
          <h3>
            <a class="item" href="https://astrobe.com/Modula2/"
              >Lilith and Modula-2</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-04 @ 12:10:03</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43886271"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43886243">
          <h3>
            <a
              class="item"
              href="https://oxfordamerican.org/oa-now/the-alabama-landline-that-keeps-ringing"
              >The Alabama Landline That Keeps Ringing</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-04 @ 12:02:35</span
              ><span class="points-container"
                >Points: <span class="points">216</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43886243"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43886213">
          <h3>
            <a class="item" href="https://tippycoco.com/"
              >Tippy Coco: A Free, Open-Source Game Inspired by Slime
              Volleyball</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-04 @ 11:55:08</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43886213"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43885478">
          <h3>
            <a
              class="item"
              href="http://pascal.hansotten.com/niklaus-wirth/project-oberon/oberon-pi/"
              >Oberon Pi</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-04 @ 08:54:44</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43885478"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43885051">
          <h3>
            <a
              class="item"
              href="https://garymarcus.substack.com/p/the-latest-ai-scaling-graph-and-why"
              >Predictions from the METR AI scaling graph are based on a flawed
              premise</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-04 @ 07:01:29</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43885051"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43883902">
          <h3>
            <a
              class="item"
              href="http://oldvcr.blogspot.com/2025/05/what-went-wrong-with-wireless-usb.html"
              >What went wrong with wireless USB</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-04 @ 02:03:40</span
              ><span class="points-container"
                >Points: <span class="points">284</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43883902"
                  >Comments</a
                ><span class="descendants">: 162</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43883180">
          <h3>
            <a class="item" href="https://cjmapp.net/"
              >Show HN: MP3 File Editor for Bulk Processing</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-03 @ 23:27:11</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43883180"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
            <div class="text">
              Efficiently edit many MP3 files using a combination of GUI
              operations and scripting.
            </div>
          </section>
        </section>
        <section id="43883040">
          <h3>
            <a class="item" href="https://github.com/Jacksaur/Gorgeous-GRUB"
              >Gorgeous-GRUB: collection of decent community-made GRUB themes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-03 @ 22:57:58</span
              ><span class="points-container"
                >Points: <span class="points">385</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43883040"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43881468">
          <h3>
            <a
              class="item"
              href="https://www.dbreunig.com/2025/05/03/duckdb-is-the-most-impactful-geospatial-software-in-a-decade.html"
              >DuckDB is probably the most important geospatial software of the
              last decade</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-03 @ 19:30:38</span
              ><span class="points-container"
                >Points: <span class="points">426</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43881468"
                  >Comments</a
                ><span class="descendants">: 132</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43880962">
          <h3>
            <a class="item" href="https://breezepdf.com"
              >Show HN: Free, in-browser PDF editor</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-03 @ 18:15:45</span
              ><span class="points-container"
                >Points: <span class="points">682</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43880962"
                  >Comments</a
                ><span class="descendants">: 144</span></span
              >
            </h4>
            <div class="text">
              Add text, input boxes, pictures, signatures, delete pages, merge
              PDFs and password protect them. All happening in the browser, 100%
              free and no sign-up.
            </div>
          </section>
        </section>
        <section id="43878868">
          <h3>
            <a
              class="item"
              href="https://macwright.com/2025/05/02/reading-zanzibar"
              >Reading Zanzibar</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-03 @ 13:18:49</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43878868"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43872799">
          <h3>
            <a
              class="item"
              href="https://www.esa.int/ESA_Multimedia/Images/2025/04/A_visual_feast_of_galaxies_from_infrared_to_X-ray"
              >A visual feast of galaxies, from infrared to X-ray</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 17:46:02</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43872799"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43868694">
          <h3>
            <a
              class="item"
              href="https://www.zymtrace.com/article/zero-friction-gpu-profiler"
              >Distributed Continuous GPU Profiling</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 12:11:18</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43868694"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43866329">
          <h3>
            <a
              class="item"
              href="https://lucasb.eyer.be/articles/vit_cnn_speed.html"
              >The Speed of VITs and CNNs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-05-02 @ 04:53:46</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43866329"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43845174">
          <h3>
            <a
              class="item"
              href="https://news.mit.edu/2025/kids-eeg-monitoring-consciousness-safely-reduces-anesthetic-use-0429"
              >In kids, EEG monitoring of consciousness safely reduces
              anesthetic use</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-30 @ 13:46:38</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43845174"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
