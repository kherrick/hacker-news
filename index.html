<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="35932125">
          <h3>
            <a
              class="item"
              href="https://www.standard.co.uk/business/revolut-cfo-quits-after-auditor-bdo-warning-over-accountsmikko-salovaara-b1080447.html"
              >Revolut CFO quits after auditor BDO warning</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-13 @ 20:00:00</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35932125"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35931396">
          <h3>
            <a
              class="item"
              href="https://bkamins.github.io/julialang/2023/05/12/julia190.html"
              >Julia 1.9.0 lives up to its promise</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-13 @ 18:46:39</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35931396"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35931368">
          <h3>
            <a class="item" href="http://www.os2museum.com/wp/idle-dr-dos/"
              >Idle DR-DOS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-13 @ 18:43:49</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35931368"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35930895">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=BxvVdB4-Aqc"
              >Committing changes to a 130GB Git repository without full
              checkouts [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-13 @ 17:59:42</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35930895"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <p>
                The burden of checking out and building snapshots from diff
                history is now borne by localhost, but that may change, as
                mentioned in the video. Smart navigation of git history from the
                nearest available snapshots, building snapshots with Spark, and
                other ways to save on data transfer and compute are being
                evaluated. This paradigm enables hibernating or cleaning up
                history on S3 for datasets no longer necessary to create
                snapshots, like those that are deleted, if snapshots of earlier
                commits are not needed. Individual data entries could also be
                removed for GDPR compliance using versioning on S3 objects,
                orthogonal to git.
              </p>
              <p>
                The prototype already cures the pain point I built it for: it
                was impossible to (1) uniquely identify and (2) make available
                behind an API multiple versions of a collection of datasets and
                config parameters, (3) without overburdening HDDs due to small,
                but frequent changes to any of the datasets in the repo and (4)
                while being able to see the diffs in git for each commit in
                order to enable collaborative discussions and reverting or
                further editing if necessary. Some background: I am building
                natural language AI algorithms (a) easily retrainable on
                editable training datasets, meaning changes or deletions in the
                training data are reflected fast, without traces of past
                training and without retraining the entire language model
                (sounds impossible), and (b) that explain decisions back to
                individual training data. LLMs have fixed training datasets,
                whereas editable datasets call for a system to manage data
                efficiently, plus I wanted to have something that integrates
                naturally with common, tried and tested tools such as Git, S3,
                and MySQL, hence the Data Manager.
              </p>
              <p>
                I am considering open-source: is that the best way to go? Which
                license to choose?
              </p>
            </div>
          </section>
        </section>
        <section id="35930518">
          <h3>
            <a
              class="item"
              href="https://www.telegraph.co.uk/money/consumer-affairs/hp-printers-computers-ink-cartridges-rivals/"
              >HP disables customers’ printers if they use ink cartridges from
              cheaper rivals</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-13 @ 17:24:11</span
              ><span class="points-container"
                >Points: <span class="points">231</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35930518"
                  >Comments</a
                ><span class="descendants">: 169</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35930160">
          <h3>
            <a
              class="item"
              href="https://textslashplain.com/2023/05/13/new-tlds-not-bad-actually/"
              >New TLDs: Not Bad</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-13 @ 16:50:20</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35930160"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35930045">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/information-technology/2023/05/microsoft-patches-secure-boot-flaw-but-wont-enable-fix-by-default-until-early-2024/"
              >Microsoft will take nearly a year to finish patching new 0-day
              Secure Boot bug</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-13 @ 16:39:50</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35930045"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35929816">
          <h3>
            <a
              class="item"
              href="https://www.colorado.edu/today/2023/05/12/how-old-are-saturns-rings-far-younger-once-thought-according-new-study"
              >Saturn's rings are far younger than once thought</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-13 @ 16:16:25</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35929816"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35929794">
          <h3>
            <a
              class="item"
              href="https://www.indiehackers.com/post/how-to-hack-hacker-news-and-consistently-hit-the-front-page-56b4a04e12"
              >How we hack Hacker News and consistently hit the front page</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-13 @ 16:13:43</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35929794"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35929377">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41587-022-01618-2"
              >Large language models generate functional protein sequences
              across families</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-13 @ 15:36:11</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35929377"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35929348">
          <h3>
            <a
              class="item"
              href="https://www.businessinsider.com/new-lawsuit-alleges-tiktok-owner-let-ccp-access-user-data-2023-5"
              >TikTok Owner Had 'Backdoor' for CCP Access to US Data, Lawsuit
              Alleges</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-13 @ 15:33:04</span
              ><span class="points-container"
                >Points: <span class="points">301</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35929348"
                  >Comments</a
                ><span class="descendants">: 220</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35929122">
          <h3>
            <a
              class="item"
              href="https://simonwillison.net/2023/May/2/prompt-injection-explained/"
              >Prompt injection explained, with video, slides, and a
              transcript</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-13 @ 15:11:11</span
              ><span class="points-container"
                >Points: <span class="points">241</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35929122"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35929102">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=ob7cEzXLxXU"
              >1980 Terminal with Linux – TeleVideo 950</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-13 @ 15:08:15</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35929102"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35928936">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/article/fake-scientific-papers-are-alarmingly-common"
              >Fake scientific papers are alarmingly common</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-13 @ 14:49:45</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35928936"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35928816">
          <h3>
            <a
              class="item"
              href="https://www.kitguru.net/channel/generaltech/matthew-wilson/asus-uk-pr-believes-it-is-legal-to-buy-positive-reviews/"
              >Asus UK PR believes it is ‘legal to buy positive reviews’</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-13 @ 14:36:24</span
              ><span class="points-container"
                >Points: <span class="points">185</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35928816"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35928460">
          <h3>
            <a
              class="item"
              href="https://mercurialtrends.com/agrivoltaics-a-sustainable-synergy-between-agriculture-and-solar-energy/"
              >Agrivoltaics: A Sustainable Synergy Between Agriculture and Solar
              Energy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-13 @ 13:59:59</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35928460"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35928362">
          <h3>
            <a
              class="item"
              href="https://virtuallyfun.com/2023/05/10/openbsd-7-3-on-the-es40-dec-alpha-emulator/"
              >OpenBSD 7.3 on the es40 Dec Alpha emulator</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-13 @ 13:49:31</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35928362"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35927813">
          <h3>
            <a
              class="item"
              href="https://fly.io/ruby-dispatch/welcome-to-rails-cheat-sheet/"
              >Rails Cheat Sheet</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-13 @ 12:41:36</span
              ><span class="points-container"
                >Points: <span class="points">177</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35927813"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35927539">
          <h3>
            <a
              class="item"
              href="https://github.com/laudspeaker/laudspeaker/tree/Hiring"
              >Laudspeaker hiring engineer to build open source customer journey
              software</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-13 @ 12:01:01</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35927475">
          <h3>
            <a class="item" href="https://hails.org/@hailey/110360791283096989"
              >Rust hello world app for Windows 95, cross-compiled from Linux,
              no MSVC</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-13 @ 11:50:23</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35927475"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35927329">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/05/13/kyndryl_ibm_sued_discrimination/"
              >IBM sued for age discrimination by former global software
              director</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-13 @ 11:19:24</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35927329"
                  >Comments</a
                ><span class="descendants">: 125</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35927239">
          <h3>
            <a class="item" href="http://attentionviz.com/">Attention Viz</a>
          </h3>
          <section>
            <h4>
              <span>2023-05-13 @ 11:01:03</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35927239"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35927149">
          <h3>
            <a
              class="item"
              href="https://sandimetz.com/blog/2016/1/20/the-wrong-abstraction"
              >The Wrong Abstraction (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-13 @ 10:40:40</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35927149"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35926821">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Ocean_temperature"
              >Ocean Temperature</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-13 @ 09:15:27</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35926821"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35925781">
          <h3>
            <a class="item" href="https://webaudio.prototyping.bbc.co.uk/"
              >Recreating the sounds of the BBC Radiophonic Workshop</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-13 @ 05:12:10</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35925781"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35925459">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Caproni_Ca.60"
              >Caproni Ca.60</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-13 @ 04:18:20</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35925459"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35924997">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/news/google-a3-supercomputer-h100-googleio"
              >Google Launches AI Supercomputer Powered by Nvidia H100 GPUs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-13 @ 02:47:04</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35924997"
                  >Comments</a
                ><span class="descendants">: 123</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35924495">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-04-hidden-rna-mechanism-humans.html"
              >RNA repair mechanism discovered in humans</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-13 @ 01:20:43</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35924495"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35914691">
          <h3>
            <a
              class="item"
              href="https://acoup.blog/2023/05/12/collections-who-were-the-celts-and-how-did-they-some-of-them-fight/"
              >Who Were ‘The Celts’ and How Did They (Some of Them) Fight?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-12 @ 11:32:01</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35914691"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35908617">
          <h3>
            <a
              class="item"
              href="https://eev.ee/blog/2021/01/26/gamedev-from-scratch-1-scaffolding/"
              >Gamedev from Scratch 1: Scaffolding</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 21:28:29</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35908617"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
