<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36300958">
          <h3>
            <a
              class="item"
              href="https://www.techdirt.com/2023/06/08/us-patent-office-proposes-rule-to-make-it-much-harder-to-kill-bad-patents/"
              >US Patent Office proposes rule to make it much harder to kill bad
              patents</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 20:55:03</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36300958"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36300410">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/odni-commercially-available-information-report/"
              >The US Is Openly Stockpiling Dirt on All Its Citizens</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 20:21:08</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36300410"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36300215">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-06-lingering-effects-neanderthal-dna-modern.html"
              >Lingering effects of Neanderthal DNA found in modern humans</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 20:09:07</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36300215"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36300209">
          <h3>
            <a
              class="item"
              href="https://think.ing.com/articles/never-waste-a-good-crisis-a-profit-price-spiral-germany/"
              >A profit-price spiral in Germany</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 20:08:42</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36300209"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36299904">
          <h3>
            <a class="item" href="https://flingup.com"
              >Show HN: FlingUp, a Reddit-like platform Ive been building for
              the last 2 years</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 19:50:09</span
              ><span class="points-container"
                >Points: <span class="points">115</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36299904"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36299325">
          <h3>
            <a
              class="item"
              href="https://mastodon.social/@coreyspowell/110531182569820738"
              >Earth's rotation, with the camera locked to the sky instead of
              the ground</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 19:10:10</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36299325"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36298891">
          <h3>
            <a
              class="item"
              href="https://www.platformonomics.com/2023/04/a-new-antitrust-doctrine/"
              >A New Antitrust Doctrine</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 18:44:50</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36298891"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36298655">
          <h3>
            <a
              class="item"
              href="https://monroelab.net/escape-from-silicon-valley-alternative-visions-of-computation"
              >Escape from Silicon Valley (alternative visions of
              computation)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 18:32:38</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36298655"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36297477">
          <h3>
            <a
              class="item"
              href="https://www.david-smith.org/blog/2023/06/12/new-post/"
              >A developer's view of Vision Pro</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 17:31:02</span
              ><span class="points-container"
                >Points: <span class="points">157</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36297477"
                  >Comments</a
                ><span class="descendants">: 218</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36297476">
          <h3>
            <a class="item" href="https://justine.lol/sorting/"
              >Understanding DeepMind's sorting algorithm</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 17:30:54</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36297476"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36297413">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/opinions/2023/06/12/books-editing-retouching-free-expression/"
              >21st-century editors should keep their hands off of 20th-century
              books</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 17:28:39</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36297413"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36296882">
          <h3>
            <a
              class="item"
              href="https://www.marginalia.nu/log/82_killing_community"
              >Killing Community</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 17:02:59</span
              ><span class="points-container"
                >Points: <span class="points">199</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36296882"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36296826">
          <h3>
            <a class="item" href="https://www.easypost.com/careers"
              >EasyPost (YC S13) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 17:00:43</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36296695">
          <h3>
            <a class="item" href="https://non.io"
              >Show HN: Non.io, a Reddit-like platform Ive been working on for
              the last 4 years</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 16:54:38</span
              ><span class="points-container"
                >Points: <span class="points">1066</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36296695"
                  >Comments</a
                ><span class="descendants">: 342</span></span
              >
            </h4>
            <div class="text">
              <p>How non.io works:</p>
              <p>1. Free to browse, paid to interact.</p>
              <p>
                2. Minimum subscription is $2 (though you can choose more). I
                take $1 to run the servers, everything left gets split evenly
                between everything you upvote that month.
              </p>
              <p>
                It's a simple model, but I hope it's a better one than the
                freemium model we've been relying on for the last few years.
                Fundamentally I feel like any ad-supported network doesn't have
                alignment between the needs of the users and the needs of the
                platform, which is what drove me to make this.
              </p>
              <p>
                Because this is a soft launch, if you do subscribe I'd encourage
                you <i>not</i> to pay for the time being. I'm still testing the
                distribution algorithm for returning funds - you won't get
                overcharged or anything, but I just want to guarantee your funds
                are properly distributed at the end of the month. I've opened up
                free accounts to post and interact in the meantime. If you want
                to try a test account, use this login:
              </p>
              <p>login: hackernews pw: helloworld</p>
              <p>
                Edit: Loginless browsing here:
                <a href="https://non.io/#all">https://non.io/#all</a>
              </p>
              <p>If you want to browse the code or the api:</p>
              <p><a href="https://api.non.io">https://api.non.io</a></p>
              <p>
                <a href="https://github.com/jjcm/nonio"
                  >https://github.com/jjcm/nonio</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="36296282">
          <h3>
            <a
              class="item"
              href="https://pixelfed.blog/p/2023/feature/introducing-import-from-instagram"
              >Pixelfed Introduces Import from Instagram</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 16:35:04</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36296282"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36296250">
          <h3>
            <a
              class="item"
              href="https://medium.com/@bjax_/a-tale-of-unwanted-disruption-my-week-without-amazon-df1074e3818b"
              >A Tale of Unwanted Disruption: My Week Without Amazon</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 16:33:27</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36296250"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36296185">
          <h3>
            <a
              class="item"
              href="https://buttondown.email/anmonteiro/archive/melange-hits-v10/"
              >Melange 1.0: Compile OCaml / ReasonML to JavaScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 16:28:51</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36296185"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36295460">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36295460"
              >Launch HN: DevCycle (YC W14) – a feature flag platform built for
              developers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 15:46:48</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36295460"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
            <div class="text">
              <a href="https://devcycle.com">https://devcycle.com</a>). DevCycle
              is a feature flag platform focused on developer experience, speed
              of delivery and long-term maintainability.
              <p>
                To give the platform a shot, anyone can sign up and use DevCycle
                for free here:
                <a href="https://devcycle.com">https://devcycle.com</a>
              </p>
              <p>
                Here’s a general platform demo video if you’re interested:
                <a href="https://www.youtube.com/watch?v=bZD-pyKGwR4"
                  >https://www.youtube.com/watch?v=bZD-pyKGwR4</a
                >
              </p>
              <p>
                Feature flagging is a technique that lets developers switch
                features on or off in a software application without redeploying
                it, enhancing testing and rollback capabilities. At their core,
                feature flagging platforms solve the problem of separating
                production code deploys from feature releases to users. While
                DevCycle solves that same general pain, we also aim to solve
                core problems in developer experience and code maintainability
                that hold developers back from fully adopting feature flagging
                into their workflow.
              </p>
              <p>
                In traditional feature flagging platforms, extended flag usage
                increases code complexity over time. Most engineers with feature
                flagging experience are worried about the build-up of stale
                flags and their code being filled with unnecessary conditionals.
                Dealing with this problem is important because if an engineer is
                worried about this increasing complexity, they are likely to
                avoid using feature flags.
              </p>
              <p>
                We came upon this problem when we were building Taplytics, the
                startup we joined YC with. We experienced it not only from our
                own struggles with feature flagging and transitioning to
                continuous deployment but also from our time spent with
                Taplytics customers who were often on the same journey.
              </p>
              <p>
                Given this experience, we developed DevCycle with a few core
                differences in how we solve these problems.
              </p>
              <p>
                Features, Not Just Flags: Many in-house and competitive feature
                flag systems operate on the simple idea that features exist in a
                binary state - they are either ‘ON’ or ‘OFF.’ In reality,
                software is never this simple. DevCycle treats features the same
                way you do in every other context, by attaching
                highly-extensible remote configuration to every feature in your
                product, allowing multiple flags to be combined under the
                context of a single feature and configured together.
              </p>
              <p>
                Developer Experience: To get the benefits of feature flagging
                you need broad adoption by all developers touching a codebase.
                Our primary goal is to provide the best developer experience
                possible. Providing tools and integrations so we can get out of
                developers’ way. For example, to address the problem of
                long-running feature flags that build up over time, we offer
                developer-facing features to easily track, detect (deploy
                pipeline actions), and eventually remove unnecessary technical
                debt (CLI code cleanup commands).
              </p>
              <p>
                Given that we are building this as a developer-first product,
                we’d love your feedback on whether our approach better fits your
                workflow and any other thoughts on our solution. Thanks so much!
              </p>
            </div>
          </section>
        </section>
        <section id="36295364">
          <h3>
            <a
              class="item"
              href="https://www.neowin.net/news/edge-sends-images-you-view-online-to-microsoft-here-is-how-to-disable-that/"
              >Edge sends images you view online to Microsoft</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 15:40:47</span
              ><span class="points-container"
                >Points: <span class="points">617</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36295364"
                  >Comments</a
                ><span class="descendants">: 296</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36295227">
          <h3>
            <a
              class="item"
              href="https://generalrobots.substack.com/p/dimension-hopper-part-1"
              >Show HN: Stable Diffusion powered level editor for a 2D game</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 15:31:55</span
              ><span class="points-container"
                >Points: <span class="points">215</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36295227"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
            <div class="text">
              Hey folks, I’ve been working on using control-net to take in a
              video game level (input as a depth image) and output a beautiful
              illustration of that level. Play with it here: dimensionhopper.com
              or read the blog post about what it took to get it to work. Been a
              super fun project.
            </div>
          </section>
        </section>
        <section id="36294750">
          <h3>
            <a class="item" href="https://www.cloudflarestatus.com"
              >Cloudflare Is Having Issues</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 14:59:30</span
              ><span class="points-container"
                >Points: <span class="points">316</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36294750"
                  >Comments</a
                ><span class="descendants">: 154</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36293752">
          <h3>
            <a
              class="item"
              href="http://thomasburette.com/blog/2014/06/25/the-power-of-keeping-a-coding-journal/"
              >The power of keeping a coding journal (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 14:13:09</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36293752"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36293026">
          <h3>
            <a class="item" href="https://github.com/StevenBlack/hosts"
              >Block Adware and Malware with /etc/hosts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 13:24:38</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36293026"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36292413">
          <h3>
            <a
              class="item"
              href="https://www.usenix.org/conference/usenixsecurity23/presentation/rohlmann"
              >Every Signature Is Broken: Insecurity of Microsoft Office’s Ooxml
              Signatures</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 12:34:57</span
              ><span class="points-container"
                >Points: <span class="points">268</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36292413"
                  >Comments</a
                ><span class="descendants">: 115</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36292078">
          <h3>
            <a class="item" href="https://communitywiki.org/wiki/SmolNet"
              >The “smolnet”, build for friends and friends of friends</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 11:59:22</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36292078"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36291169">
          <h3>
            <a
              class="item"
              href="https://privsec.dev/posts/linux/desktop-linux-hardening/"
              >Desktop Linux Hardening (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 10:23:35</span
              ><span class="points-container"
                >Points: <span class="points">203</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36291169"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36289729">
          <h3>
            <a class="item" href="https://api7.ai/blog/how-is-apisix-fast"
              >How is Apache APISIX Fast?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 07:36:57</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36289729"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36289580">
          <h3>
            <a
              class="item"
              href="https://underjord.io/scripting-with-elixir.html"
              >Scripting with Elixir</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 07:20:18</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36289580"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36289424">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=6hJBko3-oV4"
              >Early 1980s Datsun/Nissan Voice Alert phonograph unit [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 07:02:54</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36289424"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36288618">
          <h3>
            <a
              class="item"
              href="https://albertcory50.substack.com/p/the-art-of-leadership-lessons-from"
              >The Art of Leadership: Lessons from Art Blakey</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-12 @ 04:59:06</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36288618"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
