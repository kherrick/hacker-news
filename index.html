<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43155023">
          <h3>
            <a class="item" href="https://github.com/deepseek-ai/FlashMLA"
              >DeepSeek Open Source FlashMLA â€“ MLA Decoding Kernel for Hopper
              GPUs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-24 @ 01:37:24</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43155023"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43154666">
          <h3>
            <a
              class="item"
              href="https://www.gilesthomas.com/2025/02/20250223-til-deep-dive-posts"
              >Write the post you wish you'd found</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-24 @ 00:34:34</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43154666"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43154501">
          <h3>
            <a
              class="item"
              href="https://blog.thenewoil.org/how-the-uk-is-weakening-safety-worldwide"
              >How the UK Is Weakening Safety Worldwide</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-24 @ 00:09:16</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43154501"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43154331">
          <h3>
            <a
              class="item"
              href="https://people.csail.mit.edu/ronitt/sublinear.html"
              >Sublinear Time Algorithms</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-23 @ 23:42:33</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43154331"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43154218">
          <h3>
            <a
              class="item"
              href="https://artemis.sh/2025/02/22/uefi-nvram-defrag.html"
              >Defragging my old Dell's UEFI NVRAM</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-23 @ 23:23:04</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43154218"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43154148">
          <h3>
            <a class="item" href="https://beej.us/blog/data/mastodon-comments/"
              >Adding Mastodon Comments to Your Blog</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-23 @ 23:12:46</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43154148"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43153901">
          <h3>
            <a
              class="item"
              href="https://kobzol.github.io/rust/2025/02/23/tokio-plus-prctl-equals-nasty-bug.html"
              >Tokio and Prctl = Nasty Bug</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-23 @ 22:37:57</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43153901"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43153662">
          <h3>
            <a
              class="item"
              href="https://civilization.2k.com/civ-vii/news/civilization-vii-shawnee-tribe-partnership/"
              >Partnering with the Shawnee Tribe for Civilization VII</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-23 @ 22:06:09</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43153662"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43153262">
          <h3>
            <a class="item" href="https://bitwarden.com/products/authenticator/"
              >Bitwarden Authenticator</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-23 @ 21:11:44</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43153262"
                  >Comments</a
                ><span class="descendants">: 118</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43152704">
          <h3>
            <a class="item" href="https://github.com/yshavit/mdq"
              >Show HN: Jq-Like Tool for Markdown</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-23 @ 20:05:49</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43152704"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
            <div class="text">
              <p>
                This can be done to some extent with regex, but those
                expressions are brittle and hard to read or edit later. mdq uses
                a familiar pipe syntax to navigate the Markdown in a structured
                way.
              </p>
              <p>
                It's in 0.x because I don't want to fully commit to the syntax
                being stable, in case real-world testing shows that the syntax
                needs tweaking. But I think the project is in a pretty good spot
                overall, and would be interested in feedback!
              </p>
            </div>
          </section>
        </section>
        <section id="43152587">
          <h3>
            <a
              class="item"
              href="https://ukdataexplorer.com/european-translator/"
              >European word translator: an interactive map showing words in
              over 30 languages</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-23 @ 19:53:03</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43152587"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43151320">
          <h3>
            <a
              class="item"
              href="https://www.sciencefriday.com/articles/doctored-book-excerpt/"
              >Decades of Research Misconduct Stalled an Alzheimer's Cure</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-23 @ 17:46:09</span
              ><span class="points-container"
                >Points: <span class="points">154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43151320"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43151294">
          <h3>
            <a
              class="item"
              href="https://github.com/vinceliuice/WhiteSur-gtk-theme"
              >WhiteSur: macOS-like theme for GTK desktops</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-23 @ 17:43:34</span
              ><span class="points-container"
                >Points: <span class="points">212</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43151294"
                  >Comments</a
                ><span class="descendants">: 128</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43150885">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/proprise/jobs/ppipLUK-founding-engineer"
              >PropRise (YC S23) Is Hiring Engineer #1</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-23 @ 17:00:51</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43150217">
          <h3>
            <a class="item" href="https://www.u7revisited.com/"
              >Ultima VII: Revisited</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-23 @ 16:03:13</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43150217"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43149648">
          <h3>
            <a
              class="item"
              href="https://peeifyouwanttogofaster.com/2021/05/24/pee-if-you-want-to-go-deeper/"
              >Pee If You Want to Go Deeper (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-23 @ 14:53:42</span
              ><span class="points-container"
                >Points: <span class="points">157</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43149648"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43149266">
          <h3>
            <a class="item" href="https://vietgd.com/"
              >Vietnamese Graphic Design</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-23 @ 14:00:25</span
              ><span class="points-container"
                >Points: <span class="points">240</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43149266"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43148683">
          <h3>
            <a class="item" href="https://rachelbythebay.com/w/2025/02/22/war/"
              >War Rooms vs. Deep Investigations</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-23 @ 12:01:56</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43148683"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43148438">
          <h3>
            <a
              class="item"
              href="https://lcamtuf.substack.com/p/but-good-sir-what-is-electricity"
              >But good sir, what is electricity?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-23 @ 11:03:37</span
              ><span class="points-container"
                >Points: <span class="points">297</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43148438"
                  >Comments</a
                ><span class="descendants">: 150</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43147698">
          <h3>
            <a class="item" href="https://www.filfre.net/2024/12/half-life/"
              >Half-Life</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-23 @ 08:18:15</span
              ><span class="points-container"
                >Points: <span class="points">463</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43147698"
                  >Comments</a
                ><span class="descendants">: 198</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43146155">
          <h3>
            <a
              class="item"
              href="https://bangkoklocal.info/2025/02/05/thailand-to-cut-power-to-myanmar-scam-hubs/"
              >Thailand to Cut Power to Myanmar Scam Hubs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-23 @ 03:22:04</span
              ><span class="points-container"
                >Points: <span class="points">208</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43146155"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43145753">
          <h3>
            <a
              class="item"
              href="https://eli.thegreenplace.net/2025/making-any-integer-with-four-2s/"
              >Making any integer with four 2s</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-23 @ 02:25:51</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43145753"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43137586">
          <h3>
            <a class="item" href="https://gaiwan.co/blog/why-clojure/"
              >Why Clojure?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-22 @ 09:44:29</span
              ><span class="points-container"
                >Points: <span class="points">162</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43137586"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43134673">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2025-02-orchid-nutrient-theft-fungi-photosynthesis.html"
              >Orchid's nutrient theft from fungi shows
              photosynthesis-parasitism continuum</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-22 @ 00:03:58</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43134673"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43133772">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41586-024-08408-7"
              >Aqueous-based recycling of perovskite photovoltaics</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-21 @ 22:22:59</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43133772"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43124902">
          <h3>
            <a
              class="item"
              href="https://techxplore.com/news/2025-02-indiana-jones-jailbreak-approach-highlights.html"
              >'Indiana Jones' jailbreak approach highlights vulnerabilities of
              existing LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-21 @ 07:12:17</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43124902"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43122473">
          <h3>
            <a
              class="item"
              href="https://leetarxiv.substack.com/p/aan-discrete-cosine-transform-paper"
              >Ara Agui Nakajima DCT compression algorithm</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-21 @ 00:25:17</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43122473"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43118514">
          <h3>
            <a class="item" href="https://getomni.ai/ocr-benchmark"
              >Show HN: Benchmarking VLMs vs. Traditional OCR</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-20 @ 18:49:29</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43118514"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
            <div class="text">
              <p>
                We've been continuously evaluating different models since we
                released the Zerox package last year (<a
                  href="https://github.com/getomni-ai/zerox"
                  >https://github.com/getomni-ai/zerox</a
                >). And we wanted to put some numbers behind it. So weâ€™re open
                sourcing our internal OCR benchmark + evaluation datasets.
              </p>
              <p>
                Full writeup + data explorer here:
                <a href="https://getomni.ai/ocr-benchmark"
                  >https://getomni.ai/ocr-benchmark</a
                >
              </p>
              <p>
                Github:
                <a href="https://github.com/getomni-ai/benchmark"
                  >https://github.com/getomni-ai/benchmark</a
                >
              </p>
              <p>
                Huggingface:
                <a
                  href="https://huggingface.co/datasets/getomni-ai/ocr-benchmark"
                  >https://huggingface.co/datasets/getomni-ai/ocr-benchmark</a
                >
              </p>
              <p>Couple notes on the methodology:</p>
              <p>
                1. We are using JSON accuracy as our primary metric. The end
                goal is to evaluate how well each OCR provider can prepare the
                data for LLM ingestion.
              </p>
              <p>
                2. This methodology differs from a lot of OCR benchmarks,
                because it doesn't rely on text similarity. We believe text
                similarity measurements are heavily biased towards the exact
                layout of the ground truth text, and penalize correct OCR that
                has slight layout differences.
              </p>
              <p>
                3. Every document goes Image =&gt; OCR =&gt; Predicted JSON. And
                we compare the predicted JSON against the annotated ground truth
                JSON. The VLMs are capable of Image =&gt; JSON directly, we are
                primarily trying to measure OCR accuracy here. Planning to
                release a separate report on direct JSON accuracy next week.
              </p>
              <p>
                This is a continuous work in progress! There are at least 10
                additional providers we plan to add to the list.
              </p>
              <p>
                The next big roadmap items are: - Comparing OCR vs. direct
                extraction. Early results here show a slight accuracy
                improvement, but itâ€™s highly variable on page length.
              </p>
              <p>
                - A multilingual comparison. Right now the evaluation data is
                english only.
              </p>
              <p>
                - A breakdown of the data by type (best model for handwriting,
                tables, charts, photos, etc.)
              </p>
            </div>
          </section>
        </section>
        <section id="43112187">
          <h3>
            <a class="item" href="https://blog.plover.com/2017/11/12/"
              >It is not a compiler error. It is never a compiler error
              (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-20 @ 07:58:47</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43112187"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43111417">
          <h3>
            <a class="item" href="https://www.beatcode.dev/"
              >LeetCode but You Can Force People to Code in Light Mode</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-20 @ 05:28:07</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43111417"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
