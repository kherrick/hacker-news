<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41362798">
          <h3>
            <a
              class="item"
              href="https://www.ahajournals.org/doi/10.1161/HYPERTENSIONAHA.123.20545"
              >Blood Pressure Control Should Focus on More Potassium (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-26 @ 22:18:23</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41362798"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41362737">
          <h3>
            <a
              class="item"
              href="https://medicalxpress.com/news/2024-08-fda-ai-medical-devices-real.html"
              >Many FDA-approved AI medical devices are not trained on real
              patient data</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-26 @ 22:10:36</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41362737"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41362131">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2408.01386"
              >The Big Fringe Telescope</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-26 @ 21:02:00</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41362131"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41362122">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/roame/jobs/e8G5FJF-founding-ios-engineer"
              >Roame (YC S23) Is Hiring an iOS Founding Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-26 @ 21:01:16</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41361281">
          <h3>
            <a
              class="item"
              href="https://transactional.blog/blog/2024-erasure-coding"
              >Erasure Coding for Distributed Systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-26 @ 20:03:45</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41361281"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41360758">
          <h3>
            <a
              class="item"
              href="https://techxplore.com/news/2024-08-dimensional-power-consumption-field-effect.html"
              >Engineers develop new two-dimensional, low-power- field-effect
              transistor</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-26 @ 19:19:58</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41360758"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41359270">
          <h3><a class="item" href="https://iographica.com/">IOGraphica</a></h3>
          <section>
            <h4>
              <span>2024-08-26 @ 17:06:55</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41359270"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41359181">
          <h3>
            <a class="item" href="https://github.com/gauge-sh/tach"
              >Show HN: Strict interfaces and dep management for Python, written
              in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-26 @ 16:58:28</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41359181"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
            <div class="text">
              <p>
                It also supports strict interfaces for modules by overloading
                `__all__`.
              </p>
              <p>
                The core static analysis is done in Rust, so all Tach commands
                run quickly.
              </p>
              <p>
                The goal of Tach is to help eng teams maintain velocity while
                scaling quickly, something we've seen break down a number of
                times. Give it a try!
              </p>
            </div>
          </section>
        </section>
        <section id="41359152">
          <h3>
            <a
              class="item"
              href="https://twitter.com/_markel___/status/1828112469010596347"
              >Intel SGX Fuse Key0, a.k.a. Root Provisioning Key Was Extracted
              by Researchers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-26 @ 16:56:47</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41359152"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41359132">
          <h3>
            <a
              class="item"
              href="https://usbirdhistory.com/audubon-eating-americas-birds/"
              >Eating the Birds of America: Audubon's Culinary Reviews of
              America's Birds</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-26 @ 16:55:16</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41359132"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41358490">
          <h3>
            <a class="item" href="https://bannerify.co/tools/remove-bg"
              >Show HN: Remove-bg – open-source remove background using
              WebGPU</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-26 @ 15:58:09</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41358490"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
            <div class="text">
              <p>
                After a couple of hours, I created this and published the source
                code on
                <a href="https://github.com/ducan-ne/remove-bg"
                  >https://github.com/ducan-ne/remove-bg</a
                >
              </p>
              <p>It's still new so welcome any ideas and contributions</p>
              <p>Powered by WebGPU and Transformer.js (RMBG V1.4 model)</p>
            </div>
          </section>
        </section>
        <section id="41358020">
          <h3>
            <a class="item" href="https://hamel.dev/blog/posts/dokku/"
              >Dokku: My favorite personal serverless platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-26 @ 15:21:56</span
              ><span class="points-container"
                >Points: <span class="points">558</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41358020"
                  >Comments</a
                ><span class="descendants">: 189</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41357765">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41357765"
              >Launch HN: Parity (YC S24) – AI for on-call engineers working
              with Kubernetes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-26 @ 14:55:56</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41357765"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
            <div class="text">
              <a href="https://tryparity.com">https://tryparity.com</a>), an AI
              SRE copilot for on-call engineers working with Kubernetes. Before
              you've opened your laptop, Parity has conducted an investigation
              to triage, determine root cause, and suggest a remediation for an
              issue. You can check out a quick demo of Parity here:
              <a href="https://tryparity.com/demo"
                >https://tryparity.com/demo</a
              >
              <p>
                We met working together as engineers at Crusoe, a cloud
                provider, and we always dreaded being on-call. It meant a week
                of putting our lives and projects on hold to be prepared to
                firefight an issue at any hour of the day. We experienced
                sleepless nights after being woken up by a PagerDuty alert to
                then find and follow a runbook. We canceled plans to make time
                to sift through dashboards and logs in search of the root cause
                of downtime in our k8s cluster.
              </p>
              <p>
                After speaking with other devs and SREs, we realized we weren’t
                alone. While every team wants better monitoring systems or a
                more resilient design, the reality is that time and resources
                are often too limited to make these investments.
              </p>
              <p>
                We’re building Parity to solve this problem. We’re enabling
                engineers working with Kubernetes to more easily handle their
                on-call by using AI agents to execute runbooks and conduct root
                cause analysis. We knew LLMs could help given their ability to
                quickly process and interpret large amounts of data. But we’ve
                found that LLMs alone aren’t sufficiently capable, so we’ve
                built agents to take on more complex tasks like root cause
                analysis. By allowing on-call engineers to handle these tasks
                more easily and eventually freeing them from such
                responsibilities, we create more time for them to focus on
                complex and valuable engineering investments.
              </p>
              <p>
                We built an agent to investigate issues in Kubernetes by
                following the same steps a human would: developing a possible
                root cause, validating it with logs and metrics, and iterating
                until a well-supported root cause is found. Given a symptom like
                “we’re seeing elevated 503 errors”, our agent develops
                hypotheses as to why this may be the case, such as nginx being
                misconfigured or application pods being under-resourced. Then,
                it gathers the necessary information from the cluster to either
                support or rule out those hypotheses. These results are
                presented to the engineer as a report with a summary and each
                hypothesis. It includes all the evidence the agent considered
                when coming to a conclusion so that an engineer can quickly
                review and validate the results. With the results of the
                investigation, an on-call engineer can focus on implementing a
                fix.
              </p>
              <p>
                We’ve built an additional agent to automatically execute
                runbooks when an alert is triggered. It follows steps of a
                runbook more rigorously than an LLM alone and with more
                flexibility than workflow automation tools like Temporal. This
                agent is a combination of separate LLM agents each responsible
                for a single step of the runbook. Each runbook step agent will
                execute arbitrary instructions like “look for nginx logs that
                could explain the 503 error”. A separate LLM will evaluate the
                results, ensuring the step agent followed the instructions, and
                determines which subsequent step of the runbook to execute. This
                allows us to execute runbooks with cycles, retries, and complex
                branching conditions.
              </p>
              <p>
                With these tools, we aim to handle the “what’s going wrong” part
                of on-call for engineers. We still believe it makes the most
                sense to continue to trust engineers with actually resolving
                issues as this requires potentially dangerous or irreversible
                commands. For that reason, our agents exclusively execute
                read-only commands.
              </p>
              <p>
                If this sounds like it could be useful for you, we’d love for
                you to give the product a try! Our service can be installed in
                your cluster via a helm repo in just a couple of minutes. For
                our HN launch, we’ve removed the billing requirement for new
                accounts, so you can test it out on your cluster for free.
              </p>
              <p>We’d love to hear your feedback in the comments!</p>
            </div>
          </section>
        </section>
        <section id="41356528">
          <h3>
            <a
              class="item"
              href="https://www.nsa.gov/helpful-links/nsa-foia/declassification-transparency-initiatives/historical-releases/view/article/3880193/capt-grace-hopper-on-future-possibilities-data-hardware-software-and-people-1982/"
              >NSA releases 1982 Grace Hopper lecture</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-26 @ 12:37:32</span
              ><span class="points-container"
                >Points: <span class="points">547</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41356528"
                  >Comments</a
                ><span class="descendants">: 132</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41356239">
          <h3>
            <a
              class="item"
              href="https://blog.api-fiddle.com/posts/coolify-revolution"
              >Coolify’s rise to fame, and why it could be a big deal</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-26 @ 11:50:20</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41356239"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41355303">
          <h3>
            <a
              class="item"
              href="https://cprimozic.net/blog/fixing-a-bug-in-google-chrome/"
              >Fixing a bug in Google Chrome as a first-time contributor</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-26 @ 09:10:56</span
              ><span class="points-container"
                >Points: <span class="points">461</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41355303"
                  >Comments</a
                ><span class="descendants">: 132</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41353835">
          <h3>
            <a class="item" href="https://github.com/yetone/avante.nvim"
              >Avante.nvim: Use Your Neovim Like Using Cursor AI IDE</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-26 @ 03:44:48</span
              ><span class="points-container"
                >Points: <span class="points">245</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41353835"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41353811">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/08/23/science/helen-fisher-dead.html"
              >Helen Fisher, who researched the brain’s love circuitry, has
              died</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-26 @ 03:41:09</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41353811"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41352656">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-08-dinosaur-footprints-sides-atlantic-ocean.html"
              >Matching dinosaur footprints found on opposite sides of the
              Atlantic Ocean</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-26 @ 00:02:06</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41352656"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41349585">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/08/22/science/fossils-worms-bifungites-brazil.html"
              >Fossils are found all over, but what made them was a mystery</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-25 @ 18:03:21</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41349585"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41347635">
          <h3>
            <a
              class="item"
              href="https://blog.jonudell.net/2021/08/05/the-tao-of-unicode-sparklines/"
              >The Tao of Unicode Sparklines (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-25 @ 14:42:02</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41347635"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41347197">
          <h3>
            <a class="item" href="https://roots.io/acorn/"
              >Acorn – Use Laravel Inside WordPress</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-25 @ 13:34:31</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41347197"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41347119">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/08/25/us/cold-case-murder-investigation-police.html"
              >What it's like to work on cold cases</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-25 @ 13:23:21</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41347119"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41347051">
          <h3><a class="item" href="https://vim-racer.com/">Vim Racer</a></h3>
          <section>
            <h4>
              <span>2024-08-25 @ 13:12:13</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41347051"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41346244">
          <h3>
            <a
              class="item"
              href="https://zolagonano.github.io/blog/posts/a-very-technical-look-at-bitmessage"
              >A Technical Look at BitMessage: Learning From a Dead Project</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-25 @ 10:38:26</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41346244"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41344245">
          <h3>
            <a class="item" href="https://brooklyn.alltexts.nyc/"
              >All Texts in Brooklyn</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-25 @ 03:54:41</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41344245"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41336657">
          <h3>
            <a
              class="item"
              href="https://terathon.com/blog/poor-foundations-ga.html"
              >Poor Foundations in Geometric Algebra</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-24 @ 08:51:00</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41336657"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41330007">
          <h3>
            <a
              class="item"
              href="https://www.justice.gov/opa/pr/justice-department-sues-realpage-algorithmic-pricing-scheme-harms-millions-american-renters"
              >DOJ sues realpage for algorithmic pricing scheme that harms
              renters</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-23 @ 15:51:46</span
              ><span class="points-container"
                >Points: <span class="points">588</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41330007"
                  >Comments</a
                ><span class="descendants">: 507</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41310822">
          <h3>
            <a
              class="item"
              href="https://www.johndcook.com/blog/2024/08/17/compression-and-interpolation/"
              >Compressing data with sample points and polynomial
              interpolation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-21 @ 14:45:16</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41310822"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41310508">
          <h3>
            <a class="item" href="https://github.com/makeecat/Peng"
              >Peng – A minimal Rust-based quadrotor simulation pipeline</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-21 @ 14:13:33</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41310508"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
