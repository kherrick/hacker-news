<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36480571">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2023-06-23/commercial-real-estate-reset-is-causing-distress-from-san-francisco-to-hong-kong"
              >The World’s Empty Office Buildings Have Become a Debt Time
              Bomb</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 15:06:29</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36480571"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36480570">
          <h3>
            <a class="item" href="https://github.com/steven-tey/chathn"
              >ChatHN: Chat with Hacker News Using OpenAI Function Calling</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 15:06:26</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36480570"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36480230">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36480230"
              >Launch HN: Argonaut (YC S21) – Easily Deploy Apps and Infra to
              AWS and GCP</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 14:41:47</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36480230"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.argonaut.dev/">https://www.argonaut.dev/</a
              >), a unified platform that tries to make software ops painless,
              so teams can focus on building features instead of building and
              managing infrastructure. Argonaut combines Kubernetes PaaS, a CI
              pipeline builder, and a Terraform state manager with prebuilt AWS
              and GCP modules. Here’s a demo:
              <a href="https://www.youtube.com/watch?v=8DZsYXxA2tQ"
                >https://www.youtube.com/watch?v=8DZsYXxA2tQ</a
              >.
              <p>
                I’ve helped build infrastructure tooling from scratch at
                multiple companies and realized two things: that the shape of
                the solution with the advent of containerization, Kubernetes,
                and hyperscalers is quite similar across orgs, and that highly
                knowledgeable engineers are needed to build and manage this
                system.
              </p>
              <p>
                Internal infrastructure teams juggle a multitude of
                tasks—provisioning cloud infrastructure, configuring runtimes,
                building code, securing artifacts, running tests, and deploying
                at scale. Post-deployment, they're also tasked with monitoring
                app performance, errors, uptime, and cost visibility. It's a lot
                of work, and having to build this tooling in-house is a deep
                inefficiency in engineering teams. The root of the problem is
                that AWS and GCP provide a lower level of abstraction than the
                entities, such as environments and applications, that developers
                have to deal with, and a ton of work is getting duplicated,
                often by underfunded teams, across many orgs. Argonaut’s
                objective is to be the developer platform and control center
                that you would otherwise have to build internally.
              </p>
              <p>
                Argonaut provides an intuitive developer experience that
                simplifies working with Kubernetes and enables developer
                self-service, reducing the burden on devops and platform teams.
                We've productized this workflow orchestration, incorporating
                best practices to provide a push-to-deploy experience with
                flexible pipelines and scalable infrastructure, all within
                minutes.
              </p>
              <p>
                Our users are startups across various domains like healthcare,
                IoT, fintech, AI, and SaaS products. Over the last two years,
                we’ve enabled customers to scale their engineering teams 10x and
                manage 10+ environments in parallel without needing a dedicated
                infra/DevOps team, saving them precious time and resources.
              </p>
              <p>
                Argonaut lets you set up production-ready infrastructure and
                customize as you scale. We then let you set up automated
                deployments of your application in minutes. We offer
                configurable build-and-deploy pipelines, powered by Dagger and
                ArgoCD, and deep integration with GitHub Actions and GitLab CI.
                In addition, we support container registries, multiple cloud
                accounts, observability stacks, cost visibility providers, CDNs,
                and the entire helm chart ecosystem of Kubernetes, with more
                integrations on the way.
              </p>
              <p>
                Key features include: (1) easily create environments
                encapsulating cloud infrastructure, applications, and deployment
                pipelines (2) autoscaling deployments for apps and cronjobs to
                GCP and AWS with a progression across environments (3) compose
                deployments across multiple environments with our visual
                pipeline builder (4) get cost estimates before making infra
                changes, giving you a clear understanding of your expenses; (5)
                managed Terraform state and pre-built modules that just work,
                fostering team collaboration on infrastructure.
              </p>
              <p>
                Argonaut is self-serve, so you can sign up and start using the
                product right away:
                <a href="https://ship.argonaut.dev">https://ship.argonaut.dev</a
                >. There is a free tier that doesn't require a credit card to
                get started. We'd be delighted to have you try it, and are happy
                to help with onboarding.
              </p>
              <p>
                If your teams work with AWS, GCP, or Kubernetes, I’d love to
                hear about your experiences, pain points, and what you think a
                product like Argonaut should be able to do. Looking forward to
                your comments!
              </p>
            </div>
          </section>
        </section>
        <section id="36480122">
          <h3>
            <a class="item" href="https://text.npr.org/1184034017"
              >U.S. pedestrian deaths reach a 40-year high</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 14:33:45</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36480122"
                  >Comments</a
                ><span class="descendants">: 186</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36480007">
          <h3>
            <a
              class="item"
              href="https://twitter.com/damusapp/status/1673326463297392640"
              >Apple to Remove Nostr Damus from App Store for Bitcoin Tipping
              Feature</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 14:24:55</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36480007"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36479976">
          <h3>
            <a class="item" href="https://docs.authlib.org/en/latest/index.html"
              >Authlib: Python Authentication</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 14:21:42</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36479976"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36479974">
          <h3>
            <a
              class="item"
              href="https://www.thedrive.com/news/oregon-finally-legalizes-pumping-your-own-gas-after-72-years"
              >Oregon Finally Legalizes Pumping Your Own Gas After 72 Years</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 14:21:33</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36479974"
                  >Comments</a
                ><span class="descendants">: 116</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36479882">
          <h3>
            <a
              class="item"
              href="https://www.jeffgeerling.com/blog/2023/im-done-red-hat-enterprise-linux"
              >I'm Done with Red Hat (Enterprise Linux)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 14:12:27</span
              ><span class="points-container"
                >Points: <span class="points">180</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36479882"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36479840">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/opinions/2023/06/26/maya-shankar-juilliard-commencement-address/"
              >What my violin taught me about awe, purpose and the power in
              taking a chance</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 14:09:16</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36479840"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36479809">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/06/26/infosec_in_brief/"
              >Ex-FBI employee jailed for mishandling classified material</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 14:06:39</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36479809"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36479776">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-06-physicists-superconductivity.html"
              >Physicists discover a new switch for superconductivity</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 14:02:57</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36479776"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36479716">
          <h3>
            <a
              class="item"
              href="https://techxplore.com/news/2023-06-lasers-enable-internet-backbone-satellite.html"
              >Lasers enable satellite internet backbone, might remove need for
              deep-sea cables</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 13:57:58</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36479716"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36479683">
          <h3>
            <a
              class="item"
              href="https://people.inf.ethz.ch/omutlu/pub/RowPress_isca23.pdf"
              >RowPress: Amplifying Read Disturbance in Modern DRAM Chips
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 13:54:05</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36479683"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36479440">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2023/06/uk-police-blame-android-for-record-number-of-false-emergency-calls/"
              >Android’s emergency call shortcut is flooding dispatchers with
              false calls</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 13:30:23</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36479440"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36479387">
          <h3>
            <a
              class="item"
              href="https://www.johndcook.com/blog/2023/06/23/every-factorial-is-a-power/"
              >Every factorial is a power</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 13:24:53</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36479387"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36478892">
          <h3>
            <a class="item" href="https://faultlore.com/blah/text-hates-you/"
              >Text Rendering Hates You (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 12:32:55</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36478892"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36478734">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/articles/databricks-strikes-1-3-billion-deal-for-generative-ai-startup-mosaicml-fdcefc06"
              >Databricks Strikes $1.3B Deal for Generative AI Startup
              MosaicML</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 12:18:04</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36478734"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36478528">
          <h3>
            <a class="item" href="https://eruda.liriliri.io/"
              >Devtools for Mobile Browsers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 11:54:08</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36478528"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36478487">
          <h3>
            <a
              class="item"
              href="https://blog.marcua.net/2023/06/25/ayb-a-multi-tenant-database-that-helps-you-own-your-data.html"
              >Ayb: A multi-tenant database that helps you own your data</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 11:47:46</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36478487"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36478206">
          <h3>
            <a
              class="item"
              href="https://matan-h.com/google-has-a-secret-browser-hidden-inside-the-settings/"
              >Google has a secret browser hidden inside the settings</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 11:13:03</span
              ><span class="points-container"
                >Points: <span class="points">485</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36478206"
                  >Comments</a
                ><span class="descendants">: 173</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36477936">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/06/26/jp_morgan_fined_for_deleting/"
              >JP Morgan fined by SEC for deleting email records</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 10:31:03</span
              ><span class="points-container"
                >Points: <span class="points">235</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36477936"
                  >Comments</a
                ><span class="descendants">: 190</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36477233">
          <h3>
            <a class="item" href="https://bitsavers.org/"
              >Bitsavers Software Archive (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 08:37:55</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36477233"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36477185">
          <h3>
            <a class="item" href="https://preloved.co.id/"
              >Show HN: I built a website to buy and sell used clothes in
              Indonesia</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 08:29:49</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36477185"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36475974">
          <h3>
            <a
              class="item"
              href="https://jvns.ca/blog/2023/06/23/new-zine--how-integers-and-floats-work/"
              >How Integers and Floats Work</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 05:14:12</span
              ><span class="points-container"
                >Points: <span class="points">115</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36475974"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36475949">
          <h3>
            <a
              class="item"
              href="https://www.thehindubusinessline.com/news/goodenough-nobel-laureate-who-gave-the-world-li-ion-batteries-passes-away/article67010369.ece"
              >John Goodenough has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 05:10:23</span
              ><span class="points-container"
                >Points: <span class="points">374</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36475949"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36475852">
          <h3>
            <a
              class="item"
              href="https://inst.eecs.berkeley.edu/~cs61a/archives.html"
              >CS61A: The Structure and Interpretation of Computer Programs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 04:52:27</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36475852"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36475376">
          <h3>
            <a
              class="item"
              href="https://fortune.com/2023/06/25/irl-shutting-down-startup-admits-95-percent-of-messaging-app-users-were-fake/"
              >A messaging app startup that raised $200M shuts down afters users
              were 95% fake</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 03:21:44</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36475376"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36475081">
          <h3>
            <a class="item" href="https://github.com/mycelial/mycelite"
              >Mycelite: SQLite extension to synchronize changes across SQLite
              instances</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 02:36:26</span
              ><span class="points-container"
                >Points: <span class="points">212</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36475081"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36465886">
          <h3>
            <a
              class="item"
              href="https://utcc.utoronto.ca/~cks/space/blog/sysadmin/ReportConfigFileLocations"
              >Everything that uses configuration files should report where
              they're located</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-25 @ 07:50:11</span
              ><span class="points-container"
                >Points: <span class="points">1632</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36465886"
                  >Comments</a
                ><span class="descendants">: 441</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36465528">
          <h3>
            <a
              class="item"
              href="https://ravenmagazine.org/magazine/the-paradoxes-of-nostalgia/"
              >The Paradoxes of Nostalgia</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-25 @ 06:19:43</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36465528"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
