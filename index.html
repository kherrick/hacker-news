<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41515649">
          <h3>
            <a class="item" href="https://howmuchis13billioneuros.com"
              >Show HN: How much is 13B euros?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-11 @ 21:52:32</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41515649"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
            <div class="text">
              <p>
                I made this page to contextualize 13 billion euros (or 14): an
                amount due to Ireland in an EU Apple tax case and all over the
                airwaves here this week. I use some pretty silly
                back-of-the-envelope type calculations (the same ones also
                repeated a lot in Ireland this week!).
              </p>
              <p>
                These calculations aren't especially interesting, but at least
                they are present: you can see them, and you can change them. If
                you do - change the 13 billion to 14 billion for example,
                related numbers will flash with updates.
              </p>
              <p>
                It's an example using calculang[1]: a language for calculations,
                and an example that focuses on a close connection between
                numbers that we read or share and formulas/workings behind those
                numbers.
              </p>
              <p>
                I plan to do a separate Show HN about calculang perhaps when I
                have more docs and newer playground and gallery together, but
                Showing this page in case it's interesting, &amp; happy if there
                is feedback!
              </p>
              <p>Declan</p>
              <p>
                [0]
                <a href="https://HowMuchIs13BillionEuros.com"
                  >https://HowMuchIs13BillionEuros.com</a
                >
                repo:
                <a href="https://github.com/declann/HowMuchIs13BillionEuros.com"
                  >https://github.com/declann/HowMuchIs13BillionEuros.com</a
                >
              </p>
              <p>
                [1] <a href="https://calculang.dev">https://calculang.dev</a>
              </p>
            </div>
          </section>
        </section>
        <section id="41515304">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/pathpilot/jobs/GlywVaz-founding-engineer-ai-full-stack"
              >Pathpilot (YC S24) is hiring a founding AI and full-stack
              engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-11 @ 21:00:59</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41515101">
          <h3>
            <a
              class="item"
              href="https://blog.freecad.org/2024/09/10/the-first-release-candidate-of-freecad-1-0-is-out/comment-page-1/#comments"
              >The first release candidate of FreeCAD 1.0 is out</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-11 @ 20:29:52</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41515101"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41514944">
          <h3>
            <a
              class="item"
              href="https://ctrl-c.club/~captain/posts/2024-08-29-holy-smokes-I-Just-released-a-minigolf-game-for-palmos-in-2024.html"
              >A MiniGolf game for Palm OS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-11 @ 20:10:20</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41514944"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41514727">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2024/09/11/mistral-releases-pixtral-its-first-multimodal-model/"
              >Mistral releases Pixtral 12B, its first multimodal model</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-11 @ 19:47:10</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41514727"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41513860">
          <h3>
            <a
              class="item"
              href="https://netflixtechblog.com/noisy-neighbor-detection-with-ebpf-64b1f4b3bbdd"
              >Noisy neighbor detection with eBPF</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-11 @ 18:11:31</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41513860"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41513648">
          <h3>
            <a
              class="item"
              href="https://fractaledmind.github.io/2024/04/15/sqlite-on-rails-the-how-and-why-of-optimal-performance/"
              >SQLite on Rails: The how and why of optimal performance</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-11 @ 17:49:21</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41513648"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41512207">
          <h3>
            <a
              class="item"
              href="https://herbertlui.net/david-chang-on-the-long-hard-stupid-way/"
              >David Chang on the long, hard, stupid way</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-11 @ 15:21:02</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41512207"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41512142">
          <h3>
            <a class="item" href="https://github.com/felafax/felafax"
              >Show HN: Tune LLaMa3.1 on Google Cloud TPUs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-11 @ 15:14:44</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41512142"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
            <div class="text">
              <p>
                The problem: Right now, 90% of LLM workloads run on NVIDIA GPUs,
                but there are equally powerful and more cost-effective
                alternatives out there. For example, training and serving Llama
                3.1 on Google TPUs is about 30% cheaper than NVIDIA GPUs.
              </p>
              <p>
                But developer tooling for non-NVIDIA chipsets is lacking. We
                felt this pain ourselves. We initially tried using PyTorch XLA
                to train Llama 3.1 on TPUs, but it was rough: xla integration
                with pytorch is clunky, missing libraries (bitsandbytes didn't
                work), and cryptic HuggingFace errors.
              </p>
              <p>
                We then took a different route and translated Llama 3.1 from
                PyTorch to JAX. Now, it’s running smoothly on TPUs! We still
                have challenges ahead, there is no good LoRA library in JAX, but
                this feels like the right path forward.
              </p>
              <p>
                Here's a demo (<a href="https://dub.sh/felafax-demo"
                  >https://dub.sh/felafax-demo</a
                >) of our managed solution.
              </p>
              <p>
                Would love your thoughts on our repo and vision as we keep
                chugging along!
              </p>
            </div>
          </section>
        </section>
        <section id="41511928">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-09-scientists-magnetic-nanotech-safely-rewarm.html"
              >Scientists use magnetic nanotech to safely rewarm frozen tissues
              for transplant</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-11 @ 14:51:44</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41511928"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41510252">
          <h3>
            <a
              class="item"
              href="https://labs.watchtowr.com/we-spent-20-to-achieve-rce-and-accidentally-became-the-admins-of-mobi/"
              >We spent $20 to achieve RCE and accidentally became the admins of
              .mobi</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-11 @ 11:19:12</span
              ><span class="points-container"
                >Points: <span class="points">1109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41510252"
                  >Comments</a
                ><span class="descendants">: 267</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41509558">
          <h3>
            <a
              class="item"
              href="https://www.cartoonbrew.com/cgi/max-headroom-and-the-strange-world-of-pseudo-cgi-82745.html"
              >Max Headroom and the World of Pseudo-CGI (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-11 @ 09:11:55</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41509558"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41508752">
          <h3>
            <a class="item" href="https://github.com/jp3141/AppleWatchAmmeter"
              >AppleWatchAmmeter</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-11 @ 07:01:01</span
              ><span class="points-container"
                >Points: <span class="points">218</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41508752"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41508535">
          <h3>
            <a
              class="item"
              href="https://academic.oup.com/pnasnexus/article/3/9/pgae311/7754698"
              >Soft cells and the geometry of seashells</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-11 @ 06:20:39</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41508535"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41508530">
          <h3>
            <a
              class="item"
              href="https://crzphil.github.io/posts/ssh-obfuscation-bypass/"
              >OpenSSH Keystroke Obfuscation Bypass</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-11 @ 06:19:52</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41508530"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41508355">
          <h3>
            <a
              class="item"
              href="https://www.chiark.greenend.org.uk/~sgtatham/quasiblog/findloop/"
              >Possibly all the ways to get loop-finding in graphs wrong</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-11 @ 05:47:12</span
              ><span class="points-container"
                >Points: <span class="points">188</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41508355"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41508261">
          <h3>
            <a
              class="item"
              href="https://www.lrb.co.uk/the-paper/v46/n17/ferdinand-mount/one-way-traffic"
              >The Golden Road: How Ancient India Transformed the World</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-11 @ 05:28:23</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41508261"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41507879">
          <h3>
            <a
              class="item"
              href="https://lcamtuf.substack.com/p/the-magic-of-dc-dc-voltage-conversion"
              >The magic of DC-DC voltage conversion (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-11 @ 03:53:35</span
              ><span class="points-container"
                >Points: <span class="points">348</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41507879"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41507563">
          <h3>
            <a class="item" href="https://taconomical.com"
              >How economical is your local Taco Bell?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-11 @ 02:39:27</span
              ><span class="points-container"
                >Points: <span class="points">263</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41507563"
                  >Comments</a
                ><span class="descendants">: 282</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41505266">
          <h3>
            <a
              class="item"
              href="https://gist.github.com/thoughtpolice/9c45287550a56b2047c6311fbadebed2"
              >Some of us like "interdiff" code review</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-10 @ 20:39:51</span
              ><span class="points-container"
                >Points: <span class="points">227</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41505266"
                  >Comments</a
                ><span class="descendants">: 171</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41501747">
          <h3>
            <a class="item" href="https://build-system.fman.io/"
              >Fman Build System</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-10 @ 15:28:05</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41501747"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41490147">
          <h3>
            <a class="item" href="https://www.transparenttextures.com"
              >Transparenttextures.com</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-09 @ 16:25:46</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41490147"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41489849">
          <h3>
            <a
              class="item"
              href="https://thinking-about-science.com/2024/09/08/24-8-passive-damping-bathroom-scales/"
              >Passive damping – Bathroom scales</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-09 @ 15:58:34</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41489849"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41488738">
          <h3>
            <a class="item" href="https://github.com/yamafaktory/hypergraphz"
              >Show HN: HypergraphZ – A Hypergraph Implementation in Zig</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-09 @ 14:09:09</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41488738"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41486029">
          <h3>
            <a
              class="item"
              href="https://engineering.mixpanel.com/finding-and-optimizing-n-1-queries-on-a-relational-database-1ce02f1f2ffb"
              >Finding and optimizing N+1 queries on a relational database</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-09 @ 06:46:36</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41486029"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41485751">
          <h3>
            <a
              class="item"
              href="https://hakaimagazine.com/features/the-big-baltic-bomb-cleanup/"
              >The big Baltic bomb cleanup</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-09 @ 05:42:06</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41485751"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41484357">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Iron_gall_ink"
              >Iron Gall Ink</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-09 @ 00:10:03</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41484357"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41480957">
          <h3>
            <a
              class="item"
              href="https://bytepawn.com/quantum-entanglement-bell-inequality-python.html"
              >Breaking Bell's Inequality with Monte Carlo Simulations in
              Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-08 @ 15:28:35</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41480957"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41479887">
          <h3>
            <a class="item" href="https://tzovar.as/open-source-streetview/"
              >Openly Licensed Streetview with Panoramax</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-08 @ 11:57:05</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41479887"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41479882">
          <h3>
            <a class="item" href="https://consentomatic.au.dk/"
              >Consent-O-Matic – automatically fills ubiquitous pop-ups with
              your preferences</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-08 @ 11:56:07</span
              ><span class="points-container"
                >Points: <span class="points">274</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41479882"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
