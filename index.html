<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38687997">
          <h3>
            <a
              class="item"
              href="https://postgrest.org/en/stable/how-tos/providing-html-content-using-htmx.html"
              >PostgREST: Providing HTML Content Using Htmx</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 20:47:36</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38687997"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38687899">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2023-12-18/apple-loses-one-of-last-remaining-designers-from-jony-ive-era"
              >Apple Loses One of the Last Remaining Designers from Jony Ive
              Era</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 20:40:24</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38687899"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38687443">
          <h3>
            <a
              class="item"
              href="https://www.japantimes.co.jp/business/2023/12/18/companies/japan-tofu-maker-share-up/"
              >Tofu-maker Yamami sees shares surge after automating ancient
              craft</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 20:04:14</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38687443"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38687357">
          <h3>
            <a
              class="item"
              href="https://www.highgo.ca/2023/12/18/new-in-postgresql-16-bi-directional-logical-replication/"
              >PostgreSQL 16 Bi-Directional Logical Replication</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 19:58:02</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38687357"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38687171">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/articles/crgpjpr35nko"
              >The teenager who lives like it's the 1940s</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 19:41:34</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38687171"
                  >Comments</a
                ><span class="descendants">: 136</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38686997">
          <h3>
            <a class="item" href="https://blog.stephsmith.io/how-to-be-great/"
              >To be great, be good, repeatably (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 19:26:30</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38686997"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38686967">
          <h3>
            <a
              class="item"
              href="https://www.thedrive.com/news/vw-is-putting-buttons-back-in-cars-because-people-complained-enough"
              >VW is putting buttons back in cars</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 19:24:11</span
              ><span class="points-container"
                >Points: <span class="points">274</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38686967"
                  >Comments</a
                ><span class="descendants">: 148</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38686273">
          <h3>
            <a
              class="item"
              href="https://railsatscale.com/2023-12-04-ruby-3-3-s-yjit-faster-while-using-less-memory/"
              >Ruby 3.3's YJIT: Faster While Using Less Memory</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 18:31:50</span
              ><span class="points-container"
                >Points: <span class="points">152</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38686273"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38685607">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2023/12/18/nikola-founder-trevor-milton-sentencing-fraud-charges.html"
              >Nikola founder to be sentenced for federal fraud charges</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 17:38:06</span
              ><span class="points-container"
                >Points: <span class="points">166</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38685607"
                  >Comments</a
                ><span class="descendants">: 145</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38685598">
          <h3>
            <a
              class="item"
              href="https://flipboard.medium.com/flipboard-begins-to-federate-c56ec788feaa"
              >Flipboard Begins to Federate</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 17:37:47</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38685598"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38685458">
          <h3>
            <a
              class="item"
              href="https://research.unc.edu/2023/12/12/carolina-chemists-discover-eight-new-pfas-with-novel-testing-method/"
              >New PFAS discovered with novel testing method</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 17:27:20</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38685458"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38685393">
          <h3>
            <a class="item" href="https://fly.io/blog/fks/">Fly Kubernetes</a>
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 17:21:34</span
              ><span class="points-container"
                >Points: <span class="points">200</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38685393"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38684925">
          <h3>
            <a class="item" href="https://openreview.net/forum?id=idpCdOWtqXd60"
              >Word2Vec received 'strong reject' four times at ICLR2013</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 16:48:38</span
              ><span class="points-container"
                >Points: <span class="points">257</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38684925"
                  >Comments</a
                ><span class="descendants">: 116</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38684904">
          <h3>
            <a class="item" href="https://terrapin-attack.com"
              >Terrapin Attack for prefix truncation in SSH</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 16:47:14</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38684904"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38684724">
          <h3>
            <a class="item" href="https://github.com/pyrustic/paradict"
              >Show HN: Paradict – Streamable multi-format serialization with
              schema</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 16:30:13</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38684724"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/pyrustic/paradict"
                >https://github.com/pyrustic/paradict</a
              >), my solution for streamable multi-format serialization.
              <p>
                Although JSON, YAML, and TOML are all human-readable, they serve
                different purposes. For example, TOML is specifically designed
                for configuration files while JSON is used as a data interchange
                format.
              </p>
              <p>
                Sometimes an initiative to create a binary version of JSON
                arises and as far as I know, it ends with an unidirectional
                mapping of datatypes.
              </p>
              <p>
                There is no silver bullet, yet one coherent solution built from
                scratch that addresses multi-format (binary and textual)
                serialization and configuration files would be a step forward.
              </p>
              <p>
                Earlier this year, I accidentally designed a textual data format
                to represent complex data structures inside a document divided
                into sections. The project, namely Jesth (Just Extract Sections
                Then Hack'em), generated an interesting discussion on HN (<a
                  href="https://news.ycombinator.com/item?id=35991018"
                  >https://news.ycombinator.com/item?id=35991018</a
                >).
              </p>
              <p>
                Out of curiosity, I ran some benchmarks using Jesth, JSON and
                MessagePack, with and without Gzip compression against a large
                JSON file downloaded from the web. The benchmarking gave me
                insights that led to the decision to evolve Jesth's ideas into a
                new multi-format serialization solution.
              </p>
              <p>
                I designed and built Paradict from scratch to serialize and
                deserialize a dictionary data structure. Although Paradict's
                root data structure is a dictionary, lists, sets, and
                dictionaries can be nested within it at arbitrary depth.
              </p>
              <p>
                A Paradict dictionary can be populated with strings, binary
                data, integers, floats, complex numbers, booleans, dates, times,
                datetimes, comments, extension objects, and grids (matrices).
                There is also a schema-based validation mechanism that can
                contain programmatic checkers.
              </p>
              <p>
                The binary serialization format is designed with compactness in
                mind such as Pi with its first two decimal places, the Golden
                ratio with its first two decimal places, and the date of the
                funeral of Pope Benedict XVI would each be encoded on two bytes
                (not counting their respective 1-byte tag which starts each
                Paradict binary datum).
              </p>
              <p>
                This binary format has two levels of granularity for continuous
                data stream processing: a datum at the low level, which is in
                some cases a 2-tuple composed of a tag and its payload, and the
                message at the high level which is a dictionary data structure.
              </p>
              <p>
                The textual serialization format has two modes: data and config
                modes. Config mode implicitly treats dictionary keys as strings,
                removing the need to surround them with quotes, and unlike the
                colon (:) between a key-value pair in data mode, it uses the
                equal sign (=) as separator.
              </p>
              <p>
                This textual format has two levels of granularity for continuous
                data stream processing: a single line of text at the low level
                and the message at the high level which is a dictionary data
                structure.
              </p>
              <p>
                Here is a valid Paradict configuration document that contains a
                "user" section:
              </p>
              <p></p>
              <pre><code>  [user]
  # no comment
  id = 42
  name = 'alex'
  birthday = 2042-12-25T16:20:59Z
  photo = (bin)
      54 68 69 73 20 69 73 20 6E 6F 74 20 61 20 70 68
      6F 74 6F 67 72 61 70 68
  weight_matrix = (grid)
      1 0 1 0
      0 1 0 1
      1 0 1 0
  books = (dict)
      romance = (list)
          'Happy Place'
          'Romantic Comedy'
      sci_fi = (list)
          'Dune'
          'Neuromancer'
  epitaph = (text)
      According to the law of conservation of energy,
      no a bit of you is gone;
      you are just less orderly.
      ---
</code></pre>
              Under the hood, Paradict uses Braq (<a
                href="https://github.com/pyrustic/braq"
                >https://github.com/pyrustic/braq</a
              >), the most obvious way to section a document (as shown just
              above), and Ustrid (<a href="https://github.com/pyrustic/ustrid"
                >https://github.com/pyrustic/ustrid</a
              >), to uniquely generate string identifiers.
              <p>
                Paradict is available on PyPI and you can learn more by reading
                its README, browsing the source code or playing with its tests.
              </p>
              <p>Let me know what you think about all this !</p>
            </div>
          </section>
        </section>
        <section id="38684461">
          <h3>
            <a
              class="item"
              href="https://ashvardanian.com/posts/python-c-assembly-comparison/"
              >Python, C, Assembly – Faster Cosine Similarity</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 16:14:22</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38684461"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38684447">
          <h3>
            <a
              class="item"
              href="https://www.thenile.dev/blog/transaction-isolation-postgres"
              >Transaction Isolation in Postgres</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 16:13:46</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38684447"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38684368">
          <h3>
            <a class="item" href="https://pagedout.institute/?page=issues.php"
              >Paged Out Issue #3</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 16:09:01</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38684368"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38684102">
          <h3>
            <a
              class="item"
              href="https://lwn.net/SubscriberLink/954787/41470c731eda02a4/"
              >Progress toward a GCC-based Rust compiler</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 15:51:06</span
              ><span class="points-container"
                >Points: <span class="points">219</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38684102"
                  >Comments</a
                ><span class="descendants">: 131</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38683852">
          <h3>
            <a class="item" href="https://mtlynch.io/notes/zig-unit-test-c/"
              >Using Zig to Unit Test a C Application</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 15:36:03</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38683852"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38682964">
          <h3>
            <a class="item" href="https://github.com/thingsboard/tbmq"
              >New scalable, fault-tolerant, and efficient open-source MQTT
              broker</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 14:28:56</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38682964"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38682931">
          <h3>
            <a
              class="item"
              href="https://ericnormand.me/article/church-vs-curry-types"
              >Church vs. Curry Types</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 14:25:53</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38682931"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38681861">
          <h3>
            <a
              class="item"
              href="https://www.figma.com/blog/figma-adobe-abandon-proposed-merger/"
              >Figma and Adobe abandon proposed merger</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 13:04:34</span
              ><span class="points-container"
                >Points: <span class="points">1581</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38681861"
                  >Comments</a
                ><span class="descendants">: 779</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38681468">
          <h3>
            <a class="item" href="https://www.bl.uk/"
              >The British Library URL has been offline due to cyberattack for
              10 days</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 12:10:22</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38681468"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38681437">
          <h3>
            <a class="item" href="https://potato.cheap">The "Cheap" Web</a>
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 12:06:07</span
              ><span class="points-container"
                >Points: <span class="points">245</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38681437"
                  >Comments</a
                ><span class="descendants">: 140</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38681115">
          <h3>
            <a class="item" href="https://antonz.org/code-cells/"
              >Interactive Code Cells</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-18 @ 11:00:57</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38681115"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38672112">
          <h3>
            <a class="item" href="https://www.ventoy.net/en/index.html"
              >Ventoy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-17 @ 11:23:45</span
              ><span class="points-container"
                >Points: <span class="points">328</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38672112"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38671864">
          <h3>
            <a
              class="item"
              href="https://www.allthingsdistributed.com/2020/07/the-os-classics.html"
              >The OS Classics</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-17 @ 10:30:18</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38671864"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38671709">
          <h3>
            <a class="item" href="https://github.com/gilch/hissp">Hissp</a>
          </h3>
          <section>
            <h4>
              <span>2023-12-17 @ 09:54:32</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38671709"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38671377">
          <h3>
            <a
              class="item"
              href="https://blog.information-superhighway.net/a-forth-vocabulary-for-iteration"
              >A Forth Vocabulary for Iteration</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-17 @ 08:48:25</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38671377"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
