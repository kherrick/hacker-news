<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38526745">
          <h3>
            <a
              class="item"
              href="https://gizmodo.com/when-google-fiber-abandons-your-city-as-a-failed-experi-1833244198"
              >When Google Fiber Abandons Your City as a Failed Experiment
              (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 03:26:15</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38526745"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38526579">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-11-inoculating-soil-mycorrhizal-fungi-yield.html"
              >Study shows inoculating soil with mycorrhizal fungi can increase
              yield by 40%</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 03:02:34</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38526579"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38526349">
          <h3>
            <a
              class="item"
              href="https://www.hanselman.com/blog/coding4fun-hardware-boneyard-using-the-cuecat-with-net"
              >Before QR Codes, there was the CueCat (2006)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 02:34:55</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38526349"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38526078">
          <h3>
            <a class="item" href="https://tsdiagram.com"
              >Show HN: TSDiagram â€“ Diagrams as Code with TypeScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 02:01:35</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38526078"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
            <div class="text">
              Made an online tool for creating diagrams with TypeScript. I quite
              like it for thinking about how to shape my data, even if I end up
              using a different language in the end.
            </div>
          </section>
        </section>
        <section id="38525978">
          <h3>
            <a
              class="item"
              href="https://www.mayer.cool/writings/I-Hacked-Magic-the-Gathering/"
              >I Hacked Magic the Gathering: Arena for a 100% Win Rate</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 01:49:15</span
              ><span class="points-container"
                >Points: <span class="points">172</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38525978"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38525968">
          <h3>
            <a class="item" href="https://github.com/jepsen-io/maelstrom"
              >Maelstrom: A workbench for learning distributed systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 01:47:42</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38525968"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38525867">
          <h3>
            <a class="item" href="https://e-html.org/html/documentation.html"
              >EHTML Docs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 01:31:14</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38525867"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38525655">
          <h3>
            <a
              class="item"
              href="https://gamehistory.org/eclipse-the-demo-that-sold-3d-to-nintendo/"
              >Eclipse: The Demo that Sold 3D to Nintendo</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 00:57:56</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38525655"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38525583">
          <h3>
            <a
              class="item"
              href="https://github.com/pretzelhammer/rust-blog/blob/master/posts/common-rust-lifetime-misconceptions.md"
              >Common Rust Lifetime Misconceptions</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 00:49:35</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38525583"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38525429">
          <h3>
            <a
              class="item"
              href="https://www.cardiff.ac.uk/news/view/2782804-aspirin-and-treating-cancer"
              >Taking low-dose aspirin is associated with 20% reduction in
              cancer deaths</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-05 @ 00:32:33</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38525429"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38524599">
          <h3>
            <a class="item" href="https://github.com/anfragment/zen"
              >System-wide open source ad blocker for Mac, Windows, and Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-04 @ 23:17:22</span
              ><span class="points-container"
                >Points: <span class="points">178</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38524599"
                  >Comments</a
                ><span class="descendants">: 120</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38524595">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2312.00164"
              >Towards accurate differential diagnosis with large language
              models</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-04 @ 23:17:04</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38524595"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38523961">
          <h3>
            <a
              class="item"
              href="https://www.thedial.world/issue-10/norway-literary-scene"
              >The Norway Model: How the Scandinavian country became a literary
              powerhouse</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-04 @ 22:17:12</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38523961"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38523704">
          <h3>
            <a
              class="item"
              href="https://www.justice.gov/usao-cdca/pr/santa-barbara-county-man-sentenced-6-months-prison-obstructing-federal-probe-plane"
              >YouTuber sentenced to 6 months in prison for obstructing probe
              into plane crash</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-04 @ 21:56:15</span
              ><span class="points-container"
                >Points: <span class="points">317</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38523704"
                  >Comments</a
                ><span class="descendants">: 188</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38521998">
          <h3>
            <a class="item" href="https://github.com/KienTTran/ABMGPU"
              >Show HN: Demo of Agent Based Model on GPU with CUDA and OpenGL
              (Windows/Linux)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-04 @ 19:34:56</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38521998"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
            <div class="text">
              <p>
                Agent instances on GPU memory Uses SSBO for instanced objects
                (with GLSL 450 shaders) CUDA OpenGL interops Renders with GLFW3
                window manager Dynamic camera views in OpenGL (pan,zoom with
                mouse) Libraries installed using vcpkg
              </p>
              <p>
                (<a href="https://github.com/KienTTran/ABMGPU"
                  >https://github.com/KienTTran/ABMGPU</a
                >)
              </p>
            </div>
          </section>
        </section>
        <section id="38520901">
          <h3>
            <a
              class="item"
              href="https://moigagoo.svbtle.com/generating-random-terrains-in-enu-0-2"
              >Generating random terrains with Enu â€“ a Nim lang based
              interactive sandbox</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-04 @ 18:21:47</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38520901"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38520487">
          <h3>
            <a class="item" href="https://dogbolt.org/"
              >Dogbolt Decompiler Explorer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-04 @ 17:52:55</span
              ><span class="points-container"
                >Points: <span class="points">353</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38520487"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38519758">
          <h3>
            <a
              class="item"
              href="https://app.dover.io/Optery/careers/41840615-ceb2-4629-93a5-42d49fa8987d"
              >Optery (YC W22) â€“ data privacy â€“ is hiring a senior product
              manager (U.S.)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-04 @ 17:00:10</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38519719">
          <h3>
            <a class="item" href="https://html-lang.org/"
              >HTML, the Programming Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-04 @ 16:57:24</span
              ><span class="points-container"
                >Points: <span class="points">260</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38519719"
                  >Comments</a
                ><span class="descendants">: 124</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38519277">
          <h3>
            <a
              class="item"
              href="https://andrewpwheeler.com/2023/11/19/forecasts-need-to-have-error-bars/"
              >Forecasts need to have error bars</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-04 @ 16:28:09</span
              ><span class="points-container"
                >Points: <span class="points">285</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38519277"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38519257">
          <h3>
            <a
              class="item"
              href="https://www.troyhunt.com/a-decade-of-have-i-been-pwned/"
              >A decade of Have I Been Pwned</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-04 @ 16:26:55</span
              ><span class="points-container"
                >Points: <span class="points">547</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38519257"
                  >Comments</a
                ><span class="descendants">: 139</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38518994">
          <h3>
            <a
              class="item"
              href="https://practicalbetterments.com/switch-off-bad-tv-settings/"
              >Switch off bad TV settings</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-04 @ 16:08:32</span
              ><span class="points-container"
                >Points: <span class="points">302</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38518994"
                  >Comments</a
                ><span class="descendants">: 364</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38517550">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/technology/2023/12/04/joan-donovan-harvard-dismissal-complaint/"
              >Ousted propaganda scholar accuses Harvard of bowing to Meta</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-04 @ 14:20:37</span
              ><span class="points-container"
                >Points: <span class="points">423</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38517550"
                  >Comments</a
                ><span class="descendants">: 447</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38516913">
          <h3>
            <a class="item" href="https://www.vialibri.net/"
              >Vialibri: Physical Book Meta Search Engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-04 @ 13:26:23</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38516913"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38516795">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=38516795"
              >Launch HN: Slauth (YC S22) â€“ auto-generate secure IAM policies
              for AWS and GCP</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-04 @ 13:10:30</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38516795"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
            <div class="text">
              <a href="https://slauth.io/">https://slauth.io/</a>. Slauth.io is
              a CLI to auto-generate secure IAM policies for AWS, and GCP (Azure
              in the next few days!). We enable development teams to speed up
              creating secure policies and reduce over-permissive policies being
              deployed to the cloud.
              <p>
                Check out the video or give our open-source CLI a try with one
                of the sample repo's on
                <a href="https://github.com/slauth-io/slauth-cli"
                  >https://github.com/slauth-io/slauth-cli</a
                >
                <a
                  href="https://www.loom.com/share/bd02211659eb4c7f9b335e34094b57cb?sid=f5e84cb2-6939-4d7f-9ed8-90521c90f6de"
                  >https://www.loom.com/share/bd02211659eb4c7f9b335e34094b57cb?...</a
                >
              </p>
              <p>
                We got into the cloud access market by coincidence and were
                amazed by the amount of money spent on IAM. Current tooling such
                as <a href="http://Ermetic.com">http://Ermetic.com</a> and
                <a href="http://wiz.io/">http://wiz.io/</a> visualize IAM
                misconfigurations post deployment but don't actually change
                engineering behavior, leaving organizations in a constant loop
                of engineers deploying over-permissive policies â‡’ security
                engineers/CISO's getting alerts â‡’ Jira tickets created begging
                developers to remediate â‡’ New over-permissive policies being
                deployed again.
              </p>
              <p>
                We interviewed hundreds of developers and DevOps engineers and
                discovered two key pain points:
              </p>
              <p>
                1. *IAM is a Hassle:* Developers despise dealing with IAM
                intricacies. 2. *Speed vs. Security:* IAM was slowing them down
                in deploying quality code swiftly.
              </p>
              <p>
                So the objective is automate policy creation so that developers
                don't have to deal with it, and harden IAM security
                pre-deployment.
              </p>
              <p>
                We employ Large Language Models (currently OpenAI GPT-4) to scan
                code in any language. Through a series of prompts, we identify
                service calls and the actions required. The resource name
                receives a placeholder unless its embedded in the code. We aim
                in the future to create a static code analyzer in order to not
                send any source code to LLM's but for now using LLM's is the
                fastest way to market and somewhat accepted by the industry
                through the use of Github Copilot etc.
              </p>
              <p>
                You can use the CLI in the terminal or actually integrate it in
                your CI/CD and have it become a part of your development team
                workflow.
              </p>
              <p>Three main questions we receive</p>
              <p>
                1. *Security Concerns:* How can I trust [Slauth.io](<a
                  href="http://slauth.io/"
                  >http://slauth.io/</a
                >) to access my source code? 2. *Policy Accuracy:* How can I
                trust [Slauth.io](<a href="http://slauth.io/"
                  >http://slauth.io/</a
                >) creates the right policies? 3. *Differentiation:* How are you
                different from IAMLive, IAMBic AccessAnalyzer or Policy Sentry?
              </p>
              <p>
                To address the first concern, we don't access your code
                directly. Instead, we offer a CLI that integrates into your
                CI/CD pipeline, allowing local code scanning.
                <a href="http://slauth.io/">http://slauth.io/</a> uses your
                OpenAI key to convert the code into a secure policy, with the
                option to output results to *`stdout`* or a file for artifact
                upload and download. That does mean OpenAI has access to the
                source code located in the path you set to be scanned as we need
                to know which SDK calls are performed to generate the policies.
              </p>
              <p>
                We have extensively tested it on AWS , Typescript and GPT 4 with
                very good results (&gt;95% accuracy). We do know these
                accuracies drop when using GPT 3.5 so if possible, use GPT 4 as
                we are improving the prompts. GCP and Azure have been tested
                less but the results when using GPT 4 seem equally high. We also
                have experienced some hallucinations but they have not effected
                the outcome of a secure policy but merely the structure of how
                the policy is generated. That is not to say that it is 100%
                reliable hence we aim to provide toolings to double check
                policies through policy simulators and other means.
              </p>
              <p>
                Compared to competitors, we focus mainly on generating secure
                policies pre-deployment and automating as much as possible. We
                were inspired by IAMLive but it wasn't as scalable to use across
                development teams. Policy Sentry is great for templates but with
                <a href="http://Slauth.io">http://Slauth.io</a> you actually get
                a granular least privilege policy. Lastly, access analyzer is
                used to harden security policies which have already been
                deployed which is similar to other cloud scanning tools and
                creates a strange reactive process to security. The new
                access-analyzer feature checks policy diffs in your CDK but
                again doesn't actually generate the policy pre-deployment.
              </p>
              <p>
                We recognise some engineers are very capable of creating secure
                policies but similar to using Checkov and TFscan in the context
                of IaC deployment, we believe using Slauth.io will become a
                necessity in your CI/CD when deploying service permissions to
                make sure no IAM misconfiguration appear in the cloud.
              </p>
              <p>
                Would love to get your feedback and feel free to interact on our
                Github repo and join our Slack community.
              </p>
            </div>
          </section>
        </section>
        <section id="38516717">
          <h3>
            <a
              class="item"
              href="https://matduggan.com/why-kubernetes-needs-an-lts/"
              >Kubernetes Needs an LTS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-04 @ 13:01:43</span
              ><span class="points-container"
                >Points: <span class="points">184</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38516717"
                  >Comments</a
                ><span class="descendants">: 138</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38515387">
          <h3>
            <a class="item" href="https://blog.matthen.com"
              >Old blog of Matt Henderson, beautiful math animations</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-04 @ 09:41:45</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38515387"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38515004">
          <h3>
            <a
              class="item"
              href="https://rugu.dev/en/blog/understanding-keyboard-events/"
              >Understanding Keyboard Events Better</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-04 @ 08:35:46</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38515004"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38514121">
          <h3>
            <a
              class="item"
              href="https://utcc.utoronto.ca/~cks/space/blog/unix/KernelNameCachesWhy"
              >Why Unix kernels have grown caches for directory entries ('name
              caches')</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-04 @ 05:53:15</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38514121"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38513501">
          <h3>
            <a
              class="item"
              href="https://github.com/seveibar/pragmaticversioning"
              >Pragmatic Versioning â€“ An Alternative to Semver</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-04 @ 03:44:12</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38513501"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
