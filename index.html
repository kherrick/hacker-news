<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36187994">
          <h3>
            <a
              class="item"
              href="https://simonwillison.net/2023/Jun/4/closed-model-training/"
              >It’s infuriatingly hard to understand how closed models train on
              their input</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-04 @ 18:16:40</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36187994"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36187786">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/optery/jobs"
              >Optery (YC W22) Hiring in Sales, Marketing, Customer Success,
              Business Ops</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-04 @ 17:59:18</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36187705">
          <h3>
            <a
              class="item"
              href="https://old.reddit.com/r/LifeProTips/comments/140b6q6/rlifeprotips_will_be_going_dark_from_june_1214_in/"
              >Popular Subreddits are organizing a strike on 2023-06-12 b/c high
              API prices</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-04 @ 17:50:21</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36187705"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36187556">
          <h3>
            <a
              class="item"
              href="https://www.tribalknowledge.tech/blog/top-6-questions-about-doing-a-sql-dry-run-with-sql-simulator"
              >Show HN: SQL Dry Runs with SQL Simulator</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-04 @ 17:33:52</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36187556"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
            <div class="text">
              <p>
                It is similar in concept to Redgate SQL Clone or Windocs. If you
                are not familiar with these tools they make clones of your
                database. The key difference with SQL Simulator is, it only
                makes a clone of the database objects affected by your sql
                script, not the entire database. Nor does it copy the entire
                table (if your sql has where clauses). Once those database
                objects have been cloned, SQL Simulator then executes your
                script against the cloned database it created.
              </p>
              <p>
                For a more in depth technical overview click here:
                <a
                  href="https://docs.tribalknowledge.tech/ratifier-tutorials/sql-simulator/technical-overview"
                  >https://docs.tribalknowledge.tech/ratifier-tutorials/sql-sim...</a
                >
              </p>
              <p>
                You can download the software here:
                <a href="https://www.tribalknowledge.tech/download.html"
                  >https://www.tribalknowledge.tech/download.html</a
                >
              </p>
              <p>
                You can read the documentation here:
                <a
                  href="https://docs.tribalknowledge.tech/ratifier-tutorials/sql-simulator"
                  >https://docs.tribalknowledge.tech/ratifier-tutorials/sql-sim...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="36187550">
          <h3>
            <a
              class="item"
              href="https://privacyinternational.org/long-read/4909/wfh-watched-home-office-365-and-workplace-surveillance-creep"
              >WFH – Watched from Home: Office 365 and workplace surveillance
              creep</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-04 @ 17:33:24</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36187550"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36187174">
          <h3>
            <a class="item" href="https://www.bell-labs.com/usr/dmr/www/"
              >Dennis Ritchie’s page on Bell Labs website</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-04 @ 16:55:01</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36187174"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36187102">
          <h3>
            <a
              class="item"
              href="https://www.bazhenov.me/posts/rust-stream-vbyte-varint-decoding/"
              >Compress-a-Palooza: Unpacking 5B Varints in Only 4B CPU Cycles</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-04 @ 16:46:44</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36187102"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36186528">
          <h3>
            <a
              class="item"
              href="https://www.sambowman.co/p/democracy-is-the-solution-to-vetocracy"
              >Democracy Is the Solution to Vetocracy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-04 @ 15:47:53</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36186528"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36186466">
          <h3>
            <a
              class="item"
              href="https://www.salon.com/2023/05/29/astrophysics-and-stale-beer-what-life-is-like-working-at-the-south-pole/"
              >Atrophysics and Stale Beer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-04 @ 15:40:18</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36186466"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36186445">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/2023/06/12/child-labor-is-on-the-rise"
              >Child Labor Is on the Rise</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-04 @ 15:38:00</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36186445"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36186356">
          <h3>
            <a
              class="item"
              href="https://erikdestefanis.substack.com/p/iceland-the-emerging-tech-ecosystem"
              >Iceland: The emerging tech-ecosystem of the Nordics</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-04 @ 15:27:03</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36186356"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36186185">
          <h3>
            <a
              class="item"
              href="https://ipfs.io/ipfs/QmbpRxBZ5HDZDVRoeAU8xFYnoP4r5eGCxdkmfFW3JbA6mq/"
              >Show HN: Rarbg on IPFS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-04 @ 15:07:29</span
              ><span class="points-container"
                >Points: <span class="points">295</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36186185"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36186176">
          <h3>
            <a
              class="item"
              href="https://xeiaso.net/blog/anything-message-queue"
              >Anything can be a message queue if you use it wrongly enough</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-04 @ 15:06:51</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36186176"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36186080">
          <h3>
            <a
              class="item"
              href="https://torrentfreak.com/high-prices-make-textbook-piracy-acceptable-to-most-students-230604/"
              >High prices make textbook ‘piracy’ acceptable to most students</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-04 @ 14:56:43</span
              ><span class="points-container"
                >Points: <span class="points">176</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36186080"
                  >Comments</a
                ><span class="descendants">: 140</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36186047">
          <h3>
            <a
              class="item"
              href="https://keith-mcnulty.medium.com/was-this-the-most-dangerous-childrens-toy-ever-2bb31607b9a8"
              >Was this the most dangerous children's toy?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-04 @ 14:53:38</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36186047"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36185817">
          <h3>
            <a
              class="item"
              href="https://quuxplusone.github.io/blog/2023/06/02/not-so-quick-pmr/"
              >A not-so-quick introduction to the C++ allocator model</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-04 @ 14:22:47</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36185817"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36185218">
          <h3>
            <a
              class="item"
              href="https://www.outsideonline.com/culture/essays-culture/peter-kaestner-birder/"
              >A birder's quest to see 10k species</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-04 @ 12:50:39</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36185218"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36185173">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/science/2023/jun/04/lung-cancer-pill-cuts-risk-of-death-by-half-says-thrilling-study"
              >Lung cancer pill cuts risk of death by half</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-04 @ 12:41:30</span
              ><span class="points-container"
                >Points: <span class="points">190</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36185173"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36184838">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2305.15614"
              >Reverse Engineering Self-Supervised Learning</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-04 @ 11:43:46</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36184838"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36184417">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=xUezfuy8Qpc"
              >Rowan Atkinson on free speech (2012) [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-04 @ 10:10:16</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36184417"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36184400">
          <h3>
            <a
              class="item"
              href="https://developer.apple.com/documentation/virtualization"
              >Apple Virtualization Framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-04 @ 10:06:59</span
              ><span class="points-container"
                >Points: <span class="points">215</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36184400"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36184078">
          <h3>
            <a class="item" href="http://www.quiss.org/boo/"
              >A new line drawing method for the cycle savvy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-04 @ 08:44:32</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36184078"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36183824">
          <h3>
            <a
              class="item"
              href="https://www.afnic.fr/wp-media/uploads/2023/05/ga-domain-names-soon-to-return-to-Gabonese-management-1.pdf"
              >.ga domain names soon to return to Gabonese management (from
              Freenom) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-04 @ 07:48:06</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36183824"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36183788">
          <h3>
            <a
              class="item"
              href="https://www.alpharail.co.nz/why-do-railway-tracks-have-crushed-stones-alongside-them/"
              >Why do railway tracks have crushed stones alongside them?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-04 @ 07:36:58</span
              ><span class="points-container"
                >Points: <span class="points">445</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36183788"
                  >Comments</a
                ><span class="descendants">: 194</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36183776">
          <h3>
            <a
              class="item"
              href="https://blog.oup.com/2017/06/repetition-linguistics/"
              >How to use repetition (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-04 @ 07:34:10</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36183776"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36183754">
          <h3>
            <a
              class="item"
              href="https://randalolson.com/2014/05/24/chess-tournament-matches-and-elo-ratings/?ref=thebrowser.com"
              >Chess Tournament Games and Elo Ratings (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-04 @ 07:27:36</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36183754"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36183683">
          <h3>
            <a class="item" href="https://github.com/TodePond/DreamBerd"
              >DreamBerd is a perfect programming language</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-04 @ 07:07:46</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36183683"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36177756">
          <h3>
            <a
              class="item"
              href="https://www.techspot.com/news/98932-msi-reveals-first-usb4-expansion-card-delivering-100w.html"
              >MSI reveals first USB4 expansion card, delivering 100W through
              USB-C</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-03 @ 16:03:47</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36177756"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36176844">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/articles/inside-atomic-tourism-c834b3f4"
              >Atomic Tourism</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-03 @ 14:13:50</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36176844"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36170061">
          <h3>
            <a
              class="item"
              href="https://palant.info/2023/06/02/how-malicious-extensions-hide-running-arbitrary-code/"
              >How Malicious extensions hide running arbitrary code</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-02 @ 20:05:29</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36170061"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
