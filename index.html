<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36714702">
          <h3>
            <a
              class="item"
              href="https://catvalente.substack.com/p/mark-fking-zuckerberg-is-not-your"
              >Mark F** Zuckerberg Is Not Your Friend</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-13 @ 19:23:58</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36714228">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-07-age-universe-billion-years-previously.html"
              >Age of universe at 26.7B years, nearly twice as old as previously
              believed</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-13 @ 18:51:38</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36714228"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36714139">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2023/07/13/cowboy-rides-to-the-rescue-of-vanmoof-owners-with-app-to-unlock-threatened-bikes/"
              >Cowboy rides to the rescue of VanMoof owners with app to unlock
              threatened bikes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-13 @ 18:45:41</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36714139"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36713847">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/opinion/articles/2023-07-13/celsius-was-lying"
              >Celsius Was Lying</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-13 @ 18:25:55</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36713847"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36713737">
          <h3>
            <a
              class="item"
              href="https://developer.chrome.com/blog/new-in-chrome-115/"
              >New in Chrome 115</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-13 @ 18:17:54</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36713737"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36713375">
          <h3>
            <a
              class="item"
              href="https://www.perfectrec.com/posts/is-apple-making-implausible-iphone-satisfaction-claims"
              >Is Apple making implausible iPhone satisfaction claims?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-13 @ 17:57:06</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36713375"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36713037">
          <h3>
            <a
              class="item"
              href="https://blog.lon.tv/2023/07/10/the-fcc-responds-to-my-atsc-3-encryption-complaint-they-want-to-hear-from-you/"
              >The FCC responds to my ATSC 3 encryption complaint – they want to
              hear from you</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-13 @ 17:38:53</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36713037"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36712788">
          <h3>
            <a
              class="item"
              href="https://fingerprint.com/blog/apple-macos-mdns-brute-force/"
              >Brute-forcing a macOS user’s real name from a browser using
              mDNS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-13 @ 17:24:22</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36712788"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36712564">
          <h3>
            <a
              class="item"
              href="https://andreaskambanis.com/google-play-store-pre-registration-campaigns/"
              >We spent $20k on Google Play pre-registration ads</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-13 @ 17:10:22</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36712564"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36712497">
          <h3>
            <a
              class="item"
              href="https://fy.blackhats.net.au/blog/2023-02-02-how-hype-will-turn-your-security-key-into-junk/"
              >Passkeys will come at a cost</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-13 @ 17:06:08</span
              ><span class="points-container"
                >Points: <span class="points">193</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36712497"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36712414">
          <h3>
            <a class="item" href="https://flexport.com/careers"
              >Flexport (YC W14) is hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-13 @ 17:00:32</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36712388">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/legal/us-judge-says-sec-lawsuit-vs-ripple-labs-can-proceed-trial-some-claims-2023-07-13/"
              >Ripple notches win in SEC case over XRP cryptocurrency</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-13 @ 16:58:17</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36712388"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36711799">
          <h3>
            <a
              class="item"
              href="https://rafmetman.wordpress.com/meteorology/ww2-meteorology/"
              >WW2 Meteorology</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-13 @ 16:25:37</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36711799"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36711033">
          <h3>
            <a
              class="item"
              href="https://www.phoronix.com/review/amd-ryzen7040-avx512"
              >AMD Ryzen 7040 Series Shows Great AVX-512 Performance for Laptops
              / Mobile</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-13 @ 15:42:10</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36711033"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36710558">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/markets/us-sec-sues-celsius-network-its-founder-2023-07-13/"
              >Founder of crypto lender Celsius Network arrested, charged with
              fraud</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-13 @ 15:16:14</span
              ><span class="points-container"
                >Points: <span class="points">268</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36710558"
                  >Comments</a
                ><span class="descendants">: 210</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36710266">
          <h3>
            <a
              class="item"
              href="https://ruurtjan.medium.com/understanding-kafka-with-factorio-74e8fc9bf181"
              >Understanding Kafka with Factorio (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-13 @ 15:00:16</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36710266"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36710102">
          <h3>
            <a
              class="item"
              href="https://www.uber.com/blog/neural-networks-jpeg/"
              >Faster neural networks straight from JPEG (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-13 @ 14:51:25</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36710102"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36709895">
          <h3>
            <a
              class="item"
              href="https://blog.google/products/bard/google-bard-new-features-update-july-2023/"
              >Bard’s latest update: more features, languages and countries</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-13 @ 14:40:30</span
              ><span class="points-container"
                >Points: <span class="points">196</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36709895"
                  >Comments</a
                ><span class="descendants">: 147</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36709593">
          <h3>
            <a
              class="item"
              href="https://www.martinfowler.com/articles/designDead.html"
              >Is Design Dead? (2004)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-13 @ 14:22:18</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36709593"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36709361">
          <h3>
            <a
              class="item"
              href="https://blog.rust-lang.org/2023/07/13/Rust-1.71.0.html"
              >Rust 1.71.0</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-13 @ 14:06:23</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36709361"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36708907">
          <h3>
            <a
              class="item"
              href="https://github.com/ory/kratos/releases/tag/v1.0.0"
              >Ory Kratos v1.0 with passkeys, MFA and multi-region</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-13 @ 13:37:21</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36708907"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36708511">
          <h3>
            <a class="item" href="https://cyber.dabamos.de/unix/x11/"
              >Cool, but obscure X11 tools (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-13 @ 13:06:23</span
              ><span class="points-container"
                >Points: <span class="points">244</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36708511"
                  >Comments</a
                ><span class="descendants">: 193</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36707877">
          <h3>
            <a class="item" href="https://sevag.xyz/free-music-demixer/"
              >Show HN: Free AI-based music demixing in the browser</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-13 @ 12:03:36</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36707877"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
            <div class="text">
              <p>
                I've spent some time working on music demixing or music source
                separation algorithms, which take in a mixed song and output
                estimates of isolated components (e.g. vocals, drums, bass,
                other).
              </p>
              <p>
                I took a popular PyTorch model with good performance
                (Open-Unmix, UMX-L weights), reimplemented the inference steps
                in C++, and compiled it to WebAssembly for a free client-side
                music demixer.
              </p>
            </div>
          </section>
        </section>
        <section id="36707510">
          <h3>
            <a class="item" href="https://github.com/zhuowei/DSReality"
              >DSReality: Turns a DS game into a 3D image that floats above your
              controller</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-13 @ 11:21:16</span
              ><span class="points-container"
                >Points: <span class="points">187</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36707510"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36706453">
          <h3>
            <a
              class="item"
              href="https://www.openttd.org/news/2023/07/08/our-infrastructure"
              >OpenTTD's Infrastructure in 2023</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-13 @ 08:42:31</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36706453"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36706138">
          <h3>
            <a
              class="item"
              href="https://www.businessinsider.com/hollywood-streamers-oppose-ftc-proposal-regulation-click-to-cancel-subscription-2023-7"
              >Disney, Netflix, and More Are Fighting FTC's 'Click to Cancel'
              Proposal</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-13 @ 07:42:58</span
              ><span class="points-container"
                >Points: <span class="points">532</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36706138"
                  >Comments</a
                ><span class="descendants">: 237</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36705609">
          <h3>
            <a class="item" href="https://dt.plumbing/"
              >Dt: Duck tape for your Unix pipes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-13 @ 06:20:05</span
              ><span class="points-container"
                >Points: <span class="points">189</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36705609"
                  >Comments</a
                ><span class="descendants">: 123</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36705223">
          <h3>
            <a class="item" href="https://github.com/rexdex/recompiler"
              >Xbox360 –&amp;gt; Windows Executable Converter (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-13 @ 05:08:28</span
              ><span class="points-container"
                >Points: <span class="points">175</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36705223"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36682012">
          <h3>
            <a class="item" href="https://codspeed.io/"
              >Show HN: CodSpeed – Continuous Performance Measurement</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-11 @ 15:02:20</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36682012"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <p>
                Today, the go to solution to measure performance is probably to
                use an APM(DataDog, Sentry, …), continuously analyzing your
                production environment. However, since those solutions are
                operating on real environments they need real users to
                experience poor performance in order to report issues and
                unfortunately, performance remains an afterthought appearing
                only at the end of the development cycle.
              </p>
              <p>
                Another possibility to measure performance is to create
                benchmarks while developing and to run them on a regular basis
                to have an idea of the performance trend of your project.
                However, with this approach, the variance in the results creates
                a lot of noise and it’s rarely possible to compare your results
                with the ones from a co-worker or a production environment.
              </p>
              <p>
                To make consistent performance measurement as easy as unit
                testing and fully integrated in CI workflows, we chose a
                benchmark based solution. And, to eliminate the usual variance
                associated with running them, we measure the number of
                instructions and memory/cache accesses through CPU
                instrumentation performed with Valgrind. This approach gives
                repeatable and consistent results that couldn’t be obtained with
                a time based statistical approach, especially in extremely noisy
                CI and cloud environments.
              </p>
              <p>
                We have been in closed beta for a few months, already being used
                by popular open-source projects such as Prisma and Pydantic.
                Notably, CodSpeed helped Pydantic through their Rust migration,
                empowering them to make the library 17x faster:
                <a
                  href="https://docs.pydantic.dev/latest/blog/pydantic-v2/#performance"
                  >https://docs.pydantic.dev/latest/blog/pydantic-v2/#performan...</a
                >
              </p>
              <p>
                Today, we’re super excited to finally make the product available
                to everyone. We currently support Python, Node.js and Rust and
                are looking forward to integrate with more languages soon.
              </p>
              <p>
                The product is and will be free forever for open-source
                projects. Also, we have a per-seat pricing for private
                repository usage. We have a lot of exciting features planned
                regarding additional integrations, such as Database and GPU
                integrations that should come in upcoming months.
              </p>
              <p>
                Don’t hesitate to try out the product and give your honest
                feedback. We’re looking forward to your comments!
              </p>
            </div>
          </section>
        </section>
        <section id="36679763">
          <h3>
            <a class="item" href="https://tailscale.dev/blog/tsup-tsnet"
              >The subtle magic of tsnet</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-11 @ 12:01:14</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36679763"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
