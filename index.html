<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36035641">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/europe-break-encryption-leaked-document-csa-law/"
              >Leaked government document shows Spain wants to ban end-to-end
              encryption</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 19:31:47</span
              ><span class="points-container"
                >Points: <span class="points">3</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36035641"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36034929">
          <h3>
            <a
              class="item"
              href="https://stackoverflow.blog/2023/05/22/modern-work-requires-attention-constant-alerts-steal-it/"
              >Modern work requires attention – constant alerts steal it</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 18:28:40</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36034929"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36034855">
          <h3>
            <a
              class="item"
              href="https://www.architecturaldigest.com/story/what-it-was-like-to-live-inside-habitat-67"
              >What It Was Like to Live Inside Habitat 67</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 18:23:25</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36034855"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36034726">
          <h3>
            <a
              class="item"
              href="https://www.mrdbourke.com/what-if-you-did-the-exact-opposite-like-the-rogue-bees-do/"
              >What if you did the exact opposite, like rogue bees do (2020)</a
            >
          </h3>
        </section>
        <section id="36034211">
          <h3>
            <a
              class="item"
              href="https://github.com/facebookresearch/fairseq/tree/main/examples/mms"
              >Meta AI announces Massive Multilingual Speech code, models for
              1000+ languages</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 17:27:05</span
              ><span class="points-container"
                >Points: <span class="points">153</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36034211"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36033433">
          <h3>
            <a
              class="item"
              href="https://9to5mac.com/2023/05/22/iphone-maker-wistron-quits/"
              >iPhone maker Wistron quits, saying Apple didn't let it make a
              profit</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 16:23:16</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36033433"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36033369">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41593-023-01333-4"
              >Ethical, societal implications of genome-wide behavioral,
              brain-related traits</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 16:18:51</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36033369"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36033151">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/us-news/2023/may/22/colorado-river-states-california-arizona-nevada"
              >Breakthrough deal to prevent Colorado River from drying up</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 16:02:08</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36033151"
                  >Comments</a
                ><span class="descendants">: 132</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36032564">
          <h3>
            <a
              class="item"
              href="https://thehustle.co/why-salvador-dali-is-the-most-faked-artist-in-the-world/"
              >Salvador Dalí is the most faked artist?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 15:17:34</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36032564"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36032224">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36032224"
              >Ask HN: Is anyone hosting their own Jitsi server?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 14:54:32</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36032224"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
            <div class="text"><p>https://jitsi.org/</p></div>
          </section>
        </section>
        <section id="36032081">
          <h3>
            <a class="item" href="https://github.com/psychic-api/psychic"
              >Show HN: Psychic - An open-source data integration platform for
              AI startups</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 14:41:47</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36032081"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <p>
                For example, we know that the pain of building new API
                integrations scales with the fragmentation in the industry. In
                the current meta, we see this pain with a lot of AI startups who
                invariably need to connect to their customers data, but have to
                support 50+ integrations before they even scale to 50+
                customers.
              </p>
              <p>
                This is the process for an AI startup to add a new integration
                for a customer:
              </p>
              <p>
                - Pore over the API docs for each source application and write a
                connector for each - Play email tag to find the right
                stakeholders and get them to share sensitive API keys, or give
                them an OAuth app. It can take 6+ weeks for some platforms to
                review new OAuth apps - Normalize data that arrives in a
                different formats from each source (HTML, XML, text dumps, 3
                different flavors of markdown, JSON, etc) - Figure out what data
                should be vectorized, what should be stored as SQL, and what
                should be discarded - Detect when data has been updated and
                synchronize it - Monitor when pipelines break so data doesn’t go
                stale
              </p>
              <p>
                This is a LOT of work for something that doesn’t move the needle
                on product quality, so it’s no wonder that most startups are
                still relying on file uploads to onboard their early customers.
                The problem is file uploads are slow and insecure and don't
                scale.
              </p>
              <p>
                That’s why we built Psychic.dev to be the fastest and most
                secure way for startups to connect to their customer’s data. You
                integrate once with our universal APIs and get N integrations
                with CRMs, knowledge bases, ticketing systems and more with no
                incremental engineering effort.
              </p>
              <p>
                We abstract away the quirks of each data source into Document
                and Conversation data models, and try to find a good balance to
                allow deep integrations while preserving general purpose
                utility. Since it’s open source, we encourage founders to fork
                and extend our data models to fit their needs as they evolve,
                even if it means migrating off our paid version.
              </p>
              <p>
                To see an example in action, check out our demo repo here:
                <a
                  href="https://github.com/psychic-api/psychic-langchain-tutorial/"
                  >https://github.com/psychic-api/psychic-langchain-tutorial/</a
                >
              </p>
              <p>
                We are also open source and open to contributions, learn more at
                docs.psychic.dev or by emailing us at founders@psychic.dev!
              </p>
            </div>
          </section>
        </section>
        <section id="36032039">
          <h3>
            <a class="item" href="https://www.joesfer.com/?p=108"
              >Stippling and Blue Noise (2011)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 14:38:45</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36032039"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36031446">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/some-neural-networks-learn-language-like-humans-20230522/"
              >Parallels in the ways that humans and ML models acquire language
              skills</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 13:48:53</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36031446"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36030959">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-05-black-holes-defects-spacetime.html"
              >Black holes might be defects in spacetime</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 13:08:02</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36030959"
                  >Comments</a
                ><span class="descendants">: 180</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36030958">
          <h3>
            <a
              class="item"
              href="https://nick-black.com/dankwiki/index.php/Io_uring"
              >Io uring</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 13:07:56</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36030958"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36030937">
          <h3>
            <a class="item" href="https://github.com/lem-project/lem"
              >Lem v2.0.0 – Common Lisp IDE with high expansibility</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 13:05:21</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36030937"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36030866">
          <h3>
            <a class="item" href="https://jsonjoy.com/blog/list-crdt-benchmarks"
              >CRDT Benchmarks</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 12:59:19</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36030866"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36029915">
          <h3>
            <a
              class="item"
              href="https://blog.mikrotik.com/security/cve-2023-32154.html"
              >RCE on MikroTik routers with IPv6 RA enabled</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 11:12:43</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36029915"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36029368">
          <h3>
            <a
              class="item"
              href="https://jax.readthedocs.io/en/latest/pytrees.html"
              >Pytrees</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 10:05:14</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36029368"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36029221">
          <h3>
            <a
              class="item"
              href="https://hakibenita.com/the-many-faces-of-distinct-in-postgre-sql"
              >The many faces of DISTINCT in Postgres (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 09:46:19</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36029221"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36029115">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Wikipedia:Wikipedia_Signpost/2023-05-22/News_and_notes"
              >Severance payments at Wikimedia Foundation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 09:31:16</span
              ><span class="points-container"
                >Points: <span class="points">275</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36029115"
                  >Comments</a
                ><span class="descendants">: 214</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36029087">
          <h3>
            <a class="item" href="https://samwho.dev/memory-allocation/"
              >Memory Allocation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 09:26:22</span
              ><span class="points-container"
                >Points: <span class="points">815</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36029087"
                  >Comments</a
                ><span class="descendants">: 118</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36029032">
          <h3>
            <a class="item" href="https://brr.fyi/posts/polar-night"
              >Polar Night</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 09:15:20</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36029032"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36028845">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/articles/meta-fined-1-3-billion-over-data-transfers-to-u-s-b53dbb04"
              >Meta fined $1.3B over data transfers to U.S.</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 08:42:00</span
              ><span class="points-container"
                >Points: <span class="points">519</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36028845"
                  >Comments</a
                ><span class="descendants">: 348</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36023558">
          <h3>
            <a
              class="item"
              href="https://riskmusings.substack.com/p/success-to-the-successful"
              >Success to the successful</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-21 @ 18:31:33</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36023558"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36023306">
          <h3>
            <a
              class="item"
              href="https://bartwullems.blogspot.com/2023/05/lehmans-laws-of-software-evolution.html"
              >Lehman’s Laws of Software Evolution</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-21 @ 18:03:34</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36023306"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36022896">
          <h3>
            <a
              class="item"
              href="https://spin.atomicobject.com/2023/05/21/nonfiction-business-books/"
              >Building a Better Book Club: A Strategy for Efficiently Ingesting
              Nonfiction</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-21 @ 17:11:57</span
              ><span class="points-container"
                >Points: <span class="points">2</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36022896"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36022373">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/tech/annals-of-technology/demon-core-the-strange-death-of-louis-slotin"
              >The Demon Core and the Strange Death of Louis Slotin (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-21 @ 16:14:03</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36022373"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36020520">
          <h3>
            <a
              class="item"
              href="https://medium.com/tebs-lab/deep-neural-networks-as-computational-graphs-867fcaa56c9"
              >Deep neural networks as computational graphs (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-21 @ 13:09:36</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36020520"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36016774">
          <h3>
            <a
              class="item"
              href="http://www.bitsavers.org/pdf/onr/Digital_Computer_Newsletter/"
              >ONR Digital Computer Newsletter (1949-64)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-21 @ 00:12:40</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36016774"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
