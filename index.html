<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43763688">
          <h3>
            <a
              class="item"
              href="https://clickhouse.com/blog/clickhouse-gets-lazier-and-faster-introducing-lazy-materialization"
              >ClickHouse gets lazier (and faster): Introducing lazy
              materialization</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-22 @ 16:03:32</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43763688"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43763614">
          <h3>
            <a
              class="item"
              href="https://uwplse.org/2025/03/31/Algebraic-Knitting.html"
              >Algebraic Semantics for Machine Knitting</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-22 @ 15:55:12</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43763614"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43763291">
          <h3>
            <a class="item" href="https://math.ucr.edu/home/baez/surprises.html"
              >Surprises in Logic (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-22 @ 15:24:53</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43763291"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43763225">
          <h3>
            <a
              class="item"
              href="https://finance.yahoo.com/news/exclusive-supabase-raises-200-million-112154867.html"
              >Supabase raises $200M Series D at $2B valuation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-22 @ 15:17:23</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43763225"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43763223">
          <h3>
            <a
              class="item"
              href="https://www.damtp.cam.ac.uk/user/tong/books.html"
              >David Tong Lectures on Theoretical Physics</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-22 @ 15:17:21</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43763223"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43763026">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=43763026"
              >Launch HN: Infra.new (YC W23) – DevOps copilot with guardrails
              built in</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-22 @ 14:59:53</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43763026"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
            <div class="text">
              <a href="https://infra.new/">https://infra.new/</a>), a DevOps
              Copilot that can configure and deploy apps on AWS, GCP, and Azure
              using Terraform and GitHub Actions.
              <p>
                You start by describing your infrastructure needs in detail and
                optionally attach any source code. The agent will clarify your
                requirements and either execute the task immediately or generate
                a plan with step-by-step instructions for you to approve. Once
                you’re happy with the changes, export everything to GitHub or
                let the agent provision it in your cloud account. Here’s a quick
                demo of deploying a new app to GCP / AWS:
                <a
                  href="https://www.loom.com/share/4627b3cd96cc439e9981a38363b7f6f7"
                  >https://www.loom.com/share/4627b3cd96cc439e9981a38363b7f6f7</a
                >
              </p>
              <p>
                Why build a new coding agent when there are good ones already
                out there? We believe there’s room for a new agent that is
                specifically built for DevOps tasks since the risks are much
                higher – it's easy to rollback AI-related errors in a web app,
                but fixing a misconfigured database is not nearly as easy. By
                focusing specifically on cloud infra, we can provide all the
                visibility and checks you need to feel confident in your
                configuration changes.
              </p>
              <p>
                At our previous jobs, we built an internal data / ML platform at
                Google Life Sciences that involved migrating off of internal
                Google infrastructure to the public cloud (GCP). We quickly
                learned how complicated it can be to configure cloud
                infrastructure well, even for seemingly simple tasks.
                Configuring an app with CI/CD requires knowledge of multiple
                infra tools, cloud services, and best practices. Mistakes can be
                costly and diagnosing issues can send you down a rabbit hole of
                cloud docs.
              </p>
              <p>
                Our goal is to help engineers feel confident when making changes
                in their cloud. We designed the workflow to start with a prompt,
                a template, or a GitHub repository. After clarifying your
                requirements, the agent will start generating IaC, CI/CD, and
                other configurations using the latest docs, public Terraform
                Registries, and a set of best practices we dynamically load into
                the context window.
              </p>
              <p>
                All changes are run through static analysis to detect
                hallucinations, estimate cost changes, and visualize your
                infrastructure components as you go. Once you’re happy with the
                changes, you can export everything to GitHub for review. You
                also have the option to deploy directly to your cloud from the
                workspace and let the agent diagnose any deployment issues. The
                deployment flow is "pseudo-deterministic" in that it follows a
                checklist of human-guided instructions that help it stay in
                bounds, but we still recommend only using this feature for dev
                environments and using GitOps for any changes to production.
              </p>
              <p>
                The current plan is to continue adding support for more tools
                (Kubernetes and GitLab are next) and we may add a CLI that lets
                you bring the agent into your local workspace.
              </p>
              <p>We’d love to hear your feedback and ideas!</p>
            </div>
          </section>
        </section>
        <section id="43762451">
          <h3>
            <a
              class="item"
              href="https://pubs.aip.org/aip/adv/article/15/4/045222/3344017/Using-physics-simulations-to-find-targeting"
              >Using physics simulations to find targeting strategies in tenpin
              bowling</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-22 @ 14:14:28</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43762451"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43762409">
          <h3>
            <a class="item" href="https://github.com/akdeb/ElatoAI"
              >I Open-Sourced My AI Toy Company That Runs on ESP32 and OpenAI
              Realtime API</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-22 @ 14:10:59</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43762409"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43761998">
          <h3>
            <a class="item" href="https://www.hey.earth/posts/duckdb-doom"
              >Abusing DuckDB-WASM by making SQL draw 3D graphics (Sort Of)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-22 @ 13:35:47</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43761998"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43761976">
          <h3>
            <a
              class="item"
              href="https://www.w3.org/blog/2025/join-the-w3c-exploration-interest-group-where-standards-start/"
              >Join the W3C Exploration Interest Group: where standards start</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-22 @ 13:34:27</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43761976"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43761835">
          <h3>
            <a
              class="item"
              href="https://madhavajay.com/the-cold-start-problem-using-network-effects-to-scale-your-product/"
              >The Cold Start Problem: Using Network Effects to Scale Your
              Product – A Review</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-22 @ 13:24:52</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43761835"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43761633">
          <h3>
            <a
              class="item"
              href="https://technologizer.com/home/2025/04/22/pc-connection-ads-raccoons/"
              >The raccoons who made computer magazine ads great</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-22 @ 13:06:30</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43761633"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43761119">
          <h3>
            <a class="item" href="https://givecampus.breezy.hr/p/0c4a97691730"
              >GiveCampus (YC S15) Is Hiring Sr engineers passionate about
              education</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-22 @ 12:00:06</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43760626">
          <h3>
            <a class="item" href="https://serenityos.org/"
              >SerenityOS is a love letter to '90s user interfaces</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-22 @ 10:24:43</span
              ><span class="points-container"
                >Points: <span class="points">150</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43760626"
                  >Comments</a
                ><span class="descendants">: 152</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43760625">
          <h3>
            <a class="item" href="https://limit-of-rlvr.github.io/"
              >Does RL Incentivize Reasoning in LLMs Beyond the Base Model?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-22 @ 10:24:37</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43760625"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43759513">
          <h3>
            <a
              class="item"
              href="https://nwktimes.blogspot.com/2025/04/ai-for-network-engineers-understanding.html"
              >AI for Network Engineers: Understanding Flow, Flowlet, and
              Packet-Based LB</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-22 @ 06:15:49</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43759513"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43759436">
          <h3>
            <a
              class="item"
              href="https://www.fujitsu.com/global/about/resources/news/press-releases/2025/0422-01.html"
              >Fujitsu and RIKEN develop world-leading 256-qubit sup quantum
              computer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-22 @ 05:59:28</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43759436"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43759073">
          <h3>
            <a
              class="item"
              href="https://blog.videah.net/attacking-my-landlords-boiler/"
              >Attacking My Landlord's Boiler</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-22 @ 04:27:40</span
              ><span class="points-container"
                >Points: <span class="points">293</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43759073"
                  >Comments</a
                ><span class="descendants">: 158</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43758999">
          <h3>
            <a class="item" href="https://mcr21.org.uk/"
              >Welcome to our website for the 1963 BBC MCR21 OB Van</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-22 @ 04:07:04</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43758999"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43757341">
          <h3>
            <a
              class="item"
              href="https://github.com/maurymarkowitz/101-BASIC-Computer-Games"
              >101 BASIC Computer Games</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-21 @ 22:47:38</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43757341"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43757037">
          <h3>
            <a class="item" href="https://github.com/ericjenott/Evertop"
              >Evertop: E-ink IBM XT clone with 100+ hours of battery life</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-21 @ 22:07:49</span
              ><span class="points-container"
                >Points: <span class="points">499</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43757037"
                  >Comments</a
                ><span class="descendants">: 164</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43754953">
          <h3>
            <a
              class="item"
              href="https://blog.infected.systems/posts/2025-04-21-this-blog-is-hosted-on-a-nintendo-wii/"
              >Blog hosted on a Nintendo Wii</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-21 @ 18:29:04</span
              ><span class="points-container"
                >Points: <span class="points">568</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43754953"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43754124">
          <h3>
            <a class="item" href="https://github.com/nari-labs/dia"
              >Show HN: Dia, an open-weights TTS model for generating realistic
              dialogue</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-21 @ 17:07:07</span
              ><span class="points-container"
                >Points: <span class="points">581</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43754124"
                  >Comments</a
                ><span class="descendants">: 169</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43745987">
          <h3>
            <a class="item" href="https://github.com/secure-foundations/verus"
              >Verus: Verified Rust for low-level systems code</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-20 @ 19:38:29</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43745987"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43745038">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2025-04-handheld-detector-ionizing-safety.html"
              >Handheld detector for all types of ionizing radiation improves
              radiation safety</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-20 @ 17:13:22</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43745038"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43740543">
          <h3>
            <a
              class="item"
              href="https://nautil.us/living-with-lab-mice-1202657/"
              >Living with Lab Mice</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-20 @ 00:20:16</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43740543"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43737916">
          <h3>
            <a class="item" href="https://github.com/mkaz/libro"
              >Libro: a command-line tool to track your books</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-19 @ 17:33:05</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43737916"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43735960">
          <h3>
            <a
              class="item"
              href="https://depts.washington.edu/uwrainlab/wordpress/wp-content/uploads/2020/01/AIAA_SciTech_2020.pdf"
              >A Real-Time Algorithm for Non-Convex Powered Descent Guidance
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-19 @ 12:25:58</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43735960"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43734938">
          <h3>
            <a class="item" href="https://pike.lysator.liu.se/"
              >Pike – a dynamic programming language with a syntax similar to
              Java and C</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-19 @ 07:59:05</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43734938"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43732632">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=YcUycQoz0zg"
              >We Diagnosed and Fixed the 2023 Voyager 1 Anomaly from 15B Miles
              Away [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-18 @ 22:59:43</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43732632"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
