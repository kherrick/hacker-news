<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41312984">
          <h3>
            <a
              class="item"
              href="https://www.securityweek.com/new-phishing-technique-bypasses-security-on-ios-and-android-to-steal-bank-credentials/"
              >New Phishing Technique Bypasses Security on iOS and Android to
              Steal Bank Creds</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-21 @ 18:42:55</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41312984"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41312975">
          <h3>
            <a
              class="item"
              href="https://www.securityweek.com/major-backdoor-in-millions-of-rfid-cards-allows-instant-cloning/"
              >Major Backdoor in RFID Cards Allows Instant Cloning</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-21 @ 18:42:20</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41312975"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41312883">
          <h3>
            <a
              class="item"
              href="https://ostechnix.com/linux-market-share-july-2024-report/"
              >Linux desktop market share climbs to 4.45%</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-21 @ 18:32:54</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41312883"
                  >Comments</a
                ><span class="descendants">: 143</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41312845">
          <h3>
            <a
              class="item"
              href="https://qdrant.tech/articles/immutable-data-structures/"
              >Immutable Data Structures in Qdrant</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-21 @ 18:29:08</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41312845"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41312521">
          <h3>
            <a
              class="item"
              href="https://jaspervdj.be/posts/2024-08-21-turnstyle.html"
              >Turnstyle â€“ An esoteric, graphical functional language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-21 @ 17:49:40</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41312521"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41312520">
          <h3>
            <a
              class="item"
              href="https://www.ccampo.me/go/2024/08/20/go-duck-typing.html"
              >Duck Typing (Horror) in Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-21 @ 17:49:34</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41312520"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41312259">
          <h3>
            <a class="item" href="https://kill-the-newsletter.com/"
              >Kill the Newsletter: Convert email newsletters into Atom feeds</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-21 @ 17:15:29</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41312259"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41312225">
          <h3>
            <a class="item" href="https://www.midjourney.com/"
              >Midjourney web experience is now open to everyone</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-21 @ 17:11:48</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41312225"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41312134">
          <h3>
            <a
              class="item"
              href="https://job-boards.greenhouse.io/flexport/jobs/5993812?gh_jid=5993812"
              >Flexport (YC W14) is hiring a senior product designer for our
              newest product</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-21 @ 17:01:26</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41312084">
          <h3>
            <a
              class="item"
              href="https://www.chiark.greenend.org.uk/~sgtatham/quasiblog/code-review-antipatterns/"
              >Code review antipatterns</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-21 @ 16:55:55</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41312084"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41312079">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41312079"
              >Launch HN: Outerport (YC S24) â€“ Instant hot-swapping for AI model
              weights</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-21 @ 16:55:36</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41312079"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <a href="https://outerport.com">https://outerport.com</a>), a
              distribution network for AI model weights that enables
              â€˜hot-swappingâ€™ of AI models to save on GPU costs.
              <p>
                â€˜Hot-swappingâ€™ lets you serve different models on the same GPU
                machine with only ~2 second swap times (~150x faster than
                baseline). You can see this in action through a live demo where
                you try the same prompts on different open source large language
                models at
                <a href="https://hotswap.outerport.com"
                  >https://hotswap.outerport.com</a
                >
                and see the docs here
                <a href="https://docs.outerport.com"
                  >https://docs.outerport.com</a
                >.
              </p>
              <p>
                Running AI models on the cloud is expensive. Outerport came from
                our own experience working on AI services ourselves and
                struggling with the cost.
              </p>
              <p>
                Cloud GPUs are charged by the amount of time used. A long
                start-up time (from loading models into GPU memory) means that
                to serve requests quickly, we need to acquire extra GPUs with
                models pre-loaded for spare capacity (i.e. â€˜overprovisionâ€™). The
                time spent on loading models also adds to the cost. Both lead to
                inefficient use of expensive hardware.
              </p>
              <p>
                The long start-up times are caused by how massive modern AI
                models are, particularly large language models. These models are
                often several gigabytes to terabytes in size. Their sizes
                continue to grow as models evolve, exacerbating the issue.
              </p>
              <p>
                GPU capacity also needs to adapt dynamically according to
                demand, further complicating the issue. Starting up a new
                machine with another GPU is time consuming, and sending a large
                model there is also time consuming.
              </p>
              <p>
                Traditional container-based solutions and orchestration systems
                (like Docker, Kubernetes) are not optimized for these large,
                storage-intensive AI models, as they are designed for smaller,
                more numerous containerized applications (which are usually 50MB
                to 1GB in size). There needs to be a solution that is designed
                specifically for model weights (floating point arrays) running
                on GPUs, to take advantage of things like layer sharing, caching
                and compression.
              </p>
              <p>
                We made Outerport, a specialized system to manage and deploy AI
                models, as a solution to these problems and to help save GPU
                costs.
              </p>
              <p>
                Outerport is a caching system for model weights, allowing
                read-only models to be cached in pinned RAM for fast loading
                into GPU. Outerport is also hierarchical, maintaining a cache
                across S3 to local SSD to RAM to GPU memory, optimizing for
                reduced data transfer costs and load balancing.
              </p>
              <p>
                Within Outerport, models are managed by a dedicated daemon
                process which handles transfer to GPU, loading models from
                registry, and orchestrates the â€˜hot swappingâ€™ of multiple models
                on one machine.
              </p>
              <p>
                â€˜Hot-swappingâ€™ lets you provision a single GPU machine to be
                â€˜multi-tenantâ€™, such that multiple services with different
                models can run on the same machine. For example, this can
                facilitate A/B testing of two different models or having a text
                generation &amp; image generation endpoint on the same machine.
              </p>
              <p>
                We have been busy running simulations to determine the cost
                reductions we can get from leveraging this multi-model service
                scheme instead of multiple single-model services. Our initial
                simulation results show that we can achieve a 40% reduction in
                GPU running time costs. This improvement can be attributed to
                the multi-model serviceâ€™s ability to smoothen out peaks of
                traffic, enabling more effective horizontal scaling. Overall,
                less time is wasted on acquiring additional machines and model
                loading, significantly saving costs. Our hypothesis is that the
                cost savings are substantial enough to make a viable business
                while still saving customers significant amounts of money.
              </p>
              <p>
                We think that there are lots of exciting directions to take from
                hereâ€”from more sophisticated compression algorithms to providing
                a central platform for model management and governance. Towaki
                worked on ML systems and model compression at NVIDIA, and Allen
                used to do research in operations research, which is also why
                weâ€™re so excited about this problem as something that combines
                both.
              </p>
              <p>
                Weâ€™re super excited to share Outerport with you all. Weâ€™re also
                intending to release as much as possible of this in an open core
                model when weâ€™re ready. We would love to know what you thinkâ€”and
                experiences you have in working on this, related problems, or
                any other ideas you might have on this problem!
              </p>
            </div>
          </section>
        </section>
        <section id="41311071">
          <h3>
            <a class="item" href="https://pwy.io/posts/mimalloc-cigarette/"
              >Mimalloc Cigarette: Losing one week of my life catching a memory
              leak (Rust)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-21 @ 15:09:42</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41311071"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41310834">
          <h3>
            <a
              class="item"
              href="https://www.lightly.ai/post/self-supervised-learning-for-videos"
              >Self-Supervised Learning for Videos</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-21 @ 14:46:17</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41310834"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41310433">
          <h3>
            <a class="item" href="https://francisbach.com/jensen-inequality/"
              >Revisiting the Classics: Jensen's Inequality (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-21 @ 14:05:48</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41310433"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41310384">
          <h3>
            <a
              class="item"
              href="https://www.construction-physics.com/p/how-to-build-a-50000-ton-forging"
              >How to build a 50k ton forging press</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-21 @ 14:00:47</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41310384"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41309292">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/electrostatic-motor"
              >Electrostatic motors reach the macro scale</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-21 @ 11:43:19</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41309292"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41309072">
          <h3>
            <a
              class="item"
              href="https://lucumr.pocoo.org/2024/8/21/harvest-season/"
              >Rye and Uv: August Is Harvest Season for Python Packaging</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-21 @ 11:12:28</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41309072"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41308712">
          <h3>
            <a
              class="item"
              href="https://www.esa.int/Science_Exploration/Space_Science/Juice/Juice_rerouted_to_Venus_in_world_s_first_lunar-Earth_flyby"
              >Juice rerouted to Venus in first lunar-Earth flyby</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-21 @ 10:15:09</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41308712"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41308599">
          <h3>
            <a
              class="item"
              href="https://switowski.com/blog/i-have-built-my-first-successful-side-project-and-i-hate-it/"
              >I've built my first successful side project, and I hate it</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-21 @ 09:59:41</span
              ><span class="points-container"
                >Points: <span class="points">718</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41308599"
                  >Comments</a
                ><span class="descendants">: 206</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41308114">
          <h3>
            <a
              class="item"
              href="https://webspace.science.uu.nl/~gent0113/idl/idl_discovery.htm"
              >The Discovery of the Celendrical Date Line</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-21 @ 08:32:48</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41308114"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41307815">
          <h3>
            <a class="item" href="https://github.com/hsfzxjy/handwriter.ttf"
              >Show HN: Handwriter.ttf â€“ Handwriting Synthesis with Harfbuzz
              WASM</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-21 @ 07:47:05</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41307815"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
            <div class="text">
              During the hype of llama.ttf months ago, I was speculating the
              potential of WASM shaper for even crazier purpose, one that fitter
              to a font shaper's duty -- to synthesize font at runtime. This
              project as proof-of-concept implements a synthesizer that
              generates and rasterizes handwriting-style font, backed by a
              super-lightweight RNN model (~14MiB).
            </div>
          </section>
        </section>
        <section id="41307166">
          <h3>
            <a
              class="item"
              href="https://www.pv-tech.org/australian-government-approves-aapowerlink-project-to-export-solar-to-singapore/"
              >Australian government approves AAPowerLink project to export
              solar to Singapore</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-21 @ 05:52:31</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41307166"
                  >Comments</a
                ><span class="descendants">: 173</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41307011">
          <h3>
            <a class="item" href="https://csvbase.com/blog/13"
              >The semantic web is now widely adopted</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-21 @ 05:22:27</span
              ><span class="points-container"
                >Points: <span class="points">391</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41307011"
                  >Comments</a
                ><span class="descendants">: 228</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41306128">
          <h3>
            <a class="item" href="https://phrack.org/issues/71/17.html#article"
              >Calling All Hackers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-21 @ 02:08:56</span
              ><span class="points-container"
                >Points: <span class="points">446</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41306128"
                  >Comments</a
                ><span class="descendants">: 176</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41303974">
          <h3>
            <a class="item" href="https://www.zen-browser.app/"
              >Zen, a Arc-like open-source browser based on the Firefox
              engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-20 @ 20:57:04</span
              ><span class="points-container"
                >Points: <span class="points">658</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41303974"
                  >Comments</a
                ><span class="descendants">: 318</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41287641">
          <h3>
            <a
              class="item"
              href="https://www.esquire.com/food-drink/drinks/recipes/a27481/bloody-mary-origins-recipe/"
              >The Origins of the Bloody Mary (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-19 @ 03:48:49</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41287641"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41272893">
          <h3>
            <a
              class="item"
              href="https://elastio.github.io/bon/blog/the-weird-of-function-local-types-in-rust"
              >The weird of function-local types in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-17 @ 08:54:44</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41272893"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41272125">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=D7vfI-WSP8Q"
              >David Mackenzie â€“ A Personal History with Linux and BSD Unix
              [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-17 @ 04:04:26</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41272125"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41271139">
          <h3>
            <a class="item" href="https://okmij.org/ftp/Scheme/Dirty-Macros.pdf"
              >Unhygienic and referentially opaque macros with Scheme
              syntax-rules [pdf] (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-16 @ 22:59:50</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41271139"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41263876">
          <h3>
            <a
              class="item"
              href="https://clarkesworldmagazine.com/kritzer_05_23/"
              >Better Living Through Algorithms (just won the Hugo for short SF
              story [1])</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-16 @ 07:06:41</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41263876"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
