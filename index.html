<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36050830">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36050830"
              >Aptible (YC S14) Is Hiring: Security Engineer and Head of
              Product</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 21:02:18</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
            <div class="text">
              <p>
                <a href="https://www.aptible.com/culture-hub/careers"
                  >https://www.aptible.com/culture-hub/careers</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="36049467">
          <h3>
            <a class="item" href="https://particular.net/blog/antirequirements"
              >Using anti-requirements to find system boundaries</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 19:22:06</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36049467"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36049386">
          <h3>
            <a
              class="item"
              href="https://shaneosullivan.wordpress.com/2023/05/23/instant-colour-fill-with-html-canvas/"
              >Instant flood fill with HTML Canvas</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 19:18:10</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36049386"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36048261">
          <h3>
            <a class="item" href="https://github.com/google/comprehensive-rust"
              >Comprehensive Rust: course used by the Android team at Google</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 18:01:46</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36048261"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36047861">
          <h3>
            <a class="item" href="https://kanboard.org/"
              >Kanboard is a free and open source Kanban project management
              software</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 17:39:12</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36047861"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36047524">
          <h3>
            <a class="item" href="http://nginx.org/en/CHANGES"
              >Nginx 1.25.0: experimental HTTP/3 support</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 17:19:06</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36047524"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36047359">
          <h3>
            <a class="item" href="https://www.3dbrew.org/wiki/11.17.0-50"
              >Nintendo updates 3DS to block Bannerbomb3 despite eShop
              discontinuation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 17:09:14</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36047359"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36047202">
          <h3>
            <a
              class="item"
              href="https://opensource.googleblog.com/2023/05/open-sourcing-our-rust-crate-audits.html"
              >Google open-sources Rust crate audits</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 16:59:54</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36047202"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36047143">
          <h3>
            <a
              class="item"
              href="https://github.com/SimonHalvdansson/Harmonic-HN"
              >Show HN: I'm open sourcing Harmonic, the Android Hacker News
              client</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 16:56:49</span
              ><span class="points-container"
                >Points: <span class="points">163</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36047143"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36046830">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2305.12234"
              >The damage to lunar orbiting spacecraft caused by the ejecta of
              lunar landers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 16:39:21</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36046830"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36046662">
          <h3>
            <a
              class="item"
              href="https://boyter.org/posts/how-to-start-go-project-2023/"
              >How to start a Go project in 2023</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 16:31:08</span
              ><span class="points-container"
                >Points: <span class="points">222</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36046662"
                  >Comments</a
                ><span class="descendants">: 89</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36046319">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36046319"
              >Show HN: Accelerated Docker builds on your local machine with
              Depot (YC W23)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 16:06:46</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36046319"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
            <div class="text">
              <p>The launch blog post: https://depot.dev/blog/local-builds</p>
              <p>
                Depot is a hosted container build service - we run fully managed
                Intel and Arm remote build machines in AWS, with large instance
                sizes and SSD cache disks. The machines run BuildKit, the build
                engine that powers Docker, so generally anything you can `docker
                build`, you can also `depot build`.
              </p>
              <p>
                Most people use Depot in CI, and you could also run `depot
                build` from your local machine as well. That would perform the
                build using the remote builder, with associated fast hardware
                and extra fast datacenter network speeds.
              </p>
              <p>
                But then to download the container back to your local machine,
                BuildKit would transfer the <i>entire</i> container back for
                every build, including base image layers, since BuildKit wasn’t
                aware of what layers already existed on your device.
              </p>
              <p>
                The new release fixes this! To make it work, we replaced the
                BuildKit `--load` by making the Depot CLI itself serve the
                Docker registry API on a local port, then asking Docker to pull
                the image from that localhost registry. The CLI in turn
                intercepts the requests for layers and fetches them directly
                using BuildKit’s content API.
              </p>
              <p>
                This means Docker only asks for the layers it needs! This
                actually speeds up both local builds, where you only need to
                download changed layers, as well as CI where it can skip
                building an expensive tarball of the whole image every time!
              </p>
              <p>
                We ran into one major obstacle when first testing: the machine
                running the Docker daemon might not be the same machine running
                the `depot build` command. Notably, CircleCI has a remote Docker
                daemon, where asking it to pull from localhost does not reach
                the CLI’s temporary registry.
              </p>
              <p>
                For this, we built a "helper" container that the CLI launches to
                run the HTTP server portion of the temporary registry - since
                it’s launched as a container, it does run on the same machine as
                the Docker daemon, and localhost is reachable. The Depot CLI
                then communicates with the helper container over stdio,
                receiving requests for layers and sending their contents back
                using a custom simple transport protocol.
              </p>
              <p>
                This makes everything very efficient! One cool part about the
                remote build machines: you can share cache with anyone on your
                team who has access to the same project. This means that if your
                teammate already built all or part of the container, your build
                just reuses the result. This means that, in addition to using
                the fast remote builders instead of your local device, you can
                actually have cache hits on code you haven’t personally built
                yet.
              </p>
              <p>
                We’d love for you to check it out, and are happy to answer any
                questions you have about technical details!
              </p>
              <p>https://depot.dev/docs/guides/local-development</p>
            </div>
          </section>
        </section>
        <section id="36045938">
          <h3>
            <a
              class="item"
              href="https://www.openrobotics.org/blog/2023/5/23/ros-2-iron-irwini-released"
              >ROS 2 Iron Irwini Release</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 15:41:14</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36045938"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36045919">
          <h3>
            <a
              class="item"
              href="https://edconway.substack.com/p/watching-paint-dry"
              >Watching Paint Dry: The unexpectedly interesting story of car
              coatings</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 15:40:03</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36045919"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36044977">
          <h3>
            <a
              class="item"
              href="https://www.macrumors.com/2023/05/23/apple-announces-deal-to-make-components-in-the-usa/"
              >Apple announces multibillion deal with Broadcom to make
              components in the USA</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 14:39:15</span
              ><span class="points-container"
                >Points: <span class="points">451</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36044977"
                  >Comments</a
                ><span class="descendants">: 180</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36044561">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/05/23/well/family/social-media-mental-health-surgeon-general.html"
              >Social media can be a ‘profound risk’ to youth, surgeon general
              warns</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 14:10:13</span
              ><span class="points-container"
                >Points: <span class="points">217</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36044561"
                  >Comments</a
                ><span class="descendants">: 363</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36044543">
          <h3>
            <a
              class="item"
              href="https://blog.pypi.org/posts/2023-05-23-removing-pgp/"
              >Removing PGP from PyPI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 14:09:20</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36044543"
                  >Comments</a
                ><span class="descendants">: 158</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36043944">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36043944"
              >Launch HN: Common Paper (YC W23) – SAFEs for Commercial
              Contracts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 13:28:53</span
              ><span class="points-container"
                >Points: <span class="points">288</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36043944"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
            <div class="text">
              <a href="https://commonpaper.com">https://commonpaper.com</a>). We
              provide standard, open-source contracts and a platform for getting
              them signed quickly. See
              <a href="https://youtu.be/f7maIapJpU4"
                >https://youtu.be/f7maIapJpU4</a
              >
              for an overview, and
              <a href="https://youtu.be/A1PWjWiheFk"
                >https://youtu.be/A1PWjWiheFk</a
              >
              for a demo of sending and signing a contract.
              <p>
                I (Jake) was a co-founder of two B2B SaaS companies, RJMetrics
                (where Ben and I met), and Stitch. Everything about contracts
                was frustrating, both at those startups and the larger companies
                that acquired us.
              </p>
              <p>
                Way too often, the contracting process with a customer got
                adversarial—arguing over whose template to use, emailing Word
                docs back and forth, huge legal fees, and unpredictable delays
                that made it hard to know if a deal would ever close. Then, when
                we finally got the customer to sign, we had to keep track of all
                of the promises embedded in the contract. This is difficult when
                you have hundreds of customers and contract PDFs full of
                unstructured text.
              </p>
              <p>
                The breaking point came when one of our customers was acquired
                by Oracle. They wanted to keep using our product, but had to
                move from our original contract to the one that Oracle uses. In
                exchange for this, they were willing to increase the price they
                were paying from $6,000 to $24,000 per year.
              </p>
              <p>
                It took us 9 months to get the new contract in place, just to
                enable them to keep using the product. We spent more on
                attorneys than we gained from the upsell. And there was
                basically nothing we could do to improve that process as a
                single company operating in a system where standards don’t
                exist.
              </p>
              <p>
                Contrast that to the standardization that the SAFE, or Simple
                Agreement for Future Equity, brought to seed investments, and
                the potential is obvious. (Past discussion of the SAFE at
                <a href="https://news.ycombinator.com/item?id=33639191"
                  >https://news.ycombinator.com/item?id=33639191</a
                >)
              </p>
              <p>
                If you’re a startup raising money on a SAFE, the process is
                simple, whether you’re raising $10k from an angel or $1M from a
                VC. Everyone already uses, or at least is familiar with, the
                same basic contract. There are a few variables that change on a
                deal-by-deal basis, but the transactions are vastly more
                efficient because everyone is on the same standard contract.
              </p>
              <p>
                If you start with standard contracts, you can build very
                different software to manage them compared to traditional
                contracts. Our business model is to provide the standard
                contracts for free and charge money from companies who use our
                software to sell to their customers (more on this below).
              </p>
              <p>
                The standard contracts we create are all related to buying and
                selling B2B software. This includes a non-disclosure agreement,
                (<a href="https://commonpaper.com/standards/mutual-nda/"
                  >https://commonpaper.com/standards/mutual-nda/</a
                >), sales contract (<a
                  href="https://commonpaper.com/standards/cloud-service-agreement/"
                  >https://commonpaper.com/standards/cloud-service-agreement/</a
                >), SLA, DPA, ToS, etc. The full list is at
                <a href="https://commonpaper.com/standards/"
                  >https://commonpaper.com/standards/</a
                >.
              </p>
              <p>
                The process for creating and revising the contracts is modeled
                after an open-source software project, and they are released for
                free (as in both speech and beer) under the Creative Commons CC
                BY 4.0 license.
              </p>
              <p>
                We have a committee of 40+ attorneys from tech companies and law
                firms who are analogous to code contributors (<a
                  href="https://commonpaper.com/committee"
                  >https://commonpaper.com/committee</a
                >). An attorney on our team, who you can think about like a
                maintainer, collects all of their feedback and synthesizes it
                into a version for release (eg the Design Partner Agreement
                v1.0). We post the agreements as DOCX, PDF, and HTML on our
                website and host markdown on Github.
              </p>
              <p>
                Most of the usage of the agreements happens outside of our
                platform, and we don’t have any visibility into that unless
                people choose to tell us. However, we do know that thousands of
                companies have signed the agreements, and millions of dollars
                worth of deals have been closed on them.
              </p>
              <p>
                Each agreement is split into two sections: the standard terms,
                which are the same across all instances, and a cover page, with
                variables that can be customized for a particular company and
                deal. The latter is basically a schema for each agreement type,
                and that leads to the fundamental trade-off in how we build our
                software. We have less flexibility around types of contracts
                (because we’re focused on the standard agreements, not arbitrary
                DOCX files), but in exchange, every agreement type has a
                consistent data model, which means that we can build
                integrations and features that work across all customers. This
                gain is huge.
              </p>
              <p>
                For example, we can use the data in the fees section of our
                standard Cloud Service Agreement to automatically generate
                invoices and subscriptions using Stripe. Similarly, it’s trivial
                to use our API (<a href="https://api.commonpaper.com/docs"
                  >https://api.commonpaper.com/docs</a
                >) to check if an active NDA is in place before sharing
                confidential information or to keep a spreadsheet up to date
                with the SLA obligations for different customers.
              </p>
              <p>
                Traditional contract management tools are built around adding
                electronic signatures to documents full of unstructured text
                and/or creating a custom data model from a particular company’s
                bespoke contract. There’s no way they can offer features like
                this without a custom project for each particular contract. It’s
                basically the difference between custom software and a software
                product.
              </p>
              <p>
                Part of our feature set overlaps with the traditional tools. We
                can do things like send a contract to the other side, propose
                changes, approve, and sign. But our negotiation model is
                different in that it encourages both sides to keep changes
                narrowly scoped to the variables in the cover page. That makes
                it faster both to propose the changes and for each side to
                understand, and accept or reject, the changes proposed by their
                counterparty.
              </p>
              <p>
                We believe that, just as with SAFEs in the investment world, the
                potential efficiency gains and positive side effects of this
                model are so big that the transition is inevitable. We’d love
                for you all to try it out and let us know your feedback and
                suggestions. The agreements are free forever, and our software
                is free as well until you use it to close deals with 5
                customers.
                <a href="https://commonpaper.com/product/"
                  >https://commonpaper.com/product/</a
                >.
              </p>
              <p>
                We’re interested to hear about any experiences you’ve had with
                contracts and how you’ve worked with them. We look forward to
                your comments!
              </p>
            </div>
          </section>
        </section>
        <section id="36043322">
          <h3>
            <a
              class="item"
              href="https://blog.waymo.com/2023/05/waymo-and-uber-partner-to-bring-waymos.html"
              >Waymo and Uber partner to bring autonomous driving technology to
              Uber</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 12:28:39</span
              ><span class="points-container"
                >Points: <span class="points">364</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36043322"
                  >Comments</a
                ><span class="descendants">: 330</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36042732">
          <h3>
            <a
              class="item"
              href="https://metalintheory.com/metallica-master-of-puppets/"
              >Microtiming in Metallica's “Master of Puppets” (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 11:22:51</span
              ><span class="points-container"
                >Points: <span class="points">256</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36042732"
                  >Comments</a
                ><span class="descendants">: 199</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36042213">
          <h3>
            <a
              class="item"
              href="https://www.geoffchappell.com/notes/windows/archive/aard/drdos/index.htm"
              >The AARD Code and DR DOS (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 10:24:44</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36042213"
                  >Comments</a
                ><span class="descendants">: 112</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36041432">
          <h3>
            <a class="item" href="https://www.ableton.com/en/push/"
              >Ableton Push 3</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 08:16:18</span
              ><span class="points-container"
                >Points: <span class="points">275</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36041432"
                  >Comments</a
                ><span class="descendants">: 248</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36040803">
          <h3>
            <a
              class="item"
              href="https://im.salty.fish/index.php/archives/linux-networking-shallow-dive.html"
              >Linux Networking Shallow Dive: WireGuard, Routing, TCP/IP and
              Nat</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 06:52:16</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36040803"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36040678">
          <h3>
            <a class="item" href="http://ascii.textfiles.com/archives/5528"
              >The Great Aboveground Empire</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 06:34:43</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36040678"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36038302">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/05/21/science/math-puzzles-integer-sequences.html"
              >What Number Comes Next? The On-Line Encyclopedia of Integer
              Sequences Knows</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-23 @ 00:07:13</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36038302"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36035748">
          <h3>
            <a class="item" href="https://erkin.party/emacs/"
              >Emacs Web Buttons</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 19:41:29</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36035748"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36035519">
          <h3>
            <a
              class="item"
              href="https://slate.com/technology/2013/09/green-bank-conference-seti-frank-drakes-equation-for-estimating-the-extraterrestrial-life.html"
              >The Alien-Life Summit (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 19:20:57</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36035519"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36030979">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-05-humanity-earliest-mesopotamia-years.html"
              >Humanity's earliest recorded kiss occurred in Mesopotamia 4,500
              years ago</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 13:10:15</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36030979"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36028740">
          <h3>
            <a
              class="item"
              href="https://statmodeling.stat.columbia.edu/2023/05/20/if-you-do-not-know-what-you-would-have-done-under-all-possible-scenarios-then-you-cannot-know-the-type-i-error-rate-for-your-analysis/"
              >When can you know the Type I error rate for your analysis</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-22 @ 08:22:16</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36028740"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36022731">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Ithkuil"
              >Ithkuil, the Most Complicated Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-21 @ 16:54:20</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36022731"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
