<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40887014">
          <h3>
            <a
              class="item"
              href="https://www.folger.edu/blogs/collation/better-than-a-pound-of-sorrow/"
              >Antidotes for Melancholy in Early Modern England</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-05 @ 23:34:12</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40887014"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40886972">
          <h3>
            <a
              class="item"
              href="https://crtc.gc.ca/eng/publications/reports/xona2024.htm"
              >Rogers networks reliability and resiliency assessment after
              2022-07-08 outage</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-05 @ 23:25:40</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40886972"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40886954">
          <h3>
            <a
              class="item"
              href="https://bugzilla.mozilla.org/show_bug.cgi?id=1863246"
              >Firefox "Copy" has been inconsistent and broken for 8 months</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-05 @ 23:22:51</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40886954"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40886689">
          <h3>
            <a
              class="item"
              href="https://globalvoices.org/2024/06/28/war-on-citizens-how-the-juntas-vpn-ban-is-strangling-communication-in-myanmar/"
              >War on citizens: How the junta's VPN ban is strangling
              communication in Myanmar</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-05 @ 22:41:49</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40886689"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40886419">
          <h3>
            <a
              class="item"
              href="https://github.com/nrrb/tao-te-ching/blob/master/Ursula%20K%20Le%20Guin.md"
              >Tao Te Ching translated by Ursula Le Guin (1997)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-05 @ 21:57:49</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40886419"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40885968">
          <h3>
            <a
              class="item"
              href="https://www.emergetools.com/careers/jobs/product-engineer-ios-full-stack"
              >Emerge Tools (YC W21) Is Hiring a Product Engineer (iOS,
              Full-Stack)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-05 @ 21:00:47</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40885238">
          <h3>
            <a
              class="item"
              href="https://duckdb.org/2024/07/05/community-extensions.html"
              >DuckDB Community Extensions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-05 @ 19:13:06</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40885238"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40885155">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2024/07/05/youtubes-updated-eraser-tool-removes-copyrighted-music-without-impacting-other-audio/"
              >YouTube's eraser tool removes copyrighted music without impacting
              other audio</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-05 @ 19:01:13</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40885155"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40884878">
          <h3>
            <a
              class="item"
              href="https://maciejwalkowiak.com/blog/postgres-uuid-primary-key/"
              >PostgreSQL and UUID as Primary Key</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-05 @ 18:21:01</span
              ><span class="points-container"
                >Points: <span class="points">185</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40884878"
                  >Comments</a
                ><span class="descendants">: 111</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40884523">
          <h3>
            <a
              class="item"
              href="https://www.usgs.gov/programs/VHP/volcanoes-can-affect-climate"
              >Volcanoes can affect climate</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-05 @ 17:30:53</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40884523"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40884356">
          <h3>
            <a class="item" href="https://dynomight.net/centuries/"
              >Let's stop counting centuries</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-05 @ 17:04:45</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40884356"
                  >Comments</a
                ><span class="descendants">: 133</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40883839">
          <h3>
            <a class="item" href="https://ente.io/auth/"
              >Ente Auth: open-source Authy alternative for 2FA</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-05 @ 15:57:18</span
              ><span class="points-container"
                >Points: <span class="points">208</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40883839"
                  >Comments</a
                ><span class="descendants">: 132</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40883277">
          <h3>
            <a
              class="item"
              href="https://eieio.games/game-diary/game-6-get-the-dvd-logo-into-the-corner/"
              >Put the DVD logo in the corner (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-05 @ 14:48:14</span
              ><span class="points-container"
                >Points: <span class="points">301</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40883277"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40882881">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/article/ultimate-blood-substitute-us-military-betting-46-million"
              >Mimicking the cells that carry hemoglobin as a blood
              substitute</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-05 @ 14:10:02</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40882881"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40882583">
          <h3>
            <a
              class="item"
              href="https://wryl.tech/log/2024/the-software-crisis.html"
              >The Software Crisis</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-05 @ 13:38:11</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40882583"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40881836">
          <h3>
            <a class="item" href="https://withtelescope.com"
              >Show HN: I’ve made a cheaper SEO research tool</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-05 @ 11:27:10</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40881836"
                  >Comments</a
                ><span class="descendants">: 89</span></span
              >
            </h4>
            <div class="text">
              <p>
                While building it my total bill was $51 for 2 months and 41k+
                keywords found. Every page of keywords costs $0.03 - $0.05. 2
                payment options - usage-based subscription or just top up your
                balance with the amount you'd like to.
              </p>
              <p>Telescope includes a couple of things:</p>
              <p>
                - Keywords Explorer - finding keywords based on seed phrase and
                filters
              </p>
              <p>
                - Keywords Ideas - keywords on interception on provided keywords
              </p>
              <p>
                - Ranked Keywords - keywords a domain you specified with their
                positions and change since last DB update
              </p>
              <p>
                - Saved Keywords - to store found keywords and plan the SEO
                strategy
              </p>
              <p>
                I've put a lot of love into it and would love to get some
                feedback. IMPORTANT: every new account gets some free balance to
                start with. Appreciate it!
              </p>
            </div>
          </section>
        </section>
        <section id="40880932">
          <h3>
            <a
              class="item"
              href="https://consteval.ca/2024/07/03/initialization/"
              >I have no constructor, and I must initialize</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-05 @ 08:42:27</span
              ><span class="points-container"
                >Points: <span class="points">280</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40880932"
                  >Comments</a
                ><span class="descendants">: 177</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40879376">
          <h3>
            <a class="item" href="https://blog.bruchez.name/posts/ibm-mt-sc-1/"
              >The IBM Magnetic Tape Selectric Composer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-05 @ 02:02:10</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40879376"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40877708">
          <h3>
            <a class="item" href="https://foorr.com/"
              >Show HN: Foorr – A minimal to-do app with social
              accountability</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 20:14:57</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40877708"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
            <div class="text">
              <p>
                Here's what it does: - Create tasks for today and tomorrow only
                (real hyperfocus on short term GTD). - Invite friends to cheer
                each other moving forward. - Building up a daily streak as you
                finish all tasks daily. All tasks completed before midnight
                which were planned for that day, earns you a level up. Rewarding
                that sense of completion.
              </p>
              <p>
                Why I built it: I used physical post-it notes and was a bit done
                with it. I really wanted something minimal focusing only on my
                to-do's for today and tomorrow.
              </p>
              <p>
                No bloated features, nothing to fancy/polished, just something
                no-nonsense I wanted to use myself. It might be useful for
                others who struggle with procrastination and keeping op progress
                getting things actually done. Feedback is definitely welcome and
                nice to hear if this resonates with anyone else.
              </p>
            </div>
          </section>
        </section>
        <section id="40876528">
          <h3>
            <a
              class="item"
              href="https://www.programmable-matter.com/technology/3d-catoms"
              >Programmable Matter – 3D Catoms</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-04 @ 17:20:18</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40876528"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40859160">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/smart-news/Five-things-to-know-about-diamond-sutra-worlds-oldest-dated-printed-book-180959052/"
              >Five Things to Know About the Diamond Sutra, the Oldest Dated
              Printed Book</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-02 @ 18:21:51</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40859160"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40859152">
          <h3>
            <a
              class="item"
              href="https://sdomi.pl/weblog/20-pwning-a-labelmaker/"
              >Pwning a Brother labelmaker, for fun and interop</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-02 @ 18:21:10</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40859152"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40858878">
          <h3>
            <a
              class="item"
              href="https://www.locksmithledger.com/keys-tools/article/10229247/unlocking-a-gary-tl-15-round-door-safe"
              >Unlocking a Gary TL-15 Round-Door Safe (2009)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-02 @ 17:45:46</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40858878"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40858023">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/science/article/2024/jul/02/ants-emergency-amputations-injured-nest-mates-study"
              >Ants can carry out life-saving amputations on injured nest mates,
              study shows</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-02 @ 16:12:15</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40858023"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40857589">
          <h3>
            <a
              class="item"
              href="https://github.com/explorerhq/django-sql-explorer"
              >Show HN: SQL Explorer – Open-source reporting tool that Just
              Works</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-02 @ 15:26:47</span
              ><span class="points-container"
                >Points: <span class="points">186</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40857589"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
            <div class="text">
              <p>
                A live demo instance is here (no login or anything required):
              </p>
              <p>
                <a href="https://demo.sqlexplorer.io/"
                  >https://demo.sqlexplorer.io/</a
                >
              </p>
              <p>
                And here's a fairly unprofessional, but very enthusiastic, video
                tour:
              </p>
              <p>
                <a
                  href="https://sql-explorer.s3.amazonaws.com/Sql+Explorer+5.mp4"
                  >https://sql-explorer.s3.amazonaws.com/Sql+Explorer+5.mp4</a
                >
              </p>
              <p>
                The UI is constrained enough that there's very little to learn,
                while there is still a surprising amount of functionality and
                flexibility to address a lot of use cases.
              </p>
              <p>Some of the stuff I'm excited about in the latest version:</p>
              <p>
                - Intuitive and obvious integration to ChatGPT / the AI API of
                your choice. Doesn't purport to be 'magic'. Good prompting +
                relevant table scheme &amp; data automatically injected into the
                prompt.
              </p>
              <p>
                - Create a new connection by uploading a CSV or SQLite DB as a
                new connection, and it's instantly queryable. CSVs are parsed,
                types inferred, and a SQLite DB gets created (persisted to s3).
                - New and improved SQL editor with strong autocomplete (based on
                your schema), and some fancy keyboard shortcuts.
              </p>
              <p>Some of the old stuff that is still great:</p>
              <p>
                - Pivot tables in-browser, so you don't have to open results in
                Excel for basic analysis. Unique URLs make everything shareable.
              </p>
              <p>
                - Expose queries (optionally) as JSON endpoints. Great for
                prototyping APIs and scripts.
              </p>
              <p>
                - All of the stuff you'd expect in a reporting tool (email
                reports, logging, favorites, exporting, etc.)
              </p>
              <p>Hope you enjoy!</p>
            </div>
          </section>
        </section>
        <section id="40856123">
          <h3>
            <a class="item" href="https://github.com/mikaku/Fiwix"
              >Fiwix: Unix-like kernel for the i386 architecture</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-02 @ 12:49:47</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40856123"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40852733">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=SDI8ubVZi7w"
              >Config 2024: In defense of an old pixel [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-02 @ 01:32:51</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40852733"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40852335">
          <h3>
            <a
              class="item"
              href="https://www.cuttingboarddesigner.com/designer/id/7bf4dff3-9b10-8c86-9e4c-bc2722f7487f"
              >Cutting Board Designer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-02 @ 00:25:22</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40852335"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40849306">
          <h3>
            <a
              class="item"
              href="https://www.goodbeerhunting.com/blog/2024/6/18/the-past-present-and-future-of-lager-yeast"
              >The Past, Present, and Future of Lager Yeast</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 19:06:30</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40849306"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40843123">
          <h3>
            <a
              class="item"
              href="https://www.fastcompany.com/91146873/what-is-a-passkey-password-apple-ios-18-google-microsoft-bank"
              >About Passkey – the password-free tech Apple is betting on</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-01 @ 06:27:13</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40843123"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
