<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="45557267">
          <h3>
            <a
              class="item"
              href="https://www.researchsquare.com/article/rs-7483367/v1"
              >Blood test detecting Long Covid in kids with 94% accuracy
              microclots</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-12 @ 11:08:58</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45557267"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45557013">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Wikipedia:Why_Wikipedia_cannot_claim_the_Earth_is_not_flat"
              >Why Wikipedia cannot claim the Earth is not flat</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-12 @ 10:19:34</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45557013"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45556952">
          <h3>
            <a class="item" href="https://danybittel.ch/macro.html"
              >Macro Gaussian Splats</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-12 @ 10:08:02</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45556952"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45556763">
          <h3>
            <a
              class="item"
              href="https://shreyanjain.net/2024/07/05/nostr-and-atproto.html"
              >Nostr and ATProto (2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-12 @ 09:24:43</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45556763"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45556741">
          <h3>
            <a
              class="item"
              href="https://snarky.ca/why-it-took-4-years-to-get-a-lock-files-specification/"
              >Why it took 4 years to get a lock files specification</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-12 @ 09:21:29</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45556741"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45556474">
          <h3>
            <a
              class="item"
              href="https://www.together.ai/blog/adaptive-learning-speculator-system-atlas"
              >4x faster LLM inference (Flash Attention guy's company)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-12 @ 08:37:01</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45556474"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45555873">
          <h3>
            <a class="item" href="https://sobernotsorry.app/"
              >Show HN: Sober not Sorry – free iOS tracker to help you quit bad
              habits</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-12 @ 06:46:58</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45555873"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
            <div class="text">
              I made Sober not Sorry, a clean and simple iOS tracker to help
              quit bad habits — alcohol, smoking, or anything else. Open it →
              log your start date → it tracks your streak. No ads, no sign-up,
              no subscriptions. I built it because most “sober” apps felt
              cluttered or too motivational. This one just quietly tracks
              progress and stays out of the way. Would love feedback —
              especially from people who use streak or sobriety trackers.
            </div>
          </section>
        </section>
        <section id="45555523">
          <h3>
            <a class="item" href="https://github.com/sirbread/spellscript"
              >Show HN: I made an esoteric programming language that's read like
              a spellbook</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-12 @ 05:31:00</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45555523"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <p>
                it's literally read like a spellbook because the syntax consists
                of all natural language, and newlines are optional. your code
                can now be an essay, like everybody wants!
              </p>
              <p>
                for example, if you want to print something, you'd write: `begin
                the grimoire. inscribe whispers of "hello, world!". close the
                grimoire.`
              </p>
              <p>
                it has variables, dynamic typing, arrays, functions,
                conditionals, loops, string manipulation, array manipulation,
                type conversion, and user input, among other (listed in the
                docs!)
              </p>
              <p>
                but why? i wanted to see how far you could push natural language
                syntax while still being parseable. most esolangs are
                intentionally obtuse (BF, Malbolge), but i wanted something
                that's weird but readable, like you're reading instructions from
                a spellbook, which makes it incredibly easy to read and
                understand. like an anti-esolang? hmm...
              </p>
              <p>
                github:
                <a href="https://github.com/sirbread/spellscript"
                  >https://github.com/sirbread/spellscript</a
                >
              </p>
              <p>
                docs:
                <a
                  href="https://github.com/sirbread/spellscript/blob/main/resources/documentation.md"
                  >https://github.com/sirbread/spellscript/blob/main/resources/...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="45555308">
          <h3>
            <a
              class="item"
              href="https://postgresql.verite.pro/blog/2025/10/01/psql-pipeline.html"
              >Pipelining in psql (PostgreSQL 18)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-12 @ 04:46:57</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45555308"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45555012">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2505.00749"
              >Coral Protocol: Open infrastructure connecting the internet of
              agents</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-12 @ 03:41:29</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45555012"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45553995">
          <h3>
            <a class="item" href="https://github.com/acsandmann/rift"
              >Show HN: Rift – A tiling window manager for macOS</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-12 @ 00:22:15</span
              ><span class="points-container"
                >Points: <span class="points">152</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45553995"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45553835">
          <h3>
            <a class="item" href="https://lineageos.org/Changelog-30/"
              >LineageOS 23</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 23:53:17</span
              ><span class="points-container"
                >Points: <span class="points">249</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45553835"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45553783">
          <h3>
            <a
              class="item"
              href="https://scamcouver.wordpress.com/wp-content/uploads/2012/04/scam-capital.pdf"
              >Vancouver Stock Exchange: Scam capital of the world (1989)
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 23:43:42</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45553783"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45553701">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2510.05096"
              >Paper2Video: Automatic Video Generation from Scientific Papers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 23:32:25</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45553701"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45553577">
          <h3>
            <a
              class="item"
              href="https://paddedinputs.substack.com/p/meta-superintelligences-surprising"
              >Meta Superintelligence's surprising first paper</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 23:16:05</span
              ><span class="points-container"
                >Points: <span class="points">309</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45553577"
                  >Comments</a
                ><span class="descendants">: 167</span></span
              >
            </h4>
            <div class="text">
              <a href="https://arxiv.org/abs/2509.01092"
                >https://arxiv.org/abs/2509.01092</a
              >
            </div>
          </section>
        </section>
        <section id="45553422">
          <h3>
            <a
              class="item"
              href="https://www.legitsecurity.com/blog/camoleak-critical-github-copilot-vulnerability-leaks-private-source-code"
              >CamoLeak: Critical GitHub Copilot Vulnerability Leaks Private
              Source Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 22:58:30</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45553422"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45553132">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=45553132"
              >Ask HN: Abandoned/dead projects you think died before their time
              and why?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 22:16:18</span
              ><span class="points-container"
                >Points: <span class="points">151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45553132"
                  >Comments</a
                ><span class="descendants">: 461</span></span
              >
            </h4>
            <div class="text">
              Just curious and who knows, maybe someone will adopt it or develop
              something new based on its ideas.
            </div>
          </section>
        </section>
        <section id="45552049">
          <h3>
            <a
              class="item"
              href="https://psyonik.tech/posts/a-guide-for-wireguard-vpn-setup-with-pi-hole-adblock-and-unbound-dns/"
              >A Guide for WireGuard VPN Setup with Pi-Hole Adblock and Unbound
              DNS</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 19:41:27</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45552049"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45551504">
          <h3>
            <a
              class="item"
              href="https://hardware.slashdot.org/story/25/10/11/0238213/microsofts-onedrive-begins-testing-face-recognizing-ai-for-photos-for-some-preview-users"
              >Microsoft only lets you opt out of AI photo scanning 3x a year</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 18:36:51</span
              ><span class="points-container"
                >Points: <span class="points">651</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45551504"
                  >Comments</a
                ><span class="descendants">: 241</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45551260">
          <h3>
            <a
              class="item"
              href="https://github.com/anthropics/prompt-eng-interactive-tutorial"
              >Anthropic's Prompt Engineering Tutorial</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 18:06:40</span
              ><span class="points-container"
                >Points: <span class="points">186</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45551260"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45547566">
          <h3>
            <a
              class="item"
              href="https://denodell.com/blog/html-best-kept-secret-output-tag"
              >The Tag</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 08:27:26</span
              ><span class="points-container"
                >Points: <span class="points">773</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45547566"
                  >Comments</a
                ><span class="descendants">: 171</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45547359">
          <h3>
            <a class="item" href="https://github.com/BalajeS/WSL-For-FreeBSD"
              >Windows Subsystem for FreeBSD</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 07:32:08</span
              ><span class="points-container"
                >Points: <span class="points">263</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45547359"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45547344">
          <h3>
            <a class="item" href="https://blog.fsck.com/2025/10/09/superpowers/"
              >Superpowers: How I'm using coding agents in October 2025</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-11 @ 07:29:23</span
              ><span class="points-container"
                >Points: <span class="points">363</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45547344"
                  >Comments</a
                ><span class="descendants">: 194</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45523370">
          <h3>
            <a class="item" href="https://nima101.github.io/io_multiplexing"
              >I/O Multiplexing (select vs. poll vs. epoll/kqueue)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-09 @ 04:06:43</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45523370"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45521584">
          <h3>
            <a
              class="item"
              href="https://wiki.qt.io/C%2B%2B_reflection_(P2996)_and_moc"
              >C++ Reflection and Qt MOC</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-08 @ 22:59:09</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45521584"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45520585">
          <h3>
            <a class="item" href="https://github.com/gue-ni/redstart"
              >Show HN: A Lisp Interpreter for Shell Scripting</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-08 @ 20:58:37</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45520585"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
            <div class="text">
              Redstart is a lightweight Lisp interpreter written in C++ with a
              focus on shell scripting. It lets you combine the expressive power
              of Lisp with the practicality of the Unix shell: you can run
              commands, capture output, pipe between processes, and still use
              Lisp syntax for logic and structure. Think of it as writing your
              shell scripts in Lisp instead of Bash.
            </div>
          </section>
        </section>
        <section id="45506055">
          <h3>
            <a
              class="item"
              href="https://tech.marksblogg.com/building-footprints-gba.html"
              >The World's 2.75B Buildings</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 17:26:20</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45506055"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45504540">
          <h3>
            <a class="item" href="https://n-e-r-v-o-u-s.com/blog/?p=9827"
              >The Flummoxagon</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 15:40:09</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45504540"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45498055">
          <h3>
            <a
              class="item"
              href="https://rarehistoricalphotos.com/twin-towers-construction-photographs/"
              >The World Trade Center under construction through photos,
              1966-1979</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 00:40:26</span
              ><span class="points-container"
                >Points: <span class="points">217</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45498055"
                  >Comments</a
                ><span class="descendants">: 105</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45489497">
          <h3>
            <a
              class="item"
              href="https://ounapuu.ee/posts/2025/10/06/datablocks-white-label-drives/"
              >Testing two 18 TB white label SATA hard drives from
              datablocks.dev</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 09:36:08</span
              ><span class="points-container"
                >Points: <span class="points">184</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45489497"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
            <div class="text">
              <a
                href="https://web.archive.org/web/20251006052340/https://ounapuu.ee/posts/2025/10/06/datablocks-white-label-drives/"
                >https://web.archive.org/web/20251006052340/https://ounapuu.e...</a
              >
            </div>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
