<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39180926">
          <h3>
            <a
              class="item"
              href="https://darkdot.com/articles/darknetlive-sold/"
              >Darknetlive Sold to Incognito Market</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 19:10:53</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39180926"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39180898">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/articles/evergrande-faces-imminent-liquidation-after-talks-with-top-creditors-break-down-4af5f657"
              >Evergrande, once China's biggest property developer, ordered to
              liquidate</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 19:09:22</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39180898"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39180155">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39180155"
              >Ask HN: What are some homeless shelter innovations?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 18:27:05</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39180155"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
            <div class="text">
              For example, it seems like most homeless shelters have tons of
              beds all together in one big room. But in my experience that would
              make it pretty hard to sleep with all the snoring and other
              noises. Is there some type of individual sleeping pod that would
              be better? What other innovations can you think of for the
              homeless?
            </div>
          </section>
        </section>
        <section id="39179121">
          <h3>
            <a
              class="item"
              href="https://www.synthmuseum.com/magazine/0102jw.html"
              >Thaddeus Cahill's Teleharmonium</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 17:26:12</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39179121"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39179095">
          <h3>
            <a
              class="item"
              href="https://dynomight.net/2020/12/15/some-real-data-on-a-DIY-box-fan-air-purifier/"
              >Experiments on a $50 DIY air purifier you can make in 30s</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 17:24:05</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39179095"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39179031">
          <h3>
            <a
              class="item"
              href="https://www.businessinsider.com/sonar-image-pilot-amelia-earhart-plane-found-pacific-ocean-2024"
              >An Air Force officer who spent $11M searching Earhart's plane may
              have found it</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 17:20:34</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39179031"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39178886">
          <h3>
            <a
              class="item"
              href="https://twitter.com/AIatMeta/status/1752013879532782075"
              >Meta AI releases Code Llama 70B</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 17:11:34</span
              ><span class="points-container"
                >Points: <span class="points">316</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39178886"
                  >Comments</a
                ><span class="descendants">: 167</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39178753">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39178753"
              >Launch HN: Dashdive (YC W23) – Track your cloud costs
              precisely</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 17:03:18</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39178753"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.dashdive.com/">https://www.dashdive.com/</a
              >), which calculates the cloud cost incurred by each user action
              taken in your product. There’s a demo video at
              <a href="https://www.dashdive.com/#video"
                >https://www.dashdive.com/#video</a
              >
              and an interactive demo here:
              <a href="https://demo.dashdive.com">https://demo.dashdive.com</a>.
              <p>
                We talked to dozens of software engineers and kept hearing about
                three problems caused by poor cloud cost observability:
              </p>
              <p>
                (1)
                <i>Cost anomalies are slow to detect and hard to diagnose.</i>
                For example, a computer vision company noticed their AWS costs
                spiking one month. Costs accrued until they identified the
                culprit: one of their customers had put up a life-size cutout of
                John Wayne, and they were running non-stop facial recognition on
                it.
              </p>
              <p>
                (2) <i>No cost accountability in big orgs.</i> For example, a
                public tech company’s top priority last year was to increase
                gross margin. But they had no way to identify the highest cost
                managers/products or measure improvement despite tagging
                efforts.
              </p>
              <p>
                (3)
                <i>Uncertain and variable per-customer gross margins.</i> For
                example, a SaaS startup had one customer generating &gt;50% of
                its revenue. That customer’s usage of certain features had
                recently 1,000x’ed, and they weren’t sure the contract was still
                profitable.
              </p>
              <p>
                (If you’ve had an experience like this, we’d love to hear about
                it in the comments.)
              </p>
              <p>
                We built Dashdive because none of the existing cloud cost
                dashboard products solves all three of these problems, which
                often requires <i>sub-resource</i> cost attribution.
              </p>
              <p>
                Existing tools combine AWS, GCP, Datadog, Snowflake, etc. cost
                data in a single dashboard with additional features like
                alerting and cost cutting recommendations. This is sufficient in
                many cases, but it falls short when a company (a) wants
                per-customer, per-team or per-feature cost visibility and (b)
                has a multitenant architecture.
              </p>
              <p>
                By contrast, Dashdive uses observability tools to collect
                granular cloud usage data at the level of individual user
                actions (e.g. each API call or database transaction). We
                attribute this activity to the corresponding feature, the
                responsible customer and team and estimate its cost based on the
                applicable rate. The result is more detailed cost and usage data
                than can be obtained with tagging. This information can be used
                to detect anomalies in real-time and identify costly teams,
                features and customers. One of our customers is even using
                Dashdive to charge customers for their cloud usage.
              </p>
              <p>
                We use Kafka to ingest large volumes (&gt;100m/day) of product
                usage events, and our web dashboard supports real-time querying
                thanks to ClickHouse. This makes it fast and easy to answer
                questions like: “Over the past 14 days, how much vCPU time did
                customer X use on Kubernetes cluster A, and how much did that
                cost me?” You can answer such questions even when the same
                container or pod is shared by multiple customers, features
                and/or teams.
              </p>
              <p>
                You can test drive the product with example data here:
                <a href="https://demo.dashdive.com/"
                  >https://demo.dashdive.com/</a
                >. Given the high per-customer cost of our infrastructure and
                the manual steps required for setup on our part, we don’t offer
                self-serve onboarding or a public “free tier” to monitor your
                own cloud usage, but this demo gives a basic view of our
                product.
              </p>
              <p>
                Right now, Dashdive supports S3 and S3-compatible object storage
                providers. We’re working to add support for other providers and
                services, particularly compute services (EC2, GCP VMs, ECS, EKS,
                GKE, etc.).
              </p>
              <p>
                If there’s any service in particular you want to see supported,
                please tell us in the comments. We’re eager to see your
                comments, questions, concerns, etc.
              </p>
            </div>
          </section>
        </section>
        <section id="39178750">
          <h3>
            <a
              class="item"
              href="https://asteriskmag.com/issues/05/prediction-markets-have-an-elections-problem-jeremiah-johnson"
              >Prediction Markets Have an Elections Problem</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 17:02:56</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39178750"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39178521">
          <h3>
            <a class="item" href="https://github.com/oxidecomputer/helios"
              >Oxide Computer releases distribution of illumos intended to power
              the Oxide Rack</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 16:47:05</span
              ><span class="points-container"
                >Points: <span class="points">185</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39178521"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39177206">
          <h3>
            <a
              class="item"
              href="https://www.derekau.net/blog/2019/07/10/paintings-of-the-traditional-porcelain-process"
              >Paintings of the Traditional Porcelain Process (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 15:17:54</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39177206"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39176899">
          <h3>
            <a
              class="item"
              href="https://stratechery.com/2024/the-apple-vision-pros-missing-apps/"
              >The Apple Vision Pro’s missing apps</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 14:53:51</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39176899"
                  >Comments</a
                ><span class="descendants">: 368</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39176877">
          <h3>
            <a
              class="item"
              href="https://www.freightwaves.com/news/how-walmart-uses-trucking-to-dominate-american-retail"
              >Why Walmart pays its truck drivers 6 figures</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 14:51:47</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39176877"
                  >Comments</a
                ><span class="descendants">: 171</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39176797">
          <h3>
            <a
              class="item"
              href="https://xuanwo.io/2024/02-what-i-talk-about-when-i-talk-about-query-optimizer-part-1/"
              >What I talk about when I talk about query optimizer (part 1): IR
              design</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 14:45:08</span
              ><span class="points-container"
                >Points: <span class="points">115</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39176797"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39176730">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/culture/article/20240129-dr-strangelove-at-60-the-mystery-behind-kubricks-cold-war-masterpiece"
              >Dr Strangelove at 60</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 14:38:35</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39176730"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39176570">
          <h3>
            <a class="item" href="https://github.com/collabora/WhisperFusion"
              >Show HN: WhisperFusion – Low-latency conversations with an AI
              chatbot</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 14:23:10</span
              ><span class="points-container"
                >Points: <span class="points">201</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39176570"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
            <div class="text">
              WhisperFusion builds upon the capabilities of open source tools
              WhisperLive and WhisperSpeech to provide a seamless conversations
              with an AI chatbot.
            </div>
          </section>
        </section>
        <section id="39176297">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2024/01/29/amazon-terminates-irobot-deal-vacuum-maker-to-lay-off-31percent-of-staff.html"
              >Amazon and iRobot call off their planned acquisition</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 13:59:03</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39176297"
                  >Comments</a
                ><span class="descendants">: 166</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39175883">
          <h3>
            <a
              class="item"
              href="https://abcnews.go.com/GMA/Family/florida-house-representatives-approves-bill-ban-social-media/story?id=106672586"
              >Florida House of Representatives approves bill to ban social
              media for kids &amp;lt; 16</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 13:20:16</span
              ><span class="points-container"
                >Points: <span class="points">190</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39175883"
                  >Comments</a
                ><span class="descendants">: 331</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39175873">
          <h3>
            <a class="item" href="https://everything.curl.dev/libcurl/libcurl"
              >—-libcurl</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 13:19:20</span
              ><span class="points-container"
                >Points: <span class="points">563</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39175873"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39175423">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/space/2024/01/now-that-weve-flown-on-mars-what-comes-next-in-aerial-planetary-exploration/"
              >Ingenuity had more computing power than all NASA deep space
              missions combined</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 12:19:17</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39175423"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39175393">
          <h3>
            <a class="item" href="https://svelte-native.technology/"
              >Svelte Native: The Svelte Mobile Development Experience</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 12:13:58</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39175393"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39174549">
          <h3>
            <a class="item" href="https://teropa.info/harmonics-explorer/"
              >Harmonics Explorer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 09:51:22</span
              ><span class="points-container"
                >Points: <span class="points">235</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39174549"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39173455">
          <h3>
            <a
              class="item"
              href="https://nosferalatu.com/HigherOrderDerivativesTransforms.html"
              >Higher Order Derivatives of Transforms</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 06:44:10</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39173455"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39172859">
          <h3>
            <a
              class="item"
              href="https://www.damtp.cam.ac.uk/user/tong/em/dyson.pdf"
              >Why is Maxwell's theory so hard to understand? (2007) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 05:00:39</span
              ><span class="points-container"
                >Points: <span class="points">215</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39172859"
                  >Comments</a
                ><span class="descendants">: 206</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39172732">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/2024/01/29/the-twins-obsession"
              >The Twins Obsession</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-29 @ 04:37:51</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39172732"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39169972">
          <h3>
            <a class="item" href="https://www.androidarts.com/df/dorf.htm"
              >An artists interpretation of the creatures of Dwarf Fortress</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-28 @ 21:26:39</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39169972"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39168986">
          <h3>
            <a
              class="item"
              href="https://www.vitling.xyz/i-need-to-grow-away-from-these-roots/"
              >I need to grow away from these roots</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-28 @ 19:29:23</span
              ><span class="points-container"
                >Points: <span class="points">380</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39168986"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39165328">
          <h3>
            <a
              class="item"
              href="https://jarbus.net/blog/take-the-road-most-documented/"
              >Take the Road Most Documented</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-28 @ 13:07:50</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39165328"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39165100">
          <h3>
            <a
              class="item"
              href="https://thehustle.co/the-lucrative-business-of-lost-airplane-luggage/"
              >The company that sells your lost airplane luggage</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-28 @ 12:36:49</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39165100"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39163556">
          <h3>
            <a
              class="item"
              href="https://web.archive.org/web/20100524023205/http://playstation2-linux.com:80/"
              >Linux for Playstation 2</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-28 @ 08:26:52</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39163556"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
