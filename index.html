<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42200099">
          <h3>
            <a
              class="item"
              href="https://github.com/gtls64/MontyHome-Hackers-Guide"
              >Show HN: We Open-Sourced Our Compost Monitoring Tech – Use It for
              Your Projects</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-21 @ 01:30:07</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42200099"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42200014">
          <h3>
            <a
              class="item"
              href="https://www.denormalized.io/blog/building-databases"
              >Building Databases over a Weekend</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-21 @ 01:16:46</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42200014"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42199938">
          <h3>
            <a
              class="item"
              href="https://jobs.ashbyhq.com/vapi/4246b127-9f69-4a57-ac70-d16041f8403b"
              >Vapi (YC W21) Is Hiring Founding Senior Engineer (Front End)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-21 @ 01:00:39</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42199527">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2024/11/20/24301660/apple-doj-motion-dismiss-antitrust-lawsuit"
              >Apple fights to keep DOJ antitrust suit from reaching trial</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-21 @ 00:03:49</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42199527"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42199486">
          <h3>
            <a class="item" href="https://electrobun.dev/"
              >Electrobun: Cross-platform desktop applications written in
              TypeScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 23:58:20</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42199486"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42199447">
          <h3>
            <a
              class="item"
              href="https://www.ualberta.ca/en/folio/2024/11/weight-loss-drug-found-to-shrink-heart-muscle.html"
              >Weight-loss drug found to shrink heart muscle in mice, human
              cells</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 23:53:25</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42199447"
                  >Comments</a
                ><span class="descendants">: 165</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42199301">
          <h3>
            <a
              class="item"
              href="https://torrentfreak.com/z-library-helps-students-to-overcome-academic-poverty-study-finds-241120/"
              >Z-Library Helps Students to Overcome Academic Poverty, Study
              Finds</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 23:36:10</span
              ><span class="points-container"
                >Points: <span class="points">154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42199301"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42199112">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/world/2024/nov/19/bird-flu-cases-mutation-canada"
              >Bird flu in Canada may have mutated to become more transmissible
              to humans</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 23:11:36</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42199112"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42198954">
          <h3>
            <a class="item" href="https://github.com/doxx/darkflare"
              >Doxx/Darkflare: DarkFlare TCPoCDN (TCP over CDN)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 22:49:41</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42198954"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42198635">
          <h3>
            <a
              class="item"
              href="https://blog.cloudflare.com/resilient-internet-connectivity-baltic-cable-cuts/"
              >Europe's Internet resilience mitigates impact of submarine cable
              cuts</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 22:10:31</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42198635"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42198611">
          <h3>
            <a class="item" href="https://github.com/opennextjs/opennextjs-aws"
              >Show HN: Self-Host Next.js in Production</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 22:07:54</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42198611"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42198115">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2024/11/google-cracks-down-on-parasite-seo-punishing-established-publishers/"
              >Google stops letting sites like Forbes rule search for "Best CBD
              Gummies"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 21:07:28</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42198115"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42197741">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42197741"
              >Show HN: Autotab – Programmable AI browser for turning web tasks
              into APIs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 20:22:32</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42197741"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
            <div class="text">
              <a href="https://autotab.com">https://autotab.com</a>). Autotab is
              a chrome-based browser you can teach to do complex tasks, with a
              simple API for running them from your app or backend.
              <p>
                Here is a walkthrough of how it works:
                <a href="https://youtu.be/63co74JHy1k"
                  >https://youtu.be/63co74JHy1k</a
                >, and you can try it for free at
                <a href="https://autotab.com">https://autotab.com</a> by
                downloading the app.
              </p>
              <p>Why a dedicated editor?</p>
              <p>
                The number one blocker we've found in building more flexible,
                agentic automations is performance quality BY FAR (<a
                  href="https://www.langchain.com/stateofaiagents#barriers-and-challenges"
                  >https://www.langchain.com/stateofaiagents#barriers-and-chall...</a
                >). For all the talk of cost, latency, and safety, the fact is
                most people are still just struggling to get agents to work. The
                keys to solving reliability are better models, yes, but also
                intent specification. Even humans don't zero-shot these tasks
                from a prompt. They need to be shown how to perform them, and
                then refined with question-asking + feedback over time. It is
                also quite difficult to formulate complete requirements on the
                spot from memory.
              </p>
              <p>
                The editor makes it easy to build the specification up as you
                step through your workflow, while generating successful task
                trajectories for the model. This is the only way we've been able
                to get the reliability we need for production use cases.
              </p>
              <p>But why build a browser?</p>
              <p>
                Autotab started as a Chrome extension (with a Show HN post!
                <a href="https://news.ycombinator.com/item?id=37943931"
                  >https://news.ycombinator.com/item?id=37943931</a
                >). As we iterated with users, we realized that we needed to
                focus on creating the control surface for intent specification,
                and that being stuck in a chrome sidepanel wasn't going to work.
                We also knew that we needed a level of control for the model
                that we couldn't get without owning the browser. In Autotab, the
                browser becomes a canvas on which the user and the model are
                taking turns showing and explaining the task.
              </p>
              <p>Key features:</p>
              <p>
                1. Self-healing automations that don't break when sites change
              </p>
              <p>
                2. Dedicated authoring tool that builds memory for the model
                while defining steps for the automation
              </p>
              <p>
                3. Control flows and deep configurability to keep automations on
                track, even when navigating complex reasoning tasks
              </p>
              <p>4. Works with any website (no site-specific APIs needed)</p>
              <p>5. Runs securely in the cloud or locally</p>
              <p>6. Simple REST API + client libraries for Python, Node</p>
              <p>
                We'd love to get any early feedback from the HN community, ideas
                for where you'd like the product to go, or experiences in this
                space. We will be in the comments for the next few hours to
                respond!
              </p>
            </div>
          </section>
        </section>
        <section id="42196841">
          <h3>
            <a
              class="item"
              href="https://blog.google/technology/google-deepmind/alphaqubit-quantum-error-correction/"
              >AlphaQubit: AI to identify errors in Quantum Computers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 18:37:04</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42196841"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42196794">
          <h3>
            <a
              class="item"
              href="https://labs.ripe.net/author/emileaben/does-the-internet-route-around-damage-baltic-sea-cable-cuts/"
              >Does the Internet Route Around Damage? – Baltic Sea Cable Cuts</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 18:30:59</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42196794"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42196226">
          <h3>
            <a class="item" href="https://msgtn.xyz/rebuild_of_blossom"
              >Show HN: Rebuild of Blossom, an open-source social robot</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 17:28:35</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42196226"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
            <div class="text">
              <p>
                Blossom is an open-source robot platform for human-robot
                interaction (HRI) research that I developed during my PhD. I’ve
                used Blossom for research in design, machine learning, and
                telepresence; others have made Blossoms for their own research
                purposes. I have continued working on “rebuilding” the entire
                platform: I redesigned the inner frame as a model kit, complete
                with Gunpla-inspired runners and instructions, and refactored
                the codebase as r0b0, a Python library for communicating between
                hardware peripherals and software applications. In preparation
                to present Blossom at Maker Faire Coney Island, I refined the
                telepresence interface and enabled conversational interaction
                with a language model. The new repository is available on GitHub
                and includes documentation for construction.
              </p>
            </div>
          </section>
        </section>
        <section id="42196037">
          <h3>
            <a
              class="item"
              href="https://cacm.acm.org/opinion/between-the-booms-ai-in-winter/"
              >Between the Booms: AI in Winter – Communications of the ACM</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 17:11:14</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42196037"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42195994">
          <h3>
            <a class="item" href="https://www.philipzucker.com/sql_graph_csp/"
              >SQL, Homomorphisms and Constraint Satisfaction Problems</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 17:07:18</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42195994"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42195895">
          <h3>
            <a
              class="item"
              href="https://news.mit.edu/2024/mit-tuition-undergraduates-family-income-1120"
              >Undergraduates with family income below $200k will be
              tuition-free at MIT</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 16:59:33</span
              ><span class="points-container"
                >Points: <span class="points">376</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42195895"
                  >Comments</a
                ><span class="descendants">: 272</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42195817">
          <h3>
            <a
              class="item"
              href="https://newscenter.lbl.gov/2024/10/30/exploring-the-cost-and-feasibility-of-battery-electric-ships/"
              >Exploring the Cost and Feasibility of Battery-Electric Ships</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 16:52:53</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42195817"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42194587">
          <h3>
            <a class="item" href="https://unlocked.microsoft.com/vatican/"
              >La Basilica Di San Pietro</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 15:15:16</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42194587"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42194540">
          <h3>
            <a
              class="item"
              href="https://catonmat.net/unix-utilities-pipe-viewer"
              >Pipe Viewer – A Unix Utility You Should Know About</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 15:09:43</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42194540"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42194327">
          <h3>
            <a
              class="item"
              href="https://www.construction-physics.com/p/how-good-are-american-roads"
              >How good are American roads?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 14:45:23</span
              ><span class="points-container"
                >Points: <span class="points">172</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42194327"
                  >Comments</a
                ><span class="descendants">: 377</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42193771">
          <h3>
            <a
              class="item"
              href="https://history.stackexchange.com/questions/57033/what-is-the-origin-of-the-lake-tank-image-that-has-become-a-meme"
              >What is the origin of the lake tank image that has become a meme?
              (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 13:30:03</span
              ><span class="points-container"
                >Points: <span class="points">499</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42193771"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42193530">
          <h3>
            <a class="item" href="https://cardo-podcast.github.io/"
              >Show HN: Cardo ‒ Open Source desktop podcast client</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 12:56:15</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42193530"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
            <div class="text">
              <p>
                Hi, I'm an amateur developer from Spain. I have released this
                desktop podcast client that works on Windows, Mac and Linux.
              </p>
              <p>
                It's a modest project, but it might be useful for you, it has
                syncing capabilities with Antennapod, Kasts, Repod or other
                clients. You can manage your subscriptions, queue episodes and
                even download them to listen to later.
              </p>
              <p>I look forward to hearing your thoughts.</p>
            </div>
          </section>
        </section>
        <section id="42191709">
          <h3>
            <a
              class="item"
              href="https://blog.frost.kiwi/analytical-anti-aliasing/"
              >AAA – Analytical Anti-Aliasing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 08:03:20</span
              ><span class="points-container"
                >Points: <span class="points">471</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42191709"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42187494">
          <h3>
            <a
              class="item"
              href="https://nianticlabs.com/news/largegeospatialmodel"
              >Niantic announces "Large Geospatial Model" trained on Pokémon Go
              player data</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 20:02:05</span
              ><span class="points-container"
                >Points: <span class="points">224</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42187494"
                  >Comments</a
                ><span class="descendants">: 173</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42174085">
          <h3>
            <a
              class="item"
              href="https://zed.dev/blog/zed-decoded-rope-optimizations-part-1"
              >Bit-twiddling optimizations in Zed's Rope</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-18 @ 16:39:10</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42174085"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42172978">
          <h3>
            <a
              class="item"
              href="https://monzool.net/blog/2024/07/14/a-second-search-for-bash-scripting-alternatives/"
              >A Second Search for Bash Scripting Alternatives</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-18 @ 15:08:25</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42172978"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42147135">
          <h3>
            <a class="item" href="https://fashionhistory.fitnyc.edu/"
              >Fashion History Timeline</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 14:15:57</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42147135"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
