<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42102506">
          <h3>
            <a class="item" href="https://ben-mini.github.io/2024/img-0416"
              >IMG_0416</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-10 @ 20:45:33</span
              ><span class="points-container"
                >Points: <span class="points">272</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42102506"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42102422">
          <h3>
            <a
              class="item"
              href="https://wellcomecollection.org/stories/the-soul-in-the-stomach"
              >The Soul in the Stomach (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-10 @ 20:30:54</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42102422"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42102262">
          <h3>
            <a class="item" href="https://rust-lang.github.io/mdBook/"
              >MdBook – a command line tool to create books with Markdown</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-10 @ 20:00:58</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42102262"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42102235">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42102235"
              >Is 3D printing being held back by an invalid patent?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-10 @ 19:56:00</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42102235"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
            <div class="text">
              <p>
                A method to drastically reduce this effect is described in an
                expired Stratasys patent, US1997/5653925A. As of this writing, I
                have not seen this feature implemented in any of the common
                open-source slicers. I would have expected this
                now-public-domain knowledge to have made its way into the
                slicers we use since the patent expired in 2017.
              </p>
              <p>
                With some investigation, I believe this may be because of the
                2023 patent US2023/11813789B2, to my knowledge only implemented
                as a proprietary in-house product of a 3d printing service house
                which appears to make the same claims illustrated in the 1997
                Stratasys patent.
              </p>
              <p>
                I am not expertly versed in patent law, but this patent would
                seem to have been granted in error. The fact that the 2023
                patent actually references the Stratasys patent from 1997* makes
                the issuance of this patent even more baffling. At any rate,
                this seems like a low-hanging opportunity for a significant
                improvement in print strength that could benefit millions of
                users.
              </p>
              <p>
                *The 2023 patent references the 1997 Stratasys patent as
                “teaching a process for adjusting the deposition rate .. to
                provide a predetermined porosity rate” but neglects to mention
                that the core claim of the patent was the staggered bead heights
                claimed.
              </p>
              <p>
                In referencing the 1997 patent the 2023 work also gives a
                single-digit error in the patent number, as well as other
                “minor” errors in other patent numbers referenced in the patent.
                These misleading references could have impeded the examiner’s
                role in determining the validity of the patent.
              </p>
              <p>
                https://patentimages.storage.googleapis.com/08/f6/2b/d3d996474f4de2/US11813789.pdf
              </p>
              <p>
                https://patentimages.storage.googleapis.com/ea/e7/3c/2b836c9a51e18b/US5653925.pdf
              </p>
              <p>Looking up the 2023 patent filer leads to this:</p>
              <p>https://www.addmangroup.com/</p>
            </div>
          </section>
        </section>
        <section id="42101916">
          <h3>
            <a
              class="item"
              href="https://people.math.osu.edu/nevai.1/AT/ERDOS/erdos_washington_post.html"
              >A life that added up to something (Obituary of Paul Erdòs)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-10 @ 19:04:42</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42101916"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42101902">
          <h3>
            <a
              class="item"
              href="https://subsublibrarian.com/2022/04/13/the-history-of-the-epigraph-from-appointment-in-samarra/"
              >The history of the epigraph from Appointment in Samarra (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-10 @ 19:01:40</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42101902"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42101742">
          <h3>
            <a class="item" href="https://readymag.website/u2481798807/5057562/"
              >Pi Chess Board</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-10 @ 18:40:25</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42101742"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42101729">
          <h3>
            <a
              class="item"
              href="https://grantslatton.com/software-pathfinding#algorithms-we-develop-software-by"
              >Algorithms We Develop Software By</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-10 @ 18:37:49</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42101729"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42101688">
          <h3>
            <a class="item" href="https://github.com/infinition/Bjorn"
              >Bjorn: A powerful network scanning and offensive security tool
              for Raspberry Pi</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-10 @ 18:30:55</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42101688"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42101536">
          <h3>
            <a
              class="item"
              href="https://foundation.rust-lang.org/news/rust-trademark-policy-updates/"
              >Rust Trademark Policy Updates</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-10 @ 18:05:45</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42101536"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42101434">
          <h3>
            <a
              class="item"
              href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Locks_API"
              >Web Locks API</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-10 @ 17:46:26</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42101434"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42101327">
          <h3>
            <a
              class="item"
              href="https://swapnilchauhan.com/blog/procrastination-and-the-fear-of-not-being-good-enough"
              >Procrastination and the fear of not being good enough</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-10 @ 17:23:59</span
              ><span class="points-container"
                >Points: <span class="points">209</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42101327"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42101312">
          <h3>
            <a
              class="item"
              href="https://learn.microsoft.com/en-us/dotnet/fsharp/whats-new/fsharp-9"
              >What's New in F# 9</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-10 @ 17:20:26</span
              ><span class="points-container"
                >Points: <span class="points">157</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42101312"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42101190">
          <h3>
            <a
              class="item"
              href="https://aaronparecki.com/2024/08/31/9/too-many-projects"
              >Thoughts on the Resiliency of Web Projects</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-10 @ 16:53:57</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42101190"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42101181">
          <h3>
            <a class="item" href="https://self-issued.info/?p=2573"
              >OpenID Connect specifications published as ISO standards</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-10 @ 16:53:19</span
              ><span class="points-container"
                >Points: <span class="points">184</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42101181"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42100876">
          <h3>
            <a class="item" href="https://shipilev.net/jvm/anatomy-quarks/"
              >JVM Anatomy Quarks</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-10 @ 16:09:07</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42100876"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42100819">
          <h3>
            <a class="item" href="https://github.com/bhavnicksm/chonkie"
              >Show HN: Chonkie – A Fast, Lightweight Text Chunking Library for
              RAG</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-10 @ 15:58:25</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42100819"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
            <div class="text">
              <p>Core features:</p>
              <p>- 21MB default install vs 80-171MB alternatives</p>
              <p>- 33x faster token chunking than popular alternatives</p>
              <p>
                - Supports multiple chunking strategies: token, word, sentence,
                and semantic
              </p>
              <p>
                - Works with all major tokenizers (transformers, tokenizers,
                tiktoken)
              </p>
              <p>- Zero external dependencies for basic functionality</p>
              <p>Technical optimizations:</p>
              <p>
                - Uses tiktoken with multi-threading for faster tokenization
              </p>
              <p>- Implements aggressive caching and precomputation</p>
              <p>- Running mean pooling for efficient semantic chunking</p>
              <p>- Modular dependency system (install only what you need)</p>
              <p>
                Benchmarks and code:
                <a href="https://github.com/bhavnicksm/chonkie"
                  >https://github.com/bhavnicksm/chonkie</a
                >
              </p>
              <p>
                Looking for feedback on the architecture and performance
                optimizations. What other chunking strategies would be useful
                for RAG applications?
              </p>
            </div>
          </section>
        </section>
        <section id="42100660">
          <h3>
            <a
              class="item"
              href="https://blog.ppresume.com/posts/on-typesetting-engines"
              >Typesetting Engines: A Programmer's Perspective</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-10 @ 15:21:00</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42100660"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42100645">
          <h3>
            <a
              class="item"
              href="https://www.cell.com/neuron/fulltext/S0896-6273(24)00726-8?_returnURL=https%3A%2F%2Flinkinghub.elsevier.com%2Fretrieve%2Fpii%2FS0896627324007268%3Fshowall%3Dtrue"
              >Functional architecture of cerebral cortex during naturalistic
              movie watching</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-10 @ 15:17:31</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42100645"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42100110">
          <h3>
            <a
              class="item"
              href="https://www.petercollingridge.co.uk/blog/mathematics-toys-and-games/dobble/"
              >Dobble (The Mathematics Of) (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-10 @ 13:31:25</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42100110"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42099778">
          <h3>
            <a
              class="item"
              href="https://incoherency.co.uk/blog/stories/principles-harrison-timekeeper.html"
              >The Principles of Mr. Harrison's Time-Keeper</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-10 @ 12:11:31</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42099778"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42098491">
          <h3>
            <a
              class="item"
              href="https://matthew-bird.com/blogs/Audio-Decomposition.html"
              >Audio Decomposition – open-source seperation of music to
              constituent instruments</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-10 @ 03:57:37</span
              ><span class="points-container"
                >Points: <span class="points">247</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42098491"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42095580">
          <h3>
            <a class="item" href="https://opencoder-llm.github.io/"
              >OpenCoder: Open Cookbook for Top-Tier Code Large Language
              Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-09 @ 17:27:30</span
              ><span class="points-container"
                >Points: <span class="points">562</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42095580"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42095292">
          <h3>
            <a class="item" href="https://www.ironcalc.com/"
              >IronCalc – Open-Source Spreadsheet Engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-09 @ 16:36:19</span
              ><span class="points-container"
                >Points: <span class="points">641</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42095292"
                  >Comments</a
                ><span class="descendants">: 198</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42082430">
          <h3>
            <a class="item" href="https://jamcorder.com/"
              >Show HN: I made a tiny device for automatically recording digital
              pianos</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-07 @ 23:41:39</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42082430"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
            <div class="text">
              <p>
                A few years ago, I left my cushy big tech job to make hardware.
              </p>
              <p>
                And made the device I always wanted - an automatic piano
                recorder!
              </p>
              <p>
                I usually play piano improvisationally, and manually hitting
                record never meshed well with that. But there are always moments
                I wish I recorded, and now they are!
              </p>
              <p>
                Hopefully it scratches a similar itch for some of you as well!
              </p>
              <p>
                A few of the tech details: * built on an esp32-s3 * custom
                injection molded enclosure * BLE comms, sd card storage, DS1302
                RTC * android &amp; ios apps with Flutter * Shadertoy vfx
                support for video sharing
              </p>
              <p>- Chip</p>
            </div>
          </section>
        </section>
        <section id="42080434">
          <h3>
            <a
              class="item"
              href="https://mappingignorance.org/2024/10/30/probing-unknown-unknowns-a-new-generation-of-telescopes/"
              >Probing unknown unknowns: A new generation of telescopes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-07 @ 20:11:38</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42080434"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42080081">
          <h3>
            <a
              class="item"
              href="https://gizmodo.com/dna-from-pompeii-victims-reveals-surprising-relationships-amidst-the-chaos-2000520264"
              >DNA from Pompeii Victims Reveals Surprising Relationships Amidst
              the Chaos</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-07 @ 19:38:46</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42080081"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42075403">
          <h3>
            <a
              class="item"
              href="https://github.com/WebAssembly/memory64/blob/main/proposals/memory64/Overview.md"
              >Memory64</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-07 @ 10:27:06</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42075403"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42060750">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/2024/11/06/climate/oil-rocks-neft-daslari-caspian-sea-city/index.html"
              >Mind-Bending Soviet Era Oil Rig City on the Caspian Sea</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-06 @ 11:59:39</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42060750"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42055134">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-11-honeybee-gene-behavior.html"
              >Honeybee gene specifies collective behavior, research shows</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-05 @ 21:02:21</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42055134"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
