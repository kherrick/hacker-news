<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42196841">
          <h3>
            <a
              class="item"
              href="https://blog.google/technology/google-deepmind/alphaqubit-quantum-error-correction/"
              >AlphaQubit: AI to identify errors in Quantum Computers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 18:37:04</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42196841"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42196226">
          <h3>
            <a class="item" href="https://msgtn.xyz/rebuild_of_blossom"
              >Show HN: Rebuild of Blossom, an open-source social robot</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 17:28:35</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42196226"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <p>
                Blossom is an open-source robot platform for human-robot
                interaction (HRI) research that I developed during my PhD. I’ve
                used Blossom for research in design, machine learning, and
                telepresence; others have made Blossoms for their own research
                purposes. I have continued working on “rebuilding” the entire
                platform: I redesigned the inner frame as a model kit, complete
                with Gunpla-inspired runners and instructions, and refactored
                the codebase as r0b0, a Python library for communicating between
                hardware peripherals and software applications. In preparation
                to present Blossom at Maker Faire Coney Island, I refined the
                telepresence interface and enabled conversational interaction
                with a language model. The new repository is available on GitHub
                and includes documentation for construction.
              </p>
            </div>
          </section>
        </section>
        <section id="42196037">
          <h3>
            <a
              class="item"
              href="https://cacm.acm.org/opinion/between-the-booms-ai-in-winter/"
              >Between the Booms: AI in Winter – Communications of the ACM</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 17:11:14</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42196037"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42195994">
          <h3>
            <a class="item" href="https://www.philipzucker.com/sql_graph_csp/"
              >SQL, Homomorphisms and Constraint Satisfaction Problems</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 17:07:18</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42195994"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42195948">
          <h3>
            <a
              class="item"
              href="https://www.threatfabric.com/blogs/ghost-tap-new-cash-out-tactic-with-nfc-relay"
              >Ghost Tap: New cash-out tactic with NFC Relay</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 17:03:25</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42195948"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42195908">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42195908"
              >Converge (YC S23) is hiring senior product engineers (NYC,
              in-person)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 17:00:36</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
            <div class="text">
              <p>
                We graduated from the YC S23 cohort last year. Since then, we
                scaled to 7-figures in ARR, now serving 180+ customers
                (including publicly listed companies). All the while, we kept
                our team very small with just 2 engineers, making this a great
                opportunity to join an early-stage startup with strong traction.
              </p>
              <p>
                We are well-funded and backed by the founders of PostHog,
                Algolia, Postscript, Shipbob, Showpad, etc.
              </p>
              <p>---</p>
              <p>## Role</p>
              <p>
                We're looking for senior full-stack engineers who can ship
                product end-to-end. You will have ownership over solving
                specific customer problems, designing, building, and iterating
                on solutions.
              </p>
              <p>## Product</p>
              <p>
                We vertically integrate the modern data stack for B2C marketing
                teams by consolidating customer data collection, consent
                management, identity resolution, transformations, attribution,
                data forwarding, and analytics into a single platform.
              </p>
              <p>
                On top of our shared data infrastructure, we have 2
                customer-facing products
              </p>
              <p>
                - Connections: a CDP for marketing integrations — ‘Segment for
                e-commerce’
              </p>
              <p>
                - Analytics: custom attribution reporting — ‘Amplitude for
                e-commerce’
              </p>
              <p>
                These help VPs of Marketing &amp; Growth (1) understand how they
                acquire customers and (2) optimize their spend allocation for
                more profitable growth.
              </p>
              <p>---</p>
              <p>
                Apply here:
                <a
                  href="https://www.ycombinator.com/companies/converge/jobs/GQWZ40Z-senior-product-engineer"
                  >https://www.ycombinator.com/companies/converge/jobs/GQWZ40Z-...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="42195817">
          <h3>
            <a
              class="item"
              href="https://newscenter.lbl.gov/2024/10/30/exploring-the-cost-and-feasibility-of-battery-electric-ships/"
              >Exploring the Cost and Feasibility of Battery-Electric Ships</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 16:52:53</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42195817"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42195490">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/news/the-lede/the-northeast-is-becoming-fire-country"
              >The Northeast is becoming fire country</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 16:25:42</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42195490"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42194587">
          <h3>
            <a class="item" href="https://unlocked.microsoft.com/vatican/"
              >La Basilica Di San Pietro</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 15:15:16</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42194587"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42194355">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/11/15/dining/malort.html"
              >The Rise of Malört, an Unexpected Midwest princess</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 14:48:13</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42194355"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42194327">
          <h3>
            <a
              class="item"
              href="https://www.construction-physics.com/p/how-good-are-american-roads"
              >How good are American roads?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 14:45:23</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42194327"
                  >Comments</a
                ><span class="descendants">: 174</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42194315">
          <h3>
            <a class="item" href="https://artanis.dev/blog/1.0.0-release.html"
              >GNU Artanis 1.0.0 Released</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 14:44:41</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42194315"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42193885">
          <h3>
            <a
              class="item"
              href="https://untested.sonnet.io/notes/enso-design-constraints/"
              >Ensō: design constraints of a focussed writing tool</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 13:45:13</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42193885"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42193859">
          <h3>
            <a
              class="item"
              href="https://www.mpi-hd.mpg.de/personalhomes/fwerner/research/2021/09/grpc-for-ipc/"
              >Using gRPC for (local) inter-process communication – F. Werner's
              Research Page</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 13:42:11</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42193859"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42193793">
          <h3>
            <a class="item" href="https://github.com/greymattergames/unbug"
              >Show HN: Unbug – Rust macros for programmatically invoking
              breakpoints</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 13:33:15</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42193793"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
            <div class="text">
              <p>
                Due to reliance on core_intrinsics it is necessary to develop
                using nightly Rust, but there are stubs in place so a production
                build will not require nightly.
              </p>
              <p>
                I recently released version 0.2 which includes no_std support
                and adds optional log message arguments to the ensure macro.
              </p>
            </div>
          </section>
        </section>
        <section id="42193771">
          <h3>
            <a
              class="item"
              href="https://history.stackexchange.com/questions/57033/what-is-the-origin-of-the-lake-tank-image-that-has-become-a-meme"
              >What is the origin of the lake tank image that has become a meme?
              (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 13:30:03</span
              ><span class="points-container"
                >Points: <span class="points">321</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42193771"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42193663">
          <h3>
            <a
              class="item"
              href="https://web.cs.toronto.edu/news-events/news/flying-with-photons"
              >U of T computational imaging researchers harness AI to fly with
              light in motion</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 13:14:48</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42193663"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42193530">
          <h3>
            <a class="item" href="https://cardo-podcast.github.io/"
              >Show HN: Cardo ‒ Open Source desktop podcast client</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 12:56:15</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42193530"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
            <div class="text">
              <p>
                Hi, I'm an amateur developer from Spain. I have released this
                desktop podcast client that works on Windows, Mac and Linux.
              </p>
              <p>
                It's a modest project, but it might be useful for you, it has
                syncing capabilities with Antennapod, Kasts, Repod or other
                clients. You can manage your subscriptions, queue episodes and
                even download them to listen to later.
              </p>
              <p>I look forward to hearing your thoughts.</p>
            </div>
          </section>
        </section>
        <section id="42192336">
          <h3>
            <a
              class="item"
              href="https://www.abebooks.com/books/ex-library-books"
              >Discarded delights: The joy of ex-library books (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 09:58:39</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42192336"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42191709">
          <h3>
            <a
              class="item"
              href="https://blog.frost.kiwi/analytical-anti-aliasing/"
              >AAA – Analytical Anti-Aliasing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 08:03:20</span
              ><span class="points-container"
                >Points: <span class="points">340</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42191709"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42191394">
          <h3>
            <a
              class="item"
              href="https://bsky.app/profile/auonsson.bsky.social/post/3lbc5va7f722p"
              >Yi Peng 3 crossed both cables C-Lion 1 and BSC at times matching
              when they broke</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 06:56:47</span
              ><span class="points-container"
                >Points: <span class="points">307</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42191394"
                  >Comments</a
                ><span class="descendants">: 383</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42191354">
          <h3>
            <a
              class="item"
              href="https://scottlocklin.wordpress.com/2024/11/19/lush-my-favorite-small-programming-language/"
              >Lush: My favorite small programming language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 06:47:02</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42191354"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42190650">
          <h3>
            <a
              class="item"
              href="https://emschwartz.me/understanding-the-bm25-full-text-search-algorithm/"
              >Understanding the BM25 full text search algorithm</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-20 @ 03:43:10</span
              ><span class="points-container"
                >Points: <span class="points">242</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42190650"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42188816">
          <h3>
            <a
              class="item"
              href="https://www.newstatesman.com/culture/books/book-of-the-day/2024/11/political-afterlife-paradise-lost-milton-orlando-reade-review"
              >The Political Afterlife of Paradise Lost</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 22:35:21</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42188816"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42187766">
          <h3>
            <a class="item" href="https://github.com/OpenRiak"
              >Open Riak – open, modern Riak fork</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 20:29:30</span
              ><span class="points-container"
                >Points: <span class="points">208</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42187766"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42178916">
          <h3>
            <a
              class="item"
              href="https://pmc.ncbi.nlm.nih.gov/articles/PMC2997957/"
              >Why I hate the index finger (1980)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 00:35:15</span
              ><span class="points-container"
                >Points: <span class="points">241</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42178916"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42147860">
          <h3>
            <a class="item" href="https://sandimetz.com/99bottles"
              >Bottles of OOP now available in Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 15:39:16</span
              ><span class="points-container"
                >Points: <span class="points">214</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42147860"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42147252">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2410.16144"
              >1-Bit AI Infrastructure</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 14:28:23</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42147252"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42144816">
          <h3>
            <a class="item" href="https://github.com/dbohdan/recur"
              >Show HN: Retry a command with exponential backoff and jitter (+
              Starlark exprs)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 08:04:36</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42144816"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42135303">
          <h3>
            <a
              class="item"
              href="https://hwisnu.bearblog.dev/fireducks-pandas-but-100x-faster/"
              >FireDucks: Pandas but Faster</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-14 @ 11:48:30</span
              ><span class="points-container"
                >Points: <span class="points">306</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42135303"
                  >Comments</a
                ><span class="descendants">: 133</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
