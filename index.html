<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40324179">
          <h3>
            <a
              class="item"
              href="https://www.foto-webcam.eu/webcam/lucknerhaus/"
              >Most of Europe is glowing pink under the aurora</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 21:59:03</span
              ><span class="points-container"
                >Points: <span class="points">209</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40324179"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40324166">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=ywWwUuWRgsM"
              >Recompilation: A New Way to Keep N64 Games Alive [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 21:57:11</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40324166"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40324064">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2405.05904"
              >Does Fine-Tuning LLMs on New Knowledge Encourage
              Hallucinations?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 21:42:49</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40324064"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40323785">
          <h3>
            <a class="item" href="https://oneminutepark.tv/">One Minute Park</a>
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 21:04:56</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40323785"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40321867">
          <h3>
            <a
              class="item"
              href="https://krystalgamer.github.io/spidey-decomp-status-may/"
              >Spider-Man (Neversoft) Decompilation Project Progress Checkpoint
              – May 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 17:55:08</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40321867"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40321824">
          <h3>
            <a
              class="item"
              href="https://devblogs.microsoft.com/oldnewthing/20240510-00/?p=109742"
              >An informal comparison of the three major implementations of
              std:string</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 17:51:11</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40321824"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40320406">
          <h3>
            <a
              class="item"
              href="https://www.simonsfoundation.org/2024/05/10/simons-foundation-co-founder-mathematician-and-investor-jim-simons-dies-at-86/"
              >Jim Simons has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 15:51:01</span
              ><span class="points-container"
                >Points: <span class="points">764</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40320406"
                  >Comments</a
                ><span class="descendants">: 233</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40318714">
          <h3>
            <a class="item" href="https://github.com/MHNightCat/superfile"
              >Superfile – A fancy, pretty terminal file manager</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 13:27:20</span
              ><span class="points-container"
                >Points: <span class="points">241</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40318714"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40318542">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40318542"
              >Show HN: A web debugger an ex-Cloudflare team has been working on
              for 4 years</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 13:08:38</span
              ><span class="points-container"
                >Points: <span class="points">582</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40318542"
                  >Comments</a
                ><span class="descendants">: 145</span></span
              >
            </h4>
            <div class="text">
              <a href="https://jam.dev">https://jam.dev</a>
              <p>
                It’s called Jam and it prevents product managers (like I used to
                be) from being able to create vague and un-reproducible bug
                tickets (like I used to create).
              </p>
              <p>
                It’s actually really hard as a non-engineer to file useful bug
                tickets for engineers. Like, sometimes I thought I included a
                screenshot, but the important information the engineer needed
                was what was actually right outside the boundary of the
                screenshot I took. Or I'd write that something "didn't work" but
                the engineer wasn't sure if I meant that it returned an error or
                if it was unresponsive. So the engineer would be frustrated, I
                would be frustrated, and fixing stuff would slow to a halt while
                we went back and forth to clarify how to repro the issue over
                async Jira comments.
              </p>
              <p>
                It’s actually pretty crazy that while so much has changed in how
                we develop software (heck, we have types in javascript now*),
                the way we capture and report bugs is just as manual and lossy
                as it was in the 1990’s. We can run assembly in the browser but
                there’s still no tooling to help a non-engineer show a bug to an
                engineer productively.
              </p>
              <p>
                So that’s what Jam is. Dev tools + video in a link. It’s like a
                shareable HAR file synced to a video recording of the session.
                And besides video, you can use it to share an instant replay of
                a bug that just happened — basically a 30 second playback of the
                DOM as a video.
              </p>
              <p>
                We’ve spent a lot of time adding in a ton of niceties, like Jam
                writes automatic repro steps for you, and Jam’s dev tools use
                the same keyboard shortcuts you’re used to in Chrome dev tools,
                and our team’s personal favorite: Jam parses GraphQL responses
                and pulls out mutation names and errors (which is important
                because GraphQL uses one endpoint for all requests and always
                returns a 200, meaning you usually have to sift through every
                GraphQL request when debugging to find the one you’re looking
                for)
              </p>
              <p>
                We’re now 2 years in to the product being live and people have
                used Jam to fix more than 2 million bugs - which makes me so
                happy - but there’s still a ton to do. I wanted to open up for
                discussion here and get your feedback and opinions how can we
                make it even more valuable for you debugging?
              </p>
              <p>
                The worst part of the engineering job is debugging and not even
                being able to repro the issue, it’s not even really engineering,
                it’s just a communication gap, one that we should be able to
                solve with tools. So yeah excited to get your feedback and hear
                your thoughts how we can make debugging just a little less
                frustrating.
              </p>
              <p>
                (Jam is free to use forever — there is a paid tier for features
                real companies would need, but we’re keeping a large free plan
                forever. We learned to build products at Cloudflare and free
                tier is in our ethos, both my co-founder and I and about half
                the team is ex-Cloudflare) and what we loved there is how much
                great feedback we’d get because the product was mostly free to
                use. We definitely want to keep that going at Jam.)
              </p>
              <p>
                By the way, we’re hiring engineers and if this is a problem that
                excites you, we’d love to chat: jam.dev/careers
              </p>
            </div>
          </section>
        </section>
        <section id="40318487">
          <h3>
            <a
              class="item"
              href="https://www.swisstopo.admin.ch/en/swipos-gisgeo-for-rtk-and-postprocessing-applications"
              >Swipos-GIS/GEO, nationwide GNSS RTK correction for centimeter
              accurate location</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 13:02:54</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40318487"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40317740">
          <h3>
            <a
              class="item"
              href="https://developer.mozilla.org/en-US/docs/Web/API/Popover_API"
              >Popover API</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 11:41:12</span
              ><span class="points-container"
                >Points: <span class="points">334</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40317740"
                  >Comments</a
                ><span class="descendants">: 148</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40316814">
          <h3>
            <a
              class="item"
              href="https://www.think-cell.com/en/career/devblog/trip-report-cpp-now-2024"
              >Trip C++Now 2024 – think-cell</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 09:06:05</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40316814"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40316788">
          <h3>
            <a
              class="item"
              href="https://mathoverflow.net/questions/470951/is-the-largest-root-of-a-random-polynomial-more-likely-to-be-real-than-complex"
              >Is the largest root of a random real polynomial more likely real
              or complex?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 09:01:05</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40316788"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40316039">
          <h3>
            <a class="item" href="https://github.com/travisdoor/tine"
              >Tine Text Editor</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 06:43:36</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40316039"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40316021">
          <h3>
            <a
              class="item"
              href="https://johncarlosbaez.wordpress.com/2024/05/04/hexagonal-tiling-honeycomb/"
              >Hexagonal Tiling Honeycomb</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 06:40:14</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40316021"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40315970">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/articles/cjje132jvygo"
              >Roman Tyrian purple snail dye found in UK for first time</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 06:31:34</span
              ><span class="points-container"
                >Points: <span class="points">189</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40315970"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40315032">
          <h3>
            <a
              class="item"
              href="http://www.bramblyhill.com/admin/Pages/page/Membership-Card-Serial-Adapter.aspx"
              >Serial to Parallel Port Converter</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-10 @ 02:48:47</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40315032"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40313613">
          <h3>
            <a
              class="item"
              href="https://www.nasa.gov/missions/roman-space-telescope/how-nasas-roman-mission-will-hunt-for-primordial-black-holes/"
              >Nasa’s Roman Mission Will Hunt for Primordial Black Holes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-09 @ 22:33:44</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40313613"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40313451">
          <h3>
            <a
              class="item"
              href="https://www.sustainabilitybynumbers.com/p/peak-pollution"
              >The world has probably passed peak pollution</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-09 @ 22:11:41</span
              ><span class="points-container"
                >Points: <span class="points">263</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40313451"
                  >Comments</a
                ><span class="descendants">: 315</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40313264">
          <h3>
            <a class="item" href="https://ventrella.com/Clusters/"
              >Life-like particle system</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-09 @ 21:47:13</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40313264"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40312192">
          <h3>
            <a
              class="item"
              href="https://americanhistory.si.edu/collections/object-groups/slide-rules/cylindrical-slide-rules"
              >Cylindrical Slide Rules</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-09 @ 19:43:11</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40312192"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40301310">
          <h3>
            <a class="item" href="https://github.com/hugeicons/hugeicons-react"
              >Show HN: I created 3,800+ Open Source React Icons (Beautiful,
              Rounded Style)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-08 @ 18:17:45</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40301310"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
            <div class="text">
              <p>Features:</p>
              <p>
                - Beautifully rounded style - Over 3,800 icons - Editable stroke
                - Regularly adding new icons - Another standard version (less
                rounded) coming soon - Easy installation via npm or yarn
              </p>
            </div>
          </section>
        </section>
        <section id="40300515">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-05-mirror-flexibly-ray-microscopes.html"
              >New mirror that can be flexibly shaped improves X-ray
              microscopes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-08 @ 17:13:26</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40300515"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40297642">
          <h3>
            <a
              class="item"
              href="https://medium.com/@malikpiara/introducing-logicola-3-1aa4047ee335"
              >Logicola 3</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-08 @ 13:03:12</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40297642"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40294660">
          <h3>
            <a class="item" href="https://aestuans.github.io/blob/"
              >Show HN: A simple 2D fluid and gravity simulation with WASM and
              WebGL</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-08 @ 05:30:03</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40294660"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
            <div class="text">
              <p>
                Mainly an excuse for me to experiment with wasm and WebGL, but
                it makes for a surprisingly good fidget toy.
              </p>
            </div>
          </section>
        </section>
        <section id="40292452">
          <h3>
            <a class="item" href="https://parel.es/blog/quantum-dice"
              >Unix forking the universe by running IBM's free online quantum
              computer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-07 @ 22:52:07</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40292452"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40291012">
          <h3>
            <a
              class="item"
              href="https://news.mit.edu/2024/sound-suppressing-silk-can-create-quiet-spaces-0507"
              >Sound-suppressing silk can create quiet spaces</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-07 @ 20:23:29</span
              ><span class="points-container"
                >Points: <span class="points">250</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40291012"
                  >Comments</a
                ><span class="descendants">: 159</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40271057">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Laudatio_Turiae"
              >Laudatio Turiae</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-06 @ 04:06:09</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40271057"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40265928">
          <h3>
            <a
              class="item"
              href="https://melmagazine.com/en-us/story/orson-welles-drunk-wine-commercial"
              >I was at the clapperboard for Orson Welles' drunk wine commercial
              (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-05 @ 16:12:30</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40265928"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40258903">
          <h3>
            <a class="item" href="https://deno.com/blog/building-deno-kv"
              >Deno KV internals: building a database for the modern web</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-04 @ 17:01:25</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40258903"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
