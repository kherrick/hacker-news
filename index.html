<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="46082825">
          <h3>
            <a class="item" href="https://www.bbc.com/news/live/cvg4y6g74ert"
              >Flight disruption warning as Airbus requests modifications to 6k
              planes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 21:16:46</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46082825"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46082711">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=46082711"
              >Ask HN: What is the purpose of all these AI spam comments?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 20:58:15</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46082711"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
            <div class="text">
              <p>
                They don't appear to be karma whoring as (most of the time) they
                don't even seem to be expressing a positive opinion of the link.
                Just short, useless summaries that are often just a rephrasing
                of the information given in the post title.
              </p>
              <p>What do you think the purpose of this is?</p>
            </div>
          </section>
        </section>
        <section id="46082223">
          <h3>
            <a
              class="item"
              href="https://www.seangoedecke.com/bad-code-at-big-companies/"
              >Good engineers write bad code at big companies</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 19:59:32</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46082223"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46082204">
          <h3>
            <a class="item" href="https://github.com/gvanrossum/abc-unix"
              >The original ABC language, Python's predecessor (1991)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 19:58:13</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46082204"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46081704">
          <h3>
            <a
              class="item"
              href="https://www.anthropic.com/engineering/effective-harnesses-for-long-running-agents"
              >Effective harnesses for long-running agents</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 19:05:16</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46081704"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46081443">
          <h3>
            <a class="item" href="https://473999.net/pulse"
              >Show HN: Pulse 2.0 – Live co-listening rooms where anyone can be
              a DJ</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 18:39:34</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46081443"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
            <div class="text">
              <p>
                Pulse is what came out of that. Anyone can host a live audio
                stream from their browser tab or system audio. Listeners join,
                music recognition identifies tracks automatically, and there's
                chat with 7TV emotes. No account required - you get an anonymous
                code and you're in.
              </p>
              <p>
                We're running demo rooms that stream NTS Radio and SomaFM 24/7
                (indie project, not affiliated - we backlink to the original
                stations). There's also a "Money For Nothing 24/7" room if you
                want to loop that Dire Straits instrumental forever.
              </p>
              <p>
                Think of it as co-listening infrastructure. Bedroom DJs,
                listening parties, or just sharing your current vibe.
              </p>
            </div>
          </section>
        </section>
        <section id="46081188">
          <h3>
            <a class="item" href="https://blog.tymscar.com/posts/imgurukproxy/"
              >Imgur Geo-Blocked the UK, So I Geo-Unblocked My Network</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 18:15:50</span
              ><span class="points-container"
                >Points: <span class="points">181</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46081188"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46081053">
          <h3>
            <a
              class="item"
              href="https://clickhouse.com/docs/getting-started/example-datasets/hackernews-vector-search-dataset"
              >28M Hacker News comments as vector embedding search dataset</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 18:02:04</span
              ><span class="points-container"
                >Points: <span class="points">236</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46081053"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46080972">
          <h3>
            <a
              class="item"
              href="https://klezlab.it/rock-paper-scissors-solitaire.html"
              >Rock Paper Scissors Solitaire</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 17:54:05</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46080972"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46080916">
          <h3>
            <a class="item" href="https://molly.im/"
              >Molly: An Improved Signal App</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 17:48:25</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46080916"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46080769">
          <h3>
            <a
              class="item"
              href="https://www.iankduncan.com/engineering/2025-11-24-json-schema-demystified/"
              >JSON Schema Demystified: Dialects, Vocabularies and
              Metaschemas</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 17:34:26</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46080769"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46080737">
          <h3>
            <a class="item" href="https://netlist.io/"
              >Show HN: An LLM-Powered Tool to Catch PCB Schematic Mistakes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 17:30:41</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46080737"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46080597">
          <h3>
            <a class="item" href="https://instavm.io/blog/llm-anti-patterns"
              >Anti-patterns while working with LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 17:16:52</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46080597"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46080579">
          <h3>
            <a
              class="item"
              href="https://oshub.org/projects/retros-32/posts/getting-a-webserver-running"
              >C++ Web Server on my custom hobby OS</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 17:15:20</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46080579"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46080473">
          <h3>
            <a
              class="item"
              href="https://lux-magazine.com/article/privacy-eroticism/"
              >Bringing Sexy Back. Internet surveillance has killed eroticism</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 17:05:31</span
              ><span class="points-container"
                >Points: <span class="points">229</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46080473"
                  >Comments</a
                ><span class="descendants">: 148</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46080364">
          <h3>
            <a class="item" href="https://blog.yakkomajuri.com/blog/local-rag"
              >So you wanna build a local RAG?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 16:54:56</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46080364"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46080289">
          <h3>
            <a class="item" href="https://objectiveunclear.com/airloom.html"
              >Airloom – 3D Flight Tracker</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 16:49:12</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46080289"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46080218">
          <h3>
            <a class="item" href="https://susam.net/my-lobsters-interview.html"
              >Lobsters Interview</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 16:42:46</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46080218"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46080143">
          <h3>
            <a class="item" href="https://github.com/JB-SelfCompany/Tyr"
              >True P2P Email on Top of Yggdrasil Network</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 16:35:24</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46080143"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46079987">
          <h3>
            <a
              class="item"
              href="https://www.apolloacademy.com/ai-adoption-rates-starting-to-flatten-out/"
              >AI Adoption Rates Starting to Flatten Out</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 16:21:09</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46079987"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46079868">
          <h3>
            <a
              class="item"
              href="https://stohl.substack.com/p/exclusive-credit-report-shows-meta"
              >Meta hiding $27B in debt using advanced geometry</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 16:09:50</span
              ><span class="points-container"
                >Points: <span class="points">290</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46079868"
                  >Comments</a
                ><span class="descendants">: 145</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46079785">
          <h3>
            <a class="item" href="https://blog.plover.com/2016/07/01/#tmpdir"
              >Don't tug on that, you never know what it might be attached to
              (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 16:01:01</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46079785"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46079721">
          <h3>
            <a
              class="item"
              href="https://dub.uu.nl/en/news/can-dutch-universities-do-without-microsoft"
              >Can Dutch universities do without Microsoft?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 15:53:39</span
              ><span class="points-container"
                >Points: <span class="points">208</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46079721"
                  >Comments</a
                ><span class="descendants">: 195</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46078770">
          <h3>
            <a
              class="item"
              href="https://www.openpetition.de/petition/online/anerkennung-von-open-source-arbeit-als-ehrenamt-in-deutschland#petition-main"
              >Petition to formally recognize open source work as civic service
              in Germany</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 14:08:14</span
              ><span class="points-container"
                >Points: <span class="points">451</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46078770"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46077038">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/tech/ai/tech-titans-amass-multimillion-dollar-war-chests-to-fight-ai-regulation-88c600e1"
              >Tech Titans Amass Multimillion-Dollar War Chests to Fight AI
              Regulation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 09:21:55</span
              ><span class="points-container"
                >Points: <span class="points">177</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46077038"
                  >Comments</a
                ><span class="descendants">: 173</span></span
              >
            </h4>
            <div class="text">
              <a href="https://archive.is/j1XTl">https://archive.is/j1XTl</a>
            </div>
          </section>
        </section>
        <section id="46075882">
          <h3>
            <a class="item" href="https://github.com/NullPxl/banrays"
              >Show HN: Glasses to detect smart-glasses that have cameras</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 05:52:38</span
              ><span class="points-container"
                >Points: <span class="points">457</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46075882"
                  >Comments</a
                ><span class="descendants">: 166</span></span
              >
            </h4>
            <div class="text">
              <p>
                I've written a bunch more on the link (+photos are there), but
                essentially this uses 2 fingerprinting approaches: -
                retro-reflectivity of the camera sensor by looking at IR
                reflections. mixed results here. - wireless traffic (primarily
                BLE, also looking into BTC and wifi)
              </p>
              <p>
                For the latter, I'm currently just using an ESP32, and I can
                consistently detect when the Meta Raybans are 1) pairing, 2)
                first powered on, 3) (less consistently) when they're taken out
                of the charging case. When they do detect something, it plays a
                little jingle next to your ear.
              </p>
              <p>
                Ideally I want to be able to detect them when they're in use,
                and not just at boot. I've come across the nRF52840, which seems
                like it can follow directed BLE traffic beyond the initial
                broadcast, but from my understanding it would still need to
                catch the first CONNECT_REQ event regardless. On the bluetooth
                classic side of things, all the hardware looks really expensive!
                Any ideas are appreciated. Thanks!
              </p>
            </div>
          </section>
        </section>
        <section id="46040815">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/science/2025/11/why-synthetic-emerald-green-pigments-degrade-over-time/"
              >Why synthetic emerald-green pigments degrade over time</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-24 @ 23:52:48</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46040815"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46039317">
          <h3>
            <a
              class="item"
              href="https://blog.atuin.sh/introducing-the-new-runbook-execution-engine/"
              >Atuin’s New Runbook Execution Engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-24 @ 21:06:39</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46039317"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46028649">
          <h3>
            <a
              class="item"
              href="https://webb.is-a.dev/articles/generalizedprintf/"
              >Generalizing Printf in C</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-23 @ 23:54:55</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46028649"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46012803">
          <h3>
            <a class="item" href="https://github.com/hexagonal-sun/moss"
              >Moss: a Rust Linux-compatible kernel in 26,000 lines of code</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-22 @ 07:11:59</span
              ><span class="points-container"
                >Points: <span class="points">350</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46012803"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
