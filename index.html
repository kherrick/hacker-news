<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="46080737">
          <h3>
            <a class="item" href="https://netlist.io/"
              >Show HN: An LLM-Powered Tool to Catch PCB Schematic Mistakes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 17:30:41</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46080737"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46080579">
          <h3>
            <a
              class="item"
              href="https://oshub.org/projects/retros-32/posts/getting-a-webserver-running"
              >C++ Web Server on my custom hobby OS</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 17:15:20</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46080579"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46080473">
          <h3>
            <a
              class="item"
              href="https://lux-magazine.com/article/privacy-eroticism/"
              >Bringing Sexy Back. Internet surveillance has killed eroticism</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 17:05:31</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46080473"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46080424">
          <h3>
            <a
              class="item"
              href="https://www.macrumors.com/2025/11/28/intel-rumored-to-supply-new-mac-chip/"
              >Apple and Intel Rumored to Partner on Mac Chips</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 17:00:46</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46080424"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46080364">
          <h3>
            <a class="item" href="https://blog.yakkomajuri.com/blog/local-rag"
              >So you wanna build a local RAG?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 16:54:56</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46080364"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46080161">
          <h3>
            <a
              class="item"
              href="https://www.thedrive.com/news/stellantis-is-spamming-owners-screens-with-pop-up-ads-for-new-car-discounts"
              >Stellantis Is Spamming Owners' Screens with Pop-Up Ads for New
              Car Discounts</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 16:37:32</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46080161"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46080143">
          <h3>
            <a class="item" href="https://github.com/JB-SelfCompany/Tyr"
              >True P2P Email on Top of Yggdrasil Network</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 16:35:24</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46080143"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46080027">
          <h3>
            <a
              class="item"
              href="https://www.cyberdemon.org/2017/12/12/pink-lexical-slime.html"
              >Pink Lexical Slime: The Dark Side of Autocorrect</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 16:24:20</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46080027"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46079987">
          <h3>
            <a
              class="item"
              href="https://www.apolloacademy.com/ai-adoption-rates-starting-to-flatten-out/"
              >AI Adoption Rates Starting to Flatten Out</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 16:21:09</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46079987"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46079868">
          <h3>
            <a
              class="item"
              href="https://stohl.substack.com/p/exclusive-credit-report-shows-meta"
              >Meta hiding $27B in debt using advanced geometry</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 16:09:50</span
              ><span class="points-container"
                >Points: <span class="points">177</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46079868"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46079860">
          <h3>
            <a
              class="item"
              href="https://www.magazine.dirt.fyi/p/the-signal-is-the-noise"
              >The Signal Is the Noise</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 16:09:06</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46079860"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46079857">
          <h3>
            <a class="item" href="https://get.playtil.es"
              >Playtiles: The Pocket-Sized Gaming Platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 16:08:52</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46079857"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46079785">
          <h3>
            <a class="item" href="https://blog.plover.com/2016/07/01/#tmpdir"
              >Don't tug on that, you never know what it might be attached to</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 16:01:01</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46079785"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46079745">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=46079745"
              >Tell HN: Want a better HN? Visit /newest</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 15:57:27</span
              ><span class="points-container"
                >Points: <span class="points">193</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46079745"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
            <div class="text">
              <p>
                HN depends on people visiting /newest and upvoting or flagging
                what they see.
              </p>
              <p>
                A few minutes there each day probably does more for HN than
                commenting.
              </p>
              <p>
                It’s anonymous, thankless work, like Reddit’s old “Knights of
                New,” but it makes a difference.
              </p>
              <p>
                <a href="https://news.ycombinator.com/newest"
                  >https://news.ycombinator.com/newest</a
                >
              </p>
              <p>
                <a href="https://news.ycombinator.com/newsguidelines.html"
                  >https://news.ycombinator.com/newsguidelines.html</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="46079721">
          <h3>
            <a
              class="item"
              href="https://dub.uu.nl/en/news/can-dutch-universities-do-without-microsoft"
              >Can Dutch universities do without Microsoft?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 15:53:39</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46079721"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46079605">
          <h3>
            <a class="item" href="https://github.com/empowerd-cms/nyno"
              >Open-Source n8n Alternative for Workflow Building (GUI and Docker
              Included)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 15:44:04</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46079605"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46079567">
          <h3>
            <a
              class="item"
              href="https://cprimozic.net/notes/posts/generating-3d-meshes-from-text/"
              >Generating 3D Meshes from Text</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 15:40:49</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46079567"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46079460">
          <h3>
            <a
              class="item"
              href="https://www.sverigesradio.se/artikel/swedish-publishers-file-police-report-against-metas-zuckerberg-for-fraud"
              >Swedish publishers file police report against Meta's Zuckerberg
              for fraud</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 15:27:49</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46079460"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46078770">
          <h3>
            <a
              class="item"
              href="https://www.openpetition.de/petition/online/anerkennung-von-open-source-arbeit-als-ehrenamt-in-deutschland#petition-main"
              >Petition to formally recognize open source work as civic service
              in Germany</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 14:08:14</span
              ><span class="points-container"
                >Points: <span class="points">365</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46078770"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46078566">
          <h3>
            <a
              class="item"
              href="https://scienceclock.com/writing-builds-resilience-in-everyday-challenges-by-changing-your-brain/"
              >Writing Builds Resilience in Everyday Challenges by Changing Your
              Brain</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 13:43:17</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46078566"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46078138">
          <h3>
            <a
              class="item"
              href="https://nealstephenson.substack.com/p/a-remarkable-assertion-from-a16z"
              >A Remarkable Assertion from A16Z</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 12:41:32</span
              ><span class="points-container"
                >Points: <span class="points">251</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46078138"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46077964">
          <h3>
            <a
              class="item"
              href="https://tigerbeetle.com/blog/2025-11-28-tale-of-four-fuzzers/"
              >A Tale of Four Fuzzers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 12:11:39</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46077964"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46077136">
          <h3>
            <a
              class="item"
              href="https://justoffbyone.com/posts/math-of-why-you-cant-focus-at-work/"
              >The Math of Why You Can't Focus at Work</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 09:39:57</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46077136"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46077106">
          <h3>
            <a
              class="item"
              href="https://www.spinellis.gr/pubs/conf/2015-MSR-Unix-History/html/Spi15c.html"
              >A Repository with 44 Years of Unix Evolution</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 09:32:38</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46077106"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46077038">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/tech/ai/tech-titans-amass-multimillion-dollar-war-chests-to-fight-ai-regulation-88c600e1"
              >Tech Titans Amass Multimillion-Dollar War Chests to Fight AI
              Regulation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 09:21:55</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46077038"
                  >Comments</a
                ><span class="descendants">: 149</span></span
              >
            </h4>
            <div class="text">
              <a href="https://archive.is/j1XTl">https://archive.is/j1XTl</a>
            </div>
          </section>
        </section>
        <section id="46075882">
          <h3>
            <a class="item" href="https://github.com/NullPxl/banrays"
              >Show HN: Glasses to detect smart-glasses that have cameras</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 05:52:38</span
              ><span class="points-container"
                >Points: <span class="points">421</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46075882"
                  >Comments</a
                ><span class="descendants">: 153</span></span
              >
            </h4>
            <div class="text">
              <p>
                I've written a bunch more on the link (+photos are there), but
                essentially this uses 2 fingerprinting approaches: -
                retro-reflectivity of the camera sensor by looking at IR
                reflections. mixed results here. - wireless traffic (primarily
                BLE, also looking into BTC and wifi)
              </p>
              <p>
                For the latter, I'm currently just using an ESP32, and I can
                consistently detect when the Meta Raybans are 1) pairing, 2)
                first powered on, 3) (less consistently) when they're taken out
                of the charging case. When they do detect something, it plays a
                little jingle next to your ear.
              </p>
              <p>
                Ideally I want to be able to detect them when they're in use,
                and not just at boot. I've come across the nRF52840, which seems
                like it can follow directed BLE traffic beyond the initial
                broadcast, but from my understanding it would still need to
                catch the first CONNECT_REQ event regardless. On the bluetooth
                classic side of things, all the hardware looks really expensive!
                Any ideas are appreciated. Thanks!
              </p>
            </div>
          </section>
        </section>
        <section id="46075320">
          <h3>
            <a class="item" href="https://pocketbase.io/"
              >Pocketbase – open-source realtime back end in 1 file</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-28 @ 03:45:04</span
              ><span class="points-container"
                >Points: <span class="points">556</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46075320"
                  >Comments</a
                ><span class="descendants">: 153</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46068138">
          <h3>
            <a class="item" href="https://spikelog.com"
              >Show HN: Spikelog – A simple metrics service for scripts, cron
              jobs, and MVPs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-27 @ 11:10:51</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46068138"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
            <div class="text">
              <p>
                I built Spikelog because I kept wanting to track simple numbers
                over time but every time I looked at proper observability tools,
                I'd bounce off the setup complexity. I wanted to make something
                that didn't require a lot of thinking to use.
              </p>
              <p>Spikelog is made to be as simple as possible:</p>
              <p>
                - POST a JSON with chart name + value (you can add some tags as
                well but I've not tested this part works yet)
              </p>
              <p>- Chart appears automatically</p>
              <p>
                - 1,000 point rolling window per chart (old data expires, no
                retention config)
              </p>
              <p>- Max 10 charts</p>
              <p>That's basically the whole product.</p>
              <p>
                I built it in about a day using Cursor. The API is intentionally
                minimal so AI assistants can use it too.
              </p>
              <p>
                I have a prompt that lets your coding agent analyze a codebase
                and add tracking automatically (after you approve the plan).
              </p>
              <p>
                I used it to make Spikelog track itself:
                <a href="https://spikelog.com/p/spikelog"
                  >https://spikelog.com/p/spikelog</a
                >
              </p>
              <p>
                There's no alerting yet (that's next), no complex aggregations,
                no dashboards beyond the auto-generated charts. If you need real
                observability use something fully featured like Axiom or
                Datadog. This is for people who just want to see if a number
                went up or down and don't want to build that themselves. i.e.
                they want something slightly better than just logging the
                number.
              </p>
              <p>
                You can also share the charts publicly and I might add some
                password protection if there is demand for that.
              </p>
              <p>
                I haven't battle-tested it under heavy load. The rolling window
                deletion is naive (deletes oldest points on insert). There are
                probably edge cases I haven't hit yet.
              </p>
              <p>
                Would love feedback, especially if you try it and hit something
                broken.
              </p>
            </div>
          </section>
        </section>
        <section id="46039317">
          <h3>
            <a
              class="item"
              href="https://blog.atuin.sh/introducing-the-new-runbook-execution-engine/"
              >Atuin’s New Runbook Execution Engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-24 @ 21:06:39</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46039317"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46012803">
          <h3>
            <a class="item" href="https://github.com/hexagonal-sun/moss"
              >Moss: a Rust Linux-compatible kernel in 26,000 lines of code</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-22 @ 07:11:59</span
              ><span class="points-container"
                >Points: <span class="points">311</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46012803"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
