<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42376014">
          <h3>
            <a
              class="item"
              href="https://www.oecd.org/en/publications/do-adults-have-the-skills-they-need-to-thrive-in-a-changing-world_b263dc5d-en.html"
              >Do Adults Have the Skills They Need to Thrive in a Changing
              World?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-10 @ 11:54:54</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42376014"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42375210">
          <h3>
            <a
              class="item"
              href="https://zaidesanton.substack.com/p/the-slow-death-of-the-hands-on-engineering"
              >The slow death of the hands-on engineering manager</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-10 @ 09:24:01</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42375210"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42374823">
          <h3>
            <a
              class="item"
              href="https://old.reddit.com/r/neovim/comments/1h7vhmg/bro_been_developing_his_2k_star_plugin_on_a/"
              >Developer wrote 25k lines of Neovim plugin code using phone and
              touchscreen</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-10 @ 08:00:48</span
              ><span class="points-container"
                >Points: <span class="points">190</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42374823"
                  >Comments</a
                ><span class="descendants">: 111</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42373437">
          <h3>
            <a class="item" href="https://treecalcul.us/">Tree Calculus</a>
          </h3>
          <section>
            <h4>
              <span>2024-12-10 @ 03:30:32</span
              ><span class="points-container"
                >Points: <span class="points">299</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42373437"
                  >Comments</a
                ><span class="descendants">: 132</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42373106">
          <h3>
            <a
              class="item"
              href="https://2ro.co/post/769440256241123328/study-opencyc"
              >Is anyone playing with the combination of generative AI and
              OpenCyc?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-10 @ 02:32:17</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42373106"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42373098">
          <h3>
            <a class="item" href="https://www.savethearchive.com/"
              >Save Music, Save the Archive</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-10 @ 02:31:11</span
              ><span class="points-container"
                >Points: <span class="points">328</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42373098"
                  >Comments</a
                ><span class="descendants">: 169</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42373051">
          <h3>
            <a class="item" href="https://docs.racket-lang.org/2d/index.html"
              >2D Racket Syntax</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-10 @ 02:22:37</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42373051"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42372617">
          <h3>
            <a
              class="item"
              href="https://sbaziotis.com/compilers/common-misconceptions-about-compilers.html"
              >Common misconceptions about compilers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-10 @ 01:19:47</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42372617"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42372379">
          <h3>
            <a
              class="item"
              href="https://www.frontiersin.org/journals/public-health/articles/10.3389/fpubh.2024.1452085/full"
              >Added sugar intake and its associations with incidence of
              cardiovascular disease</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-10 @ 00:45:53</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42372379"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42371476">
          <h3>
            <a
              class="item"
              href="https://www.bitsaboutmoney.com/archive/debanking-and-debunking/"
              >Debanking (and Debunking?)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-09 @ 22:56:27</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42371476"
                  >Comments</a
                ><span class="descendants">: 138</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42371221">
          <h3>
            <a
              class="item"
              href="https://www.eetimes.com/the-age-of-chiplets-is-upon-us/"
              >The Age of Chiplets Is Upon Us</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-09 @ 22:24:14</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42371221"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42370709">
          <h3>
            <a
              class="item"
              href="https://www.everymansci.com/society/xylella-fastidiosa-and-olive-oil-a-billion-euro-crisis-brewing-in-europes-olive-groves/"
              >Xylella Fastidiosa: A crisis brewing in Europe's olive groves</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-09 @ 21:29:30</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42370709"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42370622">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/articles/cp9nxee2r0do"
              >What we know about CEO shooting suspect</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-09 @ 21:17:28</span
              ><span class="points-container"
                >Points: <span class="points">526</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42370622"
                  >Comments</a
                ><span class="descendants">: 1151</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42369622">
          <h3>
            <a
              class="item"
              href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4995517"
              >Fire risk assessment of battery home storage compared to general
              house fires</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-09 @ 19:33:40</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42369622"
                  >Comments</a
                ><span class="descendants">: 132</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42369476">
          <h3>
            <a class="item" href="https://trellis3d.github.io/"
              >Trellis – 3D mesh generative model</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-09 @ 19:19:07</span
              ><span class="points-container"
                >Points: <span class="points">333</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42369476"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42369294">
          <h3>
            <a
              class="item"
              href="https://home.cern/news/news/physics/alice-finds-first-ever-evidence-antimatter-partner-hyperhelium-4"
              >ALICE finds first ever evidence of the antimatter partner of
              hyperhelium-4</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-09 @ 19:01:17</span
              ><span class="points-container"
                >Points: <span class="points">244</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42369294"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42368872">
          <h3>
            <a
              class="item"
              href="https://www.ternary-computing.com/history/CPU-History.html"
              >Show HN: Ternary Computer System</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-09 @ 18:23:11</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42368872"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
            <div class="text">
              Hi everyone! I'm an Italian programmer, very passionate about
              computer architecture. Some time ago I realized that some
              architectures potentially much superior to the classic VonNeumann,
              have been forgotten because there were no reliable technical
              solutions to implement them. One of these architectures
              particularly struck me and it is the "Dataflow architecture", in
              which there is no Program counter, but the instructions are
              executed in real contemporaneity whenever the operands are
              available. In trying to find a technical solution that implements
              this type of architecture effectively (spoiler: yes, maybe I
              succeeded but I still have to test the real correct functioning!)
              I realized that this solution works more than well with three
              logical states. And at this point I discovered that perhaps it is
              better to implement a CPU with three states (ternary) instead of a
              white one. This as a first step to realize my dataflow solution.
              Obviously a world has opened up to me regarding ternary CPUs, I
              have discovered not only that they are the best solution
              implemented for a computing device, but also that an increasing
              number of university and researcher papers are dealing with them
              in recent times. This is also thanks to the enormous potential
              compared to normal CPUs; lower circuit complexity (and also lower
              consumption and lower heat production) but at the same time the
              truly formidable information representation capabilities compared
              to binary counterparts! So here I am creating this ternary CPU and
              all the hardware and software to be able to use it immediately. In
              the link you have found some other details, but obviously for
              questions, suggestions or anything else you can insert your
              comment here!
            </div>
          </section>
        </section>
        <section id="42368784">
          <h3>
            <a
              class="item"
              href="https://swarm.ptsecurity.com/new-dog-old-tricks-damagecard-attack-targets-memory-directly-thru-sd-card-reader/"
              >New dog, old trick: DaMAgeCard attack targets memory directly via
              SD card reader</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-09 @ 18:15:00</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42368784"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42368604">
          <h3>
            <a class="item" href="https://openai.com/index/sora-is-here/"
              >Sora is here</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-09 @ 18:02:10</span
              ><span class="points-container"
                >Points: <span class="points">993</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42368604"
                  >Comments</a
                ><span class="descendants">: 840</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42367649">
          <h3>
            <a
              class="item"
              href="https://blog.google/technology/research/google-willow-quantum-chip/"
              >Willow, Our Quantum Chip</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-09 @ 16:28:23</span
              ><span class="points-container"
                >Points: <span class="points">1149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42367649"
                  >Comments</a
                ><span class="descendants">: 449</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42366481">
          <h3>
            <a class="item" href="https://eugeneyan.com/writing/evals/"
              >Task-specific LLM evals that do and don't work</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-09 @ 14:23:31</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42366481"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42366025">
          <h3>
            <a class="item" href="https://github.com/pimalaya/himalaya"
              >Himalaya: CLI to Manage Emails</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-09 @ 13:17:07</span
              ><span class="points-container"
                >Points: <span class="points">326</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42366025"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42361404">
          <h3>
            <a class="item" href="https://msp.ucsd.edu/techniques.htm"
              >The Theory and Technique of Electronic Music (2006)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-08 @ 22:46:11</span
              ><span class="points-container"
                >Points: <span class="points">256</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42361404"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42358050">
          <h3>
            <a
              class="item"
              href="https://hazyresearch.stanford.edu/blog/2023-12-11-conv-tutorial"
              >Long Convolutions via Polynomial Multiplication</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-08 @ 16:38:10</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42358050"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42356447">
          <h3>
            <a
              class="item"
              href="https://blog.brixit.nl/conjuring-a-linux-distribution-out-of-thin-air/"
              >Conjuring a Linux distribution out of thin air</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-08 @ 11:00:01</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42356447"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42348855">
          <h3>
            <a class="item" href="https://airport.revolvertype.com/"
              >Now Boarding: The Story of Airport</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-07 @ 10:48:52</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42348855"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42348799">
          <h3>
            <a
              class="item"
              href="https://paul.mycpanel.princeton.edu/music242/shaefferinterview.html"
              >Pierre Schaeffer looking back on his career in musique concrète
              (1987)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-07 @ 10:36:03</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42348799"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42341343">
          <h3>
            <a
              class="item"
              href="https://www.bbc.co.uk/news/articles/c86w9n4jlvwo"
              >Oldest known wild bird lays egg at 74</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-06 @ 16:41:04</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42341343"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42308303">
          <h3>
            <a class="item" href="https://wattenberger.com/thoughts/fish-eye"
              >LLM abstraction levels inspired by fish eye lens</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-03 @ 16:55:15</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42308303"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42304020">
          <h3>
            <a class="item" href="https://30fps.net/pages/pixelart-scaling/"
              >A simple way to scale pixel art games</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-03 @ 08:16:05</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42304020"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
