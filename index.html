<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39126049">
          <h3>
            <a
              class="item"
              href="https://www.statsignificant.com/p/which-shows-got-their-finale-right"
              >Which Shows Got Their Finale Right, and Which Didn't? A
              Statistical Analysis</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-25 @ 04:00:24</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39126049"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39125799">
          <h3>
            <a class="item" href="https://geocities.ws/rehasoft/crusty.html"
              >Crusty, the Indestructible Mac</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-25 @ 03:04:39</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39125799"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39125646">
          <h3>
            <a
              class="item"
              href="https://github.com/lucidrains/self-rewarding-lm-pytorch"
              >Lucidrains/self-rewarding-lm-PyTorch: Self-Rewarding Language
              Model, from MetaAI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-25 @ 02:43:20</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39125646"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39125477">
          <h3>
            <a
              class="item"
              href="https://ollama.ai/blog/python-javascript-libraries"
              >Ollama releases Python and JavaScript Libraries</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-25 @ 02:17:35</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39125477"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39125063">
          <h3>
            <a class="item" href="https://github.com/jkool702/forkrun"
              >Forkrun: Runs multiple inputs through a command in parallel using
              bash coprocs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-25 @ 01:27:57</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39125063"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39124855">
          <h3>
            <a class="item" href="https://getjerry.com/careers"
              >Jerry (YC S17) Is Hiring Eng, PM, Data, Cos, Ops etc. (Remote)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-25 @ 01:01:59</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39124614">
          <h3>
            <a class="item" href="https://github.com/billziss-gh/imap"
              >Show HN: Integer Map Data Structure</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-25 @ 00:28:58</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39124614"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
            <div class="text">
              This project presents a new data structure for storing ordered
              integer maps. The proposed data structure is a compressive,
              cache-friendly, radix tree that has performance comparable to an
              unordered map (`std::unordered_map`) and is an order of magnitude
              faster than an ordered map (`std::map`).
            </div>
          </section>
        </section>
        <section id="39124514">
          <h3>
            <a
              class="item"
              href="https://www.righto.com/2010/06/using-arc-to-decode-venters-secret-dna.html"
              >Using Arc to decode Venter's DNA watermark (2010)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-25 @ 00:17:50</span
              ><span class="points-container"
                >Points: <span class="points">3</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39124514"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39124322">
          <h3>
            <a
              class="item"
              href="http://dmitry.gr/?r=05.Projects&amp;proj=34.%20springSD"
              >A minimal-part-count way to connect an SD card to a 68K</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-24 @ 23:55:39</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39124322"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39124256">
          <h3>
            <a
              class="item"
              href="https://knowablemagazine.org/content/article/mind/2021/are-spiders-intelligent"
              >Researchers find signs of intelligence among jumping spiders</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-24 @ 23:49:20</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39124256"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39124243">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=igrN_wd_g74"
              >Build your own drone tracking radar [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-24 @ 23:47:28</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39124243"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39124238">
          <h3>
            <a class="item" href="https://www.bunniestudios.com/blog/?p=284"
              >Tech Trend: Shanzhai (2009)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-24 @ 23:47:02</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39124238"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39123862">
          <h3>
            <a
              class="item"
              href="https://saashammer.com/blog/lightweight-javascript-framework-review-for-django-developers/"
              >Lightweight JavaScript Framework Review (For Django
              Developers)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-24 @ 23:06:12</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39123862"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39123795">
          <h3>
            <a class="item" href="https://avdi.codes/on-owning-software/"
              >On "Owning" Software</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-24 @ 22:58:50</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39123795"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39122286">
          <h3>
            <a class="item" href="https://github.com/flame/blis"
              >BLIS: A BLAS-like framework for basic linear algebra routines</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-24 @ 20:32:48</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39122286"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39122060">
          <h3>
            <a class="item" href="https://vintagetek.org/crt-manufacturing/"
              >CRT Manufacturing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-24 @ 20:13:39</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39122060"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39121521">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/openai-scrapped-promise-disclose-key-documents/"
              >OpenAI scrapped a promise to disclose key documents to the
              public</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-24 @ 19:21:11</span
              ><span class="points-container"
                >Points: <span class="points">454</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39121521"
                  >Comments</a
                ><span class="descendants">: 180</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39121101">
          <h3>
            <a
              class="item"
              href="https://www.ctrl-alt-test.fr/2024/how-we-made-an-animated-movie-in-8kb"
              >We made an animated movie in 8kB</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-24 @ 18:46:07</span
              ><span class="points-container"
                >Points: <span class="points">337</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39121101"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39120773">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/01/23/magazine/train-robbery-amazon-packages.html"
              >Train robbery for Amazon packages? More common than you think</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-24 @ 18:22:28</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39120773"
                  >Comments</a
                ><span class="descendants">: 220</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39120647">
          <h3>
            <a class="item" href="https://www.fundingsimulator.com/"
              >Show HN: Startup funding simulator</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-24 @ 18:11:55</span
              ><span class="points-container"
                >Points: <span class="points">444</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39120647"
                  >Comments</a
                ><span class="descendants">: 123</span></span
              >
            </h4>
            <div class="text">
              <p>
                We built a tool to help founders understand how modern
                fundraising (with safes) works, and how much dilution you can
                expect when raising money.
              </p>
              <p>
                The project is open-source. The code is a mess right now, but
                it'll get better I promise. You can also help with that.
              </p>
              <p>
                We didn't build this to make money. We genuinely did it because
                we were looking for it, and couldn't find it.
              </p>
              <p>
                We're in fact in the process of fundraising for a company, and
                at first glance the process looks simple. Just an excel sheet
                will do! But then the more we dug into it and tried different
                simulators, the more we realized that it's more complex than it
                looks.
              </p>
              <p>
                We even signed up to Pulley, Carta and others just to run
                simulations. But they're a bit confusing.
              </p>
              <p>
                TL;DR: Understanding modern startup funding and knowing how much
                dilution you'll face is hard. We built a tool that'll hopefully
                help with that. You can add Post-money Safes, priced rounds and
                issue options to employees, and you can see how that affects
                your ownership at every step. You can also simulate an Exit
                scenario and see how much money you'll be left with.
              </p>
              <p>---</p>
              <p>Some examples of complex stuff:</p>
              <p>
                - There are many different types of safes. They all convert at
                the first priced round, but in different ways. Some are through
                discount, some are uncapped, some have a fixed valuation cap,
                and some have both a discount and a valuation cap.
              </p>
              <p>
                - All safes (before first priced round) convert at the same
                time. They don't dilute each other, which is what happens in the
                rest of fundraising.
              </p>
              <p>
                - Investors often require you to set aside some options. This
                one is particularily nasty. Basically, if an investor expects
                you to set aside 10% as options, and expects to get 10% equity,
                that's what should appear in the subsequent cap table. However,
                calculating the options is difficult, and is often a circular
                calculation (even Kirsty Nathoo from YC says it's complex and
                avoids showing the calculation in the Safe video "Understanding
                SAFEs and Priced Equity Rounds")
              </p>
              <p>
                - Safes and priced rounds can have pro-rata, but don't always
                exercise it
              </p>
              <p>
                - Pro-ratas of safes are taken from the priced round money, so
                you'd expect the safe holder's equity to remain the same if they
                exercise it. BUT ... it gets diluted by the new options issued.
              </p>
              <p>
                - Safes can have an MFN provision, which defers the valuation
                discussion/calculation until the moment the priced round is
                about to close. With a mix of discounts, uncapped and valuation
                caps, it gets tricky to know which deal is "better".
              </p>
              <p>- ...</p>
              <p>Assumptions and limitations:</p>
              <p>- Only post-money safes and priced rounds.</p>
              <p>
                - No down rounds. There's a bit more complexity around
                liquidation preferences and anti-dilution rights - we don't
                support that now. It only matters if you're simulating a "bad"
                situation. But come on, it's a simulator — Be optimistic.
              </p>
              <p>
                - No pro-rata caps. We might add that soon, to fully support the
                YC standard deal. But for now, if an investor gets a pro-rata,
                they can exercise either all of it (keeping their original
                ownership) or none.
              </p>
              <p>
                - Safes' pro-ratas disappear after the first priced round. (I
                think this is what happens normally?)
              </p>
              <p>
                - Remaining available options get redistributed evenly at exit.
              </p>
              <p>
                - The round is the investor. For the sake of simplicity,
                consider "Series A" as the combination of all series A investors
                into one, super-investor.
              </p>
              <p>Let us know what you think!</p>
            </div>
          </section>
        </section>
        <section id="39119835">
          <h3>
            <a class="item" href="https://zed.dev/blog/zed-is-now-open-source"
              >Zed, a collaborative code editor, is now open source</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-24 @ 17:15:19</span
              ><span class="points-container"
                >Points: <span class="points">1076</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39119835"
                  >Comments</a
                ><span class="descendants">: 377</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39119725">
          <h3>
            <a
              class="item"
              href="https://www.science.org/doi/10.1126/scirobotics.adi2746"
              >Ultralight, strong, and self-reprogrammable mechanical
              metamaterials</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-24 @ 17:04:51</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39119725"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39118349">
          <h3>
            <a class="item" href="https://gabrielgambetta.com/zx-raytracer.html"
              >ZX Spectrum Raytracer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-24 @ 15:20:12</span
              ><span class="points-container"
                >Points: <span class="points">190</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39118349"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
            <div class="text">
              <p>
                Trigger warning: the source code includes GO TO statements.
                Because that's how we did it in the 80s! Enter at your own
                peril.
              </p>
            </div>
          </section>
        </section>
        <section id="39118314">
          <h3>
            <a class="item" href="http://eulerarchive.maa.org/hedi/index.html"
              >How Euler Did It, by Ed Sandifer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-24 @ 15:17:09</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39118314"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39115837">
          <h3>
            <a
              class="item"
              href="https://unethical.info/2024/01/24/hacking-my-air-purifier/"
              >Breaking Free from DRM: Hacking My Air Purifier</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-24 @ 10:45:37</span
              ><span class="points-container"
                >Points: <span class="points">187</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39115837"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39112602">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-01-physics-year-firefighting-methods-knowledge.html"
              >Physics of 300-year-old firefighting methods could inform how our
              hearts work</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-24 @ 01:45:30</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39112602"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39112378">
          <h3>
            <a
              class="item"
              href="https://lareviewofbooks.org/article/the-failed-saint-on-george-orwells-india/"
              >The Failed Saint: On George Orwell's India</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-24 @ 01:13:56</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39112378"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39109445">
          <h3>
            <a class="item" href="https://danwang.co/2023-letter/"
              >2023 Letter</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 20:40:16</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39109445"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39104804">
          <h3>
            <a
              class="item"
              href="https://blog.gingerbeardman.com/2021/04/17/turning-an-ipad-pro-into-the-ultimate-classic-macintosh/"
              >Turning an iPad Pro into the Ultimate Classic Macintosh (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 15:38:53</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39104804"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39100340">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=Z40SZ77CHK0"
              >Mr. Rogers' music was intricate (2020) [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-01-23 @ 06:52:37</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39100340"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
