<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="45862674">
          <h3>
            <a
              class="item"
              href="https://www.yahoo.com/news/articles/elon-musk-boring-company-fined-150000426.html"
              >Boring Company fined nearly $500K after it dumped drilling fluids
              into manholes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-09 @ 03:32:46</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45862674"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45862591">
          <h3>
            <a
              class="item"
              href="https://homepage.cs.uiowa.edu/~slonnegr/plf/Book/"
              >Syntax and Semantics of Programming Languages (1995)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-09 @ 03:15:33</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45862591"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45862500">
          <h3>
            <a class="item" href="https://vicinity.social/"
              >Show HN: Geofenced chat communities anyone can create</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-09 @ 02:59:58</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45862500"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
            <div class="text">
              <p>
                I built a location-based chatroom with Discord-like servers.
                This started as a portfolio project to learn WebSockets but has
                spiraled into something else entirely.
              </p>
              <p>How it works.</p>
              <p>There are two features right now:</p>
              <p>
                Drop - Single chatrooms that can only be seen within a specified
                radius and only last for a time less than 48 hours chosen by the
                user.
              </p>
              <p>
                Hubs - Geofenced servers modeled after Discord. These are not
                time restricted. They can be created by anyone and the creator
                becomes the admin able to add channels and set rules. When a
                user enters the location’s area, they can join the hub and
                continue seeing messages even after leaving. Hubs cannot
                overlap, so once one exists in an area another cannot be created
                on it. The hub will persist as long as it is being actively
                used. If unused for two weeks, it will be deleted. (Still
                implementing this deletion aspect, so that is not in the landing
                page at the moment)
              </p>
              <p>Why I built this.</p>
              <p>
                I do not like the feel of most social media anymore, but I
                really like my university’s discord server. I wanted something
                more general that provided similar interactions. So I thought
                something that might work is a more general social app tied to
                location.
              </p>
              <p>
                I think if it is done right it can recreate the atmosphere that
                I liked. I thought a lot about what that atmosphere is. I think
                for social media to feel natural it needs a “third thing”: a
                shared interest or object that creates a connection between two
                people, or a neutral ground for communication.
              </p>
              <p>
                Having something in common just makes the interactions better
                and more useful. I think location can serve as general thing in
                common, especially if the servers are curated by locals. It
                could also be a good way for people to immediately connect in a
                new place.
              </p>
              <p>
                Right now, I’m just having fun building this thing. I would
                honestly like to use it if other people were on there… and it
                was built better and an app.
              </p>
              <p>Feedback</p>
              <p>
                I’m looking for any feedback. What’s a good idea or what’s a bad
                idea. This is really just a prototype, so there are some rough
                edges, and I am actively working on it. If you find any bugs and
                feel like communicating them, please do. You can reach me at
                nhowar@uwo.ca
              </p>
            </div>
          </section>
        </section>
        <section id="45862470">
          <h3>
            <a class="item" href="https://tabloid.vercel.app/"
              >Tabloid: The Clickbait Headline Programming Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-09 @ 02:53:45</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45862470"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45861984">
          <h3>
            <a
              class="item"
              href="https://worksinprogress.co/issue/how-airbus-took-off/"
              >How Airbus Took Off</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-09 @ 01:19:00</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45861984"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45861933">
          <h3>
            <a
              class="item"
              href="https://www.hackster.io/news/he-chunhui-s-tiny386-turns-the-humble-esp32-s3-into-a-fully-functional-386-powered-desktop-pc-5454cf6e36a1"
              >He Chunhui's Tiny386 Turns an ESP32-S3 into a Fully-Functional
              386-Powered PC</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-09 @ 01:08:50</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45861933"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45861829">
          <h3>
            <a
              class="item"
              href="https://www.goskagit.com/news/local_news/court-denies-request-that-it-find-flock-safety-camera-data-is-exempt-from-public-records/article_f1edd028-d242-479c-ada8-f2dfca73a1b1.html"
              >Judge denies request to exempt Flock footage from Public Records
              Act</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-09 @ 00:53:07</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45861829"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45861411">
          <h3>
            <a class="item" href="https://www.noemamag.com/humanitys-endgame/"
              >Humanity's Endgame</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-08 @ 23:58:08</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45861411"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45861329">
          <h3>
            <a
              class="item"
              href="https://github.com/openai/codex/releases/tag/rust-v0.56.0"
              >GPT-5-Codex-Mini – A more compact and cost-efficient version of
              GPT-5-Codex</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-08 @ 23:48:58</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45861329"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45860843">
          <h3>
            <a class="item" href="https://ironclad-os.org/"
              >Ironclad – formally verified, real-time capable, Unix-like OS
              kernel</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-08 @ 23:03:10</span
              ><span class="points-container"
                >Points: <span class="points">160</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45860843"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45860654">
          <h3>
            <a
              class="item"
              href="https://prestonbyrne.com/2025/11/06/the-ofcom-files-part-2-ip-blocking-the-uk-is-not-enough-to-comply-with-the-online-safety-act/"
              >IP blocking the UK is not enough to comply with the Online Safety
              Act</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-08 @ 22:33:56</span
              ><span class="points-container"
                >Points: <span class="points">213</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45860654"
                  >Comments</a
                ><span class="descendants">: 257</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45860638">
          <h3>
            <a
              class="item"
              href="https://www.downtowndougbrown.com/2025/11/debugging-beagleboard-usb-boot-with-a-sniffer-fixing-omap_loader-on-modern-pcs/"
              >Debugging BeagleBoard USB boot with a sniffer: fixing omap_loader
              on modern PCs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-08 @ 22:30:58</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45860638"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45859471">
          <h3>
            <a
              class="item"
              href="https://www.marineinsight.com/shipping-news/worlds-largest-cargo-sailboat-completes-historic-first-atlantic-crossing/"
              >Largest cargo sailboat completes first Atlantic crossing</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-08 @ 19:57:52</span
              ><span class="points-container"
                >Points: <span class="points">160</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45859471"
                  >Comments</a
                ><span class="descendants">: 96</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45859243">
          <h3>
            <a class="item" href="http://iotic.com/averia/"
              >Avería: The Average Font (2011)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-08 @ 19:29:44</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45859243"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45858945">
          <h3>
            <a class="item" href="https://writerdeckos.com">WriterdeckOS</a>
          </h3>
          <section>
            <h4>
              <span>2025-11-08 @ 18:49:47</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45858945"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45858905">
          <h3>
            <a class="item" href="https://markojs.com/"
              >Marko – A declarative, HTML‑based language</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-08 @ 18:43:55</span
              ><span class="points-container"
                >Points: <span class="points">237</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45858905"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45857988">
          <h3>
            <a class="item" href="https://github.com/opencloud-eu/opencloud"
              >Opencloud – An alternative to Nextcloud written in Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-08 @ 16:40:12</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45857988"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45857836">
          <h3>
            <a
              class="item"
              href="https://krebsonsecurity.com/2025/11/cloudflare-scrubs-aisuru-botnet-from-top-domains-list/"
              >Cloudflare scrubs Aisuru botnet from top domains list</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-08 @ 16:25:41</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45857836"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45857053">
          <h3>
            <a class="item" href="https://myticker.com/"
              >Ticker: Don't die of heart disease</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-08 @ 14:59:05</span
              ><span class="points-container"
                >Points: <span class="points">434</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45857053"
                  >Comments</a
                ><span class="descendants">: 372</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45857045">
          <h3>
            <a
              class="item"
              href="https://softwarepreservation.computerhistory.org/LISP/MIT/AIM-001.pdf"
              >An Algebraic Language for the Manipulation of Symbolic
              Expressions (1958) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-08 @ 14:58:03</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45857045"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45856804">
          <h3>
            <a
              class="item"
              href="https://www.oii.ox.ac.uk/news-events/study-identifies-weaknesses-in-how-ai-systems-are-evaluated/"
              >Study identifies weaknesses in how AI systems are evaluated</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-08 @ 14:18:22</span
              ><span class="points-container"
                >Points: <span class="points">321</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45856804"
                  >Comments</a
                ><span class="descendants">: 163</span></span
              >
            </h4>
            <div class="text">
              <a href="https://openreview.net/pdf?id=mdA5lVvNcU"
                >https://openreview.net/pdf?id=mdA5lVvNcU</a
              >
              <p>
                Related:
                <a
                  href="https://www.theregister.com/2025/11/07/measuring_ai_models_hampered_by/"
                  >https://www.theregister.com/2025/11/07/measuring_ai_models_h...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="45854862">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2511.02743"
              >Making Democracy Work: Fixing and Simplifying Egalitarian
              Paxos</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-08 @ 07:29:35</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45854862"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45852854">
          <h3>
            <a class="item" href="https://github.com/Snapchat/Valdi"
              >Valdi – A cross-platform UI framework that delivers native
              performance</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-08 @ 00:14:50</span
              ><span class="points-container"
                >Points: <span class="points">472</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45852854"
                  >Comments</a
                ><span class="descendants">: 197</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45852328">
          <h3>
            <a
              class="item"
              href="https://nilostolte.github.io/tech/articles/ZigCool.html"
              >Why is Zig so cool?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-07 @ 23:04:39</span
              ><span class="points-container"
                >Points: <span class="points">497</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45852328"
                  >Comments</a
                ><span class="descendants">: 439</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45850382">
          <h3>
            <a class="item" href="https://how-did-i-get-here.net/"
              >How did I get here?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-07 @ 20:01:09</span
              ><span class="points-container"
                >Points: <span class="points">360</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45850382"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45819635">
          <h3>
            <a
              class="item"
              href="https://www.boston25news.com/news/local/25-investigates-gps-kill-switch-allows-msp-cruisers-go-dark-disable-tracking/5OKMJEUJDNAVXPLN4WKFADNPLM/"
              >GPS 'kill' switch allows state police cruisers to go dark and
              disable tracking</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-05 @ 05:45:22</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45819635"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
            <div class="text">
              <a href="https://archive.ph/2Xln7">https://archive.ph/2Xln7</a>
            </div>
          </section>
        </section>
        <section id="45798068">
          <h3>
            <a class="item" href="http://xavierleroy.org/control-structures/"
              >Control structures in programming languages: from goto to
              algebraic effects</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-03 @ 11:47:19</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45798068"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45797083">
          <h3>
            <a
              class="item"
              href="https://blog.cloudflare.com/how-to-build-your-own-vpn-or-the-history-of-warp/"
              >How to build your own VPN, or: the history of WARP</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-03 @ 08:46:51</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45797083"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45790672">
          <h3>
            <a class="item" href="https://open.space/"
              >Open-source communications by bouncing signals off the Moon</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-02 @ 14:44:02</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45790672"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45776368">
          <h3>
            <a
              class="item"
              href="https://blog.sigplan.org/2019/07/09/my-first-fifteen-compilers/"
              >My first fifteen compilers (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-31 @ 20:30:10</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45776368"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
