<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39405653">
          <h3>
            <a
              class="item"
              href="https://semiengineering.com/wirebonding-is-here-to-stay/"
              >Wirebonding is here to stay</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-17 @ 02:13:21</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39405653"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39405593">
          <h3>
            <a
              class="item"
              href="https://www.sciencedirect.com/science/article/pii/S0277953624001345"
              >The adult consequences of being bullied in childhood</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-17 @ 02:02:20</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39405593"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39404268">
          <h3>
            <a class="item" href="https://www.gplates.org/"
              >GPlates: Open-source software for interactive visualisation of
              plate tectonics</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-16 @ 23:10:24</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39404268"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39403935">
          <h3>
            <a
              class="item"
              href="https://willem.com/blog/2024-02-16_vision-pro/"
              >Coding in Vision Pro</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-16 @ 22:37:38</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39403935"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39402906">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/article/humans-survive-alone-1000-years-desert-islands-off-africa"
              >How did the settlers of the Canary Islands survive a millennium
              of isolation?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-16 @ 21:00:52</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39402906"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39402868">
          <h3>
            <a
              class="item"
              href="http://blog.mattstuchlik.com/2024/02/16/counting-syscalls-in-python.html"
              >Recording and visualising the 20k system calls it takes to
              "import seaborn"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-16 @ 20:57:26</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39402868"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39402142">
          <h3>
            <a class="item" href="https://frenchie14.itch.io/driftmania"
              >Show HN: Driftmania – an open source PICO-8 racing game</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-16 @ 19:55:59</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39402142"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
            <div class="text">
              <p>
                The source code for the game is over here:
                <a
                  href="https://github.com/maxbize/PICO-8/tree/master/Driftmania"
                  >https://github.com/maxbize/PICO-8/tree/master/Driftmania</a
                >. It's a bit of a mess, but I'm happy to answer any questions
                on it or development of the game. Cheers!
              </p>
              <p>
                EDIT: For those not familiar with PICO-8, there's only a few
                inputs: arrow keys, Z/C/N, and X/V/M
              </p>
            </div>
          </section>
        </section>
        <section id="39402101">
          <h3>
            <a
              class="item"
              href="https://jacobian.org/2024/feb/16/paying-maintainers-is-good/"
              >Paying people to work on open source is good</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-16 @ 19:52:50</span
              ><span class="points-container"
                >Points: <span class="points">281</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39402101"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39401973">
          <h3>
            <a class="item" href="https://www.hyrumslaw.com">Hyrum's Law</a>
          </h3>
          <section>
            <h4>
              <span>2024-02-16 @ 19:42:50</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39401973"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39401598">
          <h3>
            <a
              class="item"
              href="https://devblogs.microsoft.com/oldnewthing/20240216-00/?p=109409"
              >If you're just going to sit there doing nothing, at least do
              nothing correctly</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-16 @ 19:11:34</span
              ><span class="points-container"
                >Points: <span class="points">266</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39401598"
                  >Comments</a
                ><span class="descendants">: 229</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39401487">
          <h3>
            <a
              class="item"
              href="https://mathstodon.xyz/@johncarlosbaez/111942324712561452"
              >The seventh most popular easily understood unsolved problem on
              MathOverflow</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-16 @ 19:01:44</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39401487"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39400581">
          <h3>
            <a
              class="item"
              href="https://stripe.com/blog/ledger-stripe-system-for-tracking-and-validating-money-movement"
              >Ledger: Stripe's system for tracking and validating money
              movement</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-16 @ 17:58:35</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39400581"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39400572">
          <h3>
            <a
              class="item"
              href="https://godotengine.org/article/rendering-acyclic-graph/"
              >GPU synchronization in Godot 4.3 is getting a major upgrade</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-16 @ 17:58:21</span
              ><span class="points-container"
                >Points: <span class="points">115</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39400572"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39400352">
          <h3>
            <a
              class="item"
              href="https://jvns.ca/blog/2024/02/16/popular-git-config-options/"
              >Popular Git config options</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-16 @ 17:43:47</span
              ><span class="points-container"
                >Points: <span class="points">263</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39400352"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39399418">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2402.04315"
              >Training LLMs to generate text with citations via fine-grained
              rewards</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-16 @ 16:42:37</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39399418"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39399281">
          <h3>
            <a class="item" href="https://daverupert.com/2024/02/ui-states/"
              >UI = f(statesⁿ)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-16 @ 16:35:00</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39399281"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39399064">
          <h3>
            <a
              class="item"
              href="https://blog.ellenhp.me/host-a-planet-scale-geocoder-for-10-month"
              >Show HN: Host a planet-scale geocoder for $10/mo</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-16 @ 16:21:30</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39399064"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
            <div class="text">
              <p>
                Geocoders are expensive to run. Like, really expensive. Like,
                $100+/month per instance expensive unless you go for a budget
                provider. I've been poking at this problem for about a month now
                and I think I've come up with something kind of cool. I'm
                calling it Airmail. Airmail's unique feature is that it can
                query against a remote index, e.g. on object storage or on a
                static site somewhere. This, along with low memory requirements
                mean it's about 10x cheaper to run an Airmail instance than
                anything else in this space that I'm aware of. It does great on
                512MB of RAM and doesn't require any storage other than the root
                disk and remote index. So storage costs stay fixed as you scale
                horizontally. Pretty neat.
              </p>
              <p>
                Demo here:
                <a href="https://airmail.rs/#demo-section"
                  >https://airmail.rs/#demo-section</a
                >
              </p>
              <p>
                Writeup:
                <a
                  href="https://blog.ellenhp.me/host-a-planet-scale-geocoder-for-10-month"
                  >https://blog.ellenhp.me/host-a-planet-scale-geocoder-for-10-...</a
                >
              </p>
              <p>
                Repository:
                <a href="https://github.com/ellenhp/airmail"
                  >https://github.com/ellenhp/airmail</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="39398009">
          <h3>
            <a class="item" href="https://mtlynch.io/solo-developer-year-6/"
              >My sixth year as a bootstrapped founder</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-16 @ 15:07:15</span
              ><span class="points-container"
                >Points: <span class="points">775</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39398009"
                  >Comments</a
                ><span class="descendants">: 252</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39397064">
          <h3>
            <a
              class="item"
              href="https://restofworld.org/2024/showmax-subscription-africa-netflix/"
              >Showmax has displaced Netflix in Africa</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-16 @ 13:57:58</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39397064"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39396337">
          <h3>
            <a
              class="item"
              href="http://mgs.spatial-computing.org/PUBLICATIONS/umc02.pdf"
              >Data structures as topological spaces (2002) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-16 @ 12:57:24</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39396337"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39392582">
          <h3>
            <a class="item" href="https://mood-amber.vercel.app"
              >Show HN: I made a Pinterest clone using SigLIP image
              embeddings</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-16 @ 02:52:01</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39392582"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
            <div class="text">
              <p>
                I crawled Tumblr and used SigLIP to get vector embeddings for
                many images.
              </p>
              <p>
                When you click an image, it finds the most similar vector
                embeddings in the database, and returns the corresponding
                images.
              </p>
            </div>
          </section>
        </section>
        <section id="39391688">
          <h3>
            <a
              class="item"
              href="https://opensource.googleblog.com/2024/02/magika-ai-powered-fast-and-efficient-file-type-identification.html"
              >Magika: AI powered fast and efficient file type identification</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-16 @ 01:02:36</span
              ><span class="points-container"
                >Points: <span class="points">615</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39391688"
                  >Comments</a
                ><span class="descendants">: 219</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39382396">
          <h3>
            <a
              class="item"
              href="https://github.com/markmoxon/archimedes-lander"
              >Fully documented source code for Lander on the Acorn
              Archimedes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-15 @ 13:25:12</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39382396"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39381727">
          <h3>
            <a
              class="item"
              href="https://dl.acm.org/doi/pdf/10.1145/15483.15484"
              >Not Without Us – Joseph Weizenbaum (1986)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-15 @ 12:08:39</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39381727"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39381505">
          <h3>
            <a
              class="item"
              href="https://newbeelearn.com/blog/git-commit-part-of-file/"
              >How to commit part of file in Git</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-15 @ 11:35:16</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39381505"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39379552">
          <h3>
            <a
              class="item"
              href="https://dubroy.com/blog/visualizing-packrat-parsing/"
              >Visualizing Packrat Parsing (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-15 @ 05:47:25</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39379552"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39379518">
          <h3>
            <a
              class="item"
              href="https://web.eecs.umich.edu/~taustin/papers/IJPP-mren.pdf"
              >Memory Renaming: Fast and Accurate Processing of Memory
              Communication (1999) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-15 @ 05:41:54</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39379518"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39378935">
          <h3>
            <a
              class="item"
              href="https://cabel.com/2024/02/13/firehouse-five-and-the-cinderella-surprise/"
              >Firehouse Five and the Cinderella Surprise</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-15 @ 03:55:41</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39378935"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39369749">
          <h3>
            <a class="item" href="https://github.com/dzove855/Bash-web-server"
              >Pure Bash Web Server</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-14 @ 13:55:10</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39369749"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39368303">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/ibm-mainframe"
              >A Quadrillion Mainframes on Your Lap</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-14 @ 10:10:54</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39368303"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
