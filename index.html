<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="46665453">
          <h3>
            <a
              class="item"
              href="https://handmade.network/blog/p/9106-welcome_to_2026%2521#30623"
              >Launching the Handmade Software Foundation</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-18 @ 07:01:12</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46665453"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46665411">
          <h3>
            <a class="item" href="https://icon-sets.iconify.design/"
              >Iconify: Library of Open Source Icons</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-18 @ 06:53:36</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46665411"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46665393">
          <h3>
            <a class="item" href="https://github.com/gibram-io/gibram"
              >Show HN: GibRAM an in-memory ephemeral GraphRAG runtime for
              retrieval</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-18 @ 06:47:17</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46665393"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <p>
                I have been working with regulation-heavy documents lately, and
                one thing kept bothering me. Flat RAG pipelines often fail to
                retrieve related articles together, even when they are clearly
                connected through references, definitions, or clauses.
              </p>
              <p>
                After trying several RAG setups, I subjectively felt that
                GraphRAG was a better mental model for this kind of data. The
                Microsoft GraphRAG paper and reference implementation were
                helpful starting points. However, in practice, I found one
                recurring friction point: graph storage and vector indexing are
                usually handled by separate systems, which felt unnecessarily
                heavy for short-lived analysis tasks.
              </p>
              <p>
                To explore this tradeoff, I built GibRAM (Graph in-buffer
                Retrieval and Associative Memory). It is an experimental,
                in-memory GraphRAG runtime where entities, relationships, text
                units, and embeddings live side by side in a single process.
              </p>
              <p>
                GibRAM is intentionally ephemeral. It is designed for
                exploratory tasks like summarization or conversational querying
                over a bounded document set. Data lives in memory, scoped by
                session, and is automatically cleaned up via TTL. There are no
                durability guarantees, and recomputation is considered cheaper
                than persistence for the intended use cases.
              </p>
              <p>
                This is not a database and not a production-ready system. It is
                a casual project, largely vibe-coded, meant to explore what
                GraphRAG looks like when memory is the primary constraint
                instead of storage. Technical debt exists, and many tradeoffs
                are explicit.
              </p>
              <p>
                The project is open source, and I would really appreciate
                feedback, especially from people working on RAG, search
                infrastructure, or graph-based retrieval.
              </p>
              <p>
                GitHub:
                <a href="https://github.com/gibram-io/gibram"
                  >https://github.com/gibram-io/gibram</a
                >
              </p>
              <p>
                Happy to answer questions or hear why this approach might be
                flawed.
              </p>
            </div>
          </section>
        </section>
        <section id="46665310">
          <h3>
            <a class="item" href="https://thinknextdesign.com/home.html"
              >Spirit of ThinkPad</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-18 @ 06:27:24</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46665310"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46664755">
          <h3>
            <a
              class="item"
              href="https://blog.jquery.com/2026/01/17/jquery-4-0-0/"
              >jQuery 4.0.0 Released</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-18 @ 04:23:28</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46664755"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46664646">
          <h3>
            <a
              class="item"
              href="https://torrentfreak.com/u-s-court-order-against-annas-archive-spells-more-trouble-for-the-site/"
              >U.S. Court Order Against Anna's Archive Spells More Trouble for
              the Site</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-18 @ 03:52:10</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46664646"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46664638">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Lopado%C2%ADtemacho%C2%ADselacho%C2%ADgaleo%C2%ADkranio%C2%ADleipsano%C2%ADdrim%C2%ADhypo%C2%ADtrimmato%C2%ADsilphio%C2%ADkarabo%C2%ADmelito%C2%ADkatakechy%C2%ADmeno%C2%ADkichl%C2%ADepi%C2%ADkossypho%C2%ADphatto%C2%ADperister%C2%ADalektryon%C2%ADopte%C2%ADkephallio%C2%ADkigklo%C2%ADpeleio%C2%ADlagoio%C2%ADsiraio%C2%ADbaphe%C2%ADtragano%C2%ADpterygon"
              >Lopado­temacho­selacho­galeo­kranio­leipsano­drim­hypo­trimmato­silphio­karab</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-18 @ 03:49:29</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46664638"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46664631">
          <h3>
            <a
              class="item"
              href="https://twitter.com/neelsomani/status/2012695714187325745"
              >Erdos 281 solved with ChatGPT 5.2 Pro</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-18 @ 03:48:03</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46664631"
                  >Comments</a
                ><span class="descendants">: 143</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46664540">
          <h3>
            <a
              class="item"
              href="https://www.anthropic.com/news/accelerating-scientific-research"
              >How scientists are using Claude to accelerate research and
              discovery</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-18 @ 03:22:52</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46664540"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46664195">
          <h3>
            <a class="item" href="https://www.abelard.org/asimov.php"
              >Profession by Isaac Asimov</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-18 @ 02:17:25</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46664195"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46664079">
          <h3>
            <a class="item" href="https://www.nngroup.com/articles/dark-mode/"
              >Dark Mode vs. Light Mode: Which Is Better?</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-18 @ 01:55:34</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46664079"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46663507">
          <h3>
            <a class="item" href="https://css.csail.mit.edu/6.858/2024/"
              >Computer Systems Security 6.566 / Spring 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-18 @ 00:09:43</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46663507"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46663467">
          <h3>
            <a class="item" href="https://polysoftit.co.uk/irisc-web/"
              >IRISC: An ARMv7 assembly interpreter and computer architecture
              simulator</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-18 @ 00:05:02</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46663467"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46663338">
          <h3>
            <a
              class="item"
              href="https://mastodon.social/@heliographe_studio/115890819509545391"
              >If you put Apple icons in reverse it looks like someone getting
              good at design</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-17 @ 23:47:16</span
              ><span class="points-container"
                >Points: <span class="points">448</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46663338"
                  >Comments</a
                ><span class="descendants">: 188</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46663268">
          <h3>
            <a
              class="item"
              href="https://kellykozakandjoshdonald.substack.com/p/no-knives-only-cook-knives"
              >No knives, only cook knives</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-17 @ 23:38:21</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46663268"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46662399">
          <h3>
            <a class="item" href="https://speedminers.fun/"
              >Show HN: Speed Miners – A tiny RTS resource mini-game</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-17 @ 21:40:53</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46662399"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
            <div class="text">
              <p>
                Objective: You have a base at the center and you need to mine
                and "refine" all of the resources on the map in as short a time
                as possible.
              </p>
              <p>
                By default, the game will play automatically, but not optimally
                (moving and buying upgrades). You can disable that with the
                buttons. You can select drones and right click to move them to
                specific resources patches and buy upgrades as you earn upgrade
                points.
              </p>
              <p>
                I've implemented three different levels and some basic sounds. I
                used Phaser at the game library (first time using it). It won't
                work well on a mobile.
              </p>
            </div>
          </section>
        </section>
        <section id="46661897">
          <h3>
            <a class="item" href="https://github.com/kip-dili/kip"
              >Kip: A programming language based on grammatical cases of
              Turkish</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-17 @ 20:44:52</span
              ><span class="points-container"
                >Points: <span class="points">175</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46661897"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46660543">
          <h3>
            <a
              class="item"
              href="https://blog.yakkomajuri.com/blog/raising-money-fucked-me-up"
              >Raising money fucked me up</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-17 @ 18:29:00</span
              ><span class="points-container"
                >Points: <span class="points">230</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46660543"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46659550">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/future/article/20260116-an-elizabethan-mansions-secrets-for-staying-warm"
              >An Elizabethan mansion's secrets for staying warm</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-17 @ 16:53:24</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46659550"
                  >Comments</a
                ><span class="descendants">: 151</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46658345">
          <h3>
            <a
              class="item"
              href="https://www.caimito.net/en/blog/2025/12/07/the-recurring-dream-of-replacing-developers.html"
              >The recurring dream of replacing developers</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-17 @ 14:31:33</span
              ><span class="points-container"
                >Points: <span class="points">422</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46658345"
                  >Comments</a
                ><span class="descendants">: 330</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46657122">
          <h3>
            <a class="item" href="https://alexharri.com/blog/ascii-rendering"
              >ASCII characters are not pixels: a deep dive into ASCII
              rendering</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-17 @ 11:15:26</span
              ><span class="points-container"
                >Points: <span class="points">970</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46657122"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46643092">
          <h3>
            <a
              class="item"
              href="https://www.joanwestenberg.com/podcasting-could-use-a-good-asteroid/"
              >Podcasting Could Use a Good Asteroid</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-16 @ 04:50:11</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46643092"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46619059">
          <h3>
            <a class="item" href="https://xous.dev/">Xous Operating System</a>
          </h3>
          <section>
            <h4>
              <span>2026-01-14 @ 17:29:09</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46619059"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46616077">
          <h3>
            <a
              class="item"
              href="https://www.economist.com/1843/2025/11/21/the-grab-list-how-museums-decide-what-to-save-in-a-disaster"
              >The grab list: how museums decide what to save in a disaster</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-14 @ 13:52:32</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46616077"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46598244">
          <h3>
            <a
              class="item"
              href="https://www.ianvisits.co.uk/articles/how-london-finally-cracked-mobile-phone-coverage-on-the-underground-86784/"
              >How London cracked mobile phone coverage on the Underground</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-13 @ 07:37:47</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46598244"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46588972">
          <h3>
            <a class="item" href="https://labs.ramp.com/rct"
              >We put Claude Code in Rollercoaster Tycoon</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-12 @ 14:28:17</span
              ><span class="points-container"
                >Points: <span class="points">441</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46588972"
                  >Comments</a
                ><span class="descendants">: 237</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46588660">
          <h3>
            <a
              class="item"
              href="https://www.loper-os.org/bad-at-entropy/manmach.html"
              >Claude Shannon's randomness-guessing machine</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-12 @ 14:03:35</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46588660"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46576581">
          <h3>
            <a
              class="item"
              href="https://www.abortretry.fail/p/the-olivetti-company"
              >The Olivetti Company</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-11 @ 15:33:04</span
              ><span class="points-container"
                >Points: <span class="points">163</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46576581"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46574989">
          <h3>
            <a
              class="item"
              href="https://www.royalbhati.com/posts/js-array-vs-typedarray"
              >Why Object of Arrays beat interleaved arrays: a JavaScript
              performance issue</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-11 @ 12:05:17</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46574989"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46572329">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=46572329"
              >Ask HN: When has a "dumb" solution beaten a sophisticated one for
              you?</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-11 @ 03:02:39</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46572329"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
            <div class="text">
              <p>
                Anyone have similar stories? Curious about cases where knowing
                your domain beat throwing compute at the problem.
              </p>
            </div>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2026/index.md"
              >2026</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
