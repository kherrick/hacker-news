<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40203224">
          <h3>
            <a
              class="item"
              href="https://www.fsf.org/news/fsf-to-be-deposed-in-sfc-v-vizio-updates-relevant-faq-entry"
              >FSF to be deposed in SFC vs. Vizio, updates relevant FAQ entry</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-29 @ 19:48:15</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40203224"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40203126">
          <h3>
            <a
              class="item"
              href="https://medium.com/@maciej.pocwierz/how-an-empty-s3-bucket-can-make-your-aws-bill-explode-934a383cb8b1"
              >How an empty S3 bucket can make your AWS bill explode</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-29 @ 19:42:23</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40203126"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40202695">
          <h3>
            <a
              class="item"
              href="https://docs.fcc.gov/public/attachments/DOC-402213A1.txt"
              >FCC Fines Largest Wireless Carriers for Sharing Location Data</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-29 @ 19:14:03</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40202695"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40201053">
          <h3>
            <a
              class="item"
              href="https://lunduke.locals.com/post/5556650/the-internet-archives-last-ditch-effort-to-save-itself"
              >The Internet Archive's last-ditch effort to save itself</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-29 @ 17:04:15</span
              ><span class="points-container"
                >Points: <span class="points">205</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40201053"
                  >Comments</a
                ><span class="descendants">: 166</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40200998">
          <h3>
            <a
              class="item"
              href="https://www.notion.so/activeloop/Senior-C-Engineer-dec6032479644f84aef85e4d8237b55e"
              >Activeloop (YC S18) Hiring a C++ Engineer with a Streaming Data
              Loader Expertise</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-29 @ 17:00:59</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40200081">
          <h3>
            <a
              class="item"
              href="https://github.blog/2024-04-29-github-copilot-workspace/"
              >GitHub Copilot Workspace: Technical Preview</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-29 @ 16:03:03</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40200081"
                  >Comments</a
                ><span class="descendants">: 162</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40199972">
          <h3>
            <a class="item" href="https://github.com/kaytu-io/kaytu"
              >Show HN: Kaytu – Optimizing cloud costs using actual usage
              data</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-29 @ 15:57:03</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40199972"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/kaytu-io/kaytu"
                >https://github.com/kaytu-io/kaytu</a
              >
              Currently, we support AWS EC2 On-Demand Servers &amp; EBS Storage
              using observability data from CloudWatch to determine utilization.
              You can optimize EC2 Servers based on CPU, Network, Memory, and
              Storage. We're expanding support to include OS License, GPU
              metrics, RDS, and Prometheus integration, and we plan to add more
              AWS services like EKS and OpenSearch, as well as Azure. This is
              more than just a utility—we want to provide a no-nonsense platform
              that makes it ridiculously easy for engineers to build
              cost-effective apps on the cloud by optimizing workload
              configurations and customizing to scenarios. Open Core: Inspired
              by Sid Sijbrandij and GitLab, we've open-sourced our CLI and are
              actively working on the server side. Our tooling will always
              remain straightforward and support open-source tools for free. We
              made it as simple as possible to try out - it’s one command, no
              sign-up needed, no SaaS platform to share your credentials. We
              would love you to try it out and give us your feedback! If there
              are bugs, we would greatly appreciate it if you reported them on
              GitHub.
              <p>Cheers, The Kaytu Team (Anil, Arta, Mahan, and Saleh)</p>
              <p>References:</p>
              <p>
                [1]Tangoe IT Trends Savings Recommendations and Liftr Insights
                data Cloud Pricing [2] Flexera State of Cloud Report - Multiple
                reports spanning 2017-2023
              </p>
            </div>
          </section>
        </section>
        <section id="40199967">
          <h3>
            <a class="item" href="https://codedbearder.com/posts/f3-backplane/"
              >I made a new backplane for my consumer NAS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-29 @ 15:56:56</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40199967"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40199713">
          <h3>
            <a
              class="item"
              href="https://uxdesign.cc/how-do-you-accidentally-run-for-president-of-iceland-0d71a4785a1e"
              >How do you accidentally run for President of Iceland?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-29 @ 15:38:46</span
              ><span class="points-container"
                >Points: <span class="points">154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40199713"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40199679">
          <h3>
            <a
              class="item"
              href="https://99percentinvisible.org/article/project-habbakuk-britains-secret-ice-bergship-aircraft-carrier-project/"
              >Project Habbakuk: Britain’s ice “bergship” aircraft carrier
              project (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-29 @ 15:35:31</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40199679"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40199624">
          <h3>
            <a
              class="item"
              href="https://www.esa.int/Science_Exploration/Space_Science/Webb/Webb_captures_iconic_Horsehead_Nebula_in_unprecedented_detail"
              >Webb captures iconic Horsehead Nebula in unprecedented detail</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-29 @ 15:31:49</span
              ><span class="points-container"
                >Points: <span class="points">424</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40199624"
                  >Comments</a
                ><span class="descendants">: 144</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40199193">
          <h3>
            <a class="item" href="https://theins.ru/en/politics/271205"
              >Husband and wife outed as GRU spies aiding bombings and
              poisonings across Europe</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-29 @ 15:00:15</span
              ><span class="points-container"
                >Points: <span class="points">375</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40199193"
                  >Comments</a
                ><span class="descendants">: 213</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40198458">
          <h3>
            <a
              class="item"
              href="https://hugodutka.com/posts/answering-legal-questions-with-llms/"
              >Answering Legal Questions with LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-29 @ 14:01:47</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40198458"
                  >Comments</a
                ><span class="descendants">: 105</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40198362">
          <h3>
            <a
              class="item"
              href="https://blog.datawrapper.de/struve-geodetic-arc/"
              >Struve's Flat(ter) Earth (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-29 @ 13:53:05</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40198362"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40197346">
          <h3>
            <a
              class="item"
              href="https://www.merriam-webster.com/grammar/nonplussed"
              >What's Going on with ‘Nonplussed’? (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-29 @ 12:19:38</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40197346"
                  >Comments</a
                ><span class="descendants">: 244</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40197277">
          <h3>
            <a
              class="item"
              href="https://gsaauctions.gov/auctions/preview/282996"
              >Cheyenne Super Computer Auction</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-29 @ 12:10:47</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40197277"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40197013">
          <h3>
            <a class="item" href="https://www.mcmillen.dev/sigbovik/"
              >93% of Paint Splatters Are Valid Perl Programs (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-29 @ 11:30:51</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40197013"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40196879">
          <h3>
            <a class="item" href="https://github.com/kingjulio8238/memary"
              >Memary: Open-Source Longterm Memory for Autonomous Agents</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-29 @ 11:12:51</span
              ><span class="points-container"
                >Points: <span class="points">154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40196879"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40196592">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/future/article/20240423-how-to-make-a-mini-wildlife-pond"
              >Mini ponds are 'tiny universes' of biodiversity for gardens and
              windowsills</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-29 @ 10:25:17</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40196592"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40195557">
          <h3>
            <a class="item" href="https://github.com/rcoh/angle-grinder"
              >Angle-grinder: Slice and dice logs on the command line</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-29 @ 07:36:03</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40195557"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40194636">
          <h3>
            <a
              class="item"
              href="https://www.tuwien.at/en/tu-wien/news/news-articles/news/lange-erhoffter-durchbruch-erstmals-atomkern-mit-laser-angeregt"
              >Atomic nucleus excited with laser: A breakthrough after
              decades</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-29 @ 05:01:33</span
              ><span class="points-container"
                >Points: <span class="points">386</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40194636"
                  >Comments</a
                ><span class="descendants">: 169</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40193385">
          <h3>
            <a
              class="item"
              href="https://pncnmnp.github.io/blogs/martin-gardner-game.html"
              >Tangoing with a Martin Gardner Word Game</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-29 @ 01:11:19</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40193385"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40193209">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/lifestyle/magazine/pearls-before-breakfast-can-one-of-the-nations-great-musicians-cut-through-the-fog-of-a-dc-rush-hour-lets-find-out/2014/09/23/8a6d46da-4331-11e4-b47c-f5889e061e5f_story.html"
              >Pearls Before Breakfast: Can a great musician cut fog of rush
              hour? (2007)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-29 @ 00:27:14</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40193209"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40192403">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Claude_%C3%89mile_Jean-Baptiste_Litre"
              >Claude Émile Jean-Baptiste Litre</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-28 @ 22:04:20</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40192403"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40189526">
          <h3>
            <a
              class="item"
              href="https://www.bigmessowires.com/2016/05/06/fc8-faster-68k-decompression/"
              >FC8 – Faster 68K Decompression (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-28 @ 15:58:26</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40189526"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40189372">
          <h3>
            <a
              class="item"
              href="https://www.allaboutcircuits.com/technical-articles/how-do-satellites-communicate-with-a-gps-system-a-look-at-the-gps-antenna/"
              >How do satellites communicate with a GPS system? (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-28 @ 15:34:59</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40189372"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40187699">
          <h3>
            <a class="item" href="https://iss.matteason.co.uk"
              >Show HN: Beautiful 3D ISS tracker with live video and
              near-realtime clouds</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-28 @ 11:12:22</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40187699"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
            <div class="text">
              <p>
                The clouds are also near-realtime; I span that out into a
                separate project at
                <a href="https://clouds.matteason.co.uk"
                  >https://clouds.matteason.co.uk</a
                >, where the cloud images I create from EUMETSAT data are freely
                available.
              </p>
              <p>
                I've got more features almost ready to go, like the ability to
                turn off all UI, toggleable clouds and turning off the day/night
                cycle
              </p>
              <p>
                I'd love for it to be used in education, so please do share it
                with any teachers you know who would find it useful
              </p>
            </div>
          </section>
        </section>
        <section id="40187072">
          <h3>
            <a class="item" href="https://krasjet.com/voice/pdf.tocgen/"
              >Pdf.tocgen</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-28 @ 08:51:18</span
              ><span class="points-container"
                >Points: <span class="points">150</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40187072"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40186819">
          <h3>
            <a
              class="item"
              href="https://anniecherkaev.com/principles-for-keyboard-layouts"
              >Principles for Keyboard Layouts (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-28 @ 07:47:09</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40186819"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40167638">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2203.08946"
              >One Bad Apple Can Spoil Your IPv6 Privacy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-26 @ 10:23:21</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40167638"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
