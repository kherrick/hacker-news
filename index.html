<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42084977">
          <h3>
            <a
              class="item"
              href="https://mlumiste.com/technical/liveportrait-compression/"
              >Perceptually lossless (talking head) video compression at
              22kbit/s</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-08 @ 07:30:31</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42084977"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42084753">
          <h3>
            <a
              class="item"
              href="https://ssoready.com/blog/from-the-founders/methodology-is-bullshit/"
              >Methodology is bullshit: principles for product velocity</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-08 @ 06:48:48</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42084753"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42083559">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/health/2024/11/fda-proposes-ditching-common-decongestant-for-being-completely-useless/"
              >After decades, FDA moves to pull ineffective decongestant off
              shelves</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-08 @ 02:37:02</span
              ><span class="points-container"
                >Points: <span class="points">248</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42083559"
                  >Comments</a
                ><span class="descendants">: 174</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42083547">
          <h3>
            <a class="item" href="https://xnacly.me/posts/2024/rust-pldev/"
              >Why I love Rust for tokenising and parsing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-08 @ 02:35:26</span
              ><span class="points-container"
                >Points: <span class="points">150</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42083547"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42083292">
          <h3>
            <a
              class="item"
              href="https://nytimesguild.org/tech/guild-builds/index.html"
              >Guild Builds</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-08 @ 01:47:01</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42083292"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42082998">
          <h3>
            <a
              class="item"
              href="https://www.fda.gov/news-events/press-announcements/fda-proposes-ending-use-oral-phenylephrine-otc-monograph-nasal-decongestant-active-ingredient-after"
              >FDA Proposes Ending Use of Oral Phenylephrine as OTC Nasal
              Decongestant</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-08 @ 00:56:49</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42082998"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42082892">
          <h3>
            <a
              class="item"
              href="https://www.onallbands.com/ham-radio-101-what-is-wspr/"
              >Ham Radio 101: What is WSPR?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-08 @ 00:44:32</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42082892"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42082498">
          <h3>
            <a class="item" href="https://r3f-drei-rapier.surge.sh"
              >Wild Ball</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-07 @ 23:50:58</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42082498"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42080747">
          <h3>
            <a
              class="item"
              href="https://www.sydney.edu.au/news-opinion/news/2024/11/07/five-minutes-of-exercise-a-day-could-lower-blood-pressure.html"
              >Five minutes of exercise a day could lower blood pressure</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-07 @ 20:42:10</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42080747"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42080377">
          <h3>
            <a class="item" href="https://draw.audio"
              >Show HN: Draw.Audio – A musical sketchpad using the Web Audio
              API</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-07 @ 20:06:39</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42080377"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42079758">
          <h3>
            <a
              class="item"
              href="https://www.w3.org/blog/2024/sustainable-web-interest-group-is-formed/"
              >Sustainable Web Interest Group Is Formed</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-07 @ 19:05:11</span
              ><span class="points-container"
                >Points: <span class="points">152</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42079758"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42079460">
          <h3>
            <a
              class="item"
              href="https://blackberry.qnx.com/en/products/qnx-everywhere"
              >QNX is now free for anything non-commercial, plus there's an RPi
              image</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-07 @ 18:35:22</span
              ><span class="points-container"
                >Points: <span class="points">553</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42079460"
                  >Comments</a
                ><span class="descendants">: 255</span></span
              >
            </h4>
            <div class="text">
              <p>
                I'm John from the Developer Relations team at QNX. I'm a loooong
                time lurker of this forum and excited to make my first post.
              </p>
              <p>
                I just wanted to let you know that we've kicked off a new
                program to start opening the doors to QNX like things used to
                be. Many of you probably used or tinkered with (the very open)
                QNX back in the day. You can now easily get a free
                non-commercial license to use the newest QNX. We've also just
                released some sample apps and a ready-to-go QNX 8.0 quick start
                target image for Raspberry Pi. So you can get QNX and the
                development tools for free now to learn, experiment, and build.
              </p>
              <p>
                It's been a long time in the making, so I'm really excited to
                get to post about this first phase of the QNX Everywhere
                initiative. My team and management have open ears, so please
                share feedback about what more we can do to open things up, be
                more transparent, and get you what you need to create an awesome
                embedded QNX project.
              </p>
              <p>Cheers!</p>
            </div>
          </section>
        </section>
        <section id="42078826">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41586-024-08097-2"
              >Imaging shapes of atomic nuclei in high-energy nuclear
              collisions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-07 @ 17:31:25</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42078826"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42078581">
          <h3>
            <a class="item" href="https://www.mushroomcoloratlas.com/"
              >Mushroom Color Atlas</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-07 @ 17:12:39</span
              ><span class="points-container"
                >Points: <span class="points">221</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42078581"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42078536">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42078536"
              >Launch HN: Codebuff (YC F24) – CLI tool that writes code for
              you</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-07 @ 17:06:28</span
              ><span class="points-container"
                >Points: <span class="points">241</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42078536"
                  >Comments</a
                ><span class="descendants">: 203</span></span
              >
            </h4>
            <div class="text">
              <a href="https://codebuff.com">https://codebuff.com</a>). Codebuff
              is like Cursor Composer, but in your terminal: it modifies files
              based on your natural language requests. You can try it with `npm
              i -g codebuff` and start using it immediately for free. We have no
              login gate, and we give all accounts up to $20 worth of credits.
              <p>
                Codebuff is different because we simplified the input to one
                step: you type what you want done in your terminal and hit
                enter. Then Codebuff looks through your whole codebase and makes
                the edits it wants, to existing source files or new ones. It
                also can run your tests, the type checker, or install packages
                to fulfill your request.
              </p>
              <p>
                Demo video:
                <a href="https://www.youtube.com/watch?v=dQ0NOMsu0dA"
                  >https://www.youtube.com/watch?v=dQ0NOMsu0dA</a
                >
              </p>
              <p>
                It all started at a hackathon. I was trying out Sonnet 3.5 which
                had recently come out and seeing if I could use it to write
                code. The script I cobbled together that day pulled codebase
                context in one step and used it to rewrite files with changes in
                the second step. This two step process still exists today.
                Incidentally, my hackathon script worked rather poorly and my
                demo failed to produce any useful code.
              </p>
              <p>
                But that weekend I thought about the kind of errors it made, and
                realized that with more context on our codebase, it might have
                been able to get the change right. For example, it tried to
                create an endpoint on our server (at my previous startup), but
                it didn't know that you needed to edit 3 specific files to do
                this (yeah... our backend was not that clean). So I hand-wrote a
                guide to our codebase, like I was instructing a new hire. I put
                it in a markdown file and passed it into Sonnet 3.5's system
                prompt. And the crazy thing is that it started producing wayyy
                better code. So, I started getting excited. In fact, this code
                guide idea still exists in Codebuff today as knowledge.md files
                which are automatically read on every request.
              </p>
              <p>
                I didn't think of this project as a startup idea at first. I
                thought it was just a simple script anyone could write. But
                after another week, I could see there were more problems to
                solve and it should be a product.
              </p>
              <p>
                In the week between applying to YC and the interview, I could
                not get Codebuff to edit files consistently. I tried many
                prompting strategies to get it to replace strings in the
                original file, but nothing worked reliably. How could I face my
                interviewer if I could not get something basic like this to
                work? On the day before my interview, in a Hail Mary attempt, I
                fine-tuned GPT-4o to turn Claude's sketch of changes into a git
                patch, which would add and remove lines to make the edits. I
                only finished generating the training data late at night, and
                the fine-tuning job ran as I slept.
              </p>
              <p>
                And, holy hell, the next morning it worked! I pushed it to
                production just in time for my YC interview with Dalton. Soon
                after, Brandon joined and we were off to the races.
              </p>
              <p>
                So, how does Codebuff work exactly? You invoke it in your
                terminal, and it starts by running through the source files in
                that directory and subdirectories and parsing out all the
                function and class names (or equivalents in 11 languages). We
                use the tree-sitter library to do this. It builds out a codebase
                map that includes these symbols and the file tree.
              </p>
              <p>
                Then, it fires off a request to Claude Haiku 3.5 to cache this
                codebase context so user inputs can be responded to with lower
                latency. (Prompt caching is OP!). We have a stateless server
                that passes messages along to Anthropic or OpenAI. We use
                websockets to ferry data back and forth to clients. We didn't
                have authentication or even a database for the first three
                months. Codebuff was free to install and used our API keys for
                all requests. Luckily, no one exploited us for too much free
                Claude usage haha. Major thanks to Brandon for saving this
                situation by building out our database (Postgres + Drizzle),
                server (Bun, hosted on Render, auth (using the free Auth.js),
                website (NextJS also hosted on Render), billing (Stripe),
                logging (BetterStack), and dashboard (Retool). This is the best
                tech stack I’ve ever had.
              </p>
              <p>
                When the user sends an input message, we prompt Claude to pick
                files that would be relevant (step 1). After picking files, we
                load them into context and the agent responds. It invokes tools
                using xml tags that we parse. It literally writes out
                &lt;edit_file path="src/app.ts"&gt;…&lt;/edit_file&gt; to edit a
                particular file, and has other tags to run terminal commands, or
                to ask to read more files. This is all we really need, since
                Anthropic has already trained Claude with very similar tools
                reach state of the art on the SWE benchmark.
              </p>
              <p>
                Codebuff has limited free usage, but if you like it you can pay
                $99/mo to get more credits. We realize this is a lot more than
                competitors, but that’s because we do more expensive LLM calls
                with more context.
              </p>
              <p>
                We’re already seeing Codebuff used in surprising ways. One user
                racked up a $500 bill by building out two Flutter apps in
                parallel. He never even looked at the code it generated.
                Instead, he had long conversations with Codebuff to make
                progress and fix errors, until the apps were built to his
                satisfaction. Many users built real apps over a weekend for
                their teams and personal use.
              </p>
              <p>
                Of course, those aren't the typical use cases. Users also
                frequently use Codebuff to write unit tests. They would build a
                feature in parallel with unit tests and have Codebuff do loops
                to fix up the code until the tests pass. They would also ask it
                to do drudge work like set up Oauth flows or API scaffolding.
              </p>
              <p>
                What's really exciting with all of these examples is that we're
                seeing people's creativity becoming unbridled. They're spending
                more of their time thinking about architecture and design,
                instead of implementation details. It's so cool that we're just
                at the beginning, and the technology is only going to improve
                from here.
              </p>
              <p>
                If you would want to use Codebuff inside your own systems, we
                have an alpha SDK that exposes the same natural language
                interface for your apps to call and receive code edits! You can
                sign up here for early access:
                <a
                  href="https://codebuff.retool.com/form/c8b15919-52d0-4572-aca5-533317403dde"
                  >https://codebuff.retool.com/form/c8b15919-52d0-4572-aca5-533...</a
                >.
              </p>
              <p>
                Thank you for reading! We’re excited for you to try out Codebuff
                and let us know what you think!
              </p>
            </div>
          </section>
        </section>
        <section id="42078476">
          <h3>
            <a
              class="item"
              href="https://opensource.microsoft.com/blog/2024/11/07/introducing-hyperlight-virtual-machine-based-security-for-functions-at-scale/"
              >Hyperlight: Virtual machine-based security for functions at
              scale</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-07 @ 17:01:31</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42078476"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42078067">
          <h3>
            <a class="item" href="https://github.com/BemiHQ/BemiDB"
              >Show HN: BemiDB – Postgres read replica optimized for
              analytics</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-07 @ 16:25:40</span
              ><span class="points-container"
                >Points: <span class="points">180</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42078067"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
            <div class="text">
              <p>
                We love Postgres for its simplicity, power, and rich ecosystem.
                But engineers have to still get bogged down with heavyweight and
                expensive OLAP systems when connecting an analytics data stack.
              </p>
              <p>
                Postgres is amazing at OLTP queries, but not for OLAP queries
                (large data scans and aggregations). Even in this case, we’ve
                still heard from countless scaling startups that they still try
                to use only a read replica to run analytics workloads since they
                don’t want to deal with the data engineering complexity of the
                alternative. This actually works surprising well initially, but
                starts to break for them as they scale or when integrating
                multiple data sources. Adding lots of indexes to support
                analytics also slows down their transactional write performance.
              </p>
              <p>
                When growing out of “just use Postgres”, companies have to
                understand and wrangle complex ETL pipelines, CDC processes, and
                data warehouses — adding layers of complexity that defeat the
                simplicity that undermines their initial choice for Postgres as
                their data storage in the first place.
              </p>
              <p>
                We thought there had to be a better way, so we’re building
                BemiDB. It’s designed to handle complex analytical queries at
                scale without the usual overhead. It’s a single binary that
                automatically syncs with Postgres data and is
                Postgres-compatible, so it’s like querying standard Postgres and
                works with all existing tools.
              </p>
              <p>
                Under the hood, we use Apache Iceberg (with Parquet data files)
                stored in S3. This allows for bottomless inexpensive storage,
                compressed data in columnar files, and an open format that
                guarantees compatibility with other data tools.
              </p>
              <p>
                We embed DuckDB as the query engine for in-memory analytics that
                work for complex queries. With efficient columnar storage and
                vectorized execution, we’re aiming for faster results without
                heavy infra. BemiDB communicates over the Postgres wire protocol
                to make all querying Postgres-compatible.
              </p>
              <p>
                We want to simplify data stacks for companies that use Postgres
                by reducing complexity (single binary and S3), using
                non-proprietary data formats (Iceberg open tables), and removing
                vendor lock-in (open source). We'd love to hear your feedback!
                What do you think?
              </p>
            </div>
          </section>
        </section>
        <section id="42077319">
          <h3>
            <a
              class="item"
              href="https://control.princeton.edu/machine-learning-for-rt-profile-control-in-tokamaks/"
              >AI for real-time fusion plasma behavior prediction and
              manipulation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-07 @ 15:12:10</span
              ><span class="points-container"
                >Points: <span class="points">248</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42077319"
                  >Comments</a
                ><span class="descendants">: 118</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42076884">
          <h3>
            <a
              class="item"
              href="https://32bits.substack.com/p/under-the-microscope-ecco-the-dolphin"
              >Using Ghidra and Python to reverse engineer Ecco the Dolphin</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-07 @ 14:25:30</span
              ><span class="points-container"
                >Points: <span class="points">392</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42076884"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42076200">
          <h3>
            <a
              class="item"
              href="https://sachachua.com/blog/2024/11/excerpts-from-a-conversation-with-john-wiegley-johnw-and-adam-porter-alphapapa-about-personal-information-management/"
              >Excerpts from a conversation about personal information
              management</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-07 @ 12:50:29</span
              ><span class="points-container"
                >Points: <span class="points">165</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42076200"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42074124">
          <h3>
            <a
              class="item"
              href="https://theamericanscholar.org/masters-of-horror-and-magic/"
              >The Brothers Grimm: A Biography</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-07 @ 06:46:37</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42074124"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42073001">
          <h3>
            <a
              class="item"
              href="https://blog.dnmfarrell.com/post/incomplete-data-structures/"
              >I'm not mutable, I'm partially instantiated</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-07 @ 03:17:45</span
              ><span class="points-container"
                >Points: <span class="points">196</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42073001"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42050010">
          <h3>
            <a
              class="item"
              href="https://marcusolsson.dev/k-anonymity-and-l-diversity/"
              >Understanding privacy risk with k-anonymity and l-diversity</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-05 @ 09:30:53</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42050010"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42044860">
          <h3>
            <a
              class="item"
              href="https://lookout.co/ralph-abraham-chaos-theory-counterculture-uc-santa-cruz-from-math-to-mushrooms-intellectual-explorer-was-always-looking-for-the-big-picture/"
              >Ralph Abraham was always looking for the big picture</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-04 @ 18:55:40</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42044860"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42034305">
          <h3>
            <a
              class="item"
              href="https://www.juggle.org/claude-shannon-mathematician-engineer-genius-juggler/"
              >Claude Shannon: Mathematician, Engineer, Genius and Juggler?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-03 @ 17:09:42</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42034305"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42033389">
          <h3>
            <a class="item" href="https://star.conor.link/"
              >Show HN: Directional antenna alignment using phone motion
              sensors</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-03 @ 14:55:06</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42033389"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42024680">
          <h3>
            <a
              class="item"
              href="https://www.fracassi.net/iw2ntf/manuali/practical-radio-circuits-raymond-haigh.pdf"
              >Practical Radio Circuits (2003) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-02 @ 07:34:28</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42024680"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42022088">
          <h3>
            <a
              class="item"
              href="https://chromium.googlesource.com/linux-syscall-support/"
              >Linux Syscall Support</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-01 @ 22:14:12</span
              ><span class="points-container"
                >Points: <span class="points">176</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42022088"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42021450">
          <h3>
            <a class="item" href="https://brainhack.vercel.app/fus"
              >Functional ultrasound through the skull</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-01 @ 20:52:45</span
              ><span class="points-container"
                >Points: <span class="points">184</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42021450"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42020345">
          <h3>
            <a class="item" href="https://arxiv.org/abs/1603.06549"
              >Roaring Bitmap Compression</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-01 @ 18:57:07</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42020345"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
