<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40256096">
          <h3>
            <a
              class="item"
              href="https://developerjoy.co/blog/php-doesnt-suck-anymore"
              >PHP Doesn't Suck Anymore</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-04 @ 09:11:33</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40256096"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40255209">
          <h3>
            <a class="item" href="https://tegowerk.eu/posts/bicycle-repair/"
              >A love letter to bicycle maintenance and repair</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-04 @ 05:50:16</span
              ><span class="points-container"
                >Points: <span class="points">162</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40255209"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40254602">
          <h3>
            <a
              class="item"
              href="https://www.engadget.com/nintendo-blitzes-github-with-over-8000-emulator-related-dmca-takedowns-200021877.html"
              >Nintendo blitzes GitHub with over 8k emulator-related DMCA
              takedowns</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-04 @ 03:37:57</span
              ><span class="points-container"
                >Points: <span class="points">172</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40254602"
                  >Comments</a
                ><span class="descendants">: 115</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40254080">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/information-technology/2022/12/my-secret-life-as-an-11-year-old-bbs-sysop/"
              >My secret life as an 11-year-old BBS sysop (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-04 @ 01:30:32</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40254080"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40254047">
          <h3>
            <a
              class="item"
              href="https://nautil.us/i-never-stopped-learning-from-daniel-dennett-569904/"
              >I never stopped learning from Daniel Dennett</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-04 @ 01:23:36</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40254047"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40253868">
          <h3>
            <a
              class="item"
              href="https://theconversation.com/how-much-time-should-you-spend-sitting-versus-standing-new-research-reveals-the-perfect-mix-for-optimal-health-228894"
              >How much time should you spend sitting versus standing?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-04 @ 00:43:03</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40253868"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40253774">
          <h3>
            <a class="item" href="https://bloom-ui.fly.dev/"
              >Show HN: Bloom â€“ A shadcn like UI library for Elixir and
              Phoenix</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-04 @ 00:23:24</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40253774"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <p>
                The JS ecosystem has so many, and it's the one thing I miss from
                being primarily a React &amp; Node developer.
              </p>
              <p>
                So this is my attempt at bringing some pretty and useful
                components most applications need to Phoenix projects to try and
                fill in the gaps between what makes LiveView such a productive
                joy to work with.
              </p>
              <p>
                The library is very very raw and requires some initial clean up
                so PRs are very welcome to tidy up the DX as well as the general
                quality of the repo &amp; components.
              </p>
              <p>Hope you like it.</p>
            </div>
          </section>
        </section>
        <section id="40253245">
          <h3>
            <a
              class="item"
              href="https://www.timeextension.com/features/flashback-how-the-kindness-of-sega-saved-nvidia-from-going-under"
              >How the Kindness of Sega Saved Nvidia from Going Under</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-03 @ 22:54:22</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40253245"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40252569">
          <h3>
            <a class="item" href="https://github.com/abi/secret-llama"
              >Show HN: I built a free in-browser Llama 3 chatbot powered by
              WebGPU</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-03 @ 21:26:46</span
              ><span class="points-container"
                >Points: <span class="points">209</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40252569"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
            <div class="text">
              <p>
                Iâ€™ve used the WebLLM project by MLC AI for a while to interact
                with LLMs in the browser when handling sensitive data but I
                found their UI quite lacking for serious use so I built a much
                better interface around WebLLM.
              </p>
              <p>
                Iâ€™ve been using it as a therapist and coach. And itâ€™s wonderful
                knowing that my personal information never leaves my local
                computer.
              </p>
              <p>
                Should work on Desktop with Chrome or Edge. Other browsers are
                adding WebGPU support as well - see the Github for details on
                how you can get it to work on other browsers.
              </p>
              <p>
                Note: after you send the first message, the model will be
                downloaded to your browser cache. That can take a while
                depending on the model and your internet connection. But on
                subsequent page loads, the model should be loaded from the
                IndexedDB cache so it should be much faster.
              </p>
              <p>
                The project is open source (Apache 2.0) on Github. If you like
                it, Iâ€™d love contributions, particularly around making the first
                load faster.
              </p>
              <p>
                Github:
                <a href="https://github.com/abi/secret-llama"
                  >https://github.com/abi/secret-llama</a
                >
                Demo:
                <a href="https://secretllama.com">https://secretllama.com</a>
              </p>
            </div>
          </section>
        </section>
        <section id="40252334">
          <h3>
            <a
              class="item"
              href="https://jobs.lever.co/FinleyTechnologies/70462b30-c31a-4db3-932a-0abb96ec5566"
              >Finley (YC W21) is hiring securitization and structured finance
              professionals</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-03 @ 21:00:24</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40251747">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2402.16671"
              >StructLM: Towards Building Generalist Models for Structured
              Knowledge Grounding</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-03 @ 20:01:41</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40251747"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40250557">
          <h3>
            <a class="item" href="https://bandmatch.app"
              >Show HN: BandMatch â€“ "Tinder" but for finding musicians to create
              bands/collab</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-03 @ 18:11:25</span
              ><span class="points-container"
                >Points: <span class="points">356</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40250557"
                  >Comments</a
                ><span class="descendants">: 180</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40250525">
          <h3>
            <a
              class="item"
              href="https://sato-team.github.io/Stable-Text-to-Motion-Framework/"
              >SATO: Stable Text-to-Motion Framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-03 @ 18:07:17</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40250525"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40250519">
          <h3>
            <a
              class="item"
              href="https://glitchcomet.com/articles/1024-bit-primes/"
              >How hard can generating 1024-bit primes be?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-03 @ 18:06:53</span
              ><span class="points-container"
                >Points: <span class="points">181</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40250519"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40248721">
          <h3>
            <a class="item" href="https://www.darpa.mil/news-events/2024-05-01"
              >Manta Ray UUV prototype completes in-water testing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-03 @ 15:22:17</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40248721"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40248619">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/ai-coding"
              >AI copilots are changing how coding is taught</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-03 @ 15:13:37</span
              ><span class="points-container"
                >Points: <span class="points">152</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40248619"
                  >Comments</a
                ><span class="descendants">: 267</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40248217">
          <h3>
            <a class="item" href="https://www.lowercase.app/"
              >Lowercase â€“ A simple way to take and share notes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-03 @ 14:39:49</span
              ><span class="points-container"
                >Points: <span class="points">178</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40248217"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40247604">
          <h3>
            <a
              class="item"
              href="https://mullvad.net/en/blog/dns-traffic-can-leak-outside-the-vpn-tunnel-on-android"
              >DNS traffic can leak outside the VPN tunnel on Android</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-03 @ 13:46:41</span
              ><span class="points-container"
                >Points: <span class="points">700</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40247604"
                  >Comments</a
                ><span class="descendants">: 326</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40247421">
          <h3>
            <a
              class="item"
              href="https://english.nv.ua/life/27-unique-volumes-of-grimm-brothers-fairy-tales-were-found-in-poland-50415035.html"
              >Unique volumes of Brothers Grimm fairy tales discovered in
              Poland</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-03 @ 13:26:38</span
              ><span class="points-container"
                >Points: <span class="points">335</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40247421"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40245686">
          <h3>
            <a
              class="item"
              href="https://www.figma.com/blog/figmas-journey-to-typescript-compiling-away-our-custom-programming-language/"
              >Figma's Journey to TypeScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-03 @ 09:14:19</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40245686"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40244653">
          <h3>
            <a
              class="item"
              href="https://www.imsc.res.in/~hbar/PDFs_2017/Paper_by_Demaine_Demaine_Lubiw.pdf"
              >Folding and One Straight Cut Suffice [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-03 @ 06:12:01</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40244653"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40243168">
          <h3>
            <a
              class="item"
              href="https://alexgarcia.xyz/blog/2024/building-new-vector-search-sqlite/index.html"
              >Iâ€™m writing a new vector search SQLite Extension</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-03 @ 01:44:30</span
              ><span class="points-container"
                >Points: <span class="points">445</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40243168"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40239164">
          <h3>
            <a class="item" href="https://danielchasehooper.com/posts/shapeup/"
              >Making a 3D modeler in C in a week</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-02 @ 17:48:14</span
              ><span class="points-container"
                >Points: <span class="points">589</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40239164"
                  >Comments</a
                ><span class="descendants">: 165</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40225410">
          <h3>
            <a
              class="item"
              href="https://jgeekstudies.org/2024/04/26/are-japanese-anime-robots-isometric-or-allometric/"
              >Are Japanese anime robots isometric or allometric?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-01 @ 16:21:59</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40225410"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40224937">
          <h3>
            <a class="item" href="https://github.com/google-deepmind/torax"
              >TORAX is a differentiable tokamak core transport simulator</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-01 @ 15:47:15</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40224937"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40221210">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40221210"
              >Ask HN: How to handle user file uploads?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-01 @ 09:39:40</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40221210"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
            <div class="text">
              <p>
                I don't feel this is safe enough. I also feel we could do better
                by optimizing images on the BE, or creating thumbnails for
                videos. But then there is the question of cost on AWS side.
              </p>
              <p>
                Anybody have experience with any of this? I imagine having a big
                team and dedicated services for media processing could work, but
                what about small teams?
              </p>
              <p>All thoughts/discussions are welcome.</p>
            </div>
          </section>
        </section>
        <section id="40221067">
          <h3>
            <a class="item" href="https://natureofcode.com/introduction/"
              >The Nature of Code (2nd Edition)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-01 @ 09:15:12</span
              ><span class="points-container"
                >Points: <span class="points">301</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40221067"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40220002">
          <h3>
            <a
              class="item"
              href="https://www.noemamag.com/a-clock-in-the-forest/"
              >A Clock in the Forest</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-01 @ 05:58:57</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40220002"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40217554">
          <h3>
            <a
              class="item"
              href="https://people.math.harvard.edu/~ctm/home/text/others/shannon/entropy/entropy.pdf"
              >A Mathematical Theory of Communication [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-30 @ 23:05:12</span
              ><span class="points-container"
                >Points: <span class="points">216</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40217554"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40215795">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/books/2016/jan/20/fairytales-much-older-than-previously-thought-say-researchers"
              >Fairytales much older than previously thought, say researchers
              (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-04-30 @ 20:18:49</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40215795"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
