<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38665206">
          <h3>
            <a
              class="item"
              href="https://www.ft.com/content/028d9968-2d6d-4e8c-affb-d36d4986cbae"
              >Bang&amp;amp;Olufsen says it will defy luxury slowdown as 'rich
              will only become richer'</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 16:03:51</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38665206"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38664895">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/stop-planting-trees-thomas-crowther/"
              >Stop Planting Trees, Says Guy Who Inspired World to Plant a
              Trillion Trees</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 15:28:07</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38664895"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38664875">
          <h3>
            <a
              class="item"
              href="https://jeroenvanbaar.substack.com/p/data-dispatch-4-the-falling-nutritional"
              >The falling nutritional value of crops</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 15:26:22</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38664875"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38664729">
          <h3>
            <a class="item" href="https://github.com/francoismichel/ssh3"
              >SSH3: SSHv2 using HTTP/3 and QUIC</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 15:06:42</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38664729"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38664713">
          <h3>
            <a class="item" href="https://svgl.vercel.app/"
              >A Beautiful library of SVG logos</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 15:04:54</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38664713"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38664626">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Fractional_Fourier_transform"
              >Fractional Fourier Transform</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 14:52:05</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38664626"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38664412">
          <h3>
            <a
              class="item"
              href="https://event-driven.io/en/the_end_is_near_for_crud_data/"
              >Moving from relational data to events</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 14:27:18</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38664412"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38663881">
          <h3>
            <a
              class="item"
              href="https://koenvangilst.nl/blog/rising-temperatures"
              >Rising Temperatures in the Netherlands</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 13:00:11</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38663881"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38663733">
          <h3>
            <a
              class="item"
              href="https://www.dwarkeshpatel.com/p/andy-matuschak"
              >Andy Matuschak – Self-Teaching, Spaced Repetition, Why Books
              Don't Work</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 12:24:49</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38663733"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38663713">
          <h3>
            <a
              class="item"
              href="https://www.bitecode.dev/p/preparing-for-missions-in-difficult"
              >Preparing for Missions in Difficult Places</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 12:20:56</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38663713"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38663636">
          <h3>
            <a
              class="item"
              href="https://www.emergetools.com/careers/jobs/senior-frontend-engineer"
              >Emerge (YC W21) is hiring a Senior Front end Engineer (remote,
              small team)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 12:02:42</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38662900">
          <h3>
            <a class="item" href="https://darksi.de/13.sqlite-fts5-structure/"
              >Structure of FTS5 Index in SQLite</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 09:09:07</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38662900"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38662160">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2023/12/15/24003542/openai-suspends-bytedances-account-after-it-used-gpt-to-train-its-own-ai-model"
              >OpenAI suspends ByteDance's account after it used GPT to train
              its own AI model</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 06:17:46</span
              ><span class="points-container"
                >Points: <span class="points">324</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38662160"
                  >Comments</a
                ><span class="descendants">: 229</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38661930">
          <h3>
            <a class="item" href="https://developer.apple.com/news/?id=ik9z4ll6"
              >25 hours of Xcode Cloud now included with the Apple Developer
              Program</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 05:15:04</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38661930"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38661890">
          <h3>
            <a class="item" href="https://github.com/wesql/wescale"
              >Show HN: I've built a MySQL proxy that supports online ddl</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 05:03:34</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38661890"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
            <div class="text">
              Hi everyone. Over the past year, I've built a MySQL Proxy that
              supports Online DDL. I'm not sure if there are other proxies out
              there with this feature, but I found it fascinating and thought it
              was worth sharing. Of course, this proxy also supports many other
              features, such as Read Write Split, Read After Write Consistency,
              Load Balancing, and Transparent Failover. I didn't build this
              database from the bottom up; instead, I forked Vitess and put a
              lot of effort into overhauling its architecture and SQL Engine
              Layer. Moving forward, I hope to introduce more developer-friendly
              features into this Proxy. The next major feature should be
              something similar to the Branch functionality of PlanetScale.
            </div>
          </section>
        </section>
        <section id="38661765">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-12-astronomers-extremely-metal-poor-galaxies.html"
              >Astronomers detect almost 100 new extremely-metal poor
              galaxies</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 04:37:01</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38661765"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38661580">
          <h3>
            <a class="item" href="https://www.farley.ai/posts/causal"
              >CRDT Concepts: Causal Trees</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 03:55:17</span
              ><span class="points-container"
                >Points: <span class="points">176</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38661580"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38661462">
          <h3>
            <a class="item" href="https://sourcegraph.com/blog/rag-to-riches"
              >RAG to Riches</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 03:30:32</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38661462"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38661296">
          <h3>
            <a
              class="item"
              href="https://blog.research.google/2023/12/advancements-in-machine-learning-for.html"
              >Advancements in machine learning for machine learning</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 02:50:47</span
              ><span class="points-container"
                >Points: <span class="points">267</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38661296"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38661182">
          <h3>
            <a
              class="item"
              href="https://github.com/skysafe/reblog/tree/main/cve-2023-45866"
              >Bluetooth keystroke-injection in Android, Linux, macOS and iOS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-16 @ 02:26:15</span
              ><span class="points-container"
                >Points: <span class="points">286</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38661182"
                  >Comments</a
                ><span class="descendants">: 165</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38657126">
          <h3>
            <a
              class="item"
              href="https://www.whizzy.org/2023-12-14-bricked-xmas/"
              >I bricked my Christmas lights</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-15 @ 18:41:10</span
              ><span class="points-container"
                >Points: <span class="points">488</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38657126"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38656994">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/books/2023/dec/01/the-notebook-by-roland-allen-review-notes-on-living"
              >The Notebook by Roland Allen review – notes on living</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-15 @ 18:27:22</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38656994"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38655922">
          <h3>
            <a
              class="item"
              href="https://www.sapiens.org/archaeology/british-museum-thefts/"
              >How museum items go missing</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-15 @ 16:49:53</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38655922"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38653711">
          <h3>
            <a class="item" href="https://fs.blog/chestertons-fence/"
              >Chesterton's Fence: A lesson in second order thinking</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-15 @ 13:01:19</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38653711"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38652796">
          <h3>
            <a class="item" href="https://blog.regehr.org/archives/2173"
              >A Close Look at a Spinlock</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-15 @ 10:30:13</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38652796"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38652773">
          <h3>
            <a
              class="item"
              href="https://www.nicolamarras.it/Was-There-Life-Before-Computer-en.pdf"
              >Calculation before we went digital [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-15 @ 10:25:44</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38652773"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38651690">
          <h3>
            <a
              class="item"
              href="https://belkadan.com/blog/2022/10/Swift-in-the-OS/"
              >Swift was always going to be part of the OS (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-15 @ 06:50:17</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38651690"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38651346">
          <h3>
            <a class="item" href="https://github.com/Card-Forge/forge/wiki"
              >Open source rules engine for Magic: The Gathering</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-15 @ 05:40:06</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38651346"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38639415">
          <h3>
            <a class="item" href="https://deciyear.com/">Deciyear Calendar</a>
          </h3>
          <section>
            <h4>
              <span>2023-12-14 @ 09:17:51</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38639415"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38633611">
          <h3>
            <a
              class="item"
              href="https://quillette.com/2023/12/11/mutual-friends-the-adventures-of-charles-dickens-wilkie-collins/"
              >Mutual Friends: The Adventures of Charles Dickens and Wilkie
              Collins</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-13 @ 20:18:53</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38633611"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
