<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40264352">
          <h3>
            <a
              class="item"
              href="https://ai.stanford.edu/~kzliu/blog/unlearning"
              >Machine unlearning: ML model minus the information to be
              unlearned</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-05 @ 12:30:44</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40264352"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40264337">
          <h3>
            <a
              class="item"
              href="https://thechipletter.substack.com/p/a-history-of-c-compilers-part-1-performance"
              >A History of C Compilers – Part 1: Performance, Portability and
              Freedom</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-05 @ 12:28:30</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40264337"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40264042">
          <h3>
            <a
              class="item"
              href="https://j6b72.de/article/why-you-should-take-a-look-at-traefik/"
              >Take a look at traefik, even if you don't use containers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-05 @ 11:31:17</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40264042"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40263479">
          <h3>
            <a
              class="item"
              href="https://wiki.debian.org/ReleaseGoals/64bit-time"
              >Debian 64-bit-time transition</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-05 @ 09:44:28</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40263479"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40263194">
          <h3>
            <a class="item" href="https://www.flagsarenotlanguages.com/blog/"
              >Flags Are Not Languages</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-05 @ 08:39:29</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40263194"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40263027">
          <h3>
            <a class="item" href="https://neighbor-share.vercel.app/"
              >Show HN: I built a website to share files and messages without
              any server</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-05 @ 07:42:13</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40263027"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
            <div class="text">
              <p>
                These are some features: - Share photos, documents, videos, and
                more with ease, no matter the size. - Connect instantly with
                anyone for speedy and reliable file transfers, bypassing the
                need for centralized servers. - Get started in minutes with our
                intuitive interface designed for seamless communication. No
                registration. - Easily connect with others using QR codes,
                simplifying the sharing process further.
              </p>
              <p>
                The inspiration behind NeighborHoodShare stemmed from a common
                dilemma: the reluctance to share personal contact details like
                phone numbers or email addresses when sharing photos or messages
                with strangers. With NeighborHoodShare, you can share content
                securely without compromising your privacy.
              </p>
              <p>
                I would be happy to hear your feedback and suggestions for
                improving NeighborHoodShare.
              </p>
              <p>
                I had written a blog on how p2p networking in browsers work:
                <a
                  href="https://dikshantraj2001.medium.com/nat-stun-turn-and-ice-466dabbc2fdb"
                  >https://dikshantraj2001.medium.com/nat-stun-turn-and-ice-466...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="40263017">
          <h3>
            <a class="item" href="https://github.com/Jaysmito101/rusty.hpp"
              >Rusty.hpp: A Borrow Checker and Memory Ownership System for
              C++20</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-05 @ 07:38:47</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40263017"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40262883">
          <h3>
            <a
              class="item"
              href="https://www.bbc.co.uk/news/uk-england-york-north-yorkshire-68942321"
              >Council Bans Apostrophes on Street Signs to Avoid Database
              Issues</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-05 @ 07:07:56</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40262883"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40262846">
          <h3>
            <a class="item" href="https://www.emergetools.com/careers"
              >Emerge (YC W21) is hiring senior engineers to automate dead code
              deletion</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-05 @ 07:00:07</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40262779">
          <h3>
            <a class="item" href="https://github.com/xmake-io/xmake"
              >Xmake: A cross-platform build utility based on Lua</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-05 @ 06:47:40</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40262779"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40262643">
          <h3>
            <a
              class="item"
              href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4812984"
              >New scanning electron microscope tech sees magnetic field with
              100nm resolution</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-05 @ 06:05:55</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40262643"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40262236">
          <h3>
            <a
              class="item"
              href="https://yuanchuan.dev/time-based-css-animations"
              >Time-Based CSS Animations</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-05 @ 04:26:10</span
              ><span class="points-container"
                >Points: <span class="points">157</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40262236"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40262190">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/tech-policy/2024/05/judge-mulls-sanctions-over-googles-shocking-destruction-of-internal-chats/"
              >Judge mulls sanctions over Google's destruction of internal
              chats</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-05 @ 04:13:56</span
              ><span class="points-container"
                >Points: <span class="points">177</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40262190"
                  >Comments</a
                ><span class="descendants">: 160</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40262115">
          <h3>
            <a class="item" href="https://github.com/hybridgroup/cylon"
              >Cylon: JavaScript framework for robotics, drones, and the
              Internet of Things</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-05 @ 03:46:04</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40262115"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40261926">
          <h3>
            <a
              class="item"
              href="https://pretalx.sysmocom.de/osmodevcon2024/talk/BBZBGM/"
              >Digital Telecommunication in HF band - WWWAN - World-Wide
              Wireless Area Network</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-05 @ 02:52:27</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40261926"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40261681">
          <h3>
            <a class="item" href="https://github.com/skeeto/hash-prospector"
              >Automated integer hash function discovery</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-05 @ 01:39:05</span
              ><span class="points-container"
                >Points: <span class="points">223</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40261681"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40261550">
          <h3>
            <a
              class="item"
              href="https://joe-antognini.github.io/machine-learning/steins-paradox"
              >Understanding Stein's Paradox (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-05 @ 01:01:05</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40261550"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40261001">
          <h3>
            <a
              class="item"
              href="https://www.universetoday.com/166842/vera-rubins-primary-mirror-gets-its-first-reflective-coating/"
              >Vera Rubin's primary mirror gets its first reflective coating</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-04 @ 23:02:30</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40261001"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40260399">
          <h3>
            <a
              class="item"
              href="https://digitalcosmonaut.com/superfest-ceverit-glass-ddr/"
              >Superfest – The almost unbreakable East German Glass (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-04 @ 21:24:34</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40260399"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40260259">
          <h3>
            <a class="item" href="https://www.gpudeploy.com"
              >Show HN: gpudeploy.com – "Airbnb" for GPUs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-04 @ 21:03:55</span
              ><span class="points-container"
                >Points: <span class="points">215</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40260259"
                  >Comments</a
                ><span class="descendants">: 139</span></span
              >
            </h4>
            <div class="text">
              <p>
                YC w24 company here. We just pivoted from drone delivery to
                build gpudeploy.com, a website that routes on-demand traffic for
                GPU instances to idle compute resources.
              </p>
              <p>
                The experience is similar to lambda labs, which we’ve really
                enjoyed for training our robotics models, but their GPUs are
                never available for on-demand. We are also trying to make it
                more no-nonsense (no hidden fees, no H100 behind “contact
                sales”, etc.).
              </p>
              <p>
                The tech to make this work is actually kind of nifty, we may do
                an in-depth HN post on that soon.
              </p>
              <p>
                Right now, we have H100s, a few RTX 4090s and a GTX 1080 Ti
                online. Feel free to try it out!
              </p>
              <p>
                Also, if you’ve got compute sitting around (a GPU cluster, a
                crypto mining operation or just a GPU) or if you’re an AI
                company with idle compute (hopefully not in a Stability AI way)
                and want to see some ROI, it’s very simple and flexible to hook
                it up to our site and you’ll maybe get a few researchers using
                your compute.
              </p>
              <p>Nice rest of the week!</p>
            </div>
          </section>
        </section>
        <section id="40260210">
          <h3>
            <a
              class="item"
              href="https://arcadeblogger.com/2024/02/13/ataris-mike-jang/"
              >Atari's Mike Jang</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-04 @ 20:56:02</span
              ><span class="points-container"
                >Points: <span class="points">216</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40260210"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40260035">
          <h3>
            <a class="item" href="https://dillo-browser.github.io/latest.html"
              >Show HN: Dillo 3.1.0 released after 9 years</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-04 @ 20:22:54</span
              ><span class="points-container"
                >Points: <span class="points">397</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40260035"
                  >Comments</a
                ><span class="descendants">: 96</span></span
              >
            </h4>
            <div class="text">
              <p>
                [1]:
                <a href="https://news.ycombinator.com/item?id=38847613"
                  >https://news.ycombinator.com/item?id=38847613</a
                >
              </p>
              <p>During this time:</p>
              <p>
                - A new mailing list was created[2] which is beginning to get
                some messages and patches. It is available in gmane via NNTP at
                gmane.comp.web.dillo.devel.
              </p>
              <p>
                [2]:
                <a
                  href="https://lists.mailman3.com/hyperkitty/list/dillo-dev@mailman3.com/"
                  >https://lists.mailman3.com/hyperkitty/list/dillo-dev@mailman...</a
                >
              </p>
              <p>
                - A LiberaPay page[3] which received the first donations
                (thanks!).
              </p>
              <p>
                [3]:
                <a href="https://liberapay.com/dillo/"
                  >https://liberapay.com/dillo/</a
                >
              </p>
              <p>
                - Some more bugs where fixed and new features where added
                (details in the release page and/or changelog).
              </p>
              <p>
                Thanks to all the people that contributed with patches and
                tests. Now let's see if we can make it land in some distros!
              </p>
            </div>
          </section>
        </section>
        <section id="40259185">
          <h3>
            <a class="item" href="https://github.com/verus-lang/verus"
              >Verified Rust for low-level systems code</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-04 @ 17:50:53</span
              ><span class="points-container"
                >Points: <span class="points">240</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40259185"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40258804">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2405.00436"
              >Porting HPC Applications to AMD Instinct MI300A Using Unified
              Memory and OpenMP</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-04 @ 16:47:17</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40258804"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40258037">
          <h3>
            <a
              class="item"
              href="https://www.construction-physics.com/p/how-to-build-a-20-billion-semiconductor"
              >How to build a $20B semiconductor fab</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-04 @ 14:42:44</span
              ><span class="points-container"
                >Points: <span class="points">278</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40258037"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40257843">
          <h3>
            <a
              class="item"
              href="https://www.beautifulpublicdata.com/the-mirror-fusion-test-facility/"
              >The Mirror Fusion Test Facility (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-04 @ 14:17:01</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40257843"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40244205">
          <h3>
            <a
              class="item"
              href="https://developer.mozilla.org/en-US/blog/mdn-blog-one-year-on/"
              >A year of publishing the MDN Blog</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-03 @ 04:58:03</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40244205"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40234871">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/cars/2024/05/am-radio-is-a-lifeline-lawmakers-say-tech-and-auto-industries-disagree/"
              >AM radio law opposed by tech and auto industries is close to
              passing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-02 @ 11:20:49</span
              ><span class="points-container"
                >Points: <span class="points">178</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40234871"
                  >Comments</a
                ><span class="descendants">: 221</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40234584">
          <h3>
            <a
              class="item"
              href="https://aphyr.com/posts/353-rewriting-the-technical-interview"
              >Rewriting the Technical Interview (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-02 @ 10:26:41</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40234584"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40233938">
          <h3>
            <a
              class="item"
              href="https://scottlocklin.wordpress.com/2023/11/21/computers-reduce-efficiency-case-studies-of-the-solow-paradox/"
              >Computers Reduce Efficiency: Case Studies of the Solow Paradox
              (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-02 @ 08:28:11</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40233938"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
