<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41329274">
          <h3>
            <a
              class="item"
              href="https://steamcdn-a.akamaihd.net/apps/valve/Valve_NewEmployeeHandbook.pdf"
              >Valve New Employee Handbook (2012) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-23 @ 14:22:32</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41329274"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41329073">
          <h3>
            <a class="item" href="https://www.webcrumbs.org/frontend-ai"
              >Show HN: AI Tool Is Now Supporting React, Angular, CSS, Svelte,
              Vue</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-23 @ 13:58:22</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41329073"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41328447">
          <h3>
            <a class="item" href="https://github.com/PlatformLab/NanoLog"
              >Nanolog supports logging with 7 ns median latency</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-23 @ 12:32:15</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41328447"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41328185">
          <h3>
            <a class="item" href="https://snapdiagram.xyz/"
              >SnapDiagram – Instantly Convert Hand-Drawn Diagrams to Digital
              with AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-23 @ 11:57:31</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41328185"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41328038">
          <h3>
            <a
              class="item"
              href="https://open-web-advocacy.org/blog/apple-adopts-6-owa-choice-architecture-recommendations/"
              >Apple Adopts 6 of OWA's Browser Choice Architecture
              Recommendations</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-23 @ 11:28:56</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41328038"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41328014">
          <h3>
            <a
              class="item"
              href="https://montanaskeptic.substack.com/p/the-chancellors-excellent-questions"
              >The Chancellor's Excellent Questions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-23 @ 11:23:21</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41328014"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41327735">
          <h3>
            <a class="item" href="https://github.com/beac0n/ruroco"
              >Show HN: Ruroco – like port knocking, but better</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-23 @ 10:19:07</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41327735"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
            <div class="text">
              <p>
                ruroco (RUn RemOte COmmand) is a tool that lets you execute
                commands on a server by sending UDP packets (instead of knocking
                on ports).
              </p>
              <p>the tool consist of 3 binaries:</p>
              <p>
                - client -&gt; runs on your notebook/computer and sends the UDP
                packets
              </p>
              <p>
                - server -&gt; receives the UDP packets and makes sure that they
                are valid
              </p>
              <p>
                - commander -&gt; runs the command encoded by the data of the
                UDP packet if it's valid
              </p>
              <p>
                The commands are configured on the server side, so the client
                does not define what is going to be executed, it only picks from
                existing commands.
              </p>
              <p>
                I use this tool to open up the SSH port on my server via ufw,
                but only for the IP address from where I'm connecting, so the
                SSH port appears closed for everyone else, except me.
              </p>
              <p>
                This is my very first "real" rust project, so any feedback is
                highly appreciated :)
              </p>
              <p>Enjoy!</p>
            </div>
          </section>
        </section>
        <section id="41326179">
          <h3>
            <a class="item" href="https://github.com/w3c/epubcheck"
              >EPUBCheck – The official conformance checker for ePub
              publications</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-23 @ 04:31:35</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41326179"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41326117">
          <h3>
            <a class="item" href="http://www.armory.com/tests/hacker.html"
              >Hacker Purity Test (1989)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-23 @ 04:13:16</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41326117"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41326039">
          <h3>
            <a
              class="item"
              href="https://engineering.fb.com/2024/06/24/data-infrastructure/leveraging-ai-for-efficient-incident-response/"
              >Leveraging AI for efficient incident response</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-23 @ 03:49:12</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41326039"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41325889">
          <h3>
            <a
              class="item"
              href="https://simonwillison.net/2024/Aug/23/anthropic-dangerous-direct-browser-access/"
              >Claude's API now supports CORS requests, enabling client-side
              applications</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-23 @ 03:05:33</span
              ><span class="points-container"
                >Points: <span class="points">247</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41325889"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41325719">
          <h3>
            <a
              class="item"
              href="https://github.com/CEREBRUS-MAXIMUS/Surfer-Data"
              >Surfer: Centralize all your personal data from online
              platforms</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-23 @ 02:13:00</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41325719"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41325514">
          <h3>
            <a class="item" href="https://lwn.net/Articles/984502/"
              >Zettlr: Note-Taking and Publishing with Markdown</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-23 @ 01:10:11</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41325514"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41325284">
          <h3>
            <a
              class="item"
              href="https://graphics.stanford.edu/~seander/bithacks.html"
              >Bit Twiddling Hacks (2009)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-23 @ 00:09:32</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41325284"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41323454">
          <h3>
            <a
              class="item"
              href="https://writings.stephenwolfram.com/2024/08/whats-really-going-on-in-machine-learning-some-minimal-models/"
              >What's Going on in Machine Learning? Some Minimal Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-22 @ 19:05:47</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41323454"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41322758">
          <h3>
            <a class="item" href="https://pydong.org/posts/PythonsPreprocessor/"
              >Python’s Preprocessor</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-22 @ 17:54:25</span
              ><span class="points-container"
                >Points: <span class="points">345</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41322758"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41322281">
          <h3>
            <a class="item" href="https://github.com/instantdb/instant"
              >Show HN: InstantDB – A Modern Firebase</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-22 @ 17:08:50</span
              ><span class="points-container"
                >Points: <span class="points">939</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41322281"
                  >Comments</a
                ><span class="descendants">: 201</span></span
              >
            </h4>
            <div class="text">
              <p>
                Building modern apps these days involves a lot of schleps. For a
                basic CRUD app you need to spin up servers, wire up endpoints,
                integrate auth, add permissions, and then marshal data from the
                backend to the frontend and back again. If you want to deliver a
                buttery smooth user experience, you’ll need to add optimistic
                updates and rollbacks. We do these steps over and over for every
                feature we build, which can make it difficult to build
                delightful software. Could it be better?
              </p>
              <p>
                We were senior and staff engineers at Facebook and Airbnb and
                had been thinking about this problem for years. In 2021, Stopa
                wrote an essay talking about how these schleps are actually
                database problems in disguise [1]. In 2022, Stopa wrote another
                essay sketching out a solution with a Firebase-like database
                with support for relations [2]. In the last two years we got the
                backing of James Tamplin (CEO of Firebase), became a team of 5
                engineers, pushed almost ~2k commits, and today became open
                source.
              </p>
              <p>Making a chat app in Instant is as simple as</p>
              <p></p>
              <pre><code>    function Chat() {
      // 1. Read
      const { isLoading, error, data } = useQuery({
        messages: {},
      });
    
      // 2. Write
      const addMessage = (message) =&gt; {
        transact(tx.messages[id()].update(message));
      }
    
      // 3. Render!
      return &lt;UI data={data} onAdd={addMessage} /&gt;
    }
</code></pre>
              Instant gives you a database you can subscribe to directly in the
              browser. You write relational queries in the shape of the data you
              want and we handle all the data fetching, permission checking, and
              offline caching. When you write transactions, optimistic updates
              and rollbacks are handled for you as well.
              <p>
                Under the hood we save data to postgres as triples and wrote a
                datalog engine for fetching data [3]. We don’t expect you to
                write datalog queries so we wrote a graphql-like query language
                that doesn’t require any build step.
              </p>
              <p>
                Taking inspiration from Asana’s WorldStore and Figma’s
                LiveGraph, we tail postgres’ WAL to detect novelty and use
                last-write-win semantics to handle conflicts [4][5]. We also
                handle websocket connections and persist data to IndexDB on web
                and AsyncStorage for React Native, giving you multiplayer and
                offline mode for free.
              </p>
              <p>
                This is the kind of infrastructure Linear uses to power their
                sync and build better features faster [6]. Instant gives you
                this infrastructure so you can focus on what’s important:
                building a great UX for your users, and doing it quickly. We
                have auth, permissions, and a dashboard with a suite tools for
                you to explore and manage your data. We also support ephemeral
                capabilities like presence (e.g. sharing cursors) and broadcast
                (e.g. live reactions) [7][8].
              </p>
              <p>
                We have a free hosted solution where we don’t pause projects, we
                don’t limit the number of active applications, and we have no
                restrictions for commercial use. We can do this because our
                architecture doesn’t require spinning up a separate servers for
                each app. When you’re ready to grow, we have paid plans that
                scale with you. And of course you can self host both the backend
                and the dashboard tools on your own.
              </p>
              <p>
                Give us a spin today at
                <a href="https://instantdb.com/tutorial"
                  >https://instantdb.com/tutorial</a
                >
                and see our code at
                <a href="https://github.com/instantdb/instant"
                  >https://github.com/instantdb/instant</a
                >
              </p>
              <p>We love feedback :)</p>
              <p>
                [1]
                <a href="https://www.instantdb.com/essays/db_browser"
                  >https://www.instantdb.com/essays/db_browser</a
                >
              </p>
              <p>
                [2]
                <a href="https://www.instantdb.com/essays/next_firebase"
                  >https://www.instantdb.com/essays/next_firebase</a
                >
              </p>
              <p>
                [3]
                <a href="https://www.instantdb.com/essays/datalogjs"
                  >https://www.instantdb.com/essays/datalogjs</a
                >
              </p>
              <p>
                [4]
                <a
                  href="https://asana.com/inside-asana/worldstore-distributed-caching-reactivity-part-1"
                  >https://asana.com/inside-asana/worldstore-distributed-cachin...</a
                >
              </p>
              <p>
                [5]
                <a
                  href="https://www.figma.com/blog/how-figmas-multiplayer-technology-works/#syncing-object-properties"
                  >https://www.figma.com/blog/how-figmas-multiplayer-technology...</a
                >
              </p>
              <p>
                [6]
                <a href="https://www.youtube.com/live/WxK11RsLqp4?t=2175s"
                  >https://www.youtube.com/live/WxK11RsLqp4?t=2175s</a
                >
              </p>
              <p>
                [7]
                <a href="https://www.joewords.com/posts/cursors"
                  >https://www.joewords.com/posts/cursors</a
                >
              </p>
              <p>
                [8]
                <a href="https://www.instantdb.com/examples?#5-reactions"
                  >https://www.instantdb.com/examples?#5-reactions</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="41321981">
          <h3>
            <a
              class="item"
              href="https://blog.sergeantbiggs.net/posts/aerc-a-well-crafted-tui-for-email/"
              >Aerc: A well-crafted TUI for email</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-22 @ 16:34:30</span
              ><span class="points-container"
                >Points: <span class="points">269</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41321981"
                  >Comments</a
                ><span class="descendants">: 142</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41321063">
          <h3>
            <a
              class="item"
              href="https://www.allthingsdistributed.com/2024/08/continuous-reinvention-a-brief-history-of-block-storage-at-aws.html"
              >Continuous reinvention: A brief history of block storage at
              AWS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-22 @ 14:59:14</span
              ><span class="points-container"
                >Points: <span class="points">336</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41321063"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41318222">
          <h3>
            <a class="item" href="https://mjg59.dreamwidth.org/70348.html"
              >What is an SBAT and why does everyone suddenly care</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-22 @ 09:11:10</span
              ><span class="points-container"
                >Points: <span class="points">399</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41318222"
                  >Comments</a
                ><span class="descendants">: 223</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41318133">
          <h3>
            <a
              class="item"
              href="https://github.com/boricj/ghidra-delinker-extension"
              >Show HN: A Ghidra extension for exporting parts of a program as
              object files</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-22 @ 08:54:44</span
              ><span class="points-container"
                >Points: <span class="points">285</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41318133"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
            <div class="text">
              <p>
                It supports the COFF and ELF object file formats, for the x86
                and MIPS architectures. It has been successfully used on Linux,
                Windows and PlayStation executables. One user report is on a
                commercial video game from 2009 with a ~7 MiB Windows executable
                written in C++: it was delinked without its C runtime library
                and then relinked into a new executable at a different base
                address, with no visible change in functionality, as a prelude
                to a decompilation project.
              </p>
              <p>
                Use-cases I've demonstrated on my blog include modding, making
                software ports, converting executable file formats, creating
                libraries... I've originally built this as part of a video game
                decompilation project ; I've been working on this over the past
                2.5 years and recently it has started gaining some users besides
                me.
              </p>
            </div>
          </section>
        </section>
        <section id="41311135">
          <h3>
            <a
              class="item"
              href="https://www.lesswrong.com/posts/PJu2HhKsyTEJMxS9a/you-don-t-know-how-bad-most-things-are-nor-precisely-how"
              >We don't know how bad most things are nor precisely how they're
              bad</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-21 @ 15:16:00</span
              ><span class="points-container"
                >Points: <span class="points">278</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41311135"
                  >Comments</a
                ><span class="descendants">: 226</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41293241">
          <h3>
            <a
              class="item"
              href="https://www.objectivebayesian.com/p/hypothesis-testing"
              >Objective Bayesian Hypothesis Testing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-19 @ 18:04:51</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41293241"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41292757">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/DRAKON"
              >DRAKON</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-19 @ 17:10:13</span
              ><span class="points-container"
                >Points: <span class="points">191</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41292757"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41291372">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-08-evidence-stacks-poisonous-toxic-dyes.html"
              >Evidence stacks up for poisonous books containing toxic dyes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-19 @ 14:31:01</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41291372"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41291006">
          <h3>
            <a
              class="item"
              href="https://www.vittlesmagazine.com/p/the-katsuification-of-britain"
              >The Katsuification of Britain</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-19 @ 13:46:05</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41291006"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41290994">
          <h3>
            <a
              class="item"
              href="http://www.kleefeldoncomics.com/2024/08/tales-from-far-side.html"
              >Tales from the Far Side</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-19 @ 13:43:48</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41290994"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41290189">
          <h3>
            <a
              class="item"
              href="https://schmud.de/posts/2024-08-18-data-is-a-bad-idea.html"
              >What If Data Is a Bad Idea?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-19 @ 11:47:41</span
              ><span class="points-container"
                >Points: <span class="points">211</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41290189"
                  >Comments</a
                ><span class="descendants">: 118</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41287085">
          <h3>
            <a
              class="item"
              href="https://convolv.es/blog/2024/08/17/clang-ir-opt-level/"
              >Optimisation-dependent IR decisions in Clang</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-19 @ 01:42:32</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41287085"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41286753">
          <h3>
            <a
              class="item"
              href="https://terinstock.com/post/2024/08/When-Serial-Isnt-RS-232-and-Geocaching-with-the-Garmin-GPS-95/"
              >When Serial Isn't RS-232, Geocaching with the Garmin GPS 95</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-19 @ 00:33:24</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41286753"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
