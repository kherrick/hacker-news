<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41093215">
          <h3>
            <a
              class="item"
              href="https://www.techsistence.com/p/non-obvious-prompt-engineering-guide"
              >Non-Obvious Prompt Engineering Guide</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-28 @ 14:04:34</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41093215"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41093197">
          <h3>
            <a
              class="item"
              href="https://blog.davidv.dev/posts/first-contact-with-k8s/"
              >A skeptic's first contact with Kubernetes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-28 @ 14:00:42</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41093197"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41092862">
          <h3>
            <a class="item" href="https://github.com/CelVoxes/ceLLama"
              >Show HN: CeLLama â€“ Single cell annotation with local Large
              Language Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-28 @ 12:56:55</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41092862"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              A simple R package which helps with annotation of single cell
              experiments such as single cell RNA-seq. With up and down
              regulated genes per cell cluster, the local LLM guesses the cell
              type annotation and creates an overall extensive report.
            </div>
          </section>
        </section>
        <section id="41092861">
          <h3>
            <a
              class="item"
              href="https://cprimozic.net/blog/tools-and-techniques-for-procedural-gamedev/"
              >My favorite tools and techniques for procedural gamedev</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-28 @ 12:56:32</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41092861"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41092667">
          <h3>
            <a
              class="item"
              href="https://jobs.ashbyhq.com/permitflow?departmentId=d33195eb-8978-4439-abc6-5a8a072de808"
              >PermitFlow (YC W22) Is Hiring Senior/Staff+ Engineers in NYC</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-28 @ 12:00:48</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41091803">
          <h3>
            <a
              class="item"
              href="https://www.cambridge.org/core/journals/judgment-and-decision-making/article/irrational-hungry-judge-effect-revisited-simulations-reveal-that-the-magnitude-of-the-effect-is-overestimated/61CE825D4DC137675BB9CAD04571AE58"
              >Irrational hungry judge effect: magnitude is overestimated
              (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-28 @ 07:35:11</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41091803"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41091163">
          <h3>
            <a class="item" href="https://github.com/StreamPot/StreamPot"
              >StreamPot: Run FFmpeg as an API with fluent-FFmpeg compatibility,
              queues and S3</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-28 @ 04:09:04</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41091163"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41090658">
          <h3>
            <a
              class="item"
              href="https://github.com/ionworks/how-to-debug-your-battery"
              >How to debug your battery design</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-28 @ 01:39:06</span
              ><span class="points-container"
                >Points: <span class="points">209</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41090658"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
            <div class="text">
              A guide to simulating the physics inside a battery to solve the
              curse of dimensionality when doing battery R&amp;amp;D using open
              source python tool PyBaMM
            </div>
          </section>
        </section>
        <section id="41090397">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=KqHgCx4Lk_w"
              >Fish in remote tank made into fractals with Video Feedback Device
              [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-28 @ 00:33:19</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41090397"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41090304">
          <h3>
            <a
              class="item"
              href="https://doubleagent.net/onavo-facebook-ssl-mitm-technical-analysis/"
              >How did Facebook intercept their competitor's encrypted mobile
              app traffic?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-28 @ 00:08:21</span
              ><span class="points-container"
                >Points: <span class="points">393</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41090304"
                  >Comments</a
                ><span class="descendants">: 156</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41089161">
          <h3>
            <a
              class="item"
              href="https://www.timeextension.com/features/interview-its-easy-to-get-a-bit-over-ambitious-roguecraft-devs-on-developing-for-amiga-in-2024"
              >Roguecraft Devs on Developing for Amiga in 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 20:35:40</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41089161"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41088895">
          <h3>
            <a
              class="item"
              href="https://johncarlosbaez.wordpress.com/2024/07/27/tritone-substitutions/"
              >Tritone Substitutions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 19:52:34</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41088895"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41088592">
          <h3>
            <a class="item" href="https://github.com/managarm/managarm"
              >Managarm: Pragmatic microkernel-based OS with asynchronous I/O</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 19:06:14</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41088592"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41088314">
          <h3>
            <a
              class="item"
              href="https://www.robertcaro.org/post/an-interview-with-robert-caro-and-kurt-vonnegut"
              >An Interview with Robert Caro and Kurt Vonnegut (1999)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 18:10:31</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41088314"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41088273">
          <h3>
            <a class="item" href="https://github.com/arunsupe/semantic-grep"
              >Show HN: Semantic Grep â€“ A Word2Vec-powered search tool</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 18:02:58</span
              ><span class="points-container"
                >Points: <span class="points">308</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41088273"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
            <div class="text">
              Much improved new version. Search for words similar to the query.
              For example, "death" will find "death", "dying", "dead",
              "killing"... Incredibly useful for exploring large text datasets
              where exact matches are too restrictive.
            </div>
          </section>
        </section>
        <section id="41088013">
          <h3>
            <a class="item" href="https://cybernetic.dev/grid"
              >An experiment in UI density created with Svelte</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 17:23:55</span
              ><span class="points-container"
                >Points: <span class="points">735</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41088013"
                  >Comments</a
                ><span class="descendants">: 218</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41087913">
          <h3>
            <a
              class="item"
              href="https://cepr.org/voxeu/columns/us-fiscal-mess-some-unpleasant-fiscal-simulations"
              >The US fiscal mess: Some unpleasant fiscal simulations</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 17:08:26</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41087913"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41087429">
          <h3>
            <a
              class="item"
              href="https://theconversation.com/how-one-german-city-developed-and-then-lost-generations-of-math-geniuses-106750"
              >GÃ¶ttingen was one of the most productive centers of mathematics
              (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 16:08:26</span
              ><span class="points-container"
                >Points: <span class="points">241</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41087429"
                  >Comments</a
                ><span class="descendants">: 162</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41086060">
          <h3>
            <a class="item" href="https://boogiemath.org/meta/meta-9.html"
              >Oscar Zariski was one of the founders of modern algebraic
              geometry</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 12:12:18</span
              ><span class="points-container"
                >Points: <span class="points">178</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41086060"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41085713">
          <h3>
            <a
              class="item"
              href="https://blog.davidv.dev/posts/pcie-driver-dma/"
              >Learning about PCI-e: Driver and DMA</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 10:55:43</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41085713"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41085660">
          <h3>
            <a
              class="item"
              href="https://www.folger.edu/blogs/collation/writing-paper-expensive/"
              >Was early modern writing paper expensive? (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 10:40:02</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41085660"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41084795">
          <h3>
            <a
              class="item"
              href="https://web.stanford.edu/class/cs81n/command.txt"
              >In the Beginning Was the Command Line (1999)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 06:25:02</span
              ><span class="points-container"
                >Points: <span class="points">346</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41084795"
                  >Comments</a
                ><span class="descendants">: 213</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41083140">
          <h3>
            <a class="item" href="https://blog.regehr.org/archives/1605"
              >How Clang compiles a function (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-26 @ 23:10:44</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41083140"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41081810">
          <h3>
            <a class="item" href="https://github.com/devrim/cloudflare-noip"
              >Free DDNS with Cloudflare and a cronjob</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-26 @ 20:07:52</span
              ><span class="points-container"
                >Points: <span class="points">279</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41081810"
                  >Comments</a
                ><span class="descendants">: 158</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41081067">
          <h3>
            <a class="item" href="https://www.alandalusylahistoria.com/?p=4902"
              >Vikings in al-Andalus and the Maghreb</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-26 @ 18:36:38</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41081067"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41080593">
          <h3>
            <a
              class="item"
              href="https://aeon.co/essays/what-hannah-arendt-proposed-as-an-alternative-to-authenticity"
              >Beyond Authenticity: Hannah Arendt's final unfinished work</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-26 @ 17:44:12</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41080593"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41074488">
          <h3>
            <a
              class="item"
              href="https://techxplore.com/news/2024-07-lightweight-neural-network-enables-realistic.html"
              >Small neural network enables realistic rendering of woven fabrics
              in real-time</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-25 @ 23:23:34</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41074488"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41063823">
          <h3>
            <a class="item" href="https://electricgiraffe.com/"
              >Electric Giraffe</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-25 @ 01:04:23</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41063823"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41061646">
          <h3>
            <a
              class="item"
              href="https://medium.com/message/the-secret-of-minecraft-97dfacb05a3c"
              >The secret of Minecraft (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 20:26:00</span
              ><span class="points-container"
                >Points: <span class="points">166</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41061646"
                  >Comments</a
                ><span class="descendants">: 160</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41057088">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/travel/article/20240723-the-ridgway-hike-the-5000-year-old-pathway-thats-britains-oldest-road"
              >The Ridgway: Hike the 5k-year-old pathway that's Britain's oldest
              road</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 13:47:44</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41057088"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
