<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42189241">
          <h3>
            <a class="item" href="https://sandboxed.ai"
              >Show HN: Serverless code execution, but for AI agents</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 23:36:22</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42189241"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42188855">
          <h3>
            <a class="item" href="https://rib.msb.se/filer/pdf/30874.pdf"
              >Important information to all residents of Sweden – In case of
              crisis or war [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 22:41:02</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42188855"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42188687">
          <h3>
            <a
              class="item"
              href="https://twitter.com/spacex/status/1858995009384837380"
              >SpaceX Super Heavy Splashes Down in the Gulf, Canceling
              Chopsticks Landing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 22:15:34</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42188687"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42188555">
          <h3>
            <a
              class="item"
              href="https://docs.astral.sh/uv/guides/integration/pytorch/"
              >Using uv with PyTorch</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 21:59:10</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42188555"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42188407">
          <h3>
            <a
              class="item"
              href="https://dougallj.wordpress.com/2022/11/09/why-is-rosetta-2-fast/"
              >Why is Apple Rosetta 2 fast?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 21:42:02</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42188407"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42188247">
          <h3>
            <a
              class="item"
              href="https://www.spacex.com/launches/mission/?missionId=starship-flight-6#1"
              >Starship IFT-6 Livestream (liftoff at 4pm CT)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 21:26:18</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42188247"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42188038">
          <h3>
            <a
              class="item"
              href="https://jobs.ashbyhq.com/TigerEye/05e5cea7-5351-49e6-8e96-adda8281ec0b"
              >TigerEye (YC S22) Is Hiring a Full Stack Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 21:00:55</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42187967">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/supercomputer-for-nukes"
              >El Capitan: New supercomputer is the fastest</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 20:52:48</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42187967"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42187766">
          <h3>
            <a class="item" href="https://github.com/OpenRiak"
              >Open Riak – open, modern Riak fork</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 20:29:30</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42187766"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42187761">
          <h3>
            <a
              class="item"
              href="https://underjord.io/how-i-use-erlang-hot-code-updates.html"
              >Using Erlang hot code updates</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 20:29:03</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42187761"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42187640">
          <h3>
            <a class="item" href="https://www.fltk.org/articles.php?L1955"
              >FLTK 1.4 Released</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 20:17:49</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42187640"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42187506">
          <h3>
            <a
              class="item"
              href="https://domainanalysis.io/p/architecture-modernization-execution"
              >When did estimates turn into deadlines?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 20:03:10</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42187506"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42186016">
          <h3>
            <a
              class="item"
              href="https://github.com/DataExpert-io/data-engineer-handbook"
              >The Data Engineering Handbook</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 17:31:59</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42186016"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42185842">
          <h3>
            <a
              class="item"
              href="https://chernando.com/blog/2023/07/23/hand-tracking-for-mouse-input.html"
              >Hand Tracking for Mouse Input</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 17:18:14</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42185842"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42185715">
          <h3>
            <a class="item" href="https://the-analog-thing.org/"
              >The Analog Thing: Analog Computing for the Future</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 17:09:28</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42185715"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42185668">
          <h3>
            <a
              class="item"
              href="https://apps.apple.com/us/app/black-hole-vision/id6737292448"
              >Show HN: Physically accurate black hole simulation using your
              iPhone camera</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 17:06:11</span
              ><span class="points-container"
                >Points: <span class="points">213</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42185668"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42183561">
          <h3>
            <a
              class="item"
              href="https://semiengineering.com/shift-left-is-the-tip-of-the-iceberg/"
              >Shift Left Is the Tip of the Iceberg</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 14:06:36</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42183561"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42182784">
          <h3>
            <a class="item" href="https://github.com/mtantaoui/Integrate"
              >Show HN: Rust library for numerical integration of real-valued
              functions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 12:41:08</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42182784"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
            <div class="text">
              <p>
                Integrate supports a variety of numerical integration
                techniques: - Newton-Cotes methods:
              </p>
              <p></p>
              <pre><code>  - Rectangle Rule.
  - Trapezoidal Rule.
  - Simpson's Rule.
  - Newton's 3/8 Rule.
</code></pre>
              - Gauss quadrature methods:
              <p></p>
              <pre><code>  - Gauss-Legendre.
  - Gauss-Laguerre.
  - Gauss-Hermite.
  - Gauss-Chebyshev First Kind.
  - Gauss-Chebyshev Second Kind.
</code></pre>
              - Adaptive Methods:
              <p></p>
              <pre><code>  - Adaptive Simpson's method
</code></pre>
              - Romberg’s method.
            </div>
          </section>
        </section>
        <section id="42181345">
          <h3>
            <a
              class="item"
              href="https://www.researchgate.net/publication/374700857_Fair_coins_tend_to_land_on_the_same_side_they_started_Evidence_from_350757_flips"
              >Fair coins tend to land on the side they started</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 09:03:50</span
              ><span class="points-container"
                >Points: <span class="points">312</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42181345"
                  >Comments</a
                ><span class="descendants">: 157</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42180597">
          <h3>
            <a class="item" href="https://obrhubr.org/chess-engine"
              >How to Build a Chess Engine and Fail</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 06:38:58</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42180597"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42178916">
          <h3>
            <a
              class="item"
              href="https://pmc.ncbi.nlm.nih.gov/articles/PMC2997957/"
              >Why I hate the index finger (1980)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-19 @ 00:35:15</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42178916"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42174204">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42174204"
              >Launch HN: Regatta Storage (YC F24) – Turn S3 into a local-like,
              POSIX cloud FS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-18 @ 16:49:09</span
              ><span class="points-container"
                >Points: <span class="points">539</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42174204"
                  >Comments</a
                ><span class="descendants">: 296</span></span
              >
            </h4>
            <div class="text">
              <a href="https://regattastorage.com">https://regattastorage.com</a
              >). Regatta Storage is a new cloud file system that provides
              unlimited pay-as-you-go capacity, local-like performance, and
              automatic synchronization to S3-compatible storage. For example,
              you can use Regatta to instantly access massive data sets in S3
              with Spark, Pytorch, or pandas without paying for large, local
              disks or waiting for the data to download.
              <p>
                Check out an overview of how the service works here:
                <a href="https://www.youtube.com/watch?v=xh1q5p7E4JY"
                  >https://www.youtube.com/watch?v=xh1q5p7E4JY</a
                >, and you can try it for free at
                <a href="https://regattastorage.com"
                  >https://regattastorage.com</a
                >
                after signing up for an account. We wanted to let you try it
                without an account, but we figured that “Hacker News shares a
                file system and S3 bucket” wouldn’t be the best experience for
                the community.
              </p>
              <p>
                I built Regatta after spending nearly a decade building and
                operating at-scale cloud storage at places like Amazon’s Elastic
                File System (EFS) and Netflix. During my 8 years at EFS, I
                learned a lot about how teams thought about their storage usage.
                Users frequently told me that they loved how simple and scalable
                EFS was, and -- like S3 -- they didn’t have to guess how much
                capacity they needed up front.
              </p>
              <p>
                When I got to Netflix, I was surprised that there wasn’t more
                usage of EFS. If you looked around, it seemed like a natural
                fit. Every application needed a POSIX file system. Lots of
                applications had unclear or spikey storage needs. Often,
                developers wanted their storage to last beyond the lifetime of
                an individual instance or container. In fact, if you looked
                across all Netflix applications, some ridiculous amount of money
                was being spent on <i>empty storage space</i> because each of
                these local drives had to be overprovisioned for potential
                usage.
              </p>
              <p>
                However, in many cases, EFS wasn’t the perfect choice for these
                workloads. Moving workloads from local disks to NFS often
                encountered performance issues. Further, applications which
                treated their local disks as ephemeral would have to manually
                “clean up” left over data in a persistent storage system.
              </p>
              <p>
                At this point, I realized that there was a missing solution in
                the cloud storage market which wasn’t being filled by either
                block or file storage, and I decided to build Regatta.
              </p>
              <p>
                Regatta is a pay-as-you-go cloud file system that automatically
                expands with your application. Because it automatically
                synchronizes with S3 using native file formats, you can connect
                it to existing data sets and use recently written file data
                directly from S3. When data isn’t actively being used, it’s
                removed from the Regatta cache, so you only pay for the backing
                S3 storage. Finally, we’re developing a custom file protocol
                which allows us to achieve local-like performance for small-file
                workloads <i>and</i> Lustre-like scale-out performance for
                distributed data jobs.
              </p>
              <p>
                Under the hood, customers mount a Regatta file system by
                connecting to our fleet of caching instances over NFSv3 (soon,
                our custom protocol). Our instances then connect to the
                customer’s S3 bucket on the backend, and provide sub-millisecond
                cached-read and write performance. This durable cache allows us
                to provide a strongly consistent, efficient view of the file
                system to all connected file clients. We can perform challenging
                operations (like directory renaming) quickly and durably, while
                they asynchronously propagate to the S3 bucket.
              </p>
              <p>
                We’re excited to see users share our vision for Regatta. We have
                teams who are using us to build totally serverless Jupyter
                notebook servers for their AI researchers who prefer to upload
                and share data using the S3 web UI. We have teams who are using
                us as a distributed caching layer on top of S3 for low-latency
                access to common files. We have teams who are replacing their
                thin-provisioned Ceph boot volumes with Regatta for significant
                savings. We can’t wait to see what other things people will
                build and we hope you’ll give us a try at regattastorage.com.
              </p>
              <p>
                We’d love to get any early feedback from the community, ideas
                for future direction, or experiences in this space. I’ll be in
                the comments for the next few hours to respond!
              </p>
            </div>
          </section>
        </section>
        <section id="42174105">
          <h3>
            <a
              class="item"
              href="https://www.andreinc.net/2024/11/18/a-function-to-approximate-raising-small-numbers-to-small-irrational-powers"
              >A joke in approximating numbers raised to irrational powers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-18 @ 16:41:02</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42174105"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42170423">
          <h3>
            <a
              class="item"
              href="https://texdraft.github.io/fortran/fortran.html"
              >Fortran II Hypersource</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-18 @ 07:10:35</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42170423"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42162271">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2409.11582"
              >Tiling with Three Polygons Is Undecidable</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-17 @ 05:51:44</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42162271"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42147860">
          <h3>
            <a class="item" href="https://sandimetz.com/99bottles"
              >Bottles of OOP now available in Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-15 @ 15:39:16</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42147860"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42136067">
          <h3>
            <a
              class="item"
              href="https://www.teamten.com/lawrence/projects/memoir-book/"
              >Typesetting and printing a family memoir (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-14 @ 13:43:51</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42136067"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42118881">
          <h3>
            <a
              class="item"
              href="https://timestoptech.com/blogs/super-twisted/dungeons-development-of-the-d-20-watch"
              >Developing a D-20 Watch for Tabletop Roleplaying Games</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-12 @ 19:40:57</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42118881"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42116051">
          <h3>
            <a
              class="item"
              href="https://richarddingwall.name/2008/05/31/is-the-80-character-line-limit-still-relevant/"
              >Is the 80 character line limit still relevant? (2008)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-12 @ 15:11:46</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42116051"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42106623">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/ai/2024/11/how-a-stubborn-computer-scientist-accidentally-launched-the-deep-learning-boom/"
              >A stubborn computer scientist accidentally launched the deep
              learning boom</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-11 @ 12:17:33</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42106623"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
