<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41380506">
          <h3>
            <a
              class="item"
              href="https://github.com/getomni-ai/datasets/blob/main/hn_projects.md"
              >Show HN: Every open source tool from the "What's HN working on"
              thread</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-28 @ 15:20:40</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41380506"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41380450">
          <h3>
            <a
              class="item"
              href="https://apnews.com/article/france-telegram-pavel-durov-arrest-6e213d227458f330ed16e7fe221a696c"
              >French prosecutors say Telegram CEO freed from custody, will
              appear in court</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-28 @ 15:14:41</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41380450"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41380154">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/meredith-whittaker-signal/"
              >Interview with Signal President Meredith Whittaker</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-28 @ 14:48:36</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41380154"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41380134">
          <h3>
            <a
              class="item"
              href="https://www.rollingstone.com/politics/politics-features/cia-agent-deep-undercover-spy-islamic-radicals-war-on-terror-1235075156/"
              >CIA Sent Him Deep Undercover to Spy on Islamic Radicals. It Cost
              Him Everything</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-28 @ 14:46:19</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41380134"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41380084">
          <h3>
            <a
              class="item"
              href="https://www.baldurbjarnason.com/2024/the-slow-evaporation-of-the-foss-surplus/"
              >The slow evaporation of the free/open source surplus</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-28 @ 14:43:34</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41380084"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41379408">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41379408"
              >Show HN: Relari – Auto Prompt Optimizer as Lightweight
              Alternative to Finetuning</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-28 @ 13:40:33</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41379408"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.relari.ai">https://www.relari.ai</a>). We
              launched our LLM evaluation stack on HN a few months ago (<a
                href="https://news.ycombinator.com/item?id=39641105"
                >https://news.ycombinator.com/item?id=39641105</a
              >), which is now used in production by AI teams at companies like
              Vanta and PwC. We have since expanded to directly optimizing parts
              of an LLM pipeline using a data-driven approach. In particular, we
              see a lot of potential in the Auto Prompt Optimization—which could
              be an attractive alternative to fine-tuning in many cases—to use
              data to align LLMs for domain-specific tasks.
              <p>
                Here’s a demo video:
                <a
                  href="https://www.loom.com/share/4ad30bf1053e46a3846fc5a07495c486"
                  >https://www.loom.com/share/4ad30bf1053e46a3846fc5a07495c486</a
                >
              </p>
              <p>
                We started working on the auto prompt optimizer because of our
                own frustration with developing, iterating, and maintaining
                prompts across different use cases and models. A minor update to
                the underlying LLM, a change in user requirements, or a shift in
                application infrastructure can render a carefully crafted prompt
                useless. As one user put it, “Prompt engineering is not software
                engineering; it’s wishful thinking.”
              </p>
              <p>
                We tried prompt optimization tools like DSPy and TextGrad, but
                realized they require you to adopt new frameworks, craft custom
                metrics from scratch, and offer limited visibility into the
                optimization process (or even the final optimized prompt). This
                lack of transparency left us guessing whether the new prompts
                are genuinely better or just different.
              </p>
              <p>
                Our Auto Prompt Optimizer aims to be an easy-to-use yet robust
                alternative, with maximum visibility into the optimization
                process and final results. It takes two inputs: a dataset with
                inputs and expected outputs for a given LLM task, and a target
                metric (we have 30+ out-of-the-box metrics). The optimizer then
                starts from your initial prompt and uses the dataset to align
                the LLM output with your desired outcomes. It does this
                iteratively, mutating the prompt based on feedback from the
                target metric. The optimizer automatically selects the examples
                from the datasets to create few-shot prompts and bake in common
                techniques such as chain of thought when appropriate.
              </p>
              <p>
                Here are two examples of the results that include the initial
                prompt, each version of the new prompt, and its performance on
                the target metric
              </p>
              <p>
                - Drug Review Prompt:
                <a href="https://app.relari.ai/demo/prompt/drug-review"
                  >https://app.relari.ai/demo/prompt/drug-review</a
                >
                (a non-standard task where the optimizer created sophisticated
                instructions with detailed rating rubric and corner case
                handling)
              </p>
              <p>
                - Summarization Prompt:
                <a href="https://app.relari.ai/demo/prompt/cnn-highlights"
                  >https://app.relari.ai/demo/prompt/cnn-highlights</a
                >
                (a simple task where the optimizer added more straightforward
                instructions on styling)
              </p>
              <p>
                We see the prompt optimizer as a lightweight and practical
                alternative for adapting LLMs for domain-specific tasks. It can
                deliver high-quality prompts with as few as 100 data points.
              </p>
              <p>
                Try it yourself (<a href="https://app.relari.ai/"
                  >https://app.relari.ai/</a
                >). You can upload your dataset or generate a simple synthetic
                dataset to start the optimization process. It is recommended to
                use a dataset with at least 30 samples. The optimization process
                can take up to an hour depending on the size of the dataset and
                metrics, so we ask you to create an account so we can keep track
                of each optimization run and will send you an email notice once
                it’s completed.
              </p>
              <p>
                What’s next? We’re currently working on support for more
                advanced features like prompt chaining and agent tool call use
                cases. For power users, we offer custom metrics and
                multi-objective optimization to address the most complex use
                cases.
              </p>
              <p>
                What’s been your biggest challenge with prompt engineering?
                Would a dataset-driven approach could improve your prompt
                workflow? We’d love to hear your thoughts and feedback on our
                approach.
              </p>
            </div>
          </section>
        </section>
        <section id="41378819">
          <h3>
            <a
              class="item"
              href="https://buttondown.com/hillelwayne/archive/state-and-time-are-the-same-thing/"
              >State and time are the same thing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-28 @ 12:41:28</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41378819"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41378806">
          <h3>
            <a
              class="item"
              href="https://www.developer-tech.com/news/judge-dismisses-majority-github-copilot-copyright-claims/"
              >Judge dismisses majority of GitHub Copilot copyright claims</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-28 @ 12:39:46</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41378806"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41378527">
          <h3>
            <a
              class="item"
              href="https://drive.google.com/file/d/14GPXekand9xzJEEOD2ze6m59zE0ZlBvC/view"
              >Prosper AI (YC S23) Hiring a Founding Front End Engineer in
              Barcelona (hybrid)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-28 @ 12:01:13</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41378478">
          <h3>
            <a
              class="item"
              href="https://elixir-lang.org/blog/2024/08/28/typing-lists-and-tuples/"
              >Typing lists and tuples in Elixir</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-28 @ 11:49:32</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41378478"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41378428">
          <h3>
            <a
              class="item"
              href="https://www.lightbluetouchpaper.org/2022/07/22/formal-cheri/"
              >Formal CHERI: design-time proof of full-scale architecture
              security properties</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-28 @ 11:42:02</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41378428"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41377960">
          <h3>
            <a class="item" href="https://github.com/seekbytes/IPA"
              >Show HN: IPA, a GUI for exploring inner details of PDFs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-28 @ 10:22:52</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41377960"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41377540">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2408.12569"
              >Sapiens: Foundation for Human Vision Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-28 @ 09:09:13</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41377540"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41377331">
          <h3>
            <a class="item" href="https://github.com/ashishb/wp2hugo"
              >Wp2hugo: Best WordPress to Hugo migrator (written in Go)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-28 @ 08:34:57</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41377331"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41376590">
          <h3>
            <a
              class="item"
              href="https://blog.system76.com/post/cosmic-alpha-released-heres-what-people-are-saying/"
              >COSMIC Alpha Released</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-28 @ 06:30:35</span
              ><span class="points-container"
                >Points: <span class="points">196</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41376590"
                  >Comments</a
                ><span class="descendants">: 105</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41375548">
          <h3>
            <a class="item" href="https://gamengen.github.io"
              >Diffusion models are real-time game engines</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-28 @ 02:59:40</span
              ><span class="points-container"
                >Points: <span class="points">864</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41375548"
                  >Comments</a
                ><span class="descendants">: 303</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41374663">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/2024/08/27/teslas-ttpoe-at-hot-chips-2024-replacing-tcp-for-low-latency-applications/"
              >Tesla’s TTPoE at Hot Chips 2024: Replacing TCP for Low Latency
              Applications</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-28 @ 00:06:45</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41374663"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41374009">
          <h3>
            <a class="item" href="https://chartdb.io/"
              >ChartDB – Free and open source, database design editor</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 22:38:49</span
              ><span class="points-container"
                >Points: <span class="points">223</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41374009"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41372833">
          <h3>
            <a class="item" href="https://josephg.com/blog/crdts-go-brrr/"
              >Faster CRDTs (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 20:47:28</span
              ><span class="points-container"
                >Points: <span class="points">305</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41372833"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41371170">
          <h3>
            <a class="item" href="https://www.freepublicapis.com/"
              >A Collection of Free Public APIs That Is Tested Daily</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 18:38:59</span
              ><span class="points-container"
                >Points: <span class="points">510</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41371170"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41371106">
          <h3>
            <a class="item" href="https://www.mono-project.com/"
              >Microsoft donates the Mono Project to the Wine team</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 18:34:09</span
              ><span class="points-container"
                >Points: <span class="points">1258</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41371106"
                  >Comments</a
                ><span class="descendants">: 412</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41370187">
          <h3>
            <a
              class="item"
              href="https://www.blitzortung.org/en/live_lightning_maps.php"
              >Blitzortung – real time lightning strikes around the world</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 17:21:56</span
              ><span class="points-container"
                >Points: <span class="points">302</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41370187"
                  >Comments</a
                ><span class="descendants">: 123</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41370020">
          <h3>
            <a
              class="item"
              href="https://owickstrom.github.io/the-monospace-web/"
              >The Monospace Web</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 17:09:56</span
              ><span class="points-container"
                >Points: <span class="points">533</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41370020"
                  >Comments</a
                ><span class="descendants">: 133</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41368866">
          <h3>
            <a
              class="item"
              href="https://www.theartnewspaper.com/2024/08/27/sainsbury-wing-contractors-find-1990-letter-from-donor-anticipating-their-demolition-of-false-columns"
              >Sainsbury Wing contractors find 1990 letter from donor</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-27 @ 15:49:27</span
              ><span class="points-container"
                >Points: <span class="points">344</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41368866"
                  >Comments</a
                ><span class="descendants">: 111</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41356484">
          <h3>
            <a
              class="item"
              href="https://box86.org/2024/08/box64-and-risc-v-in-2024/"
              >Box64 and RISC-V in 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-26 @ 12:30:09</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41356484"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41356415">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/sf/style/2017/08/07/chefs-say-a-dishwasher-can-make-or-break-a-restaurant-so-i-signed-up-for-a-shift/"
              >A dishwasher can make or break a restaurant (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-26 @ 12:17:21</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41356415"
                  >Comments</a
                ><span class="descendants">: 212</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41355797">
          <h3>
            <a class="item" href="https://rerun.io"
              >Rerun: Visualize Multimodal Data over Time</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-26 @ 10:34:49</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41355797"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41349585">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/08/22/science/fossils-worms-bifungites-brazil.html"
              >Marine worms made at least some trace fossil burrows called
              Bifungites</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-25 @ 18:03:21</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41349585"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41346124">
          <h3>
            <a
              class="item"
              href="https://martypc.blogspot.com/2024/08/pc-floppy-copy-protection-formaster.html"
              >PC Floppy Copy Protection: Formaster Copy-Lock</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-25 @ 10:14:41</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41346124"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41327394">
          <h3>
            <a
              class="item"
              href="https://sebastianmarines.com/post/journey-of-a-packet-exploring-networks-with-traceroute/"
              >The journey of an internet packet: Exploring networks with
              traceroute</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-23 @ 09:10:39</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41327394"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
