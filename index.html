<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40383078">
          <h3>
            <a class="item" href="https://skio.com/careers/"
              >Skio (YC S20) â€“ Subscriptions for Shopify, ReCharge Migrations Is
              Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 21:01:29</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40383029">
          <h3>
            <a
              class="item"
              href="https://about.winamp.com/press/article/winamp-open-source-code"
              >Winamp has announced that it is "opening up" its source code</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 20:56:17</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40383029"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40382941">
          <h3>
            <a
              class="item"
              href="https://apps.apple.com/ua/app/cleano/id6469460523?mt=12"
              >Show HN: I've built a macOS app for developers to clean their dev
              machines</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 20:48:58</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40382941"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
            <div class="text">
              <p>
                During last time we (me and my friend) were building an app to
                clean various stuff after Xcode. I was fed up as a developer
                that Apple related things load my drive and I need hundreds of
                gigabytes just to do my job.
              </p>
              <p>
                It's live now on Mac App Store and we'll be glad to hear your
                feedback:
                <a href="https://apps.apple.com/ua/app/cleano/id6469460523"
                  >https://apps.apple.com/ua/app/cleano/id6469460523</a
                >
              </p>
              <p>Features</p>
              <p>
                - Simulators cleanup. It's a correct cleanup via 'simctl' so you
                even don't need to restart Xcode for it to take effect - SPM
                repos cache. Swift PM stores github repos for packages
                separately and never removes them unless you ask it via cli. -
                Derived Data, a first thing you try to fix weird Xcode linking
                issues :)
              </p>
              <p>
                Some features currently in development: - Desktop widget, so you
                can delete derived data with a single mouse click - Support for
                more package managers like CocoaPods; they also have substantial
                caches that appear to be ignored
              </p>
              <p>Links</p>
              <p>
                We also have a separate GitHub repo (we're developers, right?)
                to track issues and feature requests:
                <a href="https://deszip.github.io/Cleaner-Tracker/"
                  >https://deszip.github.io/Cleaner-Tracker/</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="40382783">
          <h3>
            <a
              class="item"
              href="https://openai.com/index/openai-and-reddit-partnership/"
              >OpenAI and Reddit Partnership</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 20:34:00</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40382783"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40382568">
          <h3>
            <a
              class="item"
              href="https://www.phoronix.com/news/Germany-STF-For-FFmpeg"
              >Germany's Sovereign Tech Fund Now Supporting FFmpeg</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 20:09:19</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40382568"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40382550">
          <h3>
            <a
              class="item"
              href="https://github.com/lydiahallie/javascript-questions"
              >A long list of (advanced) JavaScript questions, and their
              explanations</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 20:07:37</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40382550"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40382379">
          <h3>
            <a
              class="item"
              href="https://madattheinternet.substack.com/p/online-censorships-institutional"
              >Online censorship's institutional power</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 19:48:39</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40382379"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40382271">
          <h3>
            <a class="item" href="https://dashwave.io/"
              >Show HN: We built the fastest Android dev ecosystem</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 19:38:45</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40382271"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <p>
                With options like Vercel, Gitpod, Stackblitz and many more in
                web dev available, who take a hard stance on developer
                productivity, we decided to bring such capabilities to Android
                dev as well.
              </p>
              <p>
                We built Dashwave to fundamentally enhance this by bringing fast
                (like phenomenally fast) builds, in-browser app previews of
                feature branches and one-click battery-loaded workspaces.
              </p>
              <p>
                By simply attaching your IDE or repository to the platform, your
                builds with emulated previews will show up straight up on the
                browser. Share those previews for instant feedback and PR
                reviews. Rapidly fix bugs without switching context from
                in-browser workspaces.
              </p>
              <p>
                Technically, we achieved this by pretty standard methodologies
                like distributed caching, interactive streaming, advanced
                scheduling algorithms and putting in good degrees of
                optimizations over them. We are hard believers of the
                first-principles approach.
              </p>
              <p>
                Give it a run let us know what you think! We are excited to put
                powerful tools into the hands of exceptional teams.
              </p>
            </div>
          </section>
        </section>
        <section id="40382246">
          <h3>
            <a class="item" href="https://openjdk.org/jeps/8291976"
              >JEP Draft: Support HTTP/3 in the HttpClient</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 19:35:21</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40382246"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40382163">
          <h3>
            <a
              class="item"
              href="https://www.architecturalrecord.com/articles/16880-exit-strategy-the-case-for-single-stair-egress"
              >Exit Strategy: The Case for Single-Stair Egress</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 19:29:18</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40382163"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40381966">
          <h3>
            <a
              class="item"
              href="https://journals.sagepub.com/doi/full/10.1177/17456916241252085"
              >Taboos and Self-Censorship Among U.S. Psychology Professors</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 19:10:38</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40381966"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40381841">
          <h3>
            <a class="item" href="https://snai.pe/posts/c-smart-pointers"
              >Smart Pointers in (GNU) C</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 18:56:55</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40381841"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40381511">
          <h3>
            <a class="item" href="https://viralinstruction.com/posts/utf8/"
              >You probably don't need to validate UTF-8 strings</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 18:21:17</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40381511"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40381166">
          <h3>
            <a
              class="item"
              href="https://newsroom.taylorandfrancisgroup.com/wind-farms-can-offset-their-emissions-within-two-years-new-study-shows/"
              >Wind farms can offset their emissions within two years, new study
              shows</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 17:48:04</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40381166"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40380975">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/opinion/articles/2024-05-16/crypto-brothers-front-ran-the-front-runners"
              >Crypto brothers front-ran the front-runners</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 17:32:21</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40380975"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40380744">
          <h3>
            <a
              class="item"
              href="https://slate.com/technology/2024/05/deviantart-what-happened-ai-decline-lawsuit-stability.html"
              >The Tragic Downfall of the Internet's Art Gallery</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 17:12:22</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40380744"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40380158">
          <h3>
            <a
              class="item"
              href="https://future.mozilla.org/news/llamafiles-for-embeddings-in-local-rag-applications/"
              >Using Llamafiles for Embeddings in Local RAG Applications</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 16:20:03</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40380158"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40379982">
          <h3>
            <a
              class="item"
              href="https://blog.playcanvas.com/build-webgpu-apps-today-with-playcanvas/"
              >Build WebGPU Apps Today with PlayCanvas</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 16:04:47</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40379982"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40379599">
          <h3>
            <a class="item" href="https://www.sabrina.dev/p/chatgpt4o-vs-math"
              >ChatGPT-4o vs. Math</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 15:30:49</span
              ><span class="points-container"
                >Points: <span class="points">198</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40379599"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40379488">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-024-01449-y"
              >Egypt's pyramids may have been built on a long-lost branch of the
              Nile</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 15:20:45</span
              ><span class="points-container"
                >Points: <span class="points">176</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40379488"
                  >Comments</a
                ><span class="descendants">: 208</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40379028">
          <h3>
            <a
              class="item"
              href="https://www.techdirt.com/2024/05/16/report-sprint-t-mobile-merger-immediately-killed-wireless-price-competition-in-u-s/"
              >Sprint, T-Mobile Merger Killed Wireless Price Competition in
              U.S.</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 14:38:40</span
              ><span class="points-container"
                >Points: <span class="points">233</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40379028"
                  >Comments</a
                ><span class="descendants">: 190</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40378791">
          <h3>
            <a class="item" href="https://www.d3indepth.com/">D3 in Depth</a>
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 14:18:07</span
              ><span class="points-container"
                >Points: <span class="points">190</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40378791"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40378499">
          <h3>
            <a class="item" href="https://github.com/likejazz/llama3.np"
              >Llama3.np: pure NumPy implementation of Llama3</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 13:53:22</span
              ><span class="points-container"
                >Points: <span class="points">280</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40378499"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40377685">
          <h3>
            <a class="item" href="https://www.fstar-lang.org/"
              >F* â€“ A Proof-Oriented Programming Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-16 @ 12:47:07</span
              ><span class="points-container"
                >Points: <span class="points">171</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40377685"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40365777">
          <h3>
            <a
              class="item"
              href="https://www.tfeb.org/fragments/2024/05/15/an-iteration-construct-for-common-lisp/"
              >Å tar: an iteration construct for Common Lisp</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 12:03:20</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40365777"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40365559">
          <h3>
            <a
              class="item"
              href="https://news.mit.edu/2024/robotic-superlimbs-could-help-moonwalkers-recover-from-falls-0515"
              >Robotic "SuperLimbs" could help moonwalkers recover from falls</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 11:40:57</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40365559"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40365248">
          <h3>
            <a
              class="item"
              href="https://fgiesen.wordpress.com/2016/08/07/why-do-cpus-have-multiple-cache-levels/"
              >Why do CPUs have multiple cache levels? (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 10:58:44</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40365248"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40364220">
          <h3>
            <a class="item" href="https://ai.google.dev/gemini-api/docs/caching"
              >Google Gemini: Context Caching</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 07:56:22</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40364220"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40364108">
          <h3>
            <a
              class="item"
              href="https://www.ft.com/content/6d846a93-030a-4106-b045-d74a216493b0"
              >Raspberry Pi prepares for London listing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 07:36:36</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40364108"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40363458">
          <h3>
            <a class="item" href="https://www.lurklurk.org/hqse/hqse.html"
              >High-Quality Software Engineering (2007)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-15 @ 05:39:44</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40363458"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
