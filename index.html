<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44958506">
          <h3>
            <a
              class="item"
              href="https://www.overcomingbias.com/p/many-big-pre-sputnik-earth-orbit"
              >Pre-Sputnik Earth-Orbit Glints</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-20 @ 03:55:53</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44958506"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44958421">
          <h3>
            <a
              class="item"
              href="https://pvk.ca/Blog/2025/08/19/monoid-augmented-fifos/"
              >Monoid-Augmented FIFOs, Deamortised</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-20 @ 03:35:20</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44958421"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44958020">
          <h3>
            <a
              class="item"
              href="https://www.mooreds.com/wordpress/archives/3530"
              >The Value of Hitting the HN Front Page</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-20 @ 02:00:11</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44958020"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44957818">
          <h3>
            <a
              class="item"
              href="https://anguscheng.com/post/2025-08-13-calling-their-bluff/"
              >Calling Their Bluff</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-20 @ 01:19:43</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44957818"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44957454">
          <h3>
            <a
              class="item"
              href="https://pistachioapp.com/blog/copilot-broke-your-audit-log"
              >Copilot broke audit logs, but Microsoft won't tell customers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-20 @ 00:18:00</span
              ><span class="points-container"
                >Points: <span class="points">325</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44957454"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44957443">
          <h3>
            <a class="item" href="https://agents.md/"
              >AGENTS.md – Open format for guiding coding agents</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-20 @ 00:15:03</span
              ><span class="points-container"
                >Points: <span class="points">280</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44957443"
                  >Comments</a
                ><span class="descendants">: 134</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44957157">
          <h3>
            <a
              class="item"
              href="https://nautil.us/a-rogue-new-life-form-1232095/"
              >Tiny microbe challenges the definition of cellular life</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-19 @ 23:18:48</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44957157"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44956915">
          <h3>
            <a class="item" href="https://muffinman.io/blog/invaders/"
              >How to Draw a Space Invader</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-19 @ 22:41:16</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44956915"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44956774">
          <h3>
            <a class="item" href="https://jax-ml.github.io/scaling-book/gpus/"
              >How to Scale Your Model: How to Think About GPUs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-19 @ 22:17:38</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44956774"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44956581">
          <h3>
            <a
              class="item"
              href="https://re.factorcode.org/2023/08/drunken-bishop.html"
              >Drunken Bishop (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-19 @ 21:48:30</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44956581"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44955576">
          <h3>
            <a class="item" href="https://github.com/openai/openai-reflect"
              >Show HN: OpenAI/reflect – Physical AI Assistant that illuminates
              your life</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-19 @ 19:48:38</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44955576"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
            <div class="text">
              <p>
                * Extendable/hackable - I tried to keep the code as simple as
                possible so others can fork/modify easily.
              </p>
              <p>
                * Communicate with light. With function calling it changes the
                light bulb, so it can match your mood or feelings.
              </p>
              <p>
                * Populate info from clients you control. I wanted to experiment
                with having it guide you through yesterday/today.
              </p>
              <p>
                * Phone as control. Setting up new devices can be frustrating. I
                liked that this didn't require any WiFi setup, it just routed
                everything through your phone. Also cool then that they device
                doesn't actually have any sensitive data on it.
              </p>
            </div>
          </section>
        </section>
        <section id="44955459">
          <h3>
            <a
              class="item"
              href="https://madebyevan.com/algos/crdt-text-buffer/"
              >CRDT: Text Buffer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-19 @ 19:38:45</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44955459"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44954823">
          <h3><a class="item" href="https://www.anduinos.com/">AnduinOS</a></h3>
          <section>
            <h4>
              <span>2025-08-19 @ 18:42:25</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44954823"
                  >Comments</a
                ><span class="descendants">: 123</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44954524">
          <h3>
            <a class="item" href="https://d2lang.com/blog/ascii/"
              >D2 (text to diagram tool) now supports ASCII renders</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-19 @ 18:14:41</span
              ><span class="points-container"
                >Points: <span class="points">256</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44954524"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44953575">
          <h3>
            <a
              class="item"
              href="https://motherduck.com/blog/semantic-layer-duckdb-tutorial/"
              >Why Semantic Layers Matter (and how to build one with DuckDB)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-19 @ 16:49:15</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44953575"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44953316">
          <h3>
            <a
              class="item"
              href="https://xenodium.com/emacs-as-your-video-trimming-tool"
              >Emacs as your video-trimming tool</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-19 @ 16:22:01</span
              ><span class="points-container"
                >Points: <span class="points">207</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44953316"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44953032">
          <h3>
            <a
              class="item"
              href="https://research.kudelskisecurity.com/2025/08/19/how-we-exploited-coderabbit-from-a-simple-pr-to-rce-and-write-access-on-1m-repositories/"
              >How we exploited CodeRabbit: From simple PR to RCE and write
              access on 1M repos</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-19 @ 15:55:15</span
              ><span class="points-container"
                >Points: <span class="points">531</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44953032"
                  >Comments</a
                ><span class="descendants">: 179</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44952789">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/articles/derinkuyu-turkey-underground-city-strange-maps"
              >A renovation project in Turkey led to the discovery of a lost
              city (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-19 @ 15:34:55</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44952789"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44951563">
          <h3>
            <a class="item" href="https://h4x0r.org/futex/"
              >Without the futex, it's futile</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-19 @ 13:53:42</span
              ><span class="points-container"
                >Points: <span class="points">245</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44951563"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44950661">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=44950661"
              >Launch HN: Uplift (YC S25) – Voice models for under-served
              languages</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-19 @ 12:10:09</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44950661"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
            <div class="text">
              <a href="https://upliftai.org">https://upliftai.org</a>). We build
              models that speak underserved languages — today: Urdu, Sindhi, and
              Balochi.
              <p>
                A billion people worldwide can't read. In countries like
                Pakistan – the 5th most populous country – 42% of adults are
                illiterate. This holds back the entire economy: patients can't
                read medical reports, parents can't help with homework, banks
                can't go fully digital, farmers can't research best practices,
                and people memorize smartphone app button sequences. Voice AI
                interfaces can fix all of this, and we think this will perhaps
                be one of the great benefits of modern AI.
              </p>
              <p>
                Right now, existing voice models barely work for these
                languages, and big tech is moving slowly.
              </p>
              <p>
                Uplift AI was originally a side project to make datasets for
                translation and voice models. For us it was a "cool side-thing"
                to work on, not an "important full-time thing" to work on. With
                some initial data we hacked together a Urdu Voice Bot on
                Whatsapp and gave it to one domestic worker. In two days 800
                people were using it. When we dived deeper into understanding
                the users, we learned that text interfaces don't work for sooo
                many. So we started Uplift AI to solve this problem fulltime.
              </p>
              <p>
                The most challenging part is that all the building blocks needed
                for great voice models are broken for these languages. For
                example, if you are creating a speech synthesis model, you will
                scrape a lot of data from youtube and auto-label it using a
                transcription model… all very easy to do in English. But it
                doesn't work in under-served languages because the transcription
                modes are not accurate.
              </p>
              <p>
                There are many other challenges. Like when you hire human
                transcribers to label the data, often they don't have any spell
                correctors for their languages, and this creates lots of noise
                in the data… making it hard to train models with low data. There
                are many more challenges in phonemes, silence detection,
                diacritization etc.
              </p>
              <p>
                We solve these problems by making great internal tooling to help
                with data labeling. Also, we source our own data and don't buy
                it. This is counterintuitive, but a big advantage over companies
                buying data and then training. By sourcing our own data we
                create the right data distributions and get much better models
                with much less data. By doing the entire thing inhouse, (data,
                labeling, training, deploying) we are able to make a lot faster
                progress.
              </p>
              <p>
                Today we publicly offer a text to speech APIs for Urdu, Sindhi,
                and Balochi. Here's a video which shows this:
                <a
                  href="https://www.loom.com/share/dcd5020967444c228e9c127151e7a9f5"
                  >https://www.loom.com/share/dcd5020967444c228e9c127151e7a9f5</a
                >.
              </p>
              <p>
                Khan Academy is using our tech to dub videos to Urdu (<a
                  href="https://ur.khanacademy.org"
                  >https://ur.khanacademy.org</a
                >).
              </p>
              <p>
                Our models excel at informational use cases (like AI bots) but
                need more work in emotive use-cases like poetry.
              </p>
              <p>
                We have been giving a lot of people private access in beta mode,
                and today are launching our models publicly. We believe this
                will be the fastest way for us to learn about areas that are not
                performing well so we can fix them quickly.
              </p>
              <p>
                We'd love to hear from all of you, especially around your
                experiences with under-served languages (not just the Pakistani
                ones we're starting with) and your comments in general.
              </p>
            </div>
          </section>
        </section>
        <section id="44949895">
          <h3>
            <a
              class="item"
              href="https://www.svendewaerhert.com/blog/telescope-mount/"
              >Custom telescope mount using harmonic drives and ESP32</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-19 @ 09:46:27</span
              ><span class="points-container"
                >Points: <span class="points">272</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44949895"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44939502">
          <h3>
            <a
              class="item"
              href="https://google.github.io/filament/Filament.md.html#overview"
              >Physically Based Rendering in Filament</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-18 @ 11:34:18</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44939502"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44939165">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/the-end-of-handwriting/"
              >The End of Handwriting</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-18 @ 10:37:25</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44939165"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44938667">
          <h3>
            <a class="item" href="https://github.com/railsjazz/rails_charts"
              >Rails Charts Using ECharts from Apache</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-18 @ 09:00:53</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44938667"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44938622">
          <h3>
            <a class="item" href="https://3d.ameo.design/geotoy"
              >Geotoy – Shadertoy for 3D Geometry</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-18 @ 08:54:48</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44938622"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44938354">
          <h3>
            <a
              class="item"
              href="https://jrsinclair.com/articles/2025/joy-of-immutable-data-recursion-pure-functions-javascript-mazes/"
              >The joy of recursion, immutable data, &amp;amp; pure functions:
              Making mazes with JS</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-18 @ 07:57:30</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44938354"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44927953">
          <h3>
            <a
              class="item"
              href="https://computer.rip/2025-08-16-passive-microwave-repeaters.html"
              >Passive Microwave Repeaters</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-17 @ 00:25:27</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44927953"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44926143">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2025/08/tiny-removable-mini-ssd-could-eventually-be-a-big-deal-for-gaming-handhelds/"
              >Tiny, removable "mini SSD" could eventually be a big deal for
              gaming handhelds</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-16 @ 19:14:01</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44926143"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44922362">
          <h3>
            <a
              class="item"
              href="https://www.figma.com/blog/how-figmas-multiplayer-technology-works/"
              >How Figma’s multiplayer technology works (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-16 @ 11:41:02</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44922362"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44921195">
          <h3>
            <a
              class="item"
              href="https://cpldcpu.com/2025/08/13/candle-flame-oscillations-as-a-clock/"
              >Candle Flame Oscillations as a Clock</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-16 @ 07:49:51</span
              ><span class="points-container"
                >Points: <span class="points">267</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44921195"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
