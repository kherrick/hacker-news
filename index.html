<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39640678">
          <h3>
            <a
              class="item"
              href="https://twitter.com/seshubon/status/1765870717844050221"
              >Claude Sonnet and Pi AI give exact same response to a prompt</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-08 @ 13:03:43</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39640678"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39640303">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Juan_Pujol_Garc%C3%ADa"
              >WWII: Failed novelist becomes a spy for Germany, makes up a fake
              spy network</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-08 @ 12:05:14</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39640303"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39640274">
          <h3>
            <a
              class="item"
              href="https://www.ribbonhealth.com/open-roles?gh_jid=5118848004"
              >Ribbon Health (YC S17) Is Hiring a Web Scraping Tech Lead</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-08 @ 12:00:31</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39640190">
          <h3>
            <a
              class="item"
              href="https://www.bl.uk/home/british-library-cyber-incident-review-8-march-2024.pdf"
              >Learning Lessons From The Cyber-Attack: British Library cyber
              incident review [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-08 @ 11:45:45</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39640190"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39639903">
          <h3>
            <a
              class="item"
              href="https://asteriskmag.com/issues/05/the-ruin-of-mumbai"
              >The Ruin of Mumbai–Asterisk</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-08 @ 10:56:30</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39639903"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39639689">
          <h3>
            <a class="item" href="https://rolldown.rs/"
              >Rolldown: Rollup compatible bundler written in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-08 @ 10:19:09</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39639689"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39639418">
          <h3>
            <a class="item" href="https://github.com/6174/comflowyspace"
              >ComflowySpace: An open-source version of better ComfyUI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-08 @ 09:27:43</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39639418"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39639253">
          <h3>
            <a
              class="item"
              href="https://twitter.com/ThierryBreton/status/1765793776692326891"
              >Thierry Breton: Under DMA, there is no room for threats by
              gatekeepers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-08 @ 08:58:40</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39639253"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39639125">
          <h3>
            <a class="item" href="https://www.seat61.com">The Man in Seat 61</a>
          </h3>
          <section>
            <h4>
              <span>2024-03-08 @ 08:39:16</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39639125"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39638836">
          <h3>
            <a class="item" href="https://usrtk.org/pesticides/chlorpyrifos/"
              >Chlorpyrifos: Pesticide tied to brain damage in children</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-08 @ 07:49:35</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39638836"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39638676">
          <h3>
            <a class="item" href="https://cylinder.doforce.xyz"
              >Show HN: Cylinder HN – View Trending Hacker News and Search
              Everything</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-08 @ 07:24:01</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39638676"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
            <div class="text">
              It's a website with nice UI where you can view and search all
              Hacker News stories.
            </div>
          </section>
        </section>
        <section id="39637487">
          <h3>
            <a
              class="item"
              href="https://lisyarus.github.io/blog/programming/2023/02/21/exponential-smoothing.html"
              >My favourite animation trick: exponential smoothing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-08 @ 03:27:06</span
              ><span class="points-container"
                >Points: <span class="points">502</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39637487"
                  >Comments</a
                ><span class="descendants">: 253</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39637471">
          <h3>
            <a
              class="item"
              href="https://noisypixel.net/dragon-ball-creator-akira-toriyama-has-passed-away/"
              >Akira Toriyama has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-08 @ 03:24:50</span
              ><span class="points-container"
                >Points: <span class="points">797</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39637471"
                  >Comments</a
                ><span class="descendants">: 151</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39636991">
          <h3>
            <a
              class="item"
              href="https://www.esa.int/Space_Safety/Space_Debris/Reentry_of_International_Space_Station_ISS_batteries_into_Earth_s_atmosphere"
              >Reentry of International Space Station Batteries into Earth's
              Atmosphere</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-08 @ 02:01:10</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39636991"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39636470">
          <h3>
            <a
              class="item"
              href="https://github.com/aaronraimist/DontFuckWithPaste"
              >Don't fuck with paste</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-08 @ 00:49:27</span
              ><span class="points-container"
                >Points: <span class="points">561</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39636470"
                  >Comments</a
                ><span class="descendants">: 280</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39636259">
          <h3>
            <a class="item" href="http://stations.albertguillaumes.cat/"
              >Stations and transfers (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-08 @ 00:20:19</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39636259"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39635743">
          <h3>
            <a
              class="item"
              href="https://annas-blog.org/blog-how-to-become-a-pirate-archivist.html"
              >How to become a pirate archivist (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 23:06:40</span
              ><span class="points-container"
                >Points: <span class="points">176</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39635743"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39635483">
          <h3>
            <a
              class="item"
              href="https://www.answer.ai/posts/2024-03-06-fsdp-qlora.html"
              >Fine tune a 70B language model at home</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 22:38:49</span
              ><span class="points-container"
                >Points: <span class="points">386</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39635483"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
            <div class="text">
              <p>
                It's the #1 most requested thing I've been hearing from open
                source model builders: the ability to use multiple GPUs with
                QLoRA training. So that's why we decided to make it our first
                project.
              </p>
              <p>
                Huge thanks to Tim Dettmers for helping us get started to this
                -- and of course for creating QLoRA in the first place!
              </p>
              <p>Let me know if you have any questions or thoughts.</p>
            </div>
          </section>
        </section>
        <section id="39634195">
          <h3>
            <a
              class="item"
              href="https://ironicsans.beehiiv.com/p/life-death-bulbdial-clock"
              >The Life and Death of the Bulbdial Clock</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 20:26:51</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39634195"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39632872">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39632872"
              >Launch HN: SiLogy (YC W24) – Chip design and verification in the
              cloud</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 18:38:22</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39632872"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
            <div class="text">
              <a href="https://silogy.io/">https://silogy.io/</a>). We’re
              building chip design and verification tools to speed up the
              semiconductor development cycle. Here's a demo:
              <a href="https://www.youtube.com/watch?v=u0wAegt79EA"
                >https://www.youtube.com/watch?v=u0wAegt79EA</a
              >
              <p>
                Interest in designing new chips is growing, thanks to demand
                from AI and the predicted decline of Moore’s Law. All these
                chips need to be tested in simulation. Since the number of
                possible states grows exponentially with chip complexity, the
                need for verification is exploding. Chip developers already
                spend 70% of their time on testing. (See this video on the
                “verification gap”:
                <a href="https://www.youtube.com/watch?v=rtaaOdGuMCc"
                  >https://www.youtube.com/watch?v=rtaaOdGuMCc</a
                >).
              </p>
              <p>
                Tooling hasn’t kept up. The state of the art in collaborative
                debugging is to walk to a coworker’s desk and point to an error
                in a log file or waveform file. Each chip company rolls out its
                own tooling and infra to deal with this—this was Kay’s (one of
                our cofounders) entire job at his last gig. But they want to
                work on chips, not devtools! The solutions they come up with are
                often inadequate and frustrating. That’s why we started SiLogy.
              </p>
              <p>
                SiLogy is a web app to manage the entire digital verification
                workflow. (“Digital verification” means testing the logic of the
                design and includes everything before the physical design of the
                chip. It’s the most time-consuming stage in verification.)
              </p>
              <p>We combine three capabilities:</p>
              <p>
                <i>Test orchestration and running</i>: The heart of our product
                is a CI tool that runs Verilator, a popular open-source
                simulator, in a Docker container. When you push to your repo or
                manually trigger a job in the UI, we install your dependencies
                and compile your binaries into a Docker image, and run your
                tests. You can also rerun a single test with custom arguments
                using the UI.
              </p>
              <p>
                <i>Test results and statistics</i>: We display logs from each
                test in the web app. We’re working on displaying waveform files
                in the app, too. We also keep track of passing and failing tests
                within each test suite, and we’re working on slick
                visualizations of test trends, to keep managers happy. :)
              </p>
              <p>
                <i>Collaboration</i>: soon you’ll be able to send a link to and
                leave a comment on a specific location within a log or waveform
                file, just like in Google Docs.
              </p>
              <p>
                Unlike generic CI tools, we focus on tight integration with
                verification workflows. When an assertion fails, we show you the
                source code where it happened. We’re hard at work on waveform
                viewing – soon you’ll be able to generate waves from a failing
                test, with the click of a button.
              </p>
              <p>
                Our roadmap includes support for the major commercial
                simulators: VCS, Xcelium, and Questa. We’re also working on a
                test gen framework based on Buck2 to statically declare tests
                for your post-commit runs, or programmatically generate
                thousands of tests for nightly regressions.
              </p>
              <p>
                We plan to sell seats, with discounts for individuals, startups,
                and research labs (we’re working on pricing). For now, we’re
                opening up guest registration so HN can play with what we hope
                is the future of design verification. We owe so much of what we
                know to this community and we’d be so grateful for any feedback.
                &lt;3 You can sign up here, just press "Use guest email address"
                if you don't want to give up your email:
                <a href="https://dash.silogy.io/signup/"
                  >https://dash.silogy.io/signup/</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="39630985">
          <h3>
            <a
              class="item"
              href="https://vin01.github.io/piptagole/security-tools/soar/urlscan/hybrid-analysis/data-leaks/urlscan.io/cloudflare-radar%22/2024/03/07/url-database-leaks-private-urls.html"
              >You cannot simply publicly access private secure links, can
              you?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 16:29:47</span
              ><span class="points-container"
                >Points: <span class="points">361</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39630985"
                  >Comments</a
                ><span class="descendants">: 189</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39630759">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/new-breakthrough-brings-matrix-multiplication-closer-to-ideal-20240307/"
              >New breakthrough brings matrix multiplication closer to ideal</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 16:11:01</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39630759"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39629044">
          <h3>
            <a class="item" href="https://eloquentjavascript.net/"
              >Eloquent JavaScript 4th edition (2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 13:52:16</span
              ><span class="points-container"
                >Points: <span class="points">964</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39629044"
                  >Comments</a
                ><span class="descendants">: 178</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39625651">
          <h3>
            <a
              class="item"
              href="https://blog.dtornow.com/the-cap-theorem.-the-bad-the-bad-the-ugly/"
              >The CAP theorem. The Bad, the Bad, &amp;amp; the Ugly</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 06:25:43</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39625651"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39624223">
          <h3>
            <a
              class="item"
              href="https://e360.yale.edu/features/mongolia-dzud-climate-change"
              >In Mongolia, a killer winter is ravaging herds and a way of
              life</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 01:54:32</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39624223"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39623619">
          <h3>
            <a
              class="item"
              href="https://techxplore.com/news/2024-03-atlas-internet-surveillance-ownership-network.html"
              >Atlas of internet surveillance maps ownership of network
              infrastructures worldw</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-07 @ 00:28:40</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39623619"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39615602">
          <h3>
            <a
              class="item"
              href="https://www.lucavall.in/blog/how-to-structure-c-projects-my-experience-best-practices"
              >How to Structure C Projects: These Best Practices Worked for
              Me</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-06 @ 13:14:37</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39615602"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39614816">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Thousand_Character_Classic"
              >Thousand Character Classic</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-06 @ 11:33:49</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39614816"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39613448">
          <h3>
            <a
              class="item"
              href="https://www.askell.blog/when-robustly-tolerable-beats-precariously-optimal/"
              >When robustly tolerable beats precariously optimal (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-06 @ 07:58:06</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39613448"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39612280">
          <h3>
            <a
              class="item"
              href="https://www.theparisreview.org/blog/2024/03/04/the-institute-for-illegal-images/"
              >The Institute for Illegal Images</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-06 @ 04:22:24</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39612280"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
