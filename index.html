<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40721623">
          <h3>
            <a class="item" href="https://blog.lambda.cx/posts/freecad-and-git/"
              >Versioning FreeCAD Files with Git</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 19:59:31</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40721623"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40720629">
          <h3>
            <a
              class="item"
              href="https://retractionwatch.com/2024/06/18/nature-retracts-highly-cited-2002-paper-that-claimed-adult-stem-cells-could-become-any-type-of-cell/"
              >Nature retracts paper that claimed adult stem cell could become
              any type of cell</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 18:23:10</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40720629"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40719975">
          <h3>
            <a class="item" href="https://ubc-vision.github.io/3dgs-mcmc/"
              >3D Gaussian Splatting as Markov Chain Monte Carlo</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 17:08:36</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40719975"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40719921">
          <h3>
            <a
              class="item"
              href="https://ai.meta.com/blog/meta-fair-research-new-releases/"
              >Sharing new research, models, and datasets from Meta FAIR</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 17:01:45</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40719921"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40719910">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/ubicloud/jobs/zyE7d9T-founding-engineer-for-managed-kubernetes-service"
              >Ubicloud (YC W24) is hiring a founding engineer for "managed
              Kubernetes service"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 17:00:50</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40719905">
          <h3>
            <a
              class="item"
              href="https://www.jpl.nasa.gov/news/ow-glowing-plants-could-help-scientists-predict-flash-drought"
              >'Glowing' plants could help scientists predict flash drought</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 17:00:34</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40719905"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40719782">
          <h3>
            <a class="item" href="https://billard.medusis.com/"
              >Show HN: Billard – Generate music from ball collisions in 2D
              space</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 16:45:45</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40719782"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
            <div class="text">
              <p>
                Here's Billard. It combines music and physics into a unique
                creative tool, as I explore various unconventional methods for
                generating music.
              </p>
              <p>
                Most traditional music composition tools revolve around the idea
                of a repeatable pattern.
              </p>
              <p>
                Billard is a webapp that never repeats itself. It generates
                music automatically based on the collisions of balls in a 2D
                space. Collisions trigger notes (or chords) in a given key. One
                can add balls or move them (y-position is pitch); the app
                remembers its state between reloads; or it can be reset with the
                'init' button on the top left. Gravity can be adjusted in real
                time to change the behavior of the balls.
              </p>
              <p>
                It owes a lot of inspiration to Brian Eno and Erik Satie
                (inventor of <i>musique d'ameublement</i>, or "furniture
                music"). Some may think the lack of pattern makes it not musical
                enough -- but this lets it be listened to —and watched— for a
                while without boredom.
              </p>
              <p>
                The webapp is made using plain JavaScript. (All SVG icons were
                made 'by hand'.) It uses Tone.js only for triggering piano
                samples. Beyond piano, it's MIDI-enabled and works well at slow
                speed with haunting, dark synth sounds.
              </p>
              <p>Hope you like it!</p>
            </div>
          </section>
        </section>
        <section id="40718124">
          <h3>
            <a
              class="item"
              href="https://frame.work/blog/introducing-a-new-risc-v-mainboard-from-deepcomputing"
              >A new RISC-V Mainboard from DeepComputing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 14:15:16</span
              ><span class="points-container"
                >Points: <span class="points">391</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40718124"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40717804">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/immersive/d41586-024-02011-6/index.html"
              >Tiny beauty: how I make scientific art from behind the
              microscope</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 13:45:07</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40717804"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40717721">
          <h3>
            <a
              class="item"
              href="https://www.go-inicio.com/blog/a-new-look-revolutionizing-solar-plant-prospection-with-automated-viewshed-analysis"
              >Revolutionizing solar plant prospection with automated viewshed
              analysis</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 13:37:04</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40717721"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
            <div class="text">
              <p>
                Our company is prospecting suitable lands for solar power plant
                using algorithms and geospatial data. This article will guide
                you through recent work I've done find optimal locations that
                align with visibility constraints.
              </p>
              <p>I hope you find this peek into our solutions insightful!</p>
            </div>
          </section>
        </section>
        <section id="40717519">
          <h3>
            <a
              class="item"
              href="https://www.tylermw.com/posts/rayverse/displacement-mapping.html"
              >Sculpting the moon in R: Subdivision surfaces and displacement
              mapping</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 13:19:34</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40717519"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40716701">
          <h3>
            <a class="item" href="https://github.com/yandex/YaFSDP"
              >YaFSDP: a sharded data parallelism framework, faster for
              pre-training LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 11:54:33</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40716701"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40716235">
          <h3>
            <a
              class="item"
              href="https://aerospaceamerica.aiaa.org/features/understanding-the-misunderstood-kessler-syndrome/"
              >The misunderstood Kessler Syndrome</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 10:58:24</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40716235"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40715250">
          <h3>
            <a class="item" href="https://www.cyberscarecrow.com/"
              >Cyber Scarecrow</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 08:08:02</span
              ><span class="points-container"
                >Points: <span class="points">470</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40715250"
                  >Comments</a
                ><span class="descendants">: 210</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40715018">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2406.08719"
              >TikTag: Breaking ARM's memory tagging extension with speculative
              execution</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 07:28:18</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40715018"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40714950">
          <h3>
            <a
              class="item"
              href="https://thechipletter.substack.com/p/spur-risc-iv-the-lisp-multiprocessor"
              >Spur – RISC IV: The Lisp Multiprocessor Workstation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 07:15:37</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40714950"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40714371">
          <h3>
            <a class="item" href="https://berjon.com/public-interest-internet/"
              >The Public Interest Internet</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 05:37:59</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40714371"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40712020">
          <h3>
            <a class="item" href="https://github.com/kitsunyan/intel-undervolt"
              >Intel-undervolt: CPU undervolting and throttling configuration
              tool for Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 22:44:44</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40712020"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40710346">
          <h3>
            <a
              class="item"
              href="http://www.neverendingbooks.org/oulipos-use-of-the-tohoku-paper/"
              >Oulipo's use of the Tohoku paper (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 19:59:25</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40710346"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40707558">
          <h3>
            <a
              class="item"
              href="https://www.ftc.gov/news-events/news/press-releases/2024/06/ftc-takes-action-against-adobe-executives-hiding-fees-preventing-consumers-easily-cancelling"
              >FTC sues Adobe for hiding fees and inhibiting cancellations</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 16:29:53</span
              ><span class="points-container"
                >Points: <span class="points">2443</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40707558"
                  >Comments</a
                ><span class="descendants">: 788</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40705574">
          <h3>
            <a
              class="item"
              href="https://twitter.com/Khode_Erfan/status/1802331845633212554"
              >Lindroid</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 13:46:04</span
              ><span class="points-container"
                >Points: <span class="points">237</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40705574"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40705522">
          <h3>
            <a
              class="item"
              href="https://www.bigmessowires.com/2017/12/07/fpga-based-disk-controller-for-apple-ii/"
              >FPGA-Based Disk Controller for the Apple II (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 13:40:15</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40705522"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40704179">
          <h3>
            <a
              class="item"
              href="https://futhark-lang.org/blog/2024-06-17-automap.html"
              >NumPy-style broadcasting in Futhark</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 10:38:34</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40704179"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40703892">
          <h3>
            <a class="item" href="https://lnav.org/">Lnav Logfile Navigator</a>
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 09:42:40</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40703892"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40702748">
          <h3>
            <a
              class="item"
              href="https://www.hillelwayne.com/post/software-friction/"
              >Software Friction</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 06:06:29</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40702748"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40683564">
          <h3>
            <a class="item" href="https://shallenge.quirino.net/"
              >Show HN: SHAllenge – Compete to get the lowest hash</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-14 @ 18:33:40</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40683564"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
            <div class="text">
              I've always had an appreciation for the properties of hashing. I
              especially like the concept of Proof of Work, so I tried to make a
              little competition out of it.
            </div>
          </section>
        </section>
        <section id="40683317">
          <h3>
            <a class="item" href="https://physics.aps.org/articles/v17/98"
              >Mimicking an Elephant Trunk</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-14 @ 18:13:29</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40683317"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40682212">
          <h3>
            <a class="item" href="https://cdm.link/2024/06/labor-diy/"
              >Erica Synths DIY Prototyping Breadboard</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-14 @ 16:26:48</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40682212"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40680524">
          <h3>
            <a
              class="item"
              href="https://github.com/bachmitre/hacker-news-highlighter"
              >Show HN: Quickly scan HN for new articles</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-14 @ 13:03:48</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40680524"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
            <div class="text">
              <p>I wrote a Chrome Extension to:</p>
              <p>
                - quickly scan new articles since my last reload - quickly scan
                highly discussed articles - open actual articles and discussions
                in a new tab
              </p>
              <p>
                This links to the source code. The chrome extension is linked at
                the bottom of the github page.
              </p>
              <p>Note:</p>
              <p>
                - This extension only operates on the HN front page (<a
                  href="https://news.ycombinator.com/news"
                  >https://news.ycombinator.com/news</a
                >) - The first time you reload the HN front page after
                installing the extension all articles will get highlighted.
              </p>
            </div>
          </section>
        </section>
        <section id="40673402">
          <h3>
            <a
              class="item"
              href="https://sourcegraph.com/blog/enhancing-code-completion-for-rust-in-cody"
              >Enhancing Code Completion for Rust in Cody</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-13 @ 19:12:08</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40673402"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
