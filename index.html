<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41210742">
          <h3>
            <a
              class="item"
              href="https://gist.github.com/bluepnume/8f2376b0893bc6b85564e7359359ecd4"
              >OneText (YC W23) is hiring a lead TypeScript/Node engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 17:00:01</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41210110">
          <h3>
            <a
              class="item"
              href="https://www.scientificamerican.com/article/0724--un-cybercrime/"
              >New U.N. Cybercrime Treaty Unanimously Approved, Could Threaten
              Human Rights</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 15:16:08</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41210110"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41209994">
          <h3>
            <a class="item" href="https://github.com/supabase/pg_replicate"
              >Show HN: Pg_replicate – Build Postgres replication applications
              in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 15:00:41</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41209994"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41209966">
          <h3>
            <a
              class="item"
              href="https://discuss.python.org/t/pep-750-tag-strings-for-writing-domain-specific-languages/60408"
              >PEP 750: Tag Strings for Writing Domain-Specific Languages</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 14:57:00</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41209966"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41209688">
          <h3>
            <a class="item" href="https://github.com/evilsocket/opensnitch"
              >OpenSnitch is a GNU/Linux interactive application firewall</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 14:15:52</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41209688"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41209658">
          <h3>
            <a
              class="item"
              href="https://www.theatlantic.com/magazine/archive/2024/09/decoding-voynich-manuscript/679157/"
              >Another Look at the Voynich Manuscript</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 14:10:48</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41209658"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41209181">
          <h3>
            <a class="item" href="https://deeplive.cam"
              >Deep Live Cam: Real-time face swapping and one-click video
              deepfake tool</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 13:05:48</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41209181"
                  >Comments</a
                ><span class="descendants">: 111</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41208988">
          <h3>
            <a class="item" href="https://roitman.io/blog/91"
              >A wonderful coincidence or an expected connection: why π² ≈ g</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 12:24:54</span
              ><span class="points-container"
                >Points: <span class="points">252</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41208988"
                  >Comments</a
                ><span class="descendants">: 166</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41208934">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s44323-024-00005-1"
              >Evidence for ~12-h ultradian gene programs in humans</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 12:13:01</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41208934"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41207417">
          <h3>
            <a
              class="item"
              href="http://fxrant.blogspot.com/2024/06/hal-hickel-on-creating-tarkin.html"
              >Hal Hickel on Creating Tarkin for Rogue One</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 05:00:00</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41207417"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41207415">
          <h3>
            <a
              class="item"
              href="https://twitter.com/sundarpichai/status/1822132667959386588"
              >Susan Wojcicki has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 04:58:29</span
              ><span class="points-container"
                >Points: <span class="points">587</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41207415"
                  >Comments</a
                ><span class="descendants">: 305</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41207182">
          <h3>
            <a
              class="item"
              href="https://www.caltech.edu/about/news/caltech-team-develops-first-noninvasive-method-to-continually-measure-true-blood-pressure"
              >Caltech Develops First Noninvasive Method to Continually Measure
              Blood Pressure</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 03:53:04</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41207182"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41206908">
          <h3>
            <a
              class="item"
              href="https://blog.screenshotbot.io/2024/08/10/building-a-highly-available-web-service-without-a-database/"
              >Building a highly-available web service without a database</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 02:37:55</span
              ><span class="points-container"
                >Points: <span class="points">213</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41206908"
                  >Comments</a
                ><span class="descendants">: 123</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41206025">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/2024/07/31/grace-hopper-nvidias-halfway-apu/"
              >Grace Hopper, Nvidia's Halfway APU</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-09 @ 22:52:13</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41206025"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41205176">
          <h3>
            <a
              class="item"
              href="https://urchin.biz/urchin-software-corp-89a1f5292999"
              >Urchin Software Corp: The unlikely origin story of Google
              Analytics (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-09 @ 20:32:11</span
              ><span class="points-container"
                >Points: <span class="points">231</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41205176"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41204881">
          <h3>
            <a class="item" href="https://github.com/facebookresearch/vfusion3d"
              >VFusion3D: Learning Scalable 3D Generative Models from Video
              Diffusion Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-09 @ 19:55:42</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41204881"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41204622">
          <h3>
            <a
              class="item"
              href="https://www.themarginalian.org/2024/08/08/margaret-watts-hughes-voice-figures/"
              >Voice is a garden: Margaret Watts Hughes's Victorian sound
              visualizations</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-09 @ 19:21:21</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41204622"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41203475">
          <h3>
            <a class="item" href="https://www.thundercompute.com/"
              >Show HN: Attaching to a virtual GPU over TCP</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-09 @ 16:50:41</span
              ><span class="points-container"
                >Points: <span class="points">297</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41203475"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
            <div class="text">
              We developed a tool to trick your computer into thinking it’s
              attached to a GPU which actually sits across a network. This
              allows you to switch the number or type of GPUs you’re using with
              a single command.
            </div>
          </section>
        </section>
        <section id="41203368">
          <h3>
            <a
              class="item"
              href="https://www.icann.org/en/board-activities-and-meetings/materials/approved-resolutions-special-meeting-of-the-icann-board-29-07-2024-en#section2.a"
              >.INTERNAL is now reserved for private-use applications</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-09 @ 16:36:50</span
              ><span class="points-container"
                >Points: <span class="points">489</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41203368"
                  >Comments</a
                ><span class="descendants">: 240</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41203306">
          <h3>
            <a
              class="item"
              href="https://github.com/Dicklesworthstone/llm_aided_ocr"
              >Show HN: LLM-aided OCR – Correcting Tesseract OCR errors with
              LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-09 @ 16:28:39</span
              ><span class="points-container"
                >Points: <span class="points">420</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41203306"
                  >Comments</a
                ><span class="descendants">: 153</span></span
              >
            </h4>
            <div class="text">
              <p>
                Well, it's amazing how things have changed since then. Not only
                have models gotten a lot better, but the latest "low tier"
                offerings from OpenAI (GPT4o-mini) and Anthropic (Claude3-Haiku)
                are incredibly cheap and incredibly fast. So cheap and fast, in
                fact, that you can now break the document up into little chunks
                and submit them to the API concurrently (where each chunk can go
                through a multi-stage process, in which the output of the first
                stage is passed into another prompt for the next stage) and
                assemble it all in a shockingly short amount of time, and for
                basically a rounding error in terms of cost.
              </p>
              <p>
                My original project had all sorts of complex stuff for detecting
                hallucinations and incorrect, spurious additions to the text
                (like "Here is the corrected text" preambles). But the newer
                models are already good enough to eliminate most of that stuff.
                And you can get very impressive results with the multi-stage
                approach. In this case, the first pass asks it to correct OCR
                errors and to remove line breaks in the middle of a word and
                things like that. The next stage takes that as the input and
                asks the model to do things like reformat the text using
                markdown, to suppress page numbers and repeated page headers,
                etc. Anyway, I think the samples (which take less than 1-2
                minutes to generate) show the power of the approach:
              </p>
              <p>
                Original PDF:
                <a
                  href="https://github.com/Dicklesworthstone/llm_aided_ocr/blob/main/160301289-Warren-Buffett-Katharine-Graham-Letter.pdf"
                  >https://github.com/Dicklesworthstone/llm_aided_ocr/blob/main...</a
                >
              </p>
              <p>
                Raw OCR Output:
                <a
                  href="https://github.com/Dicklesworthstone/llm_aided_ocr/blob/main/160301289-Warren-Buffett-Katharine-Graham-Letter__raw_ocr_output.txt"
                  >https://github.com/Dicklesworthstone/llm_aided_ocr/blob/main...</a
                >
              </p>
              <p>
                LLM-Corrected Markdown Output:
                <a
                  href="https://github.com/Dicklesworthstone/llm_aided_ocr/blob/main/160301289-Warren-Buffett-Katharine-Graham-Letter_llm_corrected.md"
                  >https://github.com/Dicklesworthstone/llm_aided_ocr/blob/main...</a
                >
              </p>
              <p>
                One interesting thing I found was that almost all my attempts to
                fix/improve things using "classical" methods like regex and
                other rule based things made everything worse and more brittle,
                and the real improvements came from adjusting the prompts to
                make things clearer for the model, and not asking the model to
                do too much in a single pass (like fixing OCR mistakes AND
                converting to markdown format).
              </p>
              <p>
                Anyway, this project is very handy if you have some old scanned
                books you want to read from Archive.org or Google Books on a
                Kindle or other ereader device and want things to be re-flowable
                and clear. It's still not perfect, but I bet within the next
                year the models will improve even more that it will get closer
                to 100%. Hope you like it!
              </p>
              <p>
                [0]
                <a href="https://news.ycombinator.com/item?id=36976333"
                  >https://news.ycombinator.com/item?id=36976333</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="41202064">
          <h3>
            <a class="item" href="https://github.com/TrafficGuard/nous"
              >Show HN: Nous – Open-Source Agent Framework with Autonomous, SWE
              Agents, WebUI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-09 @ 14:16:09</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41202064"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
            <div class="text">
              <p>
                It's a bit of CrewAI, OpenDevon, LangFuse/Cloud all in one,
                providing devs who prefer TypeScript an integrated framework
                thats provides a lot out of the box to start experimenting and
                building agents with.
              </p>
              <p>
                It started after peeking at the LangChain docs a few times and
                never liking the example code. I began experimenting with
                automating a simple Jira request from the engineering team to
                add an index to one of our Google Spanner databases (for context
                I'm the DevOps/SRE lead for an AdTech company).
              </p>
              <p>
                It incudes the tooling we're building out to automate processes
                from a DevOps/SRE perspective, which initially includes a
                configurable GitLab merge request AI reviewer.
              </p>
              <p>
                The initial layer above Aider (<a href="https://aider.chat/"
                  >https://aider.chat/</a
                >) grew into coding agent and an autonomous agent with
                LLM-independent function calling with auto-generated function
                schemas.
              </p>
              <p>
                And as testing via the CLI became unwieldy soon grew database
                persistence, tracing, a Web UI and human-in-the-loop
                functionality.
              </p>
              <p>
                One of the more interesting additions is the new autonomous
                agent which generates Python code that can call the available
                functions. Using the pyodide library the tool objects are
                proxied into the Python scope and executed in a WebAssembly
                sandbox.
              </p>
              <p>
                As its able to perform multiple calls and validation logic in a
                single control loop, it can reduce the cost and latency, getting
                the most out of the frontier LLMs calls with better reasoning.
              </p>
              <p>
                Benchmark runners for the autonomous agent and coding benchmarks
                are in the works to get some numbers on the capabilities so far.
                I'm looking forward to getting back to implementing all the
                ideas around improving the code and autonomous agents from a
                metacognitive perspective after spending time on docs,
                refactorings and tidying up recently.
              </p>
              <p>
                Check it out at
                <a href="https://github.com/trafficguard/nous"
                  >https://github.com/trafficguard/nous</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="41196237">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41196237"
              >Ask HN: Resources about math behind A/B testing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-08 @ 21:03:31</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41196237"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
            <div class="text">
              I've been learning more about AB testing during the last months.
              I've read almost all the work by Evan Miller, and I've enjoyed it
              a lot. However, I'd like a more structured approach to the topic
              since sometimes I feel I'm missing some basics. I've good math
              knowledge and pretty decent stats foundations. Which are your
              favourite books/papers in this topic?
            </div>
          </section>
        </section>
        <section id="41194929">
          <h3>
            <a class="item" href="https://rya.nc/vpp-hack.html"
              >Hacking a Virtual Power Plant</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-08 @ 18:52:57</span
              ><span class="points-container"
                >Points: <span class="points">165</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41194929"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41188769">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=yxBC6XzuMPs"
              >Using the Moon as an Echo [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-08 @ 06:47:26</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41188769"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41183439">
          <h3>
            <a
              class="item"
              href="https://dl.acm.org/doi/pdf/10.1145/140979.140985"
              >SQL/SE Query Language Extension for Schema Evolution (1992)
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-07 @ 17:25:09</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41183439"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41179043">
          <h3>
            <a
              class="item"
              href="https://www.ams.org/notices/200503/fea-weil.pdf"
              >A 1940 Letter of André Weil on Analogy in Mathematics (2003)
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-07 @ 07:31:12</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41179043"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41178372">
          <h3>
            <a
              class="item"
              href="https://www.historytoday.com/archive/history-matters/powers-soviet-puppetry"
              >The Powers of Soviet Puppetry</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-07 @ 04:59:51</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41178372"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41171142">
          <h3>
            <a class="item" href="https://benlo.com/visicalc/"
              >VisiCalc – The Early Days (2003)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-06 @ 14:25:35</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41171142"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41167921">
          <h3>
            <a class="item" href="https://github.com/fukamachi/qlot"
              >Qlot: Common Lisp Library Manager</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-06 @ 05:04:04</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41167921"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41165392">
          <h3>
            <a
              class="item"
              href="https://www.bps.org.uk/research-digest/influential-descriptions-depression-are-often-misleading"
              >Influential descriptions of depression are often misleading</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-05 @ 20:40:47</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41165392"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
