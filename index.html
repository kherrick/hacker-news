<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="46436127">
          <h3>
            <a
              class="item"
              href="https://ethz.ch/en/news-and-events/eth-news/news/2025/11/electrolysis-can-solve-one-of-our-biggest-contamination-problems.html"
              >Electrolysis can solve one of our biggest contamination
              problems</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-30 @ 18:08:32</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46436127"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46435418">
          <h3>
            <a class="item" href="https://github.com/torokernel/torokernel"
              >Toro: Deploy Applications as Unikernels</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-30 @ 17:09:57</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46435418"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46434580">
          <h3>
            <a class="item" href="https://tidy.baby"
              >Show HN: Tidy Baby is a SET game but with words</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-30 @ 15:57:01</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46434580"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
            <div class="text">
              <p>
                Tidy Baby is a new game made by me and Wyna Liu (of NYT
                Connections!) that is inspired by the legendary card-based game
                SET that we assume many of you love (we too love SET).
              </p>
              <p>
                In SET, you’ve got four dimensions: shape, number, color, and
                shading, each with three variants.
              </p>
              <p>In Tidy Baby you only have to deal with three dimensions:</p>
              <p>
                - word length (3, 4, or 5 letters) - part of speech (noun, verb,
                or adjective) - style (bold, underline, or italic)
              </p>
              <p>
                Like in SET, you are trying to form sets of three cards where,
                along each dimension, the set is either all the same or all
                different. If you’ve never played SET there are more
                details/examples at “how to play” in the game.
              </p>
              <p>
                The mechanics of Tidy Baby are sort of inspired by a
                solitaire/practice version of SET I sometimes play where you
                draw two random cards and have to name the third card that would
                make a valid set.
              </p>
              <p>
                In Tidy Baby you are presented with two “game cards” and a grid
                of up to nine candidates to complete a valid set – your job is
                to pick the right one before the clock runs out.
              </p>
              <p>
                Unlike in SET, you get points for “partial” sets where your set
                is valid on one or two dimensions (but not all three). It’s
                actually a pretty fun challenge to try to get only sets that are
                invalid along all three dimensions.
              </p>
              <p>
                In building the game, we were sort of surprised that the biggest
                challenge was ensuring that all words were unambiguously one
                part of speech. You’d be surprised how hard it is to find
                three-letter adjectives that are not also common verbs or nouns.
                We did our best!
              </p>
              <p>
                We’ve got three “paces” in the game: Steady, Strenuous, and
                Grueling (s/o MECC!)
              </p>
              <p>Let us know what you think!</p>
            </div>
          </section>
        </section>
        <section id="46433915">
          <h3>
            <a
              class="item"
              href="https://dfarq.homeip.net/what-happened-to-abit-motherboards/"
              >What Happened to Abit Motherboards</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-30 @ 14:58:18</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46433915"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46433661">
          <h3>
            <a
              class="item"
              href="https://jobs.ashbyhq.com/hive.co/cb0dc490-0e32-4734-8d91-8b56a31ed497"
              >Hive (YC S14) Is Hiring a Staff Software Engineer (Data
              Systems)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-30 @ 14:31:34</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46433352">
          <h3>
            <a class="item" href="https://mwilczynski.dev/posts/riscv-gpu-zink/"
              >Igniting the GPU: From Kernel Plumbing to 3D Rendering on
              RISC-V</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-30 @ 13:55:59</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46433352"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46433029">
          <h3>
            <a
              class="item"
              href="https://daniel.haxx.se/blog/2025/12/29/no-strcpy-either/"
              >No strcpy either</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-30 @ 13:14:40</span
              ><span class="points-container"
                >Points: <span class="points">162</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46433029"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46432999">
          <h3>
            <a
              class="item"
              href="https://subseacables.blogspot.com/2025/12/the-british-empires-resilient-subsea.html"
              >The British empire's resilient subsea telegraph network</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-30 @ 13:10:56</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46432999"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46432916">
          <h3>
            <a
              class="item"
              href="https://fuckingapproachableswiftconcurrency.com/en/"
              >Approachable Swift Concurrency</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-30 @ 13:01:51</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46432916"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46432862">
          <h3>
            <a class="item" href="https://hsu.cy/2025/12/times-new-american/"
              >Times New American: A Tale of Two Fonts</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-30 @ 12:56:07</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46432862"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46432311">
          <h3>
            <a class="item" href="https://nonzerosum.games/"
              >Non-Zero-Sum Games</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-30 @ 11:42:55</span
              ><span class="points-container"
                >Points: <span class="points">245</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46432311"
                  >Comments</a
                ><span class="descendants">: 111</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46432057">
          <h3>
            <a
              class="item"
              href="https://www.lemonde.fr/en/international/article/2025/11/19/nicolas-guillou-french-icc-judge-sanctioned-by-the-us-you-are-effectively-blacklisted-by-much-of-the-world-s-banking-system_6747628_4.html"
              >Nicolas Guillou, French ICC judge sanctioned by the US and
              “debanked”</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-30 @ 11:13:30</span
              ><span class="points-container"
                >Points: <span class="points">289</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46432057"
                  >Comments</a
                ><span class="descendants">: 259</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46431560">
          <h3>
            <a class="item" href="https://opencontent.netflix.com/"
              >Netflix Open Content</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-30 @ 10:11:57</span
              ><span class="points-container"
                >Points: <span class="points">484</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46431560"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46431028">
          <h3>
            <a
              class="item"
              href="https://lorentz.app/blog-item.html?id=go-shebang"
              >Go away Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-30 @ 08:50:44</span
              ><span class="points-container"
                >Points: <span class="points">248</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46431028"
                  >Comments</a
                ><span class="descendants">: 230</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46430558">
          <h3>
            <a class="item" href="https://charm-ruby.dev/"
              >Charm Ruby – Glamorous Terminal Libraries for Ruby</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-30 @ 07:36:38</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46430558"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46428496">
          <h3>
            <a
              class="item"
              href="https://media.ccc.de/v/39c3-hacking-washing-machines"
              >Hacking Washing Machines [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-30 @ 01:40:49</span
              ><span class="points-container"
                >Points: <span class="points">181</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46428496"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46427586">
          <h3>
            <a
              class="item"
              href="https://screenrant.com/stranger-things-creator-turn-off-settings-premiere/"
              >Stranger Things creator says turn off "garbage" settings</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-29 @ 23:50:34</span
              ><span class="points-container"
                >Points: <span class="points">347</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46427586"
                  >Comments</a
                ><span class="descendants">: 627</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46426534">
          <h3>
            <a
              class="item"
              href="https://manus.im/blog/manus-joins-meta-for-next-era-of-innovation"
              >ManusAI Joins Meta</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-29 @ 22:24:22</span
              ><span class="points-container"
                >Points: <span class="points">294</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46426534"
                  >Comments</a
                ><span class="descendants">: 192</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46424233">
          <h3>
            <a
              class="item"
              href="https://codemanship.wordpress.com/2025/11/25/the-future-of-software-development-is-software-developers/"
              >The future of software development is software developers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-29 @ 19:14:17</span
              ><span class="points-container"
                >Points: <span class="points">355</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46424233"
                  >Comments</a
                ><span class="descendants">: 426</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46424173">
          <h3>
            <a class="item" href="https://loss32.org/"
              >Loss32: Let's Build a Win32/Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-29 @ 19:09:08</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46424173"
                  >Comments</a
                ><span class="descendants">: 158</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46423290">
          <h3>
            <a
              class="item"
              href="https://electrek.co/2025/12/29/tesla-4680-battery-supply-chain-collapses-partner-writes-down-dea/"
              >Tesla's 4680 battery supply chain collapses as partner writes
              down deal by 99%</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-29 @ 17:57:03</span
              ><span class="points-container"
                >Points: <span class="points">602</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46423290"
                  >Comments</a
                ><span class="descendants">: 670</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46422757">
          <h3>
            <a
              class="item"
              href="https://geohot.github.io//blog/jekyll/update/2025/12/29/five-years-of-tinygrad.html"
              >Five Years of Tinygrad</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-29 @ 17:12:20</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46422757"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46422412">
          <h3>
            <a
              class="item"
              href="https://www.gog.com/blog/gog-is-getting-acquired-by-its-original-co-founder-what-it-means-for-you/"
              >GOG is getting acquired by its original co-founder</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-29 @ 16:43:14</span
              ><span class="points-container"
                >Points: <span class="points">822</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46422412"
                  >Comments</a
                ><span class="descendants">: 500</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46402132">
          <h3>
            <a
              class="item"
              href="https://bluuewhale.github.io/posts/concurrent-hashmap-designs/"
              >Concurrent Hash Table Designs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-27 @ 14:36:43</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46402132"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46393755">
          <h3>
            <a
              class="item"
              href="https://finite-sample.github.io/optimal-classification-cutoffs/"
              >Optimal Classification Cutoffs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-26 @ 16:49:23</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46393755"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46388882">
          <h3>
            <a
              class="item"
              href="https://github.com/kenryu42/claude-code-safety-net"
              >Show HN: A Claude Code plugin that catch destructive Git and
              filesystem commands</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-26 @ 03:14:07</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46388882"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46384975">
          <h3>
            <a class="item" href="https://fontgenerator.design/symbols"
              >Show HN: One clean, developer-focused page for every Unicode
              symbol</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-25 @ 15:32:45</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46384975"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
            <div class="text">
              <p>
                Example: [<a
                  href="https://fontgenerator.design/symbol/almost-equal-to"
                  >https://fontgenerator.design/symbol/almost-equal-to</a
                >](<a href="https://fontgenerator.design/symbol/almost-equal-to"
                  >https://fontgenerator.design/symbol/almost-equal-to</a
                >)
              </p>
              <p>
                Includes Unicode, HTML, CSS, JS, UTF-8/16 bytes, URL encoding,
                and usage examples.
              </p>
              <p>
                The same structure is used across thousands of symbols (math,
                arrows, currency, tech/UI, punctuation).
              </p>
              <p>
                Built because existing references are fragmented. Feedback
                welcome.
              </p>
            </div>
          </section>
        </section>
        <section id="46379765">
          <h3>
            <a class="item" href="https://github.com/timescale/pgvectorscale"
              >Postgres extension complements pgvector for performance and
              scale</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-24 @ 22:04:57</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46379765"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46366010">
          <h3>
            <a class="item" href="https://www.gkbrk.com/hotel-music"
              >Reverse Engineering a Mysterious UDP Stream in My Hotel (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-23 @ 15:21:55</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46366010"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46364136">
          <h3>
            <a class="item" href="http://squoze.net/UNIX/v4/README"
              >UNIX Fourth Edition</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-23 @ 10:28:40</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46364136"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
