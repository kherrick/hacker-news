<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41084918">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/twenty/jobs/b1Uku7w-senior-software-engineer"
              >Twenty (YC S23) Is Hiring a Software Engineer in Paris</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 07:00:34</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41084795">
          <h3>
            <a
              class="item"
              href="https://web.stanford.edu/class/cs81n/command.txt"
              >In the Beginning Was the Command Line</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 06:25:02</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41084795"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41084338">
          <h3>
            <a
              class="item"
              href="https://pldb.io/lists/explorer.html#searchBuilder=%7B%22criteria%22%3A%5B%7B%22condition%22%3A%22%3E%3D%22%2C%22data%22%3A%22appeared%22%2C%22origData%22%3A%22appeared%22%2C%22type%22%3A%22num%22%2C%22value%22%3A%5B%222024%22%5D%7D%5D%2C%22logic%22%3A%22AND%22%7D"
              >New Programming Languages of 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 03:55:30</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41084338"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41084334">
          <h3>
            <a
              class="item"
              href="https://interrupt.memfault.com/blog/arm-cortexm-with-llvm-clang"
              >Better Firmware with LLVM/Clang</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 03:55:08</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41084334"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41084318">
          <h3>
            <a
              class="item"
              href="https://www.cs.cornell.edu/~asampson/blog/bril.html"
              >Bril: An Intermediate Language for Teaching Compilers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 03:50:49</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41084318"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41084061">
          <h3>
            <a class="item" href="https://ewpratten.com/blog/camping-radio/"
              >Taking a Radio Camping</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 02:26:15</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41084061"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41083987">
          <h3>
            <a class="item" href="https://github.com/joshuacline/windick"
              >Windows recovery environment and bootable USB creator in 200kb</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 02:09:30</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41083987"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41083972">
          <h3>
            <a class="item" href="https://sysprog21.github.io/lkmpg/"
              >The Linux Kernel Module Programming Guide</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 02:04:35</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41083972"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41083801">
          <h3>
            <a
              class="item"
              href="https://ntk148v.github.io/posts/linux-network-performance-ultimate-guide/"
              >Linux Network Performance Ultimate Guide</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 01:17:53</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41083801"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41083726">
          <h3>
            <a
              class="item"
              href="https://www.vldb.org/pvldb/vol16/p3302-fernandez.pdf"
              >How large language models will disrupt data management [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 01:00:27</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41083726"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41083534">
          <h3>
            <a class="item" href="https://huyenchip.com/ml-interviews-book/"
              >Introduction to Machine Learning Interviews Book</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-27 @ 00:19:32</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41083534"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41083286">
          <h3>
            <a
              class="item"
              href="https://reason.com/2024/07/26/courts-close-the-loophole-letting-the-feds-search-your-phone-at-the-border/"
              >Courts Close the Loophole Letting the Feds Search Your Phone at
              the Border</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-26 @ 23:36:21</span
              ><span class="points-container"
                >Points: <span class="points">208</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41083286"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41083077">
          <h3>
            <a class="item" href="https://fabiensanglard.net/dc/"
              >Driving Compilers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-26 @ 22:57:24</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41083077"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41082752">
          <h3>
            <a class="item" href="https://apexsurplus.com"
              >Apex Surplus – A movie industry props and parts source</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-26 @ 22:09:16</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41082752"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41082502">
          <h3>
            <a
              class="item"
              href="https://krebsonsecurity.com/2024/07/crooks-bypassed-googles-email-verification-to-create-workspace-accounts-access-3rd-party-services/"
              >Crooks Bypassed Google's Email Verification to Create Workspace
              Accounts, Acces</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-26 @ 21:34:00</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41082502"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41082041">
          <h3>
            <a class="item" href="https://github.com/patched-codes/patchwork"
              >Show HN: Patchwork – Open-source framework to automate
              development gruntwork</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-26 @ 20:34:53</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41082041"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
            <div class="text">
              <p>
                Patchwork tackles development gruntwork—like reviews, docs,
                linting, and security fixes—through customizable, code-first
                'patchflows' using LLMs and modular code management steps, all
                in Python. Here's a quick overview video:
                <a href="https://youtu.be/MLyn6B3bFMU"
                  >https://youtu.be/MLyn6B3bFMU</a
                >
              </p>
              <p>
                From our time building DevSecOps tools, we experienced
                first-hand the frustrations our users faced as they built
                complex delivery pipelines. Almost a third of developer time is
                spent on code management tasks[1], yet backlogs remain.
              </p>
              <p>
                Patchwork lets you combine well-defined prompts with effective
                workflow orchestration to automate as much as 80% of these
                gruntwork tasks using LLMs[2]. For instance, the AutoFix
                patchflow can resolve 82% of issues flagged by semgrep using
                gpt-4 (or 68% with llama-3.1-8B) without fine-tuning or
                providing specialized context [3]. Success rates are higher for
                text-based patchflows like PR Review and Generate Docstring, but
                lower for more complex tasks like Dependency Upgrades.
              </p>
              <p>
                We are not a coding assistant or a black-box GitHub bot. Our
                automation workflows run outside your IDE via the CLI or CI
                scripts without your active involvement.
              </p>
              <p>
                We are also not an ‘AI agent’ framework. In our experience, LLM
                agents struggle with planning and rarely identify the right
                execution path. Instead, Patchwork requires explicitly defined
                workflows that provide greater success and full control.
              </p>
              <p>
                Patchwork is open-source so you can build your own patchflows,
                integrate your preferred LLM endpoints, and fully self-host,
                ensuring privacy and compliance for large teams.
              </p>
              <p>
                As devs, we prefer to build our own ‘AI-enabled automation’
                given how easy it is to consume LLM APIs. If you do, try
                patchwork via a simple 'pip install patchwork-cli' or find us on
                Github[4].
              </p>
              <p>Sources:</p>
              <p>
                [1]
                <a
                  href="https://blog.tidelift.com/developers-spend-30-of-their-time-on-code-maintenance-our-latest-survey-results-part-3"
                  >https://blog.tidelift.com/developers-spend-30-of-their-time-...</a
                >
              </p>
              <p>
                [2]
                <a
                  href="https://www.patched.codes/blog/patched-rtc-evaluating-llms-for-diverse-software-development-tasks"
                  >https://www.patched.codes/blog/patched-rtc-evaluating-llms-f...</a
                >
              </p>
              <p>
                [3]
                <a href="https://www.patched.codes/blog/how-good-are-llms"
                  >https://www.patched.codes/blog/how-good-are-llms</a
                >
              </p>
              <p>
                [4]
                <a href="https://github.com/patched-codes/patchwork"
                  >https://github.com/patched-codes/patchwork</a
                >
              </p>
              <p>
                [Sample PRs]
                <a href="https://github.com/patched-demo/sample-injection/pulls"
                  >https://github.com/patched-demo/sample-injection/pulls</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="41081435">
          <h3>
            <a
              class="item"
              href="https://blog.singleton.io/posts/2022-10-17-otp-on-wrist/"
              >TOTP tokens on my wrist with the smartest dumb watch</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-26 @ 19:20:43</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41081435"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41081021">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/2024/07/26/zen-5s-2-ahead-branch-predictor-unit-how-30-year-old-idea-allows-for-new-tricks/"
              >Zen 5's 2-ahead branch predictor: how a 30 year old idea allows
              for new tricks</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-26 @ 18:32:37</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41081021"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41080991">
          <h3>
            <a class="item" href="https://tailscale.com/blog/new-internet"
              >The New Internet</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-26 @ 18:29:17</span
              ><span class="points-container"
                >Points: <span class="points">215</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41080991"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41080904">
          <h3>
            <a class="item" href="https://jlongster.com/why-chromaticity-shape"
              >Why does the chromaticity diagram look like that?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-26 @ 18:19:11</span
              ><span class="points-container"
                >Points: <span class="points">190</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41080904"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41080642">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=qDM6bCt1Gic"
              >Repulsive Shells [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-26 @ 17:50:30</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41080642"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41080570">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=qlfh_rv6khY"
              >A simple procedural animation technique [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-26 @ 17:40:18</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41080570"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41080373">
          <h3>
            <a
              class="item"
              href="https://statmodeling.stat.columbia.edu/2024/07/10/three-cultures-bayes-subjective-objective-pragmatic/"
              >Bayesian Statistics: The three cultures</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-26 @ 17:15:15</span
              ><span class="points-container"
                >Points: <span class="points">238</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41080373"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41080366">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/monumental-proof-settles-geometric-langlands-conjecture-20240719/"
              >Monumental proof settles geometric Langlands conjecture</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-26 @ 17:14:32</span
              ><span class="points-container"
                >Points: <span class="points">152</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41080366"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41069606">
          <h3>
            <a
              class="item"
              href="https://jamesbvaughan.com/volume-controller-1/"
              >Reverse-engineering my speakers' API to get reasonable volume
              control</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-25 @ 15:11:20</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41069606"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41060618">
          <h3>
            <a
              class="item"
              href="https://andrewdcampbell.github.io/seam-carving"
              >Seam Carving (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 19:03:36</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41060618"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41058087">
          <h3>
            <a
              class="item"
              href="https://railsatscale.com/2024-07-18-mastering-ruby-code-navigation-major-enhancements-in-ruby-lsp-2024/"
              >Mastering Ruby Code Navigation: Ruby LSP Enhancements in the
              First Half of 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-24 @ 15:30:25</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41058087"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41042513">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/smart-news/rare-350-year-old-paper-cuttings-from-a-london-girls-school-go-on-display-180984712/"
              >Paper cuttings made by 17th-century schoolgirls discovered
              beneath floorboards</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-23 @ 04:33:38</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41042513"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41036663">
          <h3>
            <a
              class="item"
              href="https://grumpygamer.com/why_adventure_games_suck"
              >Grumpy Gamer – Why Adventure Games Suck</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 17:02:39</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41036663"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41036544">
          <h3>
            <a
              class="item"
              href="https://ente.io/blog/how-to-preserve-physical-photos/"
              >How to Preserve Physical Photos</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-22 @ 16:51:16</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41036544"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
