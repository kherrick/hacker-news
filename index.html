<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38611565">
          <h3>
            <a
              class="item"
              href="https://www.abc.net.au/news/2023-12-12/fitbit-fined-11-million-after-misleading-consumers/103220970"
              >Fitbit fined $11M for misleading consumers about smart watches,
              fitness trackers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-12 @ 12:58:46</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38611565"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38611527">
          <h3>
            <a
              class="item"
              href="https://www.hyundai.news/eu/articles/press-releases/hyundai-and-kia-develop-shape-memory-alloy-integrated-snow-chain-technology.html"
              >Hyundai and Kia Develop Shape Memory Alloy Integrated Snow Chain
              Technology</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-12 @ 12:54:43</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38611527"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38611432">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/12/11/tesla_california_autopilot_lawsuit/"
              >Tesla says California's Autopilot action violates its free speech
              rights</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-12 @ 12:42:45</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38611432"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38611248">
          <h3>
            <a
              class="item"
              href="https://social.treehouse.systems/@marcan/111567255619206929"
              >YouTube is crippling Firefox on Asahi Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-12 @ 12:21:19</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38611248"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38611033">
          <h3>
            <a class="item" href="https://qdrant.tech/articles/qdrant-1.7.x/"
              >On a roll: Qdrant brings sparse vectors, discovery search and
              custom sharding</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-12 @ 11:52:19</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38611033"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38610912">
          <h3>
            <a class="item" href="https://hn.hund.io/"
              >Tell/Ask HN: HN WebSite is/was down. I'm curious why?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-12 @ 10:42:50</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38610912"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38610636">
          <h3>
            <a class="item" href="https://brainfuck.zptr.cc/"
              >BF-SYS: A fantasy computer that uses Brainfuck as its instruction
              set</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-12 @ 07:23:44</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38610636"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38609865">
          <h3>
            <a
              class="item"
              href="https://anguscheng.com/post/2023-12-12-wasm-game-in-c-raylib/"
              >Building a Web Game in C</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-12 @ 05:28:29</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38609865"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38609747">
          <h3>
            <a
              class="item"
              href="https://devblogs.microsoft.com/oldnewthing/20231211-00/?p=109126"
              >The mysterious second parameter to the x86 ENTER instruction</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-12 @ 05:05:35</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38609747"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38608672">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=zQeQWGqfFN0"
              >Car Manufacturing Process Overview [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-12 @ 02:43:56</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38608672"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38607540">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/12/11/microsoft_openai_investment_ftc/"
              >FTC wants Microsoft's relationship with OpenAI under the
              microscope</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-12 @ 00:32:53</span
              ><span class="points-container"
                >Points: <span class="points">202</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38607540"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38607424">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/23945184/epic-v-google-fortnite-play-store-antitrust-trial-updates#stream-entry-65d34a06-1fa5-4eab-abf6-ce450441b543"
              >Epic vs. Google: Google Loses</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-12 @ 00:21:07</span
              ><span class="points-container"
                >Points: <span class="points">1003</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38607424"
                  >Comments</a
                ><span class="descendants">: 756</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38606804">
          <h3>
            <a
              class="item"
              href="https://e360.yale.edu/features/worlds-largest-beaver-dam"
              >Deep in the wilderness, the largest beaver dam endures</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 23:14:30</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38606804"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38606667">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2310.00239"
              >AdaptNet: Policy Adaptation for Physics-Based Character
              Control</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 22:57:50</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38606667"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38606146">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2312.00638"
              >What if an SQL statement returned a database?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 22:05:52</span
              ><span class="points-container"
                >Points: <span class="points">220</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38606146"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38605765">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/newsroom/2023/12/apple-introduces-spatial-video-capture-on-iphone-15-pro/"
              >Apple introduces spatial video capture on iPhone 15 Pro</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 21:30:11</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38605765"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38605643">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/12/11/us/portland-oregon-drug-laws.html"
              >To revive Portland, officials seek to ban public drug use</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 21:21:17</span
              ><span class="points-container"
                >Points: <span class="points">302</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38605643"
                  >Comments</a
                ><span class="descendants">: 740</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38605453">
          <h3>
            <a class="item" href="https://www.bishopbook.com/"
              >Deep Learning – Foundations and Concepts (Chris Bishop)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 21:01:05</span
              ><span class="points-container"
                >Points: <span class="points">187</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38605453"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38603853">
          <h3>
            <a class="item" href="https://github.com/bricks-cloud/BricksLLM"
              >Show HN: I built an OSS alternative to Azure OpenAI services</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 18:56:23</span
              ><span class="points-container"
                >Points: <span class="points">175</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38603853"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
            <div class="text">
              <p>
                Azure OpenAI services was born out of companies needing enhanced
                security and access control for using different GPT models. I
                want to build an OSS version of Azure OpenAI services that
                people could self host in their own infrastructure.
              </p>
              <p>"How can I track LLM spend per API key?"</p>
              <p>
                "Can I create a development OpenAI API key with limited access
                for Bob?"
              </p>
              <p>"Can I see my LLM spend breakdown by models and endpoints?"</p>
              <p>
                "Can I create 100 OpenAI API keys that my students could use in
                a classroom setting?"
              </p>
              <p>These are questions that BricksLLM helps you answer.</p>
              <p>
                BricksLLM is an API gateway that let you create API keys with
                rate limit, cost control and ttl that could be used to access
                all OpenAI and Anthropic endpoints with out of box analytics.
              </p>
              <p>
                When I first started building with OpenAI APIs, I was constantly
                worried about API keys being comprised since vanilla OpenAI API
                keys would grant you unlimited access to all of their models.
                There are stories of people losing thousands of dollars and the
                existence of a black market for stolen OpenAI API keys.
              </p>
              <p>
                This is why I started building a proxy for ourselves that allows
                for the creation of API keys with rate limits and cost controls.
                I built BricksLLM in Go since that was the language I used to
                build performative ads exchanges that scaled to thousands of
                requests per second at my previous job. A lot of developer tools
                in LLM ops are built with Python which I believe might be
                suboptimal in terms of performance and compute resource
                efficiency.
              </p>
              <p>
                One of the challenges building this platform is to get accurate
                token counts for different OpenAI and Anthropic models. LLM
                providers are not exactly transparent with the way how they
                count prompt and completion tokens. In addition to user input,
                OpenAI and Anthropic pad prompt inputs with additional
                instructions or phrases that contribute to the final token
                counts. For example, Anthropic's actual completion token
                consumption is consistently 4 more than the token count of the
                completion output.
              </p>
              <p>
                The latency of the gateway hovers around 50ms. Half of the
                latency comes from the tokenizer. If I start utilizing Go
                routines, might be able to lower the latency of the gateway to
                30ms.
              </p>
              <p>
                BricksLLM is not an observability platform, but we do provide
                integration with Datadog so you can get more insights regarding
                what is going on inside the proxy. Compared to other tools in
                the LLMOps space, I believe that BricksLLM has the most
                comprehensive features when it comes to access control.
              </p>
              <p>Let me know what you guys think.</p>
            </div>
          </section>
        </section>
        <section id="38603440">
          <h3>
            <a
              class="item"
              href="https://upgradedpoints.com/news/tsa-self-service-screening/"
              >TSA introducing self-service screening technology in Las Vegas</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 18:29:28</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38603440"
                  >Comments</a
                ><span class="descendants">: 179</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38603353">
          <h3>
            <a class="item" href="http://pascal.hansotten.com/"
              >Pascal for Small Machines</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 18:24:09</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38603353"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38602575">
          <h3>
            <a class="item" href="https://blog.beeper.com/p/beeper-mini-is-back"
              >Beeper Mini is back</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 17:30:14</span
              ><span class="points-container"
                >Points: <span class="points">985</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38602575"
                  >Comments</a
                ><span class="descendants">: 1177</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38600551">
          <h3>
            <a
              class="item"
              href="https://www.scientificamerican.com/article/ultrasound-enables-remote-3-d-printing-even-in-the-human-body/"
              >Ultrasound Enables Remote 3-D Printing – Even in the Human
              Body</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 13:42:39</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38600551"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38600246">
          <h3>
            <a class="item" href="https://shepherd.com/bboy/2023"
              >Show HN: Crunching 1,200 Authors' Favorite Reads of 2023</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 12:58:42</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38600246"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
            <div class="text">
              <p>
                I launched Shepherd.com on a Show HN in April 2021 (<a
                  href="https://news.ycombinator.com/item?id=26871660"
                  >https://news.ycombinator.com/item?id=26871660</a
                >), and it has come a long way.
              </p>
              <p>
                My goal with Shepherd is to create an experience that feels like
                wandering your local bookstore, along with little notes from
                authors &amp; experts sharing why each book is one of their
                all-time favorites.
              </p>
              <p>
                For 2023, I surveyed 1,200+ authors to get their three favorite
                reads of the year. Then I crunched that data and broke it by
                genre, age range, and when it was published. Publisher data is a
                nightmare, so some of the genres are not perfect; I am working
                on improving that and some of the NLP/ML that drives this.
              </p>
              <p>
                Check out their top sci-fi reads:
                <a href="https://shepherd.com/bboy/2023/science-fiction"
                  >https://shepherd.com/bboy/2023/science-fiction</a
                >
              </p>
              <p>
                Or, their top nonfiction reads:
                <a href="https://shepherd.com/bboy/2023/nonfiction"
                  >https://shepherd.com/bboy/2023/nonfiction</a
                >
              </p>
              <p>You can also zoom in on each author’s favorite 3 reads.</p>
              <p>
                Louise Carey -
                <a href="https://shepherd.com/bboy/2023/f/louise-carey"
                  >https://shepherd.com/bboy/2023/f/louise-carey</a
                >
              </p>
              <p>
                Kevin Klehr -
                <a href="https://shepherd.com/bboy/2023/f/kevin-klehr"
                  >https://shepherd.com/bboy/2023/f/kevin-klehr</a
                >
              </p>
              <p>
                Alice C. Hill -
                <a href="https://shepherd.com/bboy/2023/f/alice-c-hill"
                  >https://shepherd.com/bboy/2023/f/alice-c-hill</a
                >
              </p>
              <p>
                Sara Ackerman -
                <a href="https://shepherd.com/bboy/2023/f/sara-ackerman"
                  >https://shepherd.com/bboy/2023/f/sara-ackerman</a
                >
              </p>
              <p>
                My email is ben@shepherd.com if you want to share ideas or
                suggestions for 2024.
              </p>
              <p>Thanks, Ben</p>
              <p>
                P.S. I have a newsletter for readers here where I share what I
                am building, new features, my fav book lists:
                <a href="https://forauthors.shepherd.com/newsletter-for-readers"
                  >https://forauthors.shepherd.com/newsletter-for-readers</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="38599252">
          <h3>
            <a class="item" href="https://github.com/berwynhoyt/wordstar-keys"
              >Wordstar-keys: Implement wordstar cursor control keys in Linux
              using xkb</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 10:23:52</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38599252"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38598940">
          <h3>
            <a class="item" href="https://github.com/TobyLobster/multiply_test"
              >Comparing 6502 Multiply Routines</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 09:19:20</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38598940"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38598171">
          <h3>
            <a
              class="item"
              href="https://www.hpl.hp.com/techreports/2007/HPL-2007-28R1.pdf"
              >Electing the Doge of Venice: analysis of a 13th Century protocol
              (2007) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 06:32:15</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38598171"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38597505">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/books/2023/11/22/gustave-flaubert-letters-review/"
              >Flaubert's letters are as hilarious and humane as his best
              fiction</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-11 @ 03:57:46</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38597505"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38591084">
          <h3>
            <a class="item" href="https://ciechanow.ski/mechanical-watch/"
              >Mechanical Watch (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-10 @ 12:28:49</span
              ><span class="points-container"
                >Points: <span class="points">867</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38591084"
                  >Comments</a
                ><span class="descendants">: 147</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38579913">
          <h3>
            <a
              class="item"
              href="https://marc.info/?l=openbsd-tech&amp;m=170205367232026&amp;w=2"
              >OpenBSD – pinning all system calls</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-09 @ 08:34:29</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38579913"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
