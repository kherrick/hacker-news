<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39818667">
          <h3>
            <a class="item" href="https://patterns.app/"
              >Patterns (YC S21) is hiring to automate data reporting with
              LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 17:00:10</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39818284">
          <h3>
            <a class="item" href="https://github.com/harryzcy/mailbox"
              >Show HN: Versatile email infrastructure on AWS serverless</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 16:28:07</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39818284"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <p>Notes:</p>
              <p>
                - all emails share the same inbox, as long as set your DNS
                correctly
              </p>
              <p>- Web client via self-hosted Docker or Cloudflare Pages</p>
              <p>
                - need additional access controls, may use Basic Auth or Forward
                Auth with Cloudflare deployment
              </p>
            </div>
          </section>
        </section>
        <section id="39818248">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/tech-industry/semiconductors/the-worlds-semiconductor-industry-hinges-on-a-quartz-factory-in-north-carolina"
              >The semiconductor industry hinges on a quartz factory in North
              Carolina</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 16:24:34</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39818248"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39818231">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/2020/03/30/harry-houdini-and-the-art-of-escape"
              >Houdini and the Art of Escape (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 16:22:46</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39818231"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39817497">
          <h3>
            <a
              class="item"
              href="https://mark-burgess-oslo-mb.medium.com/cfengines-star-trek-and-ai-origins-e99096fe845b"
              >CFEngine's Star Trek and AI Origins (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 15:25:11</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39817497"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39817026">
          <h3>
            <a
              class="item"
              href="https://ochagavia.nl/blog/from-full-stack-development-to-systems-programming/"
              >From full-stack development to systems programming</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 14:50:21</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39817026"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39816836">
          <h3>
            <a class="item" href="https://github.com/divriots/jampack"
              >Show HN: Jampack â€“ Optimizes static websites as a post-processing
              step</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 14:32:46</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39816836"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
            <div class="text">
              <p>
                Jampack is a post-processing tool that takes the output of your
                Static Site Generator (aka SSG) and optimizes it for best user
                experience and best Core Web Vitals scores.
              </p>
              <p>As of today it can:</p>
              <p>- Optimize local images, CDN images or external images</p>
              <p>- Optimize above-the-fold vs below-the-fold</p>
              <p>- Limit images max width</p>
              <p>- Inline critical CSS</p>
              <p>- Prefetch links on scroll</p>
              <p>- Improve browser compatibility</p>
              <p>- Auto-fixes HTML issues</p>
              <p>- Warn for HTML accessibility issues</p>
              <p>- Compress all assets in the end</p>
              <p>
                It processes directly the static output so it's compatible with
                any SSG or framework. We are intensively using it as a
                post-processing step to our Astro websites for example.
              </p>
              <p>
                With Jampack, we end-up focusing more on how simple, readable
                and maintainable our code is, throw images of any size, and let
                it optimize for maximum performance.
              </p>
              <p>
                We hope this can be helpful to lot of people! Cheers, Georges
                and the â€¹divâ€ºRIOTS team!
              </p>
            </div>
          </section>
        </section>
        <section id="39816835">
          <h3>
            <a
              class="item"
              href="https://github.com/Mechazawa/103-early-anti-adblock"
              >Show HN: Detecting adblock, without JavaScript, by abusing HTTP
              103 responses</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 14:32:43</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39816835"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39816808">
          <h3>
            <a class="item" href="https://github.com/ceritium/flatito"
              >Show HN: Flatito, grep for YAML and JSON files</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 14:30:23</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39816808"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
            <div class="text">
              <p>
                I created this tool because I sometimes struggle to find
                specific keys in typical i18n rails yamls. In the views, you
                don't always have the whole key, but it is extrapolated from the
                context. I am sure there are other use cases; I hope you find it
                useful.
              </p>
              <p>Cheers!</p>
            </div>
          </section>
        </section>
        <section id="39816423">
          <h3>
            <a
              class="item"
              href="https://thereader.mitpress.mit.edu/for-brilliant-color-packaging-the-first-lsd-blotter/"
              >For Brilliant Color: Packaging the First LSD Blotter</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 14:01:15</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39816423"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39815976">
          <h3>
            <a class="item" href="https://github.com/radiosilence/nano-web"
              >Show HN: Nano-web â€“ a low latency one binary webserver designed
              for serving SPAs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 13:23:44</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39815976"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
            <div class="text">
              <p>
                It uses a single compiled binary, it's going to have extremely
                low latency on account of caching all files in memory at
                runtime, and also the fun feature and really useful that's good
                for SPAs (e.g. Vite) or things like Astro is that you can inject
                configuration variables into it at runtime and access them from
                within your frontend code, so you don't have to rebuild any
                images for different environments as part of your CI.
              </p>
              <p>
                Whilst I'm sure this problem has been solved time and time
                again, I could never get a solution to be quite right.
              </p>
              <p>
                Also, serving things like Astro from S3 gets to be tricky
                because CloudFront doesn't support index pages in subdirectories
                so the routing breaks. This fixes this.
              </p>
              <p>
                Use it or don't, I think it's a cool little project and it's
                been a while since I worked on and released something :)
              </p>
            </div>
          </section>
        </section>
        <section id="39815805">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/2024/03/25/travel/sagrada-familia-barcelona-completion-scli-intl/index.html"
              >Barcelonaâ€™s Sagrada Familia will be completed in 2026</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 13:06:44</span
              ><span class="points-container"
                >Points: <span class="points">287</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39815805"
                  >Comments</a
                ><span class="descendants">: 218</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39815429">
          <h3>
            <a
              class="item"
              href="https://coredumped.dev/2024/03/25/bump-allocation-up-or-down/"
              >Bump Allocation: Up or Down?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 12:24:46</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39815429"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39815219">
          <h3>
            <a
              class="item"
              href="https://brainbaking.com/post/2024/03/the-case-of-a-leaky-goroutine/"
              >The case of a leaky goroutine</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 12:01:48</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39815219"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39814877">
          <h3>
            <a
              class="item"
              href="https://github.com/pg-sharding/spqr/discussions/569"
              >SPQR 1.3.0: a production-ready system for horizontal scaling of
              PostgreSQL</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 11:24:39</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39814877"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39814683">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/functional-electrical-stimulation-exosuit-project"
              >Exosuit Muscle Control Steps Closer to Reality</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 10:58:16</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39814683"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39814558">
          <h3>
            <a
              class="item"
              href="https://ec.europa.eu/commission/presscorner/detail/en/ip_24_1689"
              >Commission opens non-compliance investigations against Alphabet,
              Apple and Meta</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 10:38:17</span
              ><span class="points-container"
                >Points: <span class="points">358</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39814558"
                  >Comments</a
                ><span class="descendants">: 316</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39814271">
          <h3>
            <a class="item" href="https://www.c64os.com/post/hiddenfiles"
              >Hidden Files in C64 OS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 09:45:58</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39814271"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39813883">
          <h3>
            <a class="item" href="https://github.com/pyenv/pyenv"
              >Pyenv â€“ lets you easily switch between multiple versions of
              Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 08:34:01</span
              ><span class="points-container"
                >Points: <span class="points">191</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39813883"
                  >Comments</a
                ><span class="descendants">: 233</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39813588">
          <h3>
            <a class="item" href="https://divy.work/turbocall.html"
              >Turbocall â€“ Just-in-time compiler for Deno FFI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 07:41:48</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39813588"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39813560">
          <h3>
            <a class="item" href="https://txstc55.github.io/ugly-avatar/"
              >Ugly Avatar</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-25 @ 07:36:08</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39813560"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39804004">
          <h3>
            <a
              class="item"
              href="https://devnonsense.com/posts/tcp-connection-timeout-mystery/"
              >TCP connection timeout mystery</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-24 @ 00:13:05</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39804004"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39803703">
          <h3>
            <a class="item" href="https://www.biographic.com/the-eider-keepers/"
              >The Eider Keepers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-23 @ 23:13:55</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39803703"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39800678">
          <h3>
            <a class="item" href="https://visdeurbel.nl/en/the-fish-doorbell/"
              >See a Fish? Ring the Bell</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-23 @ 15:34:51</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39800678"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39800542">
          <h3>
            <a
              class="item"
              href="https://zetier.com/news/jtag-chain-diagram-to-dump-nor/"
              >Using JTAG to dump parallel NOR flash</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-23 @ 15:15:17</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39800542"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39799988">
          <h3>
            <a
              class="item"
              href="https://blog.trailofbits.com/2024/03/22/why-fuzzing-over-formal-verification/"
              >Why fuzzing over formal verification?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-23 @ 13:57:58</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39799988"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39799131">
          <h3>
            <a class="item" href="https://www.faviconhelper.com/1"
              >Show HN: FaviconHelper</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-23 @ 11:29:23</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39799131"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
            <div class="text">
              Favicon Helper is an ai superpowered icon generator that can
              generate stunning favicons in seconds. First "real" project lmk if
              it sucks!
            </div>
          </section>
        </section>
        <section id="39798225">
          <h3>
            <a
              class="item"
              href="https://philwip.com/2024/03/22/pcb-repair-speed-buggy-buggy-boy/"
              >Repairing a buggy board arcade machine</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-23 @ 07:49:45</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39798225"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39796837">
          <h3>
            <a
              class="item"
              href="https://www.historytoday.com/archive/history-matters/william-adams-english-advisor-shogun"
              >William Adams: English Advisor to the Shogun</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-23 @ 02:05:09</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39796837"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39787334">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/articles/when-did-dogs-become-our-best-friends"
              >When did dogs become our best friends?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-22 @ 03:54:11</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39787334"
                  >Comments</a
                ><span class="descendants">: 122</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
