<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40760042">
          <h3>
            <a
              class="item"
              href="https://pluralistic.net/2024/06/21/off-the-menu/"
              >Creative workers deserve better than a choice as to who rips them
              off</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 16:08:08</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40760042"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40759767">
          <h3>
            <a
              class="item"
              href="https://www.businessinsider.com/microsoft-insiders-worry-company-has-become-just-it-for-openai-2024-3"
              >Microsoft insiders worry the company has become just 'IT for
              OpenAI'</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 15:32:29</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40759767"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40759712">
          <h3>
            <a
              class="item"
              href="https://www.sciencedirect.com/science/article/pii/S0147651324006663"
              >Bedroom light at night increases inflammation and disrupts
              circadian rhythm</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 15:23:31</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40759712"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40759626">
          <h3>
            <a class="item" href="https://lmnt.me/blog/training-ai.html"
              >Training AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 15:10:28</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40759626"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40759393">
          <h3>
            <a
              class="item"
              href="https://variety.com/2016/digital/news/netflix-meridian-imf-tools-open-source-1201859416/"
              >'Meridian': Why Netflix Is Helping Competitors with Content and
              Code (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 14:32:10</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40759393"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40759333">
          <h3>
            <a class="item" href="https://haithemturki.com/hybrid-nerf/"
              >HybridNeRF: Efficient Neural Rendering</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 14:21:21</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40759333"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40758767">
          <h3>
            <a
              class="item"
              href="https://anandsanwal.me/2018/06/19/dad-company-sale/"
              >After my dad died, I ran and sold his company (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 12:49:18</span
              ><span class="points-container"
                >Points: <span class="points">228</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40758767"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40758703">
          <h3>
            <a class="item" href="https://github.com/mattrighetti/envelope"
              >Show HN: Envelope – A modern environment variable cli tool</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 12:39:57</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40758703"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
            <div class="text">
              <p>
                I had this idea when I made a big mistake and broke some
                production stuff because I had a very messy .env file laying
                around in my project.
              </p>
              <p>
                I was implementing new features for one of my projects and in my
                .env file I had the test database url commented out and the
                production one was not. Long story short, I applied migrations
                to the production database instead of my local test one and
                broke a lot of production APIs :')
              </p>
              <p>
                I wanted a tool that could easily help me spot these issues
                before something bad happened, and so I built envelope for that
                reason.
              </p>
              <p>
                Instead of a \.env(\..+)? file, I now use this tool to add
                variables to different configurations: dev, prod etc. and I feed
                them to the program I am executing on a one liner.
              </p>
              <p></p>
              <pre><code>  $ envelope init
  $ envelope add dev db_url localhost:5432/postgres
  $ envelope add dev db_username username
  $ envelope add dev db_pwd pwd
  $ export $(envelope list dev)
  $ ./run.sh
</code></pre>
              This way I am explicitly exporting the dev environment without
              relying on the fact that everything is in order in my .env file
              (another approach would be to have a .env.dev file)
              <p>
                A very useful feature that I use quite a lot is the `check`
                command which is going to tell you which environment you have
                currently active
              </p>
              <p></p>
              <pre><code>  $ export $(envelope list dev)
  $ envelope check
  &gt; dev
</code></pre>
              I don't think this tool is going to be useful to anybody, but I
              wanted to share this with you in case there is someone that can
              make good use of it or find particular scenarios where this could
              be used instead of .env files, either way I had a lot of fun
              building it
            </div>
          </section>
        </section>
        <section id="40758415">
          <h3>
            <a
              class="item"
              href="https://jobs.ashbyhq.com/permitflow?departmentId=d33195eb-8978-4439-abc6-5a8a072de808"
              >PermitFlow (YC W22) Is Hiring Software Engineers in NYC</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 12:00:39</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40757787">
          <h3>
            <a
              class="item"
              href="https://www.neilhenning.dev/posts/yourownconstantfolder/"
              >Own Constant Folder in C/C++</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 10:07:05</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40757787"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40756176">
          <h3>
            <a
              class="item"
              href="https://gwern.net/doc/psychology/linguistics/2024-fedorenko.pdf"
              >Language is primarily a tool for communication rather than
              thought [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 04:04:22</span
              ><span class="points-container"
                >Points: <span class="points">337</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40756176"
                  >Comments</a
                ><span class="descendants">: 253</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40756034">
          <h3>
            <a class="item" href="https://www.farmfe.org/"
              >Farm: Fast vite compatible build tool written in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 03:34:39</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40756034"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40754624">
          <h3>
            <a
              class="item"
              href="https://cacm.acm.org/blogcacm/technical-marvels-part-3-the-yupana/"
              >Technical Marvels, Part 3: The Yupana</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-21 @ 22:46:29</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40754624"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40752721">
          <h3>
            <a
              class="item"
              href="https://asia.nikkei.com/Business/Tech/Semiconductors/TSMC-explores-radical-new-chip-packaging-approach-to-feed-AI-boom"
              >TSMC experimenting with rectangular wafers vs. round for more
              chips per wafer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-21 @ 19:17:41</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40752721"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40751813">
          <h3>
            <a
              class="item"
              href="https://navyhistory.au/aster-shootdown-over-sydney-in-1955/"
              >Aster shootdown over Sydney in 1955</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-21 @ 17:33:28</span
              ><span class="points-container"
                >Points: <span class="points">205</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40751813"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40751468">
          <h3>
            <a class="item" href="https://criu.org/Main_Page"
              >CRIU, a project to implement checkpoint/restore functionality for
              Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-21 @ 16:59:52</span
              ><span class="points-container"
                >Points: <span class="points">191</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40751468"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40751020">
          <h3>
            <a
              class="item"
              href="https://blog.jitx.com/jitx-corporate-blog/testing-generative-ai-for-circuit-board-design"
              >Testing Generative AI for Circuit Board Design</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-21 @ 16:16:31</span
              ><span class="points-container"
                >Points: <span class="points">320</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40751020"
                  >Comments</a
                ><span class="descendants">: 162</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40750506">
          <h3>
            <a
              class="item"
              href="https://mathstodon.xyz/@johncarlosbaez/112653640999819867"
              >Why does current flow the opposite way from the electrons?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-21 @ 15:16:16</span
              ><span class="points-container"
                >Points: <span class="points">153</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40750506"
                  >Comments</a
                ><span class="descendants">: 152</span></span
              >
            </h4>
            <div class="text">
              After fighting through a bunch of unhelpful answers, one gets to
              the bottom of things: Benjamin Franklin chose a convention that
              makes electrons negative, and apparently nobody knows why.
            </div>
          </section>
        </section>
        <section id="40749426">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gaming/2024/06/from-infocom-to-80-days-an-oral-history-of-text-games-and-interactive-fiction/"
              >From Infocom to 80 Days: An oral history of text games and
              interactive fiction</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-21 @ 13:30:21</span
              ><span class="points-container"
                >Points: <span class="points">186</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40749426"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40746773">
          <h3>
            <a class="item" href="https://github.com/mayneyao/eidos"
              >Show HN: Eidos – Offline alternative to Notion</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-21 @ 06:30:02</span
              ><span class="points-container"
                >Points: <span class="points">224</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40746773"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
            <div class="text">
              <p>
                Notion, like most SaaS products, is not open-source, so I can't
                customize it to my heart's content. I can only wait and vote for
                new features, but I can code, and I don't want to wait. I really
                like the concepts of FOSS, solid, and local-first. SaaS could
                die. Long may the SQLite. So, I built Eidos based on sqlite for
                managing my personal data throughout my lifetime in one place.
                Eidos is a long-term project for me. It looks like Notion, but
                the core is more like "obsidian.sqlite" with a powerful
                extension system.
              </p>
              <p>Here are a few key ideas:</p>
              <p>
                - Eidos is built based on sqlite-wasm and runs entirely in the
                browser. It can be used immediately, with no installation or
                configuration required. It's a pure PWA, with full offline
                support.
              </p>
              <p>
                - A block-styled document editor and an Airtable-like table,
                built on top of SQLite, where each table is a real SQLite table.
              </p>
              <p>
                - A powerful extension system inspired by Figma plugin and
                Cloudflare worker. You can write scripts in TypeScript directly
                in the browser. It is easy to manipulate data in docs, tables,
                and the file system. It also supports API.
              </p>
              <p>
                - If you're not a developer, you're still in luck. We're living
                in an AI era. LLM empowers people to craft their own software
                without writing any code. Eidos deeply integrated with LLM. You
                can translate, summarize, talk to your data, process table data
                in batches, and more. It makes your life easier with AI. You can
                fully customize your prompts and freely choose your LLM
                provider, without being locked to any vendor.
              </p>
              <p>
                To be honest, so far, there are still some bugs and
                shortcomings, and it hasn't yet reached my envisioned
                perfection. There is still some work to be done, but the basic
                framework has taken shape. I've been working on it for a year
                and have eaten my own dog food for the past half year. To help
                Eidos become better (and celebrate the release of the Elden
                Ring's DLC), I've decided to make it open-source and gather more
                feedback. Now, I'm going to take a break and play Shadow of the
                Erdtree.
              </p>
              <p>- <a href="https://eidos.space">https://eidos.space</a></p>
            </div>
          </section>
        </section>
        <section id="40746144">
          <h3>
            <a
              class="item"
              href="https://lichess.org/@/jk_182/blog/using-stockfish-to-identify-ideal-squares/x3U2g3NP"
              >Using Stockfish to identify ideal squares</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-21 @ 04:25:36</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40746144"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40741833">
          <h3>
            <a class="item" href="https://lwn.net/Articles/978010/"
              >Memory sealing for the GNU C Library</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-20 @ 18:42:44</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40741833"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40741236">
          <h3>
            <a class="item" href="https://nical.github.io/posts/etagere.html"
              >Eight million pixels and counting: improving texture atlas
              allocation in Firefox (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-20 @ 17:42:02</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40741236"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40740602">
          <h3>
            <a
              class="item"
              href="https://www.goto10retro.com/p/atari-520st-review-in-creative-computing"
              >Atari 520ST Review in Creative Computing – By Paul Lefebvre</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-20 @ 16:38:29</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40740602"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40739356">
          <h3>
            <a
              class="item"
              href="https://rafichaudhury.com/site/blog/Freehand-Web"
              >Curating my corner of the Internet with a freehand web editor</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-20 @ 14:48:29</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40739356"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40739046">
          <h3>
            <a
              class="item"
              href="https://dl.acm.org/doi/pdf/10.1145/319838.319870"
              >Connection Machine Lisp (1986)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-20 @ 14:17:02</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40739046"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40738534">
          <h3>
            <a
              class="item"
              href="https://keymaterial.net/2024/06/15/reconstructing-public-keys-from-signatures/"
              >Reconstructing Public Keys from Signatures</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-20 @ 13:25:52</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40738534"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40736174">
          <h3>
            <a
              class="item"
              href="https://jupiter-ace.co.uk/Forth_general_practical_computing8108.html"
              >As you learn Forth, it learns from you (1981)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-20 @ 08:05:13</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40736174"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40735038">
          <h3>
            <a
              class="item"
              href="https://zacksdancelab.com/blog/a-new-kind-of-dance-science/"
              >A New Kind Of Dance Science (combinatorics of social dancing)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-20 @ 04:53:37</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40735038"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40713595">
          <h3>
            <a class="item" href="https://dtsec.us/2023-04-24-Sleep/"
              >An Introduction to Sleep Obfuscation for Malware (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-18 @ 02:45:57</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40713595"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
