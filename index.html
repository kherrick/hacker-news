<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43243109">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2502.20547"
              >An Attempt to Catch Up with JIT Compilers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-03 @ 16:06:50</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43243109"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43242921">
          <h3>
            <a
              class="item"
              href="https://seanobannon.substack.com/p/drone-delivery-for-defense"
              >Drone Delivery for Defense</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-03 @ 15:53:16</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43242921"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43242818">
          <h3>
            <a
              class="item"
              href="https://theophilecantelob.re/blog/2025/foudinge/"
              >Show HN: Knowledge graph of restaurants and chefs, built using
              LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-03 @ 15:43:20</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43242818"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
            <div class="text">
              <p>
                My latest side project is knowledge graph that maps the French
                culinary network using data extracted from restaurant reviews
                from LeFooding.com. The project uses LLMs to extract structured
                information from unstructured text.
              </p>
              <p>Some technical aspects you may be interested in:</p>
              <p>
                - Used structured generation to reliably parse unstructured text
                into a consistent schema
              </p>
              <p>
                - Tested multiple models (Mistral-7B-v0.3, Llama3.2-3B,
                gpt4o-mini) for information extraction
              </p>
              <p>
                - Created an interactive visualization using gephi-lite and
                Retina (WebGL)
              </p>
              <p>
                - Built (with Claude) a simple Flask web app to clean and
                deduplicate the data
              </p>
              <p>
                - Total cost for inferencing 2000 reviews with gpt4o-mini: less
                than 1â‚¬!
              </p>
              <p>
                You can explore the visualization here: [Interactive Culinary
                Network](<a
                  href="https://ouestware.gitlab.io/retina/1.0.0-beta.4/#/graph/?url=https%3A%2F%2Fgist.githubusercontent.com%2Ftheophilec%2F351f17ece36477bc48438d5ec6d14b5a%2Fraw%2Ffa85a89541c953e8f00d6774fe42f8c4bd30fa47%2Fgraph.gexf&amp;r=x&amp;sa=re&amp;ca[]=t&amp;ca[]=ra-s&amp;st[]=u&amp;st[]=re&amp;ed=u"
                  >https://ouestware.gitlab.io/retina/1.0.0-beta.4/#/graph/?url...</a
                >)
              </p>
              <p>
                The code for the project is available on GitHub: - Main project:
                <a href="https://github.com/theophilec/foudinge"
                  >https://github.com/theophilec/foudinge</a
                >
                - Data cleaning tool:
                <a href="https://github.com/theophilec/foudinge-scrub"
                  >https://github.com/theophilec/foudinge-scrub</a
                >
              </p>
              <p>Happy to get feedback!</p>
            </div>
          </section>
        </section>
        <section id="43242815">
          <h3>
            <a class="item" href="https://tolstoyan.substack.com/p/youth"
              >Youth and what happens when it's gone</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-03 @ 15:43:00</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43242815"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43242019">
          <h3>
            <a
              class="item"
              href="https://www.qodo.ai/blog/qodo-embed-1-code-embedding-code-retreival/"
              >SOTA Code Retrieval with Efficient Code Embedding Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-03 @ 14:24:14</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43242019"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43241880">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/games/2025/mar/03/ghost-hunting-pornography-and-interactive-art-the-weird-afterlife-of-xbox-kinect"
              >The weird afterlife of Xbox Kinect</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-03 @ 14:10:44</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43241880"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43241689">
          <h3>
            <a class="item" href="https://fintoc.com/codehere"
              >Fintoc (YC W21) Is Hiring Senior Software Engineer. Live
              Rent-Free in CL or MX</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-03 @ 13:51:03</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43241404">
          <h3>
            <a class="item" href="http://www.interdb.jp/pg/index.html"
              >The Internals of PostgreSQL</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-03 @ 13:14:22</span
              ><span class="points-container"
                >Points: <span class="points">173</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43241404"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43241212">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/texas-amazon-drones-stop-flying/"
              >Amazonâ€™s delivery drones are grounded in College Station,
              Texas</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-03 @ 12:44:33</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43241212"
                  >Comments</a
                ><span class="descendants">: 199</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43240354">
          <h3>
            <a
              class="item"
              href="https://newsletter.canopy.is/p/the-5-most-difficult-employees-and"
              >Difficult Employees (and How to Handle Them)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-03 @ 10:28:28</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43240354"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43239526">
          <h3>
            <a
              class="item"
              href="https://camillovisini.com/coding/phlex-for-rails-emails-action-mailer-without-erb"
              >Phlex for Rails Emails: Action Mailer Without ERB</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-03 @ 08:20:45</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43239526"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43238893">
          <h3>
            <a class="item" href="https://diffusion.csail.mit.edu"
              >MIT 6.S184: Introduction to Flow Matching and Diffusion Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-03 @ 06:27:55</span
              ><span class="points-container"
                >Points: <span class="points">250</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43238893"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43238570">
          <h3>
            <a class="item" href="https://github.com/tearflake/flake-ui"
              >FlakeUI</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-03 @ 05:29:02</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43238570"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43237581">
          <h3>
            <a class="item" href="https://focusfurnace.com/scroll_buddy.html"
              >Made a scroll bar buddy that walks down the page when you
              scroll</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-03 @ 02:13:00</span
              ><span class="points-container"
                >Points: <span class="points">512</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43237581"
                  >Comments</a
                ><span class="descendants">: 173</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43237273">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/lifestyle/flow-wins-best-animated-feature-film-oscar-2025-03-03/"
              >Blender-made movie Flow takes Oscar</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-03 @ 01:17:46</span
              ><span class="points-container"
                >Points: <span class="points">681</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43237273"
                  >Comments</a
                ><span class="descendants">: 118</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43235763">
          <h3>
            <a
              class="item"
              href="https://www.downtowndougbrown.com/2025/03/the-gooey-rubber-thats-slowly-ruining-old-hard-drives/"
              >Gooey rubber that's slowly ruining old hard drives</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-02 @ 22:11:39</span
              ><span class="points-container"
                >Points: <span class="points">254</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43235763"
                  >Comments</a
                ><span class="descendants">: 176</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43234544">
          <h3>
            <a class="item" href="https://blog.tangled.sh/intro"
              >Show HN: Tangled â€“ Git collaboration platform built on atproto</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-02 @ 20:14:15</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43234544"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43234089">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/news/the-lede/geothermal-power-is-a-climate-moon-shot-beneath-our-feet"
              >Geothermal power is a climate moon shot beneath our feet</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-02 @ 19:33:21</span
              ><span class="points-container"
                >Points: <span class="points">271</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43234089"
                  >Comments</a
                ><span class="descendants">: 267</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43233903">
          <h3>
            <a
              class="item"
              href="https://simonwillison.net/2025/Mar/2/hallucinations-in-code/"
              >Hallucinations in code are the least dangerous form of LLM
              mistakes</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-02 @ 19:15:58</span
              ><span class="points-container"
                >Points: <span class="points">329</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43233903"
                  >Comments</a
                ><span class="descendants">: 257</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43233143">
          <h3>
            <a
              class="item"
              href="https://www.righto.com/2025/03/pentium-multiplier-adder-reverse-engineered.html"
              >The Pentium contains a complicated circuit to multiply by
              three</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-02 @ 18:04:35</span
              ><span class="points-container"
                >Points: <span class="points">343</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43233143"
                  >Comments</a
                ><span class="descendants">: 133</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43232880">
          <h3>
            <a
              class="item"
              href="https://zetier.com/speedrunners-are-vulnerability-researchers/"
              >Speedrunners are vulnerability researchers, they just don't know
              it yet</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-02 @ 17:40:36</span
              ><span class="points-container"
                >Points: <span class="points">333</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43232880"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43228816">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/science/live-news/moon-landing-blue-ghost-03-02-25/index.html"
              >Firefly â€˜Blue Ghostâ€™ lunar lander touches down on the moon</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-02 @ 09:31:50</span
              ><span class="points-container"
                >Points: <span class="points">670</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43228816"
                  >Comments</a
                ><span class="descendants">: 161</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43218840">
          <h3>
            <a
              class="item"
              href="https://appleinsider.com/articles/25/02/27/apples-c1-modem-breaks-no-records-for-speed-but-is-exceptionally-power-efficient"
              >C1 modem breaks no speed records, but is power efficient</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-03-01 @ 13:02:16</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43218840"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43209046">
          <h3>
            <a class="item" href="http://socmus.com/en/"
              >Virtual museum of socialist era graphic design in Bulgaria</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-28 @ 18:58:13</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43209046"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43208507">
          <h3>
            <a class="item" href="https://github.com/chagui/ninjavis"
              >ninjavis â€“ generate visualization from ninja build logs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-28 @ 18:00:52</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43208507"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43203745">
          <h3>
            <a
              class="item"
              href="https://www.nextplatform.com/2025/02/27/aws-cat-qubits-make-quantum-error-correction-effective-affordable/"
              >AWS Cat Qubits Make Quantum Error Correction Effective,
              Affordable</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-28 @ 09:51:38</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43203745"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43200793">
          <h3>
            <a class="item" href="https://github.com/deepseek-ai/smallpond"
              >Smallpond â€“ A lightweight data processing framework built on
              DuckDB and 3FS</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-28 @ 01:56:35</span
              ><span class="points-container"
                >Points: <span class="points">290</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43200793"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43197248">
          <h3>
            <a class="item" href="https://www.ericbutton.co/p/data-labelling"
              >We in-housed our data labelling</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-27 @ 18:53:44</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43197248"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43196488">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/articles/cgr2n8xx5gyo"
              >Man's brain turned to glass by hot Vesuvius ash cloud</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-27 @ 17:32:01</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43196488"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43196133">
          <h3>
            <a
              class="item"
              href="https://www.sheffield.ac.uk/news/harvesting-sun-twice-agrivoltaics-shows-promise-sustainable-food-energy-and-water-management-east"
              >Harvest the sun twice: Agrivoltaics promises sustainable food,
              energy and water</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-27 @ 16:56:14</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43196133"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
