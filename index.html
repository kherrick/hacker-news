<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42318773">
          <h3>
            <a
              class="item"
              href="https://today.duke.edu/2022/03/lead-exposure-last-century-shrunk-iq-scores-half-americans"
              >Lead exposure in last century shrank IQ scores of half of
              Americans</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-04 @ 16:01:59</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42318773"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42318053">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/health/2024/12/from-diapers-to-mouths-of-babes-how-splash-pads-sickened-over-10k/"
              >Splash pads are fountains of fecal material; CDC reports 10K
              illnesses</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-04 @ 14:57:55</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42318053"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42317991">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/articles/c5yd35l0r91o"
              >Telegram U-turns and joins child safety scheme</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-04 @ 14:54:08</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42317991"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42317952">
          <h3>
            <a
              class="item"
              href="https://moreisdifferent.blog/p/a-pro-science-pro-progress-techno"
              >A pro-science, pro-progress, techno-optimistic health textbook
              from 1929</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-04 @ 14:50:31</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42317952"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42317903">
          <h3>
            <a
              class="item"
              href="https://deepmind.google/discover/blog/genie-2-a-large-scale-foundation-world-model/"
              >Genie 2: A large-scale foundation world model</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-04 @ 14:45:02</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42317903"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42316799">
          <h3>
            <a
              class="item"
              href="https://jpcamara.com/2024/12/01/speeding-up-ruby.html"
              >Speeding up Ruby by rewriting C in Ruby</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-04 @ 12:31:51</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42316799"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42316644">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42316644"
              >Reprompt (YC W24) Is Hiring an Engineer to Build Location
              Agents</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-04 @ 12:00:40</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
            <div class="text">
              <p>
                To do this we have an internal agents platform that supports
                Web, Vision, Doc Reading, and soon self-driving browser agents.
              </p>
              <p>
                We're hiring for a senior/founding engineer who knows python and
                has worked with LLMs before. Join us and let's build the agent
                revolution for enterprise.
              </p>
              <p>
                <a
                  href="https://www.ycombinator.com/companies/reprompt/jobs/YfQBWDH-founding-engineer"
                  >https://www.ycombinator.com/companies/reprompt/jobs/YfQBWDH-...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="42316246">
          <h3>
            <a
              class="item"
              href="https://oxfordclarion.uk/the-bird-and-baby-grows-up-inside-the-new-eagle-child/"
              >The "Bird and Baby" grows up: inside the new Eagle and Child</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-04 @ 10:40:14</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42316246"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42315946">
          <h3>
            <a
              class="item"
              href="https://tej.as/blog/how-to-grow-professional-relationships-tjs-model"
              >How to grow professional relationships</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-04 @ 09:42:02</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42315946"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42315318">
          <h3>
            <a
              class="item"
              href="https://newcriterion.com/article/the-ambiguous-witness-of-dietrich-bonhoeffer/"
              >The complicated legacy of the anti-Nazi theologian Dietrich
              Bonhoeffer (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-04 @ 07:44:48</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42315318"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42314905">
          <h3>
            <a class="item" href="https://600f3559.prunt-docs.pages.dev/"
              >Show HN: A 5th order motion planner with PH spline blending,
              written in Ada</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-04 @ 06:25:14</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42314905"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42314547">
          <h3>
            <a class="item" href="https://walzr.com/IMG_0001/">IMG_0001</a>
          </h3>
          <section>
            <h4>
              <span>2024-12-04 @ 04:46:12</span
              ><span class="points-container"
                >Points: <span class="points">1164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42314547"
                  >Comments</a
                ><span class="descendants">: 171</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42314340">
          <h3>
            <a class="item" href="https://ppc.web.cern.ch/"
              >A particle physics course for high-school students</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-04 @ 03:49:37</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42314340"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42313947">
          <h3>
            <a
              class="item"
              href="https://kevinmunger.substack.com/p/the-tragedy-of-stafford-beer"
              >The Tragedy of Stafford Beer (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-04 @ 02:24:54</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42313947"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42313572">
          <h3>
            <a
              class="item"
              href="https://www.alberta.ca/history-of-rat-control-in-alberta"
              >History of Rat Control in Alberta</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-04 @ 01:14:28</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42313572"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42313258">
          <h3>
            <a
              class="item"
              href="https://blog.kerollmops.com/meilisearch-is-too-slow"
              >Drawbacks and solutions for the Meilisearch document indexer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-04 @ 00:21:45</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42313258"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42313087">
          <h3>
            <a class="item" href="https://spillhistorie.no/the-story-of-rogue/"
              >The Story of Rogue</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-03 @ 23:59:24</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42313087"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42312301">
          <h3>
            <a
              class="item"
              href="https://www.phoenixframework.org/blog/phoenix-liveview-1.0-released?release=1.0"
              >Phoenix LiveView 1.0.0 is here</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-03 @ 22:28:47</span
              ><span class="points-container"
                >Points: <span class="points">648</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42312301"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42312121">
          <h3>
            <a class="item" href="https://www.armaansahni.com/game/"
              >My son (9 yrs old) used plain JavaScript to make a game, and
              wants your feedback</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-03 @ 22:08:16</span
              ><span class="points-container"
                >Points: <span class="points">757</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42312121"
                  >Comments</a
                ><span class="descendants">: 361</span></span
              >
            </h4>
            <div class="text">
              <p>
                Recently, we had a breakthrough where he learned how to leverage
                Google Gemini as a learning tool (not to write code for him, but
                as a better search and as a coding teacher). This leveled him up
                big time and he decided to make his own game.
              </p>
              <p>
                Game link here:
                <a href="https://www.armaansahni.com/game/"
                  >https://www.armaansahni.com/game/</a
                >
              </p>
              <p>
                He's coded all the HTML, CSS &amp; JS by hand in VSCode. He's
                made the animated graphics on his own using a web based sprite
                editor called Piskel.
              </p>
              <p>
                For the game, I provided hints along the way and Gemini has
                helped him with syntax. View source to see the code. He's
                excited to share with the community.
              </p>
              <p>
                He also wrote a blog post about how he made this game:
                <a
                  href="https://www.armaansahni.com/how-i-coded-a-game-using-ai/"
                  >https://www.armaansahni.com/how-i-coded-a-game-using-ai/</a
                >
                (he independently figured out how to leverage Gemini effectively
                and writes about it here).
              </p>
              <p>
                Regarding the blog post - We had a discussion about who the
                target audience is (ie not 9 year olds!), what they would be
                interested in learning about and the general outline. He then
                dictated his words into the computer (which gets around spelling
                issues), and he went through multiple rounds of feedback from
                his parents (improving clarity, punctuation, etc). In other
                words, its his words &amp; thoughts but he had help along the
                way!
              </p>
              <p>
                NOTE: both parents are programmers, who provided valuable
                guidance through his coding journey.
              </p>
            </div>
          </section>
        </section>
        <section id="42311069">
          <h3>
            <a class="item" href="https://egoless.engineering"
              >Egoless Engineering</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-03 @ 20:38:23</span
              ><span class="points-container"
                >Points: <span class="points">658</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42311069"
                  >Comments</a
                ><span class="descendants">: 238</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42311031">
          <h3>
            <a class="item" href="https://github.com/keyvank/30cc"
              >Show HN: My C compiler compiled itself</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-03 @ 20:35:24</span
              ><span class="points-container"
                >Points: <span class="points">226</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42311031"
                  >Comments</a
                ><span class="descendants">: 89</span></span
              >
            </h4>
            <div class="text">
              One of the most challenging projects of my life :)
            </div>
          </section>
        </section>
        <section id="42309790">
          <h3>
            <a class="item" href="https://www.thetubecomputer.com/"
              >The Tube Computer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-03 @ 18:54:00</span
              ><span class="points-container"
                >Points: <span class="points">208</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42309790"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42308051">
          <h3>
            <a class="item" href="https://skia-canvas.org/"
              >Skia Canvas: Browserless implementation of the HTML Canvas
              drawing API for node</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-03 @ 16:34:18</span
              ><span class="points-container"
                >Points: <span class="points">268</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42308051"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42302560">
          <h3>
            <a class="item" href="https://www.bonbook.co/showhn"
              >Show HN: Book and change flights with one email</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-03 @ 02:31:29</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42302560"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
            <div class="text">
              <p>
                TLDR; I built an inbox simulator so you can try BonBook in 15s,
                without sharing your email.
              </p>
              <p>
                Earlier this year I was flying 2-3 times per month and found
                booking and changing flights a hassle. So I decided to fix it.
              </p>
              <p>
                BonBook lets you find, book and change flights with one email.
                It can also auto-find flights for events you’re attending.
              </p>
              <p>
                Over the last few days, I built a simulator that lets you
                interact with BonBook without sharing your email. It responds
                with real flights and each response includes a link to compare
                w/ Google.
              </p>
            </div>
          </section>
        </section>
        <section id="42294737">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Neuroevolution_of_augmenting_topologies"
              >Neuroevolution of augmenting topologies (NEAT algorithm)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-02 @ 10:12:35</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42294737"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42281629">
          <h3>
            <a class="item" href="https://github.com/tsenart/kth"
              >Kth: High-Performance Selection Algorithms for Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-30 @ 13:51:48</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42281629"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42280323">
          <h3>
            <a
              class="item"
              href="https://mariakonnikova.substack.com/p/gratitude-despite-the-odds"
              >Gratitude despite the odds</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-30 @ 08:16:24</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42280323"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42274266">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2411.18464"
              >Approximating Mathematical Constants Using Minecraft</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-29 @ 14:53:59</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42274266"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42272524">
          <h3>
            <a class="item" href="https://github.com/glojurelang/glojure"
              >Glojure: Clojure interpreter hosted on Go, with extensible
              interop support</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-29 @ 09:29:56</span
              ><span class="points-container"
                >Points: <span class="points">199</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42272524"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42265191">
          <h3>
            <a class="item" href="https://ificl.github.io/MultiFoley/"
              >Video-Guided Foley Sound Generation with Multimodal Controls</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-28 @ 13:44:36</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42265191"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
