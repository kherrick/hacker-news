<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36870702">
          <h3>
            <a class="item" href="https://www.seattleinprogress.com/"
              >Seattle in Progress</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 22:40:58</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36870702"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36870140">
          <h3>
            <a
              class="item"
              href="https://mcfunley.com/whom-the-gods-would-destroy-they-first-give-real-time-analytics"
              >Whom the gods would destroy, they first give real-time analytics
              (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 21:56:00</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36870140"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36869747">
          <h3>
            <a class="item" href="https://queue.acm.org/detail.cfm?id=3606027"
              >Stone knives and bear skins – there is no money in tools</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 21:18:45</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36869747"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36869486">
          <h3>
            <a class="item" href="https://www.mathematica-journal.com/"
              >The Mathematica Journal is no longer accepting submissions</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 21:02:32</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36869486"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36869457">
          <h3>
            <a
              class="item"
              href="https://jobs.lever.co/tesorio/10de016f-be07-4707-ac5c-7029f0398a17"
              >Tesorio (YC S15) Is Hiring a Head of Marketing – join our 100%
              remote startup</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 21:00:54</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36868978">
          <h3>
            <a class="item" href="https://github.com/veltman/clmystery"
              >A command-line murder mystery (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 20:33:39</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36868978"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36868940">
          <h3>
            <a
              class="item"
              href="https://blog.phronemophobic.com/treemaps-are-awesome.html"
              >Treemaps are awesome</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 20:31:12</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36868940"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36866861">
          <h3>
            <a class="item" href="https://github.com/PRQL/prql"
              >PRQL: Pipelined Relational Query Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 18:13:51</span
              ><span class="points-container"
                >Points: <span class="points">262</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36866861"
                  >Comments</a
                ><span class="descendants">: 137</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36866382">
          <h3>
            <a class="item" href="https://outland.art/harold-cohen-aaron/"
              >The Prophecies of AARON (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 17:48:02</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36866382"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36866242">
          <h3>
            <a class="item" href="https://thesephist.com/posts/hyperlink/"
              >Hyperlink maximalism (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 17:40:37</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36866242"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36865682">
          <h3>
            <a class="item" href="https://github.com/o8vm/octox"
              >Octox: Unix-like OS in Rust inspired by xv6-riscv</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 17:10:38</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36865682"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36865625">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36865625"
              >Launch HN: Roundtable (YC S23) – Using AI to Simulate Surveys</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 17:07:12</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36865625"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
            <div class="text">
              <a href="https://roundtable.ai/">https://roundtable.ai/</a>). We
              use LLMs to produce cheap, yet surprisingly useful, simulations of
              surveys. Specifically, we train LLMs on standard, curated survey
              datasets. This approach allows us to essentially build
              general-purpose models of human behavior and opinion. We combine
              this with a nice UI that lets users easily visualize and interpret
              the results.
              <p>
                Surveys are incredibly important for user and market research,
                but are expensive and take months to design, run, and analyze.
                By simulating responses, our users can get results in seconds
                and make decisions faster. See
                <a href="https://roundtable.ai/showcase"
                  >https://roundtable.ai/showcase</a
                >
                for a bunch of examples, and
                <a
                  href="https://www.loom.com/share/eb6fb27acebe48839dd561cf1546f131"
                  >https://www.loom.com/share/eb6fb27acebe48839dd561cf1546f131</a
                >
                for a demo video.
              </p>
              <p>
                Our product lets you add questions (e.g. “how old are you”) and
                conditions (e.g. “is a Hacker News user”) and then see how these
                affect the survey results. For example, the survey “Are you
                interested in buying an e-bike?” shows ‘yes’ 28% [1]. But if you
                narrow it down to people who own a Tesla, ‘yes’ jumps to 52%
                [2]. Another example: if you survey “where did you learn to
                code”, the question “how old are you?” makes a dramatic
                difference—for “45 or older” the answer is 55% “books” [3], but
                for “younger than 45” it’s 76% “online” [4]. One more: 5% of
                people answer “legroom” to the question “Which of the following
                factors is most important for choosing which airline to fly?”
                [5], and this jumps to 20% when you condition on people over six
                feet tall [6].
              </p>
              <p>
                You wouldn’t think (well, we didn’t think) that such simulated
                surveys would work very well, but empirically they work a lot
                better than expected—we have run many surveys in the wild to
                validate Roundtable's results (e.g. comparing age demographics
                to U.S. Census data). We’re still trying to figure out why. We
                believe that LLMs that are pre-trained on the public Internet
                have internalized a lot of information/correlations about
                communities (e.g. Tesla drivers, Hacker News, etc.) and can
                reasonably approximate their behavior. In any case, researchers
                are seeing the same things that we are. A nice paper by a BYU
                group [7] discusses extracting sub-population information from
                GPT/LLMs. A related paper from Microsoft [8] shows how GPT can
                simulate different human behaviors. It’s an active research
                topic, and we hope we can get a sense of the theoretical basis
                relatively soon.
              </p>
              <p>
                Because these models are primarily trained on Internet data,
                they start out skewed towards the demographics of heavy Internet
                users (e.g., high-income, male). We addressed this by
                fine-tuning GPT on the GSS (General Social Survey [9] - the gold
                standard of demographic surveys in the US) so our models emulate
                a more representative U.S. population.
              </p>
              <p>
                We’ve built a transparency feature that shows how similar your
                survey question is to the training data and thus gives a
                confidence metric of our accuracy. If you click ‘Investigate
                Results’, we report the most similar (in terms of cosine
                distance between LLM embeddings) GSS questions as a way of
                estimating how much extrapolation / interpolation is going on.
                This doesn’t quite address the accuracy of the subpopulations /
                conditioning questions (we are working on this), but we thought
                we are at a sufficiently advanced point to share what we’ve
                built with you all.
              </p>
              <p>
                We're graduating PhD students from Princeton University in
                cognitive science and AI. We ran a ton of surveys and behavioral
                experiments and were often frustrated with the pipeline. We were
                looking to leave academia, and saw an opportunity in making the
                survey pipeline better. User and market research is a big
                market, and many of the tools and methods the industry uses are
                clunky and slow. Mayank’s PhD work used large datasets and ML
                for developing interpretable scientific theories, and Matt’s
                developed complex experimental software to study coordinated
                group decision-making. We see Roundtable as operating at the
                intersection of our interests.
              </p>
              <p>
                We charge per survey. We are targeting small and mid-market
                businesses who have market research teams, and ask for a minimum
                subscription amount. Pricing is at the bottom of our home page.
              </p>
              <p>
                We are still in the early stages of building this product, and
                we’d love for you all to play around with the demo and provide
                us feedback. Let us know whatever you see - this is our first
                major endeavor into the private sector from academia, and we’re
                eager to hear whatever you have to say!
              </p>
              <p>
                [1]:
                <a
                  href="https://roundtable.ai/sandbox/e02e92a9ad20fdd517182788f4ae7e1f96a849c0"
                  >https://roundtable.ai/sandbox/e02e92a9ad20fdd517182788f4ae7e...</a
                >
              </p>
              <p>
                [2]:
                <a
                  href="https://roundtable.ai/sandbox/6b4bf8740ad1945b08c0bf584c84c1202a5fec53"
                  >https://roundtable.ai/sandbox/6b4bf8740ad1945b08c0bf584c84c1...</a
                >
              </p>
              <p>
                [3]
                <a
                  href="https://roundtable.ai/sandbox/d701556248385d05ce5d26ce7fc776bb4d32fad0"
                  >https://roundtable.ai/sandbox/d701556248385d05ce5d26ce7fc776...</a
                >
              </p>
              <p>
                [4]
                <a
                  href="https://roundtable.ai/sandbox/8bd80babad042cf60d500ca28c40f7db413f553a"
                  >https://roundtable.ai/sandbox/8bd80babad042cf60d500ca28c40f7...</a
                >
              </p>
              <p>
                [5]
                <a
                  href="https://roundtable.ai/sandbox/0450d499048c089894c34fba514db4042eafb6c0"
                  >https://roundtable.ai/sandbox/0450d499048c089894c34fba514db4...</a
                >
              </p>
              <p>
                [6]
                <a
                  href="https://roundtable.ai/sandbox/eeafc6de644632af303896ec19feb69ac4714e24"
                  >https://roundtable.ai/sandbox/eeafc6de644632af303896ec19feb6...</a
                >
              </p>
              <p>
                [7]
                <a href="https://arxiv.org/abs/2209.06899"
                  >https://arxiv.org/abs/2209.06899</a
                >
              </p>
              <p>
                [8]
                <a href="https://openreview.net/pdf?id=eYlLlvzngu"
                  >https://openreview.net/pdf?id=eYlLlvzngu</a
                >
              </p>
              <p>
                [9]
                <a href="https://www.norc.org/research/projects/gss.html"
                  >https://www.norc.org/research/projects/gss.html</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="36865495">
          <h3>
            <a class="item" href="https://replicate.com/blog/run-llama-locally"
              >Guide to running Llama 2 locally</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 16:58:42</span
              ><span class="points-container"
                >Points: <span class="points">212</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36865495"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36865287">
          <h3>
            <a
              class="item"
              href="https://mcilloni.ovh/2023/07/23/unicode-is-hard/"
              >Unicode is harder than you think</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 16:47:58</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36865287"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36865060">
          <h3>
            <a
              class="item"
              href="https://socket.dev/blog/social-engineering-campaign-npm-malware"
              >Social engineering campaign targeting tech employees spreads
              through NPM malware</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 16:35:47</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36865060"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36864624">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2307.12008"
              >The first room-temperature ambient-pressure superconductor?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 16:14:32</span
              ><span class="points-container"
                >Points: <span class="points">801</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36864624"
                  >Comments</a
                ><span class="descendants">: 520</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36863915">
          <h3>
            <a class="item" href="https://datatracker.ietf.org/doc/html/rfc9420"
              >The Messaging Layer Security (MLS) Protocol</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 15:38:41</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36863915"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36863581">
          <h3>
            <a
              class="item"
              href="https://astralcodexten.substack.com/p/were-not-platonists-weve-just-learned"
              >We're not Platonists, we've just learned the bitter lesson</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 15:17:45</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36863581"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36863522">
          <h3>
            <a class="item" href="https://onnxruntime.ai/"
              >ONNX runtime: Cross-platform accelerated machine learning</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 15:13:57</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36863522"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36862850">
          <h3>
            <a
              class="item"
              href="https://decrypt.co/149826/openai-quietly-shutters-its-ai-detection-tool"
              >OpenAI shuts down its AI Classifier due to poor accuracy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 14:34:17</span
              ><span class="points-container"
                >Points: <span class="points">359</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36862850"
                  >Comments</a
                ><span class="descendants">: 198</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36861302">
          <h3>
            <a class="item" href="https://ourworldofpixels.com/"
              >Our World of Pixels</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 12:33:01</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36861302"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36860898">
          <h3>
            <a class="item" href="https://invoicedragon.com/"
              >Show HN: Invoice Dragon – An open source app to create PDF
              invoices</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 11:45:06</span
              ><span class="points-container"
                >Points: <span class="points">441</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36860898"
                  >Comments</a
                ><span class="descendants">: 140</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36860488">
          <h3>
            <a class="item" href="https://arachnoid.com/freezone/"
              >The Internet Free Zone (1997)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 10:53:19</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36860488"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36859880">
          <h3>
            <a class="item" href="https://github.com/1j01/textual-paint"
              >Textual Paint – MS Paint in your terminal</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 09:20:50</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36859880"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36858076">
          <h3>
            <a
              class="item"
              href="https://www.digikey.com/en/articles/connector-tutorial"
              >Digikey's Physical Connectors Tutorial</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 04:57:45</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36858076"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36857314">
          <h3>
            <a
              class="item"
              href="https://infosec.exchange/@paco/110772422266480371"
              >Got called to a professor’s office after a complaint his SPARC4
              was running slow</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 03:00:26</span
              ><span class="points-container"
                >Points: <span class="points">792</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36857314"
                  >Comments</a
                ><span class="descendants">: 200</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36857069">
          <h3>
            <a
              class="item"
              href="https://docpop.org/2013/10/way-ahead-of-its-time-the-remote-lounge-nyc/"
              >Way ahead of its time: The Remote Lounge NYC</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 02:19:47</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36857069"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36849147">
          <h3>
            <a
              class="item"
              href="https://tidyfirst.substack.com/p/emotions-a-code-book"
              >Emotions: A Code Book</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 15:03:11</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36849147"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36844579">
          <h3>
            <a
              class="item"
              href="https://historyofinformation.com/detail.php?entryid=2359"
              >Codex Gigas: the largest manuscript of the middle ages</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 08:26:01</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36844579"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36843441">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Hallucinogenic_plants_in_Chinese_herbals"
              >Hallucinogenic Plants in Chinese Herbals</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 05:30:09</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36843441"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
