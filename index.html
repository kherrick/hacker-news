<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36986847">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/technology/2023/aug/02/ai-chatbot-training-human-toll-content-moderator-meta-openai"
              >Kenyan moderators decry toll of training of AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-03 @ 14:57:54</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36986847"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36986769">
          <h3>
            <a
              class="item"
              href="https://wiki.alopex.li/ElixirForCynicalCurmudgeons"
              >Elixir for Cynical Curmudgeons</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-03 @ 14:51:27</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36986769"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36985414">
          <h3>
            <a class="item" href="https://sethmlarson.dev/pep-440"
              >Quirks of Python package versioning</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-03 @ 13:11:38</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36985414"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36985384">
          <h3>
            <a class="item" href="https://github.com/stgraber/incus"
              >Canonical LXD forked by former project leader stgraber</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-03 @ 13:08:46</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36985384"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36985197">
          <h3>
            <a
              class="item"
              href="https://newsroom.ibm.com/2023-08-03-IBM-and-NASA-Open-Source-Largest-Geospatial-AI-Foundation-Model-on-Hugging-Face"
              >IBM and NASA Open Source Largest Geospatial AI Foundation Model
              on Hugging Face</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-03 @ 12:52:16</span
              ><span class="points-container"
                >Points: <span class="points">224</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36985197"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36985128">
          <h3>
            <a
              class="item"
              href="https://neurosciencenews.com/inflammation-brain-aging-23740/"
              >Taming the Flame of Aging: Key Pathway for Chronic Inflammation
              Revealed</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-03 @ 12:46:41</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36985128"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36984869">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41586-023-06330-y"
              >Quantum oscillations of the quasiparticle lifetime in a metal</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-03 @ 12:23:41</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36984869"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36984695">
          <h3>
            <a class="item" href="https://stitcher.io/blog/dont-be-clever"
              >Don't Be Clever</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-03 @ 12:08:48</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36984695"
                  >Comments</a
                ><span class="descendants">: 111</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36984692">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/the-cloud-is-a-prison-can-the-local-first-software-movement-set-us-free/"
              >The cloud is a prison. can the local-first software movement set
              us free?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-03 @ 12:08:17</span
              ><span class="points-container"
                >Points: <span class="points">160</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36984692"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36984623">
          <h3>
            <a class="item" href="https://up.codes/careers"
              >UpCodes (YC S17) is hiring engineers to automate construction
              compliance</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-03 @ 12:01:40</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36984611">
          <h3>
            <a
              class="item"
              href="https://www.pola.rs/posts/company-announcement/"
              >Polars: Company Formation Announcement</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-03 @ 12:00:33</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36984611"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36984530">
          <h3>
            <a
              class="item"
              href="https://bobcopeland.com/blog/2012/10/goto-in-bash/"
              >Goto in Bash (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-03 @ 11:53:35</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36984530"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36984419">
          <h3>
            <a
              class="item"
              href="https://twitter.com/eastdakota/status/1686927537740611584"
              >“1.1.1.1 is now handling more than 1.3T requests per day”</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-03 @ 11:42:43</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36984419"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36984302">
          <h3>
            <a
              class="item"
              href="https://krebsonsecurity.com/2023/08/how-malicious-android-apps-slip-into-disguise/"
              >Malicious Android Apps Slip into Disguise</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-03 @ 11:31:10</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36984302"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36984282">
          <h3>
            <a class="item" href="https://taylor.town/entire-career"
              >Man spends entire career mastering crappy codebase</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-03 @ 11:28:31</span
              ><span class="points-container"
                >Points: <span class="points">664</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36984282"
                  >Comments</a
                ><span class="descendants">: 448</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36984171">
          <h3>
            <a
              class="item"
              href="https://www.destroyallsoftware.com/compendium/network-protocols?share_key=97d3ba4c24d21147"
              >Network protocols for anyone who knows a programming language</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-03 @ 11:14:12</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36984171"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36984071">
          <h3>
            <a class="item" href="https://briefcase.readthedocs.io/en/stable/"
              >Briefcase: Convert a Python project into a standalone native
              application</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-03 @ 11:01:34</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36984071"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36983702">
          <h3>
            <a
              class="item"
              href="https://twitter.com/lmsysorg/status/1686794639469371393"
              >Vicuna v1.5 series, featuring 4K and 16K context, based on Llama
              2</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-03 @ 10:05:55</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36983702"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36982960">
          <h3>
            <a
              class="item"
              href="https://cofense.com/blog/google-amp-the-newest-of-evasive-phishing-tactic/"
              >Google AMP – The Newest of Evasive Phishing Tactic</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-03 @ 08:29:14</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36982960"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36982856">
          <h3>
            <a
              class="item"
              href="https://erynwells.me/blog/2023/08/netscape-meteors/"
              >Netscape Meteors</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-03 @ 08:17:44</span
              ><span class="points-container"
                >Points: <span class="points">221</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36982856"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36982813">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/blog-post/new-mode-cancer-treatment"
              >A New Mode of Cancer Treatment</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-03 @ 08:12:15</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36982813"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36982507">
          <h3>
            <a
              class="item"
              href="https://mastodon.social/@nekohayo/110775656176571435"
              >A list of recent hostile moves by Google's Chrome team</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-03 @ 07:27:18</span
              ><span class="points-container"
                >Points: <span class="points">794</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36982507"
                  >Comments</a
                ><span class="descendants">: 469</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36981580">
          <h3>
            <a
              class="item"
              href="https://eclecticlight.co/2023/07/29/system-settings-that-arent-in-system-settings/"
              >System settings that aren’t in System Settings</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-03 @ 05:01:47</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36981580"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36981090">
          <h3>
            <a
              class="item"
              href="https://support.twilio.com/hc/en-us/articles/8360406023067-SMS-Traffic-Pumping-Fraud"
              >SMS traffic pumping fraud</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-03 @ 03:42:11</span
              ><span class="points-container"
                >Points: <span class="points">186</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36981090"
                  >Comments</a
                ><span class="descendants">: 130</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36979886">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2308.01192"
              >Observation of zero resistance above 100 K in Pb₁₀₋ₓCuₓ(PO₄)₆O</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-03 @ 00:43:14</span
              ><span class="points-container"
                >Points: <span class="points">693</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36979886"
                  >Comments</a
                ><span class="descendants">: 312</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36970135">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36970135"
              >Launch HN: Certainly Health (YC S23) – Book doctors without
              surprise bills</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-02 @ 12:45:59</span
              ><span class="points-container"
                >Points: <span class="points">174</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36970135"
                  >Comments</a
                ><span class="descendants">: 128</span></span
              >
            </h4>
            <div class="text">
              <a href="https://certainlyhealth.com/"
                >https://certainlyhealth.com/</a
              >), a marketplace that lets you shop for doctors and compare your
              out-of-pocket costs upfront (currently only in NYC). Using each
              patient's insurance and machine learning, we predict and guarantee
              out-of-pocket costs to prevent surprise bills.
              <p>
                We grew up in immigrant families, and for both of us, our
                parents would honestly tell us to not trust doctors because of
                unexpected medical bills. They really believed that doctors were
                adding on unnecessary things that didn’t help in order to make
                more money. As adults, we’ve both had first-hand experiences
                receiving surprise bills even with good insurance while working
                at tech companies, so solving this problem is personal to us.
              </p>
              <p>
                It turns out 38% of Americans delay medical care for fear of the
                bill while prices vary 2-10x across health providers, even when
                using insurance. This led us to believe that creating a
                marketplace with transparent out-of-pocket costs could be a
                solution.
              </p>
              <p>
                However, it wasn’t until the July 2022 Transparency in Coverage
                Rule (<a
                  href="https://www.cms.gov/healthplan-price-transparency"
                  >https://www.cms.gov/healthplan-price-transparency</a
                >) that we had the payer pricing data (that’s actually high
                quality compared to hospital data) to create this marketplace.
                Certainly is the first company to use this data to predict and
                guarantee prices for consumers to book doctors.
              </p>
              <p>
                We know the HN community has been interested in applications of
                healthcare price transparency data (<a
                  href="https://news.ycombinator.com/item?id=32738783"
                  >https://news.ycombinator.com/item?id=32738783</a
                >), so we’re excited to share how we’re using this data to
                predict and guarantee prices for a consumer application.
              </p>
              <p>
                With Certainly, patients can enter their insurance, compare
                guaranteed out-of-pocket costs across doctors, and book an
                appointment with price transparency. For providers, we guarantee
                any patient we send them will always pay. Partner providers pay
                us any time we send them a new patient. Eventually, we’ll
                convert providers to using our SaaS platform to guarantee
                payments from existing patients.
              </p>
              <p>
                We are currently focused on shoppable services - anything that
                can be scheduled in advance. Our solution falls between two ends
                of the spectrum for consumer shopping experiences. At one end is
                healthcare, where the status quo is you go to a doctor and you
                have no idea what will happen and you have no idea how much it
                will cost. At the other end is going to a restaurant, having a
                menu of items with corresponding prices, and deciding which
                items you want to order.
              </p>
              <p>
                Certainly Health lets you see what services could happen during
                your visit and how much they will cost. We guarantee that if
                those services happen, you will not pay more than the
                out-of-pocket costs you saw upfront for each of those services.
                But it is ultimately the doctor who decides which services you
                end up getting (like a chef deciding which dishes you will be
                served). As a result, you can compare upfront out-of-pocket
                costs specific to your insurance and book a provider without
                worrying about surprise bills.
              </p>
              <p>
                A common misconception is that patient out-of-pocket costs are
                set by doctors. Prices of healthcare services are actually the
                result of negotiations between providers and insurance
                companies. Groups with more negotiating power, like large
                hospital systems, are able to command higher rates than private
                practice physicians. This variance in cost is enormous across
                almost all procedures we've looked at, even between providers a
                few blocks from each other. It might cost $105 to get an
                orthopedic consultation with one doctor, and $550 to get a
                consultation with another doctor across the street, for example.
                This price variance means the out-of-pocket cost also varies for
                patients with high deductible plans or plans where the copay
                does not cover all services (which we’ve encountered very
                often).
              </p>
              <p>
                We do not use hospital price data which is inconsistent and
                messy (<a
                  href="https://www.kff.org/health-costs/press-release/analysis-inconsistencies-within-hospital-price-transparency-data-make-cost-comparisons-difficult/"
                  >https://www.kff.org/health-costs/press-release/analysis-inco...</a
                >). Instead, our guaranteed prices are based on three things:
                (1) health insurance published rates for procedures, as required
                by regulation; (2) patient eligibility/benefits information
                (e.g. deductible, copay, coinsurance); and (3) an online
                learning model to account for variance across thousands of plans
                and patient conditions.
              </p>
              <p>
                As we process payments and claims, we create an accurate
                platform for predicting out-of-pocket costs by accounting for
                variations such as whether certain procedures are covered by an
                insurance plan/copay, and how the rate changes based on
                diagnosis code (we discovered V97.33XD is for "Sucked into jet
                engine, subsequent encounter”), number of units, medical coding
                modifiers, and other factors.
              </p>
              <p>
                Certainly is currently available in NYC where you can choose
                from over 5k doctors to book without surprise bills for free at
                <a href="https://certainlyhealth.com/"
                  >https://certainlyhealth.com/</a
                >. We plan to expand to other cities once we prove that we can
                establish a low CAC on both the supply and demand sides in NYC.
              </p>
              <p>
                Although we’re early, we’re starting to see intended results.
                One patient saved $850 on a podiatrist visit booked through us
                compared to a previous visit with a different doctor for the
                exact same services. Another was charged for an annual physical,
                but we identified the mistake and got a refund issued to him.
                Most of our customers have had surprise bills in the past and
                are happy to have peace of mind with our upfront, guaranteed
                prices.
              </p>
              <p>
                We’d love to hear your ideas, experiences, feedback and any
                feature requests!
              </p>
            </div>
          </section>
        </section>
        <section id="36967413">
          <h3>
            <a class="item" href="https://tidalcycles.org/"
              >Tidal Cycles – Live coding music with Algorithmic patterns</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-02 @ 05:53:18</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36967413"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36967094">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/smart-news/remains-of-chihuahua-sized-dog-unearthed-at-roman-britain-villa-180982624/"
              >Remains of Chihuahua-Sized Dog Unearthed at Roman Britain
              Villa</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-02 @ 04:52:55</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36967094"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36963190">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/07/17/science/benjamin-franklin-counterfeit-currency.html"
              >What Benjamin Franklin Learned While Fighting Counterfeiters</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-01 @ 21:23:33</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36963190"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36954934">
          <h3>
            <a
              class="item"
              href="https://hackaday.com/2023/08/01/pixel-pump-the-open-source-vacuum-pickup-tool-is-now-shipping/"
              >Pixel Pump: Open-source vacuum pickup tool</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-01 @ 12:02:03</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36954934"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
