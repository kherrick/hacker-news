<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38021461">
          <h3>
            <a class="item" href="https://github.com/instant-dev/api"
              >Show HN: Instant API – Build type-safe web APIs with
              JavaScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 04:00:22</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38021461"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
            <div class="text">
              <p>
                This eliminates the need for most schema validation libraries,
                automates user input sanitization, and prevents your team from
                developing carpal tunnel syndrome trying to keep your OpenAPI /
                Swagger specifications up-to-date. We developed it as a side
                effect of building our own serverless API platform, where it has
                scaled to handle over 100M requests from users per day. This is
                an early release, but Instant API has had about six years of
                consistent development as proprietary software to get to the
                point it is at today. We have spent the last couple of months
                modernizing it.
              </p>
              <p>
                We have command line tools that make building, testing, and
                deploying Instant API to Vercel or AWS a breeze. Additionally,
                there is a sister package, Instant ORM, that provides a Ruby on
                Rails-like model management, migration and querying suite for
                Postgres. Everything you need to build an API from scratch.
              </p>
              <p>
                Finally -- LLMs and chatbots are the the top of the hype cycle
                right now. We aren't immune, and have developed a number of
                LLM-integrated tools ourselves. Instant API comes with
                first-class Server-Sent Event support for building your own
                assistants and a few other nifty tools that help with AI
                integrations and chatbot webhook responses, like executing
                endpoints as background jobs.
              </p>
              <p>
                This has been a huge labor of love -- it has become our
                "JavaScript on Rails" suite -- and we hope y'all enjoy it!
              </p>
            </div>
          </section>
        </section>
        <section id="38021347">
          <h3>
            <a
              class="item"
              href="https://www.netgate.com/blog/addressing-changes-to-pfsense-plus-homelab"
              >Addressing Changes to PfSense Plus Home+Lab</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 03:36:43</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38021347"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38020792">
          <h3>
            <a class="item" href="https://research.swtch.com/nih"
              >Running the "Reflections on Trusting Trust" Compiler</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 01:57:14</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38020792"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38020308">
          <h3>
            <a
              class="item"
              href="https://blogs.bl.uk/digitisedmanuscripts/2023/10/chaucers-works-go-online.html"
              >Chaucer's works go online</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 00:48:20</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38020308"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38020109">
          <h3>
            <a
              class="item"
              href="https://jina.ai/news/jina-ai-launches-worlds-first-open-source-8k-text-embedding-rivaling-openai/"
              >Jina AI launches open-source 8k text embedding</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-26 @ 00:24:41</span
              ><span class="points-container"
                >Points: <span class="points">343</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38020109"
                  >Comments</a
                ><span class="descendants">: 124</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38019231">
          <h3>
            <a
              class="item"
              href="https://jsoverson.medium.com/was-rust-worth-it-f43d171fb1b3"
              >Was Rust Worth It?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 22:37:06</span
              ><span class="points-container"
                >Points: <span class="points">317</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38019231"
                  >Comments</a
                ><span class="descendants">: 443</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38018917">
          <h3>
            <a
              class="item"
              href="https://manas.tech/blog/2023/10/25/approaching-unconventional-problems/"
              >How to find a lost phone in a no-cell-coverage camping site?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 21:58:02</span
              ><span class="points-container"
                >Points: <span class="points">246</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38018917"
                  >Comments</a
                ><span class="descendants">: 161</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38017831">
          <h3>
            <a class="item" href="https://www.stairways.com/press/2023-10-24"
              >Keyboard Maestro 11</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 20:22:42</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38017831"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38017446">
          <h3>
            <a
              class="item"
              href="https://idl.cs.washington.edu/papers/living-papers/"
              >Living Papers: A Language Toolkit for Augmented Scholarly
              Communication</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 19:55:32</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38017446"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38017146">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-023-03272-3"
              >AI 'breakthrough': neural net has human-like ability to
              generalize language</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 19:28:45</span
              ><span class="points-container"
                >Points: <span class="points">173</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38017146"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38017049">
          <h3>
            <a
              class="item"
              href="https://theconversation.com/what-are-roundabouts-a-transportation-engineer-explains-the-safety-benefits-of-these-circular-intersections-215412"
              >Safety benefits of roundabouts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 19:20:59</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38017049"
                  >Comments</a
                ><span class="descendants">: 299</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38016930">
          <h3>
            <a
              class="item"
              href="https://buttondown.email/jaffray/archive/the-case-of-a-curious-sql-query/"
              >The Case of a Curious SQL Query</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 19:10:08</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38016930"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38016849">
          <h3>
            <a
              class="item"
              href="https://nandovillalba.medium.com/why-i-think-gcp-is-better-than-aws-ea78f9975bda"
              >I think GCP is better than AWS (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 19:01:54</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38016849"
                  >Comments</a
                ><span class="descendants">: 323</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38015277">
          <h3>
            <a class="item" href="https://ileakage.com/"
              >iLeakage: Browser-Based Timerless Speculative Execution Attacks
              on Apple Devices</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 17:15:49</span
              ><span class="points-container"
                >Points: <span class="points">503</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38015277"
                  >Comments</a
                ><span class="descendants">: 188</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38015169">
          <h3>
            <a
              class="item"
              href="https://www.ucdavis.edu/climate/news/adding-crushed-rock-farmland-pulls-carbon-out-air"
              >Adding crushed rock to farmland pulls carbon out of the air</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 17:08:58</span
              ><span class="points-container"
                >Points: <span class="points">242</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38015169"
                  >Comments</a
                ><span class="descendants">: 249</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38015038">
          <h3>
            <a
              class="item"
              href="https://underjord.io/unpacking-elixir-observability.html"
              >Unpacking Elixir: Observability</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 17:01:12</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38015038"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38014835">
          <h3>
            <a class="item" href="https://reactagent.io/"
              >ReactAgent: LLM Agent for React Coding</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 16:46:59</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38014835"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38013955">
          <h3>
            <a
              class="item"
              href="https://www.faa.gov/space/stakeholder_engagement/spacex_starship"
              >SpaceX Starship Super Heavy Project at the Boca Chica Launch
              Site</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 15:39:17</span
              ><span class="points-container"
                >Points: <span class="points">162</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38013955"
                  >Comments</a
                ><span class="descendants">: 509</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38012032">
          <h3>
            <a
              class="item"
              href="https://github.com/AndrewWalsh/openapi-devtools"
              >Show HN: OpenAPI DevTools – Chrome extension that generates an
              API spec</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 12:24:19</span
              ><span class="points-container"
                >Points: <span class="points">730</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38012032"
                  >Comments</a
                ><span class="descendants">: 96</span></span
              >
            </h4>
            <div class="text">
              Effortlessly discover API behaviour with a Chrome extension that
              automatically generates OpenAPI specifications in real time for
              any app or website.
            </div>
          </section>
        </section>
        <section id="38010992">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=38010992"
              >Ask HN: PG's 'Do Things That Don't Scale' manual examples?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 09:37:24</span
              ><span class="points-container"
                >Points: <span class="points">291</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38010992"
                  >Comments</a
                ><span class="descendants">: 224</span></span
              >
            </h4>
            <div class="text">
              In PG's essay he talks about manually doing what you later plan to
              automate and gives the example of stripe manually onboarding
              startups. Does anyone else have other examples?
            </div>
          </section>
        </section>
        <section id="38009291">
          <h3>
            <a
              class="item"
              href="https://salt.security/blog/oh-auth-abusing-oauth-to-take-over-millions-of-accounts"
              >Oh-Auth – Abusing OAuth to take over millions of accounts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 04:57:08</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38009291"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38007648">
          <h3>
            <a
              class="item"
              href="http://strangeco.blogspot.com/2023/10/the-first-american-murder.html"
              >The First American Murder</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-25 @ 00:28:29</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38007648"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38006879">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-10-drought-brazil-amazon-reveals-ancient.html"
              >Drought in Brazil's Amazon reveals ancient engravings</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 23:01:28</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38006879"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38004962">
          <h3>
            <a
              class="item"
              href="https://publicdomainreview.org/collection/the-book-of-halloween/"
              >A Melting Cauldron: The Book of Hallowe'en (1919)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 20:24:36</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38004962"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38002752">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/business/autos-transportation/california-suspends-gm-cruises-driverless-autonomous-vehicle-permits-2023-10-24/"
              >California suspends Cruise's autonomous vehicle deployment</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 17:55:33</span
              ><span class="points-container"
                >Points: <span class="points">1148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38002752"
                  >Comments</a
                ><span class="descendants">: 1202</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38000573">
          <h3>
            <a
              class="item"
              href="https://resobscura.substack.com/p/simulating-history-with-multimodal"
              >Simulating History with Multimodal AI: An Update</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 15:32:12</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38000573"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37997940">
          <h3>
            <a
              class="item"
              href="https://www.anandtech.com/show/21104/samsung-announces-shinebolt-hbm3e-memory-hbm-hits-36gb-stacks-at-98-gbps"
              >Samsung announces 'Shinebolt' HBM3E memory</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 12:06:16</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37997940"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37997744">
          <h3>
            <a class="item" href="https://nautil.us/mirror-image-life-412729/"
              >Mirror-Image Life</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 11:47:05</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37997744"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37997282">
          <h3>
            <a
              class="item"
              href="https://www.ilograph.com/architecture-center/index.html"
              >Ilograph Architecture Center</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 11:02:35</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37997282"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37995062">
          <h3>
            <a
              class="item"
              href="https://www.techenhancedlife.com/articles/making-tv-useful-my-94-yr-old-aunt"
              >Making TV Useful For My 94-yr-old Aunt</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-24 @ 05:19:22</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37995062"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
