<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36223766">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36223766"
              >Aptible (YC S14) Is Hiring: Security Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-07 @ 07:01:03</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
            <div class="text">
              <p>
                <a href="https://www.aptible.com/culture-hub/careers"
                  >https://www.aptible.com/culture-hub/careers</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="36223307">
          <h3>
            <a
              class="item"
              href="https://www.stockperformer.com/blog/is-ai-killing-the-stock-industry-a-data-perspective/"
              >Is AI killing the stock photo industry? A data perspective</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-07 @ 05:45:07</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36223307"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36223283">
          <h3>
            <a
              class="item"
              href="https://danlark.org/2023/06/06/csinc-the-arm-instruction-you-didnt-know-you-wanted/"
              >“csinc”, the AArch64 instruction you didn’t know you wanted</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-07 @ 05:41:59</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36223283"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36222769">
          <h3>
            <a
              class="item"
              href="https://www.construction-physics.com/p/the-birth-of-the-grid"
              >The Birth of the Grid</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-07 @ 04:18:42</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36222769"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36222625">
          <h3>
            <a
              class="item"
              href="https://thequantuminsider.com/2023/06/06/royal-navy-says-quantum-navigation-test-a-success/"
              >Royal Navy says quantum navigation test a success</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-07 @ 03:52:48</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36222625"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36222266">
          <h3>
            <a
              class="item"
              href="https://twitter.com/andytizer/status/1666131239575728130"
              >DirectX 12 Support on macOS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-07 @ 02:49:26</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36222266"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36221534">
          <h3>
            <a class="item" href="https://github.com/Rikorose/DeepFilterNet"
              >DeepFilterNet: Noise supression using deep filtering</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-07 @ 01:20:08</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36221534"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36221010">
          <h3>
            <a
              class="item"
              href="https://www.micahlerner.com/2023/04/16/telamalloc-efficient-on-chip-memory-allocation-for-production-machine-learning-accelerators.html"
              >TelaMalloc: Efficient On-Chip Memory Allocation for Production ML
              Accelerators</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-07 @ 00:19:19</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36221010"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36219585">
          <h3>
            <a class="item" href="https://notes.andymatuschak.org/Vision%20Pro"
              >Notes on Vision Pro</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 21:55:05</span
              ><span class="points-container"
                >Points: <span class="points">334</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36219585"
                  >Comments</a
                ><span class="descendants">: 323</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36219181">
          <h3>
            <a
              class="item"
              href="https://github.com/apple/swift/blob/main/docs/OwnershipManifesto.md"
              >Ownership in Swift: Manifesto and meta-proposal (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 21:12:03</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36219181"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36218281">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/information-technology/2023/06/redditor-creates-working-anime-qr-codes-using-stable-diffusion/"
              >Redditor creates working anime QR codes using Stable Diffusion</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 19:55:58</span
              ><span class="points-container"
                >Points: <span class="points">408</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36218281"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36217098">
          <h3>
            <a
              class="item"
              href="https://felt.com/blog/svg-to-canvas-part-2-building-interactions"
              >From SVG to Canvas – A new way of building interactions</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 18:29:10</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36217098"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36216745">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/world/2023/jun/06/whistleblower-ufo-alien-tech-spacecraft"
              >US urged to reveal UFO evidence after claim that it has intact
              alien vehicles</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 18:04:52</span
              ><span class="points-container"
                >Points: <span class="points">419</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36216745"
                  >Comments</a
                ><span class="descendants">: 768</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36216532">
          <h3>
            <a class="item" href="https://github.com/princeton-nlp/MeZO"
              >MeZO: Fine-Tuning Language Models with Just Forward Passes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 17:49:06</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36216532"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36215924">
          <h3>
            <a
              class="item"
              href="https://sod.pixlab.io/articles/modern-image-processing-algorithms-implementation.html"
              >Modern Image Processing Algorithms Implementation in C</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 17:07:43</span
              ><span class="points-container"
                >Points: <span class="points">175</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36215924"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36215651">
          <h3>
            <a class="item" href="http://ggml.ai">GGML – AI at the Edge</a>
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 16:50:34</span
              ><span class="points-container"
                >Points: <span class="points">733</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36215651"
                  >Comments</a
                ><span class="descendants">: 191</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36215357">
          <h3>
            <a
              class="item"
              href="https://developer.apple.com/documentation/SwiftData"
              >SwiftData</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 16:33:25</span
              ><span class="points-container"
                >Points: <span class="points">177</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36215357"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36215088">
          <h3>
            <a class="item" href="https://github.com/splitgraph/seafowl-gcsfuse"
              >Show HN: Serverless OLAP with Seafowl and GCP</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 16:18:44</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36215088"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <p>
                A recurring problem I've faced with side projects is the need
                for Postgres, but no desire to deploy or maintain new instances.
                So when I learned GCP's "always free" tier includes serverless
                [1] I got curious to see if I could run a database.
              </p>
              <p>
                While a lot of classic databases aren't usually a great fit for
                serverless, Seafowl separates compute, storage and catalog
                (catalog == a SQLite file of metadata). [2] Last month I was
                able to introduce GCS bucket compat to Seafowl, which enabled me
                to mount the catalog via gcsfuse (i.e. an adapter that allows
                attaching GCS buckets to local filesystems). Upshot: while FUSE
                does add HTTP requests to container startup, init time remains
                comparatively quick, even cold starts, because fetching is
                limited to the single catalog SQLite file only.
              </p>
              <p>
                With this approach you get a URL you can query directly from
                your FE if you want, e.g. fetch() can send SELECT * ... queries
                straight from your users' browser. You could plot a graph from a
                static React frontend, or observablehq.com editor, with no
                persistent backend needed. So at times when nobody's using your
                app, 100% of your stack can scale to zero with obvious cloud
                spend advantages. And even if you exceed free tier limits, being
                PAYG offers a good chance you'll come out ahead on hosting costs
                anyway.
              </p>
              <p>
                NB: Seafowl is an early stage project, so it's not really
                suitable if you need transactions or fast single-row writes.
                Otherwise, this could be a nice way to get free database hosting
                at a big 3 cloud provider, especially for e.g. read-only
                analytical reporting queries.
              </p>
              <p>
                Feedback and suggestions are appreciated. Hope it helps you!
                More available if you want [3].
              </p>
              <p>
                [0]
                <a href="https://seafowl.io/docs/getting-started/introduction"
                  >https://seafowl.io/docs/getting-started/introduction</a
                >
              </p>
              <p>
                [1]
                <a href="https://cloud.google.com/run/pricing#cpu-requests"
                  >https://cloud.google.com/run/pricing#cpu-requests</a
                >
              </p>
              <p>
                [2] Neon is another interesting project that separates compute
                and storage.
                <a href="https://neon.tech/blog/architecture-decisions-in-neon"
                  >https://neon.tech/blog/architecture-decisions-in-neon</a
                >
              </p>
              <p>
                One issue I observed was a noticeably longer startup time vs
                this FUSE approach, which I believe may be related to Postgres
                connection setup time/roundtrips. Looking forward to trying Neon
                again in future.
              </p>
              <p>
                [3]
                <a
                  href="https://www.splitgraph.com/blog/deploying-serverless-seafowl"
                  >https://www.splitgraph.com/blog/deploying-serverless-seafowl</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="36214781">
          <h3>
            <a
              class="item"
              href="https://pmarca.substack.com/p/why-ai-will-save-the-world"
              >AI will save the world?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 15:56:55</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36214781"
                  >Comments</a
                ><span class="descendants">: 281</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36214490">
          <h3>
            <a
              class="item"
              href="https://worldsensorium.com/bees-can-learn-remember-think-and-make-decisions/"
              >Bees can learn, remember, think and make decisions</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 15:37:54</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36214490"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36214478">
          <h3>
            <a
              class="item"
              href="https://nautil.us/the-mystery-of-the-largest-light-in-the-sea-308189/"
              >A species of deep-sea squid has the world’s biggest
              light-producing organs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 15:37:09</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36214478"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36214084">
          <h3>
            <a
              class="item"
              href="https://commoncog.com/how-first-principles-thinking-fails/"
              >When First Principles Thinking Fails</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 15:14:24</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36214084"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36212903">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36212903"
              >Launch HN: Seam (YC S20) – API for IoT Devices</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 14:00:21</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36212903"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.seam.co">https://www.seam.co</a>), a
              universal API for controlling IoT devices such as smart locks,
              thermostats, sensors, and (soon) cameras. Our hope is to make
              device integration simple, with a Plaid-like UI flow for obtaining
              device authorization and standardized API/SDKs for device control.
              <p>
                We started Seam out of our frustration with the challenges of
                integrating IoT devices with software apps.
              </p>
              <p>
                For example, my co-founder Dawn led Sonder's efforts to
                integrate smartlocks with their reservation systems in order to
                automate access for guests. She struggled with poorly documented
                and unreliable device APIs along the way. Our founding engineer
                Max authored the popular TuyAPI library and has spent countless
                hours trying to build sensible interfaces on top of unreliable
                devices.
              </p>
              <p>
                For my part, I was an early engineer at Nest and saw firsthand
                how manufacturers often lack the resources and motivation to
                support third-party developers.
              </p>
              <p>
                As a result, most devices lack public APIs, and getting access
                to the private ones (if they exist) requires lengthy
                negotiations with manufacturers. This task grows in complexity
                with each additional device brand a developer may need to
                integrate.
              </p>
              <p>
                Seam serves as a single API that works across dozens of brands
                and hundreds of devices.
              </p>
              <p>
                We start by testing each device in our hardware lab in San
                Francisco. We study their behaviors &amp; quirks, and faithfully
                reproduce those in our development sandbox. We take time to
                craft custom client libraries that maximize developer ergonomics
                while accounting for the asynchronous nature of the devices. We
                offer pre-built UI components (React, Web-native…etc) to let
                developers rapidly assemble complex UIs that can manage large
                fleets of devices. And we even have a small hardware gateway to
                connect on-prem and legacy devices.
              </p>
              <p>
                A few app developers like Guesty (YC S14) already use Seam to
                connect to their end users’ devices. We have a generous free
                tier and charge a small fee for additional devices. We work
                closely with manufacturers to improve device reliability, add
                OAuth support, and patch security holes. We also spend time
                educating them on the importance of supporting open source
                projects like Home Assistant, OpenHab...etc and we will be
                contributing some of our own integrations to those ecosystems.
              </p>
              <p>
                Seam is still very much a work in progress with many aspects
                that need to be improved. But our hope is that it will help push
                IoT devices from being (mostly) point solutions, to becoming a
                set of API endpoints software engineers can tap to interact with
                the physical world.
              </p>
            </div>
          </section>
        </section>
        <section id="36212674">
          <h3>
            <a
              class="item"
              href="https://asahilinux.org/2023/06/opengl-3-1-on-asahi-linux/"
              >OpenGL 3.1 on Asahi Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 13:46:13</span
              ><span class="points-container"
                >Points: <span class="points">468</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36212674"
                  >Comments</a
                ><span class="descendants">: 277</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36211381">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/first-year-graduate-finds-paradoxical-number-set-20230605/"
              >First-year graduate student finds paradoxical set</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 12:04:41</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36211381"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36211004">
          <h3>
            <a
              class="item"
              href="https://www.nativeseeds.org/blogs/blog-news/how-to-grow-a-three-sisters-garden"
              >How to Grow a Three Sisters Garden (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 11:18:47</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36211004"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36210599">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=Cmh1EHXjJsk"
              >The History of CUDA</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 10:23:51</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36210599"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36209955">
          <h3>
            <a class="item" href="https://github.com/kdave/btrfsmaintenance"
              >Scripts for Btrfs Maintenance</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 08:46:22</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36209955"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36208942">
          <h3>
            <a class="item" href="https://jonbarron.info/zipnerf/"
              >Zip-NeRF: Anti-Aliased Grid-Based Neural Radiance Fields</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-06 @ 06:32:58</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36208942"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36193315">
          <h3>
            <a class="item" href="https://github.com/reactive-python/reactpy"
              >React, but in Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-05 @ 07:02:21</span
              ><span class="points-container"
                >Points: <span class="points">227</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36193315"
                  >Comments</a
                ><span class="descendants">: 133</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
