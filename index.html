<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="35899527">
          <h3>
            <a
              class="item"
              href="https://lore.kernel.org/lkml/20230509165657.1735798-1-kent.overstreet@linux.dev/T/#mf171fd06ffa420fe1bcf0f49a2b44a361ca6ac44"
              >Bcachefs – A New COW Filesystem</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 08:50:26</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35899527"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35897146">
          <h3>
            <a
              class="item"
              href="https://info.computerhistory.org/xerox-parc-archive"
              >The Xerox PARC Archive</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 03:46:55</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35897146"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35896954">
          <h3><a class="item" href="https://gowithphp.com/">Go with PHP</a></h3>
          <section>
            <h4>
              <span>2023-05-11 @ 03:23:16</span
              ><span class="points-container"
                >Points: <span class="points">264</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35896954"
                  >Comments</a
                ><span class="descendants">: 258</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35896505">
          <h3>
            <a
              class="item"
              href="https://github.com/yashash-pugalia/win11-svelte"
              >Windows 11 in Svelte</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 02:17:31</span
              ><span class="points-container"
                >Points: <span class="points">285</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35896505"
                  >Comments</a
                ><span class="descendants">: 158</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35896240">
          <h3>
            <a class="item" href="https://technicshistory.com/the-backbone/"
              >The Backbone: A History of the Internet</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 01:44:37</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35896240"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35896190">
          <h3>
            <a
              class="item"
              href="https://twitter.com/paulg/status/1655925905527537666"
              >When you lose the ability to write, you also lose some of your
              ability to think</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 01:39:24</span
              ><span class="points-container"
                >Points: <span class="points">357</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35896190"
                  >Comments</a
                ><span class="descendants">: 231</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35896176">
          <h3>
            <a
              class="item"
              href="https://cloud.google.com/blog/products/maps-platform/create-immersive-3d-map-experiences-photorealistic-3d-tiles"
              >Google Earth 3D Models Now Available as Open Standard (GlTF)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 01:37:16</span
              ><span class="points-container"
                >Points: <span class="points">261</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35896176"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35895840">
          <h3>
            <a
              class="item"
              href="https://github.com/supertokens/supertokens-core"
              >Supertokens: Open-Source Alternative to Auth0 / Firebase Auth /
              AWS Cognito</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 00:54:22</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35895840"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35895417">
          <h3>
            <a
              class="item"
              href="https://hms.harvard.edu/news/scientists-regenerate-hair-cells-enable-hearing"
              >Scientists regenerate hair cells that enable hearing</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-11 @ 00:08:39</span
              ><span class="points-container"
                >Points: <span class="points">211</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35895417"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35894987">
          <h3>
            <a class="item" href="http://www.geektools.com/"
              >Geektools whois gateway has shut down after a 25-year run</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 23:26:22</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35894987"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35894326">
          <h3>
            <a class="item" href="https://news.ycombinator.com/y18.svg"
              >Tell HN: The “Y” logo in the top-left corner has been upgraded to
              SVG</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 22:26:52</span
              ><span class="points-container"
                >Points: <span class="points">437</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35894326"
                  >Comments</a
                ><span class="descendants">: 175</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35894004">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/05/10/us/heather-armstrong-dead.html"
              >Heather Armstrong has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 21:51:21</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35894004"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35893952">
          <h3>
            <a
              class="item"
              href="https://emergencemagazine.org/essay/creatures-that-dont-conform/"
              >Creatures That Don’t Conform</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 21:45:47</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35893952"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35893439">
          <h3>
            <a
              class="item"
              href="https://questdb.io/careers/technical-content-lead/"
              >QuestDB (YC S20) Is Hiring a Technical Content Lead</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 21:00:10</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35892512">
          <h3>
            <a
              class="item"
              href="https://www.bleepingcomputer.com/news/technology/youtube-tests-blocking-videos-unless-you-disable-ad-blockers/"
              >YouTube tests blocking videos unless you disable ad blockers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 19:45:03</span
              ><span class="points-container"
                >Points: <span class="points">543</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35892512"
                  >Comments</a
                ><span class="descendants">: 1051</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35892286">
          <h3>
            <a
              class="item"
              href="https://store.google.com/us/product/pixel_fold"
              >Google Pixel Fold</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 19:29:04</span
              ><span class="points-container"
                >Points: <span class="points">295</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35892286"
                  >Comments</a
                ><span class="descendants">: 463</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35891444">
          <h3>
            <a
              class="item"
              href="https://ai.google/static/documents/palm2techreport.pdf"
              >PaLM 2 Technical Report [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 18:32:30</span
              ><span class="points-container"
                >Points: <span class="points">348</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35891444"
                  >Comments</a
                ><span class="descendants">: 228</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35888644">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=35888644"
              >Launch HN: Clearspace (YC W23) – Cut back on screen time</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 15:19:16</span
              ><span class="points-container"
                >Points: <span class="points">216</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35888644"
                  >Comments</a
                ><span class="descendants">: 145</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.getclearspace.com"
                >https://www.getclearspace.com</a
              >). We make an iPhone app that helps you reduce compulsive phone
              use. It regulates your social media experiences and app usage,
              saving you from impulse opens and mindless scrolls. Here’s a demo:
              <a
                href="https://drive.google.com/file/d/1zXLYvtG1zZ6ZRq01eGc8jlsn70vlUZLj/view"
                >https://drive.google.com/file/d/1zXLYvtG1zZ6ZRq01eGc8jlsn70v...</a
              >
              <p>
                During the pandemic, we found ourselves spending more and more
                of our lives on digital content. Youtube, Instagram, Twitter,
                even HN were always <i>right</i> there, and the impulse to open
                and consume became stronger than ever. We realized how much of
                our technology use was compulsive rather than intentional.
                Willpower alone was not enough to solve the problem. Most of
                these products have been designed to activate dopamine feedback
                loops and, to be blunt, keep users hooked [1].
              </p>
              <p>
                Not wanting to be addicted, we started cobbling together
                "attention protection stacks": iPhone shortcuts, Chrome
                Extensions, custom /etc/ files, anything to create digital
                environments that aligned with our own goals rather than the
                engagement metrics of big tech. We had some surprising successes
                with that, so we decided to build a comprehensive and
                approachable solution. We began with our worst pain point:
                mindless scrolling on our phones.
              </p>
              <p>
                How it works: you tell us what apps you want to reduce your
                usage of (edit: and websites! we just rolled out website support
                this week), and we do the following to train better habits:
              </p>
              <p>
                (1) App Intercepts: we inject a mandatory 15 second breathing
                exercise before opening apps you’ve added to Clearspace. This
                helps to break the dopamine feedback loop that your brain has
                learned, where tapping an app icon yields an instant reward.
              </p>
              <p>
                (2) Intentional Sessions: at the end of said breathing exercise,
                you tell us how long you want to use an app for. Then you enter
                and we'll pull you out after that amount of time.
              </p>
              <p>
                (3) Cumulative Progress: each day you stay below your intended
                time limit adds to your streak of successes. Over time,
                protecting your streak frequently becomes more important than a
                "quick scroll" before bed (and if you get a 100 day under-budget
                streak, we'll send you a hat).
              </p>
              <p>
                (4) Teammates: you can add “teammates” who will receive
                automatic texts if you exceed your budget on an app, remove it
                from Clearspace, or delete Clearspace entirely.
              </p>
              <p>
                You may notice how this is fighting fire with fire: we use tech
                to limit your tech use, social features to curtail social media,
                and so on. The mechanisms built into the big apps have such a
                conditioning effect on the brain, they’re nearly impossible for
                most people to resist. We invoke similarly powerful mechanisms
                on <i>your</i> behalf, to help your life be less dominated by
                these things.
              </p>
              <p>
                Some of this only recently became technically possible. The new
                ScreenTime API from Apple allows users to connect apps on their
                phone to third party apps (like us). We receive opaque "tokens"
                for each user app selection and we can perform actions on the
                tokens, which affects the apps without us knowing what the
                actual apps are. We can add and remove "shields" to a token,
                which presents an obstructing interface over an app or website.
                We can display a user's usage of a token over a time period and
                display that data to them.
              </p>
              <p>
                Btw, after 3M "app intercepts" (a 15 second wait), we’ve found
                that people opt <i>not</i> to continue to the app they tried to
                open 54% of the time. We think that says something about how
                much of our social media use as a society is compulsive rather
                than intentional.
              </p>
              <p>
                Here are some typical testimonials from users who have been
                recovering their time by using our app:
                <a
                  href="https://twitter.com/martindaniel4/status/1630175865496584193"
                  >https://twitter.com/martindaniel4/status/1630175865496584193</a
                >,
                <a href="https://twitter.com/timzyu/status/1632551744340123650"
                  >https://twitter.com/timzyu/status/1632551744340123650</a
                >,
                <a
                  href="https://twitter.com/jandralee/status/1650674167174377473"
                  >https://twitter.com/jandralee/status/1650674167174377473</a
                >
              </p>
              <p>
                If you're an iPhone user, we'd love for you to try our app and
                let us know what you think! We have a freemium model: adding one
                app is free, paid tier gives you unlimited apps. Your feedback
                on the app would be deeply appreciated and more broadly we’d
                love to hear about how you’ve navigated this problem in your
                life.
              </p>
              <p>
                [1] though maybe not HN:
                <a href="https://news.ycombinator.com/item?id=77173"
                  >https://news.ycombinator.com/item?id=77173</a
                >,
                <a href="https://news.ycombinator.com/item?id=372593"
                  >https://news.ycombinator.com/item?id=372593</a
                >.
              </p>
            </div>
          </section>
        </section>
        <section id="35888327">
          <h3>
            <a class="item" href="https://www.zeileis.org/news/coloring/"
              >Coloring in R's Blind Spot</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 14:58:04</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35888327"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35886346">
          <h3>
            <a
              class="item"
              href="http://mickeydelp.com/blog/anatomy-of-a-drum-machine"
              >Anatomy of a Drum Machine (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 12:26:12</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35886346"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35886334">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/big-pipes-ddos-for-hire-fbi/"
              >Team of Sleuths Quietly Hunting Cyberattack-for-Hire Services for
              a Decade</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 12:23:51</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35886334"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35886243">
          <h3>
            <a
              class="item"
              href="https://tedgioia.substack.com/p/the-decline-and-fall-of-the-hit-instrumental"
              >The decline and fall of the hit instrumental song</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 12:15:29</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35886243"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35885982">
          <h3>
            <a class="item" href="https://noidea.dog/#/fires/"
              >The history of fire escapes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 11:32:39</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35885982"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35885859">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/news/new-philips-monitor-features-an-e-paper-side-panel"
              >New Philips Monitor Features an E-Paper Side Panel</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 11:12:10</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35885859"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35885046">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Protocol_Wars"
              >Protocol Wars</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 08:26:54</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35885046"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35884875">
          <h3>
            <a
              class="item"
              href="http://users.ece.utexas.edu/~perry/work/papers/swa-sen.pdf"
              >Foundations for the Study of Software Architecture (1992)
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 07:59:52</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35884875"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35884667">
          <h3>
            <a
              class="item"
              href="https://blog.koehntopp.info/2023/05/05/50-years-in-filesystems-1974.html"
              >50 Years in Filesystems: 1974 Unix V7</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 07:22:59</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35884667"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35884437">
          <h3>
            <a class="item" href="https://subtls.pages.dev/"
              >See this page fetch itself, byte by byte, over TLS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 06:51:33</span
              ><span class="points-container"
                >Points: <span class="points">1242</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35884437"
                  >Comments</a
                ><span class="descendants">: 149</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35884305">
          <h3>
            <a
              class="item"
              href="https://www.laphamsquarterly.org/roundtable/lower-your-expectations"
              >Pragmatic Writing Advice from the 6th Century</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-10 @ 06:29:20</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35884305"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35871462">
          <h3>
            <a class="item" href="https://blog.brachiosoft.com/redis-en"
              >Story: Redis and its creator antirez</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-09 @ 08:07:06</span
              ><span class="points-container"
                >Points: <span class="points">467</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35871462"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
