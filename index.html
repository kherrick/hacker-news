<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41179735">
          <h3>
            <a
              class="item"
              href="https://www.usgs.gov/news/featured-story/first-usgs-supercomputer-decommissioning-makes-way-successors"
              >First USGS supercomputer decommissioning makes way for
              successors</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-07 @ 09:46:25</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41179735"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41179682">
          <h3>
            <a
              class="item"
              href="https://jobs.lever.co/photoroom/b3661dfc-72c8-441b-8483-c0f8596af452?lever-origin=applied&amp;lever-source%5B%5D=yc"
              >Photoroom (YC S20) Is Hiring a Django Back End Lead in Paris
              (PostgreSQL, REST)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-07 @ 09:36:35</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41179666">
          <h3>
            <a class="item" href="https://github.com/altilunium/lacakgrak"
              >Show HN: Lacakgrak – simple inbound/outbound packet sniffer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-07 @ 09:33:00</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41179666"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41179513">
          <h3>
            <a
              class="item"
              href="https://twitter.com/amdryzen/status/1820956835794358451"
              >AMD Ryzen 9000 Series processors are ready to deliver world class
              gaming</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-07 @ 09:04:36</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41179513"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41179446">
          <h3>
            <a class="item" href="https://github.com/CoatiSoftware/Sourcetrail"
              >Sourcetrail: Free and Open-Source Interactive Source Explorer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-07 @ 08:43:47</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41179446"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41178959">
          <h3>
            <a
              class="item"
              href="https://news.alvaroduran.com/p/cringey-but-true-how-uber-tests-payments"
              >Cringey, but True: How Uber Tests Payments in Production</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-07 @ 07:16:02</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41178959"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41178596">
          <h3>
            <a
              class="item"
              href="https://rdivyanshu.github.io/posts/2024/08/streams-calculation-proof-and-dafny.html"
              >Streams, Calculational Proofs and Dafny</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-07 @ 05:55:11</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41178596"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41178258">
          <h3>
            <a
              class="item"
              href="https://blog.phylum.io/the-great-npm-garbage-patch/"
              >70% of new NPM packages in last 6 months were spam</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-07 @ 04:31:58</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41178258"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41177831">
          <h3>
            <a
              class="item"
              href="https://www.theparisreview.org/blog/2024/08/02/the-private-life-on-james-baldwin/"
              >The Private Life: On James Baldwin</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-07 @ 02:58:57</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41177831"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41176831">
          <h3>
            <a class="item" href="https://teenage.engineering/products/ep-1320"
              >Medieval</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-06 @ 23:57:42</span
              ><span class="points-container"
                >Points: <span class="points">576</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41176831"
                  >Comments</a
                ><span class="descendants">: 210</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41176817">
          <h3>
            <a
              class="item"
              href="https://andypiper.co.uk/2024/08/06/mnt-pocket-reform-first-impressions/"
              >MNT Pocket Reform first impressions and hardware</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-06 @ 23:56:05</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41176817"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41176265">
          <h3>
            <a
              class="item"
              href="https://eclecticlight.co/2024/08/06/how-long-does-apple-support-mac-firmware/"
              >How long does Apple support Mac firmware?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-06 @ 22:47:33</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41176265"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41174979">
          <h3>
            <a
              class="item"
              href="https://www.tandfonline.com/doi/full/10.1080/1751696X.2024.2373876#abstract"
              >Carvings at Gobekli Tepe may be oldest calendar</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-06 @ 20:30:10</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41174979"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41174014">
          <h3>
            <a
              class="item"
              href="https://www.latimes.com/nation/la-oe-0407-silk-ring-theory-20130407-story.html"
              >How not to say the wrong thing (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-06 @ 18:54:28</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41174014"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41173377">
          <h3>
            <a
              class="item"
              href="https://www.jointhefollowup.com/p/the-actual-wolf-of-wall-street-sales-script"
              >The real "Wolf of Wall Street" sales script</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-06 @ 17:56:37</span
              ><span class="points-container"
                >Points: <span class="points">318</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41173377"
                  >Comments</a
                ><span class="descendants">: 176</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41173335">
          <h3>
            <a
              class="item"
              href="https://www.sakisv.net/2024/08/tracking-supermarket-prices-playwright/"
              >Tracking supermarket prices with Playwright</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-06 @ 17:52:51</span
              ><span class="points-container"
                >Points: <span class="points">365</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41173335"
                  >Comments</a
                ><span class="descendants">: 146</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41173330">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41173330"
              >Launch HN: Firezone (YC W22) – Zero-trust access platform built
              on WireGuard</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-06 @ 17:52:32</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41173330"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.firezone.dev">https://www.firezone.dev</a>),
              a remote access platform that is a replacement for legacy
              corporate VPNs. Built on WireGuard (a fast, modern VPN protocol),
              Firezone secures your team’s apps, networks and services using
              access policies synced with your identity provider. You deploy
              tiny, self-contained binaries into your infrastructure anywhere
              you need access, and your workforce uses our client apps to reach
              the resources they protect.
              <p>
                Here’s a demo:
                <a href="https://youtu.be/QEv7dJwKMvo"
                  >https://youtu.be/QEv7dJwKMvo</a
                >.
              </p>
              <p>
                Historically, the tool used to achieve this has been the
                corporate VPN. These work off a security model where you
                authenticate with the perimeter and gain access to the network
                behind it, which works when most workers are in office and
                resources on-prem. But as workers go remote and resources move
                to the cloud, the perimeter blurs, making it harder to secure.
              </p>
              <p>
                I experienced this issue first-hand as a security engineer
                hunting for APT malware on Cisco's intranet. Malware often
                landed first on remote employee laptops, then spread from there
                to critical internal systems. Firewalls were somewhat effective
                at solving this problem, but they were clunky—it could take
                months for Infosec to approve requests to allow your team’s app
                or services through.
              </p>
              <p>
                When Covid forced everyone to work from home, even Cisco
                struggled to grapple with the increased demand on its VPN
                concentrators. The perimeter defense model meant that we had to
                VPN into the intranet to get anything done, and if the speeds
                were really bad, we couldn't work that day.
              </p>
              <p>
                One way to solve the above problems is to break up the single
                perimeter into many smaller ones, shifting them closer to the
                resources they protect. That way, compromising one perimeter
                does not gain you access to all others, and traffic is not
                bottlenecked through a single choke point. However, now you have
                many VPN tunnels instead of one, and most VPN protocols are too
                heavyweight for this.
              </p>
              <p>
                If <i>Cisco</i> was facing these issues with remote access, I
                thought, others <i>must</i> be facing similar problems. So when
                WireGuard came along, I started Firezone.
              </p>
              <p>
                WireGuard tunnels are so lightweight you can open thousands of
                them from an iPhone to whatever resources you need access to.
                Firezone builds on that and also handles NAT traversal, so you
                don’t need to change your firewall configuration to use it. Just
                deploy Gateways - small, statically-linked Linux binaries -
                where you need access, and Firezone’s homegrown STUN/TURN layer
                (we call “snownet”) handles the rest. If you need more
                throughput, just deploy more Gateways, and load is balanced
                across all of them.
              </p>
              <p>
                WireGuard keys are distributed to peers only when access to a
                particular resource is authorized, and private keys never leave
                the device’s memory where they were generated. If a Gateway goes
                offline, Firezone will migrate connections from it to healthy
                ones within about 10 seconds, without user intervention. We lean
                heavily on Elixir/Phoenix and OTP’s awesome concurrency features
                to power all of this.
              </p>
              <p>
                Firezone’s access control system is intentionally very simple.
                Policies define which user groups have access to which resources
                based on a default-deny system. More perimeters means more rules
                managing access to them, so we intentionally wanted to keep
                admins out of “ACL hell” as the number of controls grew.
              </p>
              <p>
                One area we’re actively working to improve is our UI/UX -
                Firezone is a product built by engineers, for engineers, and at
                times, it shows! Expect refinements to come in this area over
                the coming months.
              </p>
              <p>
                I’d love for you to give Firezone a try! You can spin up a demo
                instance at
                <a href="https://app.firezone.dev/try"
                  >https://app.firezone.dev/try</a
                >
                without signing up, and download clients from
                <a href="https://www.firezone.dev/kb/client-apps"
                  >https://www.firezone.dev/kb/client-apps</a
                >. And if you’re curious to learn more about how Firezone works,
                see for yourself - we build in the open at
                <a href="https://www.github.com/firezone/firezone"
                  >https://www.github.com/firezone/firezone</a
                >.
              </p>
              <p>Thanks for reading, and I look forward to your feedback!</p>
            </div>
          </section>
        </section>
        <section id="41173288">
          <h3>
            <a
              class="item"
              href="https://blog.paradedb.com/pages/elasticsearch_vs_postgres"
              >Full text search over Postgres: Elasticsearch vs. alternatives</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-06 @ 17:48:11</span
              ><span class="points-container"
                >Points: <span class="points">284</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41173288"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41173261">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=uYOF-YggWAg"
              >Time is an illusion, and these physicists say they know how it
              works [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-06 @ 17:45:09</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41173261"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41173223">
          <h3>
            <a
              class="item"
              href="https://openai.com/index/introducing-structured-outputs-in-the-api/"
              >Structured Outputs in the API</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-06 @ 17:41:41</span
              ><span class="points-container"
                >Points: <span class="points">662</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41173223"
                  >Comments</a
                ><span class="descendants">: 244</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41173177">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/artanddesign/article/2024/aug/06/superfest-unbreakable-drinking-glasses-east-germany"
              >Smashing idea: how East Germany invented 'unbreakable' drinking
              glasses</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-06 @ 17:37:51</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41173177"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41173161">
          <h3>
            <a class="item" href="https://1fps.video/"
              >Show HN: 1-FPS encrypted screen sharing for introverts</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-06 @ 17:36:10</span
              ><span class="points-container"
                >Points: <span class="points">352</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41173161"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
            <div class="text">
              <p>
                I tired of sharing screen via Google Meet with 1-hour
                limitation, with Zoom and 40-minute limitation, etc. With paid
                Slack subscription. And often times I just needed to screenshare
                with no audio.
              </p>
              <p>
                So I ended up with my own solution - no registration, low
                memory, low CPU, low tek 1 fps encrypted screen sharing.
                Currently sharing only the main screen (good for laptop users).
              </p>
              <p>
                It's very raw in terms of infrastructure, since I'm not counting
                bytes (yikes!), everything works on my own dedicated server. But
                the service itself has been tested, we've been sharing screens
                for countless hours. All sessions last for 48 hours, then it
                gets removed with all remaining info.
              </p>
              <p>
                Every new frame replaces the other, and everything is end-to-end
                encrypted so even server owners and operators won't be able to
                see what are you sharing.
              </p>
              <p>
                There is also no tracking, except the main page - and I use my
                own analytics. Sessions are not getting tracked and never will
                be, and observability currently is not in place.
              </p>
              <p>
                Again, this is a true one-person side hacking project I hope
                (but I have serious doubts) I might need to scale if it's
                getting traction to support more users.
              </p>
            </div>
          </section>
        </section>
        <section id="41171280">
          <h3>
            <a class="item" href="https://pola.rs/posts/polars-string-type/"
              >Why Polars rewrote its Arrow string data type</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-06 @ 14:42:03</span
              ><span class="points-container"
                >Points: <span class="points">159</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41171280"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41170111">
          <h3>
            <a
              class="item"
              href="https://nowotarski.info/wordpress-nonce-authorization/"
              >Exploiting authorization by nonce in WordPress plugins</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-06 @ 12:13:21</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41170111"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41169924">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/08/05/science/tsung-dao-lee-dead.html"
              >Tsung-Dao Lee, physicist who challenged a law of nature, has
              died</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-06 @ 11:49:57</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41169924"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41167561">
          <h3>
            <a
              class="item"
              href="https://sfstandard.com/2024/08/05/x-officially-kills-its-san-francisco-headquarters-will-relocate-workers-to-south-bay/"
              >Twitter kills its San Francisco headquarters, will relocate to
              South Bay</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-06 @ 03:30:50</span
              ><span class="points-container"
                >Points: <span class="points">544</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41167561"
                  >Comments</a
                ><span class="descendants">: 1005</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41159438">
          <h3>
            <a
              class="item"
              href="https://media.ccc.de/v/34c3-9021-squeezing_a_key_through_a_carry_bit"
              >Squeezing a key through a carry bit (2017) [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-05 @ 09:21:39</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41159438"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41155021">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/what-is-analog-computing-20240802/"
              >What Is Analog Computing?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-04 @ 17:25:09</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41155021"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41147393">
          <h3>
            <a
              class="item"
              href="https://news.ubc.ca/2024/07/ubc-super-black-wood-nxylon/"
              >Nxylon: New super-black material made from wood</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-03 @ 16:06:24</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41147393"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41144909">
          <h3>
            <a class="item" href="https://github.com/Zirias/xmoji"
              >Emotional about X11: I'm creating a pure X11 "emoji keyboard"</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-03 @ 05:50:10</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41144909"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
