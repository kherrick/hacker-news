<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40640159">
          <h3>
            <a
              class="item"
              href="https://developer.apple.com/videos/play/wwdc2024/10135/"
              >What's new in Xcode 16 [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 22:48:42</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40640159"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40639943">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2024/06/10/fortune_200_oracle_java_audit/"
              >Oracle Java police start knocking on Fortune 200's doors for
              first time</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 22:26:50</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40639943"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40639606">
          <h3>
            <a
              class="item"
              href="https://security.apple.com/blog/private-cloud-compute/"
              >Private Cloud Compute: A new frontier for AI privacy in the
              cloud</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 21:53:07</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40639606"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40639506">
          <h3>
            <a
              class="item"
              href="https://machinelearning.apple.com/research/introducing-apple-foundation-models"
              >Apple's On-Device and Server Foundation Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 21:42:11</span
              ><span class="points-container"
                >Points: <span class="points">184</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40639506"
                  >Comments</a
                ><span class="descendants">: 105</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40639429">
          <h3>
            <a
              class="item"
              href="https://www.bleepingcomputer.com/news/security/malicious-vscode-extensions-with-millions-of-installs-discovered/"
              >Malicious VSCode extensions with installs discovered</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 21:35:20</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40639429"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40639148">
          <h3>
            <a
              class="item"
              href="https://timmoth.github.io/AsyncMonolith/posts/idempotency/"
              >Heard of Idempotency but unsure what it is?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 21:10:37</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40639148"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40639137">
          <h3>
            <a class="item" href="https://www.swift.org/blog/swiftlang-github/"
              >New GitHub Organization for the Swift Project</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 21:10:03</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40639137"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40639032">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/trieve/jobs/2jeeXLs-developer-relations-software-engineer"
              >Trieve (YC W24) Is Hiring an DevRel Software Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 21:00:43</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40638764">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/the-new-math-of-how-large-scale-order-emerges-20240610/"
              >The New Math of How Large-Scale Order Emerges</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 20:42:04</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40638764"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40638741">
          <h3>
            <a class="item" href="https://www.britishnewspaperarchive.co.uk/"
              >The British Newspaper Archive</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 20:40:24</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40638741"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40638386">
          <h3>
            <a
              class="item"
              href="https://usrtk.org/bees-neonics/entomological-society-america-corporate-partners/"
              >Controversial pesticide research all but vanished from a major
              conference</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 20:16:33</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40638386"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40637785">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41550-024-02279-8"
              >Possible exposure of Earth to dense interstellar medium 2-3M
              years ago</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 19:39:29</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40637785"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40637374">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Pyrophone"
              >Pyrophone</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 19:13:39</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40637374"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40637102">
          <h3>
            <a
              class="item"
              href="https://www.afterbabel.com/p/community-based-childhood"
              >Deterioration of Local Community a Major Driver of Loss of
              Play-Based Childhood</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 19:00:26</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40637102"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40636883">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=iDnW0WiCqNc"
              >The rarest move in chess [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 18:50:53</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40636883"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40636854">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/macos/macos-sequoia-preview/"
              >macOS Sequoia Preview</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 18:49:07</span
              ><span class="points-container"
                >Points: <span class="points">226</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40636854"
                  >Comments</a
                ><span class="descendants">: 196</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40636844">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/newsroom/2024/06/introducing-apple-intelligence-for-iphone-ipad-and-mac/"
              >Apple Intelligence for iPhone, iPad, and Mac</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 18:48:47</span
              ><span class="points-container"
                >Points: <span class="points">685</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40636844"
                  >Comments</a
                ><span class="descendants">: 709</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40635697">
          <h3>
            <a class="item" href="https://github.com/visrealm/pico9918"
              >pico9918: A replacement TMS9918A/TMS9929A VDP using a Raspberry
              Pi Pico</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 17:09:52</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40635697"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40635397">
          <h3>
            <a
              class="item"
              href="https://www.csun.io/2024/06/08/probabilistic-tic-tac-toe.html"
              >Show HN: Probabilistic Tic-Tac-Toe</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 16:40:05</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40635397"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40633902">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2406.04912"
              >Mexican Computers: A Brief Technical and Historical Overview</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 14:14:24</span
              ><span class="points-container"
                >Points: <span class="points">165</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40633902"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40633773">
          <h3>
            <a class="item" href="https://github.com/squaredtechnologies/thread"
              >Show HN: Thread â€“ AI-powered Jupyter Notebook built using
              React</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 13:59:22</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40633773"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
            <div class="text">
              <a href="https://thread.dev/">https://thread.dev/</a>) an
              open-source Jupyter Notebook that has a bunch of AI features built
              in. The easiest way to think of Thread is if the chat interface of
              OpenAI code interpreter was fused into a Jupyter Notebook
              development environment where you could still edit code or re-run
              cells. To check it out, you can see a video demo here:
              <a href="https://www.youtube.com/watch?v=Jq1_eoO6w-c"
                >https://www.youtube.com/watch?v=Jq1_eoO6w-c</a
              >
              <p>
                We initially got the idea when building Vizly (<a
                  href="https://vizly.fyi/"
                  >https://vizly.fyi/</a
                >) a tool that lets non-technical users ask questions from their
                data. While Vizly is powerful at performing data
                transformations, as engineers, we often felt that natural
                language didn't give us enough freedom to edit the code that was
                generated or to explore the data further for ourselves. That is
                what gave us the inspiration to start Thread.
              </p>
              <p>
                We made Thread a pip package (`pip install thread-dev`) because
                we wanted to make Thread as easily accessible as possible. While
                there are a lot of notebooks that improve on the notebook
                development experience, they are often cloud hosted tools that
                are hard to access as an individual contributor unless your
                company has signed an enterprise agreement.
              </p>
              <p>
                With Thread, we are hoping to bring the power of LLMs to the
                local notebook development environment while blending the
                editing experience that you can get in a cloud hosted notebook.
                We have many ideas on the roadmap but instead of building in a
                vacuum (which we have made the mistake of before) our hope was
                to get some initial feedback to see if others are as interested
                in a tool like this as we are.
              </p>
              <p>Would love to hear your feedback and see what you think!</p>
            </div>
          </section>
        </section>
        <section id="40632745">
          <h3>
            <a
              class="item"
              href="https://blog.haschek.at/2024/leaving-a-digital-legacy.html"
              >Sending emails to my three-year-old</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 12:14:56</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40632745"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40632533">
          <h3>
            <a class="item" href="https://github.com/potahtml/mpa-archive"
              >Show HN: Crawl a modern website to a zip, serve the website from
              the zip</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 11:47:00</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40632533"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40631558">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/the-mythical-non-roboticist"
              >The Mythical Non-Roboticist: Wouldn't it be great if everyone
              could do robotics?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 09:02:22</span
              ><span class="points-container"
                >Points: <span class="points">165</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40631558"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40630909">
          <h3>
            <a
              class="item"
              href="https://notso.boringsql.com/guides/postgrest-apis-made-easy/"
              >PostgREST Tutorial: APIs made easy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 06:49:52</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40630909"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40630656">
          <h3>
            <a class="item" href="https://c0de517e.com/014_future_engines.htm"
              >The Engine of the Future</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 06:00:09</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40630656"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40627113">
          <h3>
            <a
              class="item"
              href="https://news.mit.edu/2024/researchers-demonstrate-first-chip-based-3d-printer-0606"
              >Researchers demonstrate the first chip-based 3D printer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 19:59:39</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40627113"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40623864">
          <h3>
            <a
              class="item"
              href="https://suanto.com/2024/06/06/the-time-I-built-an-ROV-01/"
              >I built an ROV to solve missing person cases</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 12:02:19</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40623864"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40622999">
          <h3>
            <a
              class="item"
              href="http://republicofthebees.blogspot.com/2008/04/from-steampunk-to-solarpunk.html"
              >From Steampunk to Solarpunk (2008)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 09:00:33</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40622999"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40605654">
          <h3>
            <a
              class="item"
              href="https://newrepublic.com/article/181667/ruins-edward-gibbons-masterpiece-mike-duncan"
              >In the Ruins of Edward Gibbon's Masterpiece</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-07 @ 05:42:30</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40605654"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
