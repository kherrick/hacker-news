<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40649746">
          <h3>
            <a
              class="item"
              href="https://www.nakedcapitalism.com/2024/06/mastercards-biometric-retail-payment-system-finally-arrives-in-europe-following-pilot-tests-in-global-south.html"
              >Mastercard Launches Its Biometric Retail Payment System in
              Europe</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 18:26:14</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40649746"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40649091">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/London%E2%80%93Calcutta_bus_service"
              >London–Calcutta Bus Service</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 17:30:09</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40649091"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40648697">
          <h3>
            <a
              class="item"
              href="https://ai-explained.yoko.dev/1-attention-explained"
              >Show HN: A cartoon intro to how the attention mechanism works</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 16:58:16</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40648697"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
            <div class="text">
              I started to draw cartoons to make complex concepts in AI more
              accessible to the rest of us. Hope this is useful &amp;amp; lmk if
              you have ideas or feedback!
            </div>
          </section>
        </section>
        <section id="40648470">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Lynn_Conway"
              >Lynn Conway Has Died</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 16:44:11</span
              ><span class="points-container"
                >Points: <span class="points">485</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40648470"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40648193">
          <h3>
            <a class="item" href="https://github.com/coqui-ai/TTS"
              >Coqui.ai TTS: A Deep Learning Toolkit for Text-to-Speech</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 16:25:16</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40648193"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40647491">
          <h3>
            <a
              class="item"
              href="https://www.fda.gov/food/cfsan-constituent-updates/fda-responds-petition-phthalates-food-packaging-and-food-contact-applications"
              >FDA denies petition against use of phthalates in food
              packaging</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 15:34:37</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40647491"
                  >Comments</a
                ><span class="descendants">: 138</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40646820">
          <h3>
            <a
              class="item"
              href="https://www.infoq.com/news/2024/06/meta-llm-megalodon/"
              >Meta Open-Sources Megalodon LLM for Efficient Long Sequence
              Modeling</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 14:49:05</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40646820"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40646741">
          <h3>
            <a class="item" href="https://github.com/redotvideo/revideo"
              >Show HN: Revideo – Create Videos with Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 14:43:31</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40646741"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/redotvideo/revideo"
                >https://github.com/redotvideo/revideo</a
              >), an open source framework for programmatic video editing.
              <p>
                Revideo lets you create video templates in Typescript and render
                them with dynamic inputs through an API. It also comes with a
                &lt;Player /&gt; component that lets you preview your projects
                in the browser and integrate video editing functionality into
                web apps.
              </p>
              <p>
                The project is useful for anyone who wants to build apps that
                automate certain video editing tasks. A lot of companies in the
                space build their own custom stack for this, like Opus (<a
                  href="https://www.opus.pro/"
                  >https://www.opus.pro/</a
                >), which automatically creates highlight videos from podcasts,
                or Clueso (<a href="https://www.clueso.io/"
                  >https://www.clueso.io/</a
                >), which lets you create stutter-free product walkthroughs with
                AI voiceovers.
              </p>
              <p>
                Revideo is based on the HTML Canvas API and is forked from
                Motion Canvas (<a
                  href="https://github.com/motion-canvas/motion-canvas"
                  >https://github.com/motion-canvas/motion-canvas</a
                >), a tool that lets you create canvas animations. While Motion
                Canvas is intended by its maintainer to exclusively be a
                standalone application [1], we have turned Revideo into a
                library that developers can integrate into their apps, while
                specifically focusing on video use cases. To support this, we
                have, among other things, added the ability to do headless
                rendering, made video rendering much faster and added support
                for syncing and exporting audio.
              </p>
              <p>
                We’re excited about programmatic video editing because of the
                possibility to automate content creation with AI. One of our
                users is building StoriesByAngris (<a
                  href="https://storiesbyangris.com/"
                  >https://storiesbyangris.com/</a
                >), which lets you create video-based RPG stories from language
                prompts. Other users are marketing-tech companies that help
                their customers generate and A/B test different versions of
                video ads.
              </p>
              <p>
                We started to work on video tooling because we ourselves
                explored a bunch of product ideas in the space of AI-based video
                creation earlier this year. For example, we built apps that
                automatically create educational short videos and tinkered with
                apps that let you create memes.
              </p>
              <p>
                While building these products, we were frustrated with the video
                editing frameworks we used: Moviepy (<a
                  href="https://github.com/Zulko/moviepy"
                  >https://github.com/Zulko/moviepy</a
                >), which we used initially, doesn’t work in the browser, so
                we’d often have to wait minutes for a video to render just to
                test our code changes. Remotion (<a
                  href="https://github.com/remotion-dev/remotion"
                  >https://github.com/remotion-dev/remotion</a
                >), which we switched to later, is pretty good, but we didn’t
                want to rely on it as it is not FOSS (source-available only).
              </p>
              <p>
                We had already followed Motion Canvas for some time and really
                liked it, so we thought that extending it would get us to
                something useful much faster than building an animation library
                from scratch. We initially tried to build Revideo as a set of
                Motion Canvas plugins, but we soon realized that the changes we
                were making were too drastic and far too complex to fit into
                plugins. This is why we ultimately created a fork. We’re unsure
                if this is the right way to go in the long term, and would
                prefer to find a way to build Revideo without feeling like we’re
                dividing the community - if you have experience with this
                (keeping forks with complex changes in sync with upstream) or
                other suggestions on how to solve this, we’d love your input.
              </p>
              <p>
                Our current focus is improving the open source project. In the
                long term, we want to make money by building a rendering service
                for developers building apps with Revideo.
              </p>
              <p>
                We’d love to hear your feedback and suggestions on what we can
                improve! You can find our repo at
                <a href="https://github.com/redotvideo/revideo"
                  >https://github.com/redotvideo/revideo</a
                >, and you can explore example projects at
                <a href="https://github.com/redotvideo/examples"
                  >https://github.com/redotvideo/examples</a
                >
              </p>
              <p>
                [1] “Motion Canvas is not a normal npm package. It's a
                standalone tool that happens to be distributed via npm.” -
                <a href="https://github.com/orgs/motion-canvas/discussions/1015"
                  >https://github.com/orgs/motion-canvas/discussions/1015</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="40646684">
          <h3>
            <a
              class="item"
              href="https://jobs.ashbyhq.com/motion/4f5f6a29-3af0-4d79-99a4-988ff7c5ba05?utm_source=hn"
              >Motion (YC W20) Is Hiring Senior Engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 14:38:41</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40646658">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2024/06/11/norway-discovers-europes-largest-deposit-of-rare-earth-metals.html"
              >Norway discovers Europe's largest deposit of rare earth metals</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 14:36:34</span
              ><span class="points-container"
                >Points: <span class="points">211</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40646658"
                  >Comments</a
                ><span class="descendants">: 198</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40646602">
          <h3>
            <a
              class="item"
              href="https://www.scientificamerican.com/article/some-people-with-insomnia-think-theyre-awake-when-theyre-asleep/"
              >Some people with insomnia think they're awake when they're
              asleep</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 14:32:10</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40646602"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40646312">
          <h3>
            <a
              class="item"
              href="https://briefer.cloud/blog/posts/self-serve-bi-myth/"
              >Self-Serve Dashboards</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 14:04:36</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40646312"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40646291">
          <h3>
            <a
              class="item"
              href="https://www.kyushu-u.ac.jp/en/researches/view/290/"
              >Research on the visual rabbit illusion takes a leap forward</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 14:02:45</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40646291"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40646061">
          <h3>
            <a class="item" href="https://dgroshev.com/blog/rp2040/"
              >I like the RP2040</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 13:39:49</span
              ><span class="points-container"
                >Points: <span class="points">289</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40646061"
                  >Comments</a
                ><span class="descendants">: 208</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40645743">
          <h3>
            <a class="item" href="https://unforget.computing-den.com/demo"
              >Show HN: Unforget, the note-taking app I always wanted: offline
              first, encrypted</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 13:02:23</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40645743"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40644745">
          <h3>
            <a
              class="item"
              href="https://www.technologyreview.com/2024/06/11/1093465/battery-swap-gogoro-taiwan-earthquake/"
              >Battery-swap networks are preventing emergency blackouts</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 10:54:08</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40644745"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40644323">
          <h3>
            <a class="item" href="https://lenas-fieldnotes.de/minimal-tz/"
              >Exploring TrustZone-M on the NRF9160</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 09:43:51</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40644323"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40643588">
          <h3>
            <a class="item" href="https://adelfaure.net/tools/jgs/">Jgs Font</a>
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 07:36:12</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40643588"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40643207">
          <h3>
            <a class="item" href="http://www.povray.org/"
              >POV-Ray – The Persistence of Vision Raytracer (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 06:36:44</span
              ><span class="points-container"
                >Points: <span class="points">271</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40643207"
                  >Comments</a
                ><span class="descendants">: 147</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40642801">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2024/06/10/two_arrested_in_uk_over/"
              >British duo arrested for SMS phishing via homemade cell tower</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-11 @ 05:40:13</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40642801"
                  >Comments</a
                ><span class="descendants">: 132</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40640567">
          <h3>
            <a
              class="item"
              href="https://pubs.aip.org/physicstoday/article/63/9/38/386608/The-discovery-of-superconductivityA-century-ago"
              >The Discovery of Superconductivity (2010)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 23:34:58</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40640567"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40639506">
          <h3>
            <a
              class="item"
              href="https://machinelearning.apple.com/research/introducing-apple-foundation-models"
              >Apple's On-Device and Server Foundation Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 21:42:11</span
              ><span class="points-container"
                >Points: <span class="points">863</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40639506"
                  >Comments</a
                ><span class="descendants">: 464</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40636292">
          <h3>
            <a
              class="item"
              href="https://www.zdnet.com/article/forget-lastpass-apple-unveils-passwords-manager-app-at-wwdc-2024/"
              >Apple unveils 'Passwords' manager app at WWDC 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 18:04:10</span
              ><span class="points-container"
                >Points: <span class="points">342</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40636292"
                  >Comments</a
                ><span class="descendants">: 605</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40633003">
          <h3>
            <a class="item" href="https://xorvoid.com/forsp.html"
              >Forsp: A Forth+Lisp Hybrid Lambda Calculus Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 12:47:48</span
              ><span class="points-container"
                >Points: <span class="points">178</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40633003"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40632774">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/3d-printing/worlds-first-chip-based-3d-printer-is-smaller-than-a-coin-benefits-from-having-no-moving-parts"
              >First chip-based 3D printer is smaller than a coin with no moving
              parts</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 12:19:52</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40632774"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40632070">
          <h3>
            <a
              class="item"
              href="https://thechipletter.substack.com/p/demystifying-npus-questions-and-answers"
              >Demystifying NPUs: Questions and Answers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 10:37:46</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40632070"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40631231">
          <h3>
            <a
              class="item"
              href="https://eclecticlight.co/2024/06/10/multitasking-parallel-processing-and-concurrency-in-swift/"
              >Multitasking, parallel processing, and concurrency in Swift</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 07:55:26</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40631231"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40631186">
          <h3>
            <a
              class="item"
              href="https://www.join.tech/blog/2024-0x10-the-backbone-of-cybersecurity-hardware-security-modules.php"
              >The Backbone of Cybersecurity: Hardware Security Modules</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 07:46:12</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40631186"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40630676">
          <h3>
            <a
              class="item"
              href="https://yosefk.com/blog/simd-simt-smt-parallelism-in-nvidia-gpus.html"
              >SIMD &amp;lt; SIMT &amp;lt; SMT: Parallelism in Nvidia GPUs
              (2011)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-10 @ 06:05:30</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40630676"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40623864">
          <h3>
            <a
              class="item"
              href="https://suanto.com/2024/06/06/the-time-I-built-an-ROV-01/"
              >I built an ROV to solve missing person cases</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-09 @ 12:02:19</span
              ><span class="points-container"
                >Points: <span class="points">722</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40623864"
                  >Comments</a
                ><span class="descendants">: 116</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
