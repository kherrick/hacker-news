<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36936735">
          <h3>
            <a
              class="item"
              href="https://www.transformatise.com/2023/07/greed-and-excess-drive-the-climate-crisis-so-why-arent-they-being-questioned/"
              >Greed and Excess Drive the Climate Crisis, So Why Arenâ€™t They
              Being Questioned?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 22:41:06</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36936735"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36936302">
          <h3>
            <a
              class="item"
              href="https://hermitian.substack.com/p/how-to-not-get-rejected-from-ycs"
              >How to not get rejected from YC's Early AI interview batch</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 21:41:59</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36936302"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36935315">
          <h3>
            <a class="item" href="https://pubmed.ncbi.nlm.nih.gov/36580363/"
              >Regular use of Vitamin D supplement is associated with fewer
              melanoma cases</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 20:01:13</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36935315"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36935281">
          <h3>
            <a class="item" href="https://macgui.com/news/article.php?t=443"
              >HFS Origins: The Turbo File System (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 19:57:17</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36935281"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36935055">
          <h3>
            <a
              class="item"
              href="https://blog.dornea.nu/2023/07/30/documentation-as-code-for-cloud-plantuml/"
              >Documentation as Code for Cloud Using PlantUML</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 19:34:32</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36935055"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36935041">
          <h3>
            <a
              class="item"
              href="https://www.bitecode.dev/p/whats-up-python-the-gil-removed-a"
              >What's up, Python? The GIL removed, a new compiler, optparse
              deprecated</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 19:32:21</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36935041"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36934647">
          <h3>
            <a class="item" href="https://tux.pizza/posts/service2/"
              >The death of privacy front ends?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 18:52:22</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36934647"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36934520">
          <h3>
            <a class="item" href="https://www.akshaykhot.com/logging-in-ruby/"
              >Logging in Ruby: (Almost) Everything You Need to Know</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 18:41:12</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36934520"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36934391">
          <h3>
            <a class="item" href="https://youareatlas.com/"
              >You Are Atlas, You Hold Up the Sky</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 18:28:20</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36934391"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36934052">
          <h3>
            <a class="item" href="https://pboyd.io/posts/securing-a-linux-vm/"
              >The Reluctant Sysadmin's Guide to Securing a Linux Server</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 17:59:13</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36934052"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36934032">
          <h3>
            <a
              class="item"
              href="https://thegradient.pub/why-transformative-artificial-intelligence-is-really-really-hard-to-achieve/"
              >Why transformative artificial intelligence is hard to achieve</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 17:57:35</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36934032"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36934029">
          <h3>
            <a
              class="item"
              href="https://askmisterwizard.com/2019/LinuxAirCombat/LinuxAirCombat.htm"
              >Linux Air Combat: free, lightweight and open-source combat flight
              simulator</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 17:57:29</span
              ><span class="points-container"
                >Points: <span class="points">193</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36934029"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36933665">
          <h3>
            <a
              class="item"
              href="https://resources.nvidia.com/en-us-dgx-gh200/technical-white-paper"
              >Nvidia DGX GH200 Whitepaper</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 17:30:40</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36933665"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36933603">
          <h3>
            <a class="item" href="https://sfcompute.org/"
              >Show HN: San Francisco Compute â€“ 512 H100s at &amp;lt;$2/hr for
              research and startups</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 17:25:24</span
              ><span class="points-container"
                >Points: <span class="points">380</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36933603"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
            <div class="text">
              <p>
                Big labs like OpenAI and Deepmind have big clusters that support
                this kind of bursty allocation for their researchers, but
                startups so far have had to get very small clusters on very long
                term contracts, wait months of lead time, and try to keep them
                busy all the time.
              </p>
              <p>
                Our goal is to make it about 10-20x cheaper to do an AI startup
                than it is right now. Stable Diffusion only costs about $100k to
                train -- in theory every YC company could get up to that scale.
                It's just that no cloud provider in the world will give you
                $100k of compute for just a couple weeks, so startups have to
                raise 20x that much to buy a whole year of compute.
              </p>
              <p>
                Once the cluster is online, we're going to be pretty much the
                only option for startups to do big training runs like that on.
              </p>
            </div>
          </section>
        </section>
        <section id="36933452">
          <h3>
            <a class="item" href="https://github.com/khoj-ai/khoj"
              >Show HN: Khoj â€“ Chat offline with your second brain using Llama
              2</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 17:14:22</span
              ><span class="points-container"
                >Points: <span class="points">229</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36933452"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
            <div class="text">
              <p>
                Once we made Khoj search incremental, I completely stopped using
                the default incremental search (C-s) in Emacs. Since then Khoj
                has grown to support more content types, deeper integrations and
                chat (using ChatGPT). With Llama 2 released last week, chat
                models are finally good and easy enough to use on consumer
                hardware for the chat with docs scenario.
              </p>
              <p>
                Khoj is a desktop application to search and chat with your
                personal notes, documents and images. It is accessible from
                within Emacs, Obsidian or your Web browser. It works with
                org-mode, markdown, pdf, jpeg files and notion, github
                repositories. It is open-source and can work without internet
                access (e.g on a plane).
              </p>
              <p>
                Our chat feature allows you to extract answers and create
                content from your existing knowledge base. Example:
                <i
                  >"What was that book Trillian mentioned at Zaphod's birthday
                  last week"</i
                >. We personally use the chat feature regularly to find links,
                names and addresses (especially on mobile) and collate content
                across multiple, messy notes. It works online or offline: you
                can chat without internet using Llama 2 or with internet using
                GPT3.5+ depending on your requirements.
              </p>
              <p>
                Our search feature lets you quickly find relevant notes,
                documents or images using natural language. It does not use the
                internet. Example: Search for
                <i>"bought flowers at grocery store"</i> will find notes about
                <i>"roses at wholefoods"</i>.
              </p>
              <p>Quickstart:</p>
              <p></p>
              <pre><code>  pip install khoj-assistant &amp;&amp; khoj
</code></pre>
              See
              <a href="https://docs.khoj.dev/#/setup"
                >https://docs.khoj.dev/#/setup</a
              >
              for detailed instructions
              <p>
                We also have desktop apps (in beta) at
                <a href="https://github.com/khoj-ai/khoj/releases/tag/0.10.0"
                  >https://github.com/khoj-ai/khoj/releases/tag/0.10.0</a
                >
                if you want to try them out.
              </p>
              <p>
                Please do try out Khoj and let us know if it works for your use
                cases? <i>Looking forward to the feedback!</i>
              </p>
            </div>
          </section>
        </section>
        <section id="36933345">
          <h3>
            <a
              class="item"
              href="https://www.chiark.greenend.org.uk/~sgtatham/quasiblog/c11-generic/"
              >Workarounds for C11 _Generic()</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 17:06:14</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36933345"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36933276">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/mutable-ai/jobs"
              >Mutable.ai (YC W22) Is Hiring Engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 17:00:32</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36933209">
          <h3>
            <a
              class="item"
              href="https://www.feynmanlectures.caltech.edu/messenger.html"
              >Feynman's Messenger Lectures (1964)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 16:55:30</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36933209"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36933028">
          <h3>
            <a
              class="item"
              href="https://www.openwall.com/lists/musl/2023/05/02/1"
              >Musl 1.2.4 adds TCP DNS fallback</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 16:39:16</span
              ><span class="points-container"
                >Points: <span class="points">172</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36933028"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36932980">
          <h3>
            <a
              class="item"
              href="https://www.uni-leipzig.de/en/newsdetail/artikel/breakthrough-in-monte-carlo-computer-simulations-2023-07-26"
              >Monte Carlo Long-Range Interacting System Simulations</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 16:34:21</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36932980"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36932537">
          <h3>
            <a class="item" href="https://zapier.com/resources/guides/apis"
              >An Introduction to APIs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 15:54:35</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36932537"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36932526">
          <h3>
            <a
              class="item"
              href="https://worldsensorium.com/the-power-of-weeds-to-end-hunger-in-an-uncertain-climate/"
              >The Power of Weeds to End Hunger in an Uncertain Climate</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 15:53:46</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36932526"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36930795">
          <h3>
            <a
              class="item"
              href="https://geohot.github.io//blog/jekyll/update/2023/06/07/a-dive-into-amds-drivers.html"
              >A dive into the AMD driver workflow</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 13:06:22</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36930795"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36930321">
          <h3>
            <a
              class="item"
              href="https://www.mpg.de/20666229/0725-evan-origin-of-the-indo-european-languages-150495-x"
              >New insights into the origin of the Indo-European languages</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 12:03:46</span
              ><span class="points-container"
                >Points: <span class="points">196</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36930321"
                  >Comments</a
                ><span class="descendants">: 115</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36929499">
          <h3>
            <a class="item" href="https://amiaopensource.github.io/ffmprovisr/"
              >Ffmprovisr â€“ Making FFmpeg Easier</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 09:44:14</span
              ><span class="points-container"
                >Points: <span class="points">344</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36929499"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36927760">
          <h3>
            <a
              class="item"
              href="https://www.newstatesman.com/culture/books/2023/07/simone-de-beauvoir-art-of-loss-ali-smith"
              >Simone de Beauvoir and the art of loss</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-30 @ 04:17:41</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36927760"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36916530">
          <h3>
            <a
              class="item"
              href="https://www.bigmessowires.com/2023/07/28/tetris-max-2-9-1-and-macintosh-system-6-0-8-bugs/"
              >Tetris Max 2.9.1 and Macintosh System 6.0.8 Bugs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-29 @ 03:19:36</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36916530"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36915751">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-07-reveal-powerful-platform-high-entropy-alloy.html"
              >Researchers reveal platform to study high-entropy alloy
              electrocatalysis</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-29 @ 01:21:36</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36915751"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36912880">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=rl2Q9xH8e7M"
              >How to find a street in 2 minutes [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-28 @ 20:31:10</span
              ><span class="points-container"
                >Points: <span class="points">218</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36912880"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36910920">
          <h3>
            <a
              class="item"
              href="https://www.science.org/doi/10.1126/sciadv.adg3377"
              >Insights into the genetic histories and lifeways of Machu
              Picchuâ€™s occupants</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-28 @ 18:14:14</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36910920"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
