<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="45994854">
          <h3>
            <a
              class="item"
              href="https://blog.google/products/android/quick-share-airdrop/"
              >Android and iPhone users can now share files, starting with the
              Pixel 10 family</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-20 @ 17:04:34</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45994854"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45994592">
          <h3>
            <a class="item" href="https://github.com/telophasehq/tangent"
              >Show HN: Tangent – Open-source security data pipeline</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-20 @ 16:41:31</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45994592"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/telophasehq/tangent"
                >https://github.com/telophasehq/tangent</a
              >), a Rust-based log pipeline where all normalization, enrichment,
              and detection logic runs as WASM plugins.
              <p>
                We kept seeing the same problems in the OCSF (<a
                  href="https://ocsf.io"
                  >https://ocsf.io</a
                >) community: 1) Schemas change constantly. Large companies have
                whole teams dedicated to keeping vendor→OCSF mappings up to
                date. 2) There’s no shared library of mappings, so everyone
                recreates the same work. 3) Writing mappers is tedious,
                repetitive work. 4) Most pipelines use proprietary DSLs that are
                hard to share and hard for tools/LLMs to generate.
              </p>
              <p>
                Tangent takes a different approach: no DSLs – mappings and
                enrichments are just normal code compiled to WASM, shareable
                plugins – we maintain a community library (<a
                  href="https://github.com/telophasehq/tangent-plugins"
                  >https://github.com/telophasehq/tangent-plugins</a
                >), interoperability – we can run other engines’ DSLs (e.g.,
                Bloblang) inside WASM for easy migration, full flexibility –
                plugins can validate schemas, call external APIs (<a
                  href="https://github.com/telophasehq/tangent/blob/main/examples/enrichment/main.go#L58"
                  >https://github.com/telophasehq/tangent/blob/main/examples/en...</a
                >), or perform complex transforms (<a
                  href="https://github.com/telophasehq/tangent-plugins/blob/main/zeek-ocsf/conn/main.go#L312"
                  >https://github.com/telophasehq/tangent-plugins/blob/main/zee...</a
                >).
              </p>
              <p>
                Here's an example Python transformation plugin to drop all
                fields from a log except `message`:
              </p>
              <p></p>
              <pre><code>  import json
  
  from typing import List
  
  from wit_world.imports import log
  
  # `log.Logview` is Tangent's zero-copy JSON accessor type.
  
  def process_logs(self, logs: List[log.Logview]) -&gt; bytes:
  
      out = bytearray()
  
      for lv in logs:
  
          msg = lv.get("msg")
  
          value = msg.value if msg is not None else ""
  
          out.extend(json.dumps({"message": value}).encode() + b"\n")
  
      return bytes(out)
</code></pre>
              We have plenty more examples in the repo.
              <p>
                Because plugins are just Go/Python/Rust, LLMs can create new
                mappers with ease. For example, I asked:
              </p>
              <p></p>
              <pre><code>  Generate a mapper from AWS Security Hub Finding to OCSF
</code></pre>
              and only had to make a few minor tweaks. (<a
                href="https://github.com/telophasehq/tangent-plugins/blob/main/aws-ocsf/security_hub/main.go"
                >https://github.com/telophasehq/tangent-plugins/blob/main/aws...</a
              >)
              <p>
                Performance-wise, a 16-core Amazon Linux box processes ~480 MB/s
                end-to-end (TCP → Rust-WASM transform → sink) on ~100-byte JSON
                logs. The CLI includes tooling to scaffold, test, and benchmark
                plugins locally. Here's a deep dive into how we are able to get
                this performance:
                <a href="https://docs.telophasehq.com/runtime"
                  >https://docs.telophasehq.com/runtime</a
                >.
              </p>
              <p>We’d love to get your feedback! What do you think?</p>
            </div>
          </section>
        </section>
        <section id="45993943">
          <h3>
            <a
              class="item"
              href="https://www.ryanpuzycki.com/p/the-banished-bottom-of-the-housing"
              >The Banished Bottom of the Housing Market</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-20 @ 15:53:17</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45993943"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45993296">
          <h3>
            <a
              class="item"
              href="https://blog.google/technology/ai/nano-banana-pro/"
              >Nano Banana Pro</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-20 @ 15:04:23</span
              ><span class="points-container"
                >Points: <span class="points">406</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45993296"
                  >Comments</a
                ><span class="descendants">: 259</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45993214">
          <h3>
            <a
              class="item"
              href="https://okmij.org/ftp/Haskell/extensible/more.pdf"
              >Freer Monads, More Extensible Effects [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-20 @ 14:56:47</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45993214"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45992829">
          <h3>
            <a
              class="item"
              href="https://www.phoronix.com/news/Firefox-147-XDG-Base-Directory"
              >Firefox 147 Will Support the XDG Base Directory Specification</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-20 @ 14:20:49</span
              ><span class="points-container"
                >Points: <span class="points">208</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45992829"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45992403">
          <h3>
            <a
              class="item"
              href="https://caselaw.nationalarchives.gov.uk/ewhc/kb/2025/3063"
              >Judgement on Dr Matthew Garrett (@mjg59) vs. Dr Roy Schestowitz
              (Techrights.org)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-20 @ 13:37:13</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45992403"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45991853">
          <h3>
            <a class="item" href="https://chronodivide.com/"
              >Red Alert 2 in web browser</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-20 @ 12:21:15</span
              ><span class="points-container"
                >Points: <span class="points">260</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45991853"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45991787">
          <h3>
            <a
              class="item"
              href="https://www.npr.org/2025/11/18/nx-s1-5564064/calvin-and-hobbes-bill-watterson-40-years-comic-strip-lee-salem"
              >40 years ago, Calvin and Hobbes' burst onto the page</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-20 @ 12:08:56</span
              ><span class="points-container"
                >Points: <span class="points">273</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45991787"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45991738">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2511.15304"
              >Adversarial Poetry as a Universal Single-Turn Jailbreak Mechanism
              in LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-20 @ 12:01:26</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45991738"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45990934">
          <h3>
            <a class="item" href="http://geacron.com/home-en/"
              >Interactive World History Atlas Since 3000 BC</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-20 @ 09:52:11</span
              ><span class="points-container"
                >Points: <span class="points">221</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45990934"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45990575">
          <h3>
            <a
              class="item"
              href="https://www.dosdays.co.uk/topics/laptop_displays.php"
              >DOS Days – Laptop Displays</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-20 @ 09:04:30</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45990575"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45989329">
          <h3>
            <a
              class="item"
              href="https://materialdistrict.com/material/basalt-woven-textile/"
              >Basalt Woven Textile</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-20 @ 05:41:06</span
              ><span class="points-container"
                >Points: <span class="points">176</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45989329"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45987179">
          <h3>
            <a
              class="item"
              href="https://element.io/blog/verifying-your-devices-is-becoming-mandatory-2/"
              >Verifying your Matrix devices is becoming mandatory</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-20 @ 00:22:03</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45987179"
                  >Comments</a
                ><span class="descendants">: 202</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45985036">
          <h3>
            <a
              class="item"
              href="https://www.univie.ac.at/en/news/detail/forscherinnen-entdecken-grosse-sicherheitsluecke-in-whatsapp"
              >Researchers discover security vulnerability in WhatsApp</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-19 @ 20:55:30</span
              ><span class="points-container"
                >Points: <span class="points">291</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45985036"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45984659">
          <h3>
            <a
              class="item"
              href="https://www.ntsb.gov:443/news/press-releases/Pages/NR20251118.aspx"
              >Loose wire leads to blackout, contact with Francis Scott Key
              bridge</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-19 @ 20:26:43</span
              ><span class="points-container"
                >Points: <span class="points">407</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45984659"
                  >Comments</a
                ><span class="descendants">: 193</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45984133">
          <h3>
            <a
              class="item"
              href="https://www.tfeb.org/fragments/2025/11/18/the-lost-cause-of-the-lisp-machines/"
              >The lost cause of the Lisp machines</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-19 @ 19:44:07</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45984133"
                  >Comments</a
                ><span class="descendants">: 130</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45982649">
          <h3>
            <a class="item" href="https://openai.com/index/gpt-5-1-codex-max/"
              >Building more with GPT-5.1-Codex-Max</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-19 @ 18:01:59</span
              ><span class="points-container"
                >Points: <span class="points">462</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45982649"
                  >Comments</a
                ><span class="descendants">: 287</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45982073">
          <h3>
            <a class="item" href="https://ai.meta.com/sam3/"
              >Meta Segment Anything Model 3</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-19 @ 17:14:51</span
              ><span class="points-container"
                >Points: <span class="points">616</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45982073"
                  >Comments</a
                ><span class="descendants">: 122</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45980117">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/news/823750/european-union-ai-act-gdpr-changes"
              >Europe is scaling back GDPR and relaxing AI laws</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-19 @ 14:41:30</span
              ><span class="points-container"
                >Points: <span class="points">886</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45980117"
                  >Comments</a
                ><span class="descendants">: 1025</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45970885">
          <h3>
            <a
              class="item"
              href="https://utcc.utoronto.ca/~cks/space/blog/unix/ShebangRelativePathSurprise"
              >A surprise with how '#!' handles its program argument in
              practice</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-18 @ 19:32:27</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45970885"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45956438">
          <h3>
            <a
              class="item"
              href="https://ochagavia.nl/blog/towards-interplanetary-quic-traffic/"
              >Towards Interplanetary QUIC Traffic</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-17 @ 18:32:16</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45956438"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45951275">
          <h3>
            <a
              class="item"
              href="https://wiki.postmarketos.org/wiki/Dual_Booting/WiP"
              >Android/Linux Dual Boot</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-17 @ 06:28:16</span
              ><span class="points-container"
                >Points: <span class="points">239</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45951275"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45947437">
          <h3>
            <a class="item" href="https://jamesakl.com/posts/cuda-ontology/"
              >CUDA Ontology</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-16 @ 18:56:56</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45947437"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45939148">
          <h3>
            <a
              class="item"
              href="https://www.wreflection.com/p/wrapping-my-head-around-ai-wrappers"
              >Wrapping my head around AI wrappers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-15 @ 17:44:21</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45939148"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45934795">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Theft_of_The_Weeping_Woman_from_the_National_Gallery_of_Victoria"
              >Theft of the Weeping Woman from the National Gallery of
              Victoria</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-15 @ 03:26:22</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45934795"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45922610">
          <h3>
            <a
              class="item"
              href="https://www.sciencealert.com/scientists-reveal-how-the-maya-predicted-eclipses-for-centuries"
              >Scientists Reveal How the Maya Predicted Eclipses for
              Centuries</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-14 @ 00:51:20</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45922610"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45912704">
          <h3>
            <a
              class="item"
              href="https://newsroom.ibm.com/2025-11-12-ibm-delivers-new-quantum-processors,-software,-and-algorithm-breakthroughs-on-path-to-advantage-and-fault-tolerance"
              >IBM Delivers New Quantum Package</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-13 @ 09:24:53</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45912704"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45908801">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/new-proofs-probe-soap-film-singularities-20251112/"
              >New Proofs Probe Soap-Film Singularities</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-13 @ 00:18:21</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45908801"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45895100">
          <h3>
            <a
              class="item"
              href="https://blog.jetbrains.com/pycharm/2025/11/10-smart-performance-hacks-for-faster-python-code/"
              >Smart Performance Hacks for Faster Python Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-12 @ 00:55:13</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45895100"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
