<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="46505975">
          <h3>
            <a
              class="item"
              href="https://www.donutlab.com/ces-battery-announcement/"
              >Worlds's first all-solid-state battery ready to power up
              production vehicles now</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 22:28:46</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46505975"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46505735">
          <h3>
            <a
              class="item"
              href="https://calnewport.com/why-didnt-ai-join-the-workforce-in-2025/"
              >Why didn't AI "join the workforce" in 2025?</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 22:10:15</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46505735"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46505661">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-025-04102-4"
              >Migrating cells and the new science of microchimerism</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 22:03:52</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46505661"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <a href="https://archive.ph/pYnmy">https://archive.ph/pYnmy</a>
            </div>
          </section>
        </section>
        <section id="46505518">
          <h3>
            <a
              class="item"
              href="https://perishablepress.com/google-broke-my-heart/"
              >Google broke my heart</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 21:52:22</span
              ><span class="points-container"
                >Points: <span class="points">153</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46505518"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46505352">
          <h3>
            <a
              class="item"
              href="https://syriauntold.com/2025/12/27/keeping-syria-connected-during-war/"
              >Keeping Syria connected during war: Surviving ISIS and
              Intelligence</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 21:38:22</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46505352"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46504966">
          <h3>
            <a
              class="item"
              href="https://bostondynamics.com/blog/boston-dynamics-google-deepmind-form-new-ai-partnership/"
              >Boston Dynamics and DeepMind form new AI partnership</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 21:06:13</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46504966"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46504963">
          <h3>
            <a class="item" href="https://loworbitsecurity.com/radar/radar16/"
              >There were BGP anomalies during the Venezuela blackout</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 21:05:50</span
              ><span class="points-container"
                >Points: <span class="points">331</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46504963"
                  >Comments</a
                ><span class="descendants">: 166</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46503006">
          <h3>
            <a class="item" href="https://retool.com/pipes"
              >Pipe Dreams – The life and times of Yahoo Pipes (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 18:55:37</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46503006"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46502736">
          <h3>
            <a
              class="item"
              href="https://www.thebignewsletter.com/p/gatekeepers-of-law-inside-the-westlaw"
              >Gatekeepers of Law: Inside the Westlaw and LexisNexis Duopoly</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 18:35:17</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46502736"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46502665">
          <h3>
            <a class="item" href="https://github.com/wemush/open-standard"
              >Show HN: WOLS – Open standard for mushroom cultivation
              tracking</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 18:30:29</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46502665"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
            <div class="text">
              <p>
                v1.1 adds clonal generation tracking (distinct from
                filial/strain generations) and conforms to JSON-LD for
                interoperability with agricultural/scientific data systems.
              </p>
              <p>
                Spec (CC 4.0):
                <a href="https://wemush.com/open-standard/specification"
                  >https://wemush.com/open-standard/specification</a
                >
                Client libraries (Apache 2.0): Python + CLI: pip install wols
                (also on GHCR) TypeScript/JS: npm install @wemush/wols
              </p>
              <p>
                Background: Mycology has fragmented data practices
                (misidentified species, inconsistent cultivation logs, no shared
                vocabulary for tracking genetics across generations). This is an
                attempt to fix that.
              </p>
              <p>
                Looking for feedback from anyone working with biological
                specimen tracking, agricultural data systems, or mycology.
              </p>
            </div>
          </section>
        </section>
        <section id="46502652">
          <h3>
            <a class="item" href="https://wol.fm/blog/utopian-scholastic.html"
              >Utopian Scholastic</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 18:29:28</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46502652"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46502239">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/games/2026/jan/05/sega-co-founder-david-rosen-dies"
              >Sega co-founder David Rosen has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 18:00:32</span
              ><span class="points-container"
                >Points: <span class="points">153</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46502239"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46501894">
          <h3>
            <a
              class="item"
              href="https://brave.com/privacy-updates/36-adblock-memory-reduction/"
              >Brave overhauled its Rust adblock engine with FlatBuffers,
              cutting memory 75%</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 17:34:33</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46501894"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46501677">
          <h3>
            <a
              class="item"
              href="https://elbowgreasegames.substack.com/p/when-good-actors-can-trust-each-other"
              >How Y Combinator made it smart to trust founders</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 17:20:01</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46501677"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46501665">
          <h3>
            <a
              class="item"
              href="https://minha.sh/posts/so,-you-want-to-chunk-really-fast"
              >So, you want to chunk really fast?</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 17:19:33</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46501665"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46501309">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2026/01/01/realestate/fridge-law-los-angeles.html"
              >Los Angeles ends strange rite of passage with new fridge law</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 16:57:21</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46501309"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
            <div class="text">
              <a href="https://archive.ph/CG0Eq">https://archive.ph/CG0Eq</a>
            </div>
          </section>
        </section>
        <section id="46501137">
          <h3>
            <a class="item" href="https://github.com/Adversis/tailsnitch"
              >Show HN: Tailsnitch – A security auditor for Tailscale</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 16:47:23</span
              ><span class="points-container"
                >Points: <span class="points">189</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46501137"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46499646">
          <h3>
            <a class="item" href="https://donotnotify.com/"
              >Show HN: DoNotNotify – log and intelligently block notifications
              on Android</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 15:10:47</span
              ><span class="points-container"
                >Points: <span class="points">267</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46499646"
                  >Comments</a
                ><span class="descendants">: 112</span></span
              >
            </h4>
            <div class="text">
              <p>
                What - DoNotNotify is an app that logs all incoming
                notifications, and displays them grouped by app. It also
                captures the action behind the notification, which can be
                triggered from the app itself. From this log, you can create
                rules to whitelist/blacklist notifications from apps depending
                on their notification content. These filters can even be regex
                expressions, which allows for more complicated use-cases. The
                app ships with some pre-defined rules for popular apps like
                Facebook, Amazon, Instagram, Netflix, TikTok, Reddit etc.
              </p>
              <p>
                Where - The website is at
                <a href="https://donotnotify.com/">https://donotnotify.com/</a>.
              </p>
              <p>
                Would also like to call out that the app runs purely on your
                device, never communicates with anything on the Internet, and
                only requires notifications access to work. It is completely
                free, and there is no advertising or hidden gotchas.
              </p>
            </div>
          </section>
        </section>
        <section id="46499425">
          <h3>
            <a
              class="item"
              href="https://blog.hris.to/./dealing-with-abandonware.html"
              >Dealing with abandonware (2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 14:53:23</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46499425"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46498735">
          <h3>
            <a
              class="item"
              href="https://tenthousandmeters.com/blog/i-switched-from-vscode-to-zed/"
              >I switched from VSCode to Zed</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 13:52:17</span
              ><span class="points-container"
                >Points: <span class="points">217</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46498735"
                  >Comments</a
                ><span class="descendants">: 224</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46497712">
          <h3>
            <a class="item" href="https://tonsky.me/blog/tahoe-icons/"
              >It's hard to justify Tahoe icons</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 11:51:42</span
              ><span class="points-container"
                >Points: <span class="points">2084</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46497712"
                  >Comments</a
                ><span class="descendants">: 813</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46496103">
          <h3>
            <a
              class="item"
              href="https://www.cs.cmu.edu/~pavlo/blog/2026/01/2025-databases-retrospective.html"
              >Databases in 2025: A Year in Review</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-05 @ 07:14:30</span
              ><span class="points-container"
                >Points: <span class="points">514</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46496103"
                  >Comments</a
                ><span class="descendants">: 149</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46491129">
          <h3>
            <a class="item" href="https://www.koreaherald.com/article/10648326"
              >Six-decade math puzzle solved by Korean mathematician</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-04 @ 19:10:31</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46491129"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46488883">
          <h3>
            <a class="item" href="https://www.djmurphy.net/blog/clo-gaelach/"
              >Adding insular script like it's 1626</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-04 @ 15:31:07</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46488883"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46472040">
          <h3>
            <a
              class="item"
              href="https://krebsonsecurity.com/2026/01/the-kimwolf-botnet-is-stalking-your-local-network/"
              >The Kimwolf botnet is stalking your local network</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-03 @ 02:04:29</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46472040"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46470513">
          <h3>
            <a class="item" href="https://arxiv.org/abs/1803.03635"
              >The Lottery Ticket Hypothesis: finding sparse trainable NNs with
              90% less params</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-02 @ 22:53:53</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46470513"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46466027">
          <h3>
            <a
              class="item"
              href="https://andrew.grahamyooll.com/blog/Try-to-Take-My-Position/"
              >Try to take my position: The best promotion advice I ever got</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-02 @ 15:56:14</span
              ><span class="points-container"
                >Points: <span class="points">208</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46466027"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46465335">
          <h3>
            <a
              class="item"
              href="https://repebble.com/blog/pebble-round-2-the-most-stylish-pebble-ever"
              >Pebble Round 2</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-02 @ 14:56:28</span
              ><span class="points-container"
                >Points: <span class="points">288</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46465335"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.youtube.com/watch?v=NaDPMZKXcBU"
                >https://www.youtube.com/watch?v=NaDPMZKXcBU</a
              >
              <p>
                <a
                  href="https://techcrunch.com/2026/01/02/pebble-reboots-its-thinnest-smartwatch-with-the-pebble-round-2/"
                  >https://techcrunch.com/2026/01/02/pebble-reboots-its-thinnes...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="46458936">
          <h3>
            <a
              class="item"
              href="https://steve-yegge.medium.com/welcome-to-gas-town-4f25ee16dd04"
              >Welcome to Gas Town</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-01 @ 22:36:50</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46458936"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46441154">
          <h3>
            <a
              class="item"
              href="https://blog.veritates.love/selective_applicatives_theoretical_basis.html"
              >Selective Applicative Functors</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-31 @ 04:07:00</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46441154"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2026/index.md"
              >2026</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
