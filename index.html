<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42461428">
          <h3>
            <a class="item" href="https://taylor.town/santa-prefers"
              >Santa Prefers Wealthy Sick Children</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 13:59:47</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42461428"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42461378">
          <h3>
            <a
              class="item"
              href="https://blog.mozilla.org/en/mozilla/internet-policy/google-remedies-browsers/"
              >Mozilla: Proposals in US vs. Google threaten vital role of
              independent browsers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 13:53:36</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42461378"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42458752">
          <h3>
            <a
              class="item"
              href="https://www.anthropic.com/research/alignment-faking"
              >Alignment faking in large language models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 05:43:29</span
              ><span class="points-container"
                >Points: <span class="points">160</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42458752"
                  >Comments</a
                ><span class="descendants">: 130</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42458599">
          <h3>
            <a class="item" href="https://github.com/shapr/markovkeyboard"
              >Markov Keyboard: keyboard layout that changes by Markov frequency
              (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 05:12:08</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42458599"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42458431">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/technology/amazon-workers-strike-multiple-us-warehouses-during-busy-holiday-season-2024-12-19/"
              >Amazon workers to strike at multiple US warehouses during busy
              holiday season</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 04:27:28</span
              ><span class="points-container"
                >Points: <span class="points">239</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42458431"
                  >Comments</a
                ><span class="descendants">: 207</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42457816">
          <h3>
            <a class="item" href="https://github.com/glacambre/firenvim"
              >Firenvim – Turn the browser into a Neovim client</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 02:34:11</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42457816"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42457782">
          <h3>
            <a class="item" href="https://github.com/Z-Gort/Reservoirs-Lab"
              >Show HN: Postgres as a VectorDB GUI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 02:28:36</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42457782"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42457712">
          <h3>
            <a class="item" href="https://damcraft.de/blog/exposing-the-cuii"
              >Exposing the Clearingstelle Urheberrecht Im Internet (CUII)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 02:19:36</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42457712"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42457515">
          <h3>
            <a
              class="item"
              href="https://greptime.com/blogs/2024-05-07-error-rust"
              >Error Stacking in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 01:47:05</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42457515"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42457321">
          <h3>
            <a class="item" href="https://github.com/garyexplains/piccolo_os_v1"
              >Piccolo OS, a Small Multitasking OS for the Raspberry Pi Pico</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 01:14:39</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42457321"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42457213">
          <h3>
            <a
              class="item"
              href="https://genesis-world.readthedocs.io/en/latest/"
              >Genesis – a generative physics engine for general-purpose
              robotics</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-19 @ 00:54:48</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42457213"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42456585">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2401.05375"
              >Classical sorting algorithms as a model of morphogenesis
              (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-18 @ 23:17:56</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42456585"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42456310">
          <h3>
            <a class="item" href="https://purplesyringa.moe/blog/the-ram-myth/"
              >The RAM Myth</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-18 @ 22:43:27</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42456310"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42454929">
          <h3>
            <a
              class="item"
              href="https://horstmann.com/unblog/2024-12-11/index.html"
              >Java in the Small</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-18 @ 20:42:54</span
              ><span class="points-container"
                >Points: <span class="points">253</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42454929"
                  >Comments</a
                ><span class="descendants">: 204</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42454359">
          <h3>
            <a class="item" href="https://github.com/pwr-Solaar/Solaar"
              >Solaar is a Linux manager for many Logitech keyboards, mice, and
              other devices</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-18 @ 19:57:58</span
              ><span class="points-container"
                >Points: <span class="points">536</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42454359"
                  >Comments</a
                ><span class="descendants">: 219</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42451707">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42451707"
              >Launch HN: Innate (YC F24) – Home robots as easy to program as AI
              agents</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-18 @ 16:09:56</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42451707"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
            <div class="text">
              <a href="https://innate.bot">https://innate.bot</a>). We build
              general-purpose home robots that you can teach new tasks to simply
              by demonstrating them.
              <p>
                Our system combines a robotic platform (we call the first one
                Maurice) with an AI agent that understands the environment,
                plans actions, and executes them using skills you've taught it
                or programmed within our SDK.
              </p>
              <p>
                If you’ve been building AI agents powered by LLMs before, and in
                particular Claude Computer use, this is how we intend the
                experience of building on it to be, but acting on the real
                world!
              </p>
              <p>
                You can see Maurice serving a glass here (<a
                  href="https://bit.ly/innate-hn-vid-serving"
                  >https://bit.ly/innate-hn-vid-serving</a
                >). Here is another example (<a
                  href="https://bit.ly/innate-hn-vid-officer"
                  >https://bit.ly/innate-hn-vid-officer</a
                >) in which it was given a digital ability (through the SDK) to
                send a notification to your phone, to use when it sees someone
                in the house. In both these cases, the only work you have to do
                is spend 30mn per physical skill to collect data to train the
                arm, and a couple minutes to write a system prompt.
              </p>
              <p>
                You can read more about how it works, about the paradigm we’re
                creating and find our Discord in our documentation (<a
                  href="https://docs.innate.bot"
                  >https://docs.innate.bot</a
                >). We’ll be open-sourcing parts of the system there soon.
              </p>
              <p>
                We want to lower the barrier to entry to robotics. Programming
                robots is usually complicated, time-consuming, and limited to
                experts even with AI helping you write code. We think it should
                be easier.
              </p>
              <p>
                We’re coming from an AI for robotics and HCI background as
                researchers at Stanford, and we’ve worked on multiple hardware +
                agentic AI projects this past year, but this one was clearly the
                most surprising one.
              </p>
              <p>
                The first time we put GPT-4 in a body - after a couple tweaks -
                we were surprised at how well it worked. The robot started
                moving around, figuring out when to use a tiny gripper, and we
                had only written 40 lines of python on a tiny RC car with an
                arm. We decided to combine that with recent advancements in
                robot imitation learning such as ALOHA to make the arm quickly
                teachable to do any task.
              </p>
              <p>
                We think it should be simple to teach robots to do tasks for us.
                AI agents offer a completely new paradigm for this, easy enough
                to help many non-roboticists start in the field, but still
                expandable enough to make a robot able to do very complex tasks.
              </p>
              <p>
                The part of it that excites us most is that for every builder
                teaching their robot to perform a task, every other robot learns
                faster and better. We believe that by spreading our platforms as
                much as possible, we could crowdsource massive and diverse
                datasets to make robotics foundations models that everyone
                contributes to.
              </p>
              <p>
                Under the hood, our brain (running in the cloud) uses 9
                different models and runs in the cloud. A YOLO, a SAM, and 7
                VLMs, from OpenAI, Google, Anthropic, and most importantly a
                couple Llamas running on groq to make the system think and act
                faster. Each model has a responsibility. Together, they act as
                if it was only one model with ability to navigate, talk,
                memorize and activate skills. As a bonus, since these models
                keep getting better and smaller, every new release gets our
                robots smarter and faster!
              </p>
              <p>
                Our first robot Maurice is 25cm-high, has a 5DoF arm, a Jetson
                Orin Nano onboard, and comes equipped with our software
                installed and a mobile app to control it. Our first batch of
                users wants to teach it to clean floors, tidy up after kids,
                wake them up in the morning, play with them, or be a
                professional assistant connected to emails and socials. You can
                go wild quickly!
              </p>
              <p>
                We’re making a small batch available for HackerNews at $2,000
                each for early builders who want to experiment, with $50 free of
                agent per month for a year. You can book one on our website with
                a (refundable) deposit if you’re in the US. These units will
                start shipping in March - the first 10 were booked already for
                February.
              </p>
              <p>
                We’d love your thoughts, experiences, and critiques. If you have
                ideas on what you’d use a home robot for, or feedback on how to
                make these systems more accessible, we’re hanging around for the
                coming hours in the comments. Let us know what you think!
              </p>
            </div>
          </section>
        </section>
        <section id="42450413">
          <h3>
            <a
              class="item"
              href="https://www.uscis.gov/newsroom/news-releases/dhs-strengthens-h-1b-program-allowing-us-employers-to-more-quickly-fill-critical-jobs"
              >Updates to H-1B</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-18 @ 13:54:05</span
              ><span class="points-container"
                >Points: <span class="points">387</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42450413"
                  >Comments</a
                ><span class="descendants">: 1097</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42449647">
          <h3>
            <a
              class="item"
              href="https://www.nationalarchives.gov.uk/20s-people/20sstreets/khalid-sheldrake-the-east-dulwich-man-who-would-be-king/"
              >Khalid Sheldrake: The East Dulwich man who would be King</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-18 @ 11:25:48</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42449647"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42449424">
          <h3>
            <a
              class="item"
              href="https://www.theatlantic.com/business/archive/2014/10/the-artist-who-trained-rats-to-trade-in-foreign-exchange-markets/381456/"
              >An artist who trained rats to trade in foreign-exchange
              markets</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-18 @ 10:29:38</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42449424"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42449102">
          <h3>
            <a
              class="item"
              href="https://medium.com/@maxamel2002/2024-world-chess-championship-analysis-empirical-synthesized-approach-98dd79920d2b"
              >Analyzing the World Chess Championship 2024: Empirical
              synthesized approach</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-18 @ 09:15:44</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42449102"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42444817">
          <h3>
            <a
              class="item"
              href="https://www.texasmonthly.com/being-texan/in-defense-of-yall-nyt-columnist/"
              >In Defense of Y'All</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-17 @ 20:12:18</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42444817"
                  >Comments</a
                ><span class="descendants">: 211</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42443229">
          <h3><a class="item" href="https://ciechanow.ski/moon/">Moon</a></h3>
          <section>
            <h4>
              <span>2024-12-17 @ 17:26:26</span
              ><span class="points-container"
                >Points: <span class="points">2972</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42443229"
                  >Comments</a
                ><span class="descendants">: 248</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42442354">
          <h3>
            <a
              class="item"
              href="https://increase.com/articles/iso-8583-the-language-of-credit-cards"
              >ISO 8583: The language of credit cards</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-17 @ 15:53:52</span
              ><span class="points-container"
                >Points: <span class="points">341</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42442354"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42441502">
          <h3>
            <a
              class="item"
              href="https://www.macrumors.com/2024/12/16/black-magic-3d-vision-pro-camera/"
              >Blackmagic Debuts $30K 3D Camera for Capturing Video for Vision
              Pro</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-17 @ 14:18:53</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42441502"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42440922">
          <h3>
            <a
              class="item"
              href="https://felleisen.org/matthias/Thoughts/Developing_Developers.html"
              >Developing Developers (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-17 @ 12:46:16</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42440922"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42438063">
          <h3>
            <a
              class="item"
              href="https://www.adn.com/alaska-life/2024/12/15/torpedo-juice-the-legendary-illegal-world-war-ii-liquor-drunk-in-alaska-and-across-the-world/"
              >Torpedo juice: Legendary, illegal WWII liquor drunk in Alaska and
              the world</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-17 @ 03:28:18</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42438063"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42435620">
          <h3>
            <a class="item" href="https://verdagon.dev/grimoire/grimoire#"
              >Borrow Checking, RC, GC, and Eleven Other Memory Safety
              Approaches</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-16 @ 21:25:44</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42435620"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42432374">
          <h3>
            <a
              class="item"
              href="https://abishekmuthian.com/apple-watch-with-android/"
              >Apple Watch with Android</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-16 @ 16:15:43</span
              ><span class="points-container"
                >Points: <span class="points">204</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42432374"
                  >Comments</a
                ><span class="descendants">: 122</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42425770">
          <h3>
            <a
              class="item"
              href="https://mascontext.com/issues/trace/kowloon-walled-city-heterotopia-in-a-space-of-disappearance"
              >Kowloon Walled City: Heterotopia in a Space of Disappearance
              (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-15 @ 20:30:04</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42425770"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42421689">
          <h3>
            <a
              class="item"
              href="https://www.psypost.org/scientists-sheds-light-on-how-our-brains-create-mental-chapters-with-new-event-segmentation-study/"
              >Our brains create mental "chapters" with new event segmentation
              study</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-15 @ 05:29:37</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42421689"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
