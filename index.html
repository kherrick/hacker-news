<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37725634">
          <h3>
            <a
              class="item"
              href="https://www.datatilsynet.no/en/news/aktuelle-nyheter-2023/meta-case-brought-to-the-european-level/"
              >Meta case brought to the European level</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-01 @ 13:14:54</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37725634"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37725530">
          <h3>
            <a
              class="item"
              href="https://bigthink.com/starts-with-a-bang/pulsars-dark-matter-milky-way-antimatter/"
              >Pulsars, not dark matter, explain the Milky Way’s antimatter</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-01 @ 13:00:28</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37725530"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37725498">
          <h3>
            <a class="item" href="https://www.bing.com/images/create/?ref=hn"
              >DALL-E 3 is now publicly available inside Bing</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-01 @ 12:57:16</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37725498"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37725264">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=37725264"
              >Ask HN: Whats the modern day equivalent of 80s computer for kids
              to explore?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-01 @ 12:24:55</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37725264"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
            <div class="text">
              <p>
                Was thinking about getting a system to play games in the house
                but my feeling is that theres no technical lift for installing
                playing games. That playing the game was enough of an incentive
                to figure out the shell.
              </p>
              <p>Curious if anyone has ideas. Thanks!</p>
            </div>
          </section>
        </section>
        <section id="37725261">
          <h3>
            <a
              class="item"
              href="https://www.dezeen.com/2023/09/29/mypowerbank-hacks-santander-bikes-homeless-charge-phones/"
              >MyPowerbank hacks Santander bikes so London's homeless can charge
              their phones</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-01 @ 12:24:17</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37725261"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37725229">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-09-hermit-eccentric-french-math-genius.html"
              >Hermit 'scribblings' of French math genius Alexander Grothendieck
              unveiled</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-01 @ 12:18:45</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37725229"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37725115">
          <h3>
            <a
              class="item"
              href="https://www.vice.com/en/article/pkamgm/people-experience-new-dimensions-of-reality-when-dying-groundbreaking-study-reports"
              >Groundbreaking Study: People Experience ‘New Dimensions of
              Reality' When Dying</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-01 @ 12:02:13</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37725115"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37724861">
          <h3>
            <a class="item" href="https://www.adept.ai/blog/flashier-attention"
              >FlashAttention: Fast Transformer training with long sequences</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-01 @ 11:23:00</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37724861"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37724776">
          <h3>
            <a
              class="item"
              href="https://www.sciencedirect.com/science/article/pii/S0315086017300691"
              >Plimpton 322 is Babylonian exact sexagesimal trigonometry</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-01 @ 11:08:06</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37724776"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37724737">
          <h3>
            <a class="item" href="https://longform.asmartbear.com/say-yes/"
              >Never say “no,” but rarely say “yes.”</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-01 @ 11:01:44</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37724737"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37724538">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/09/29/mozilla_asleep_at_wheel/"
              >Mozilla's midlife crisis has taken it from pioneer to Google's
              weird neighbor</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-01 @ 10:27:22</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37724538"
                  >Comments</a
                ><span class="descendants">: 131</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37724268">
          <h3>
            <a
              class="item"
              href="https://road.cc/content/news/bike-thief-convicted-after-mother-victim-protests-304143"
              >Where's My Bike Dave?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-01 @ 09:33:01</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37724268"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37724161">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=5pYeoZaoWrA"
              >This is Financial Advice [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-01 @ 09:11:30</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37724161"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37723688">
          <h3>
            <a class="item" href="https://diziet.dreamwidth.org/16025.html"
              >DKIM: Rotate and Publish Your Keys</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-01 @ 07:44:29</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37723688"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37723372">
          <h3>
            <a
              class="item"
              href="https://www.chaos-engineering.dev/p/decentralized-artificial-intelligence"
              >Decentralized Artificial Intelligence</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-01 @ 06:45:01</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37723372"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37722248">
          <h3>
            <a
              class="item"
              href="https://journal.stuffwithstuff.com/2023/08/04/representing-heterogeneous-data/"
              >Representing Heterogeneous Data</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-01 @ 03:25:43</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37722248"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37722244">
          <h3>
            <a
              class="item"
              href="https://www.merriam-webster.com/grammar/couple-few-several-use"
              >'Couple,' 'Few,' and 'Several'</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-01 @ 03:24:53</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37722244"
                  >Comments</a
                ><span class="descendants">: 164</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37722114">
          <h3>
            <a
              class="item"
              href="https://www.newscientist.com/article/2391584-watch-a-frog-like-robot-use-tiny-explosions-to-hop-around/"
              >Watch a frog-like robot use tiny explosions to hop around</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-01 @ 02:55:51</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37722114"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37722013">
          <h3>
            <a
              class="item"
              href="https://www.aljazeera.com/features/2023/9/29/indias-pickle-people-decades-old-culinary-heirlooms-nostalgia"
              >India’s pickle people: Decades-old culinary heirlooms,
              nostalgia</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-01 @ 02:34:15</span
              ><span class="points-container"
                >Points: <span class="points">163</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37722013"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37721584">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/news/research-on-lk-99-continues-paper-says-superconductivity-could-be-possible"
              >LK-99 Research Continues, Paper Says Superconductivity Could Be
              Possible</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-01 @ 01:13:50</span
              ><span class="points-container"
                >Points: <span class="points">157</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37721584"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37721016">
          <h3>
            <a class="item" href="https://desfontain.es/thesis/"
              >Lowering the Cost of Anonymization (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-30 @ 23:35:28</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37721016"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37720976">
          <h3>
            <a class="item" href="https://nullprogram.com/blog/2023/09/30/"
              >An easy-to-implement, arena-friendly hash map</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-30 @ 23:29:24</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37720976"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37720806">
          <h3>
            <a
              class="item"
              href="https://embeddedartistry.com/blog/2017/05/22/werror-is-not-your-friend/"
              >-Werror Is not your friend (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-30 @ 23:04:13</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37720806"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37720580">
          <h3>
            <a
              class="item"
              href="https://www.welivesecurity.com/en/eset-research/lazarus-luring-employees-trojanized-coding-challenges-case-spanish-aerospace-company/"
              >Fake recruiter lured aerospace employee with trojanized coding
              challenge</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-30 @ 22:36:21</span
              ><span class="points-container"
                >Points: <span class="points">271</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37720580"
                  >Comments</a
                ><span class="descendants">: 127</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37719050">
          <h3>
            <a
              class="item"
              href="https://www.sapiens.org/archaeology/human-migration-asia/"
              >Dating the Arrival of Modern Humans in Asia</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-30 @ 19:48:06</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37719050"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37718764">
          <h3>
            <a
              class="item"
              href="https://aeon.co/essays/why-it-pays-to-read-for-acrostics-in-the-classics"
              >Vergil’s Message</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-30 @ 19:16:59</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37718764"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37716722">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/opinion/articles/2023-09-30/how-many-people-are-there-in-the-world-don-t-worry-about-it"
              >Most demographers now predict that human population will
              plateau</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-30 @ 16:00:11</span
              ><span class="points-container"
                >Points: <span class="points">210</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37716722"
                  >Comments</a
                ><span class="descendants">: 745</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37713923">
          <h3>
            <a
              class="item"
              href="https://emptycity.substack.com/p/computer-says-guilty-an-introduction"
              >The presumption that computers are working correctly</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-30 @ 09:34:57</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37713923"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37713530">
          <h3>
            <a class="item" href="https://flexboxfroggy.com/">Flexbox Froggy</a>
          </h3>
          <section>
            <h4>
              <span>2023-09-30 @ 08:05:12</span
              ><span class="points-container"
                >Points: <span class="points">422</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37713530"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37704760">
          <h3>
            <a class="item" href="https://punkx.org/overflow/"
              >Show HN: RISC-V assembly tabletop board game (hack your
              opponent)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-29 @ 14:25:35</span
              ><span class="points-container"
                >Points: <span class="points">365</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37704760"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
            <div class="text">
              <p>
                Building your exploit in memory and jumping to it feels so cool.
                I hope this game teaches kids and programmers (who seem to have
                forgotten what computers actually are) that its quite fun to
                mess with programs. We used to have that excitement few years
                ago, just break into softice and change a branch into a nop and
                ignore the serial number check, or go to a different game level
                because this one is too annoying.
              </p>
              <p>
                While working on the game I kept thinking what we have lost from
                6502 to Apple Silicon, and the transition from 'personal
                computers' to 'you are completely not responsible for most the
                code running on your device', it made me a bit sad and happy in
                the same time, RISCV seems like a breath of fresh air, and many
                hackers will build many new things, new protocols, new networks,
                new programs. As PI4 cost increases, the esp32 cost is
                decreasing, we have transparent displays for 20$, good computers
                for 5$, cheap lora, and etc. Everything is more accessible than
                ever.
              </p>
              <p>
                I played with a friend who saw completely different exploits
                than me, and I learned a lot just from few games, and because of
                the complexity of the game its often you enter into a position
                that you get surprised by your own actions :) So if you manage
                to find at least one friend who is not completely stunned by the
                assembler, I think you will have some good time.
              </p>
              <p>
                A huge inspiration comes from phrack 49's 'Smashing The Stack
                For Fun And Profit' which has demystified the stack for me:
                <a href="http://phrack.org/issues/49/14.html#article"
                  >http://phrack.org/issues/49/14.html#article</a
                >
              </p>
              <p>TLDR: computers are fun, and you can make them do things.</p>
              <p>
                PS: In order to play with my friends I also built esp32
                helper[1] that keeps track of the game state, and when I built
                it and wrote the code and everything I realized I could've just
                media queried the web version of the game.. but anyway, its way
                cooler to have a board game contraption.
              </p>
              <p>
                [1]:
                <a href="https://punkx.org/overflow/esp32.html"
                  >https://punkx.org/overflow/esp32.html</a
                >
              </p>
            </div>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
