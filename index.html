<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="46170402">
          <h3>
            <a class="item" href="https://browsewithnook.com">Nook Browser</a>
          </h3>
          <section>
            <h4>
              <span>2025-12-06 @ 03:32:56</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46170402"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46170332">
          <h3>
            <a
              class="item"
              href="https://engineerguy.com/fourier/pdfs/albert-michelsons-harmonic-analyzer.pdf"
              >Albert Michelson's Harmonic Analyzer (2014) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-06 @ 03:21:46</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46170332"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46170309">
          <h3>
            <a
              class="item"
              href="https://dmitry.gr/?r=05.Projects&amp;proj=27.%20rePalm#pixter"
              >PalmOS on FisherPrice Pixter Toy</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-06 @ 03:17:44</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46170309"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46170302">
          <h3>
            <a class="item" href="https://haveibeenflocked.com/"
              >Have I been Flocked? – Check if your license plate is being
              watched</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-06 @ 03:16:35</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46170302"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46169554">
          <h3>
            <a
              class="item"
              href="https://www.ynetnews.com/tech-and-digital/article/bj1qbwcklg"
              >YouTube caught making AI-edits to videos and adding misleading AI
              summaries</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-06 @ 01:15:48</span
              ><span class="points-container"
                >Points: <span class="points">210</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46169554"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46169330">
          <h3>
            <a
              class="item"
              href="http://www.ffd2.com/fridge/docs/6502-NMOS.extra.opcodes"
              >Extra Instructions Of The 65XX Series CPU (1996)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-06 @ 00:38:50</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46169330"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46169224">
          <h3>
            <a
              class="item"
              href="https://www.mooreslawisdead.com/post/sam-altman-s-dirty-dram-deal"
              >Sam Altman’s DRAM Deal</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-06 @ 00:24:55</span
              ><span class="points-container"
                >Points: <span class="points">218</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46169224"
                  >Comments</a
                ><span class="descendants">: 184</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46168057">
          <h3>
            <a
              class="item"
              href="https://genomicpress.kglmeridian.com/view/journals/brainmed/aop/article-10.61373-bm025c.0134/article-10.61373-bm025c.0134.xml"
              >Adenosine on the common path of rapid antidepressant action: The
              coffee paradox</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-05 @ 22:10:50</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46168057"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46167621">
          <h3>
            <a
              class="item"
              href="https://www.bbc.co.uk/news/articles/c5y2p22z9gno"
              >Frank Gehry has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-05 @ 21:31:40</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46167621"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46167552">
          <h3>
            <a
              class="item"
              href="https://www.brendangregg.com/blog//2025-12-05/leaving-intel.html"
              >Leaving Intel</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-05 @ 21:27:04</span
              ><span class="points-container"
                >Points: <span class="points">175</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46167552"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46167500">
          <h3>
            <a
              class="item"
              href="https://www.bitsaboutmoney.com/archive/perpetual-futures-explained/"
              >Perpetual futures, explained</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-05 @ 21:23:03</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46167500"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46167349">
          <h3>
            <a class="item" href="https://github.com/W4G1/multithreading"
              >The missing standard library for multithreading in JavaScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-05 @ 21:09:11</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46167349"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46166708">
          <h3>
            <a class="item" href="https://susam.net/fizz-buzz-in-css.html"
              >Fizz Buzz in CSS</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-05 @ 20:18:22</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46166708"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46163977">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=46163977"
              >Onlook (YC W25) the Cursor for Designers Is Hiring a Founding
              Fullstack Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-05 @ 17:00:10</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
            <div class="text">
              <p>
                Since launching, Onlook hit #1 on Hacker News, was the #1
                trending repo on GitHub—above DeepSeek + Anthropic—and has
                earned over 23,000 GitHub stars. We’re looking to bring on
                Onlook’s first Founding Engineers.
              </p>
              <p>
                This role requires autonomy - you’ll be setting standards for
                one of the fastest-growing open source projects backed by YC
                ever. You’ll help design and build an uncompromising visual IDE
                loved by tens of thousands of designers and engineers around the
                world, and you'll have a heavy influence on the direction of
                where we take the company.
              </p>
              <p>
                You’re a full-stack engineer based in the U.S. who is ultra
                comfortable in Typescript, NextJS, React, and Tailwind, and
                ready to jump-in and build.
              </p>
              <p>The most important things we look for:</p>
              <p>
                • Olympic-level dedication – you want to be the best in the
                world at what you do.
              </p>
              <p>
                • Ownership – you like autonomy and control over the destiny of
                the company.
              </p>
              <p>
                • Speed – you’re comfortable shipping and iterating quickly with
                feedback.
              </p>
              <p>
                • Craft – you’re opinionated and are willing to defend your
                opinions.
              </p>
              <p>Ideally, you:</p>
              <p>• Are looking for a fast-paced, early startup environment.</p>
              <p>• Are willing to put in long hours and go the extra mile.</p>
              <p>
                • Are comfortable with any part of the stack, front-end,
                back-end, or database.
              </p>
              <p>
                • Believe in open source and are ok with your work being very
                public.
              </p>
              <p>
                The comp range for this role is $130k-200k, 1-5% equity, great
                healthcare + other perks, and an awesome office if you happen to
                be in SF. We're open to remote / hybrid candidates.
              </p>
              <p>
                If you’d like to stand out, please share a project or piece of
                work that you’re most proud of. We love seeing people’s work. If
                you have a personal website, please include that as well.
              </p>
              <p>
                If you're interested, email daniel@onlook.com with your Github /
                LinkedIn / Website or work samples and why you'd be a great
                addition to the team, or apply here:
                <a
                  href="https://www.ycombinator.com/companies/onlook/jobs/e4gHv1n-founding-engineer-fullstack"
                  >https://www.ycombinator.com/companies/onlook/jobs/e4gHv1n-fo...</a
                >
              </p>
              <p>Excited to meet, and build alongside you!</p>
            </div>
          </section>
        </section>
        <section id="46163609">
          <h3>
            <a
              class="item"
              href="https://corrode.dev/blog/defensive-programming/"
              >Patterns for Defensive Programming in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-05 @ 16:34:25</span
              ><span class="points-container"
                >Points: <span class="points">239</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46163609"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46163308">
          <h3>
            <a
              class="item"
              href="https://blog.google/technology/developers/gemini-3-pro-vision/"
              >Gemini 3 Pro: the frontier of vision AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-05 @ 16:15:10</span
              ><span class="points-container"
                >Points: <span class="points">407</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46163308"
                  >Comments</a
                ><span class="descendants">: 203</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46163121">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=46163121"
              >I'm Peter Roberts, immigration attorney who does work for YC and
              startups. AMA</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-05 @ 16:04:20</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46163121"
                  >Comments</a
                ><span class="descendants">: 231</span></span
              >
            </h4>
            <div class="text">
              <p>
                Previous threads we've done:
                <a href="https://news.ycombinator.com/submitted?id=proberts"
                  >https://news.ycombinator.com/submitted?id=proberts</a
                >.
              </p>
            </div>
          </section>
        </section>
        <section id="46162656">
          <h3>
            <a
              class="item"
              href="https://blog.cloudflare.com/5-december-2025-outage/"
              >Cloudflare outage on December 5, 2025</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-05 @ 15:35:43</span
              ><span class="points-container"
                >Points: <span class="points">606</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46162656"
                  >Comments</a
                ><span class="descendants">: 455</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46160773">
          <h3>
            <a
              class="item"
              href="https://blog.joeschrag.com/2023/11/most-technical-problems-are-really.html"
              >Most technical problems are people problems</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-05 @ 13:07:59</span
              ><span class="points-container"
                >Points: <span class="points">368</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46160773"
                  >Comments</a
                ><span class="descendants">: 274</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46160698">
          <h3>
            <a class="item" href="https://matduggan.com/making-rss-more-fun/"
              >Making RSS More Fun</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-05 @ 13:00:28</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46160698"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46160315">
          <h3>
            <a
              class="item"
              href="https://about.netflix.com/en/news/netflix-to-acquire-warner-bros"
              >Netflix to Acquire Warner Bros</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-05 @ 12:21:19</span
              ><span class="points-container"
                >Points: <span class="points">1542</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46160315"
                  >Comments</a
                ><span class="descendants">: 1175</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46155135">
          <h3>
            <a
              class="item"
              href="https://netflixtechblog.com/av1-now-powering-30-of-netflix-streaming-02f592242d80"
              >Netflix’s AV1 Journey: From Android to TVs and Beyond</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-05 @ 00:09:57</span
              ><span class="points-container"
                >Points: <span class="points">491</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46155135"
                  >Comments</a
                ><span class="descendants">: 256</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46130260">
          <h3>
            <a
              class="item"
              href="https://hackclub.com/fiscal-sponsorship/mobile/"
              >Show HN: HCB Mobile – financial app built by 17 y/o, processing
              $6M/month</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-03 @ 04:20:44</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46130260"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
            <div class="text">
              <p>
                One of my biggest challenges, while juggling being a full-time
                student, was getting permission from Apple/Google to use
                advanced native features such as Tap to Pay (for in-person
                donations) and Push Provisioning (for adding your card to your
                digital wallet). It was months of back-and-forth emails, test
                case recordings, and also compliance checks.
              </p>
              <p>
                Even after securing Apple/Google’s permission, any minor fix
                required publishing a new build, which was time-consuming. After
                dealing with this for a while, I adopted the idea of “over the
                air updates” using Expo’s EAS update service. This allowed me to
                remotely trigger updates without needing a new app build.
              </p>
              <p>
                The 250 hours I spent building this app were an INSANE learning
                experience, but it was also a whole lot of fun. Give the app a
                try, and I’d love any feedback you have on it!
              </p>
              <p>
                btw, back in March, we open-sourced this nonprofit neobank on
                GitHub.
                <a href="https://news.ycombinator.com/item?id=43519802"
                  >https://news.ycombinator.com/item?id=43519802</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="46128238">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=6orsmFndx_o"
              >Ivan Sutherland Sketchpad Demo 1963 [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-02 @ 23:13:54</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46128238"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46126380">
          <h3>
            <a class="item" href="https://frinkiac.com/"
              >Frinkiac – 3M "The Simpsons" Screencaps</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-02 @ 20:28:18</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46126380"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46112560">
          <h3>
            <a
              class="item"
              href="https://signoregalilei.com/2025/11/12/tides-are-weirder-than-you-think/"
              >Tides are weirder than you think</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-01 @ 20:14:53</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46112560"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46106411">
          <h3>
            <a
              class="item"
              href="https://www.morling.dev/blog/on-idempotency-keys/"
              >Idempotency keys for exactly-once processing</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-12-01 @ 12:07:33</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46106411"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46098655">
          <h3>
            <a
              class="item"
              href="https://youtu.be/nKVq9u52A-c?si=KVY6AK7tsudqnbJN"
              >Making tiny 0.1cc two stroke engine from scratch</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-30 @ 17:34:46</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46098655"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46095087">
          <h3>
            <a
              class="item"
              href="https://michael.stapelberg.ch/posts/2025-11-29-self-hosting-photos-with-immich/"
              >Self-hosting my photos with Immich</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-30 @ 09:11:40</span
              ><span class="points-container"
                >Points: <span class="points">170</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46095087"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46088430">
          <h3>
            <a
              class="item"
              href="https://tobiasvl.github.io/blog/write-a-chip-8-emulator/"
              >Guide to making a CHIP-8 emulator (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-29 @ 15:49:20</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46088430"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
