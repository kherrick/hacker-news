<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38487359">
          <h3>
            <a
              class="item"
              href="https://ai.meta.com/research/seamless-communication/"
              >Seamless: Meta's New Speech Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-01 @ 14:53:21</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38487359"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38487266">
          <h3>
            <a
              class="item"
              href="https://www.theatlantic.com/ideas/archive/2023/12/great-resignation-myth-polls/676189/"
              >The Persistent Myth That Most Americans Are Miserable at Work</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-01 @ 14:47:29</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38487266"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38486907">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2023/11/30/return-to-office-is-dead-stanford-economist-says-heres-why.html"
              >Return to office is 'dead,' Stanford economist says</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-01 @ 14:17:13</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38486907"
                  >Comments</a
                ><span class="descendants">: 151</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38486849">
          <h3>
            <a
              class="item"
              href="https://zverok.space/blog/2023-12-01-syntax-sugar5-endless-methods.html"
              >"Useless Ruby sugar": Endless (one-line) methods</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-01 @ 14:11:50</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38486849"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38486539">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/article/misconduct-concerns-possible-drug-risks-should-stop-stroke-trial-whistleblowers-say"
              >Star neuroscientist may have manipulated data to support a major
              stroke trial</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-01 @ 13:43:26</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38486539"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38486259">
          <h3>
            <a
              class="item"
              href="https://thehftguy.com/2023/11/21/buggy-animation-in-atlassian-bitbucket-is-wasting-half-a-cpu-core-at-all-times/"
              >Buggy animation in Atlassian Bitbucket is wasting half a CPU core
              at all times</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-01 @ 13:11:25</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38486259"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38486177">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/turing-test"
              >Is the Turing Test Dead?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-01 @ 13:00:53</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38486177"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38486165">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2023-12-01/anduril-roadrunner-drone-killer-could-change-tactics-in-iraq-syria"
              >Anduril Builds a Tiny, Reusable Fighter Jet That Blows Up
              Drones</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-01 @ 12:59:09</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38486165"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38486075">
          <h3>
            <a
              class="item"
              href="https://nltimes.nl/2023/11/30/chip-machine-maker-asml-names-christophe-fouquet-new-ceo"
              >Chip machine maker ASML names Christophe Fouquet as new CEO</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-01 @ 12:47:15</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38486075"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38485958">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/12/01/science/space/earth-biology-life.html"
              >Exactly How Much Life Is on Earth?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-01 @ 12:28:18</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38485958"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38485596">
          <h3>
            <a class="item" href="https://ravynos.com/"
              >RavynOS Finesse of macOS. Freedom of FreeBSD</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-01 @ 11:29:23</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38485596"
                  >Comments</a
                ><span class="descendants">: 105</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38485295">
          <h3>
            <a
              class="item"
              href="https://tedium.co/2023/11/24/weird-html-hacks-history/"
              >HTML hacks that shaped the Internet</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-01 @ 10:37:00</span
              ><span class="points-container"
                >Points: <span class="points">165</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38485295"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38484463">
          <h3>
            <a class="item" href="https://flowforward.simple.ink/"
              >Segment Anything Model (Sam) Visualized</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-01 @ 08:26:18</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38484463"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38483650">
          <h3>
            <a class="item" href="https://search.acousticobservatory.org/"
              >Show HN: Australian Acoustic Observatory Search</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-01 @ 05:57:47</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38483650"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
            <div class="text">
              <a href="https://acousticobservatory.org/"
                >https://acousticobservatory.org/</a
              >) has 360 microphones across the continent, and over 2 million
              hours of audio. However, none of it is labeled: We want to make
              this enormous repository useful to researchers. We have found that
              researchers are often looking for 'hard' signals - specific
              call-types, birds with very little available training data, and so
              on. So we built an acoustic-similarity search tool, allowing
              researchers to provide an example of what they're looking for,
              which we then match against embeddings from the A2O dataset.
              <p>Here's some fun examples!</p>
              <p>
                Laughing Kookaburra: &lt;<a
                  href="https://search.acousticobservatory.org/search/index.html?q=https://api.search.acousticobservatory.org/api/v1/a2o/audio_recordings/download/flac/372176?start_offset%3D25%26end_offset%3D30"
                  >https://search.acousticobservatory.org/search/index.html?q=h...</a
                >&gt;
              </p>
              <p>
                Pacific Koel: &lt;<a
                  href="https://search.acousticobservatory.org/search/index.html?q=https://api.search.acousticobservatory.org/api/v1/a2o/audio_recordings/download/flac/288576?start_offset%3D15%26end_offset%3D20"
                  >https://search.acousticobservatory.org/search/index.html?q=h...</a
                >&gt;
              </p>
              <p>
                Chiming Wedgebill: &lt;<a
                  href="https://search.acousticobservatory.org/search/index.html?q=https://api.search.acousticobservatory.org/api/v1/a2o/audio_recordings/download/flac/387006?start_offset%3D0%26end_offset%3D5"
                  >https://search.acousticobservatory.org/search/index.html?q=h...</a
                >&gt;
              </p>
              <p>
                How it works, in a nutshell: We use audio source separation
                (&lt;<a
                  href="https://blog.research.google/2022/01/separating-birdsong-in-wild-for.html"
                  >https://blog.research.google/2022/01/separating-birdsong-in-...</a
                >&gt;) to pull apart the A2O data, and then run an embedding
                model (&lt;<a href="https://arxiv.org/abs/2307.06292"
                  >https://arxiv.org/abs/2307.06292</a
                >&gt;) on each channel of the separated audio to produce a
                'fingerprint' of the sound. All of this is put in a vector
                database with a link back to the original audio. When someone
                performs a search, we embed their audio, and then match against
                all of the embeddings in the vector database.
              </p>
              <p>
                Right now, about 1% of the A2O data is indexed (the first minute
                of every recording, evenly sampled across the day). We're
                looking to get initial feedback and will then continue to
                iterate and expand coverage.
              </p>
              <p>
                (Oh, and here's a bit of further reading:
                <a
                  href="https://blog.google/intl/en-au/company-news/technology/ai-ecoacoustics/"
                  >https://blog.google/intl/en-au/company-news/technology/ai-ec...</a
                >
                )
              </p>
            </div>
          </section>
        </section>
        <section id="38483343">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/James%E2%80%93Lange_theory"
              >James-Lange Theory</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-01 @ 05:02:20</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38483343"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38483271">
          <h3>
            <a class="item" href="https://adventofcode.com/2023/"
              >Advent of Code 2023 is nigh</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-01 @ 04:50:39</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38483271"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38483181">
          <h3>
            <a
              class="item"
              href="https://olano.dev/2023-11-30-code-is-run-more-than-read/"
              >Code is run more than read</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-01 @ 04:37:22</span
              ><span class="points-container"
                >Points: <span class="points">473</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38483181"
                  >Comments</a
                ><span class="descendants">: 225</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38482007">
          <h3>
            <a class="item" href="https://github.com/VikParuchuri/marker"
              >Marker: Convert PDF to Markdown quickly with high accuracy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-01 @ 01:53:45</span
              ><span class="points-container"
                >Points: <span class="points">465</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38482007"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38481970">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2311.16989"
              >Are Open-Source Large Language Models Catching Up?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-01 @ 01:49:36</span
              ><span class="points-container"
                >Points: <span class="points">292</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38481970"
                  >Comments</a
                ><span class="descendants">: 177</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38481426">
          <h3>
            <a class="item" href="https://www.music-map.com"
              >Music-Map – Find Similar Music</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-01 @ 00:44:21</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38481426"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38481298">
          <h3>
            <a
              class="item"
              href="https://daily.jstor.org/the-nineteenth-century-banjo/"
              >The Nineteenth-Century Banjo</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-01 @ 00:30:41</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38481298"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38481258">
          <h3>
            <a
              class="item"
              href="https://www.bbc.co.uk/news/technology-67583486"
              >Booking.com hackers increase attacks on customers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-01 @ 00:26:06</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38481258"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38477688">
          <h3>
            <a
              class="item"
              href="https://blog.marcocantu.com/blog/2023-november-turbopascal40.html"
              >Turbo Pascal Turns 40</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-30 @ 19:08:48</span
              ><span class="points-container"
                >Points: <span class="points">377</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38477688"
                  >Comments</a
                ><span class="descendants">: 221</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38477259">
          <h3>
            <a class="item" href="https://dangeng.github.io/visual_anagrams/"
              >Visual Anagrams: Generating optical illusions with diffusion
              models</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-30 @ 18:39:47</span
              ><span class="points-container"
                >Points: <span class="points">721</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38477259"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38475804">
          <h3>
            <a
              class="item"
              href="https://www.righto.com/2023/11/intel-386-clock-circuit.html"
              >The Intel 386 processor die: the clock circuit</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-30 @ 16:55:23</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38475804"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38475545">
          <h3>
            <a
              class="item"
              href="https://thereader.mitpress.mit.edu/stanislaw-lems-prescient-vision-of-artificial-life/"
              >Stanisław Lem's vision of artificial life</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-30 @ 16:35:24</span
              ><span class="points-container"
                >Points: <span class="points">432</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38475545"
                  >Comments</a
                ><span class="descendants">: 149</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38473743">
          <h3>
            <a class="item" href="https://powersync.com"
              >Show HN: Bi-directional sync between Postgres and SQLite</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-30 @ 14:13:25</span
              ><span class="points-container"
                >Points: <span class="points">299</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38473743"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
            <div class="text">
              <p>
                Today we’re launching PowerSync, a Postgres&lt;&gt;SQLite
                bi-directional sync engine that enables an offline-first app
                architecture. It currently supports Flutter, React Native and
                web (JavaScript) using Wasm SQLite in the browser, with more
                client SDKs on the way.
              </p>
              <p>
                Conrad and I (Ralf) have been working on our sync engine since
                2009, originally as part of a full-stack app platform. That
                version of the system is still used in production worldwide and
                we’ve learnt a lot from its use cases and scaling. About a year
                ago we started on spinning off PowerSync as a standalone product
                that is designed to be stack-agnostic.
              </p>
              <p>
                If you’d like to see a simple demo, check out the pebbles widget
                on the landing page here:
                <a href="https://www.powersync.com/"
                  >https://www.powersync.com/</a
                >
              </p>
              <p>
                We wrote about our architecture and design philosophy here:
                <a
                  href="https://www.powersync.com/blog/introducing-powersync-v1-0-postgres-sqlite-sync-layer"
                  >https://www.powersync.com/blog/introducing-powersync-v1-0-po...</a
                >
              </p>
              <p>
                This covers amongst other things how we designed the system for
                scalable dynamic partial replication, why we use a server
                authority architecture based on an event log instead of CRDTs
                for merging changes, and the approach to consistency.
              </p>
              <p>
                Our docs can be found here:
                <a href="https://docs.powersync.com/"
                  >https://docs.powersync.com/</a
                >
              </p>
              <p>
                We would love to hear your feedback! - Ralf, Conrad, Kobie,
                Phillip and team
              </p>
            </div>
          </section>
        </section>
        <section id="38473484">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/entertainment-arts-67546785"
              >Shane MacGowan has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-30 @ 13:50:31</span
              ><span class="points-container"
                >Points: <span class="points">191</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38473484"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38471815">
          <h3>
            <a
              class="item"
              href="https://www.autoblog.com/2023/11/29/uni-wheel-hyundai-kia-electric-vehicle-design/"
              >Hyundai Uni Wheel electric drive system could revolutionize EV
              design</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-30 @ 10:19:57</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38471815"
                  >Comments</a
                ><span class="descendants">: 115</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38457455">
          <h3>
            <a
              class="item"
              href="http://www.iasa-intl.com/folders/shuttle/GoodbyeColumbia.html"
              >Beam Me Out of This Death Trap, Scotty (1980)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-29 @ 09:48:33</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38457455"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
