<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36896571">
          <h3>
            <a
              class="item"
              href="https://www.ashbyhq.com/careers?ashby_jid=2b130850-9e04-4072-942b-65d9e1609813"
              >Ashby (YC W19) Is Hiring an Engineering Director to Build a
              Product-Focused Team</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-27 @ 17:00:17</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36896343">
          <h3>
            <a
              class="item"
              href="https://www.leteyski.com/bootstrapping-to-600k-mrr-and-getting-killed-by-shopify-the-story-of-checkout-x"
              >Bootstrapping to €600k MRR and getting killed by Shopify</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-27 @ 16:46:40</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36896343"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36896273">
          <h3>
            <a
              class="item"
              href="https://www.nbcnews.com/politics/congress/house-judiciary-plans-contempt-proceedings-mark-zuckerberg-rcna96297"
              >House Judiciary panel plans contempt proceedings for Mark
              Zuckerberg</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-27 @ 16:42:06</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36896273"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36896034">
          <h3>
            <a class="item" href="https://bloomberg.github.io/blazingmq/"
              >BlazingMQ: High-performance open source message queuing system</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-27 @ 16:27:34</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36896034"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36895887">
          <h3>
            <a
              class="item"
              href="https://www.npr.org/2023/07/27/1190453405/europe-travel-visa-etias-how-to-apply"
              >Visa-free travel to Europe for U.S. citizens to end in
              2024,requiring ETIAS form</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-27 @ 16:19:34</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36895887"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36895806">
          <h3>
            <a
              class="item"
              href="https://github.com/martyjacobsdev/Blade-Runner-Tailwind"
              >Blade-Runner-Tailwind: A Collection of Blade Runner Themed
              Tailwind Components</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-27 @ 16:14:00</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36895806"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36895536">
          <h3>
            <a
              class="item"
              href="https://www.nrc.gov/about-nrc/radiation/around-us/doses-daily-lives.html"
              >Radioactivity in Food (Organic Food)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-27 @ 15:57:29</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36895536"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36895354">
          <h3>
            <a
              class="item"
              href="https://reason.com/2023/07/24/first-amendment-auditor-sues-nypd-over-right-to-record-in-police-stations/"
              >'First Amendment Auditor' Sues NYPD over Right to Record in
              Police Stations</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-27 @ 15:46:28</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36895354"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36895300">
          <h3>
            <a class="item" href="https://tatsu-lab.github.io/alpaca_eval/"
              >LLaMA2 Chat 70B outperformed ChatGPT</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-27 @ 15:44:10</span
              ><span class="points-container"
                >Points: <span class="points">212</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36895300"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36895220">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36895220"
              >Launch HN: PeerDB (YC S23) – Fast, Native ETL/ELT for Postgres</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-27 @ 15:39:08</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36895220"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.peerdb.io/">https://www.peerdb.io/</a>), a
              Postgres-first data-movement platform that makes moving data in
              and out of Postgres fast and simple. PeerDB is free and open (<a
                href="https://github.com/PeerDB-io/peerdb"
                >https://github.com/PeerDB-io/peerdb</a
              >) and we provide a Docker stack for users to try us out. Our repo
              is at
              <a href="https://github.com/PeerDB-io/peerdb"
                >https://github.com/PeerDB-io/peerdb</a
              >
              and there’s a 5-minute quickstart here:
              <a href="https://docs.peerdb.io/quickstart"
                >https://docs.peerdb.io/quickstart</a
              >.
              <p>
                For the past 8 years, working at Microsoft on Postgres on Azure,
                and before that at Citus Data, I’ve worked closely with
                customers running Postgres at the heart of their data stack,
                storing anywhere from 10s of GB of data to 10s of TB.
              </p>
              <p>
                This was when I got exposed to the challenges customers faced
                when moving data in and out of Postgres. Usually they would try
                existing ETL tools, fail, and decide to build in-house
                solutions. Common issues with these tools included painfully
                slow syncs - syncing 100s of GB of data took days; flaky and
                unreliable - frequent crashes, loss of data precision on target
                etc., and; feature-limited - lack of configurability,
                unsupported data types and so on.
              </p>
              <p>
                I remember a specific scenario where a tool didn’t support
                something as simple as the Postgres’ COPY command to ingest
                data. This would have improved the throughput by orders of
                magnitude. We (customer and me) reached out to that company to
                request them to add this feature. They couldn’t prioritize this
                feature because it wasn’t very easy - their tech stack was
                designed to support 100s of connectors rather than supporting a
                native Postgres feature.
              </p>
              <p>
                After multiple such occurrences, I thought, why not build a tool
                specialized for Postgres, making the lives of many Postgres
                users easier. I reached out to my long-time buddy Kaushik, who
                was building operating systems at Google and had led data teams
                at Safegraph and Palantir. We spent a few weeks building an MVP
                that streamed data in real-time from Postgres to BigQuery. It
                was 10 times faster than existing tools and maintained data
                freshness of less than 30 seconds. We realized that there were
                many Postgres native and infrastructural optimizations we could
                do to provide a rich data-movement experience for Postgres
                users. This is when we decided to start PeerDB!
              </p>
              <p>
                We started with two main use cases: Real-time Change Data
                Capture from Postgres (demo:
                <a href="https://docs.peerdb.io/usecases/realtime-cdc#demo"
                  >https://docs.peerdb.io/usecases/realtime-cdc#demo</a
                >) and Real-time Streaming of query results from Postgres (demo:
                <a
                  href="https://docs.peerdb.io/usecases/realtime-streaming-of-query-results#demo"
                  >https://docs.peerdb.io/usecases/realtime-streaming-of-query-...</a
                >). The 2nd demo shows PeerDB streaming a table with 100M rows
                from Postgres to Snowflake.
              </p>
              <p>
                We implement multiple optimizations to provide a fast, reliable,
                feature-rich experience. For performance, we can parallelize the
                initial load of a large table, still ensuring consistency.
                Syncing 100s of GB goes from days to minutes. We do this by
                logically partitioning the table based on internal tuple
                identifiers (CTID) and parallelly streaming those partitions
                (inspired by this DuckDB blog -
                <a
                  href="https://duckdb.org/2022/09/30/postgres-scanner.html#parallelization"
                  >https://duckdb.org/2022/09/30/postgres-scanner.html#parallel...</a
                >)
              </p>
              <p>
                For CDC, we don’t use Debezium, rather handle replication more
                natively—reading the slot, replicating the changes, keeping
                state etc. We made this choice mainly for flexibility. Staying
                native helps us use existing and future Postgres enhancements
                more effectively. For example, if the order of rows across
                tables on the target is not important, we can parallelize
                reading of a single slot across multiple tables and improve
                performance. Our architecture is designed for real-time syncs,
                which enables data-freshness of a few 10s of seconds even at
                large throughputs (10k+ tps).
              </p>
              <p>
                We have fault tolerance mechanisms for reliability (<a
                  href="https://blog.peerdb.io/using-temporal-to-scale-data-synchronization-at-peerdb"
                  >https://blog.peerdb.io/using-temporal-to-scale-data-synchron...</a
                >) and support multiple features including log-based (CDC) /
                query based streaming, efficient syncing of tables with large
                (TOAST) columns, configurable batching and parallelism to
                prevent OOMs and crashes etc.
              </p>
              <p>
                For usability - we provide a Postgres compatible SQL layer for
                data-movement. This makes the life of data engineers much
                easier. They can develop pipelines using a framework they are
                familiar with, without needing to deal with custom UIs and REST
                APIs. They can use Postgres' 100s of integrations to build and
                manage ETL. We extend Postgres' SQL grammar with a few new
                intuitive SQL commands to enable real-time data streaming across
                stores. Because of this, we were able to add dbt integration via
                Dagster (in private preview) in a few hours! We expect
                data-engineers to unravel similar integrations with PeerDB
                easily, and plan to make this grammar richer as we evolve.
              </p>
              <p>
                PeerDB consists of the following components to handle data
                replication: (1) PeerDB Server uses the pgwire protocol to mimic
                a PostgreSQL server, responsible for query routing and
                generating gRPC requests to the Flow API. It relies on AST
                analysis to make informed decisions on routing. (2) Flow API: an
                API layer that deals with gRPC commands, orchestrating the data
                sync operations; (3) Flow Workers execute the data read-write
                operations from the source to the destination. Built to scale
                horizontally, they interact with Temporal for increased
                resilience. The types of data replication supported include CDC
                streaming replication and query-based batch replication. Workers
                do all of the heavy lifting, and have data store specific
                optimizations.
              </p>
              <p>
                Currently we support 6 target data stores (BigQuery, Snowflake,
                Postgres, S3, Kafka etc) for data movement from Postgres. This
                doc captures the current status of the connectors:
                <a
                  href="https://docs.peerdb.io/sql/commands/supported-connectors"
                  >https://docs.peerdb.io/sql/commands/supported-connectors</a
                >.
              </p>
              <p>
                As we spoke to more customers, we realized that getting data
                into PostgreSQL at scale is equally important and hard. For
                example one of our customers wants to periodically sync data in
                multiple SQL Server instances (running on the edge) to their
                centralized Postgres database. Requests for Oracle to Postgres
                migrations are also common. So now we’re also supporting source
                data stores with Postgres as the target (currently SQL Server
                and Postgres itself, with more to come).
              </p>
              <p>
                We are actively working with customers to onboard them to our
                self-hosted enterprise offering. Our fully hosted offering on
                the cloud is in private preview. We haven’t yet decided on the
                pricing. One common concern we’ve heard from customers is that
                existing tools are expensive and charge based on the amount of
                data transferred. To address this, we are considering a more
                transparent way of pricing—for example, pricing based on
                provisioned hardware (cpu, memory, disk). We’re open for
                feedback on this!
              </p>
              <p>
                Check out our github repo -
                <a href="https://github.com/PeerDB-io/peerdb"
                  >https://github.com/PeerDB-io/peerdb</a
                >
                and go ahead and give it a spin (5-minute quickstart
                <a href="https://docs.peerdb.io/quickstart"
                  >https://docs.peerdb.io/quickstart</a
                >).
              </p>
              <p>
                We want to provide the world’s best data-movement experience for
                Postgres. We would love to get your feedback on product
                experience, our thesis and anything else that comes to your
                mind. It would be super useful for us. Thank you!
              </p>
            </div>
          </section>
        </section>
        <section id="36894749">
          <h3>
            <a
              class="item"
              href="https://seas.harvard.edu/news/2023/07/fiber-infused-ink-enables-3d-printed-heart-muscle-beat"
              >Fiber-infused ink enables 3D-printed heart muscle to beat</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-27 @ 15:07:45</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36894749"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36894613">
          <h3>
            <a
              class="item"
              href="https://scanalyst.fourmilab.ch/t/room-temperature-ambient-pressure-superconductivity-this-time-for-real/3512"
              >Room temperature, ambient pressure superconductivity – this time
              for real?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-27 @ 14:59:34</span
              ><span class="points-container"
                >Points: <span class="points">159</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36894613"
                  >Comments</a
                ><span class="descendants">: 185</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36894198">
          <h3>
            <a
              class="item"
              href="https://unix.stackexchange.com/questions/447440/ufw-iptables-not-blocking-dhcp-udp-port-67#447524"
              >DHCP is not blocked by ufw/iptables</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-27 @ 14:32:23</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36894198"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36893965">
          <h3>
            <a
              class="item"
              href="https://interrupt.memfault.com/blog/monitoring-battery-life"
              >Understanding Battery Performance of IoT Devices</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-27 @ 14:19:31</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36893965"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36893635">
          <h3>
            <a
              class="item"
              href="https://sts-news.medium.com/the-design-thinking-movement-is-absurd-83df815b92ea"
              >The Design Thinking Movement Is Absurd (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-27 @ 14:00:18</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36893635"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36893193">
          <h3>
            <a
              class="item"
              href="https://www.sqlite.org/cgi/src/doc/begin-concurrent/doc/begin_concurrent.md"
              >SQLite Begin Concurrent</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-27 @ 13:31:10</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36893193"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36892970">
          <h3>
            <a
              class="item"
              href="https://twistedsifter.com/2020/06/how-wavy-crinkle-crankle-walls-use-less-bricks-than-straight-walls/"
              >Wavy walls use fewer bricks than a straight wall (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-27 @ 13:16:41</span
              ><span class="points-container"
                >Points: <span class="points">275</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36892970"
                  >Comments</a
                ><span class="descendants">: 155</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36892506">
          <h3>
            <a
              class="item"
              href="https://www.techdirt.com/2023/07/27/__trashed-4/"
              >Automakers try to scuttle Massachusetts ‘right to repair’ law</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-27 @ 12:36:11</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36892506"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36891735">
          <h3>
            <a class="item" href="https://tryblackbird.com/blog/local-overrides"
              >How I test site speed changes using Chrome's local overrides
              (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-27 @ 10:56:09</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36891735"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36891642">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/investigates/special-report/tesla-batteries-range/"
              >Tesla created secret team to suppress thousands of driving range
              complaints</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-27 @ 10:44:17</span
              ><span class="points-container"
                >Points: <span class="points">612</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36891642"
                  >Comments</a
                ><span class="descendants">: 514</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36890036">
          <h3>
            <a
              class="item"
              href="https://hazyresearch.stanford.edu/blog/2023-07-25-m2-bert"
              >How to scale LLMs better with an alternative to transformers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-27 @ 07:13:04</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36890036"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36889092">
          <h3>
            <a
              class="item"
              href="https://kvm-forum.qemu.org/media/2023/submissions/GDRJLK/resources/macOS_in_QEMU_on_ARM_FhJY65D.pdf"
              >MacOS in QEMU – ARM edition [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-27 @ 04:57:07</span
              ><span class="points-container"
                >Points: <span class="points">186</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36889092"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36888954">
          <h3>
            <a
              class="item"
              href="https://mail.tarsnap.com/tarsnap-announce/msg00050.html"
              >Tarsnap outage postmortem</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-27 @ 04:33:56</span
              ><span class="points-container"
                >Points: <span class="points">399</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36888954"
                  >Comments</a
                ><span class="descendants">: 239</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36888667">
          <h3>
            <a
              class="item"
              href="https://blog.marcua.net/2022/02/20/data-diffs-algorithms-for-explaining-what-changed-in-a-dataset.html"
              >Data diffs: Algorithms for explaining what changed in a dataset
              (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-27 @ 03:43:31</span
              ><span class="points-container"
                >Points: <span class="points">175</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36888667"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36888598">
          <h3>
            <a class="item" href="https://eupnea-linux.github.io/"
              >Depthboot – Your Chromebook, your way</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-27 @ 03:34:01</span
              ><span class="points-container"
                >Points: <span class="points">224</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36888598"
                  >Comments</a
                ><span class="descendants">: 96</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36887816">
          <h3>
            <a class="item" href="https://type.method.ac/"
              >KernType – A Letter Spacing Game</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-27 @ 01:46:56</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36887816"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36881808">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/blog-post/breaking-superconductor-news"
              >Superconductor news: What’s claimed, and how strong the evidence
              seems to be</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-26 @ 17:46:30</span
              ><span class="points-container"
                >Points: <span class="points">1107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36881808"
                  >Comments</a
                ><span class="descendants">: 443</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36875962">
          <h3>
            <a class="item" href="https://github.com/tjholm/multiboy"
              >Show HN: I built a multiplayer Gameboy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-26 @ 11:33:06</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36875962"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
            <div class="text">
              Still very much a work in progress, but really wanted to share
              this even in it's early state. Had heaps of fun building it to
              learn more about WebRTC.
            </div>
          </section>
        </section>
        <section id="36873635">
          <h3>
            <a
              class="item"
              href="https://harewood.org/about/blog/notes/the-oldest-and-most-expensive-rum-in-the-world/"
              >The Oldest and Most Expensive Rum in the World</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-26 @ 06:02:44</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36873635"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36873322">
          <h3>
            <a
              class="item"
              href="https://thechipletter.substack.com/p/chip-letter-links-no-21-xerox-parc"
              >Xerox PARC Special</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-26 @ 05:04:02</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36873322"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
