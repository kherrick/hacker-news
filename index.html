<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="46592461">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/clearspace/jobs/GOWiDwp-research-engineer-at-clearspace"
              >Clearspace (YC W23) Is Hiring an Applied Researcher (ML)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-12 @ 18:41:47</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46592344">
          <h3>
            <a class="item" href="https://github.com/finbarr/yolobox"
              >Show HN: Yolobox â€“ Run AI coding agents with full sudo without
              nuking home dir</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-12 @ 18:34:02</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46592344"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46591974">
          <h3>
            <a
              class="item"
              href="https://twitter.com/netblocks/status/2010750871274160361"
              >Iran has now been offline for 96 hours</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-12 @ 18:03:12</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46591974"
                  >Comments</a
                ><span class="descendants">: 105</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46591708">
          <h3>
            <a class="item" href="https://walzr.com/postal-arbitrage"
              >Postal Arbitrage</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-12 @ 17:41:50</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46591708"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46591589">
          <h3>
            <a
              class="item"
              href="https://sr.ericli.tech/?d=N4IgbiBcCMA0IHcoG1QBcogEYngGxQAZZiAOWUgXXgGMpQBHTASwCcBDAO1xAAcoAzIWGEAvqNjpMAWx4FIycsWjKAbNRB1IoLcgEAmAHSqALAHYArAOgnYFk4YumBF6OvgAvKGfgBnKGisAK4ApvDckCAAkhzc4pIgGJEhckQU6VS09CBMkWxcIPFSkfz4KNBKsKqwZhpaoP6RNi5mAjwhSSAA0gAW7NIhnCHMAAQA9kFoI+y+IwDKQbysIQMjADIh7AAmIazjAGYjMVwjWACeIwBSXEHsrBfWAPyFEsUgZ6kKFTVVsACcdWyQUwPTQaF4vkgAHooQg4YYzhM0EEsCFDDQxtJYew0DQeo8wABeNYAfX2NFYAHlEQB1ABapBelFEQA"
              >Show HN: Customizable OSINT dashboard to monitor the situation</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-12 @ 17:32:16</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46591589"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
            <div class="text">
              Monitor the situation to your own liking. Polymarket, Subway
              Surfers, Bluesky integration, Flight trackers. Runs all requests
              client side and doesn't store information. Open to feedback.
            </div>
          </section>
        </section>
        <section id="46591402">
          <h3>
            <a
              class="item"
              href="https://www.cloudamqp.com/blog/message-queues-exaplined-with-analogies.html"
              >Message Queues: A Simple Guide with Analogies</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-12 @ 17:17:09</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46591402"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46591100">
          <h3>
            <a class="item" href="https://www.trylad.com"
              >Show HN: AI in SolidWorks</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-12 @ 16:56:17</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46591100"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.trylad.com/">https://www.trylad.com/</a>).
              <p>
                We come from software engineering backgrounds where tools like
                Claude Code and Cursor have come to dominate, but when poking
                around CAD systems a few months back we realized there's no way
                to go from a text prompt input to a modeling output in any of
                the major CAD systems. In our testing, the LLMs aren't as good
                at making 3D objects as they are are writing code, but we think
                they'll get a lot better in the upcoming months and years.
              </p>
              <p>
                To bridge this gap, we've created LAD, an add-in in SolidWorks
                to turn conversational input and uploaded documents/images into
                parts, assemblies, and macros. It includes:
              </p>
              <p>
                - Dozens of tools the LLM can call to create sketches, features,
                and other objects in parts.
              </p>
              <p>
                - Assembly tools the LLM can call to turn parts into assemblies.
              </p>
              <p>
                - File system tools the LLM can use to create, save, search, and
                read SolidWorks files and documentation.
              </p>
              <p>
                - Macro writing/running tools plus a SolidWorks API
                documentation search so the LLM can use macros.
              </p>
              <p>
                - Automatic screenshots and feature tree parsing to provide the
                LLM context on the current state.
              </p>
              <p>
                - Checkpointing to roll back unwanted edits and permissioning to
                determine which commands wait for user permission.
              </p>
              <p>
                You can try LAD at
                <a href="https://www.trylad.com/">https://www.trylad.com/</a>
                and let us know what features would make it more useful for your
                work. To be honest, the LLMs aren't great at CAD right now, but
                we're mostly curious to hear if people would want and use this
                if it worked well.
              </p>
            </div>
          </section>
        </section>
        <section id="46590541">
          <h3>
            <a
              class="item"
              href="https://github.com/scionassociation/blog-25gbit-workstation"
              >Building a 25 Gbit/s workstation for the SCION Association</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-12 @ 16:20:16</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46590541"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46590280">
          <h3>
            <a class="item" href="https://github.com/haykgrigo3/TimeCapsuleLLM"
              >TimeCapsuleLLM: LLM trained only on data from 1800-1875</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-12 @ 16:04:27</span
              ><span class="points-container"
                >Points: <span class="points">307</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46590280"
                  >Comments</a
                ><span class="descendants">: 125</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46589849">
          <h3>
            <a class="item" href="https://open-meteo.com/"
              >Open-Meteo is a free and open-source weather API for
              non-commercial use</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-12 @ 15:36:43</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46589849"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46589675">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2026/01/12/apple-google-ai-siri-gemini.html"
              >Apple picks Google's Gemini to power Siri</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-12 @ 15:22:21</span
              ><span class="points-container"
                >Points: <span class="points">373</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46589675"
                  >Comments</a
                ><span class="descendants">: 211</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46589658">
          <h3>
            <a
              class="item"
              href="https://piccalil.li/blog/date-is-out-and-temporal-is-in/"
              >Date is out, Temporal is in</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-12 @ 15:20:36</span
              ><span class="points-container"
                >Points: <span class="points">191</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46589658"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46589576">
          <h3>
            <a
              class="item"
              href="https://www.runpulse.com/blog/computational-complexity-of-schema"
              >Computational complexity of schema-guided document extraction</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-12 @ 15:13:31</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46589576"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46589543">
          <h3>
            <a
              class="item"
              href="https://digitalseams.com/blog/computers-that-used-to-be-human"
              >Computers that used to be human</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-12 @ 15:09:32</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46589543"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46589489">
          <h3>
            <a
              class="item"
              href="https://www.federalreserve.gov/newsevents/speech/powell20260111a.htm?mod=ANLink"
              >Statement from Federal Reserve Chair</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-12 @ 15:05:51</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46589489"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46588837">
          <h3>
            <a
              class="item"
              href="https://www.npopov.com/2026/01/11/LLVM-The-bad-parts.html"
              >LLVM: The bad parts</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-12 @ 14:18:13</span
              ><span class="points-container"
                >Points: <span class="points">202</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46588837"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46588572">
          <h3>
            <a
              class="item"
              href="https://taylorkolasinski.com/notes/mhc-reproduction/"
              >Reproducing DeepSeek's MHC: When Residual Connections Explode</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-12 @ 13:57:32</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46588572"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46587934">
          <h3>
            <a
              class="item"
              href="https://blog.smartere.dk/2026/01/floppy-disks-the-best-tv-remote-for-kids/"
              >Floppy disks turn out to be the greatest TV remote for kids</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-12 @ 13:07:49</span
              ><span class="points-container"
                >Points: <span class="points">375</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46587934"
                  >Comments</a
                ><span class="descendants">: 211</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46587804">
          <h3>
            <a class="item" href="https://github.com/z-libs/Zen-C"
              >Zen-C: Write like a high-level language, run like C</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-12 @ 12:57:44</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46587804"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46587498">
          <h3>
            <a
              class="item"
              href="https://blog.gripdev.xyz/2026/01/10/actions-terminal-on-failure-for-debugging/"
              >Launch a Debugging Terminal into GitHub Actions</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-12 @ 12:25:27</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46587498"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46586766">
          <h3>
            <a class="item" href="https://archaeologist.dev/artifacts/anthropic"
              >Anthropic made a mistake in cutting off third-party clients</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-12 @ 10:57:29</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46586766"
                  >Comments</a
                ><span class="descendants">: 125</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46586179">
          <h3>
            <a
              class="item"
              href="https://lightpanda.io/blog/posts/migrating-our-dom-to-zig"
              >Lightpanda migrate DOM implementation to Zig</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-12 @ 09:42:49</span
              ><span class="points-container"
                >Points: <span class="points">172</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46586179"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46585947">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/articles/cj9r3zl2ywyo"
              >Ai, Japanese chimpanzee who counted and painted dies at 49</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-12 @ 09:10:45</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46585947"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46581095">
          <h3>
            <a class="item" href="https://cy.md/opencode-rce/"
              >Unauthenticated remote code execution in OpenCode</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-11 @ 22:33:32</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46581095"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
            <div class="text">
              Previous versions of OpenCode started a server which allowed any
              website visited in a web browser to execute arbitrary commands on
              the local machine. Make sure you are using v1.1.10 or newer; see
              link for more details.
            </div>
          </section>
        </section>
        <section id="46579864">
          <h3>
            <a
              class="item"
              href="https://noheger.at/blog/2026/01/11/the-struggle-of-resizing-windows-on-macos-tahoe/"
              >The struggle of resizing windows on macOS Tahoe</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-11 @ 20:47:55</span
              ><span class="points-container"
                >Points: <span class="points">2453</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46579864"
                  >Comments</a
                ><span class="descendants">: 1037</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46553137">
          <h3>
            <a
              class="item"
              href="https://media.ccc.de/v/39c3-in-house-electronics-manufacturing-from-scratch-how-hard-can-it-be"
              >39c3: In-house electronics manufacturing from scratch: How hard
              can it be? [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-09 @ 12:23:52</span
              ><span class="points-container"
                >Points: <span class="points">234</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46553137"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46526896">
          <h3>
            <a
              class="item"
              href="https://www.openculture.com/2026/01/j-r-r-tolkien-reads-from-the-hobbit-for-30-minutes-1952.html"
              >JRR Tolkien reads from The Hobbit for 30 Minutes (1952)</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-07 @ 14:43:16</span
              ><span class="points-container"
                >Points: <span class="points">281</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46526896"
                  >Comments</a
                ><span class="descendants">: 108</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46525639">
          <h3>
            <a
              class="item"
              href="https://blog.yiningkarlli.com/2025/12/zootopia-2.html"
              >Personal thoughts/notes from working on Zootopia 2</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-07 @ 12:29:01</span
              ><span class="points-container"
                >Points: <span class="points">213</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46525639"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46525477">
          <h3>
            <a class="item" href="https://kidopoly.com/research/attention-gap/"
              >History's Attention Gap</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-07 @ 12:09:57</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46525477"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="46524058">
          <h3>
            <a class="item" href="https://gpfault.net/posts/aabb-tricks.html"
              >A Couple 3D AABB Tricks</a
            >
          </h3>
          <section>
            <h4>
              <span>2026-01-07 @ 08:45:43</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=46524058"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2026/index.md"
              >2026</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
