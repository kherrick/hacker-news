<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41220775">
          <h3>
            <a class="item" href="https://webstudio.is/copy-paste"
              >Show HN: Copy-Paste from Webflow into Webstudio</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-12 @ 02:41:05</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41220775"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41220393">
          <h3>
            <a
              class="item"
              href="https://connect.mozilla.org/t5/discussions/how-can-firefox-create-the-best-support-for-web-apps-on-the/td-p/60561"
              >How can Firefox create the best support for web apps on the
              desktop?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-12 @ 01:09:26</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41220393"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41220284">
          <h3>
            <a class="item" href="https://blog.comma.ai/refactoring-for-growth/"
              >Comma.ai: Refactoring for Growth</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-12 @ 00:43:22</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41220284"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41220059">
          <h3>
            <a
              class="item"
              href="https://blog.alexwendland.com/2024-07-07-holding-pens/"
              >How to avoid losing items? Holding pens</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 23:47:35</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41220059"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41219562">
          <h3>
            <a class="item" href="https://kevinlynagh.com/z3-simpsons-paradox/"
              >Generating Simpson's Paradox with Z3</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 21:53:14</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41219562"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41219440">
          <h3>
            <a class="item" href="https://git.zx2c4.com/wireguard-rs/"
              >WireGuard-rs – Official Rust implementation of WireGuard</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 21:27:48</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41219440"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41219122">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/apple-prototypes-corporate-data/"
              >Apple Prototypes and Corporate Secrets Are for Sale Online–If You
              Know Where</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 20:29:34</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41219122"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41219080">
          <h3>
            <a class="item" href="https://github.com/spion/adbfs-rootless"
              >Adbfs-rootless – Mount Android phones on Linux with adb. No root
              required</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 20:22:11</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41219080"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41218928">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2408.04093"
              >Tree Attention: Topology-Aware Decoding for Long-Context</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 20:02:58</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41218928"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41218811">
          <h3>
            <a class="item" href="https://pixeltune.org"
              >Show HN: Pixeltune, a nicer chiptune and VGM player</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 19:42:18</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41218811"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
            <div class="text">
              <p>
                Over the years I received numerous requests from people that
                wanted more: more music, more features, more playable formats,
                you name it.
              </p>
              <p>
                Eventually I began working on a complete rewrite of the app
                (this time for real), and, realizing that each year another
                chiptune or MIDI website went offline, I decided to start
                archiving them for preservation.
              </p>
              <p>
                Today, 10 years after the first release, I think it's finally
                time for the new, nicer version to hit the shelves. It's now
                called Pixeltune and yes, now you can actually turn down the
                volume. :)
              </p>
              <p>Hope you like it!</p>
              <p>
                [0]
                <a href="https://news.ycombinator.com/item?id=10305918"
                  >https://news.ycombinator.com/item?id=10305918</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="41218737">
          <h3>
            <a class="item" href="https://hackmd.gfuzz.de/s/Qsk14kc3i"
              >OpenBSD 7.5 via QEMU on Hetzner physical machine (no phys. access
              / KVM console)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 19:33:01</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41218737"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41217903">
          <h3>
            <a class="item" href="https://dcreager.net/2021/03/a-better-varint/"
              >Another variable-length integer encoding (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 17:42:05</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41217903"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41217758">
          <h3>
            <a
              class="item"
              href="https://unskilled.blog/posts/preemption-in-go-an-introduction/"
              >Introduction to Golang Preemption Mechanisms</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 17:23:17</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41217758"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41217319">
          <h3>
            <a
              class="item"
              href="https://www.thetimes.com/uk/science/article/i-lost-my-job-so-spent-14-years-searching-for-osteoarthritis-cure-d6d69wwxz"
              >It took my savings and 14 years but I’m about to beat
              arthritis</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 16:29:16</span
              ><span class="points-container"
                >Points: <span class="points">140</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41217319"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41217162">
          <h3>
            <a
              class="item"
              href="https://www.politico.com/news/2024/08/09/cdc-records-lawsuit-ruling-00173416"
              >Judge orders CDC to stop deleting emails of departing staff:
              'likely unlawful'</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 16:07:30</span
              ><span class="points-container"
                >Points: <span class="points">231</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41217162"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41217136">
          <h3>
            <a class="item" href="https://servermono.com/"
              >Server Mono: A Typeface Inspired by Typewriters, Apple's SF Mono,
              and CLIs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 16:04:49</span
              ><span class="points-container"
                >Points: <span class="points">228</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41217136"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41217109">
          <h3>
            <a class="item" href="https://grandmasword.com"
              >Show HN: My 70 year old grandma is learning to code and made a
              word game</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 16:01:50</span
              ><span class="points-container"
                >Points: <span class="points">424</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41217109"
                  >Comments</a
                ><span class="descendants">: 140</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41216560">
          <h3>
            <a class="item" href="https://madebyevan.com/fsm/"
              >Finite State Machine Designer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 14:48:26</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41216560"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41215727">
          <h3>
            <a class="item" href="https://github.com/versotile-org/verso"
              >Verso – web browser built on top of the Servo web engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 12:34:41</span
              ><span class="points-container"
                >Points: <span class="points">650</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41215727"
                  >Comments</a
                ><span class="descendants">: 220</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41215679">
          <h3>
            <a
              class="item"
              href="https://www.textualize.io/blog/7-things-ive-learned-building-a-modern-tui-framework/"
              >Things I've learned building a modern TUI Framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 12:22:50</span
              ><span class="points-container"
                >Points: <span class="points">249</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41215679"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41215593">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2407.16741"
              >OpenDevin: An Open Platform for AI Software Developers as
              Generalist Agents</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 12:02:55</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41215593"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41215201">
          <h3>
            <a
              class="item"
              href="https://seattledataguy.substack.com/p/why-your-data-stack-wont-last-and"
              >Building data infrastructure that will last</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 10:24:06</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41215201"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41214762">
          <h3>
            <a
              class="item"
              href="https://discuss.haiku-os.org/t/progress-on-porting-firefox/13493?page=7"
              >Firefox Browser Ported to HaikuOS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 08:23:43</span
              ><span class="points-container"
                >Points: <span class="points">436</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41214762"
                  >Comments</a
                ><span class="descendants">: 169</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41213711">
          <h3>
            <a class="item" href="https://cjycode.com/posts/rust-ui-flutter/"
              >Show HN: Rust GUI Library via Flutter</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 02:55:20</span
              ><span class="points-container"
                >Points: <span class="points">274</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41213711"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/fzyzcjy/flutter_rust_bridge"
                >https://github.com/fzyzcjy/flutter_rust_bridge</a
              >
              v2.0.0) between Flutter and Rust, which auto translates syntaxes
              like arbitrary types, &amp;mut, async, traits, results, closure
              (callback), lifetimes, etc. The goal is to make a bridge between
              the two, seamlessly as if working in one single language.
              <p>
                Then, as an example, I showed how to write Rust applications
                with GUI by utilizing Flutter. That is discussed in the link in
                details.
              </p>
              <p>
                To play with it, please visit the GitHub repo, or refer to the
                end of the article for detailed folders and commands.
              </p>
              <p>
                When I first released 1.0.0 years ago, it only contained few
                features compared to today. It is the result of the hard work of
                contributors and me, and many thanks to all the contributors!
              </p>
            </div>
          </section>
        </section>
        <section id="41212103">
          <h3>
            <a
              class="item"
              href="https://cosmosmagazine.com/nature/plants/thorns-prickles-roses-plants/"
              >Genetics solves a thorny problem: how plants have prickles</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 20:46:27</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41212103"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41207355">
          <h3>
            <a
              class="item"
              href="https://jvns.ca/blog/2024/08/06/go-structs-copied-on-assignment/"
              >Go structs are copied on assignment (and other things about Go
              I'd missed)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 04:40:57</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41207355"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41195823">
          <h3>
            <a
              class="item"
              href="https://pikuma.com/blog/isometric-projection-in-games"
              >Isometric Projection in Game Development</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-08 @ 20:25:07</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41195823"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41180632">
          <h3>
            <a
              class="item"
              href="https://www.lightly.ai/post/segment-anything-model-and-friends"
              >Segment Anything Model and Friends</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-07 @ 12:22:14</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41180632"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41178564">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d44151-024-00120-9"
              >Kitchen sponges can be used as memory devices</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-07 @ 05:47:23</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41178564"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41178000">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=H4VgGn2tPWc"
              >1 vs. 1000 guitar picks (5000 picks/second) [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-07 @ 03:30:33</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41178000"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
