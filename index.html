<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37580224">
          <h3>
            <a class="item" href="https://q-transformer.github.io/"
              >Q-Transformer: Scalable Reinforcement Learning via Autoregressive
              Q-Functions</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 04:00:27</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37580224"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37580141">
          <h3>
            <a
              class="item"
              href="https://www.faa.gov/newsroom/faa-authorizes-zipline-deliver-commercial-packages-beyond-line-sight"
              >FAA authorizes Zipline to deliver commercial packages using
              drones</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 03:42:23</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37580141"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37580123">
          <h3>
            <a
              class="item"
              href="https://rachelbythebay.com/w/2023/09/19/badlib/"
              >Add extra stuff to a “standard” encoding? Sure, why not</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 03:38:49</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37580123"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37580113">
          <h3>
            <a class="item" href="https://100parkingtickets.com/"
              >100 Parking Tickets (2004)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 03:35:13</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37580113"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37579926">
          <h3>
            <a
              class="item"
              href="https://railsatscale.com/2023-09-18-ruby-3-3-s-yjit-runs-shopify-s-production-code-15-faster/"
              >Ruby 3.3's YJIT Runs Shopify's Production Code 15% Faster</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 02:57:08</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37579926"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37579595">
          <h3>
            <a class="item" href="https://github.com/crossbowerbt/awk-webserver"
              >A simple web server written in Awk</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 02:02:31</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37579595"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37579474">
          <h3>
            <a
              class="item"
              href="https://simblob.blogspot.com/2023/09/writing-html-by-hand.html"
              >Writing HTML by hand</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 01:44:08</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37579474"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37579183">
          <h3>
            <a class="item" href="https://etleap.com/careers/software-engineer/"
              >Etleap (YC W13) Is Hiring a Software Engineer (London – OR – San
              Francisco)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 01:00:54</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37577861">
          <h3>
            <a class="item" href="https://brisray.com/web/webring-tech.htm"
              >Webring Technology</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 22:28:19</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37577861"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37577354">
          <h3>
            <a
              class="item"
              href="https://restofworld.org/2023/underground-apple-techs-cuba/"
              >A small community of unofficial Apple technicians in Cuba</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 21:52:12</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37577354"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37576633">
          <h3>
            <a class="item" href="https://web.mit.edu/jemorris/humor/500-miles"
              >Can’t send email more than 500 miles (2002)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 21:05:20</span
              ><span class="points-container"
                >Points: <span class="points">590</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37576633"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37575869">
          <h3>
            <a
              class="item"
              href="https://every.to/no-small-plans/the-paradox-of-control"
              >The Paradox of Control</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 20:14:24</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37575869"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37575467">
          <h3>
            <a
              class="item"
              href="https://myme.no/posts/2023-09-19-programming-is-hard.html"
              >Programming is hard</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 19:49:26</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37575467"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37575438">
          <h3>
            <a
              class="item"
              href="https://github.com/ArthurFerreira2/reinette-II-plus-dot-py"
              >ReinetteII+.py, an Apple II plus emulator in Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 19:47:49</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37575438"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37575227">
          <h3>
            <a class="item" href="https://github.com/phillbush/jvm"
              >Simple Open-Source Java Virtual Machine in C</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 19:36:22</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37575227"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37575204">
          <h3>
            <a class="item" href="https://go.dev/blog/loopvar-preview"
              >Fixing for loops in Go 1.22</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 19:34:09</span
              ><span class="points-container"
                >Points: <span class="points">421</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37575204"
                  >Comments</a
                ><span class="descendants">: 293</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37575167">
          <h3>
            <a
              class="item"
              href="https://www.scientificamerican.com/article/pink-diamonds-erupted-to-earths-surface-after-early-supercontinents-breakup/"
              >Pink diamonds erupted to Earth’s surface after early
              supercontinent’s breakup</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 19:31:39</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37575167"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37574552">
          <h3>
            <a
              class="item"
              href="https://eranstiller.com/rabbitmq-vs-kafka-an-architects-dilemma-part-1"
              >RabbitMQ vs. Kafka – An Architect’s Dilemma (Part 1)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 18:54:43</span
              ><span class="points-container"
                >Points: <span class="points">166</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37574552"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37571919">
          <h3>
            <a class="item" href="https://signal.org/blog/pqxdh/"
              >Quantum Resistance and the Signal Protocol</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 16:02:11</span
              ><span class="points-container"
                >Points: <span class="points">242</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37571919"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37571732">
          <h3>
            <a class="item" href="https://www.symphony.run/"
              >Show HN: Symphony – Use GPT-4 to call functions in sequence</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 15:51:02</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37571732"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
            <div class="text">
              <p>
                I'm excited to introduce Symphony – a toolkit designed to help
                developers write functions and let GPT-4 call them in whatever
                sequence that makes most sense based on conversation.
              </p>
              <p>
                I've been quite amazed[1] by GPT-4's recent ability to both
                detect when a function needs to be called and to respond with
                JSON that adheres to the function's signature.
              </p>
              <p>
                Since developers currently append descriptions of functions to
                API calls[2], I often found myself wishing for a toolkit that
                would automatically create these descriptions as I added and
                debugged functions during development.
              </p>
              <p>
                You can get started by cloning the repository and adding
                functions by following the guide at
                <a href="https://symphony.run/docs"
                  >https://symphony.run/docs</a
                >
              </p>
              <p>
                As of now, the toolkit supports functions in TypeScript. I'll be
                adding support for more languages and features based on your
                feedback :)
              </p>
              <p>
                [1] - Symphony Showcase:
                <a href="https://symphony.run/showcase"
                  >https://symphony.run/showcase</a
                >
              </p>
              <p>
                [2] - Function calling and other API updates from OpenAI:
                <a
                  href="https://openai.com/blog/function-calling-and-other-api-updates"
                  >https://openai.com/blog/function-calling-and-other-api-updat...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="37570422">
          <h3>
            <a class="item" href="https://tynan.com/pinball/"
              >Getting into Pinball</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 14:25:36</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37570422"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37570407">
          <h3>
            <a
              class="item"
              href="https://twitter.com/matthew_d_green/status/1703959863796158678"
              >Snowden leak: Cavium networking hardware may contain NSA
              backdoor</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 14:24:27</span
              ><span class="points-container"
                >Points: <span class="points">1012</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37570407"
                  >Comments</a
                ><span class="descendants">: 505</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37568950">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/09/19/arts/russell-brand-youtube.html"
              >YouTube blocks Russell Brand from making money through its
              platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 12:25:00</span
              ><span class="points-container"
                >Points: <span class="points">337</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37568950"
                  >Comments</a
                ><span class="descendants">: 776</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37568746">
          <h3>
            <a class="item" href="https://www.chequpi.com/"
              >Show HN: Cheq UPI – India's first UPI payments app for
              foreigners</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 12:02:32</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37568746"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
            <div class="text">
              <p>
                My name is Sudhanshu and I'm the Co-founder/CEO of Cheq UPI (<a
                  href="https://www.chequpi.com"
                  >https://www.chequpi.com</a
                >). We are the first UPI wallet for foreigners and non-resident
                Indians travelling to India. Using Cheq, you can purchase almost
                any goods/services across India .
              </p>
              <p>
                Just scan the merchant QR code / choose the pay by UPI id option
                to make the purchase. You don’t need an Indian bank account to
                operate Cheq UPI. Our prepaid wallet can be topped up with any
                international debit/credit card.
              </p>
              <p>
                10mn+ foreigners visiting India each year, invariably face one
                of the below problems
              </p>
              <p>
                1) Indian merchant not accepting international credit/debit
                cards
              </p>
              <p>
                2) Unavailability of ATMs/money changers at remote locations
              </p>
              <p>3) Indian merchants not tendering exact loose change</p>
              <p>
                The Cheq UPI app was launched to help all these individuals
                travel cashfree across the country.
              </p>
              <p>
                If know someone planning to visit India this year, please ask
                them to try us out!
              </p>
              <p>
                A lot of time, hard work and luck has gone into building Cheq
                and we hope it’ll make travelling to India more convenient for
                citizens across the globe.
              </p>
              <p>Some quick pointers to know about the Cheq UPI app:</p>
              <p>
                - The Cheq UPI app works ONLY in India and we must verify your
                passport in-person before activating the UPI wallet.
              </p>
              <p>
                - Once activated, you’ll be able to scan &amp; pay with UPI
                anywhere across India.
              </p>
              <p>
                - Funds can be added to the Cheq wallet using any international
                debit/credit card, you don’t need an Indian bank account /
                aadhaar card.
              </p>
              <p>
                - Apart from the 10$ account opening fees, there are no other
                costs for using the product. Funds added can be spent anywhere
                across India.
              </p>
              <p>
                I’ll be available to answer any questions you may have
                throughout the day about Cheq, UPI or Indian fintech in general.
              </p>
              <p>Look forward to seeing you all try Cheq UPI</p>
              <p>
                PS: We're continuously improving our services, so critical and
                constructive feedback is most welcome.
              </p>
            </div>
          </section>
        </section>
        <section id="37568554">
          <h3>
            <a class="item" href="https://simulavr.com/blog/headsets-delayed/"
              >Headsets Delayed into 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 11:41:47</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37568554"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37567504">
          <h3>
            <a class="item" href="https://github.com/permazen/permazen"
              >Permazen: a different persistence layer for Java</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 09:44:26</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37567504"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37559499">
          <h3>
            <a class="item" href="https://hllmn.net/blog/2023-09-18_h1x-net/"
              >Exploring the Halo 1 System Link Protocol</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-18 @ 17:53:05</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37559499"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37559095">
          <h3>
            <a class="item" href="https://github.com/d4ckard/liz"
              >Show HN: Liz – Collaborative Lisp coding on Discord</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-18 @ 17:22:52</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37559095"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <p>
                I wrote it in a short amount of time, partly for learning
                purposes, but also because I found the idea exciting and it was
                fun to hack around.
              </p>
              <p>
                I'd be happy to get your feedback, especially on how to improve
                the deletion mechanism (maybe make deletion sexpr-based?). I've
                tried to make the README detailed enough so that it's easy to
                make some changes and run your own version.
              </p>
            </div>
          </section>
        </section>
        <section id="37548095">
          <h3>
            <a class="item" href="https://github.com/planetlambert/turing"
              >Show HN: A reference implementation of Turing's paper “On
              Computable Numbers”</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-17 @ 18:42:09</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37548095"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <p>
                I've been curious about the history of computer science and
                decided to try to read Turing's 1936 paper where he
                conceptualizes the Turing Machine, etc.
              </p>
              <p>
                I had trouble understanding the paper, read The Annotated Turing
                by Charles Petzold (which is wonderful), but felt that reading a
                reference implementation would help formalize my understanding.
                When I couldn't find an open source implementation, I decided to
                write my own.
              </p>
              <p>The implementation includes:</p>
              <p></p>
              <pre><code>  - Abbreviated tables (m-functions)
  - Conversions to Standard Descriptions and Description Numbers
  - A working universal machine
  - A walkthrough of the paper section-by-section in the context of the codebase
</code></pre>
              I'm still working on sections 8-11 (the math/logic is a bit
              difficult for me) - if you understand these sections well enough
              to explain, I'd love to talk to you!
              <p>
                In general I am interested in new mediums for learning source
                material (web annotations, walkthroughs, reference
                implementations, etc.), and was inspired by Karpathy's Zero to
                Hero course in particular for this project.
              </p>
            </div>
          </section>
        </section>
        <section id="37547851">
          <h3>
            <a
              class="item"
              href="https://www.nathanmanousos.com/posts/chonky-menu"
              >Chonky Menu Re-Creation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-17 @ 18:16:04</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37547851"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
