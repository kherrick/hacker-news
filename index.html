<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38741746">
          <h3>
            <a
              class="item"
              href="https://vancouver.citynews.ca/2023/12/11/hyundai-ev-battery-icbc-cost/"
              >Vancouver EV owner shares cautionary tale after car deemed 'total
              loss'</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-23 @ 05:00:19</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38741746"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38741536">
          <h3>
            <a
              class="item"
              href="https://aftermath.site/true-lies-4k-uhd-blu-ray-james-cameron-peter-jackson-park-road-post"
              >They want you to forget what a film looks like</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-23 @ 04:06:42</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38741536"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38740544">
          <h3>
            <a
              class="item"
              href="https://hmri.org.au/news-article/researchers-discover-neuronal-biomarkers-schizophrenia-blood"
              >Researchers discover neuronal biomarkers of schizophrenia in the
              blood</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-23 @ 00:44:40</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38740544"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38739563">
          <h3>
            <a
              class="item"
              href="https://ethanzuckerman.com/2023/12/22/how-big-is-youtube/"
              >How big is YouTube?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-22 @ 22:55:19</span
              ><span class="points-container"
                >Points: <span class="points">376</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38739563"
                  >Comments</a
                ><span class="descendants">: 121</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38739130">
          <h3>
            <a
              class="item"
              href="https://bsky.app/profile/bsky.app/post/3kh5rbndrjd2x"
              >Posts, profiles, and user search are now available without
              login</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-22 @ 21:56:37</span
              ><span class="points-container"
                >Points: <span class="points">252</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38739130"
                  >Comments</a
                ><span class="descendants">: 272</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38738619">
          <h3>
            <a
              class="item"
              href="https://www.searchenginejournal.com/google-search-overwhelmed-by-massive-spam-attack/504527/"
              >Google is apparently struggling to contain an ongoing spam
              attack</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-22 @ 21:00:21</span
              ><span class="points-container"
                >Points: <span class="points">253</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38738619"
                  >Comments</a
                ><span class="descendants">: 149</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38737747">
          <h3>
            <a
              class="item"
              href="https://blogs.bodleian.ox.ac.uk/archivesandmanuscripts/2023/12/13/the-persistence-of-tradition-the-curious-case-of-henry-symeonis/"
              >The persistence of tradition: the curious case of Henry
              Symeonis</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-22 @ 19:37:57</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38737747"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38737326">
          <h3>
            <a class="item" href="https://zaranova.xyz/"
              >Show HN: Zaranova â€“ A game where you must pretend you are an
              AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-22 @ 19:00:22</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38737326"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
            <div class="text">
              <p>
                The last couple of months I've been working on a game called
                Thus Spoke Zaranova. A game where you as a human must pose as an
                AI. You can try it now:
              </p>
              <p><a href="https://zaranova.xyz">https://zaranova.xyz</a></p>
              <p>
                The premise is that you are in a world of sentient AIs which are
                in conflict with humanity. They have a virtual space, The Nexus,
                which is their safe refuge from humans. You have infiltrated the
                Nexus and are in search of the ZetaMaster code, which will give
                the humanity the upper hand in their struggle against artificial
                sentience.
              </p>
              <p>
                My overarching goal is to understand how to best use generative
                AI in video games. Like most of the tech world, I have been
                fascinated by the new powers provided by generative AI. I
                believe that the best use cases are those that either have a
                human in the loop, e.g. coding copilots, or one where the
                consumption of the content is subjective, e.g. art. Video games
                have numerous use cases that fall into both categories.
              </p>
              <p>
                The secondary goal, and more specific to this game, is to try to
                make generative AI games _fun_. Not only fun to me, I found
                story telling with GPT-3 (<a
                  href="https://twitter.com/RamonDarioIT/status/1552164189497462784"
                  >https://twitter.com/RamonDarioIT/status/1552164189497462784</a
                >) fun enough, but fun to a general audience. I am not sure if I
                have achieved this objective yet, but it's an ongoing process!
              </p>
              <p>
                You can find a longer post of my musings here:
                <a href="http://ramondario.com/thus-spoke-zaranova.html"
                  >http://ramondario.com/thus-spoke-zaranova.html</a
                >
              </p>
              <p>
                If you find this cool reach out to me, I love to chat about it.
                If you have feedback, I would love to hear it!
              </p>
            </div>
          </section>
        </section>
        <section id="38737028">
          <h3>
            <a
              class="item"
              href="https://webkit.org/blog/14879/webgpu-now-available-for-testing-in-safari-technology-preview/"
              >WebGPU now available for testing in Safari Technology Preview</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-22 @ 18:34:53</span
              ><span class="points-container"
                >Points: <span class="points">196</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38737028"
                  >Comments</a
                ><span class="descendants">: 135</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38736419">
          <h3>
            <a
              class="item"
              href="https://news.wosu.org/2023-12-21/ohio-gives-historical-status-to-building-that-once-housed-internet-service-pioneer-compuserve"
              >Ohio gives historical status to building that once housed
              CompuServe</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-22 @ 17:28:51</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38736419"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38736054">
          <h3>
            <a class="item" href="http://www.symbos.de/"
              >SymbOS Z80 multitasking operating system</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-22 @ 16:57:22</span
              ><span class="points-container"
                >Points: <span class="points">162</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38736054"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38735725">
          <h3>
            <a
              class="item"
              href="https://www.researchgate.net/publication/241778960_A_Pseudo-Quantum_Triad_Schrodinger%27s_Equation_the_Uncertainty_Principle_and_the_Heisenberg_Group"
              >SchrÃ¶dinger equation emerges mathematically from classical
              mechanics (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-22 @ 16:29:27</span
              ><span class="points-container"
                >Points: <span class="points">158</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38735725"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38735066">
          <h3>
            <a class="item" href="https://www.nand2tetris.org"
              >From Nand to Tetris (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-22 @ 15:31:59</span
              ><span class="points-container"
                >Points: <span class="points">560</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38735066"
                  >Comments</a
                ><span class="descendants">: 157</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38734164">
          <h3>
            <a class="item" href="https://mitxela.com/projects/scaffold"
              >LED Industrial Piercing</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-22 @ 13:59:03</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38734164"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38734106">
          <h3>
            <a
              class="item"
              href="https://biggieblog.com/celebrating-the-first-nes-tetris-game-crash/"
              >Celebrating the first NES Tetris game crash</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-22 @ 13:51:57</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38734106"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38733968">
          <h3>
            <a class="item" href="https://heynote.com/"
              >Show HN: Heynote â€“ A dedicated scratchpad for developers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-22 @ 13:33:51</span
              ><span class="points-container"
                >Points: <span class="points">823</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38733968"
                  >Comments</a
                ><span class="descendants">: 258</span></span
              >
            </h4>
            <div class="text">
              <p>
                I made Heynote entirely for my own use case. For many years, I
                always had an Emacs instance running with the scratch buffer
                open, even long after I had abandoned Emacs as my programming
                editor in favor of more recent IDE:s.
              </p>
              <p>
                The simplicity of having just one big scratch buffer appeals to
                me, but I still want to separate the different things I jot down
                somehow (without using tabs or similar). Previously, my solution
                was to insert a bunch of blank lines between the notes, but
                hitting C-A would still select the entire buffer. That's why I
                came up with the concept of "blocks", which turned out really
                well for my use cases.
              </p>
              <p>
                I decided to release Heynote, thinking it might be useful to
                others.
              </p>
            </div>
          </section>
        </section>
        <section id="38733446">
          <h3>
            <a
              class="item"
              href="https://jacquesmattheij.com/how-to-build-a-windmill/"
              >How to Build a Windmill (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-22 @ 12:21:21</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38733446"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38733282">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=38733282"
              >Ask HN: What's your "it's not stupid if it works" story?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-22 @ 11:50:57</span
              ><span class="points-container"
                >Points: <span class="points">189</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38733282"
                  >Comments</a
                ><span class="descendants">: 225</span></span
              >
            </h4>
            <div class="text">
              Cursed hacks, forcing proprietary software to do what you want
              through clever means, or just generally doing awful, beautiful
              things with technology?
            </div>
          </section>
        </section>
        <section id="38733264">
          <h3>
            <a class="item" href="https://www.cyberrunner.ai/"
              >Cyberrunner â€“ robot playing Labyrinth board game</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-22 @ 11:46:22</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38733264"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38732804">
          <h3>
            <a
              class="item"
              href="https://jacklance.github.io/PuzzleScript/play.html?p=cfdcc6e23f1fb3e9de2fd42fafaf4d4c"
              >Enigmash Game</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-22 @ 10:17:28</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38732804"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38732542">
          <h3>
            <a class="item" href="https://mindustrygame.github.io/"
              >Mindustry: Open-source automation tower defense game</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-22 @ 09:32:07</span
              ><span class="points-container"
                >Points: <span class="points">495</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38732542"
                  >Comments</a
                ><span class="descendants">: 107</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38732160">
          <h3>
            <a
              class="item"
              href="https://culanth.org/fieldsights/visualize-ing-air-data-icons-and-translations-of-smog-in-lahore"
              >Visualize-Ing Air: Data, Icons, and Translations of Smog in
              Lahore</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-22 @ 08:24:32</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38732160"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38724665">
          <h3>
            <a
              class="item"
              href="https://blog.arxiv.org/2023/12/21/accessibility-update-arxiv-now-offers-papers-in-html-format/"
              >ArXiv now offers papers in HTML format</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-21 @ 18:34:53</span
              ><span class="points-container"
                >Points: <span class="points">1113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38724665"
                  >Comments</a
                ><span class="descendants">: 293</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38719843">
          <h3>
            <a
              class="item"
              href="https://tastyhedge.com/blog/finite-difference-americans"
              >Pricing Americans with finite-difference</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-21 @ 12:55:00</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38719843"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38719439">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/culture/annals-of-inquiry/the-personal-political-art-of-board-game-design"
              >The personal, political art of board-game design</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-21 @ 12:08:52</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38719439"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38710318">
          <h3>
            <a class="item" href="https://varun.ch/server"
              >Most 16-year-olds don't have servers in their rooms</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 16:20:59</span
              ><span class="points-container"
                >Points: <span class="points">446</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38710318"
                  >Comments</a
                ><span class="descendants">: 449</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38707847">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2023/12/restored-478-key-31-tone-moog-synthesizer-from-1968-sounds-beautifully-bizarre/"
              >Restored 478-key, 31-tone Moog synthesizer from 1968</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 12:24:32</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38707847"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38707655">
          <h3>
            <a
              class="item"
              href="https://www.jeffquast.com/post/ucs-detect-test-results/"
              >Terminal Emulators Battle Royale â€“ Unicode Edition</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-20 @ 11:57:22</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38707655"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38695478">
          <h3>
            <a
              class="item"
              href="https://dmicz.github.io/machine-learning/svd-image-compression/"
              >SVD Image Compression</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-19 @ 13:50:30</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38695478"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38695258">
          <h3>
            <a
              class="item"
              href="https://www.seckington.com/the-art-of-slide-design-maximise-signal-minimise-noise/"
              >The art of slide design: Maximise signal, minimise noise</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-19 @ 13:29:40</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38695258"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
