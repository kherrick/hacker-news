<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38289376">
          <h3>
            <a class="item" href="https://github.com/matteason/live-cloud-maps"
              >Show HN: Near-realtime cloud maps for visualisations, 3D
              modelling and more</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-16 @ 13:40:51</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38289376"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <p>
                It's based on infrared and visible light data from EUMETSAT,
                processed to enhance the clouds and try to reduce the impact of
                surface temperatures on the final image.
              </p>
              <p>
                I built it because it's surprisingly hard to find these kinds of
                images in a format that's useful to developers and hobbyists. I
                was building a 3D ISS tracker and wanted to include live clouds
                but couldn't find anything good, so I got sidetracked, and here
                we are.
              </p>
            </div>
          </section>
        </section>
        <section id="38288980">
          <h3>
            <a
              class="item"
              href="https://ethz.ch/en/news-and-events/eth-news/news/2023/11/printed-robots-with-bones-ligaments-and-tendons.html"
              >Printed robots with bones, ligaments, and tendons</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-16 @ 12:56:45</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38288980"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38288977">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/information-technology/2023/11/youtube-will-require-creators-to-disclose-realistic-ai-generated-or-altered-content/"
              >YouTube cracks down on synthetic media with AI disclosure
              requirement</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-16 @ 12:56:39</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38288977"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38288743">
          <h3>
            <a class="item" href="https://github.com/pipeless-ai/pipeless"
              >Serverless development experience for embedded computer vision</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-16 @ 12:29:32</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38288743"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38288444">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/Oink%27s_Pink_Palace"
              >OiNK's Pink Palace was shut down 16 years ago</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-16 @ 11:53:31</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38288444"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38288130">
          <h3>
            <a
              class="item"
              href="https://twitter.com/multikev/status/1724908185361011108"
              >I think I need to go lie down</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-16 @ 11:07:23</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38288130"
                  >Comments</a
                ><span class="descendants">: 145</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38288020">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/music/2023/nov/16/archive-of-contemporary-music-new-york"
              >'No one else is saving it': the fight to protect a historic music
              collection</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-16 @ 10:52:11</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38288020"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38287554">
          <h3>
            <a class="item" href="https://dosdeck.com/"
              >DOS_deck: Play DOS games in the browser with full controller
              support</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-16 @ 09:52:40</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38287554"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38287435">
          <h3>
            <a
              class="item"
              href="https://www.nngroup.com/articles/AI-conversation-types/"
              >Types of Conversations with Generative AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-16 @ 09:34:20</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38287435"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38287257">
          <h3>
            <a
              class="item"
              href="https://www.bps.org.uk/research-digest/smart-drugs-arent-so-smart-after-all"
              >Smart drugs reduce quality of effort, and slow decision-making</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-16 @ 09:12:15</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38287257"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38287095">
          <h3>
            <a
              class="item"
              href="https://lwn.net/SubscriberLink/950466/0999d63fdf270781/"
              >The push to save the Itanium architecture in Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-16 @ 08:46:36</span
              ><span class="points-container"
                >Points: <span class="points">95</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38287095"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38287043">
          <h3>
            <a
              class="item"
              href="https://deepmind.google/discover/blog/transforming-the-future-of-music-creation/"
              >Google: Transforming the Future of Music Creation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-16 @ 08:39:29</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38287043"
                  >Comments</a
                ><span class="descendants">: 208</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38286761">
          <h3>
            <a
              class="item"
              href="https://github.com/vectara/hallucination-leaderboard"
              >LLMs by Hallucination Rate</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-16 @ 07:44:25</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38286761"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38286130">
          <h3>
            <a
              class="item"
              href="http://zandarvts.blogspot.com/2023/11/last-post-please-read.html"
              >Last Post, Please Read</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-16 @ 05:38:42</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38286130"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38285482">
          <h3>
            <a class="item" href="https://github.com/agentcasa/doda"
              >Show HN: OpenAI dev assistant GUI with local code interpreter</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-16 @ 03:13:00</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38285482"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38285228">
          <h3>
            <a class="item" href="https://github.com/abi/screenshot-to-code"
              >Show HN: Convert any screenshot into clean HTML code using GPT
              Vision (OSS tool)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-16 @ 02:27:40</span
              ><span class="points-container"
                >Points: <span class="points">189</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38285228"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
            <div class="text">
              <p>
                I built a simple React/Python app that takes screenshots of
                websites and converts them to clean HTML/Tailwind code.
              </p>
              <p>
                It uses GPT-4 Vision to generate the code, and DALL-E 3 to
                create placeholder images.
              </p>
              <p>
                To run it, all you need is an OpenAI key with GPT vision access.
              </p>
              <p>
                I’m quite pleased with how well it works most of the time.
                Sometimes, the image generations can be hilariously off. See
                here for a replica of Taylor Swift’s Instagram page:
                <a href="https://streamable.com/70gow1"
                  >https://streamable.com/70gow1</a
                >
                I initially had a hard time getting it to work on full page
                screenshots. GPT4 would code up the first couple of sections and
                then, get lazy and output placeholder comments for the rest of
                the page. With some prompt engineering, full page screenshots
                work a whole lot better now. It’s great for landing pages.
              </p>
              <p>
                Lots of ideas of where to go from here! Let me know if you have
                feedback and you find this useful :)
              </p>
            </div>
          </section>
        </section>
        <section id="38284150">
          <h3>
            <a class="item" href="https://www.faa.gov/media/69476"
              >SpaceX Starship/Super Heavy OFT-2 Launch Authorized</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-16 @ 00:00:35</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38284150"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38283936">
          <h3>
            <a
              class="item"
              href="https://ivan.sanchezortega.es/development/2023/11/13/scintillocartography.html"
              >Scintillocartography</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 23:34:48</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38283936"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38283860">
          <h3>
            <a
              class="item"
              href="https://energyhistory.yale.edu/grand-ball-given-by-the-whales-vanity-fair-april-20-1861/"
              >Grand Ball Given by the Whales (1861)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 23:23:01</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38283860"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38282950">
          <h3>
            <a
              class="item"
              href="https://matklad.github.io/2023/11/15/push-ifs-up-and-fors-down.html"
              >Push ifs up and fors down</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 21:41:20</span
              ><span class="points-container"
                >Points: <span class="points">502</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38282950"
                  >Comments</a
                ><span class="descendants">: 230</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38282166">
          <h3>
            <a
              class="item"
              href="https://younganimator.uk/winner/1699875910225x437970782709919500"
              >Blender 16yo winner of UK young animator of the year</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 20:42:30</span
              ><span class="points-container"
                >Points: <span class="points">1421</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38282166"
                  >Comments</a
                ><span class="descendants">: 200</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38279459">
          <h3>
            <a
              class="item"
              href="https://razberry.substack.com/p/btree-factorio"
              >B-trees in Factorio</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 17:25:12</span
              ><span class="points-container"
                >Points: <span class="points">273</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38279459"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38278246">
          <h3>
            <a
              class="item"
              href="https://www.britishecologicalsociety.org/new-deep-learning-ai-tool-helps-ecologists-monitor-rare-birds-through-their-songs/"
              >AI tool helps ecologists monitor rare birds through their
              songs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 16:09:19</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38278246"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38278171">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2023/11/15/23960345/microsoft-cpu-gpu-ai-chips-azure-maia-cobalt-specifications-cloud-infrastructure"
              >The first two custom silicon chips designed by Microsoft for its
              cloud</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 16:02:51</span
              ><span class="points-container"
                >Points: <span class="points">226</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38278171"
                  >Comments</a
                ><span class="descendants">: 254</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38277926">
          <h3>
            <a class="item" href="https://simonwillison.net/2023/Nov/15/gpts/"
              >Exploring GPTs: ChatGPT in a trench coat?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 15:44:23</span
              ><span class="points-container"
                >Points: <span class="points">455</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38277926"
                  >Comments</a
                ><span class="descendants">: 196</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38277361">
          <h3>
            <a
              class="item"
              href="https://www.atlasobscura.com/articles/canned-food-history"
              >Canned food went from military rations to fancy appetizers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 15:06:19</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38277361"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38276743">
          <h3>
            <a
              class="item"
              href="https://www.raptitude.com/2023/10/the-truth-is-always-made-of-details/"
              >The truth is always made of details</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 14:09:17</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38276743"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38276727">
          <h3>
            <a
              class="item"
              href="https://robertrode.com/2023/11/15/operating-an-entire-company-on-a-minimal-two-core-postgresql-instance-query-optimization-insights-part-1.html"
              >Operating an Entire Company on a Minimal Two-Core PostgreSQL
              Instance, Part 1</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 14:08:03</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38276727"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38276680">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/science/2023/11/study-reveals-how-natural-processes-helped-sculpt-the-great-sphinx-of-giza/"
              >The Great Sphinx of Giza may have have started out as a natural
              formation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 14:02:50</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38276680"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38275905">
          <h3>
            <a
              class="item"
              href="https://onwriting.games/daily/20231115-1056-dont-run-into-the-woods/"
              >Don't Run into the Woods</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-15 @ 12:22:54</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38275905"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
