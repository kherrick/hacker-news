<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41873204">
          <h3>
            <a
              class="item"
              href="https://help.kagi.com/kagi/features/exclude-ai-images.html"
              >Kagi Update: AI Image Filter for Search Results</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 20:02:05</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41873204"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41872628">
          <h3>
            <a
              class="item"
              href="https://torment-nexus.mathewingram.com/is-matt-mullenweg-defending-wordpress-or-sabotaging-it/"
              >Is Matt Mullenweg defending WordPress or sabotaging it?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 18:53:04</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41872628"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41872046">
          <h3>
            <a
              class="item"
              href="https://www.404media.co/automattic-buyout-offer-wordpress-matt-mullenweg/"
              >Employees Describe an Environment of Paranoia and Fear Inside
              Automattic</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 18:04:39</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41872046"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41871899">
          <h3>
            <a
              class="item"
              href="https://www.jeffgeerling.com/blog/2024/qualcomm-cancels-snapdragon-dev-kit-refunds-all-orders"
              >Qualcomm cancels Snapdragon Dev Kit, refunds all orders</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 17:50:54</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41871899"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41871812">
          <h3>
            <a
              class="item"
              href="https://www.economist.com/science-and-technology/2024/10/16/tubeworms-live-beneath-the-planetary-crust-around-deep-sea-vents"
              >Tubeworms live beneath the planetary crust around deep-sea
              vents</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 17:41:38</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41871812"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41871729">
          <h3>
            <a
              class="item"
              href="https://mathenchant.wordpress.com/2024/10/17/industrious-dice/"
              >Industrious Dice</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 17:32:40</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41871729"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41871721">
          <h3>
            <a
              class="item"
              href="https://www.kaggle.com/competitions/ai-mathematical-olympiad-progress-prize-2"
              >AI Mathematical Olympiad – Progress Prize 2</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 17:31:44</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41871721"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41871506">
          <h3>
            <a
              class="item"
              href="https://architizer.com/blog/practice/details/education-architecture-changing-views-childhood/"
              >Rethinking School Design</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 17:09:43</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41871506"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41871403">
          <h3>
            <a
              class="item"
              href="https://us.toa.st/blogs/magazine/inside-the-kew-herbarium-matt-collins"
              >The Kew Herbarium (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 16:57:49</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41871403"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41871375">
          <h3>
            <a class="item" href="https://pudding.cool/2024/10/crokinole/"
              >Crokinole</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 16:54:49</span
              ><span class="points-container"
                >Points: <span class="points">243</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41871375"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41871262">
          <h3>
            <a
              class="item"
              href="https://blog.google/technology/ai/notebooklm-update-october-2024/"
              >NotebookLM launches feature to customize and guide audio
              overviews</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 16:42:04</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41871262"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41871090">
          <h3>
            <a class="item" href="https://savaos.com/"
              >Show HN: Sava OS – A desktop interface for your web browser</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 16:20:30</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41871090"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
            <div class="text">
              <p>
                I think you've heard this a thousand times by now; "We spend
                most of our time on the web browser, yet nothing has changed."
                And then a "revolutionary" product comes out that puts our links
                &amp; tabs collapsed on the side, with some extra features.
                Magical, right :)?
              </p>
              <p>
                Well, we tried a lot of these products, and we also tried
                building one ourselves about 8years ago. But we felt like no UI
                can handle the same kind of organization our desktop can, and
                that's when the idea first came to our mind ~5years ago. For the
                past year, we worked on the side to build the MVP you see today.
                But along these years, a lot of thoughts kept popping up, and
                that's why this product has an OS in it's name (it's still
                cooking :).
              </p>
              <p>
                Unlike other desktop-like products that are accessible on the
                browser, Sava OS is not only built and made to run natively on
                the web browser, but it actually has some useful features to
                help with your browsing management - and that's only the
                beginning.
              </p>
              <p>
                There's still a lot to consider when it comes to shaping a
                modern, desktop-like UI that meets today's needs.. We’ve got
                some exciting ideas and aim to go beyond the traditional
                approach.
              </p>
              <p>We would really love to hear your take on this.</p>
            </div>
          </section>
        </section>
        <section id="41871024">
          <h3>
            <a class="item" href="https://dynomight.substack.com/p/arithmetic"
              >Arithmetic is an underrated world-modeling technology</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 16:14:39</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41871024"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41870887">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41870887"
              >I'm Peter Roberts, immigration attorney who does work for YC and
              startups. AMA</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 16:01:16</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41870887"
                  >Comments</a
                ><span class="descendants">: 147</span></span
              >
            </h4>
            <div class="text">
              <p>
                Previous threads we've done:
                https://news.ycombinator.com/submitted?id=proberts.
              </p>
            </div>
          </section>
        </section>
        <section id="41870040">
          <h3>
            <a
              class="item"
              href="https://www.creativebloq.com/design/adobes-new-image-rotation-tool-is-one-of-the-most-impressive-ai-concepts-weve-seen"
              >Adobe's new image rotation tool is one of the most impressive AI
              tools seen</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 14:31:18</span
              ><span class="points-container"
                >Points: <span class="points">511</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41870040"
                  >Comments</a
                ><span class="descendants">: 176</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41869898">
          <h3>
            <a
              class="item"
              href="https://praydog.com/reverse-engineering/2023/07/03/uevr.html"
              >UEVR: An Exploration of Advanced Game Hacking Techniques
              (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 14:16:17</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41869898"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41869460">
          <h3>
            <a
              class="item"
              href="https://gitlab.com/lockie/cl-fast-ecs/-/wikis/tutorial-2"
              >Gamedev in Lisp. Part 2: Dungeons and Interfaces</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 13:26:25</span
              ><span class="points-container"
                >Points: <span class="points">212</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41869460"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41868815">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/optery/jobs"
              >Optery (YC W22) Is Hiring Product Manager and Full Stack
              Developer (Node.js)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 12:01:00</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41868683">
          <h3>
            <a
              class="item"
              href="https://www.cell.com/iscience/fulltext/S2589-0042(24)02024-8"
              >Cats are (almost) liquid</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 11:43:00</span
              ><span class="points-container"
                >Points: <span class="points">179</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41868683"
                  >Comments</a
                ><span class="descendants">: 104</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41866802">
          <h3>
            <a
              class="item"
              href="https://ading.dev/blog/posts/chrome_sandbox_escape.html"
              >Escaping the Chrome Sandbox Through DevTools</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 05:55:04</span
              ><span class="points-container"
                >Points: <span class="points">360</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41866802"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41864632">
          <h3>
            <a
              class="item"
              href="https://openrss.org/blog/using-cloudflare-on-your-website-could-be-blocking-rss-users"
              >Using Cloudflare on your website could be blocking RSS users</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 22:46:37</span
              ><span class="points-container"
                >Points: <span class="points">457</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41864632"
                  >Comments</a
                ><span class="descendants">: 207</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41853942">
          <h3>
            <a
              class="item"
              href="https://mcejp.github.io/2024/10/16/gba-raycasting.html"
              >How I failed to make a game: Raycasting on the GBA</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 22:53:35</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41853942"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41853767">
          <h3>
            <a
              class="item"
              href="https://lcamtuf.substack.com/p/memory-the-forgotten-history"
              >Memory: the forgotten history</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 22:25:18</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41853767"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41852971">
          <h3>
            <a
              class="item"
              href="https://www.hagerty.com/media/automobilia/the-rise-and-fall-of-matchboxs-toy-car-empire/"
              >The Rise and Fall of Matchbox's Toy-Car Empire</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 20:51:28</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41852971"
                  >Comments</a
                ><span class="descendants">: 96</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41844624">
          <h3>
            <a
              class="item"
              href="https://www.unicode.org/emoji/proposals.html#frequency-evidence"
              >Unicode uses elephants as baseline comparison of cultural
              frequency for emoji</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 03:28:52</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41844624"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41843532">
          <h3>
            <a
              class="item"
              href="https://paper.wf/binarycat/a-protocol-for-reliable-notifications-over-a-1-bit-fallible-connection"
              >A protocol for reliable notifications over a 1 bit fallible
              connection</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-14 @ 23:58:13</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41843532"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41841853">
          <h3>
            <a class="item" href="https://re.factorcode.org/2024/10/emit.html"
              >Emit</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-14 @ 20:51:30</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41841853"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41831735">
          <h3>
            <a
              class="item"
              href="https://shchegrikovich.substack.com/p/use-prolog-to-improve-llms-reasoning"
              >Use Prolog to improve LLM's reasoning</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-13 @ 21:22:48</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41831735"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41828771">
          <h3>
            <a
              class="item"
              href="https://statmodeling.stat.columbia.edu/2024/10/08/defining-statistical-models-in-jax/#comments"
              >Defining Statistical Models in Jax?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-13 @ 15:20:34</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41828771"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41825906">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41467-024-49689-w"
              >Amplification of electromagnetic fields by a rotating body</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-13 @ 07:23:07</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41825906"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
