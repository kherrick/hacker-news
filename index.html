<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="45503960">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/interactive/2025/10/06/upshot/us-international-student-travel.html"
              >Nearly 20 Percent Fewer International Students Traveled to the
              U.S. in August</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 15:01:29</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45503960"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45503882">
          <h3>
            <a
              class="item"
              href="https://www.france24.com/en/live-news/20251001-swiss-glaciers-shrank-by-a-quarter-in-past-decade-study"
              >Swiss glaciers have shrunk by a quarter since 2015, study says</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 14:56:09</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45503882"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45503726">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2025/10/07/windows_11_local_account_loophole/"
              >No account? No Windows 11, Microsoft says as another loophole
              snaps shut</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 14:45:54</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45503726"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45502979">
          <h3>
            <a class="item" href="https://www.zima.run/"
              >Show HN: Blueprintor for Hardware Engineering</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 13:42:49</span
              ><span class="points-container"
                >Points: <span class="points">3</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45502979"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
            <div class="text">
              <p>
                • I built this tool to lighten the load of poring over countless
                component data sheets at project kickoff and to make blueprint
                iteration smoother. I’m aiming beyond “hardware” to the wider
                class of machines without operating systems, structured
                hierarchically as system–subsystem–component, so we can reason
                clearly at each level and lower conceptual entropy throughout
                the design process.
              </p>
              <p>
                • Right now, the tool excels at precise spec comparisons for
                off‑the‑shelf components, but there are still blind spots in
                modeling the full physical behavior of a hardware system. I’m
                investigating simulation to close that gap. It also doesn’t yet
                design PCBs or handle CAD modeling directly.
              </p>
              <p>
                • I’m currently building a node‑editing feature. Very soon
                (within 1–2 days), you’ll be able to edit detailed information
                for nodes at every level. Over the next month, I’m targeting a
                basic 3D canvas to create and configure three‑dimensional data
                for hardware.
              </p>
              <p>
                As a demo, there’s plenty to improve. I want to keep learning
                and evolving this tool so it can meaningfully support hardware
                and machine design. I’d truly value your feedback!
              </p>
            </div>
          </section>
        </section>
        <section id="45502784">
          <h3>
            <a class="item" href="https://wiki.tcl-lang.org/page/Showcase"
              >Tcl-Lang Showcase</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 13:25:33</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45502784"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45502748">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/features/2025-3m-pfas-toxic-legacy-turnaround/"
              >3M May Escape Toxic Chemical, PFAS Manufacturing Legacy</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 13:22:04</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45502748"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45502543">
          <h3>
            <a
              class="item"
              href="https://www.grisp.org/blog/posts/2025-10-07-jit-arm32.3"
              >Erlang ARM32 JIT is born</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 13:00:25</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45502543"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45502541">
          <h3>
            <a
              class="item"
              href="https://www.qualcomm.com/news/releases/2025/10/qualcomm-to-acquire-arduino-accelerating-developers--access-to-i"
              >Qualcomm to Acquire Arduino</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 13:00:08</span
              ><span class="points-container"
                >Points: <span class="points">392</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45502541"
                  >Comments</a
                ><span class="descendants">: 182</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45502502">
          <h3>
            <a class="item" href="https://www.lua.org/doc/cola.pdf"
              >The evolution of Lua, continued [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 12:54:14</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45502502"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45502387">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/provision/jobs/JJ9fZxg-fullstack-software-engineer-in-person-toronto-canada"
              >Provision (YC S22) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 12:41:40</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45502173">
          <h3>
            <a
              class="item"
              href="https://github.com/NullVoxPopuli/disk-perf-git-and-pnpm"
              >Stress test for parallel disk i/o using git and pnpm</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 12:14:16</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45502173"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45501279">
          <h3>
            <a class="item" href="https://github.com/hunvreus/devpush"
              >Devpush – Open-source and self-hostable alternative to Vercel,
              Render, Netlify</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 10:07:50</span
              ><span class="points-container"
                >Points: <span class="points">195</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45501279"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45501189">
          <h3>
            <a
              class="item"
              href="https://www.nobelprize.org/prizes/physics/2025/popular-information/"
              >Nobel Prize in Physics 2025</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 09:50:49</span
              ><span class="points-container"
                >Points: <span class="points">261</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45501189"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45501114">
          <h3>
            <a
              class="item"
              href="http://marcosh.github.io/post/2025/10/07/the-mondrian-introduction-to-functional-optics.html"
              >The Mondrian introduction to functional optics</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 09:35:53</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45501114"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45500699">
          <h3>
            <a
              class="item"
              href="https://www.motor1.com/news/774805/ford-ceo-complains-shortage-mechanics/"
              >A mechanic offered a reason why no one wants to work in the
              industry</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 08:27:41</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45500699"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45500560">
          <h3>
            <a class="item" href="https://exuberant-premise-723012.framer.app/"
              >Show HN: Greenonion.ai – AI-Powered Design Assistant</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 08:04:49</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45500560"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
            <div class="text">
              <p>
                I’m excited to launch GreenOnion.ai — a platform that helps
                anyone create beautiful, editable design layouts instantly using
                AI.
              </p>
              <p>
                A lot of “AI design” tools today generate images. GreenOnion
                doesn’t. You bring your own images — our AI handles the layout,
                composition, colors, and typography to turn them into cohesive,
                ready-to-use designs.
              </p>
              <p>
                Every element is structured and editable — text, spacing,
                colors, hierarchy — not just pixels on a canvas. It’s real
                design generation, not image generation.
              </p>
              <p>What it does:</p>
              <p>
                Describe what you want (e.g. “modern poster for a coffee brand”)
              </p>
              <p>AI builds a layout around your content and image</p>
              <p>Edit and refine everything in the browser</p>
              <p>Export for web, print, or campaigns</p>
              <p>
                Why we built it: Design shouldn’t be locked behind complex tools
                or templates. If you can describe an idea, you should be able to
                see it take form — and still have full control to adjust it.
              </p>
              <p>
                It’s live and working today:
                <a href="https://greenonion.ai">https://greenonion.ai</a>
              </p>
              <p>
                I’d love your feedback — whether it’s about the product, the
                concept, or where you think AI-driven design should go next.
              </p>
              <p>Thanks for reading, — Yanjie Founder, GreenOnion.ai</p>
            </div>
          </section>
        </section>
        <section id="45500485">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/australia-news/2025/oct/06/deloitte-to-pay-money-back-to-albanese-government-after-using-ai-in-440000-report"
              >Deloitte to refund the Australian government after using AI in
              $440k report</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-07 @ 07:51:57</span
              ><span class="points-container"
                >Points: <span class="points">304</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45500485"
                  >Comments</a
                ><span class="descendants">: 155</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45497624">
          <h3>
            <a
              class="item"
              href="https://thecascade.dev/article/least-amount-of-css/"
              >The least amount of CSS for a decent looking site (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 23:47:24</span
              ><span class="points-container"
                >Points: <span class="points">632</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45497624"
                  >Comments</a
                ><span class="descendants">: 264</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45494558">
          <h3>
            <a class="item" href="https://developers.openai.com/apps-sdk/"
              >Apps SDK</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 18:27:33</span
              ><span class="points-container"
                >Points: <span class="points">432</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45494558"
                  >Comments</a
                ><span class="descendants">: 358</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45490629">
          <h3>
            <a
              class="item"
              href="https://mobeigi.com/blog/economics/chesscom-regional-pricing/"
              >Chess.com Regional Pricing: A Case Study</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 12:29:26</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45490629"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45489874">
          <h3>
            <a
              class="item"
              href="https://scholarship.claremont.edu/cgi/viewcontent.cgi?article=1720&amp;context=jhm"
              >Ahab's Arithmetic: The Mathematics of Moby-Dick</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-06 @ 10:38:21</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45489874"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45473357">
          <h3>
            <a class="item" href="https://microformats.org"
              >Microformats – building blocks for data-rich web pages</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-04 @ 13:58:00</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45473357"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45469376">
          <h3>
            <a
              class="item"
              href="https://windscribe.com/blog/the-vpn-relationship-map/"
              >Who owns Express VPN, Nord, Surfshark? VPN relationships
              explained (2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-04 @ 00:30:44</span
              ><span class="points-container"
                >Points: <span class="points">588</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45469376"
                  >Comments</a
                ><span class="descendants">: 340</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45468599">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/space/2025/10/everyone-but-china-has-pretty-much-stopped-littering-in-low-earth-orbit/"
              >Removing these 50 objects from orbit would cut danger from space
              junk in half</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 22:30:57</span
              ><span class="points-container"
                >Points: <span class="points">204</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45468599"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45467751">
          <h3>
            <a
              class="item"
              href="https://blogsystem5.substack.com/p/you-are-holding-build-files-wrong"
              >Build files are the best tool to represent software
              architecture</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 21:04:00</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45467751"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45467600">
          <h3>
            <a
              class="item"
              href="https://dcmlr.inf.fu-berlin.de/rojas/index.html%3Fp=560.html"
              >Reconstruction of Konrad Zuse's Z3 Computer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 20:47:04</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45467600"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45462877">
          <h3>
            <a
              class="item"
              href="https://www.alexmolas.com/2025/07/28/unexpected-benefit-llm.html"
              >Who needs Git when you have 1M context windows?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 13:37:34</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45462877"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45458973">
          <h3>
            <a
              class="item"
              href="https://animebythenumbers.substack.com/p/worse-crunchyroll-subtitles"
              >Why did Crunchyroll's subtitles just get worse?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-03 @ 04:24:58</span
              ><span class="points-container"
                >Points: <span class="points">363</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45458973"
                  >Comments</a
                ><span class="descendants">: 249</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45456381">
          <h3>
            <a
              class="item"
              href="https://www.motivenotes.ai/p/what-makes-5-of-ai-agents-actually"
              >What makes 5% of AI agents work in production?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-02 @ 22:30:46</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45456381"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45449015">
          <h3>
            <a
              class="item"
              href="https://physicsworld.com/a/kirigami-inspired-parachute-falls-on-target/"
              >Kirigami-inspired parachute falls on target</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-02 @ 12:54:13</span
              ><span class="points-container"
                >Points: <span class="points">288</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45449015"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
