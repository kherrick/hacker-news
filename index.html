<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42658614">
          <h3>
            <a class="item" href="https://www.pagat.com/combat/cuttle.html"
              >Cuttle – a MTG like game using a standard 52 card deck</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-10 @ 18:43:26</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42658614"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42658512">
          <h3>
            <a
              class="item"
              href="https://www.esa.int/ESA_Multimedia/Images/2025/01/Mercury_s_shadowy_north_pole_revealed_by_M-CAM_1"
              >Mercury's shadowy North Pole revealed by M-CAM 1</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-10 @ 18:34:55</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42658512"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42657901">
          <h3>
            <a
              class="item"
              href="https://www.axios.com/2025/01/10/meta-dei-memo-employees-programs"
              >Meta's memo to employees rolling back DEI programs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-10 @ 17:48:04</span
              ><span class="points-container"
                >Points: <span class="points">222</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42657901"
                  >Comments</a
                ><span class="descendants">: 279</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42657692">
          <h3>
            <a
              class="item"
              href="https://restofworld.org/2025/starlink-cheaper-internet-africa/"
              >Starlink is now cheaper than leading internet provider in some
              African countries</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-10 @ 17:24:32</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42657692"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42657591">
          <h3>
            <a
              class="item"
              href="https://lcamtuf.substack.com/p/getting-silly-with-c-part-void2"
              >Getting silly with C, part (void*)2</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-10 @ 17:16:12</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42657591"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42656529">
          <h3>
            <a class="item" href="https://github.com/serge-sans-paille/i8mm"
              >Experiments with Byte Matrix Multiplication</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-10 @ 15:36:17</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42656529"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42656433">
          <h3>
            <a class="item" href="https://brooker.co.za/blog/2024/04/17/formal"
              >Formal Methods: Just Good Engineering Practice? (2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-10 @ 15:25:42</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42656433"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42655870">
          <h3>
            <a
              class="item"
              href="https://danielwirtz.com/blog/spot-the-difference-superpower"
              >I've acquired a new superpower</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-10 @ 14:34:34</span
              ><span class="points-container"
                >Points: <span class="points">498</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42655870"
                  >Comments</a
                ><span class="descendants">: 228</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42655636">
          <h3>
            <a
              class="item"
              href="https://commonplace.online/article/the-tedious-heroism-of-david-ruggles/"
              >The Tedious Heroism of David Ruggles</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-10 @ 14:02:23</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42655636"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42655102">
          <h3>
            <a
              class="item"
              href="https://iconsolutions.com/blog/i-got-opentelemetry-to-work-but-why-was-it-so-complicated/"
              >I got OpenTelemetry to work. But why was it so complicated?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-10 @ 12:38:35</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42655102"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42655098">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2501.04682"
              >Learning How to Think with Meta Chain-of-Thought</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-10 @ 12:37:54</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42655098"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42654995">
          <h3>
            <a
              class="item"
              href="https://writings.stephenwolfram.com/2025/01/who-can-understand-the-proof-a-window-on-formalized-mathematics/"
              >Who Can Understand the Proof? A Window on Formalized
              Mathematics</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-10 @ 12:21:06</span
              ><span class="points-container"
                >Points: <span class="points">150</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42654995"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42654901">
          <h3>
            <a class="item" href="https://www.workatastartup.com/jobs/41643"
              >Wasmer (YC S19) Is Hiring a Rust Engineer in EU timezone
              (Remote)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-10 @ 12:00:44</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42654331">
          <h3>
            <a class="item" href="https://github.com/gdm85/lc"
              >lc: List files in categories (and columns) – from Coherent Unix
              clone</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-10 @ 10:10:10</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42654331"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42654019">
          <h3>
            <a class="item" href="https://github.com/NVIDIA/nv-ingest"
              >Nvidia-Ingest: Multi-modal data extraction</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-10 @ 09:17:47</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42654019"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42653939">
          <h3>
            <a class="item" href="https://github.com/AndyObtiva/glimmer"
              >Glimmer: DSL Framework for Ruby GUI and More</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-10 @ 09:02:31</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42653939"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42653811">
          <h3>
            <a class="item" href="https://tactility.one/#/"
              >Tactility: OS for the ESP32 Microcontroller Family</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-10 @ 08:37:08</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42653811"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42652967">
          <h3>
            <a
              class="item"
              href="https://www.tokyoweekender.com/entertainment/movies-tv/before-squid-game-there-was-battle-royale/"
              >Before Squid Game, there was Battle Royale</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-10 @ 05:53:06</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42652967"
                  >Comments</a
                ><span class="descendants">: 202</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42652577">
          <h3>
            <a class="item" href="https://annas-archive.org/blog/all-isbns.html"
              >Visualizing All ISBNs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-10 @ 04:45:55</span
              ><span class="points-container"
                >Points: <span class="points">300</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42652577"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42651275">
          <h3>
            <a
              class="item"
              href="https://rodneybrooks.com/predictions-scorecard-2025-january-01/"
              >Predictions Scorecard, 2025 January 01</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-10 @ 00:27:55</span
              ><span class="points-container"
                >Points: <span class="points">227</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42651275"
                  >Comments</a
                ><span class="descendants">: 172</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42649340">
          <h3>
            <a
              class="item"
              href="https://theconversation.com/how-britain-got-its-first-internet-connection-by-the-late-pioneer-who-created-the-first-password-on-the-internet-45404"
              >How Britain got its first internet connection (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-09 @ 20:02:36</span
              ><span class="points-container"
                >Points: <span class="points">160</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42649340"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42647101">
          <h3>
            <a
              class="item"
              href="https://blog.orange.tw/posts/2025-01-worstfit-unveiling-hidden-transformers-in-windows-ansi/"
              >WorstFit: Unveiling Hidden Transformers in Windows ANSI</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-09 @ 16:19:34</span
              ><span class="points-container"
                >Points: <span class="points">339</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42647101"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42645218">
          <h3>
            <a class="item" href="https://th0mas.nl/downloads/pdftris.pdf"
              >Show HN: Tetris in a PDF</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-09 @ 13:31:33</span
              ><span class="points-container"
                >Points: <span class="points">1090</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42645218"
                  >Comments</a
                ><span class="descendants">: 200</span></span
              >
            </h4>
            <div class="text">
              <p>
                It was a bit tricky to find a union of features that work in
                both engines, but in the end it turns out that showing/hiding
                annotation "fields" works well to make monochrome pixels, and
                keyboard input can be achieved by typing in a text input box.
              </p>
              <p>
                All in all it's quite janky but a nice reminder of how general
                purpose PDF scripting can be. The linked PDF is all ASCII so you
                can just open it in a text editor, or have a look at the source
                code here:
                <a
                  href="https://github.com/ThomasRinsma/pdftris/blob/main/gengrid.py"
                  >https://github.com/ThomasRinsma/pdftris/blob/main/gengrid.py</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="42645110">
          <h3>
            <a
              class="item"
              href="https://jirevwe.github.io/sql-nulls-are-weird.html"
              >SQL nulls are weird</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-09 @ 13:21:40</span
              ><span class="points-container"
                >Points: <span class="points">188</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42645110"
                  >Comments</a
                ><span class="descendants">: 234</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42622264">
          <h3>
            <a
              class="item"
              href="https://bytes.vadelabs.com/doing-hard-things-while-living-life-why-we-built-vade-studio-in-clojure/"
              >Doing Hard Things While Living Life: Why We Built Vade Studio in
              Clojure</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-07 @ 13:52:09</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42622264"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42621711">
          <h3>
            <a
              class="item"
              href="https://cispa.de/en/research/publications/84162-cascading-spy-sheets-exploiting-the-complexity-of-modern-css-for-email-and-browser-fingerprinting"
              >Cascading Spy Sheets: Exploiting the Complexity of Modern CSS for
              Fingerprinting</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-07 @ 12:29:59</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42621711"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42619898">
          <h3>
            <a
              class="item"
              href="https://www.sciencedirect.com/science/article/pii/S0047248424001337"
              >Stone selection by wild chimpanzees shares patterns with Oldowan
              hominins</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-07 @ 06:32:05</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42619898"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42617825">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/bird-drone"
              >Bird-inspired drone uses legs to walk and jump into the air</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-07 @ 00:31:02</span
              ><span class="points-container"
                >Points: <span class="points">166</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42617825"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42614722">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42614722"
              >Ask HN: Books about people who did hard things</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-06 @ 19:45:02</span
              ><span class="points-container"
                >Points: <span class="points">387</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42614722"
                  >Comments</a
                ><span class="descendants">: 329</span></span
              >
            </h4>
            <div class="text">
              <p>
                I’m reading The Big Rich about the oil boom in Texas and like
                it. I also liked Barbarians at the Gate about how private equity
                got created and how deals went down.
              </p>
              <p>
                Less interested in people and character studies. More interested
                in the mechanics of how things that we take for granted actually
                got built and what the world they were made in was like.
              </p>
            </div>
          </section>
        </section>
        <section id="42611077">
          <h3>
            <a
              class="item"
              href="http://geon.github.io/programming/2025/01/05/bubble-bobble-c64-wind"
              >Parsing the C64 Bubble Bobble Wind Currents</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-06 @ 14:57:50</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42611077"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
