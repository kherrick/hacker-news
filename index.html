<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40762840">
          <h3>
            <a
              class="item"
              href="https://www.strongtowns.org/journal/2024/6/21/how-costco-broke-into-a-surprising-new-market-modular-housing"
              >Costco Broke into a Surprising New Market: Modular Housing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 22:36:34</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40762840"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40762739">
          <h3>
            <a
              class="item"
              href="https://lupyuen.codeberg.page/articles/sg2000a.html"
              >Daily Automated Testing for Milk-V Duo S RISC-V SBC (IKEA
              Tretakt, Apache NuttX)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 22:21:45</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40762739"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40762433">
          <h3>
            <a
              class="item"
              href="https://gist.github.com/HyperCrowd/edc9b461ec23cf2454ea4d1e910fd1c6"
              >Show HN: Simple script to cripple personalized targeting from
              Facebook</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 21:38:18</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40762433"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40762177">
          <h3>
            <a class="item" href="https://www.workatastartup.com/jobs/51266"
              >Charge Robotics (YC S21) is hiring SWEs to build solar
              construction robots</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 21:01:00</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40761837">
          <h3>
            <a
              class="item"
              href="https://ember-climate.org/insights/in-brief/the-global-solar-revolution/"
              >Solar generates fifth of global electricity on summer solstice
              midday peak</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 20:18:23</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40761837"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40761713">
          <h3>
            <a
              class="item"
              href="https://www.energysingularity.cn/en/hh70-the-worlds-first-high-temperature-superconducting-tokamak-achieves-first-plasma/"
              >HH70, the first high-temperature superconducting Tokamak achieves
              first plasma</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 20:01:41</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40761713"
                  >Comments</a
                ><span class="descendants">: 120</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40760962">
          <h3>
            <a
              class="item"
              href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4865492"
              >An Anatomy of Algorithm Aversion</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 18:14:42</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40760962"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40760858">
          <h3>
            <a
              class="item"
              href="https://github.com/awslabs/aws-lambda-web-adapter"
              >AWS Lambda Web Adapter</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 18:01:45</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40760858"
                  >Comments</a
                ><span class="descendants">: 74</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40760687">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/2024/06/22/testing-amds-bergamo-zen-4c-spam/"
              >Testing AMD's Bergamo: Zen 4c</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 17:36:39</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40760687"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40760320">
          <h3>
            <a class="item" href="https://pigazing.dcford.org.uk/"
              >Pi Gazing is a project to build meteor cameras using Raspberry
              Pi</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 16:44:44</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40760320"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40759333">
          <h3>
            <a class="item" href="https://haithemturki.com/hybrid-nerf/"
              >HybridNeRF: Efficient Neural Rendering</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 14:21:21</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40759333"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40759277">
          <h3>
            <a
              class="item"
              href="https://vu.nl/en/news/2024/andrew-s-tanenbaum-receives-acm-software-system-award"
              >Andrew S. Tanenbaum Receives ACM Software System Award</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 14:12:02</span
              ><span class="points-container"
                >Points: <span class="points">223</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40759277"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40758767">
          <h3>
            <a
              class="item"
              href="https://anandsanwal.me/2018/06/19/dad-company-sale/"
              >After my dad died, I ran and sold his company (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 12:49:18</span
              ><span class="points-container"
                >Points: <span class="points">520</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40758767"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40758703">
          <h3>
            <a class="item" href="https://github.com/mattrighetti/envelope"
              >Show HN: Envelope – A modern environment variable cli tool</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 12:39:57</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40758703"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
            <div class="text">
              <p>
                I had this idea when I made a big mistake and broke some
                production stuff because I had a very messy .env file laying
                around in my project.
              </p>
              <p>
                I was implementing new features for one of my projects and in my
                .env file I had the test database url commented out and the
                production one was not. Long story short, I applied migrations
                to the production database instead of my local test one and
                broke a lot of production APIs :')
              </p>
              <p>
                I wanted a tool that could easily help me spot these issues
                before something bad happened, and so I built envelope for that
                reason.
              </p>
              <p>
                Instead of a \.env(\..+)? file, I now use this tool to add
                variables to different configurations: dev, prod etc. and I feed
                them to the program I am executing on a one liner.
              </p>
              <p></p>
              <pre><code>  $ envelope init
  $ envelope add dev db_url localhost:5432/postgres
  $ envelope add dev db_username username
  $ envelope add dev db_pwd pwd
  $ export $(envelope list dev)
  $ ./run.sh
</code></pre>
              This way I am explicitly exporting the dev environment without
              relying on the fact that everything is in order in my .env file
              (another approach would be to have a .env.dev file)
              <p>
                A very useful feature that I use quite a lot is the `check`
                command which is going to tell you which environment you have
                currently active
              </p>
              <p></p>
              <pre><code>  $ export $(envelope list dev)
  $ envelope check
  &gt; dev
</code></pre>
              I don't think this tool is going to be useful to anybody, but I
              wanted to share this with you in case there is someone that can
              make good use of it or find particular scenarios where this could
              be used instead of .env files, either way I had a lot of fun
              building it
            </div>
          </section>
        </section>
        <section id="40757951">
          <h3>
            <a class="item" href="https://v1.web-check.xyz/"
              >Show HN: I made tool that let's you see everything about any
              website</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 10:43:47</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40757951"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/lissy93/web-check"
                >https://github.com/lissy93/web-check</a
              >
              :)
              <p>
                Why I'm building this? There are a lot of tools out there for
                discovering meta and security data relating to a website, IP or
                server. But currently, there isn't anything that does
                everything, all in one place and without a paywall/ user sign
                up.
              </p>
              <p>
                It's still a WIP, and I'm working on a new version, with some
                more comprehensive checks, so any feedback would be much
                appreciated :)
              </p>
            </div>
          </section>
        </section>
        <section id="40757787">
          <h3>
            <a
              class="item"
              href="https://www.neilhenning.dev/posts/yourownconstantfolder/"
              >Own Constant Folder in C/C++</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 10:07:05</span
              ><span class="points-container"
                >Points: <span class="points">150</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40757787"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40757486">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40757486"
              >Ask HN: Advice for leading a software migration?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-22 @ 08:49:04</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40757486"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
            <div class="text">
              <p>
                I'm about to take lead of a decent sized software migration at
                work. (From V1 of some subsystem, to v2, both in house. We want
                to deprecated and eventually remove V1 totally) For 8 of our
                clients, totalling about 16 million customers.
              </p>
              <p>
                I don't have too many details to share, as I don't know what's
                relevant. But I'm asking if anyone has any advice or recommended
                reading regarding such?
              </p>
              <p>
                One book that is really inspiring me about it is "how big things
                get done" by Bent Flyvbjerg and Dan Gardner. In it, there's some
                key bits of advice such as
              </p>
              <p>* Think slow, ask fast, and mitigate long tailed risks.</p>
              <p>
                * Compartmentalize and stick to repeated processes. "Build with
                LEGOs"
              </p>
              <p>* Look around at other projects of similar nature.</p>
              <p>
                The last point is why I'm here, as I know some of you have been
                in the game for longer than I have, so feel free to share
                experiences that you might think is relevant, if you'd like.
              </p>
            </div>
          </section>
        </section>
        <section id="40754471">
          <h3>
            <a
              class="item"
              href="https://dfarq.homeip.net/the-biggest-crt-ever-made-sonys-pvm-4300/"
              >The biggest CRT ever made: Sony's PVM-4300</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-21 @ 22:22:07</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40754471"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40753468">
          <h3>
            <a
              class="item"
              href="https://snackstack.net/2024/05/25/uh-oh-a-story-of-spaghettios-and-forgotten-history/"
              >Uh-Oh: A story of SpaghettiOs and forgotten history</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-21 @ 20:28:31</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40753468"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40751496">
          <h3>
            <a
              class="item"
              href="https://www.historytoday.com/archive/great-debates/babylons-mystery-goddess"
              >Babylon's Mystery Goddess</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-21 @ 17:01:56</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40751496"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40749279">
          <h3>
            <a class="item" href="https://github.com/imdj/opml-editor"
              >Show HN: Online OPML editor to manage subscription lists</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-21 @ 13:13:39</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40749279"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
            <div class="text">
              <p>
                It's rather simple at the moment but the goal is to provide
                shortcuts for common desired tasks to make the experience of
                editing OPML much smoother and streamlined.
              </p>
              <p>
                The editor is a static website that runs locally in your
                browser, it doesn't require an account, nor do any tracking.
              </p>
              <p>
                Let me know your feedback or if you've any pain points around
                OPML
              </p>
              <p>
                GitHub repo:
                <a href="https://github.com/imdj/opml-editor"
                  >https://github.com/imdj/opml-editor</a
                >
              </p>
              <p>
                Website:
                <a href="https://opml.imadij.com/">https://opml.imadij.com/</a>
              </p>
              <p>
                [1] -
                <a href="https://en.wikipedia.org/wiki/OPML"
                  >https://en.wikipedia.org/wiki/OPML</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="40744910">
          <h3>
            <a
              class="item"
              href="https://github.com/alt-romes/reference-counting"
              >Reference Counting with Linear Types</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-21 @ 00:19:23</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40744910"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40742821">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/2024/06/24/the-era-of-the-line-cook"
              >The Era of the Line Cook</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-20 @ 20:11:41</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40742821"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40742628">
          <h3>
            <a class="item" href="https://rednafi.com/misc/on_rebasing/"
              >I kind of like rebasing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-20 @ 19:55:17</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40742628"
                  >Comments</a
                ><span class="descendants">: 152</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40741723">
          <h3>
            <a class="item" href="https://cognate-lang.github.io/learn.html"
              >Cognate: Readable and concise concatenative programming</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-20 @ 18:33:22</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40741723"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40738534">
          <h3>
            <a
              class="item"
              href="https://keymaterial.net/2024/06/15/reconstructing-public-keys-from-signatures/"
              >Reconstructing Public Keys from Signatures</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-20 @ 13:25:52</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40738534"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40737511">
          <h3>
            <a
              class="item"
              href="https://prescheme.org/posts/announcing-the-pre-scheme-restoration.html"
              >The Pre-Scheme Restoration</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-20 @ 11:40:54</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40737511"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40736174">
          <h3>
            <a
              class="item"
              href="https://jupiter-ace.co.uk/Forth_general_practical_computing8108.html"
              >As you learn Forth, it learns from you (1981)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-20 @ 08:05:13</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40736174"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40731667">
          <h3>
            <a
              class="item"
              href="https://www.theatlantic.com/past/docs/issues/56feb/5602bush.htm"
              >Can men live without war? (1956)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-19 @ 19:35:12</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40731667"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40709434">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-06-scientists-secrets-life-energy.html"
              >Scientists unlock secrets of how the third form of life makes
              energy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-17 @ 18:43:43</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40709434"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
