<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42512896">
          <h3>
            <a class="item" href="https://github.com/blackcandy-org/blackcandy"
              >Blackcandy: Self hosted music streaming server</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-26 @ 03:17:34</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42512896"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42512772">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/2024/12/25/us/bird-flu-washington-cats-cases/index.html"
              >Bird flu kills more than half the big cats at a Washington
              sanctuary</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-26 @ 02:39:18</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42512772"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42512713">
          <h3>
            <a class="item" href="https://github.com/siyuan-note/siyuan"
              >Siyuan: Privacy-first, self-hosted personal knowledge management
              software</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-26 @ 02:26:39</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42512713"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42512636">
          <h3>
            <a class="item" href="https://www.egui.rs/"
              >Egui â€“ An immediate mode GUI written in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-26 @ 02:06:10</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42512636"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42512371">
          <h3>
            <a
              class="item"
              href="https://aphyr.com/posts/378-seconds-since-the-epoch"
              >Seconds Since the Epoch</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-26 @ 00:59:27</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42512371"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42512050">
          <h3>
            <a
              class="item"
              href="https://radiosocial.de/@hennichodernich/113714518196988714"
              >Installing OpenWRT on an Unsupported Router</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 23:52:01</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42512050"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42511978">
          <h3>
            <a
              class="item"
              href="https://joinreboot.org/p/from-papyrus-to-preprints"
              >From Papyrus to Preprints</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 23:37:14</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42511978"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42511976">
          <h3>
            <a
              class="item"
              href="http://marginalrevolution.com/marginalrevolution/2013/12/are-seasonal-business-cycles-inefficient.html"
              >Is Christmas Efficient? (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 23:36:45</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42511976"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42511663">
          <h3>
            <a class="item" href="https://yc-map.vercel.app/"
              >Show HN: Map of YC Startups</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 22:37:31</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42511663"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
            <div class="text">
              <p>Today I had a bit of fun with Claude.</p>
              <p>
                Started by scraping YC's startups list, then ran them through
                OpenAI's embedding service, then UMAP'd the embedding to reduce
                the dimension to just two coordinates and then just forced
                Claude to write React that would compile to visualize that.
              </p>
              <p>I had fun and I think it's interesting, so take a look!</p>
              <p>
                Also note that you won't be able to zoom on mobile (found about
                this Plotly limitation way too late). If there's interest I can
                fix this issue by changing plotting libs tomorrow :)
              </p>
              <p>Merry christmas</p>
            </div>
          </section>
        </section>
        <section id="42511318">
          <h3>
            <a
              class="item"
              href="https://igorstechnoclub.com/server-sent-events-sse-are-underrated/"
              >Server-Sent Events (SSE) Are Underrated</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 21:35:55</span
              ><span class="points-container"
                >Points: <span class="points">187</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42511318"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42510776">
          <h3>
            <a
              class="item"
              href="https://www.os2museum.com/wp/i-thought-i-found-a-bug/"
              >I Thought I Found a Bug</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 19:55:07</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42510776"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42510696">
          <h3>
            <a class="item" href="https://bernsteinbear.com/blog/cps/"
              >Into CPS, Never to Return</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 19:43:10</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42510696"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42509953">
          <h3>
            <a class="item" href="https://github.com/drk1wi/portspoof"
              >Portspoof: Emulate a valid service on all 65535 TCP ports</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 17:44:04</span
              ><span class="points-container"
                >Points: <span class="points">218</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42509953"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42508642">
          <h3>
            <a class="item" href="https://fstar-lang.org/"
              >F*: A proof oriented general purpose programming language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 13:16:40</span
              ><span class="points-container"
                >Points: <span class="points">181</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42508642"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42507312">
          <h3>
            <a
              class="item"
              href="https://www.ruby-lang.org/en/news/2024/12/25/ruby-3-4-0-released/"
              >Ruby 3.4.0</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 06:40:07</span
              ><span class="points-container"
                >Points: <span class="points">347</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42507312"
                  >Comments</a
                ><span class="descendants">: 198</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42507185">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=IQqtsm-bBRU"
              >This open problem taught me what topology is [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 06:08:45</span
              ><span class="points-container"
                >Points: <span class="points">388</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42507185"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42507116">
          <h3>
            <a class="item" href="https://papermatch.mitanshu.tech/"
              >Show HN: I made a website to semantically search ArXiv papers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 05:44:12</span
              ><span class="points-container"
                >Points: <span class="points">246</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42507116"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
            <div class="text">
              <p>
                I used MixedBread's [^1] embedding model to generate vectors
                from the abstracts. I store and search similar vectors using
                Milvus [^2] and finally use Gradio [^3] to serve the frontend. I
                update the vector database weekly by pulling the metadata
                dataset from Kaggle [^4].
              </p>
              <p>
                To speed up the search process on my free oracle instance, I
                binarise the embeddings and use Hamming distance as a metric.
              </p>
              <p>I would love your feedback on the site :) Happy Holidays!</p>
              <p>
                [1]:
                <a
                  href="https://www.mixedbread.ai/docs/embeddings/mxbai-embed-large-v1"
                  >https://www.mixedbread.ai/docs/embeddings/mxbai-embed-large-...</a
                >
                [2]: <a href="https://milvus.io/">https://milvus.io/</a> [3]:
                <a href="https://www.gradio.app/">https://www.gradio.app/</a>
                [4]:
                <a
                  href="https://www.kaggle.com/datasets/Cornell-University/arxiv"
                  >https://www.kaggle.com/datasets/Cornell-University/arxiv</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="42506569">
          <h3>
            <a class="item" href="https://www.fixbrowser.org/"
              >Show HN: FixBrowser â€“ a lightweight web browser created from
              scratch</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 03:08:13</span
              ><span class="points-container"
                >Points: <span class="points">241</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42506569"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
            <div class="text">
              <p>
                At some point I've realized that much of the complexity and
                resource requirements of web browsers comes from JavaScript.
                This is because every part needs to be dynamic and optimized for
                speed.
              </p>
              <p>
                So a few years ago I've started to work on a web browser that
                intentionally doesn't implement JavaScript, instead it contains
                an updated set of scripts that fix and improve various websites.
              </p>
              <p>
                I've been using this approach using a proxy server for a few
                years as my primary way of web browsing with good results. It
                uses a whitelist approach where no resources are loaded from
                different domains by default (the fix scripts can override it to
                load images from CDNs, etc.). This avoids any trackers by
                default.
              </p>
              <p>You can find more details on the homepage of the project:</p>
              <p>
                <a href="https://www.fixbrowser.org/"
                  >https://www.fixbrowser.org/</a
                >
              </p>
              <p>
                I'm currently running a fundraiser to get it really going. All
                the foundation blocks are there it just needs some more work.
                Any support is welcome.
              </p>
            </div>
          </section>
        </section>
        <section id="42505454">
          <h3>
            <a class="item" href="https://github.com/Jaennaet/pISSStream"
              >macOS menu bar app that shows how full the ISS urine tank is in
              real time</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-24 @ 22:38:40</span
              ><span class="points-container"
                >Points: <span class="points">1024</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42505454"
                  >Comments</a
                ><span class="descendants">: 226</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42502658">
          <h3>
            <a
              class="item"
              href="https://danielmangum.com/posts/vpr-nordic-risc-v-processor/"
              >VPR: Nordic's First RISC-V Processor</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-24 @ 15:50:28</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42502658"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42499336">
          <h3>
            <a
              class="item"
              href="https://www.cnx-software.com/2024/12/24/sipeed-nanokvm-pcie-is-an-inexpensive-kvm-over-ip-solution-with-optional-wifi-6-and-poe-support/"
              >Sipeed NanoKVM-PCIe</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-24 @ 02:48:56</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42499336"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42497341">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=J1GIF6VNipE"
              >Converting shopping malls into apartments [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 20:29:44</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42497341"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42494512">
          <h3>
            <a
              class="item"
              href="https://www.dbos.dev/blog/ezrgb-dbos-light-shows"
              >The software you need for holiday overdecoration</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 14:17:51</span
              ><span class="points-container"
                >Points: <span class="points">159</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42494512"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42494466">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/global-development/2024/dec/20/ugandan-runner-deo-kato-cape-town-london-hope-racism-europe-africa"
              >Ugandan runner due to arrive in London after 516 days, 7,700
              miles on the road</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 14:08:04</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42494466"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42494256">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/world/2024/dec/23/swedish-cabin-frontline-possible-hybrid-war-undersea-cables-sabotage"
              >The Swedish cabin on the frontline of a possible hybrid war</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 13:31:22</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42494256"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42493962">
          <h3>
            <a
              class="item"
              href="https://developer.mozilla.org/en-US/blog/curriculum-learn-web-development/"
              >A new learning experience on MDN</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 12:36:03</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42493962"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42493832">
          <h3>
            <a class="item" href="https://supersnowflakemaker.com"
              >Show HN: Super Snowflake Maker</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-23 @ 12:09:28</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42493832"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
            <div class="text">
              <p>
                Draw on the pie with freeform or polygon tools, change the
                number of sections, click on the large snowflake to see fold,
                and.... download!
              </p>
              <p>Enjoy + Happy Holidays!</p>
              <p>
                (tech: threejs/r3f, react, ts, useSpring, tailwind, canvas, svg,
                offscreen canvas, paperjs)
              </p>
            </div>
          </section>
        </section>
        <section id="42489645">
          <h3>
            <a class="item" href="https://minds.md/zakirullin/cognitive"
              >Cognitive load is what matters</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-22 @ 22:18:12</span
              ><span class="points-container"
                >Points: <span class="points">861</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42489645"
                  >Comments</a
                ><span class="descendants">: 326</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42485505">
          <h3>
            <a
              class="item"
              href="https://jesipow.com/blog/postgres-reads-cause-writes/"
              >Reads Causing Writes in Postgres</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-22 @ 10:24:07</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42485505"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42484095">
          <h3>
            <a class="item" href="https://blog.smidt.dev/posts/0004/"
              >Bit Vectors and my first steps into assembly</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-22 @ 03:00:32</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42484095"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
