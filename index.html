<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36596610">
          <h3>
            <a class="item" href="https://haddadi.github.io/UKOSBOpenletter.pdf"
              >Open Letter from Security Researchers in Relation to the Online
              Safety Bill [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-05 @ 07:05:46</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36596610"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36596588">
          <h3>
            <a
              class="item"
              href="https://practical.engineering/blog/2023/6/16/w47wdfg7h5uojks1c85boeyjhl9ot4"
              >Was Starshipâ€™s Stage Zero a Bad Pad?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-05 @ 07:03:46</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36596588"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36596547">
          <h3>
            <a
              class="item"
              href="https://bitmovin.com/careers/technical-support-engineer-tier-1-chennai-6829109002/"
              >Bitmovin (YC S15) Is Hiring a Technical Support Engineer in
              India</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-05 @ 07:00:00</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36596324">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36596324"
              >Ask HN: Why is there no major push towards Android for Servers
              and Desktops?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-05 @ 06:40:09</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36596324"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
            <div class="text">
              <p>
                Meanwhile, over on Android, we are running dozens of apps of
                varying quality, all updating all the time, and phones have very
                high reliability anyway.
              </p>
              <p>
                On Android you don't need all kinds of containerization nonsense
                with 100MB packages for even the tiniest things.
              </p>
              <p>
                Nor do you get a nightmare of broken dependencies. The OS gives
                you one consistent API level, and it's consistent on any device.
              </p>
              <p>
                Permissions and security are pretty much solved, or as close
                solved as they can possibly get right now, you can't stop people
                from giving location access to everything and still claim people
                own their devices.
              </p>
              <p>
                On servers, we have a nightmare tangle of Microservices and
                crap.
              </p>
              <p>
                On Android, we have a really nice design pattern where the OS
                pretty much provides everything, and stuff you might want to
                swap out can be done with a service provider app of some type.
              </p>
              <p>
                It's not hard to imagine extending that model to cover things
                like databases. Why should we have a 50 step process to install
                every app, when the app can just say "Hey, I need to make a
                database, I can use postgres or SQLite, put my stuff in whatever
                provider is configured, and don't ask for a password, I already
                have the permission."?
              </p>
              <p>
                It's just... so much more sane and structured. There's already
                lots of Linux userland on Android projects, no real blocking
                issue there in being able to migrate legacy stuff.
              </p>
              <p>
                There's performance issues with complexity, except.... not
                really. Apps use things far slower than Dart and Kotlin and
                Android API calls all the time. And Android is efficient enough
                to run on a phone at just a few watts, while still rendering
                modern websites, so it seems like they're doing something right.
              </p>
              <p>
                What gives? Why are we not managing our web apps by uploading a
                single APK file and a settings.ini with the permissions we want
                to give it? Why is the Steam Deck Linux based while Android
                hardly has any decent games?
              </p>
            </div>
          </section>
        </section>
        <section id="36596095">
          <h3>
            <a class="item" href="http://worrydream.com/July2023/"
              >Bret Victor update</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-05 @ 06:07:36</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36596095"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36595711">
          <h3>
            <a
              class="item"
              href="https://aviation.stackexchange.com/questions/99788/is-the-aircraft-in-this-image-real"
              >Is the aircraft in this image real?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-05 @ 05:06:55</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36595711"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36595512">
          <h3>
            <a class="item" href="https://github.com/ronami/meta-typing"
              >Functions and algorithms implemented purely with TypeScript's
              type system</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-05 @ 04:29:27</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36595512"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36594916">
          <h3>
            <a
              class="item"
              href="https://the-dam.org/docs/explanations/suc.html"
              >Simple Unix Chat</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-05 @ 02:34:16</span
              ><span class="points-container"
                >Points: <span class="points">215</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36594916"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36594695">
          <h3>
            <a
              class="item"
              href="https://arrow.apache.org/blog/2023/06/26/our-journey-at-f5-with-apache-arrow-part-2/"
              >Our Journey with Apache Arrow (Part 2): Adaptive Schemas and
              Sorting</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-05 @ 01:53:46</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36594695"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36593206">
          <h3>
            <a
              class="item"
              href="https://www.prb.org/articles/how-many-people-have-ever-lived-on-earth/"
              >How many people have ever lived on Earth?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-04 @ 22:16:09</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36593206"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36592930">
          <h3>
            <a class="item" href="https://usebottles.com/"
              >Bottles â€“ Easily run Windows software on Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-04 @ 21:47:58</span
              ><span class="points-container"
                >Points: <span class="points">245</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36592930"
                  >Comments</a
                ><span class="descendants">: 135</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36592343">
          <h3>
            <a class="item" href="https://linuxcontainers.org/lxd/"
              >LXD is now under Canonical</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-04 @ 20:48:38</span
              ><span class="points-container"
                >Points: <span class="points">175</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36592343"
                  >Comments</a
                ><span class="descendants">: 129</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36591850">
          <h3>
            <a
              class="item"
              href="https://www.biscuitsec.org/docs/guides/revocation/"
              >Token revocation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-04 @ 20:02:19</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36591850"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36591767">
          <h3>
            <a class="item" href="https://varun.ca/ray-march-sdf/"
              >Show HN: Iridescent crystal with raymarching and signed distance
              fields</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-04 @ 19:52:41</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36591767"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36591313">
          <h3>
            <a
              class="item"
              href="https://elixir-lang.org/blog/2023/06/22/type-system-updates-research-dev/"
              >Type system updates: moving from research into development</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-04 @ 19:11:43</span
              ><span class="points-container"
                >Points: <span class="points">220</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36591313"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36591079">
          <h3>
            <a
              class="item"
              href="https://thunderseethe.dev/posts/type-inference/"
              >Designing a Language Without a Parser</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-04 @ 18:52:24</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36591079"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36590834">
          <h3>
            <a class="item" href="https://github.com/FerretDB/FerretDB"
              >Show HN: MongoDB Protocol for SQLite</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-04 @ 18:35:11</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36590834"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36590806">
          <h3>
            <a
              class="item"
              href="https://admiralcloudberg.medium.com/dark-waters-of-self-delusion-the-crash-of-transair-flight-810-a4eeb033bc00"
              >Dark Waters of Self-Delusion: The crash of Transair flight 810</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-04 @ 18:32:34</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36590806"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36588240">
          <h3>
            <a class="item" href="https://github.com/openzfs/zfs/pull/13392"
              >ZFS 2.2.0 (RC): Block Cloning merged</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-04 @ 15:46:56</span
              ><span class="points-container"
                >Points: <span class="points">248</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36588240"
                  >Comments</a
                ><span class="descendants">: 130</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36586632">
          <h3>
            <a
              class="item"
              href="https://www.amusingplanet.com/2013/07/sao-paulo-city-with-no-outdoor.html"
              >Sao Paulo: A city with no outdoor advertisements (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-04 @ 13:50:02</span
              ><span class="points-container"
                >Points: <span class="points">611</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36586632"
                  >Comments</a
                ><span class="descendants">: 353</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36586248">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/ai-programming"
              >Tips for programmers to stay ahead of generative AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-04 @ 13:17:16</span
              ><span class="points-container"
                >Points: <span class="points">241</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36586248"
                  >Comments</a
                ><span class="descendants">: 236</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36584692">
          <h3>
            <a
              class="item"
              href="https://cseweb.ucsd.edu/~voelker/cse221/papers/qnx-paper92.pdf"
              >An Architectural Overview of QNX (1992) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-04 @ 10:26:55</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36584692"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36580713">
          <h3>
            <a
              class="item"
              href="https://internethistory.org/wp-content/uploads/2020/01/OSA_Boom.Bubble.Bust_Fiber.Optic_.Mania_.pdf"
              >Boom, Bubble, Bust: The Fiber Optic Mania [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-04 @ 00:41:43</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36580713"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36580128">
          <h3>
            <a
              class="item"
              href="https://www.wsj.com/articles/for-carlos-santana-a-passion-for-rock-began-as-a-walk-in-the-park-ef1a49cd"
              >For Carlos Santana, a Passion for Rock Began as a Walk in the
              Park</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-03 @ 23:25:40</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36580128"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36579995">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=KDRnEm-B3AI"
              >Making infrared cooling paint from grocery store items [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-03 @ 23:10:32</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36579995"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36575081">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36575081"
              >Ask HN: Could you share your personal blog here?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-03 @ 16:16:33</span
              ><span class="points-container"
                >Points: <span class="points">768</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36575081"
                  >Comments</a
                ><span class="descendants">: 1191</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36572740">
          <h3>
            <a
              class="item"
              href="https://behavioralvalueinvestor.substack.com/p/what-do-the-best-investors-do-that"
              >What Do the Best Investors Do That the Rest Donâ€™t?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-03 @ 13:40:57</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36572740"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36572734">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-06-analysis-tooth-minerals-megalodon-shark.html"
              >New analysis of tooth minerals confirms megalodon shark was
              warm-blooded</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-03 @ 13:40:15</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36572734"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36570321">
          <h3>
            <a class="item" href="http://cliffle.com/blog/async-inversion/"
              >How to think about `async`/`await` in Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-03 @ 08:36:05</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36570321"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36569156">
          <h3>
            <a
              class="item"
              href="https://www.ics.uci.edu/~sabdujyo/papers/sigcomm21-cme.pdf"
              >Solar Superstorms: Planning for an Internet Apocalypse (2021)
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-03 @ 05:10:47</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36569156"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
