<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36403609">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36403609"
              >Tell HN: Hulu does not allow subscription cancellation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 13:24:28</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36403609"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
            <div class="text">
              <p>
                1. Try to cancel your hulu subscription on account and billing
                2. You'll be presented with an option to "pause" subscription 3.
                If you ignore that, you'll be presented with new "offer" 4. Now
                finally if you ALSO ignore that, you'll get a CORS error trying
                to actually cancel
              </p>
              <p>
                account/cancel:1 Access to fetch at
                'https://www.hulu.com/api/v1/subscription/cancel' from origin
                'https://secure.hulu.com' has been blocked by CORS policy:
                Response to preflight request doesn't pass access control check:
                No 'Access-Control-Allow-Origin' header is present on the
                requested resource. If an opaque response serves your needs, set
                the request's mode to 'no-cors' to fetch the resource with CORS
                disabled. _app-bf55b49463c4f36f.js:1 POST
                https://www.hulu.com/api/v1/subscription/cancel net::ERR_FAILED
              </p>
              <p>There's zero UI feedback about the cancellation status.</p>
              <p>Fuck hulu.</p>
              <p>Also good luck trying to get support for this.</p>
            </div>
          </section>
        </section>
        <section id="36403608">
          <h3>
            <a
              class="item"
              href="https://www.businesswire.com/news/home/20230620267452/en/Rivian-Accelerates-Electrification-through-Adoption-of-North-American-Charging-Standard-and-Access-to-Tesla%E2%80%99s-Supercharger-Network-for-Rivian-Drivers"
              >Rivian Adopts NACS and Access to Tesla’s Supercharger Network for
              Rivian Drivers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 13:24:27</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36403608"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36403607">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36403607"
              >Tell HN: Stripe killed my music locker service, so I'm open
              sourcing it</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 13:24:24</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36403607"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
            <div class="text">
              <p>
                I run a small website at inter.tube. It lets you upload your
                music collection and stores it in Backblaze B2. It provides a
                simple web interface to listen to your collection, and support
                for the Subsonic API (allowing native apps to use it).
                Fundamentally it is not very different from something like
                Dropbox or Backblaze: it is a "dumb" backup that simply stores
                what you give it. It doesn't perform "matching" against other
                files, it doesn't allow you to access music you didn't
                explicitly upload, and it doesn't even deduplicate files between
                different users. It doesn't allow "sharing" of music either,
                download links are tied to a short access token for a specific
                user's login session. The only difference between other backup
                services is that we use the metadata tags in your uploads to
                organize things better. According to Capitol Records, Inc. v.
                MP3Tunes, LLC, this is absolutely OK in the eyes of the law
                (thank you to a fellow HN user for telling me about this court
                case). Note that we don't even perform deduplication, which was
                the main controversy in that case.
              </p>
              <p>
                I have been using Stripe happily for a couple years now, but
                suddenly (less than 10 minutes after a subscription payment went
                through), Stripe decided that I violated their Restricted
                Business policy, in particular "Products and services that
                infringe intellectual property rights: Sales or distribution of
                music, movies, software, or any other licensed materials without
                appropriate authorization". I thought this was a
                misunderstanding so I clarified that we don't sell music, just
                storage space (see paragraph above), but they denied my appeal
                with a short template response.
              </p>
              <p>
                This saddens me because my reasons for starting the site are the
                exact opposite of piracy! I was sick of artists getting paid
                virtually nothing for streaming service plays, so I decided to
                buy full albums directly from the artist as much as I could.
                inter.tube just allows you to keep your collection safe and
                easily accessible.
              </p>
              <p>
                I'm posting this mostly to warn other Stripe users that
                essentially any backup service could "violate" these terms, so
                be careful about the marketing blurbs on your website. Probably
                any mention of "music" whatsoever is enough to get your account
                nuked. I really liked Stripe, always recommended it because of
                its nice API, but I won't be doing that anymore.
              </p>
              <p>
                inter.tube will likely die. I'm going to refund my few paying
                users and disable account registration later, I guess.
              </p>
              <p>
                As a bonus, I've open-sourced inter.tube. However, it is
                difficult to run because it relies on a bunch of random cloud
                services (Backblaze B2 + Cloudflare Workers + Lambda) and
                there's some hard-coded stuff in there, so it's probably not
                very useful beyond curiosity. If anyone would like to help me
                with the open sourcing, let me know, and I'll get back to you
                whenever I have time. Of course, feel free to fork it as well. I
                am also on GitHub sponsors if anyone would like to sponsor me to
                help make it easier to self-host (or at least self-deploy).
              </p>
              <p>Source code: https://github.com/guregu/intertube</p>
            </div>
          </section>
        </section>
        <section id="36403572">
          <h3>
            <a
              class="item"
              href="https://www.asus.com/displays-desktops/mini-pcs/chrome-os-devices/asus-chromebox-5/"
              >ASUS Chromebox 5</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 13:21:47</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36403572"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36403494">
          <h3>
            <a
              class="item"
              href="https://ev-edition.com/2023/06/rivian-joins-forces-with-tesla-embracing-their-charging-standard-for-electric-vehicles/"
              >Rivian Joins Forces with Tesla, Embracing Their Charging Standard
              for EVs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 13:16:17</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36403494"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36403430">
          <h3>
            <a class="item" href="https://the-federation.info/platform/73"
              >Lemmy stats (users, posts, nodes, comments)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 13:09:06</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36403430"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36403355">
          <h3>
            <a
              class="item"
              href="https://gist.github.com/nat-418/bdccb2428cde750c9f42bf9bbc1a50d3"
              >Why Tcl?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 13:01:31</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36403355"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36403280">
          <h3>
            <a class="item" href="https://pubmed.ncbi.nlm.nih.gov/37293324/"
              >Loneliness is stronger when not alone</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 12:53:15</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36403280"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36403087">
          <h3>
            <a
              class="item"
              href="https://making.close.com/posts/native-enums-or-check-constraints-in-postgresql"
              >Representing Enums in PostgreSQL</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 12:31:44</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36403087"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36403014">
          <h3>
            <a class="item" href="https://www.inngest.com"
              >Show HN: Inngest – Developer platform for background jobs and
              workflows</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 12:24:08</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36403014"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.inngest.com/">https://www.inngest.com/</a>).
              Inngest is a developer platform and toolchain for developing,
              testing and running background jobs, and workflows. Inngest
              invokes your jobs via HTTP, wherever you want to deploy your code.
              <p>
                Shipping reliable background jobs and workflows is a time suck
                for any software team. They’re painful to develop locally and
                getting into production is a tedious experience of configuring
                infra. When you want to add scheduling, orchestrate multi-step
                workflows or handle concurrency or idempotency, you spend even
                more time building bespoke systems - not your actual product.
              </p>
              <p>
                Software engineers spend a ton of duplicated effort building and
                rebuilding this at every company. It shouldn’t be this way.
              </p>
              <p>
                We’ve taken our experience building and scaling reliable, secure
                queueing systems across Healthcare, B2B SaaS, and developer
                infra companies. With Inngest, we sought out to create a single
                platform and set of developer tools to unburden the developer.
              </p>
              <p>
                - You write functions alongside your API, in your existing
                codebase with our simple SDK. We invoke your functions via
                HTTPS, so there are no additional worker services to setup.
              </p>
              <p>
                - End-to-end local development, with one command. Our dev server
                runs Inngest on any machine with a web interface to visualize,
                debug, and test your functions with zero additional
                dependencies.
              </p>
              <p>
                - Our serverless queue calls you, so you can run your code
                anywhere - serverless, servers or edge.
              </p>
              <p>
                - Inngest manages state across functions and long-running
                workflows for you. We handle retries, concurrency, idempotency,
                and coordinating parallel and sequential workloads
                out-of-the-box.
              </p>
              <p>We’ve helped users like:</p>
              <p>
                - Snaplet.dev uses Inngest to handle the lifecycle of managing
                preview databases for their developer platform.
              </p>
              <p>
                - Ocoya.com re-build their e-commerce and social media
                scheduling workflows in days while dramatically simplifying
                their infra to run solely with Inngest + serverless functions.
              </p>
              <p>
                - Secta.ai uses Inngest to run all of their AI image generation
                models on GPU-optimized instances.
              </p>
              <p>
                Today, we have a TypeScript SDK and we will expand to other
                languages soon (Go is next). We’re building in the open on
                Github and we offer usage-based plans with a generous free tier.
              </p>
              <p>
                We’re excited to share this with HN and we’re eager for your
                feedback! What are your experiences building systems for
                background jobs and workflows?
              </p>
            </div>
          </section>
        </section>
        <section id="36402968">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/travel/article/rome-open-square-julius-caesar-scli-intl/index.html"
              >Square where Julius Caesar was killed opens to the public in
              Rome</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 12:18:27</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36402968"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36402565">
          <h3>
            <a class="item" href="https://www.xemacs.org/Releases/21.5.35.html"
              >XEmacs 21.5.35 “kohlrabi” is released</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 11:34:37</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36402565"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36402390">
          <h3>
            <a
              class="item"
              href="https://adam-mcdaniel-blog.github.io/compilers-for-the-future/"
              >Compilers for the Future</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 11:15:21</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36402390"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36402162">
          <h3>
            <a
              class="item"
              href="https://mullvad.net/en/blog/2023/6/20/introducing-mullvad-leta-a-search-engine-used-in-the-mullvad-browser/"
              >Mullvad Leta: A search engine used in the Mullvad Browser</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 10:48:39</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36402162"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36401999">
          <h3>
            <a class="item" href="https://sub.rehab/"
              >Sub.Rehab – See where Reddit communities have relocated</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 10:26:37</span
              ><span class="points-container"
                >Points: <span class="points">285</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36401999"
                  >Comments</a
                ><span class="descendants">: 136</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36401928">
          <h3>
            <a class="item" href="https://lissomware.github.io/css/"
              >Show HN: Lissom.CSS - A classless, minimalist, and themeable CSS
              library</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 10:16:14</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36401928"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
            <div class="text">
              This is a personal take on making a classless semantic CSS
              library.
            </div>
          </section>
        </section>
        <section id="36401863">
          <h3>
            <a
              class="item"
              href="https://e360.yale.edu/features/on-site-distributed-premise-graywater-blackwater-recycling"
              >Cities turn to ‘extreme’ water recycling</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 10:05:54</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36401863"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36401854">
          <h3>
            <a class="item" href="https://darekkay.com/blog/rss-styling/"
              >Style your RSS feed</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 10:04:29</span
              ><span class="points-container"
                >Points: <span class="points">182</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36401854"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36401747">
          <h3>
            <a class="item" href="https://samwho.dev/hashing/">Hashing</a>
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 09:48:26</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36401747"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36401676">
          <h3>
            <a class="item" href="https://smoothshadows.com/"
              >I made a smooth shadows generator</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 09:38:31</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36401676"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36400744">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/slauth-io/jobs/5MlboDb-cto"
              >Slauth.io (YC S22) Is Hiring a CTO</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 07:21:00</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36400524">
          <h3>
            <a
              class="item"
              href="https://www.undeadly.org/cgi?action=article;sid=20230620064255"
              >OpenBSD: Shutdown/reboot now require membership of group
              _shutdown</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 06:43:32</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36400524"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36400283">
          <h3>
            <a class="item" href="https://www.cpushack.com/CPU/cpu.html"
              >Great Microprocessors of the Past and Present (2003)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 06:01:08</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36400283"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36398596">
          <h3>
            <a
              class="item"
              href="https://www.tomsguide.com/news/its-official-lcd-tvs-wont-see-any-further-development"
              >LCD TVs won’t see any further development</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 01:21:23</span
              ><span class="points-container"
                >Points: <span class="points">196</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36398596"
                  >Comments</a
                ><span class="descendants">: 386</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36398292">
          <h3>
            <a class="item" href="https://cryptopals.com/"
              >The Matasano crypto challenges (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 00:41:12</span
              ><span class="points-container"
                >Points: <span class="points">157</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36398292"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36398081">
          <h3>
            <a class="item" href="https://cloudappreciationsociety.org/"
              >Cloud Appreciation Society</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-20 @ 00:10:55</span
              ><span class="points-container"
                >Points: <span class="points">188</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36398081"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36391892">
          <h3>
            <a class="item" href="https://matt.sh/matt-curve"
              >The Matt Curve (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-19 @ 15:05:26</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36391892"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36387292">
          <h3>
            <a
              class="item"
              href="https://www.afar.com/magazine/a-love-letter-to-driving-alone"
              >A Love Letter to Driving Alone</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-19 @ 04:18:33</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36387292"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36385729">
          <h3>
            <a
              class="item"
              href="https://www.tweag.io/blog/2023-04-20-medical-computing-at-scale/"
              >Processing medical images at scale on the cloud</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-18 @ 23:51:57</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36385729"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36384674">
          <h3>
            <a
              class="item"
              href="https://incoherency.co.uk/blog/stories/jesboard.html"
              >I made a mechanical keyboard with 3D-printed switches (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-18 @ 21:26:28</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36384674"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
