<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39693356">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=f4Dly8I8lMY"
              >4B,000 Transistors, One Giant Chip (Cerebras WSE-3) [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-13 @ 16:13:36</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39693356"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39693169">
          <h3>
            <a
              class="item"
              href="https://www.jeffgeerling.com/blog/2024/important-consideration-about-pi-5-overclocking"
              >Pi 5 overclocking: Silicon Lottery</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-13 @ 16:02:46</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39693169"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39692801">
          <h3>
            <a class="item" href="https://github.com/flox/flox"
              >Show HN: Flox 1.0 – Open-source dev env as code with Nix</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-13 @ 15:44:29</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39692801"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
            <div class="text">
              <p>
                I'm Ron Efroni, CEO at Flox, and today we are releasing version
                1.0 of our open source CLI, helping folks manage development
                environments everywhere.My own experience with development
                environments began with air-gapped systems, having to actually
                burn software to a CD to iterate over a very slow and expensive
                development cycle, sometimes reaching the server rack and
                realizing I have the wrong disk.... Fast forward to today and
                there are countless alternatives available backed by incredible
                compute resources, yet we somehow still find ourselves paying
                the price of long development cycles. That's why I've been
                working for over a decade to simplify the development stack so
                we can spend more time on making 1's and 0's do magical things,
                and why my co-founder Michael and I started Flox to bring you
                the solution based on Nix. Today is just the first step on that
                journey. We hope you'll take a peek at our new release, and very
                much look forward to continuing the journey with you from here
                together!
              </p>
              <p>Introducing Flox 1.0</p>
              <p>
                Flox is a platform that lets developers and operators focus on
                building fast with reproducible environments that span the
                enterprise SDLC. Using a declarative framework based on Nix, a
                package management and configuration tool, Flox allows
                developers to create environments that contain everything they
                need to build software.
              </p>
              <p>Why Flox?</p>
              <p>
                Flox behaves a lot like your favorite and familiar package
                manager, but it allows you to create as many environments as you
                want on your machine. Each one can contain a different
                combination of packages.
              </p>
              <p>
                Environments are portable by default. If you install a package
                inside one that isn't cross-platform, it's easy to carve out
                exceptions. It's also easy to write hooks and populate your
                environment with variables - we designed it to be hackable.
              </p>
              <p>
                Flox environments run in user-space, like, where you are. When
                you type `ls` after activating a Flox environment you will see
                the same stuff because you're in the same place - even with all
                those new packages available. No mounting volumes, no proxying
                ports. No breaking into the toolset you just conjured.
              </p>
              <p>
                Getting Started: No sign-ups, just one install away. Dive into
                our GitHub repository (<a href="https://github.com/flox/flox"
                  >https://github.com/flox/flox</a
                >) and start exploring
              </p>
              <p>
                I’m around all day to answer questions, talk Nix, or just
                reminisce about simpler times ;).
              </p>
              <p>Lots of open source love, Ron</p>
            </div>
          </section>
        </section>
        <section id="39692387">
          <h3>
            <a
              class="item"
              href="https://twitter.com/GoogleDeepMind/status/1767918515585994818"
              >Google SIMA</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-13 @ 15:22:56</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39692387"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39692337">
          <h3>
            <a
              class="item"
              href="https://dudzik.co/digress-into-development/syntax-off/"
              >:syntax off (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-13 @ 15:19:19</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39692337"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39692221">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2024/03/13/house-passes-bill-that-could-lead-to-a-tiktok-ban-fight-shifts-to-the-senate.html"
              >House passes bill that could lead to a TikTok ban; fight shifts
              to the Senate</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-13 @ 15:12:26</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39692221"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39691886">
          <h3>
            <a
              class="item"
              href="https://twitter.com/figure_robot/status/1767913661253984474"
              >Figure 01 robot demos its OpenAI integration</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-13 @ 14:50:40</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39691886"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39691735">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/world-us-canada-68555051"
              >Paul Alexander, ‘the man in the iron lung’, has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-13 @ 14:38:11</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39691735"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39691119">
          <h3>
            <a
              class="item"
              href="https://www.construction-physics.com/p/mass-timber-is-great-but-it-will"
              >Mass Timber Is Great, but It Will Not Solve the Housing
              Shortage</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-13 @ 13:41:59</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39691119"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39691108">
          <h3>
            <a
              class="item"
              href="https://voidcomputing.hu/blog/worse-better-prettier/"
              >More AR Glasses USB Protocols: The Worse, the Better and the
              Prettier</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-13 @ 13:40:17</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39691108"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39690967">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2024-03-12/physical-intelligence-is-building-ai-for-robots-backed-by-openai"
              >Physical Intelligence Is Building a Brain for Robots</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-13 @ 13:17:09</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39690967"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39690725">
          <h3>
            <a class="item" href="https://marker.pages.dev/"
              >Show HN: A user-friendly UI for viewing and editing Markdown
              files</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-13 @ 12:47:43</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39690725"
                  >Comments</a
                ><span class="descendants">: 88</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39689872">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-03-giant-sequoias-rapidly-feature-uk.html"
              >Giant sequoias are a rapidly growing feature of the UK
              landscape</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-13 @ 10:31:32</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39689872"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39689685">
          <h3>
            <a class="item" href="https://sheetsql.io/"
              >Show HN: Query Your Sheets with SheetSQL</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-13 @ 10:02:05</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39689685"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
            <div class="text">
              <p>
                I've developed a tool named SheetSQL that allows you to query,
                join, export, and schedule your queries to Google Sheets through
                a straightforward SQL interface in the browser.
              </p>
              <p>
                This tool is a simple, first iteration of the idea, so I'm eager
                to receive feedback on it. You can contact me at taras [at]
                sheetsql.io :D. I'd love to find out if it could be useful for
                folks out there!
              </p>
              <p>
                As someone working in fintech, I constantly deal with sheets and
                often find it challenging to perform seemingly simple tasks like
                JOINs natively. However, I'm familiar with SQL, which inspired
                the creation of SheetSQL. It's designed to assist those who use
                sheets daily and have some SQL knowledge, making operations
                across multiple sheets and worksheets as easy as if they were
                interacting with a Postgres database.
              </p>
              <p>
                For those interested in the technical details, the engine
                powering the queries in the background is DuckDB. Therefore, you
                can expect support for all syntax from the latest version of
                DuckDB :)
              </p>
              <p>Cheers,</p>
            </div>
          </section>
        </section>
        <section id="39688545">
          <h3>
            <a class="item" href="https://fly.io/blog/jit-wireguard-peers/"
              >JIT WireGuard</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-13 @ 06:13:09</span
              ><span class="points-container"
                >Points: <span class="points">340</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39688545"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39688443">
          <h3>
            <a class="item" href="https://cheswick.com/insults"
              >Insult Passphrase Generator</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-13 @ 05:47:36</span
              ><span class="points-container"
                >Points: <span class="points">154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39688443"
                  >Comments</a
                ><span class="descendants">: 108</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39687762">
          <h3>
            <a
              class="item"
              href="https://www.gutenberg.org/files/55084/55084-h/55084-h.htm"
              >Technical Manual TM 11-410: The Homing Pigeon (1945)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-13 @ 03:18:36</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39687762"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39687711">
          <h3>
            <a
              class="item"
              href="https://portraitart.app/photo-to-coloring-page"
              >Show HN: Creating custom coloring pages from photos. Great for
              parents/teachers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-13 @ 03:09:23</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39687711"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
            <div class="text">
              Making coloring pages out of your own personal photos is a fun and
              creative way to engage kids (and adults!) with art. Instead of
              generic coloring pages, you can turn special memories into custom
              works of art just waiting to be filled in with color.
            </div>
          </section>
        </section>
        <section id="39687132">
          <h3>
            <a class="item" href="https://github.com/Syllo/nvtop"
              >Nvtop: Linux Task Monitor for Nvidia, AMD and Intel GPUs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-13 @ 01:36:14</span
              ><span class="points-container"
                >Points: <span class="points">399</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39687132"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39684043">
          <h3>
            <a
              class="item"
              href="https://stachu.net/im-really-excited-about-darklang/"
              >I'm Excited about Darklang</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-12 @ 19:44:18</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39684043"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39684027">
          <h3>
            <a
              class="item"
              href="https://bsky.social/about/blog/03-12-2024-stackable-moderation"
              >Bluesky's stackable approach to moderation</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-12 @ 19:43:18</span
              ><span class="points-container"
                >Points: <span class="points">293</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39684027"
                  >Comments</a
                ><span class="descendants">: 151</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39682852">
          <h3>
            <a
              class="item"
              href="https://guix.gnu.org/en/blog/2024/identifying-software/"
              >Identifying Software</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-12 @ 18:12:33</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39682852"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39681919">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/infisical/jobs/MteMdIQ-full-stack-engineer"
              >Infisical (YC W23) is hiring to build an open-source secret
              management platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-12 @ 17:00:26</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39680997">
          <h3>
            <a
              class="item"
              href="https://engineering.fb.com/2024/03/12/data-center-engineering/building-metas-genai-infrastructure/"
              >Building Meta's GenAI infrastructure</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-12 @ 15:52:35</span
              ><span class="points-container"
                >Points: <span class="points">636</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39680997"
                  >Comments</a
                ><span class="descendants">: 291</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39677451">
          <h3>
            <a
              class="item"
              href="https://haacked.com/archive/2007/09/11/honeypot-captcha.aspx/"
              >Honeypot Captcha (2007)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-12 @ 08:55:45</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39677451"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39665900">
          <h3>
            <a
              class="item"
              href="https://deriveit.org/coding/cheat-sheets/big-o-insights-106?h=t"
              >Big O Insights</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-11 @ 08:39:40</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39665900"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39665828">
          <h3>
            <a
              class="item"
              href="https://pywebview.flowrl.com/blog/pywebview5.html"
              >Show HN: Pywebview 5</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-11 @ 08:22:18</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39665828"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
            <div class="text">
              I am happy to announce a new major version of pywebview
            </div>
          </section>
        </section>
        <section id="39665431">
          <h3>
            <a
              class="item"
              href="https://gregorygundersen.com/blog/2018/12/20/svd-proof/"
              >Proof of the Singular Value Decomposition</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-11 @ 06:42:45</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39665431"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39665214">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Spondylus"
              >Spondylus</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-11 @ 05:43:43</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39665214"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39665031">
          <h3>
            <a
              class="item"
              href="https://hypebeast.com/2024/3/the-eames-institute-of-infinite-curiosity-opens"
              >The Eames Institute of Infinite Curiosity Now Open to the
              Public</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-11 @ 04:56:36</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39665031"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
