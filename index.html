<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42940284">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2025/02/04/google-removes-pledge-to-not-use-ai-for-weapons-from-website/"
              >Google removes pledge to not use AI for weapons from website</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-04 @ 22:53:05</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42940284"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42940257">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/blog-post/what-s-happening-inside-nih"
              >What's Happening Inside the NIH and NSF</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-04 @ 22:51:36</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42940257"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42939940">
          <h3>
            <a class="item" href="https://deno.com/blog/deno-v-oracle2"
              >Oracle justified its JavaScript trademark with Node.js–now it
              wants that ignored</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-04 @ 22:29:48</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42939940"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42939562">
          <h3>
            <a class="item" href="https://challenge.dyalog.com/"
              >The APL Challenge</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-04 @ 22:02:35</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42939562"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42938802">
          <h3>
            <a
              class="item"
              href="https://www.voxnews.al/english/kosovabota/qeveria-po-e-planifikonte-prej-7-vitesh-kastoret-ndertojne-brenda-dy--i84652"
              >Government planned it 7 years, beavers built a dam in 2 days and
              saved $1M</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-04 @ 21:13:30</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42938802"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42938592">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/roame/jobs/V1aMBGc-lead-ai-full-stack-engineer"
              >Roame (YC S23) Is Hiring an AI Fullstack Lead</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-04 @ 21:00:06</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42938555">
          <h3>
            <a class="item" href="https://trailbase.io/reference/benchmarks/"
              >TrailBase: Sub-millisecond open-source application base with
              Rust, SQLite and V8</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-04 @ 20:58:06</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42938555"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42938409">
          <h3>
            <a class="item" href="https://www.seangoedecke.com/how-i-use-llms/"
              >How I use LLMs as a staff engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-04 @ 20:49:58</span
              ><span class="points-container"
                >Points: <span class="points">163</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42938409"
                  >Comments</a
                ><span class="descendants">: 125</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42938359">
          <h3>
            <a class="item" href="https://projects.ollybritton.com/mathscroll/"
              >MathScroll – Infinitely Scroll Mathematics</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-04 @ 20:46:39</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42938359"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42937701">
          <h3>
            <a
              class="item"
              href="https://github.com/huggingface/smolagents/tree/main/examples/open_deep_research"
              >Open Deep Research</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-04 @ 19:55:27</span
              ><span class="points-container"
                >Points: <span class="points">166</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42937701"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42936910">
          <h3>
            <a class="item" href="https://jax-ml.github.io/scaling-book/"
              >How to scale your model: A systems view of LLMs on TPUs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-04 @ 18:56:08</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42936910"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42936723">
          <h3>
            <a class="item" href="https://wikitok.vercel.app/">WikiTok</a>
          </h3>
          <section>
            <h4>
              <span>2025-02-04 @ 18:40:55</span
              ><span class="points-container"
                >Points: <span class="points">761</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42936723"
                  >Comments</a
                ><span class="descendants">: 136</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42936086">
          <h3>
            <a
              class="item"
              href="https://planetscale.com/blog/the-slotted-counter-pattern"
              >The Slotted Counter Pattern (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-04 @ 17:56:34</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42936086"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42935516">
          <h3>
            <a
              class="item"
              href="https://gist.github.com/rtfeldman/77fb430ee57b42f5f2ca973a3992532f"
              >Roc rewrites the compiler in Zig</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-04 @ 17:21:02</span
              ><span class="points-container"
                >Points: <span class="points">249</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42935516"
                  >Comments</a
                ><span class="descendants">: 131</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42935355">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42935355"
              >Launch HN: Pinch (YC W25) – Video conferencing with immersive
              translation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-04 @ 17:10:51</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42935355"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
            <div class="text">
              <a href="https://startpinch.com">https://startpinch.com</a>), a
              virtual conferencing platform with translation that mimics your
              voice and synchronizes your lips in real-time to make you sound
              and appear as a native speaker in over 15 languages.
              <p>
                Here's a demo:
                <a href="https://youtu.be/Cu7KlbZ3gjw"
                  >https://youtu.be/Cu7KlbZ3gjw</a
                >, but you can also try it for free on our website.
              </p>
              <p>
                Over the last three years, Keyu and I were working in a company
                where we had to lead engineering and research teams across the
                U.S., China, India, and Europe. We felt the language barrier
                actively limiting our team's potential in terms of collaboration
                + productivity. The existing tools we tried operated in
                low-bandwidth mediums (mostly text), which 1) means they are
                slower because they need to convert audio to text before
                translation, and 2) lose all information of <i>how</i> something
                was said.
              </p>
              <p>
                At that point we knew there had to be a better way to connect
                across different languages and cultures, so we started building
                Pinch. Shortly after, we found out how challenging translation
                truly was. Balancing latency/accuracy for chunk-based audio
                translation, capturing inflection and tonality per statement,
                handling culturally specific phrasing, and making a seamless
                meeting experience are all unsolved problems we're taking on.
              </p>
              <p>
                So far, we've seen some really interesting use-cases (many we
                hadn't considered!), from personal connections like a first
                conversation with foreign in-laws, to more business-oriented
                usage in sales and meeting foreign clients.
              </p>
              <p>
                After a long experience building conversation AI video/audio,
                we're incredibly excited to see what these same technologies can
                unlock for human&lt;&gt;human communication.
              </p>
              <p>
                You can try a demo or create a meeting for free:
                <a href="https://startpinch.com">https://startpinch.com</a>
              </p>
              <p>
                All feedback is appreciated, and we'd love to know how we're
                doing on the overall meeting UX and translation accuracy for
                your language. Thanks all!
              </p>
            </div>
          </section>
        </section>
        <section id="42935218">
          <h3>
            <a class="item" href="https://haystackeditor.com/code-reviewer"
              >Show HN: Haystack Code Reviewer – Perform code reviews on a
              canvas</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-04 @ 17:02:20</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42935218"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
            <div class="text">
              <p>
                We’re building Haystack Code Reviewer, a tool that lays out code
                diffs for a GitHub pull request on an interactive canvas.
                Instead of scrolling through diffs line-by-line, you can view
                all changes in a more connected, visual format – similar to
                viewing a call graph. We hope this will make it easier and less
                cognitively taxing to understand how different changes across
                files work together.
              </p>
              <p>
                For a quick overview, check out our short demo video:
                <a href="https://www.youtube.com/watch?v=QeOz70x0WPE"
                  >https://www.youtube.com/watch?v=QeOz70x0WPE</a
                >. If you would like to give it a spin, head over to
                <a href="https://haystackeditor.dev"
                  >https://haystackeditor.dev</a
                >, click the “Review pull request button” in the top toolbar,
                and load any pull request via URL or pick a pull request from a
                dropdown.
              </p>
              <p>
                We built Haystack Code Reviewer because we found pull requests
                difficult to review in a pure textual format — especially when
                hopping between multiple files or trying to break down complex
                changes. Oftentimes, pull request authors would have to
                specifically structure their commits so that code reviews would
                be easier to tackle, which is a time-consuming and error-prone
                process. Our goal is to make any pull request easy to understand
                at a glance, and reduce the effort needed from both reviewers
                and authors to craft a good code review.
              </p>
              <p>
                Haystack Code Reviewer works on private repositories! We have
                authentication to ensure that someone cannot open the server for
                your pull request without having access to that pull request on
                GitHub. For additional security, we plan to build self-hosting
                soon. Please contact us if you’re interested in this.
              </p>
              <p>
                Alternatively, a completely local option would be to download
                desktop Haystack and then navigate to your pull request from
                there. This is great for trying out the feature without exposing
                any data on the cloud!
              </p>
              <p>In the near future, we plan to:</p>
              <p>
                1. Introduce step-by-step navigation to guide reviewers through
                each part of the changeset
              </p>
              <p>2. Allow for self-hosting</p>
              <p>
                We’d love to hear your thoughts, suggestions, and any feedback
                on our approach or potential features!
              </p>
            </div>
          </section>
        </section>
        <section id="42934427">
          <h3>
            <a
              class="item"
              href="https://kubamartin.com/posts/introduction-to-the-jujutsu-vcs/"
              >Jujutsu VCS: Introduction and patterns</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-04 @ 16:22:03</span
              ><span class="points-container"
                >Points: <span class="points">174</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42934427"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42934422">
          <h3>
            <a
              class="item"
              href="https://www.apple.com/newsroom/2025/02/introducing-apple-invites-a-new-app-that-brings-people-together/"
              >Apple Invites</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-04 @ 16:21:58</span
              ><span class="points-container"
                >Points: <span class="points">283</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42934422"
                  >Comments</a
                ><span class="descendants">: 495</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42934190">
          <h3>
            <a class="item" href="https://danieldelaney.net/chat/"
              >Chat is a bad UI pattern for development tools</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-04 @ 16:06:32</span
              ><span class="points-container"
                >Points: <span class="points">630</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42934190"
                  >Comments</a
                ><span class="descendants">: 344</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42933840">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/2025/02/04/business/air-traffic-controller-shortage/index.html"
              >America desperately needs more air traffic controllers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-04 @ 15:44:21</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42933840"
                  >Comments</a
                ><span class="descendants">: 275</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42933049">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/alan-turings-delilah"
              >Alan Turing's "Delilah" project</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-04 @ 14:50:00</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42933049"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42932948">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2502.01142"
              >DeepRAG: Thinking to retrieval step by step for large language
              models</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-04 @ 14:43:53</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42932948"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42932148">
          <h3>
            <a
              class="item"
              href="https://blog.sylver.dev/build-your-own-sqlite-part-4-reading-tables-metadata"
              >Build your own SQLite, Part 4: reading tables metadata</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-04 @ 13:39:12</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42932148"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42931109">
          <h3>
            <a class="item" href="https://radfoam.github.io"
              >Radiant Foam: Real-Time Differentiable Ray Tracing</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-04 @ 11:39:56</span
              ><span class="points-container"
                >Points: <span class="points">173</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42931109"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42921659">
          <h3>
            <a
              class="item"
              href="https://blog.luap.info/what-really-happens-inside-a-dating-app.html"
              >What really happens inside a dating app</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-03 @ 19:12:30</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42921659"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42905821">
          <h3>
            <a
              class="item"
              href="https://handmadecities.com/news/splitting-from-handmade-network/"
              >Splitting from Handmade Network</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-02 @ 04:29:06</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42905821"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42897730">
          <h3>
            <a
              class="item"
              href="https://omniletters.com/hidden-pyramid-structure-discovered-near-caral/"
              >Pyramid structure discovered near Caral Peru</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-01 @ 12:00:39</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42897730"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42897151">
          <h3>
            <a
              class="item"
              href="https://unifiedpush.org/news/20250131_push_for_decentralized/"
              >Push Notifications for Decentralized Services</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-01 @ 09:33:36</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42897151"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42896797">
          <h3>
            <a
              class="item"
              href="https://www.sciencedirect.com/science/article/abs/pii/S0016703796002451"
              >Natural fission reactors in the Franceville basin, Gabon</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-02-01 @ 08:21:45</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42896797"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42888538">
          <h3>
            <a
              class="item"
              href="https://madelinemiller.dev/blog/motion-sickness-accessibility/"
              >Motion sickness accessibility in video games</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-01-31 @ 15:20:31</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42888538"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
