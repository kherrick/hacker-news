<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38471744">
          <h3>
            <a
              class="item"
              href="https://www.businessinsider.com/amazon-hr-performance-improvement-plans-pip-pivot-had-to-quit-2023-11"
              >I worked in Amazon HR and was disgusted at what I was seeing with
              PIP plans</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-30 @ 10:09:47</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38471744"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38471004">
          <h3>
            <a class="item" href="https://daniel.haxx.se/blog/2023/11/30/xcurl/"
              >XCurl</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-30 @ 08:10:43</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38471004"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38470764">
          <h3>
            <a class="item" href="https://brickception.xyz/">Brickception</a>
          </h3>
          <section>
            <h4>
              <span>2023-11-30 @ 07:35:17</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38470764"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38468387">
          <h3>
            <a
              class="item"
              href="https://www.jefftk.com/p/losing-metaphors-zip-and-paste"
              >Losing Metaphors: Zip and Paste</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-30 @ 02:03:21</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38468387"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38467923">
          <h3>
            <a
              class="item"
              href="https://www.scopeofwork.net/on-pneumatic-tires/"
              >On Pneumatic Tires</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-30 @ 01:19:11</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38467923"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38467850">
          <h3>
            <a
              class="item"
              href="https://openai.com/blog/sam-altman-returns-as-ceo-openai-has-a-new-initial-board"
              >Sam Altman returns as CEO, OpenAI has a new initial board</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-30 @ 01:08:42</span
              ><span class="points-container"
                >Points: <span class="points">621</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38467850"
                  >Comments</a
                ><span class="descendants">: 562</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38466431">
          <h3>
            <a class="item" href="https://baller.tuxfamily.org/online/"
              >Ballerburg SDL – Play classical castle combat game from 1987 in
              the browser</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-29 @ 22:51:14</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38466431"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38465895">
          <h3>
            <a
              class="item"
              href="https://www.ecns.cn/news/sci-tech/2023-11-29/detail-ihcvixpi0428703.shtml"
              >Loongson releases next-generation CPU</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-29 @ 21:58:13</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38465895"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38465693">
          <h3>
            <a
              class="item"
              href="https://jobs.ashbyhq.com/Jerry/921d3846-04e1-4430-a515-b91192a4993c"
              >Jerry (YC S17) Is Hiring VP Product (&amp;amp; Other Engineer and
              PM Roles)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-29 @ 21:39:11</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38465396">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=rp2RqVE08Zo"
              >Towards Higher-Level Abstractions for Molecular Programming
              [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-29 @ 21:12:56</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38465396"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38465378">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=CG24QFdVh-0"
              >Strange Loops: journeys in declarative logic programming in
              genomics [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-29 @ 21:11:20</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38465378"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38464057">
          <h3>
            <a class="item" href="https://github.com/Mozilla-Ocho/llamafile"
              >Llamafile lets you distribute and run LLMs with a single file</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-29 @ 19:29:49</span
              ><span class="points-container"
                >Points: <span class="points">783</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38464057"
                  >Comments</a
                ><span class="descendants">: 168</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38463832">
          <h3>
            <a class="item" href="https://whenistheweekend.com/theSphere.html"
              >Write shaders for the (sim) Vegas sphere</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-29 @ 19:14:42</span
              ><span class="points-container"
                >Points: <span class="points">321</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38463832"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38463355">
          <h3>
            <a
              class="item"
              href="https://www.consumerreports.org/cars/car-reliability-owner-satisfaction/who-makes-the-most-reliable-cars-a7824554938/"
              >Who makes the most reliable new cars?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-29 @ 18:42:34</span
              ><span class="points-container"
                >Points: <span class="points">389</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38463355"
                  >Comments</a
                ><span class="descendants">: 838</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38463195">
          <h3>
            <a
              class="item"
              href="https://rootsofprogress.org/steam-engine-origins"
              >The origins of the steam engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-29 @ 18:32:09</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38463195"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38461323">
          <h3>
            <a
              class="item"
              href="https://deepmind.google/discover/blog/millions-of-new-materials-discovered-with-deep-learning/"
              >Graph Networks for Materials Exploration</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-29 @ 16:17:56</span
              ><span class="points-container"
                >Points: <span class="points">210</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38461323"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38461249">
          <h3>
            <a class="item" href="https://github.com/01mf02/jaq"
              >Jaq – A jq clone focused on correctness, speed, and simplicity</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-29 @ 16:13:23</span
              ><span class="points-container"
                >Points: <span class="points">371</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38461249"
                  >Comments</a
                ><span class="descendants">: 202</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38459463">
          <h3>
            <a
              class="item"
              href="https://www.aaas.org/news/marine-bacteria-genus-may-hold-mitochondrias-closest-relatives"
              >Marine bacteria genus may hold mitochondria's closest
              relatives</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-29 @ 14:07:12</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38459463"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38459061">
          <h3>
            <a
              class="item"
              href="https://tldp.org/LDP/Linux-Filesystem-Hierarchy/html/index.html"
              >Linux Filesystem Hierarchy (2004)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-29 @ 13:28:21</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38459061"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38458651">
          <h3>
            <a
              class="item"
              href="https://media.ccc.de/v/29c3-5088-en-many_tamagotchis_were_harmed_in_the_making_of_this_presentation_h264"
              >Many Tamagotchis were harmed in the making of this presentation
              (2012) [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-29 @ 12:41:33</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38458651"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38458482">
          <h3>
            <a
              class="item"
              href="https://www.analog.com/en/education/education-library/videos/6330317501112.html"
              >Analog Devices Apollo MxFE 0.5 to 55 GHz Ecosystem</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-29 @ 12:16:27</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38458482"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38458093">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=2VFNEhab_lk"
              >Poor Broken and Battered Amiga A2000 – Can We Fix It? [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-29 @ 11:24:03</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38458093"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38457953">
          <h3>
            <a
              class="item"
              href="https://www.phoronix.com/news/Roundcube-Nextcloud"
              >Roundcube open-source webmail software merges with Nextcloud</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-29 @ 11:03:47</span
              ><span class="points-container"
                >Points: <span class="points">317</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38457953"
                  >Comments</a
                ><span class="descendants">: 231</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38457926">
          <h3>
            <a class="item" href="https://github.com/pwnwriter/hysp"
              >Hysp – An independent package manager</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-29 @ 10:59:52</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38457926"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38457247">
          <h3>
            <a
              class="item"
              href="https://xuanwo.io/2023/04-rust-std-fs-slower-than-python/"
              >Rust std fs slower than Python? No, it's hardware</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-29 @ 09:18:32</span
              ><span class="points-container"
                >Points: <span class="points">627</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38457247"
                  >Comments</a
                ><span class="descendants">: 200</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38456692">
          <h3>
            <a class="item" href="https://imois.in/games/travle/"
              >Travle: A daily game – get between countries in as few guesses as
              possible</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-29 @ 07:51:25</span
              ><span class="points-container"
                >Points: <span class="points">261</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38456692"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38456230">
          <h3>
            <a class="item" href="https://synergeticlabs.com/email-alchemy/"
              >Exploring Self-Hosted Email Services</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-29 @ 06:27:52</span
              ><span class="points-container"
                >Points: <span class="points">150</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38456230"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38453047">
          <h3>
            <a class="item" href="https://dobb-e.com/"
              >Show HN: Dobb·E – towards home robots with an open-source
              platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-28 @ 23:23:54</span
              ><span class="points-container"
                >Points: <span class="points">335</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38453047"
                  >Comments</a
                ><span class="descendants">: 102</span></span
              >
            </h4>
            <div class="text">
              <p>
                Here are some more details, below (or see a Twitter thread with
                attached media:
                <a href="https://twitter.com/i/status/1729515379892826211"
                  >https://twitter.com/i/status/1729515379892826211</a
                >
                or
                <a href="https://nitter.net/i/status/1729515379892826211"
                  >https://nitter.net/i/status/1729515379892826211</a
                >):
              </p>
              <p>
                We engineered Dobb·E to maximize efficiency, safety, and user
                comfort. As a system, it is composed of four parts: a data
                collection tool, a home dataset, a pretrained vision model, and
                a policy fine-tuning recipe.
              </p>
              <p>
                We teach our robots with imitation learning, and for data
                collection, we created the “Stick”, a tool made out of $25 of
                hardware and an iPhone.
              </p>
              <p>
                Then, using the Stick, we collected a 13 hour dataset in 22 New
                York homes, called Homes of New York (HoNY). HoNY has 1.5M
                frames collected over 216 different "environments" which is an
                order of magnitude larger compared to similar open source
                datasets.
              </p>
              <p>
                Then we trained a foundational vision model that we can
                fine-tune fast (15 minutes!) on a new task with only 5 minutes
                (human time)/ 90 seconds (demo time) of data. So from start to
                finish, it takes about 20 minutes to teach the robot a new task.
              </p>
              <p>
                Over a month, we visited 10 homes, tried 109 tasks, and got 81%
                success rate in simple household tasks. We also found a line of
                challenges, from mirrors to heavy objects, that we must overcome
                if we are to get a general purpose home robot.
              </p>
              <p>
                We open-sourced our entire system because our primary goal is to
                get more robotics and AI researchers, engineers, and enthusiasts
                to go beyond constrained lab environments and start getting into
                homes!
              </p>
              <p>So here is how you can get started:</p>
              <p>
                1. Code and STL files:
                <a href="https://github.com/notmahi/dobb-e/"
                  >https://github.com/notmahi/dobb-e/</a
                >
              </p>
              <p>
                2. Technical documentation:
                <a href="https://docs.dobb-e.com/">https://docs.dobb-e.com/</a>
              </p>
              <p>
                3. Paper:
                <a href="https://arxiv.org/abs/2311.16098"
                  >https://arxiv.org/abs/2311.16098</a
                >
              </p>
              <p>
                4. More videos and the dataset:
                <a href="https://dobb-e.com">https://dobb-e.com</a>
              </p>
              <p>
                5. Robot we used:
                <a href="https://hello-robot.com">https://hello-robot.com</a>
              </p>
            </div>
          </section>
        </section>
        <section id="38451680">
          <h3>
            <a class="item" href="https://herbie.uwplse.org/"
              >Herbie: Find and fix floating-point accuracy problems</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-28 @ 21:39:59</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38451680"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38444577">
          <h3>
            <a
              class="item"
              href="https://luke.hsiao.dev/blog/housing-documentation/"
              >Writing documentation for your house</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-11-28 @ 11:12:25</span
              ><span class="points-container"
                >Points: <span class="points">625</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38444577"
                  >Comments</a
                ><span class="descendants">: 282</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
