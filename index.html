<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37308405">
          <h3>
            <a class="item" href="https://blog.quarkslab.com/starlink.html"
              >Starlink's User Terminal Firmware</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 14:24:21</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37308405"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37308329">
          <h3>
            <a class="item" href="https://text.npr.org/1194289492"
              >She paid husband's hospital bill. A year after his death, they
              wanted more money</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 14:18:31</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37308329"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37307886">
          <h3>
            <a
              class="item"
              href="https://ourworldindata.org/extreme-poverty-in-brief"
              >Extreme poverty: How far have we come, and how far do we still
              have to go?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 13:48:27</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37307886"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37307828">
          <h3>
            <a
              class="item"
              href="https://bhavana.org.in/c-r-rao-a-life-in-statistics/"
              >C.R. Rao: A Life in Statistics (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 13:44:20</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37307828"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37307788">
          <h3>
            <a
              class="item"
              href="https://www.nbcnews.com/news/investigations/marine-sarah-feinberg-whistleblower-booz-allen-69-million-rcna102098"
              >Whistleblower alleges Booz Allen was overcharging U.S. taxpayers
              for losses</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 13:41:41</span
              ><span class="points-container"
                >Points: <span class="points">77</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37307788"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37307708">
          <h3>
            <a
              class="item"
              href="https://undeadly.org/cgi?action=article;sid=20230829051257"
              >Keystroke timing obfuscation added to ssh(1)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 13:36:05</span
              ><span class="points-container"
                >Points: <span class="points">150</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37307708"
                  >Comments</a
                ><span class="descendants">: 77</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37307653">
          <h3>
            <a
              class="item"
              href="https://nicolo.dev/en/blog/fairplay-apple-obfuscation/"
              >Analysis of Obfuscation Techniques Found in Apple FairPlay</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 13:32:45</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37307653"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37307473">
          <h3>
            <a
              class="item"
              href="https://wildbit.com/blog/accessible-palette-stop-using-hsl-for-color-systems"
              >Accessible Palette: stop using HSL for color systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 13:21:34</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37307473"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37307313">
          <h3>
            <a
              class="item"
              href="https://dev.dylibso.com/docs/observe/overview/"
              >Observability in WebAssembly</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 13:10:13</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37307313"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37307260">
          <h3>
            <a
              class="item"
              href="https://www.modular.com/blog/how-mojo-gets-a-35-000x-speedup-over-python-part-2"
              >How Mojo gets a 35,000x speedup over Python – Part 2</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 13:07:00</span
              ><span class="points-container"
                >Points: <span class="points">53</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37307260"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37307253">
          <h3>
            <a class="item" href="https://sc-server-meshing.info/wiki"
              >StarCitizen Server Meshing Architecture</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 13:06:43</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37307253"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37307032">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/technology/2023/aug/29/amazon-ceo-staff-work-in-office-job-workers"
              >Amazon CEO tells staff to work in office 3 days a week or look
              for another job</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 12:52:50</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37307032"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37306769">
          <h3>
            <a
              class="item"
              href="https://www.codewithjason.com/duplication-cheaper-wrong-abstraction/"
              >I don’t buy “duplication is cheaper than the wrong abstraction”
              (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 12:31:27</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37306769"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37306534">
          <h3>
            <a
              class="item"
              href="https://developer.nvidia.com/blog/simplifying-gpu-application-development-with-heterogeneous-memory-management/"
              >Simplifying GPU Application Development with HMM</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 12:11:42</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37306534"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37306530">
          <h3>
            <a
              class="item"
              href="https://workspace.google.com/blog/product-announcements/duet-ai-in-workspace-now-available"
              >Duet AI for Google Workspace Now Available</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 12:11:12</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37306530"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37306435">
          <h3>
            <a
              class="item"
              href="https://jobs.ashbyhq.com/cointracker/b32d47df-5650-4424-8bd7-1ec151ad9922"
              >CoinTracker (YC W18) Hiring a Product Leader to Build B2B Product
              (Remote)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 12:00:19</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37306262">
          <h3>
            <a class="item" href="https://play.elevatorsaga.com/index.html"
              >Elevator Saga: An elevator programming game (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 11:43:00</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37306262"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37306258">
          <h3>
            <a class="item" href="https://mu.app"
              >Show HN: Mu – A Micro App Platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 11:42:50</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37306258"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
            <div class="text">
              <p>
                Sharing a new piece of work I've been doing with a friend. Mu is
                a new micro web app platform which enables building and sharing
                apps instantly with storage, auth and payments built in. Apps
                are single file, built in the browser and rendered as an iframe.
                They're "micro" because they're quite literally tiny single
                purpose utilities like a hackernews reader or old school guest
                book. It's mostly at this point something that scratches a
                personal itch. Making app development super simple and
                lightweight. Sort of like living GitHub gists. And trying to
                build a simpler, cleaner place to consume the web. Right now
                nothing more than a cool hack I'm sharing. Feedback obviously
                welcome.
              </p>
              <p>Cheers Asim</p>
            </div>
          </section>
        </section>
        <section id="37306055">
          <h3>
            <a
              class="item"
              href="https://www.ornl.gov/news/neutrons-prove-bond-villain-did-not-cause-arecibo-telescope-collapse"
              >Neutrons prove ‘Bond villain’ did not cause Arecibo telescope
              collapse</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 11:20:23</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37306055"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37305800">
          <h3>
            <a
              class="item"
              href="https://blog.benjojo.co.uk/post/bgp-path-attributes-grave-error-handling"
              >Grave flaws in BGP Error handling</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 10:51:31</span
              ><span class="points-container"
                >Points: <span class="points">151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37305800"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37305338">
          <h3>
            <a
              class="item"
              href="https://electronics.stackexchange.com/questions/115200/why-does-the-usa-use-110v-and-uk-use-230-240v"
              >Why does the USA use 110V and UK use 230-240V? (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 09:48:30</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37305338"
                  >Comments</a
                ><span class="descendants">: 140</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37305240">
          <h3>
            <a class="item" href="https://microsoft.github.io/lida/"
              >Automatic Generation of Visualizations and Infographics with
              LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 09:30:35</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37305240"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37304870">
          <h3>
            <a class="item" href="https://visualgo.net/en"
              >Visualization of Common Algorithms</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 08:34:46</span
              ><span class="points-container"
                >Points: <span class="points">149</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37304870"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37304803">
          <h3>
            <a
              class="item"
              href="https://cloud.google.com/blog/products/maps-platform/announcing-pollen-api-providing-actionable-info-about-airborne-pollen-levels-worldwide"
              >Announcing the Pollen API</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 08:21:57</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37304803"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37304789">
          <h3>
            <a class="item" href="http://www.airfields-freeman.com/"
              >Abandoned and Little-Known Airfields</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 08:19:35</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37304789"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37304370">
          <h3>
            <a class="item" href="https://mjg59.dreamwidth.org/67402.html"
              >Unix sockets, Cygwin, SSH agents, and sadness</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 07:11:09</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37304370"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37304306">
          <h3>
            <a class="item" href="https://github.com/ashvardanian/Stringzilla"
              >Stringzilla: Fastest string sort, search, split, and shuffle
              using SIMD</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 07:01:44</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37304306"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37303960">
          <h3>
            <a class="item" href="https://github.com/btpf/Alexandria"
              >Alexandria: A minimalistic cross-platform eBook reader</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-29 @ 05:55:40</span
              ><span class="points-container"
                >Points: <span class="points">198</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37303960"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37271260">
          <h3>
            <a
              class="item"
              href="https://bartwullems.blogspot.com/2023/08/devtoysa-swiss-army-knife-for-developers.html"
              >DevToys – A Swiss army knife for developers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-26 @ 10:00:32</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37271260"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37271162">
          <h3>
            <a
              class="item"
              href="https://jamesg.blog/2023/08/26/python-dictionary-dispatch/"
              >The Python dictionary dispatch pattern</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-08-26 @ 09:46:30</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37271162"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
