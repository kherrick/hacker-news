<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40528766">
          <h3>
            <a
              class="item"
              href="https://www.modernretail.co/technology/is-target-selling-its-excess-inventory-on-ebay-poshmark/"
              >Is Target selling its excess inventory on eBay and Poshmark?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 21:12:14</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40528766"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40528680">
          <h3>
            <a class="item" href="https://skio.com/careers/"
              >Skio (YC S20) – Subscriptions for Shopify, ReCharge Migrations Is
              Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 21:01:37</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40528192">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40528192"
              >Ask HN: I have many PDFs – what is the best local way to leverage
              AI for search?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 20:24:05</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40528192"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
            <div class="text">
              As the title says, I have many PDFs - mostly scans via Scansnap -
              but also non-scans. These are sensitive in nature, e.g. bills,
              documents, etc. I would like a local-first AI solution that allows
              me to say things like: "show me all tax documents for August 2023"
              or "show my home title". Ideally it is Mac software that can
              access iCloud too, since that where I store it all. I would prefer
              to not do any tagging. I would like to optimize on recall over
              precision, so False Positives in the search results are ok. What
              are modern approaches to do this, without hacking one up on my
              own?
            </div>
          </section>
        </section>
        <section id="40527814">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s43247-024-01442-3"
              >2023 planetary heat uptake from termination shock of inadvertent
              geoengineering?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 19:43:03</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40527814"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40527730">
          <h3>
            <a
              class="item"
              href="https://blog.mozilla.org/en/mozilla/heres-what-were-working-on-in-firefox/"
              >What We're Working on in Firefox</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 19:32:05</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40527730"
                  >Comments</a
                ><span class="descendants">: 133</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40527242">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/d41586-024-01566-8"
              >'Smart' antibiotic can kill deadly bacteria while sparing the
              microbiome</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 18:43:32</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40527242"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40526488">
          <h3>
            <a
              class="item"
              href="https://blogs.nasa.gov/webb/2024/05/30/nasas-james-webb-space-telescope-finds-most-distant-known-galaxy/"
              >James Webb Space Telescope Finds Most Distant Known Galaxy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 17:40:16</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40526488"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40525802">
          <h3>
            <a
              class="item"
              href="https://review.firstround.com/unexpected-anti-patterns-for-engineering-leaders-lessons-from-stripe-uber-carta/"
              >Unexpected Anti-Patterns for Engineering Leaders</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 16:46:17</span
              ><span class="points-container"
                >Points: <span class="points">119</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40525802"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40525130">
          <h3>
            <a class="item" href="https://blog.lumen.com/the-pumpkin-eclipse/"
              >The Pumpkin Eclipse</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 15:52:29</span
              ><span class="points-container"
                >Points: <span class="points">264</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40525130"
                  >Comments</a
                ><span class="descendants">: 122</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40525077">
          <h3>
            <a
              class="item"
              href="https://www.midiaresearch.com/blog/older-gamers-are-a-growth-opportunity-for-aaa-publishers-here-is-how-to-capture-it"
              >Older gamers are a growth opportunity for AAA publishers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 15:47:20</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40525077"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40525064">
          <h3>
            <a
              class="item"
              href="https://testing.googleblog.com/2024/05/dont-dry-your-code-prematurely.html"
              >Don't DRY Your Code Prematurely</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 15:45:54</span
              ><span class="points-container"
                >Points: <span class="points">368</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40525064"
                  >Comments</a
                ><span class="descendants">: 242</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40524823">
          <h3>
            <a
              class="item"
              href="https://krebsonsecurity.com/2024/05/operation-endgame-hits-malware-delivery-platforms/"
              >'Operation Endgame' Hits Malware Delivery Platforms</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 15:24:36</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40524823"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40524759">
          <h3>
            <a
              class="item"
              href="https://www.assembled.com/blog/better-rag-results-with-reciprocal-rank-fusion-and-hybrid-search"
              >Better RAG Results with Reciprocal Rank Fusion and Hybrid
              Search</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 15:17:39</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40524759"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40524681">
          <h3>
            <a class="item" href="https://markets.sh/notifications/api"
              >Show HN: Webhooks for Any Event</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 15:10:55</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40524681"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
            <div class="text">
              <p>
                - Notify me when Nvidia is worth 10 trillion - Notify me about
                AI breakthroughs - Notify me when Intel is the market leader
                again - Notify me about successful Starship launches - Notify me
                when a war breaks out - Notify me about bankrupt unicorn
                startups - Notify me about significant economic events
              </p>
              <p>
                The feature is still very early. If you write that you’re from
                Hacker News in the support chat, I’ll give personal support.
                Would greatly appreciate all feedback
              </p>
            </div>
          </section>
        </section>
        <section id="40524292">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40524292"
              >Ask HN: How can we open-source a 7 year old SaaS codebase and
              build a community?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 14:37:25</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40524292"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
            <div class="text">
              <p>
                I'm Kirill Markin, and my co-founder is Nikolay Amiantov. We've
                been working on our CRM/ERP product since 2017 and even have
                paying customers. But our growth is slow, and that's not
                exciting. We want to create something bigger for more people to
                use, and open-sourcing is something that both resonates with us
                and is a way to attract a community.
              </p>
              <p>
                Our codebase is 38k LoC of F# (including a compiler for our own
                query language) and 35k LoC of TypeScript + Vue.js. While we
                prepare the code we have been reaching out to Zoho and ODOO
                integrators/developers (as they’re our closest competitors),
                from whom we got a lot of positive feedback.
              </p>
              <p>
                Our biggest hurdle is figuring out the best way to take the next
                steps. Does anyone have any ideas on how to launch such a large
                codebase on GitHub to get maximum visibility? Suggestions on
                building a community around our open-source product, organizing
                further work, or any other pieces of advice are welcome.
              </p>
            </div>
          </section>
        </section>
        <section id="40524238">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/physicists-puzzle-over-emergence-of-strange-electron-aggregates-20240529/"
              >Physicists Puzzle over Emergence of Electron Aggregates</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 14:33:46</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40524238"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40523743">
          <h3>
            <a
              class="item"
              href="https://apnews.com/article/abandoned-seafarers-labor-unpaid-wages-oceans-83ad0a42debbaf67c18373393fcea753"
              >Stuck at sea for years, a sailor's plight highlights a surge in
              ship abandonment</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 13:53:57</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40523743"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40523047">
          <h3>
            <a
              class="item"
              href="https://notes.eatonphil.com/2025-05-30-how-i-run-book-clubs.html"
              >I run a software book club</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 12:50:37</span
              ><span class="points-container"
                >Points: <span class="points">199</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40523047"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40522844">
          <h3>
            <a class="item" href="https://delve.a9.io/"
              >Show HN: ChatGPT UI for rabbit holes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 12:22:35</span
              ><span class="points-container"
                >Points: <span class="points">468</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40522844"
                  >Comments</a
                ><span class="descendants">: 111</span></span
              >
            </h4>
            <div class="text">
              <p>
                This is an interface that reifies that rabbit-holing process
                into a tiling layout. The model is instructed to output
                hyperlink-prompts when it mentions something you might want to
                delve into.
              </p>
              <p>
                Lots of features to add (sessions, sharing, navigation,
                highlight-to-delve, images, ...). Would love to hear other
                usecases and ideas!
              </p>
            </div>
          </section>
        </section>
        <section id="40522244">
          <h3>
            <a class="item" href="https://github.com/0x2E/fusion"
              >Show HN: I built a tiny-VPS friendly RSS aggregator and reader</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 10:53:09</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40522244"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
            <div class="text">
              <p>
                As an RSS user, I tried Inoreader and Feedly, then ended up
                self-hosting a Miniflux instance on my homelab. A few months
                ago, I moved to another city and had to shut down my homelab for
                a long time, so I couldn't access my local miniflux. It was
                quite inconvenient. I decided to self-host my RSS aggregator on
                a tiny VPS or PaaS such as fly.io. However, Miniflux requires a
                PostgreSQL database, which may isn't suitable for a tiny VPS
                instance.
              </p>
              <p>
                So I built fusion with Golang and SQLite. It contains basic
                features such as Group, Bookmark, Search, Automatically feeds
                sniffing, Import/Export OPML file, etc. It uses about 80MB of
                Mem and negligible CPU usage (metrics here:
                <a href="https://imgur.com/a/EJIdevn"
                  >https://imgur.com/a/EJIdevn</a
                >).
              </p>
              <p>Feel free to share your questions and suggestions.</p>
              <p>
                BTW, I also built an online tool to sniff RSS links from a URL.
                (<a href="https://rss-finder.rook1e.com/"
                  >https://rss-finder.rook1e.com/</a
                >)
              </p>
            </div>
          </section>
        </section>
        <section id="40522071">
          <h3>
            <a
              class="item"
              href="https://archive.org/details/yakov-perelman-geometry-for-entertainment-mir-titles-2024"
              >Geometry for Entertainment (1950)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 10:25:11</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40522071"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40521963">
          <h3>
            <a
              class="item"
              href="https://lettersofnote.com/2012/02/15/i-love-my-wife-my-wife-is-dead/"
              >I love my wife. My wife is dead (1946)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 10:06:07</span
              ><span class="points-container"
                >Points: <span class="points">325</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40521963"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40521710">
          <h3>
            <a class="item" href="https://www.lightcube.art/"
              >Show HN: I made a pixel art editor for Windows desktop</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 09:28:33</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40521710"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40521657">
          <h3>
            <a
              class="item"
              href="https://twitter.com/paulg/status/1796107666265108940"
              >I got tired of hearing that YC fired Sam, so here's what actually
              happened</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 09:19:25</span
              ><span class="points-container"
                >Points: <span class="points">580</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40521657"
                  >Comments</a
                ><span class="descendants">: 498</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40521518">
          <h3>
            <a
              class="item"
              href="https://bessey.dev/blog/2024/05/24/why-im-over-graphql/"
              >After 6 years, I'm over GraphQL</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 08:50:30</span
              ><span class="points-container"
                >Points: <span class="points">821</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40521518"
                  >Comments</a
                ><span class="descendants">: 526</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40521076">
          <h3>
            <a
              class="item"
              href="https://www.amygoodchild.com/blog/meaningful-nonsense-sentences"
              >Meaningful Nonsense: How I generate sentences</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 07:26:25</span
              ><span class="points-container"
                >Points: <span class="points">178</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40521076"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40520334">
          <h3>
            <a
              class="item"
              href="https://thereader.mitpress.mit.edu/how-actors-remember-their-lines/"
              >How actors remember their lines</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 05:21:46</span
              ><span class="points-container"
                >Points: <span class="points">479</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40520334"
                  >Comments</a
                ><span class="descendants">: 152</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40520277">
          <h3>
            <a class="item" href="https://github.com/rossmoody/svg-gobbler"
              >SVG Gobbler – Find, optimize, edit, and export SVGs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-30 @ 05:09:35</span
              ><span class="points-container"
                >Points: <span class="points">151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40520277"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40510822">
          <h3>
            <a
              class="item"
              href="https://www.kalzumeus.com/2011/07/08/business-psychology/"
              >How Running a Business Changes the Way You Think (2011)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-29 @ 11:38:05</span
              ><span class="points-container"
                >Points: <span class="points">175</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40510822"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40509535">
          <h3>
            <a
              class="item"
              href="https://blog.felixge.de/blazingly-fast-shadow-stacks-for-go/"
              >Fast Shadow Stacks for Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-29 @ 07:52:20</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40509535"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
