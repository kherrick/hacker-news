<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="45910625">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/collectwise/jobs/tv3ufcc-forward-deployed-engineer"
              >CollectWise (YC F24) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-13 @ 04:26:56</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45910381">
          <h3>
            <a
              class="item"
              href="https://grapheneos.social/@GrapheneOS/115533432439509433"
              >Google open-sources Android 16 QPR1, two months late</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-13 @ 03:49:23</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45910381"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45910370">
          <h3><a class="item" href="https://www.a67z.com/">A67z</a></h3>
          <section>
            <h4>
              <span>2025-11-13 @ 03:48:15</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45910370"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45910305">
          <h3>
            <a
              class="item"
              href="https://bitwarden.com/blog/how-cryptocurrency-became-law-enforcements-secret-weapon/"
              >Bitcoin's big secret: How cryptocurrency became law enforcement's
              secret weapon</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-13 @ 03:39:56</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45910305"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45910244">
          <h3>
            <a
              class="item"
              href="https://epsilon537.github.io/boxlambda/usb-hid/"
              >On USB HID, Keyboard LEDs, and device emulation (2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-13 @ 03:32:24</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45910244"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45909667">
          <h3>
            <a
              class="item"
              href="https://www.jenn.site/my-dad-could-still-be-alive-but-hes-not/"
              >My dad could still be alive, but he's not</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-13 @ 02:17:30</span
              ><span class="points-container"
                >Points: <span class="points">272</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45909667"
                  >Comments</a
                ><span class="descendants">: 160</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45909059">
          <h3>
            <a class="item" href="https://www.shadertoy.com/view/4dsXzM"
              >Human Fovea Detector</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-13 @ 00:48:45</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45909059"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45908938">
          <h3>
            <a
              class="item"
              href="https://android-developers.googleblog.com/2025/11/android-developer-verification-early.html"
              >Google will allow users to sideload Android apps without
              verification</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-13 @ 00:33:25</span
              ><span class="points-container"
                >Points: <span class="points">440</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45908938"
                  >Comments</a
                ><span class="descendants">: 155</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45908483">
          <h3>
            <a
              class="item"
              href="https://www.iflscience.com/on-november-13-2026-voyager-will-reach-one-full-light-day-away-from-earth-81432"
              >Voyager 1 is a light-day away by November 2026</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-12 @ 23:38:56</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45908483"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45908464">
          <h3>
            <a
              class="item"
              href="https://xeiaso.net/blog/2025/valve-is-about-to-win-the-console-generation/"
              >Valve is about to win the console generation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-12 @ 23:35:41</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45908464"
                  >Comments</a
                ><span class="descendants">: 112</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45907541">
          <h3>
            <a
              class="item"
              href="https://www.worldlabs.ai/blog/marble-world-model"
              >Marble: A Multimodal World Model</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-12 @ 22:11:14</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45907541"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45907259">
          <h3>
            <a class="item" href="https://github.com/Homebrew/brew/issues/20755"
              >Homebrew no longer allows bypassing Gatekeeper for
              unsigned/unnotarized software</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-12 @ 21:50:14</span
              ><span class="points-container"
                >Points: <span class="points">172</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45907259"
                  >Comments</a
                ><span class="descendants">: 137</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45904161">
          <h3>
            <a
              class="item"
              href="https://chillphysicsenjoyer.substack.com/p/results-from-blasting-yeast-with"
              >Blasting Yeast with UV Light</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-12 @ 18:46:40</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45904161"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45903995">
          <h3>
            <a class="item" href="https://robrobinette.com/How_Amps_Work.htm"
              >How Tube Amplifiers Work</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-12 @ 18:35:59</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45903995"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45903840">
          <h3>
            <a
              class="item"
              href="https://www.phoronix.com/news/Steam-Machines-Frame-2026"
              >Valve Announces New Steam Machine, Steam Controller and Steam
              Frame</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-12 @ 18:26:25</span
              ><span class="points-container"
                >Points: <span class="points">388</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45903840"
                  >Comments</a
                ><span class="descendants">: 122</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45903404">
          <h3>
            <a
              class="item"
              href="https://store.steampowered.com/sale/steammachine"
              >Steam Machine</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-12 @ 17:59:43</span
              ><span class="points-container"
                >Points: <span class="points">1516</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45903404"
                  >Comments</a
                ><span class="descendants">: 745</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45903325">
          <h3>
            <a
              class="item"
              href="https://store.steampowered.com/sale/steamframe"
              >Steam Frame</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-12 @ 17:54:58</span
              ><span class="points-container"
                >Points: <span class="points">1090</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45903325"
                  >Comments</a
                ><span class="descendants">: 404</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45903161">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=45903161"
              >Launch HN: JSX Tool (YC F25) – A Browser Dev-Panel IDE for
              React</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-12 @ 17:43:42</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45903161"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
            <div class="text">
              <a href="https://jsxtool.com">https://jsxtool.com</a>) a new
              inspector/dev panel IDE that allows you to navigate to any line of
              your React project’s JSX with just a click and a command click to
              explore your render stack.
              <p>
                Demo video:
                <a href="https://www.youtube.com/watch?v=JIIXvN7vhrs"
                  >https://www.youtube.com/watch?v=JIIXvN7vhrs</a
                >
              </p>
              <p>
                I’ve been writing React code for nearly a decade. Since I first
                saw source maps in the days of Babel and Redux, I’ve always
                wanted to be able to edit my code from the source maps. I’ve
                also always wanted to be able to inspect my JSX like it was
                HTML.
              </p>
              <p>
                Last year, I found my first real use of AI was taking ad-hoc CSS
                changes in the Chrome element inspector, pasting them into
                ChatGPT, and asking for the equivalent in Tailwind. I’d then
                paste those changes into my React TSX files.
              </p>
              <p>
                I wanted to streamline this process but came to the conclusion
                that to do so I needed to build a JSX inspector. I had to write
                a custom AST parser to create a mapping between the JSX and
                HTML. So I hacked on an inspector for a couple of months that
                connected JSX to the DOM in both directions.
              </p>
              <p>
                The next feature was adding a CSS editor, like the one in the
                browser inspectors but for JSX. Unlike styling a piece of HTML I
                decided that any in memory style edits to a React fiber should
                be globally applied, as if you had tweaked that line of code in
                your codebase.
              </p>
              <p>
                Finally, I was able to add the two AI features I really wanted:
                (1) prompt for in-memory styles for when I was pixel tweaking,
                and (2) save those temporary changes back to my codebase in the
                convention of the codebase I was working in.
              </p>
              <p>
                To accomplish talking to the filesystem from the Chrome
                extension I built a little local server that mounts from the
                root of your project and allows the extension to send
                file-system commands back to your project root. We named this
                the “Dev Server”. (Note: You can fully use us as a JSX inspector
                without this server installed.)
              </p>
              <p>
                After all that, I found that to convert myself as a user I
                needed it to be a pretty fully functional IDE. I needed vim
                bindings, I needed a typechecker, I needed auto-complete, I
                needed a linter, I needed code search and I needed a proper file
                explorer. Fortunately we were able to take advantage of the
                dev-server architecture we had stumbled onto in order to add an
                LSP server and Rip Grep. At this point, after months of dog
                fooding, I use JSX Tool for almost all of my website edits.
              </p>
              <p>
                We’re still rough around the edges for mobile but we’re working
                on that.
              </p>
              <p>
                All of the IDE stuff not involving AI is free and works fine
                without AI. We let you get a taste of the prompting stuff for
                free but apply some rate limits.
              </p>
              <p>
                The extension itself is not open source but the dev server with
                the LSP is. It’s a great foundation if you want to build any
                sort of in-browser IDE and it's nearly React agnostic. Building
                the dev server was a big undertaking so I’d love to see someone
                fork it and find value in it.
              </p>
              <p>
                In the future we want to start adding things that we are in a
                position to take advantage of over something like Cursor, such
                as letting AI give you code suggestions for runtime exceptions
                or work with the network logs. We think that the convenience of
                having your IDE in the dev panel gives us a leg up in
                convenience and workflow context.
              </p>
              <p>
                Anyway, regardless of how you feel about AI coding, I wanted to
                make something that was useful with or without AI. We’d love it
                if you gave it a spin and we want to share anything we can about
                the technical side of the product that you might find
                interesting.
              </p>
            </div>
          </section>
        </section>
        <section id="45902898">
          <h3>
            <a class="item" href="https://projecteuler.net">Project Euler</a>
          </h3>
          <section>
            <h4>
              <span>2025-11-12 @ 17:24:54</span
              ><span class="points-container"
                >Points: <span class="points">379</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45902898"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45901904">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/2025/11/12/business/last-penny-minted"
              >The last-ever penny will be minted today in Philadelphia</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-12 @ 16:10:13</span
              ><span class="points-container"
                >Points: <span class="points">610</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45901904"
                  >Comments</a
                ><span class="descendants">: 790</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45900978">
          <h3>
            <a
              class="item"
              href="https://lpn.swi-prolog.org/lpnpage.php?pageid=top"
              >Learn Prolog Now</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-12 @ 14:54:27</span
              ><span class="points-container"
                >Points: <span class="points">255</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45900978"
                  >Comments</a
                ><span class="descendants">: 178</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45900370">
          <h3>
            <a
              class="item"
              href="https://openai.com/index/fighting-nyt-user-privacy-invasion"
              >Fighting the New York Times' invasion of user privacy</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-12 @ 14:08:28</span
              ><span class="points-container"
                >Points: <span class="points">304</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45900370"
                  >Comments</a
                ><span class="descendants">: 291</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45899189">
          <h3>
            <a
              class="item"
              href="https://yorickpeterse.com/articles/a-brief-look-at-freebsd/"
              >A brief look at FreeBSD</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-12 @ 12:10:11</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45899189"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45898407">
          <h3>
            <a class="item" href="https://github.com/yt-dlp/yt-dlp/issues/15012"
              >Yt-dlp: External JavaScript runtime now required for full YouTube
              support</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-12 @ 10:12:53</span
              ><span class="points-container"
                >Points: <span class="points">920</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45898407"
                  >Comments</a
                ><span class="descendants">: 543</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45856014">
          <h3>
            <a
              class="item"
              href="https://jstrieb.github.io/posts/random-instructions/"
              >Disassembling terabytes of random data with Zig and Capstone to
              prove a point</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-08 @ 11:49:36</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45856014"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45837042">
          <h3>
            <a
              class="item"
              href="https://www.rigb.org/explore-science/explore/blog/tiny-vial-changed-world-benzene-200"
              >Benzene at 200</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-06 @ 16:33:42</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45837042"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45821265">
          <h3>
            <a
              class="item"
              href="https://www.johndcook.com/blog/2025/11/03/de-gua/"
              >Tetrahedral Analog of the Pythagorean Theorem</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-05 @ 10:01:03</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45821265"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45803408">
          <h3>
            <a
              class="item"
              href="http://xahlee.info/kbd/keyboard_n-key_rollover_key_ghosting.html"
              >Max Number of Simultaneous Key-Press (N-Key Rollover, NKRO,
              Ghosting) (2010)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-03 @ 19:36:27</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45803408"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45799664">
          <h3>
            <a
              class="item"
              href="https://lwn.net/SubscriberLink/1042355/434ad706cc594276/"
              >Mergiraf: Syntax-Aware Merging for Git</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-03 @ 14:54:54</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45799664"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45783411">
          <h3>
            <a
              class="item"
              href="https://news.mit.edu/2025/professor-ioannis-yannas-dies-1027"
              >Ioannis Yannas, who invented artificial skin for treatment of
              burns, has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-11-01 @ 17:18:23</span
              ><span class="points-container"
                >Points: <span class="points">150</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45783411"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
