<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37767205">
          <h3>
            <a
              class="item"
              href="https://twitter.com/rustykitty_/status/1709316764868153537"
              >AI Detectors: I Hate Being a Student in the Modern Age</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 16:06:41</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37767205"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37766929">
          <h3>
            <a
              class="item"
              href="https://docs.google.com/spreadsheets/d/162eraapxB6GYl1kjrv-0ZJsn-19ehFIARaM2_37PCls/edit#gid=0"
              >Pure Remote Jobs from “HN: Who Is Hiring”</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 15:49:54</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37766929"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37766711">
          <h3>
            <a
              class="item"
              href="https://lithub.com/how-us-intelligence-agencies-hid-their-most-shameful-experiments/"
              >How US Intelligence Agencies Hid Their Most Shameful
              Experiments</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 15:36:19</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37766711"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37766520">
          <h3>
            <a
              class="item"
              href="https://github.com/marshallpierce/rust-base64/issues/213"
              >Rust is not the language for you if you don't like traits</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 15:24:48</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37766520"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37766122">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2023/10/4/23899900/google-pixel-8-pro-android-updates-7-years-security-features"
              >Pixel 8 to have seven years of Android updates</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 14:58:08</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37766122"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37765663">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2310.02207"
              >Paper: LLMs have internal world model, and a sense of time and
              space</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 14:23:43</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37765663"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37765313">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2023/10/4/23902615/wii-u-nintendo-3ds-online-shut-down"
              >Nintendo’s Wii U and 3DS online services will shut down in
              April</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 14:01:21</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37765313"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37765158">
          <h3>
            <a class="item" href="https://lwn.net/Articles/946497/"
              >OpenSSH 9.5 released with keystroke timing obfuscation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 13:50:09</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37765158"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37764581">
          <h3>
            <a
              class="item"
              href="https://jakelazaroff.com/words/an-interactive-intro-to-crdts/"
              >An Interactive Intro to CRDTs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 13:12:45</span
              ><span class="points-container"
                >Points: <span class="points">258</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37764581"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37764489">
          <h3>
            <a
              class="item"
              href="https://benchmark.vectorview.ai/vectordbs.html"
              >Choosing vector database: a side-by-side comparison</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 13:04:52</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37764489"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37764382">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2310.02226"
              >Think Before You Speak: Training Language Models with Pause
              Tokens</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 12:54:33</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37764382"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37764326">
          <h3>
            <a
              class="item"
              href="https://www.svix.com/blog/strong-typing-hill-to-die-on/"
              >Strong static typing, a hill I'm willing to die on</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 12:49:17</span
              ><span class="points-container"
                >Points: <span class="points">194</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37764326"
                  >Comments</a
                ><span class="descendants">: 382</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37764133">
          <h3>
            <a class="item" href="https://ambient.run/"
              >Show HN: Ambient, a multiplayer game engine and platform using
              WASM/WebGPU/Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 12:28:25</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37764133"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
            <div class="text">
              <p>
                Our WASM use is innovative; it is being used as both a sandboxed
                runtime for user code, and as a way to run the entire Ambient
                runtime in the browser. This, paired with our ECS data model,
                enables a highly modular architecture that allows other
                developers to make isolated packages (code, 3D models, tools,
                etc.) that they can add as a mod to your game.
              </p>
              <p>
                Once deployed, these packages can be activated on-the-fly while
                running the game in the browser, acting as their own small
                applications inside the game. This can be great for testing out
                game features, but it also enables building games with others -
                whether they be friends or strangers. In the future, we hope
                that whole communities can build games together, not unlike
                open-source development.
              </p>
              <p>
                The runtime already has many of the features expected from a
                capable game engine, including physics (PhysX), a React-like UI
                toolkit and a GPU-driven renderer.
              </p>
              <p>
                Check out the blog post [1] to learn more, and to try out a live
                multiplayer demo on supported browsers. The team and I will be
                around to answer any questions you might have.
              </p>
              <p>
                [0]:
                <a href="https://news.ycombinator.com/item?id=34906166"
                  >https://news.ycombinator.com/item?id=34906166</a
                >
              </p>
              <p>
                [1]:
                <a href="https://ambient.run/blog/platform"
                  >https://ambient.run/blog/platform</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="37764088">
          <h3>
            <a class="item" href="https://annas-blog.org/worldcat-scrape.html"
              >1.3B Worldcat scrape and data science mini-competition</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 12:22:58</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37764088"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37763906">
          <h3>
            <a
              class="item"
              href="https://www.emergetools.com/careers/jobs/senior-android-engineer"
              >Emerge (YC W21) is hiring a Senior Android Engineer (remote,
              small team)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 12:00:19</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37763822">
          <h3>
            <a class="item" href="https://github.com/shuttle-hq/shuttle"
              >Show HN: Shuttle – Build and ship backends without writing
              infrastructure files</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 11:51:17</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37763822"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37763424">
          <h3>
            <a
              class="item"
              href="https://www.thebignewsletter.com/p/the-ftc-sues-to-break-up-amazon-over"
              >The FTC Sues to Break Up Amazon over an Economy-Wide “Hidden
              Tax”</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 11:03:22</span
              ><span class="points-container"
                >Points: <span class="points">266</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37763424"
                  >Comments</a
                ><span class="descendants">: 277</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37763143">
          <h3>
            <a
              class="item"
              href="https://www.cloudflarestatus.com/incidents/j3h00yhjyw6p"
              >Issues with 1.1.1.1 public resolver and WARP</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 10:25:23</span
              ><span class="points-container"
                >Points: <span class="points">147</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37763143"
                  >Comments</a
                ><span class="descendants">: 71</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37763098">
          <h3>
            <a class="item" href="https://lfgslots.com/classicvideopoker/"
              >Show HN: Classic Video Poker (Godot is awesome!)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 10:18:04</span
              ><span class="points-container"
                >Points: <span class="points">356</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37763098"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
            <div class="text">
              <p>
                I've been lucky enough to make a good living out of Unity with
                my own consultancy over the years making data visualisation
                applications (Wind Energy) and innovation projects (Visualising
                accounting data for Wolters Kluwer etc.).
              </p>
              <p>
                Godot is pretty amazing in my opinion. Wrote this game over a
                few days and was productive in Godot basically instantly. I
                couldn't get up and running in Unreal despite trying a few
                times.
              </p>
              <p>
                It's my ambition to start a niche agency developing 80's style
                games of skill and chance for the corporate world.
              </p>
              <p>
                So... If anyone has any leads for making Space Invaders for Nike
                - please help! Happy to pay 5% on whatever work I get.
              </p>
            </div>
          </section>
        </section>
        <section id="37761350">
          <h3>
            <a
              class="item"
              href="https://blog.apnic.net/2023/06/21/enabling-ipv6-support-for-ipv4-only-apps-on-linux/"
              >Enabling IPv6 support for IPv4-only apps on Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 05:59:47</span
              ><span class="points-container"
                >Points: <span class="points">138</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37761350"
                  >Comments</a
                ><span class="descendants">: 115</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37761273">
          <h3>
            <a
              class="item"
              href="https://blog.reyem.dev/post/extracting_hn_book_recommendations_with_chatgpt_api/"
              >Extracting Hacker News Book Recommendations with the ChatGPT
              API</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 05:48:00</span
              ><span class="points-container"
                >Points: <span class="points">291</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37761273"
                  >Comments</a
                ><span class="descendants">: 147</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37760130">
          <h3>
            <a class="item" href="https://robotics-transformer-x.github.io/"
              >RT-X: the largest open-source robot dataset</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 02:24:01</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37760130"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37759873">
          <h3>
            <a
              class="item"
              href="https://moxie.org/2013/01/07/career-advice.html"
              >Career Advice (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-04 @ 01:37:29</span
              ><span class="points-container"
                >Points: <span class="points">275</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37759873"
                  >Comments</a
                ><span class="descendants">: 143</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37759002">
          <h3>
            <a
              class="item"
              href="https://www.leadedsolder.com/2023/10/03/creativision-clone-v1.html"
              >Dick Smith’s Wizzard-ry 8 (Bit)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 23:36:15</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37759002"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37756906">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/2023/10/09/among-the-cabin-fanatics-of-mississippis-giant-houseparty"
              >Among the Cabin Fanatics of Mississippi’s Giant Houseparty</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 20:11:41</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37756906"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37751270">
          <h3>
            <a class="item" href="https://dylibso.com/blog/why-extism/"
              >Extism Makes WebAssembly Easy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 13:01:33</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37751270"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37749623">
          <h3>
            <a
              class="item"
              href="https://mostlynerdless.de/blog/2023/10/03/level-up-your-java-debugging-skills-with-on-demand-debugging/"
              >Level-up your Java Debugging Skills with on-demand Debugging</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 09:27:16</span
              ><span class="points-container"
                >Points: <span class="points">3</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37749623"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37749608">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/project-management-software-productivity/"
              >Project Management Software Can't Save You</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-03 @ 09:24:58</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37749608"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37736211">
          <h3>
            <a
              class="item"
              href="https://worldsensorium.com/the-greening-of-milan-porta-nuova-and-vertical-forest/"
              >The Greening of Milan: Porta Nuova and Vertical Forest</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-02 @ 10:16:20</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37736211"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37734531">
          <h3>
            <a
              class="item"
              href="https://randomascii.wordpress.com/2023/10/01/32-mib-working-sets-on-a-64-gib-machine/#more-4032"
              >32 MiB Working Sets on a 64 GiB machine</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-10-02 @ 06:09:48</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37734531"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
