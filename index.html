<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36842239">
          <h3>
            <a
              class="item"
              href="https://math.stanford.edu/~vakil/threethings.html"
              >The “Three Things” Exercise for getting things out of talks</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 02:06:18</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36842239"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36842186">
          <h3>
            <a
              class="item"
              href="https://addons.mozilla.org/en-US/firefox/addon/block-the-rich/"
              >Block the Rich</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 01:57:50</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36842186"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36841837">
          <h3>
            <a
              class="item"
              href="https://apnews.com/article/arizona-cant-limit-filming-of-police-a7a7ad0fe5b421d416ec3477d0795707"
              >Court strikes down limits on filming of police in Arizona</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 01:10:53</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36841837"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36841798">
          <h3>
            <a
              class="item"
              href="https://blog.aurel32.net/welcome-debian-riscv64.html"
              >Welcome Debian riscv64</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 01:06:21</span
              ><span class="points-container"
                >Points: <span class="points">74</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36841798"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36841369">
          <h3>
            <a
              class="item"
              href="https://therecord.media/senate-dea-bill-targets-end-to-end-encryption-requires-companies-to-report-drugs"
              >U.S. Senate bill crafted with DEA targets end-to-end
              encryption</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 00:01:48</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36841369"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36841272">
          <h3>
            <a
              class="item"
              href="https://web.archive.org/web/20230723100307/https://www.virtualbox.org/wiki/Downloads"
              >VirtualBox 7.0.10 download links have disappeared</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 23:48:32</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36841272"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36841211">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2303.01157"
              >How Will Language Modelers Like ChatGPT Affect Occupations and
              Industries?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 23:40:51</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36841211"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36840728">
          <h3>
            <a
              class="item"
              href="https://blog.myscale.com/2023/07/17/teach-your-llm-vector-sql/"
              >Teach your LLM to answer with facts, not fiction</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 22:42:42</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36840728"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36840282">
          <h3>
            <a
              class="item"
              href="https://chcollins.com/100Billion/2015/02/why-frames-tilt-forward/"
              >Why Frames Tilt Forward (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 21:57:30</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36840282"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36839983">
          <h3>
            <a
              class="item"
              href="https://themessenger.com/news/all-foster-kids-in-california-can-now-attend-any-state-college-for-free"
              >All foster kids in California can now attend any state college
              for free</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 21:24:03</span
              ><span class="points-container"
                >Points: <span class="points">490</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36839983"
                  >Comments</a
                ><span class="descendants">: 418</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36839800">
          <h3>
            <a
              class="item"
              href="https://catonmat.net/ldd-arbitrary-code-execution"
              >Never run ldd on unknown executables</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 21:01:32</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36839800"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36838994">
          <h3>
            <a class="item" href="https://github.com/plv8/pljs"
              >PLJS – JavaScript Language Plugin for PostreSQL</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 19:43:45</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36838994"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36838511">
          <h3>
            <a
              class="item"
              href="https://undeadly.org/cgi?action=article;sid=20230723185853"
              >OpenBSD: AMD processor microcode support added to -current</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 18:59:27</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36838511"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36838051">
          <h3>
            <a class="item" href="https://github.com/karpathy/llama2.c"
              >Llama2.c: Inference llama 2 in one file of pure C</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 18:13:54</span
              ><span class="points-container"
                >Points: <span class="points">459</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36838051"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36837442">
          <h3>
            <a class="item" href="https://iconbuddy.app/"
              >Icon Buddy – 100K+ Open Source SVG Icons, Fully Customizable</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 17:19:40</span
              ><span class="points-container"
                >Points: <span class="points">159</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36837442"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36837273">
          <h3>
            <a
              class="item"
              href="https://lowendbox.com/blog/man-found-guilty-of-child-porn-because-he-ran-a-tor-exit-node-the-story-of-william-weber/"
              >Man found guilty of child porn because he ran a Tor exit node</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 17:03:23</span
              ><span class="points-container"
                >Points: <span class="points">612</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36837273"
                  >Comments</a
                ><span class="descendants">: 433</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36836639">
          <h3>
            <a
              class="item"
              href="https://www.scientificamerican.com/article/why-dont-we-get-our-drinking-water-from-the-ocean/"
              >Why don't we get our drinking water by taking salt out seawater?
              (2008)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 16:07:40</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36836639"
                  >Comments</a
                ><span class="descendants">: 252</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36836596">
          <h3>
            <a class="item" href="https://cc.dev"
              >Show HN: I made a MailChimp alternative that connects to your
              database</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 16:03:31</span
              ><span class="points-container"
                >Points: <span class="points">200</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36836596"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
            <div class="text">
              <p>
                The idea for this product came from trying to do email marketing
                for my side project, CubeDesk, a site where Rubik's Cube
                enthusiasts can time themselves, race with one another, train
                algorithms — it's a fun niche!
              </p>
              <p>
                With over 40k users, sending even a single campaign was becoming
                expensive with MailChimp. I knew AWS SES would be much cheaper,
                but it’s just an API with none of the other necessities you need
                for a robust email marketing platform.
              </p>
              <p>
                Beyond cost, I was also frustrated with having to make sure my
                database was always in sync with MailChimp and the audience
                schema they enforced. If I wanted to email every user who had
                completed 10 solves, that would be a whole ordeal and eat up
                hours of my day.
              </p>
              <p>So, I started (and am now launching):</p>
              <p><a href="https://cc.dev">https://cc.dev</a></p>
              <p>
                cc.dev connects directly to your database and lets you write SQL
                queries to target your audience. It's backed by AWS SES, so the
                cost to send emails is significantly less than what you're used
                to seeing. Combined with a template builder, media management,
                and campaign monitoring, cc.dev is meant to be your final
                destination whenever you need to send marketing emails to your
                users.
              </p>
              <p>
                Would love to hear your feedback on this! If you're interested
                in trying out cc.dev as your email marketing platform, shoot me
                an email and let's have a chat: kash at cc.dev
              </p>
            </div>
          </section>
        </section>
        <section id="36836358">
          <h3>
            <a
              class="item"
              href="https://www.maths.ed.ac.uk/~tl/genova/genova_talk.pdf"
              >An invariant from category theory solves a problem in
              mathematical ecology [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 15:39:38</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36836358"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36836258">
          <h3>
            <a
              class="item"
              href="https://phoenixonrails.com/blog/elixir-for-ruby-developers-the-three-most-important-differences"
              >Elixir for Ruby developers: the three most important
              differences</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 15:29:35</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36836258"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36835735">
          <h3>
            <a
              class="item"
              href="https://www.loudersound.com/features/what-happened-the-night-an-audience-member-filled-in-for-keith-moon"
              >The night an audience member filled in for Keith Moon (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-23 @ 14:38:22</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36835735"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36825496">
          <h3>
            <a
              class="item"
              href="https://www.newyorker.com/magazine/2013/04/29/draft-no-4"
              >Draft No. 4 (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-22 @ 12:02:13</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36825496"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36824236">
          <h3>
            <a
              class="item"
              href="https://www.nationalgeographic.com/premium/article/cheetahs-died-india-relocation-africa-conservation"
              >Cheetahs have come back to India. Why do they keep dying?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-22 @ 07:39:32</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36824236"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36822542">
          <h3>
            <a
              class="item"
              href="http://evanfarrer.blogspot.com/2012/06/unit-testing-isnt-enough-you-need.html"
              >Analysis of whether unit testing obviates static type checking
              (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-22 @ 02:20:37</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36822542"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36822484">
          <h3>
            <a
              class="item"
              href="https://medicalxpress.com/news/2023-07-reveals-scale-disorder-underpinning-motor.html"
              >Research reveals the scale of disorder underpinning motor neuron
              disease</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-22 @ 02:10:40</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36822484"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36822329">
          <h3>
            <a
              class="item"
              href="https://fgiesen.wordpress.com/2023/07/21/computational-complexity-of-texture-encoding/"
              >Computational Complexity of Texture Encoding</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-22 @ 01:40:32</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36822329"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36821951">
          <h3>
            <a class="item" href="https://jcs.org/2023/07/12/api"
              >Advice for Operating a Public-Facing API</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-22 @ 00:36:29</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36821951"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36821808">
          <h3>
            <a
              class="item"
              href="https://www.invisibleoranges.com/death-metal-english/"
              >Death Metal English (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-22 @ 00:15:32</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36821808"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36821123">
          <h3>
            <a
              class="item"
              href="https://hakaimagazine.com/news/stone-walls-and-historical-harbors-are-unexpected-havens-of-biodiversity/"
              >Stone Walls and Historical Harbors Are Unexpected Havens of
              Biodiversity</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 22:58:59</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36821123"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36820544">
          <h3>
            <a class="item" href="https://github.com/nats-io/nats-server"
              >High-Performance server for NATS.io, the cloud and edge native
              messaging system</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-21 @ 22:04:57</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36820544"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
