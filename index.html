<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40986894">
          <h3>
            <a class="item" href="https://matt.sh/panic-at-the-job-market"
              >Panic at the Tech Job Market</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-17 @ 15:25:11</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40986894"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40986876">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2024-07-15/how-bad-amazon-review-destroyed-beau-belle-littles-swim-diaper-business"
              >Amazon Sold a Used Diaper. It Tanked a Mom-and-Pop Business</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-17 @ 15:23:09</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40986876"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40986705">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/business/energy/many-us-solar-factories-are-lagging-except-those-china-owns-2024-07-17/"
              >Many US solar factories are lagging. Except those China owns</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-17 @ 15:04:31</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40986705"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40986261">
          <h3>
            <a
              class="item"
              href="https://restofworld.org/2024/bhutan-first-ai-startup/"
              >Bhutan's first AI startup is seven college kids in a dorm</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-17 @ 14:21:26</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40986261"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40986213">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2024/7/16/24199686/puerto-rico-fossil-fuel-industry-lawsuit-climate-change"
              >Puerto Rico files $1B suit against fossil fuel companies</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-17 @ 14:16:38</span
              ><span class="points-container"
                >Points: <span class="points">145</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40986213"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40986181">
          <h3>
            <a
              class="item"
              href="https://lookout.co/tom-lehrer-and-santa-cruz-sleuthing-the-trail-of-one-of-americas-premier-satirists/"
              >Tom Lehrer and Santa Cruz: the trail of one of America's premier
              satirists</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-17 @ 14:13:39</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40986181"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40985609">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40985609"
              >Launch HN: Traceloop (YC W23) – Detecting LLM Hallucinations with
              OpenTelemetry</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-17 @ 13:19:03</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40985609"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.traceloop.com">https://www.traceloop.com</a
              >). We help teams understand when their LLM apps are failing or
              hallucinating at scale. See a demo:
              <a href="https://www.traceloop.com/video"
                >https://www.traceloop.com/video</a
              >
              or try it yourself at
              <a href="https://www.traceloop.com/docs/demo"
                >https://www.traceloop.com/docs/demo</a
              >.
              <p>
                When moving your LLM app to production, significant scale makes
                it harder for engineers and data scientists alike to understand
                when their LLM is hallucinating or returning malformed
                responses. When you get to millions of calls to OpenAI a month,
                methods like “LLM as a judge” can’t work at a reasonable cost or
                latency. So, what most people we talked to usually do is sample
                some generations by hand, maybe for some specific important
                customers, and manually look for errors or hallucinations.
              </p>
              <p>
                Traceloop is a monitoring platform that detects when your LLM
                app fails. Under the hood, we built real-time versions of known
                metrics like faithfulness, relevancy, redundancy, and many
                others. These are loosely based on some well-known NLP metrics
                that work well for LLM-generated texts. We correlate them with
                changes we detect in your system - like updates to prompts or to
                the model you’re using - to detect regressions automatically.
              </p>
              <p>Here are some cool examples we’ve seen with our customers -</p>
              <p>
                1. Applying our QA relevancy metric to an entity extraction
                task, we managed to discover issues where the model was not
                extracting the right entities (like an address instead of a
                person’s name); or returning random answers like “I’m here! What
                can I help you with today?”.
              </p>
              <p>
                2. Our soft-faithfulness metric was able to detect cases in
                summarization tasks where a model was completely making up stuff
                that never appeared in the original text.
              </p>
              <p>
                One of the challenges we faced was figuring out how to collect
                the data that we need from our customers' LLM apps. That’s where
                OpenTelemetry came in handy. We built OpenLLMetry (<a
                  href="https://github.com/traceloop/openllmetry"
                  >https://github.com/traceloop/openllmetry</a
                >), and announced it here almost a year ago. It standardized the
                use of OpenTelemetry to observe LLM apps. We realized that the
                concepts of traces, spans, metrics, and logs that were
                standardized with OpenTelemetry can easily extend to gen AI. We
                partnered with 20+ observability platforms to make sure that
                OpenLLMetry becomes the standard for GenAI observability and
                that the data that we collect can be sent to other platforms as
                well.
              </p>
              <p>
                We plan to extend the metrics we provide to support agents that
                use tools, vision models, and other amazing developments in our
                fast-paced industry.
              </p>
              <p>
                We invite you to give Traceloop a spin and are eager for your
                feedback! How do you track and debug hallucinations? How much
                has that been an issue for you? What types of hallucinations
                have you encountered?
              </p>
            </div>
          </section>
        </section>
        <section id="40985433">
          <h3>
            <a
              class="item"
              href="https://dalpix.com/reverse-engineering-ip-camera-part-1"
              >Reverse-Engineering an IP Camera</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-17 @ 13:02:19</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40985433"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40985285">
          <h3>
            <a
              class="item"
              href="https://twitter.com/Dr_CSWright/status/1813547003676164132"
              >Pinned Tweet Ordered by UK Court – Craig Wright Not Satoshi
              Nakamoto</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-17 @ 12:47:49</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40985285"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40983734">
          <h3>
            <a
              class="item"
              href="https://www.justinmath.com/the-greatest-educational-life-hack-learning-math-ahead-of-time/"
              >The Greatest Educational Life Hack: Learning Math Ahead of
              Time</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-17 @ 08:46:55</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40983734"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40983328">
          <h3>
            <a class="item" href="https://pippy.dev/"
              >Show HN: Pippy – Pipelines for GitHub Actions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-17 @ 07:17:23</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40983328"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
            <div class="text">
              <p>
                Cloud version:
                <a href="https://app.pippy.dev/login"
                  >https://app.pippy.dev/login</a
                >
                (closed beta) I am also open sourcing command line version:
                <a href="https://github.com/nixmade/pippy"
                  >https://github.com/nixmade/pippy</a
                >.
              </p>
              <p>Key features:</p>
              <p>- Automatic Rollback</p>
              <p>- Datadog Monitoring</p>
              <p>- Pause/Resume</p>
              <p>The product is built using open source orchestrator.</p>
              <p>
                Orchestrator:
                <a href="https://github.com/nixmade/orchestrator"
                  >https://github.com/nixmade/orchestrator</a
                >
              </p>
              <p>
                Orchestrator allows you to orchestrate rollout to specific set
                of targets and provide monitoring capabilities to optionally
                rollback. I hope to provide Cloud API so platforms can
                orchestrate updates using the framework.
              </p>
              <p>Tech stack:</p>
              <p>Database: Postgres</p>
              <p>Backend: Golang</p>
              <p>Frontend: React + Shadcn UI</p>
              <p>Cloud: Azure container apps</p>
              <p>
                Please leave your feedback in comments. Hope you can give the
                command line version a try, and sign up for beta of the cloud
                version.
              </p>
            </div>
          </section>
        </section>
        <section id="40982712">
          <h3>
            <a
              class="item"
              href="https://lareviewofbooks.org/article/the-last-avant-garde/"
              >The Last Avant-Garde</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-17 @ 05:00:16</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40982712"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40982118">
          <h3>
            <a
              class="item"
              href="https://workspaceupdates.googleblog.com/2024/07/import-and-export-markdown-in-google-docs.html"
              >Import and Export Markdown in Google Docs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-17 @ 02:44:51</span
              ><span class="points-container"
                >Points: <span class="points">442</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40982118"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40981068">
          <h3>
            <a class="item" href="https://vedgie.net/writing/darwin_machines.md"
              >Darwin Machines</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-16 @ 22:54:26</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40981068"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40981067">
          <h3>
            <a
              class="item"
              href="https://www.mailgun.com/blog/email/ai-phishing/"
              >The golden age of scammers: AI-powered phishing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-16 @ 22:54:26</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40981067"
                  >Comments</a
                ><span class="descendants">: 108</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40980901">
          <h3>
            <a
              class="item"
              href="https://papers.put.as/papers/macosx/2005/Hacking-Mac-OS-X-Kernel-for-unsupported-machines.pdf"
              >Hacking the Mac OS X Kernel for Unsupported Machines (2005)
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-16 @ 22:26:39</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40980901"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40980715">
          <h3>
            <a class="item" href="https://github.com/guywaldman/magic-cli"
              >Show HN: Magic-cli – A copilot for your command line</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-16 @ 21:58:21</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40980715"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
            <div class="text">
              <a href="https://guywaldman.com/posts/introducing-magic-cli"
                >https://guywaldman.com/posts/introducing-magic-cli</a
              >
            </div>
          </section>
        </section>
        <section id="40980289">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/sync-labs/jobs/CrRfnKu-founding-staff-engineer"
              >Sync Labs (YC W24) Is Hiring a Staff Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-16 @ 21:00:55</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40978831">
          <h3>
            <a class="item" href="https://austinhenley.com/blog/bignum2.html"
              >Optimizing a bignum library for fun</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-16 @ 18:08:58</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40978831"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40978731">
          <h3>
            <a
              class="item"
              href="https://twitter.com/karpathy/status/1813263734707790301"
              >I am starting an AI+Education company</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-16 @ 17:57:35</span
              ><span class="points-container"
                >Points: <span class="points">825</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40978731"
                  >Comments</a
                ><span class="descendants">: 482</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40978670">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/article/vulnerable-transistors-threaten-upend-europa-clipper-mission"
              >Vulnerable transistors threaten to upend Europa Clipper
              mission</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-16 @ 17:50:13</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40978670"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40978372">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2407.10240"
              >XLSTMTime: Long-Term Time Series Forecasting with xLSTM</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-16 @ 17:14:47</span
              ><span class="points-container"
                >Points: <span class="points">209</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40978372"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40978073">
          <h3>
            <a
              class="item"
              href="https://neilzone.co.uk/2024/07/attempting-to-stop-microsoft-users-sending-reactions-to-email-from-me-by-adding-a-postfix-header/"
              >Stop Microsoft users sending 'reactions' to email by adding a
              postfix header</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-16 @ 16:38:07</span
              ><span class="points-container"
                >Points: <span class="points">342</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40978073"
                  >Comments</a
                ><span class="descendants">: 293</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40977103">
          <h3>
            <a class="item" href="https://mistral.ai/news/codestral-mamba/"
              >Codestral Mamba</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-16 @ 14:44:46</span
              ><span class="points-container"
                >Points: <span class="points">449</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40977103"
                  >Comments</a
                ><span class="descendants">: 132</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40976474">
          <h3>
            <a
              class="item"
              href="https://wadetregaskis.com/nscopyobject-the-griefer-that-keeps-on-griefing/"
              >NSCopyObject, the griefer that keeps on griefing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-16 @ 13:34:07</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40976474"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40971759">
          <h3>
            <a
              class="item"
              href="https://www.alexmolas.com/2024/07/15/fantasy-knapsack.html"
              >Win your fantasy league using operations research</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-15 @ 21:48:28</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40971759"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40959140">
          <h3>
            <a
              class="item"
              href="https://www.infoq.com/articles/java-virtual-threads-a-case-study/"
              >Java Virtual Threads: A Case Study</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-14 @ 05:52:39</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40959140"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40954571">
          <h3>
            <a
              class="item"
              href="https://www.justinmath.com/individualized-spaced-repetition-in-hierarchical-knowledge-structures/"
              >Individualized Spaced Repetition in Hierarchical Knowledge
              Structures</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-13 @ 15:13:07</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40954571"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40949489">
          <h3>
            <a
              class="item"
              href="https://www.notion.so/blog/how-we-sped-up-notion-in-the-browser-with-wasm-sqlite"
              >How we sped up Notion in the browser with WASM SQLite</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-12 @ 21:11:41</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40949489"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40946165">
          <h3>
            <a
              class="item"
              href="https://lcamtuf.substack.com/p/the-101-of-analog-signal-filtering"
              >Of Analog Signal Filtering</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-07-12 @ 14:54:55</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40946165"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
