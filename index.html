<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36501742">
          <h3>
            <a class="item" href="https://github.com/misprit7/computerraria"
              >Computerraria: A fully compliant RISC-V computer inside
              Terraria</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-28 @ 03:00:48</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36501742"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36501657">
          <h3>
            <a
              class="item"
              href="https://astralcodexten.substack.com/p/every-flashing-element-on-your-site"
              >Every flashing element on your site alienates and enrages
              users</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-28 @ 02:46:45</span
              ><span class="points-container"
                >Points: <span class="points">112</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36501657"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36501548">
          <h3>
            <a
              class="item"
              href="https://cohost.org/tef/post/1764930-how-not-to-write-a"
              >How not to write a pipeline</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-28 @ 02:24:00</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36501548"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36501364">
          <h3>
            <a class="item" href="https://muhammadraza.me/2022/data-oneliners/"
              >Working with CSV files on shell/terminal</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-28 @ 01:58:33</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36501364"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36501209">
          <h3>
            <a class="item" href="https://www.trinitydesktop.org/"
              >Trinity Desktop Environment – a modern KDE3 fork</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-28 @ 01:38:12</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36501209"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36501194">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2306.09633"
              >The False Dawn: Reevaluating Google's RL for Chip Macro
              Placement</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-28 @ 01:36:31</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36501194"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36500945">
          <h3>
            <a
              class="item"
              href="https://varunshenoy.substack.com/p/natural-language-is-an-unnatural"
              >Natural language is an unnatural interface</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-28 @ 01:04:38</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36500945"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36500448">
          <h3>
            <a
              class="item"
              href="https://www.entrepreneur.com/growing-a-business/the-damaging-results-of-the-mandated-return-to-office-is/454043"
              >Damaging Results of Mandated Return to Office – It's Worse Than
              We Thought</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-28 @ 00:01:23</span
              ><span class="points-container"
                >Points: <span class="points">167</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36500448"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36500294">
          <h3>
            <a
              class="item"
              href="https://vermaden.wordpress.com/2023/06/28/freebsd-jails-containers/"
              >FreeBSD Jails Containers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 23:44:02</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36500294"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36500182">
          <h3>
            <a class="item" href="https://cooklang.org"
              >Cooklang – Recipe Markup Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 23:32:46</span
              ><span class="points-container"
                >Points: <span class="points">100</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36500182"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36500138">
          <h3>
            <a
              class="item"
              href="https://simpleblog.ai/blog/google-ads-can-do-more-for-customers/"
              >Google does little to reduce advertisers costs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 23:27:42</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36500138"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36499905">
          <h3>
            <a
              class="item"
              href="https://www.airgradient.com/blog/hidden-costs-of-air-quality-monitoring/"
              >The hidden cost of air quality monitoring</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 23:02:21</span
              ><span class="points-container"
                >Points: <span class="points">255</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36499905"
                  >Comments</a
                ><span class="descendants">: 124</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36499498">
          <h3>
            <a
              class="item"
              href="https://venturebeat.com/ai/hugging-face-ceo-tells-us-house-open-source-ai-is-extremely-aligned-with-american-interests/"
              >Open Source AI Is Critical – Hugging Face CEO Before US
              Congress</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 22:21:27</span
              ><span class="points-container"
                >Points: <span class="points">173</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36499498"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36499073">
          <h3>
            <a
              class="item"
              href="https://blogs.nvidia.com/blog/2023/06/27/generative-ai-debut-mlperf/"
              >H100 GPUs Set Standard for Gen AI in Debut MLPerf Benchmark</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 21:43:09</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36499073"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36498592">
          <h3>
            <a class="item" href="https://jobs.lever.co/buildzoom"
              >BuildZoom (better way to build custom homes) Is hiring a Growth
              Associate</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 21:00:36</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36498484">
          <h3>
            <a class="item" href="https://github.com/tinycorelinux/tinyx"
              >Tinyx – resurrected Xvesa from the depths of Git history</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 20:53:45</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36498484"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36498321">
          <h3>
            <a class="item" href="https://www.val.town/v/stevekrouse.easyAQI"
              >EasyAQI – API Wrapper over Nominatim and OpenAQ</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 20:38:39</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36498321"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36498107">
          <h3>
            <a class="item" href="https://github.com/susam/emacs4cl"
              >Emacs4CL: A DIY kit to set up vanilla Emacs for Common Lisp
              programming</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 20:18:32</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36498107"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36497798">
          <h3>
            <a
              class="item"
              href="https://twitter.com/historyinmemes/status/1673569802022010880"
              >Sears offered complete houses in large DIY kits</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 19:52:03</span
              ><span class="points-container"
                >Points: <span class="points">181</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36497798"
                  >Comments</a
                ><span class="descendants">: 181</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36497732">
          <h3>
            <a
              class="item"
              href="https://www.marksimonson.com/notebook/view/pre-digital-font-tech-no-1-formatt"
              >Pre-Digital Font Tech: Formatt</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 19:46:08</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36497732"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36497613">
          <h3>
            <a
              class="item"
              href="https://github.com/getlago/lago/wiki/Is-ORM-still-an-%27anti-pattern%27%3F"
              >Is ORM still an anti-pattern?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 19:36:07</span
              ><span class="points-container"
                >Points: <span class="points">186</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36497613"
                  >Comments</a
                ><span class="descendants">: 364</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36496693">
          <h3>
            <a
              class="item"
              href="https://www.networkworld.com/article/3700616/cisco-to-buy-network-monitoring-firm-samknows-for-better-last-mile-visibility.html"
              >Cisco to buy network-monitoring firm SamKnows for better
              last-mile visibility</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 18:20:02</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36496693"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36496691">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=xFKFoGiGlXQ"
              >Finding the best sine function for Nintendo 64 [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 18:20:01</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36496691"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36495740">
          <h3>
            <a class="item" href="https://store.arduino.cc/pages/uno-r4"
              >Arduino Uno R4</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 17:04:54</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36495740"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36495335">
          <h3>
            <a
              class="item"
              href="https://martinfowler.com/articles/patterns-of-distributed-systems/"
              >Patterns of Distributed Systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 16:43:12</span
              ><span class="points-container"
                >Points: <span class="points">174</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36495335"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36494966">
          <h3>
            <a
              class="item"
              href="https://www.caltech.edu/about/news/new-bioinspired-robot-flies-rolls-walks-and-more"
              >Caltech M4 Robot Flies, Rolls, Walks, and More</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 16:19:58</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36494966"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36494935">
          <h3>
            <a class="item" href="https://zellij.dev/news/new-plugin-system/"
              >Zellij New WASM Plugin System</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 16:17:40</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36494935"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36494639">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36494639"
              >Launch HN: Fuse (YC W19) – Unified API for financial data
              aggregators</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 15:56:41</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36494639"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
            <div class="text">
              <a href="https://www.letsfuse.com/">https://www.letsfuse.com/</a
              >). We offer a single integration to multiple financial data
              aggregators and automatically select the most reliable one for
              each institution. Here’s a quick demo:
              <a href="https://youtu.be/w7sNHGav0Fg"
                >https://youtu.be/w7sNHGav0Fg</a
              >
              <p>
                If you're building a product that requires customers to link
                their financial accounts, you might integrate a financial data
                aggregator (such as Plaid, Truelayer, or Finicity) to connect
                with your user's bank account. You’ll probably then experience
                the following issues: customers unable to use your product
                because their financial institution is not supported (e.g.,
                credit unions, local or community banks); frequent
                disconnections; API errors; and high drop-offs during the bank
                linking flow.
              </p>
              <p>
                We spent 2.5 years developing YSplit, a fintech app providing
                joint spending cards for couples. Users linked their bank
                accounts for spend limits but faced issues with unsupported
                banks and frequent disconnections. We looked at other apps and
                saw that the ideal solution was to rely on multiple aggregators,
                but it wasn’t the right use of engineering resources for that
                startup. Upon pivoting from YSplit, though, we decided to go
                back to that problem and address it.
              </p>
              <p>
                We provide a UI component for React, React Native, Flutter, iOS
                &amp; Android native to facilitate bank account linkage within
                your app. When a user taps on an institution, we use a time
                series model to identify the most optimal aggregator to show
                based on historical success rates and disconnection as well as
                downtime. After linkage, we provide a Fuse access token for
                querying balance, transactions, and more via our unified API,
                offering a consistent model irrespective of the aggregator.
              </p>
              <p>
                We also provide other products to translate historical bank data
                into consumer/business credit risk to help you answer questions
                like: How much credit can I feel comfortable offering this user
                or company? Is a user likely to pay me on time? Can I offer
                instant ACH to this customer?
              </p>
              <p>
                By combining aggregators, you gain from their diverse connection
                methods, favoring APIs over screen scraping. Our customers have
                cut disconnections by 16%, increased coverage by 5k institutions
                in the US, and boosted conversions by 20% with Fuse. Moreover,
                we support aggregators in Africa, Europe, South America,
                Australia, and Asia, enabling global product expansion with a
                single API.
              </p>
              <p>
                We don't store personal info and only act as a pass-through. We
                are currently undergoing SOC 2 II audit and can provide
                engagement letters for anyone looking to go to production.
              </p>
              <p>
                We have a self-serve onboarding
                <a href="https://dashboard.letsfuse.com"
                  >https://dashboard.letsfuse.com</a
                >
                to get sandbox keys. Our docs are available here
                <a href="https://docs.letsfuse.com">https://docs.letsfuse.com</a
                >. We’d love for you to try it and give us feedback on
                improvements to the product and docs. If you have any feature
                requests or any aggregators you’d like us to support, let us
                know.
              </p>
            </div>
          </section>
        </section>
        <section id="36493715">
          <h3>
            <a class="item" href="https://neal.fun/password-game/"
              >The Password Game</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 14:51:22</span
              ><span class="points-container"
                >Points: <span class="points">782</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36493715"
                  >Comments</a
                ><span class="descendants">: 320</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36491704">
          <h3>
            <a class="item" href="https://saurabhs.org/advanced-macos-commands"
              >macOS command-line tools you might not know about</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 12:08:38</span
              ><span class="points-container"
                >Points: <span class="points">1653</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36491704"
                  >Comments</a
                ><span class="descendants">: 384</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
