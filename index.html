<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="43719522">
          <h3>
            <a class="item" href="https://www.easypost.com/careers"
              >EasyPost (YC S13) Is Hiring</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 17:01:11</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43719447">
          <h3>
            <a class="item" href="https://github.com/coder/agentapi"
              >Show HN: AgentAPI – HTTP API for Claude Code, Goose, Aider, and
              Codex</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 16:54:58</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43719447"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43719211">
          <h3>
            <a
              class="item"
              href="https://garrisonlovely.substack.com/p/breaking-top-openai-catastrophic"
              >Top OpenAI Catastrophic Risk Official Steps Down Abruptly</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 16:37:04</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43719211"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43717705">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2025/04/17/technology/google-ad-tech-antitrust-ruling.html"
              >Google Is a Monopolist in Online Advertising Tech, Judge Says</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 14:47:46</span
              ><span class="points-container"
                >Points: <span class="points">295</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43717705"
                  >Comments</a
                ><span class="descendants">: 140</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43717606">
          <h3>
            <a
              class="item"
              href="https://sharpletters.net/2025/04/16/hdr-emoji/"
              >HDR‑Infused Emoji</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 14:42:07</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43717606"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43717377">
          <h3>
            <a
              class="item"
              href="https://techxplore.com/news/2025-04-stainless-steel-technique-submicron-anti.html"
              >Stainless steel strengthened: Twisting creates submicron
              'anti-crash wall'</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 14:28:07</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43717377"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43716939">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/massive-blue-overwatch-ai-personas-police-suspects/"
              >This 'College Protester' Isn't Real. It's an AI-Powered
              Undercover Bot for Cops</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 13:57:09</span
              ><span class="points-container"
                >Points: <span class="points">176</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43716939"
                  >Comments</a
                ><span class="descendants">: 158</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43716526">
          <h3>
            <a
              class="item"
              href="https://nvd.nist.gov/vuln/detail/CVE-2025-32433"
              >Unauthenticated Remote Code Execution in Erlang/OTP SSH</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 13:29:44</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43716526"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43716293">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/science/scientists-find-strongest-evidence-yet-life-an-alien-planet-2025-04-16/"
              >Scientists find strongest evidence yet of life on an alien
              planet</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 13:11:21</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43716293"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43716058">
          <h3>
            <a
              class="item"
              href="https://maknee.github.io/blog/2025/3FS-Performance-Journal-1/"
              >An Intro to DeepSeek's Distributed File System</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 12:50:37</span
              ><span class="points-container"
                >Points: <span class="points">285</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43716058"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43715235">
          <h3>
            <a
              class="item"
              href="https://www.feldera.com/blog/cutting-down-rust-compile-times-from-30-to-2-minutes-with-one-thousand-crates"
              >Cutting down Rust compile times from 30 to 2 minutes with one
              thousand crates</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 11:22:17</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43715235"
                  >Comments</a
                ><span class="descendants">: 61</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43714902">
          <h3>
            <a class="item" href="https://nickjones.tech/ai-watching-rugby/"
              >Building an AI That Watches Rugby</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 10:18:43</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43714902"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43714619">
          <h3>
            <a
              class="item"
              href="https://www.tokyoweekender.com/art_and_culture/japanese-culture/oda-ujiharu-the-weakest-samurai-warlord/"
              >Why Japan's "Weakest Samurai Warlord" Is Still Admired to This
              Day</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 09:30:43</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43714619"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43714594">
          <h3>
            <a class="item" href="http://uniforumchicago.org/slides/bash1.pdf"
              >Advanced Shell Scripting with Bash (2006) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 09:26:45</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43714594"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43714041">
          <h3>
            <a
              class="item"
              href="https://buttondown.com/hillelwayne/archive/the-halting-problem-is-a-terrible-example-of-np/"
              >The Halting Problem is a terrible example of NP-Harder</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 07:34:08</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43714041"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43714004">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2504.12285"
              >BitNet b1.58 2B4T Technical Report</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 07:27:11</span
              ><span class="points-container"
                >Points: <span class="points">88</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43714004"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43713524">
          <h3>
            <a
              class="item"
              href="https://www.windytan.com/2025/04/passing-planes-and-other-whoosh-sounds.html"
              >Passing planes and other whoosh sounds</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 05:53:31</span
              ><span class="points-container"
                >Points: <span class="points">163</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43713524"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43713140">
          <h3>
            <a class="item" href="https://thenumb.at/Autodiff/"
              >Differentiable Programming from Scratch</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 04:30:47</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43713140"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43711957">
          <h3>
            <a class="item" href="https://status.zoom.us/incidents/pw9r9vnq5rvk"
              >Zoom outage caused by accidental 'shutting down' of the zoom.us
              domain</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-17 @ 00:55:49</span
              ><span class="points-container"
                >Points: <span class="points">559</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43711957"
                  >Comments</a
                ><span class="descendants">: 263</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43710576">
          <h3>
            <a class="item" href="https://github.com/plandex-ai/plandex"
              >Show HN: Plandex v2 – open source AI coding agent for large
              projects and tasks</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-16 @ 21:26:42</span
              ><span class="points-container"
                >Points: <span class="points">221</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43710576"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/plandex-ai/plandex"
                >https://github.com/plandex-ai/plandex</a
              >), an open source AI coding agent focused especially on tackling
              large tasks in real world software projects.
              <p>
                You can watch a 2 minute demo of Plandex in action here:
                <a href="https://www.youtube.com/watch?v=SFSu2vNmlLk"
                  >https://www.youtube.com/watch?v=SFSu2vNmlLk</a
                >
              </p>
              <p>
                And here’s more of a tutorial style demo showing how Plandex can
                automatically debug a browser application:
                <a href="https://www.youtube.com/watch?v=g-_76U_nK0Y"
                  >https://www.youtube.com/watch?v=g-_76U_nK0Y</a
                >.
              </p>
              <p>
                I launched Plandex v1 here on HN a little less than a year ago
                (<a href="https://news.ycombinator.com/item?id=39918500"
                  >https://news.ycombinator.com/item?id=39918500</a
                >).
              </p>
              <p>
                Now I’m launching a major update, Plandex v2, which is the
                result of 8 months of heads down work, and is in effect a whole
                new project/product.
              </p>
              <p>
                In short, Plandex is now a top-tier coding agent with fully
                autonomous capabilities. It combines models from Anthropic,
                OpenAI, and Google to achieve better results, more reliable
                agent behavior, better cost efficiency, and better performance
                than is possible by using only a single provider’s models.
              </p>
              <p>
                I believe it is now one of the best tools available for working
                on large tasks in real world codebases with AI. It has an
                effective context window of 2M tokens, and can index projects of
                20M tokens and beyond using tree-sitter project maps (30+
                languages are supported). It can effectively find relevant
                context in massive million-line projects like SQLite, Redis, and
                Git.
              </p>
              <p>A bit more on some of Plandex’s key features:</p>
              <p>
                - Plandex has a built-in diff review sandbox that helps you get
                the benefits of AI without leaving behind a mess in your
                project. By default, all changes accumulate in the sandbox until
                you approve them. The sandbox is version-controlled. You can
                rewind it to any previous point, and you can also create
                branches to try out alternative approaches.
              </p>
              <p>
                - It offers a ‘full auto mode’ that can complete large tasks
                autonomously end-to-end, including high level planning, context
                loading, detailed planning, implementation, command execution
                (for dependencies, builds, tests, etc.), and debugging.
              </p>
              <p>
                - The autonomy level is highly configurable. You can move up and
                down the ladder of autonomy depending on the task, your comfort
                level, and how you weigh cost optimization vs. effort and
                results.
              </p>
              <p>
                - Models and model settings are also very configurable. There
                are built-in models and model packs for different use cases. You
                can also add custom models and model packs, and customize model
                settings like temperature or top-p. All model changes are
                version controlled, so you can use branches to try out the same
                task with different models. The newly released OpenAI models and
                the paid Gemini 2.5 Pro model will be integrated in the default
                model pack soon.
              </p>
              <p>
                - It can be easily self-hosted, including a ‘local mode’ for a
                very fast local single-user setup with Docker.
              </p>
              <p>
                - Cloud hosting is also available for added convenience with a
                couple of subscription tiers: an ‘Integrated Models’ mode that
                requires no other accounts or API keys and allows you to manage
                billing/budgeting/spending alerts and track usage centrally, and
                a ‘BYO API Key’ mode that allows you to use your own
                OpenAI/OpenRouter accounts.
              </p>
              <p>
                I’d love to get more HNers in the Plandex Discord (<a
                  href="https://discord.gg/plandex-ai"
                  >https://discord.gg/plandex-ai</a
                >). Please join and say hi!
              </p>
              <p>
                And of course I’d love to hear your feedback, whether positive
                or negative. Thanks so much!
              </p>
            </div>
          </section>
        </section>
        <section id="43708025">
          <h3>
            <a class="item" href="https://github.com/openai/codex"
              >OpenAI Codex CLI: Lightweight coding agent that runs in your
              terminal</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-16 @ 17:24:50</span
              ><span class="points-container"
                >Points: <span class="points">489</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43708025"
                  >Comments</a
                ><span class="descendants">: 261</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43706037">
          <h3>
            <a
              class="item"
              href="https://theappendix.net/posts/2014/02/darwins-children-drew-vegetable-battles-on-the-origin-of-species"
              >Darwin's children drew all over the “On the Origin of Species”
              manuscript (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-16 @ 14:28:36</span
              ><span class="points-container"
                >Points: <span class="points">463</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43706037"
                  >Comments</a
                ><span class="descendants">: 122</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43697717">
          <h3>
            <a
              class="item"
              href="https://knightcolumbia.org/content/ai-as-normal-technology"
              >AI as Normal Technology</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-15 @ 20:05:07</span
              ><span class="points-container"
                >Points: <span class="points">142</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43697717"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43692746">
          <h3>
            <a
              class="item"
              href="https://www.tdk.com/en/about_tdk/innovation/spin-photo-detector/index.html"
              >Ultrafast Optical Detector</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-15 @ 13:56:32</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43692746"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43691230">
          <h3>
            <a
              class="item"
              href="https://github.com/pydantic/pydantic-ai/tree/main/mcp-run-python"
              >MCP Run Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-15 @ 11:09:30</span
              ><span class="points-container"
                >Points: <span class="points">58</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43691230"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43682207">
          <h3>
            <a class="item" href="https://github.com/ktr0731/go-mcp"
              >A type-safe, intuitive Go SDK for building MCP servers with ease
              and confidence</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 15:14:28</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43682207"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43679906">
          <h3>
            <a
              class="item"
              href="https://bitbashing.io/haskell-concurrency.html"
              >Concurrency in Haskell: Fast, Simple, Correct</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 10:47:32</span
              ><span class="points-container"
                >Points: <span class="points">170</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43679906"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43679065">
          <h3>
            <a class="item" href="https://ysymyth.github.io/The-Second-Half/"
              >The Second Half</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 07:57:02</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43679065"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43678144">
          <h3>
            <a class="item" href="https://www.makingsoftware.com/"
              >Making Software</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 04:48:54</span
              ><span class="points-container"
                >Points: <span class="points">427</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43678144"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="43678138">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41586-024-08165-7"
              >Adipose tissue retains an epigenetic memory of obesity after
              weight loss</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-04-14 @ 04:47:51</span
              ><span class="points-container"
                >Points: <span class="points">170</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=43678138"
                  >Comments</a
                ><span class="descendants">: 208</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
