<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40599522">
          <h3>
            <a
              class="item"
              href="https://spacenews.com/starship-survives-reentry-during-fourth-test-flight/"
              >Starship survives reentry during fourth test flight</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 16:42:43</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40599522"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40599248">
          <h3>
            <a
              class="item"
              href="https://twitter.com/ultrabrilliant/status/1798470587230171369"
              >Prime Video uses obviously AI-generated movie thumbnails</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 16:20:04</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40599248"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40599172">
          <h3>
            <a
              class="item"
              href="https://insideclimatenews.org/news/09022024/climate-impacts-from-collapse-of-atlantic-meridional-overturning-current-could-be-worse-than-expected/"
              >Extreme Climate Impacts from Collapse of AMOC Could Be Worse Than
              Expected</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 16:14:22</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40599172"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40599018">
          <h3>
            <a class="item" href="https://qwenlm.github.io/blog/qwen2/"
              >Qwen2 LLM Released</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 16:01:13</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40599018"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40598629">
          <h3>
            <a class="item" href="https://github.com/hackerb9/lsix"
              >lsix: Like "ls", but for images</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 15:29:56</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40598629"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40598393">
          <h3>
            <a
              class="item"
              href="https://bugzilla.mozilla.org/show_bug.cgi?id=330884"
              >Firefox "Bug" Leaked Saved Logins Across Profiles and Caused
              Break Up (2005)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 15:12:25</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40598393"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40598353">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/articles/c3gg580p3kjo"
              >The secret D-Day scientists and engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 15:10:12</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40598353"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40597503">
          <h3>
            <a
              class="item"
              href="https://link.springer.com/article/10.1007/s13347-023-00616-9"
              >The Right Not to Be Subjected to AI Profiling Based on Publicly
              Available Data</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 14:03:17</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40597503"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40597402">
          <h3>
            <a class="item" href="https://gamemath.com/"
              >3D Math Primer for Graphics and Game Development</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 13:54:19</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40597402"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40597249">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/history/martha-gellhorn-was-the-only-woman-to-report-on-the-d-day-landings-from-the-ground-180984456/"
              >Martha Gellhorn – The Only Woman to Report on the D-Day Landings
              from the Ground</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 13:35:24</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40597249"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40597216">
          <h3>
            <a
              class="item"
              href="https://www.openculture.com/2024/06/the-roads-of-ancient-rome-visualized-in-modern-subway-maps.html"
              >The Roads of Ancient Rome Visualized in the Style of Modern
              Subway Maps</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 13:32:36</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40597216"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40596711">
          <h3>
            <a class="item" href="https://github.com/potamides/DeTikZify"
              >Show HN: Synthesize TikZ Graphics Programs for Scientific Figures
              and Sketches</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 12:42:13</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40596711"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
            <div class="text">
              Creating high-quality scientific figures can be time-consuming and
              challenging, even though sketching ideas on paper is relatively
              easy. Furthermore, recreating existing figures that are not stored
              in formats preserving semantic information is equally complex. To
              tackle this problem, we introduce DeTikZify, a novel multimodal
              language model that automatically synthesizes scientific figures
              as semantics-preserving TikZ graphics programs based on sketches
              and existing figures. We also introduce a Monte Carlo Tree
              Search-based inference algorithm that enables DeTikZify to
              iteratively refine its outputs without the need for additional
              training.
            </div>
          </section>
        </section>
        <section id="40596689">
          <h3>
            <a class="item" href="https://github.com/nikitabobko/AeroSpace"
              >AeroSpace is an i3-like tiling window manager for macOS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 12:39:01</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40596689"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40596578">
          <h3>
            <a
              class="item"
              href="https://www.worldatlas.com/geology/how-much-water-is-in-earth-s-crust.html"
              >How Much Water Is in Earth's Crust? Over 10.5M Cubic Miles</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 12:22:48</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40596578"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40596386">
          <h3>
            <a
              class="item"
              href="https://jobs.ashbyhq.com/permitflow?departmentId=d33195eb-8978-4439-abc6-5a8a072de808"
              >PermitFlow (YC W22) Is Hiring Software Engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 12:01:07</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40595920">
          <h3>
            <a
              class="item"
              href="https://every.to/the-crazy-ones/the-misfit-who-built-the-ibm-pc"
              >Don Estridge: A misfit who built the IBM PC</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 10:55:32</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40595920"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40595741">
          <h3>
            <a class="item" href="https://edw.is/learning-vulkan/"
              >I learned Vulkan and wrote a small game engine with it</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 10:24:23</span
              ><span class="points-container"
                >Points: <span class="points">233</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40595741"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40595499">
          <h3>
            <a
              class="item"
              href="https://geospatial.netlify.app/posts/gds-2024-04-20-cathedrals/"
              >St Michael Sword investigation: Are the 7 Cathedrals on a
              straight line?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 09:48:59</span
              ><span class="points-container"
                >Points: <span class="points">230</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40595499"
                  >Comments</a
                ><span class="descendants">: 159</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40595384">
          <h3>
            <a
              class="item"
              href="https://www.qemu.org/2018/02/09/understanding-qemu-devices/"
              >Understanding QEMU Devices (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 09:33:19</span
              ><span class="points-container"
                >Points: <span class="points">98</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40595384"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40593674">
          <h3>
            <a
              class="item"
              href="https://soranews24.com/2024/05/28/mitsubishi-develops-robot-that-solves-rubiks-cube-style-puzzle-in-0-305-seconds%e3%80%90video%e3%80%91/"
              >Mitsubishi robot solves Rubik's Cube in 0.305s</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 05:00:25</span
              ><span class="points-container"
                >Points: <span class="points">245</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40593674"
                  >Comments</a
                ><span class="descendants">: 167</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40593540">
          <h3>
            <a
              class="item"
              href="https://mkukri.xyz/2024/06/01/tpm-gpio-fail.html"
              >TPM GPIO fail: How bad OEM firmware ruins Intel TPM security</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 04:34:57</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40593540"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40592998">
          <h3>
            <a
              class="item"
              href="https://lcamtuf.substack.com/p/psa-if-youre-a-fan-of-atmega-try"
              >PSA: If you're a fan of ATmega, try AVR Dx</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 03:03:59</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40592998"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40592789">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/online-privacy"
              >Microsoft AI spying scandal: time to rethink privacy standards</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-06 @ 02:25:25</span
              ><span class="points-container"
                >Points: <span class="points">720</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40592789"
                  >Comments</a
                ><span class="descendants">: 300</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40589852">
          <h3>
            <a
              class="item"
              href="https://www.rugu.dev/en/blog/mark-scroll-positions/"
              >Show HN: Mark Scroll Positions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 20:03:26</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40589852"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
            <div class="text">
              <p>
                I was getting annoyed when I had to leave a page and then needed
                to find where I was when I reopened it each time. So, I have
                just built a web extension to allow users to mark certain scroll
                positions for a page and then jump between them.
              </p>
              <p>I hope it can be of use to you as well.</p>
            </div>
          </section>
        </section>
        <section id="40589675">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/article/researchers-plan-retract-landmark-alzheimers-paper-containing-doctored-images"
              >Researchers to retract landmark Alzheimer's paper containing
              doctored images</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 19:49:18</span
              ><span class="points-container"
                >Points: <span class="points">248</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40589675"
                  >Comments</a
                ><span class="descendants">: 116</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40586654">
          <h3>
            <a
              class="item"
              href="https://www.idealista.com/en/news/legal-advice-in-spain/2024/04/15/816509-squatting-in-spain-understanding-spain-s-okupas-problem"
              >Squatting in Spain: Understanding Spain's "okupas" problem</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 16:06:05</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40586654"
                  >Comments</a
                ><span class="descendants">: 485</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40585728">
          <h3>
            <a
              class="item"
              href="https://www.bbc.co.uk/news/live/world-us-canada-69094213"
              >Boeing Starliner launches first crewed mission</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 15:04:03</span
              ><span class="points-container"
                >Points: <span class="points">627</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40585728"
                  >Comments</a
                ><span class="descendants">: 638</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40582475">
          <h3>
            <a
              class="item"
              href="https://www.pentagrid.ch/en/blog/ariane-allegro-hotel-check-in-terminal-kios-escape/"
              >Kiosk mode bypass for an Ariane Allegro Scenario Player based
              hotel check-in te</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 07:57:12</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40582475"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40580142">
          <h3>
            <a
              class="item"
              href="https://research.google/blog/heuristics-on-the-high-seas-mathematical-optimization-for-cargo-ships/"
              >Mathematical Optimization for Cargo Ships</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-05 @ 00:00:42</span
              ><span class="points-container"
                >Points: <span class="points">296</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40580142"
                  >Comments</a
                ><span class="descendants">: 124</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40573364">
          <h3>
            <a
              class="item"
              href="https://newatlas.com/technology/night-vision-thin-light-lens/"
              >Night-vision lenses so thin and light that we can all see in the
              dark</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-06-04 @ 11:42:13</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40573364"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
