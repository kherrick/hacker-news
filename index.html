<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36492762">
          <h3>
            <a
              class="item"
              href="https://oversharing.substack.com/p/five-stars-or-bust"
              >The only acceptable rating to leave an Uber driver is 5 stars</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 13:51:39</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36492762"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36492384">
          <h3>
            <a class="item" href="http://book.mixu.net/distsys/single-page.html"
              >Distributed Systems for Fun and Profit</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 13:25:59</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36492384"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36492347">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/investigates/special-report/usa-slavery-lawmakers/"
              >More than 100 U.S. political elites have family links to
              slavery</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 13:22:50</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36492329">
          <h3>
            <a
              class="item"
              href="https://support.microsoft.com/en-us/topic/outlook-emails-open-next-to-web-links-in-microsoft-edge-b0e1a1c1-bd62-462c-9ed5-5938b9c649f0"
              >Outlook now ignores Windows' Default Browser and opens links in
              Edge by default</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 13:21:30</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36492329"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36492317">
          <h3>
            <a
              class="item"
              href="https://thedisruptors.beehiiv.com/p/bootstrapping-atlassian-from-10-000-in-credit-card-debt-to-over-20m-in-revenue-in-5-years"
              >Bootstrapping Atlassian: $10k In Credit Card Debt To $20M In
              Revenue In 5 years</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 13:20:38</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36492317"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36492251">
          <h3>
            <a class="item" href="https://english.stackexchange.com/a/345755"
              >Why are ships always female?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 13:15:24</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36492251"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36492201">
          <h3>
            <a class="item" href="https://www.taxresearch.org.uk/Blog/"
              >Profits are driving inflation. When will politicians and the BoE
              admit it?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 13:11:05</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36492201"
                  >Comments</a
                ><span class="descendants">: 73</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36492149">
          <h3>
            <a class="item" href="https://capeprivacy.com"
              >Show HN: Cape API – Keep your sensitive data private while using
              GPT-4</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 13:04:08</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36492149"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
            <div class="text">
              <p>
                With Cape, you can easily de-identify sensitive data before
                sending it to OpenAI. In addition, you can create embeddings
                from sensitive text and documents and perform vector searches to
                improve your prompt context all while keeping the data
                confidential.
              </p>
              <p>
                Developers are using Cape with data like financial statements,
                legal contracts, and internal/proprietary knowledge that would
                otherwise be too sensitive to process with the ChatGPT API.
              </p>
              <p>
                You can try CapeChat, our playground for the API at
                <a href="https://chat.capeprivacy.com/"
                  >https://chat.capeprivacy.com/</a
                >
              </p>
              <p>
                The Cape API is self-serve, and has a free tier. The main
                features of the API are:
              </p>
              <p>
                De-identification — Redacts sensitive data like PII, PCI, and
                PHI from your text and documents.
              </p>
              <p>
                Re-identification — Reverts de-identified data back to the
                original form.
              </p>
              <p>
                Upload documents — Converts sensitive documents to embeddings
                (supports PDF, Excel, Word, CSV, TXT, PowerPoint, and Markdown).
              </p>
              <p>
                Vector Search — Performs a vector search on your embeddings to
                augment your prompts with context.
              </p>
              <p>
                To do all this, we work with a number of privacy and security
                techniques.
              </p>
              <p>
                First of all, we process data within a secure enclave, which is
                an isolated VM with in-memory encryption. The data remains
                confidential. No human, including our team at Cape or the
                underlying cloud provider, can see the data.
              </p>
              <p>
                Secondly, within the secure enclave, Cape de-identifies your
                data by removing PII, PCI, and PHI before it is processed by
                OpenAI. As GPT-4 generates and streams back the response tokens,
                we re-identify the data so it becomes readable again.
              </p>
              <p>
                In addition to de-identification, Cape also has API endpoints
                for embeddings, vector search, and document uploads, which all
                operate entirely within the secure enclave (no external calls
                and no sub-processors).
              </p>
              <p>Why did we build this?</p>
              <p>
                Developers asked us for help! We've been working at the
                intersection of privacy and AI since 2017, and with the
                explosion of interest in LLMs we've had a lot of questions from
                developers.
              </p>
              <p>
                Privacy and security remain one of the biggest barriers to
                adopting AI like LLMs, particularly for sensitive data.
              </p>
              <p>
                We’ve spoken with many companies who have been experimenting
                with ChatGPT or the GPT-4 API and they are extremely excited
                about the potential, however they find taking an LLM powered
                feature from PoC to production is a major lift, and it’s
                uncharted territory for many teams. Developers have questions
                like:
              </p>
              <p>
                - How do we ensure the privacy of our customer’s data if we’re
                sending it to OpenAI?
              </p>
              <p>
                - How can we securely feed large bodies of internal, proprietary
                data into GPT-4?
              </p>
              <p>
                - How can we mitigate hallucinations and bias so that we have
                higher trust in AI generated text?
              </p>
              <p>
                The features of the Cape API are designed to help solve these
                problems for developers, and we have a number of early customers
                using the API in production already.
              </p>
              <p>
                To get started, checkout our docs:
                <a href="https://docs.capeprivacy.com/"
                  >https://docs.capeprivacy.com/</a
                >
              </p>
              <p>
                View the API reference:
                <a href="https://api.capeprivacy.com/v1/redoc"
                  >https://api.capeprivacy.com/v1/redoc</a
                >
              </p>
              <p>
                Join the discussion on our Discord:
                <a href="https://discord.gg/nQW7YxUYjh"
                  >https://discord.gg/nQW7YxUYjh</a
                >
              </p>
              <p>
                And of course try the CapeChat playground at
                <a href="https://chat.capeprivacy.com/"
                  >https://chat.capeprivacy.com/</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="36492033">
          <h3>
            <a
              class="item"
              href="https://www.gibney.org/a_syntax_for_self-tracking"
              >A Syntax for Self-Tracking (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 12:51:12</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36492033"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36492010">
          <h3>
            <a
              class="item"
              href="https://www.thedrive.com/news/fedex-accused-of-largest-odometer-rollback-fraud-in-history-with-used-vans"
              >FedEx Accused of Largest Odometer Rollback Fraud in History with
              Used Vans</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 12:49:17</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36492010"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36491975">
          <h3>
            <a class="item" href="https://github.com/billabear/billabear"
              >Show HN: BillaBear – Self-Hosted SaaS Subscription Management and
              Billing</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 12:46:01</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36491975"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36491704">
          <h3>
            <a class="item" href="https://saurabhs.org/advanced-macos-commands"
              >macOS command-line tools you might not know about</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 12:08:38</span
              ><span class="points-container"
                >Points: <span class="points">408</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36491704"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36491677">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-06-ninth-dedekind-scientists-long-known-problem.html"
              >Ninth Dedekind number discovered: long-known problem in
              mathematics solved</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 12:04:48</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36491677"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36491647">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36491647"
              >Text Blaze (YC W21) is hiring a growth engineer to pioneer LLM
              driven strategies</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 12:01:08</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
            <div class="text">
              <p>
                We're excited to announce that Text Blaze (YC W21) is currently
                seeking a Growth Engineer who is passionate about leveraging
                large language models (LLMs) to transform the world of growth
                marketing. In this role, you'll have the unique opportunity to
                drive our user acquisition and activation journey end-to-end,
                exploring and experimenting with innovative ways to use LLMs to
                promote Text Blaze’s capabilities and grow existing users' usage
                of Text Blaze by generating personalized content tailored to
                each user.
              </p>
              <p>About Text Blaze</p>
              <p>
                At Text Blaze, we're dedicated to freeing users from tedious
                work by providing them with simple yet powerful solutions. We're
                fast-paced, data-driven, and constantly iterating based on the
                needs of our users.
              </p>
              <p>
                Joining us means being part of a profitable, fast-growing
                company that already has an excellent product-market fit and a
                deeply loyal user base of over 300,000 users. As a member of our
                founding team, you'll have a substantial impact on our product,
                strategy, and culture.
              </p>
              <p>
                We're fully remote. You'll be part of a team that embraces
                ownership and impact, all while working comfortably from your
                own home.
              </p>
              <p>Skills and Qualifications</p>
              <p>
                - A passion for talking to users and understanding their
                problems. - A knack for identifying business needs and
                developing technical solutions to address them. - An eye for
                design and comfort with designing your own UI's and solutions. -
                Experience or strong interest working with large language
                models, prompt engineering and post-processing - Proficiency in
                SQL, Python and JavaScript
              </p>
              <p>
                This is an opportunity to be at the forefront of the LLM-driven
                growth revolution. If you're eager to rethink growth and
                transform how we interact with potential users, we'd love to
                hear from you.
              </p>
              <p>To apply please email us at hiring@blaze.today</p>
              <p>
                Feel free to reach out to us directly if you have any questions!
              </p>
              <p>The Text Blaze Team</p>
            </div>
          </section>
        </section>
        <section id="36491514">
          <h3>
            <a class="item" href="https://neal.fun/deep-sea/"
              >The Deep Sea (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 11:39:56</span
              ><span class="points-container"
                >Points: <span class="points">185</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36491514"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36491338">
          <h3>
            <a class="item" href="https://www.tinc-vpn.org/"
              >Tinc, a GPLv2 mesh routing VPN</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 11:15:28</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36491338"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36489847">
          <h3>
            <a class="item" href="https://github.com/wolfi-dev"
              >Wolfi: A community Linux OS designed for the container and
              cloud-native era</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 07:19:37</span
              ><span class="points-container"
                >Points: <span class="points">117</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36489847"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36489288">
          <h3>
            <a class="item" href="https://rigtorp.se/ringbuffer/"
              >Optimizing a ring buffer for throughput (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 05:42:05</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36489288"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36488735">
          <h3>
            <a class="item" href="https://x0axz.com/blog/autograd.html"
              >Show HN: An Interactive Guide to Teach Derivatives and
              Backpropagation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 04:01:10</span
              ><span class="points-container"
                >Points: <span class="points">80</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36488735"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36488356">
          <h3>
            <a
              class="item"
              href="https://akashrajpurohit.com/blog/build-your-own-docker-with-linux-namespaces-cgroups-and-chroot-handson-guide/"
              >Build your own Docker with Linux namespaces, cgroups, and
              chroot</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 02:50:55</span
              ><span class="points-container"
                >Points: <span class="points">247</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36488356"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36487574">
          <h3>
            <a class="item" href="https://eatrightindia.gov.in/dart/"
              >Detect Food Adulteration with Easy Home Tests</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-27 @ 00:18:19</span
              ><span class="points-container"
                >Points: <span class="points">157</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36487574"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36480687">
          <h3>
            <a class="item" href="https://mofi.loud.red/"
              >Show HN: Mofi – Content-aware fill for audio to change a song to
              any duration</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 15:12:53</span
              ><span class="points-container"
                >Points: <span class="points">589</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36480687"
                  >Comments</a
                ><span class="descendants">: 146</span></span
              >
            </h4>
            <div class="text">
              <a
                href="https://mofi.loud.red/edit/8bd3fdf780f8c3927e41029f3b957f8a7ed96863"
                >https://mofi.loud.red/edit/8bd3fdf780f8c3927e41029f3b957f8a7...</a
              >
              <p>
                The cool thing is that after the song is analyzed on the server,
                the client can recompute and preview the results completely
                client-side through an implementation that uses Web Workers and
                WebAssembly. The audio previewing uses Tone.js. I am thinking of
                writing up some more details about the implementation in the
                future.
              </p>
              <p>
                I'm still working on a way to explain this easily, but I like
                the idea of carrying over the concept of content-aware fill from
                images to audio.
              </p>
              <p>Please let me know if you have any comments or questions!</p>
            </div>
          </section>
        </section>
        <section id="36480470">
          <h3>
            <a
              class="item"
              href="https://www.visuality.pl/posts/a-simple-guide-to-pessimistic-locking-in-rails"
              >A simple guide to pessimistic locking in Rails</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 15:00:55</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36480470"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36480200">
          <h3>
            <a
              class="item"
              href="http://www.solipsys.co.uk/new/UnexpectedInteractionOfFeatures.html?wf26hn"
              >Unexpected Interaction of Features</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 14:39:03</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36480200"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36479683">
          <h3>
            <a
              class="item"
              href="https://people.inf.ethz.ch/omutlu/pub/RowPress_isca23.pdf"
              >RowPress: Amplifying read disturbance in modern DRAM chips
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 13:54:05</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36479683"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36478854">
          <h3>
            <a
              class="item"
              href="https://spin.atomicobject.com/2023/06/26/dexec-docker/"
              >Working with Docker containers with the dexec bash script</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 12:29:04</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36478854"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36478772">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/06/20/magazine/hotel-bars.html"
              >The best place to drink is the emptiest bar in the city</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 12:21:23</span
              ><span class="points-container"
                >Points: <span class="points">157</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36478772"
                  >Comments</a
                ><span class="descendants">: 345</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36475846">
          <h3>
            <a
              class="item"
              href="https://blogs.loc.gov/loc/2023/06/bloomsday-the-librarys-one-of-a-kind-copy-of-ulysses/"
              >Bloomsday: The library’s one-of-a-kind copy of “Ulysses”</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-26 @ 04:51:43</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36475846"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36469147">
          <h3>
            <a
              class="item"
              href="https://matduggan.com/were-all-doing-metrics-wrong/"
              >Monitoring Is a Pain</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-25 @ 15:20:13</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36469147"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36469086">
          <h3>
            <a
              class="item"
              href="https://marctenbosch.com/news/2023/03/4d-toys-update-v-1-8-rotating-the-3d-slice-2d-faces-projections-marble-scenes-and-many-more/"
              >4D Toys Update 8: Rotating the 3D Slice, 2D Faces Projections,
              Marble Scenes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-25 @ 15:15:38</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36469086"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
