<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36076667">
          <h3>
            <a class="item" href="https://www.jobrunr.io/en/"
              >JobRunr: A library for background processing in Java</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 21:45:45</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36076667"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36076629">
          <h3>
            <a
              class="item"
              href="https://www.nms.si:443/en/collections/highlights/343-Neanderthal-flute"
              >Neanderthal flute: The oldest musical instrument in the world</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 21:42:21</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36076629"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36076553">
          <h3>
            <a
              class="item"
              href="https://electrek.co/2023/05/25/tesla-model-y-is-now-the-worlds-best-selling-car-first-ev-to-do-so/"
              >Tesla Model Y is now the world's best-selling car, first EV to do
              so</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 21:35:09</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36076553"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36075977">
          <h3>
            <a
              class="item"
              href="https://lmsys.org/blog/2023-05-25-leaderboard/"
              >Chatbot Arena Leaderboard Updates (Week 4)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 20:46:23</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36075977"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36075917">
          <h3>
            <a
              class="item"
              href="https://www.economist.com/business/2023/05/25/it-will-take-years-to-get-deutsche-bahn-back-on-track"
              >It will take years to get Deutsche Bahn back on track</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 20:41:31</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36075917"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36075886">
          <h3>
            <a
              class="item"
              href="https://jalopnik.com/whistleblower-drops-100-gigabytes-of-tesla-secrets-to-g-1850476542"
              >Whistleblower Drops 100 GB of Tesla Secrets to German News
              Site</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 20:38:25</span
              ><span class="points-container"
                >Points: <span class="points">301</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36075886"
                  >Comments</a
                ><span class="descendants">: 227</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36075801">
          <h3>
            <a
              class="item"
              href="https://coloradosun.com/2023/05/24/municipal-internet-sb-152-repealed-colorado/"
              >Colorado repealed law limiting municipal internet</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 20:31:53</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36075801"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36074845">
          <h3>
            <a class="item" href="https://archive.org/details/WarIsARacket"
              >War Is a Racket (1935)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 19:16:15</span
              ><span class="points-container"
                >Points: <span class="points">298</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36074845"
                  >Comments</a
                ><span class="descendants">: 356</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36074646">
          <h3>
            <a
              class="item"
              href="https://gitlab.com/AuroraOSS/AuroraStore/-/issues/912"
              >Aurora Store Accounts Blocked by Google</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 19:00:50</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36074646"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36073919">
          <h3>
            <a
              class="item"
              href="https://blog.replit.com/super-colliding-nix-stores"
              >Super Colliding Nix Stores: Nix Flakes for Millions of
              Developers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 18:00:24</span
              ><span class="points-container"
                >Points: <span class="points">47</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36073919"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36073785">
          <h3>
            <a
              class="item"
              href="https://jvns.ca/blog/2023/05/25/new-playground--memory-spy/"
              >New Playground: Memory Spy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 17:48:02</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36073785"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36073467">
          <h3>
            <a class="item" href="https://www.finleycms.com/careers/"
              >Finley (YC W21) is hiring to reimagine the debt capital markets
              (US remote)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 17:21:24</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36073241">
          <h3>
            <a class="item" href="https://gorilla.cs.berkeley.edu/"
              >Gorilla: LLM Connected with APIs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 17:05:00</span
              ><span class="points-container"
                >Points: <span class="points">159</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36073241"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36073159">
          <h3>
            <a class="item" href="https://hn.lingually.ai"
              >Show HN: Hacker News in Slow Italian - AI-generated podcast (with
              code)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 16:58:57</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36073159"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
            <div class="text">
              <p>
                Introducing Hacker News in Slow Italian. Each episode is
                generated automatically, using GPT4 API to summarise the top
                articles on Hacker News and then fed to Play.ht for
                text-to-speech.
              </p>
              <p>
                The (very short) code is available on Github:
                <a href="https://github.com/laky/hn-slow-italian"
                  >https://github.com/laky/hn-slow-italian</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="36072268">
          <h3>
            <a class="item" href="https://a16z.com/2023/05/25/ai-canon/"
              >AI Canon</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 15:47:20</span
              ><span class="points-container"
                >Points: <span class="points">441</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36072268"
                  >Comments</a
                ><span class="descendants">: 194</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36071397">
          <h3>
            <a
              class="item"
              href="https://www.jefftk.com/p/you-dont-always-need-indexes"
              >Cases where full scans are better than indexes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 14:47:03</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36071397"
                  >Comments</a
                ><span class="descendants">: 160</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36071342">
          <h3>
            <a
              class="item"
              href="https://bit.kevinslin.com/p/leveraging-gpt-4-to-automate-the"
              >Lessons from Creating a VSCode Extension with GPT-4</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 14:42:36</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36071342"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36070426">
          <h3>
            <a
              class="item"
              href="https://notes.eatonphil.com/2023-05-25-raft.html"
              >Implementing a distributed key-value store on top of implementing
              Raft in Go</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 13:26:47</span
              ><span class="points-container"
                >Points: <span class="points">217</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36070426"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36070090">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36070090"
              >Show HN: Visual intuitive explanations of LLM concepts (LLM
              University)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 12:50:22</span
              ><span class="points-container"
                >Points: <span class="points">205</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36070090"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
            <div class="text">
              <p>
                We've just published a lot of original, visual, and intuitive
                explanations of concepts to introduce people to large language
                models.
              </p>
              <p>
                It's available for free with no sign-up needed and it includes
                text articles, some video explanations, and code
                examples/notebooks as well. And we're available to answer your
                questions in a dedicated Discord channel.
              </p>
              <p>You can find it here: https://llm.university/</p>
              <p>
                Having written
                https://jalammar.github.io/illustrated-transformer/, I've been
                thinking about these topics and how best to communicate them for
                half a decade. But this project is extra special to me because I
                got to collaborate on it with two of who I think of as some of
                the best ML educators out there. Luis Serrano of
                https://www.youtube.com/@SerranoAcademy and Meor Amer, author of
                "A Visual Introduction to Deep Learning"
                https://kdimensions.gumroad.com/l/visualdl
              </p>
              <p>
                We're planning to roll out more content to it (let us know what
                concepts interest you). But as of now, it has the following
                structure (With some links for highlighted articles for you to
                audit):
              </p>
              <p>---</p>
              <p>Module 1: What are Large Language Models</p>
              <p>
                - Text Embeddings (https://docs.cohere.com/docs/text-embeddings)
              </p>
              <p>
                - Similarity between words and sentences
                (https://docs.cohere.com/docs/similarity-between-words-and-sentences)
              </p>
              <p>- The attention mechanism</p>
              <p>
                - Transformer models
                (https://docs.cohere.com/docs/transformer-models HN Discussion:
                https://news.ycombinator.com/item?id=35576918)
              </p>
              <p>- Semantic search</p>
              <p>---</p>
              <p>Module 2: Text representation</p>
              <p>
                - Classification models
                (https://docs.cohere.com/docs/classification-models)
              </p>
              <p>
                - Classification Evaluation metrics
                (https://docs.cohere.com/docs/evaluation-metrics)
              </p>
              <p>- Classification / Embedding API endpoints</p>
              <p>- Semantic search</p>
              <p>- Text clustering</p>
              <p>
                - Topic modeling (goes over clustering Ask HN posts
                https://docs.cohere.com/docs/clustering-hacker-news-posts)
              </p>
              <p>- Multilingual semantic search</p>
              <p>- Multilingual sentiment analysis</p>
              <p>---</p>
              <p>Module 3: Text generation</p>
              <p>
                - Prompt engineering
                (https://docs.cohere.com/docs/model-prompting)
              </p>
              <p>- Use case ideation</p>
              <p>- Chaining prompts</p>
              <p>---</p>
              <p>
                A lot of the content originates from common questions we get
                from users of the LLMs we serve at Cohere. So the focus is more
                on application of LLMs than theory or training LLMs.
              </p>
              <p>Hope you enjoy it, open to all feedback and suggestions!</p>
            </div>
          </section>
        </section>
        <section id="36069847">
          <h3>
            <a
              class="item"
              href="https://www.math.cmu.edu/~jmackey/151_128/bws_book.pdf"
              >Everything you always wanted to know about mathematics (2013)
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 12:22:42</span
              ><span class="points-container"
                >Points: <span class="points">616</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36069847"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36069393">
          <h3>
            <a
              class="item"
              href="https://www.medievalists.net/2022/09/medieval-books-manuscripts-discovered-romania/"
              >Archive of medieval books and manuscripts discovered in Romanian
              church</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 11:32:45</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36069393"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36068850">
          <h3>
            <a
              class="item"
              href="https://lightning.ai/pages/blog/how-to-finetune-gpt-like-large-language-models-on-a-custom-dataset/"
              >How to Finetune GPT Like Large Language Models on a Custom
              Dataset</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 10:06:38</span
              ><span class="points-container"
                >Points: <span class="points">377</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36068850"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36068723">
          <h3>
            <a
              class="item"
              href="https://arthurpesah.me/blog/2023-05-13-surface-code/"
              >An interactive introduction to the surface code</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 09:45:39</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36068723"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36067983">
          <h3>
            <a class="item" href="https://github.com/vanjs-org/van"
              >VanJS (Vanilla JavaScript): smallest reactive UI framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 07:31:10</span
              ><span class="points-container"
                >Points: <span class="points">234</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36067983"
                  >Comments</a
                ><span class="descendants">: 188</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36065802">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=k_GTIL7AECQ"
              >The smartest slime [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 00:35:08</span
              ><span class="points-container"
                >Points: <span class="points">79</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36065802"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36065693">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2023-05-astronomers-explore-luminous-quasar.html"
              >Astronomers explore a recently discovered luminous quasar</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-25 @ 00:20:13</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36065693"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36057261">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36057261"
              >Ask HN: Indic languages OCR and searchable pdfs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-24 @ 12:47:55</span
              ><span class="points-container"
                >Points: <span class="points">13</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36057261"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
            <div class="text">
              I am look for applications that can perform OCR on scanned images
              having Indic scripts (Devanagari, Tamil etc) and create a
              searchable pdf as an output. There are several applications which
              can extract the text from images, but is there any application
              which can create searchable pdf?
            </div>
          </section>
        </section>
        <section id="36056488">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/math-that-goes-on-forever-but-never-repeats-20230523/"
              >Math That Goes on Forever but Never Repeats</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-24 @ 11:24:38</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36056488"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36056408">
          <h3>
            <a
              class="item"
              href="https://www.tomshardware.com/news/tape-storage-trundles-on-increases-yearly-volume-to-128-exabytes"
              >Tape Storage Trundles On, Increases Yearly Volume to 128
              Exabytes</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-24 @ 11:16:00</span
              ><span class="points-container"
                >Points: <span class="points">141</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36056408"
                  >Comments</a
                ><span class="descendants">: 165</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36054430">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Nirvana_fallacy"
              >Nirvana Fallacy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-05-24 @ 05:30:05</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36054430"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
