<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36865625">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36865625"
              >Launch HN: Roundtable (YC S23) – Using AI to Simulate Surveys</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 17:07:12</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36865625"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
            <div class="text">
              <a href="https://roundtable.ai/">https://roundtable.ai/</a>). We
              use LLMs to produce cheap, yet surprisingly useful, simulations of
              surveys. Specifically, we train LLMs on standard, curated survey
              datasets. This approach allows us to essentially build
              general-purpose models of human behavior and opinion. We combine
              this with a nice UI that lets users easily visualize and interpret
              the results.
              <p>
                Surveys are incredibly important for user and market research,
                but are expensive and take months to design, run, and analyze.
                By simulating responses, our users can get results in seconds
                and make decisions faster. See
                <a href="https://roundtable.ai/showcase"
                  >https://roundtable.ai/showcase</a
                >
                for a bunch of examples, and
                <a
                  href="https://www.loom.com/share/eb6fb27acebe48839dd561cf1546f131"
                  >https://www.loom.com/share/eb6fb27acebe48839dd561cf1546f131</a
                >
                for a demo video.
              </p>
              <p>
                Our product lets you add questions (e.g. “how old are you”) and
                conditions (e.g. “is a Hacker News user”) and then see how these
                affect the survey results. For example, the survey “Are you
                interested in buying an e-bike?” shows ‘yes’ 28% [1]. But if you
                narrow it down to people who own a Tesla, ‘yes’ jumps to 52%
                [2]. Another example: if you survey “where did you learn to
                code”, the question “how old are you?” makes a dramatic
                difference—for “45 or older” the answer is 55% “books” [3], but
                for “younger than 45” it’s 76% “online” [4]. One more: 5% of
                people answer “legroom” to the question “Which of the following
                factors is most important for choosing which airline to fly?”
                [5], and this jumps to 20% when you condition on people over six
                feet tall [6].
              </p>
              <p>
                You wouldn’t think (well, we didn’t think) that such simulated
                surveys would work very well, but empirically they work a lot
                better than expected—we have run many surveys in the wild to
                validate Roundtable's results (e.g. comparing age demographics
                to U.S. Census data). We’re still trying to figure out why. We
                believe that LLMs that are pre-trained on the public Internet
                have internalized a lot of information/correlations about
                communities (e.g. Tesla drivers, Hacker News, etc.) and can
                reasonably approximate their behavior. In any case, researchers
                are seeing the same things that we are. A nice paper by a BYU
                group [7] discusses extracting sub-population information from
                GPT/LLMs. A related paper from Microsoft [8] shows how GPT can
                simulate different human behaviors. It’s an active research
                topic, and we hope we can get a sense of the theoretical basis
                relatively soon.
              </p>
              <p>
                Because these models are primarily trained on Internet data,
                they start out skewed towards the demographics of heavy Internet
                users (e.g., high-income, male). We addressed this by
                fine-tuning GPT on the GSS (General Social Survey [9] - the gold
                standard of demographic surveys in the US) so our models emulate
                a more representative U.S. population.
              </p>
              <p>
                We’ve built a transparency feature that shows how similar your
                survey question is to the training data and thus gives a
                confidence metric of our accuracy. If you click ‘Investigate
                Results’, we report the most similar (in terms of cosine
                distance between LLM embeddings) GSS questions as a way of
                estimating how much extrapolation / interpolation is going on.
                This doesn’t quite address the accuracy of the subpopulations /
                conditioning questions (we are working on this), but we thought
                we are at a sufficiently advanced point to share what we’ve
                built with you all.
              </p>
              <p>
                We're graduating PhD students from Princeton University in
                cognitive science and AI. We ran a ton of surveys and behavioral
                experiments and were often frustrated with the pipeline. We were
                looking to leave academia, and saw an opportunity in making the
                survey pipeline better. User and market research is a big
                market, and many of the tools and methods the industry uses are
                clunky and slow. Mayank’s PhD work used large datasets and ML
                for developing interpretable scientific theories, and Matt’s
                developed complex experimental software to study coordinated
                group decision-making. We see Roundtable as operating at the
                intersection of our interests.
              </p>
              <p>
                We charge per survey. We are targeting small and mid-market
                businesses who have market research teams, and ask for a minimum
                subscription amount. Pricing is at the bottom of our home page.
              </p>
              <p>
                We are still in the early stages of building this product, and
                we’d love for you all to play around with the demo and provide
                us feedback. Let us know whatever you see - this is our first
                major endeavor into the private sector from academia, and we’re
                eager to hear whatever you have to say!
              </p>
              <p>
                [1]:
                <a
                  href="https://roundtable.ai/sandbox/e02e92a9ad20fdd517182788f4ae7e1f96a849c0"
                  >https://roundtable.ai/sandbox/e02e92a9ad20fdd517182788f4ae7e...</a
                >
              </p>
              <p>
                [2]:
                <a
                  href="https://roundtable.ai/sandbox/6b4bf8740ad1945b08c0bf584c84c1202a5fec53"
                  >https://roundtable.ai/sandbox/6b4bf8740ad1945b08c0bf584c84c1...</a
                >
              </p>
              <p>
                [3]
                <a
                  href="https://roundtable.ai/sandbox/d701556248385d05ce5d26ce7fc776bb4d32fad0"
                  >https://roundtable.ai/sandbox/d701556248385d05ce5d26ce7fc776...</a
                >
              </p>
              <p>
                [4]
                <a
                  href="https://roundtable.ai/sandbox/8bd80babad042cf60d500ca28c40f7db413f553a"
                  >https://roundtable.ai/sandbox/8bd80babad042cf60d500ca28c40f7...</a
                >
              </p>
              <p>
                [5]
                <a
                  href="https://roundtable.ai/sandbox/0450d499048c089894c34fba514db4042eafb6c0"
                  >https://roundtable.ai/sandbox/0450d499048c089894c34fba514db4...</a
                >
              </p>
              <p>
                [6]
                <a
                  href="https://roundtable.ai/sandbox/0450d499048c089894c34fba514db4042eafb6c0"
                  >https://roundtable.ai/sandbox/0450d499048c089894c34fba514db4...</a
                >
              </p>
              <p>
                [7]
                <a href="https://arxiv.org/abs/2209.06899"
                  >https://arxiv.org/abs/2209.06899</a
                >
              </p>
              <p>
                [8]
                <a href="https://openreview.net/pdf?id=eYlLlvzngu"
                  >https://openreview.net/pdf?id=eYlLlvzngu</a
                >
              </p>
              <p>
                [9]
                <a href="https://www.norc.org/research/projects/gss.html"
                  >https://www.norc.org/research/projects/gss.html</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="36865531">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/aviator/jobs"
              >Aviator (YC S21) is hiring engineers to build advanced Git
              tools</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 17:00:53</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36865465">
          <h3>
            <a
              class="item"
              href="https://www.ft.com/content/fd367bd6-a73a-4d80-b0d0-32837724bd0a"
              >GM reverses plan to retire Chevrolet Bolt as it chases EV
              target</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 16:57:35</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36865465"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36865309">
          <h3>
            <a
              class="item"
              href="https://fasterthanli.me/articles/i-want-off-mr-golangs-wild-ride"
              >I Want Off Mr. Golang's Wild Ride</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 16:48:59</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36865309"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36865060">
          <h3>
            <a
              class="item"
              href="https://socket.dev/blog/social-engineering-campaign-npm-malware"
              >Social engineering campaign targeting tech employees spreads
              through NPM malware</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 16:35:47</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36865060"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36864892">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/2023/07/25/world/gulf-stream-atlantic-current-collapse-climate-scn-intl/index.html"
              >Crucial system of ocean currents is collapsing; ‘affects everyone
              on the planet’</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 16:28:13</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36864892"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36864624">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2307.12008"
              >The First Room-Temperature Ambient-Pressure Superconductor</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 16:14:32</span
              ><span class="points-container"
                >Points: <span class="points">190</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36864624"
                  >Comments</a
                ><span class="descendants">: 118</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36864547">
          <h3>
            <a
              class="item"
              href="https://doctorow.medium.com/autoenshittification-cb851c2574fb"
              >Autoenshittification. How the computer killed capitalism. – by
              Cory Doctorow</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 16:10:53</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36864547"
                  >Comments</a
                ><span class="descendants">: 85</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36864476">
          <h3>
            <a
              class="item"
              href="https://pboyd.io/posts/at-company-we-are-family/"
              >At this company, we are family</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 16:07:33</span
              ><span class="points-container"
                >Points: <span class="points">285</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36864476"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36864319">
          <h3>
            <a
              class="item"
              href="https://www.nature.com/articles/s41467-023-39810-w"
              >Warning of forthcoming collapse of Atlantic meridional
              overturning circulation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 15:59:54</span
              ><span class="points-container"
                >Points: <span class="points">219</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36864319"
                  >Comments</a
                ><span class="descendants">: 143</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36864115">
          <h3>
            <a
              class="item"
              href="https://alicegg.tech//2023/07/25/technical-analysis.html"
              >Is technical analysis just stock market astrology?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 15:49:39</span
              ><span class="points-container"
                >Points: <span class="points">176</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36864115"
                  >Comments</a
                ><span class="descendants">: 171</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36864021">
          <h3>
            <a class="item" href="https://github.com/alantech/marsha"
              >Show HN: Marsha – An LLM-Based Programming Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 15:43:56</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36864021"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36863915">
          <h3>
            <a class="item" href="https://datatracker.ietf.org/doc/html/rfc9420"
              >The Messaging Layer Security (MLS) Protocol</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 15:38:41</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36863915"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36863581">
          <h3>
            <a
              class="item"
              href="https://astralcodexten.substack.com/p/were-not-platonists-weve-just-learned"
              >We're Not Platonists, We've Just Learned the Bitter Lesson</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 15:17:45</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36863581"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36863522">
          <h3>
            <a class="item" href="https://onnxruntime.ai/"
              >Onnx Runtime: “Cross-Platform Accelerated Machine Learning”</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 15:13:57</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36863522"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36863280">
          <h3>
            <a
              class="item"
              href="https://blog.spatial.chat/tracking-hackernews-shifting-preferences-for-remote-jobs-over-5-years/"
              >Remote work on HN: Who is hiring? – 69% jobs in 2023 are
              remote</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 14:59:31</span
              ><span class="points-container"
                >Points: <span class="points">280</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36863280"
                  >Comments</a
                ><span class="descendants">: 253</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36863094">
          <h3>
            <a
              class="item"
              href="https://devblogs.microsoft.com/oldnewthing/20230725-00/?p=108482"
              >Before you try to do something, make sure you can do nothing</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 14:49:14</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36863094"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36862850">
          <h3>
            <a
              class="item"
              href="https://decrypt.co/149826/openai-quietly-shutters-its-ai-detection-tool"
              >OpenAI Quietly Shuts Down Its AI Detection Tool</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 14:34:17</span
              ><span class="points-container"
                >Points: <span class="points">231</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36862850"
                  >Comments</a
                ><span class="descendants">: 120</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36862494">
          <h3>
            <a
              class="item"
              href="https://httptoolkit.com/blog/apple-private-access-tokens-attestation/"
              >Apple already shipped attestation on the web, and we barely
              noticed</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 14:10:12</span
              ><span class="points-container"
                >Points: <span class="points">393</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36862494"
                  >Comments</a
                ><span class="descendants">: 276</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36861302">
          <h3>
            <a class="item" href="https://ourworldofpixels.com/"
              >Our World of Pixels</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 12:33:01</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36861302"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36860992">
          <h3>
            <a
              class="item"
              href="https://willthompson.name/what-we-know-about-llms-primer"
              >What We Know About LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 11:57:27</span
              ><span class="points-container"
                >Points: <span class="points">250</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36860992"
                  >Comments</a
                ><span class="descendants">: 114</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36860898">
          <h3>
            <a class="item" href="https://invoicedragon.com/"
              >Show HN: Invoice Dragon – An open source app to create PDF
              invoices</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 11:45:06</span
              ><span class="points-container"
                >Points: <span class="points">308</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36860898"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36859880">
          <h3>
            <a class="item" href="https://github.com/1j01/textual-paint"
              >Textual Paint – MS Paint in your terminal</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 09:20:50</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36859880"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36859785">
          <h3>
            <a
              class="item"
              href="https://www.thestackcanary.com/from-python-pytorch-to-elixir-nx/"
              >From Python to Elixir Machine Learning</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 09:04:21</span
              ><span class="points-container"
                >Points: <span class="points">234</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36859785"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36857758">
          <h3>
            <a
              class="item"
              href="https://cdm.link/2023/07/amiga-video-toaster-cool-factor/"
              >The 1990s Amiga with Video Toaster has a VFX cool factor that
              endures today</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 04:07:36</span
              ><span class="points-container"
                >Points: <span class="points">180</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36857758"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36857314">
          <h3>
            <a
              class="item"
              href="https://infosec.exchange/@paco/110772422266480371"
              >Got called to a professor’s office after a complaint his SPARC4
              was running slow</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 03:00:26</span
              ><span class="points-container"
                >Points: <span class="points">692</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36857314"
                  >Comments</a
                ><span class="descendants">: 144</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36856755">
          <h3>
            <a
              class="item"
              href="https://flashbak.com/play-the-nimatron-the-worlds-first-video-game-invented-in-1930s-new-york-462185/"
              >Play the Nimatron, the World’s First Video Game Invented in 1930s
              New York</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-25 @ 01:37:15</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36856755"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36851371">
          <h3>
            <a
              class="item"
              href="https://boilingsteam.com/bitsummit-2023-steam-decks-everywhere-no-vr-and-impressive-indie-games/"
              >Bitsummit 2023: Steam Decks everywhere, no VR, and impressive
              indie games</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 17:24:35</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36851371"
                  >Comments</a
                ><span class="descendants">: 139</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36849376">
          <h3>
            <a
              class="item"
              href="https://animationobsessive.substack.com/p/the-secrets-of-magnetic-rose"
              >'Magnetic Rose'</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 15:16:55</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36849376"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36844579">
          <h3>
            <a
              class="item"
              href="https://historyofinformation.com/detail.php?entryid=2359"
              >Codex Gigas: the largest manuscript of the middle ages</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-07-24 @ 08:26:01</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36844579"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
