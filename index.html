<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44724088">
          <h3>
            <a class="item" href="https://angadh.com/contradictions-1"
              >Claude Finds Contradictions in My Thinking</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 14:46:15</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44724088"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44723763">
          <h3>
            <a
              class="item"
              href="https://nisheethvishnoi.substack.com/p/learning-is-slower-than-you-think"
              >Learning Is Slower Than You Think</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 14:23:41</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44723763"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44723316">
          <h3>
            <a
              class="item"
              href="https://simonwillison.net/2025/Jul/29/space-invaders/"
              >My 2.5 year old laptop can write Space Invaders in JavaScript now
              (GLM-4.5 Air)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 13:45:07</span
              ><span class="points-container"
                >Points: <span class="points">187</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44723316"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44723234">
          <h3>
            <a
              class="item"
              href="https://www.raspberrypi.com/news/rp2350-a4-rp2354-and-a-new-hacking-challenge/"
              >RP2350 A4, RP2354, and a New Hacking Challenge</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 13:38:13</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44723234"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44723162">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2025-07-25/can-a-country-be-too-rich-norway-is-finding-out-essay"
              >Can a Country Be Too Rich? Norway Is Finding Out</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 13:33:05</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44723162"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44723131">
          <h3>
            <a
              class="item"
              href="https://nedbatchelder.com/blog/202507/coveragepy_regex_pragmas.html"
              >Coverage.py Regex Pragmas</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 13:30:47</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44723131"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44722951">
          <h3>
            <a
              class="item"
              href="https://netflixtechblog.com/linux-performance-analysis-in-60-000-milliseconds-accc10403c55"
              >Linux Performance Analysis in 60 seconds (2015)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 13:15:49</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44722951"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44722602">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=44722602"
              >Ask HN: How will the OSA affect small Mastodon instances?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 12:40:13</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44722602"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
            <div class="text">
              <p>
                This could potentially be a grey area that could expose self
                hosters to considerable risk if they are not careful.
              </p>
              <p>
                I wonder if there any UK based Mastodon hosters out there who
                are considering this. Are you considering shutting down to
                prevent any liability? Could this be the "death" of Mastodon
                hosting in the UK?
              </p>
            </div>
          </section>
        </section>
        <section id="44722584">
          <h3>
            <a
              class="item"
              href="https://www.salon.com/2024/11/22/wish-you-could-escape-the-planet-too-life-in-space-would-suck/"
              >Wish you could escape the planet? Too bad life in space would
              suck (2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 12:38:46</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44722584"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44722217">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/sendblue/jobs/VP7cA0F-senior-backend-engineer"
              >Sendblue (YC S23) is hiring senior engineers</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 12:01:11</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44721791">
          <h3>
            <a
              class="item"
              href="https://github.com/Danau5tin/terminal-bench-rl"
              >Show HN: Terminal-Bench-RL: Training Long-Horizon Terminal Agents
              with RL</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 11:12:03</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44721791"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
            <div class="text">
              <p>*What I did*:</p>
              <p>- Created a Claude Code-inspired agent (system msg + tools)</p>
              <p>
                - Built Docker-isolated GRPO training where each rollout gets
                its own container
              </p>
              <p>
                - Developed a multi-agent synthetic data pipeline to generate
                &amp; validate training data with Opus-4
              </p>
              <p>
                - Implemented a hybrid reward signal of unit test verifiers
                &amp; a behavioural LLM judge.
              </p>
              <p>*Key results*:</p>
              <p>
                - My untrained Qwen3-32B agent achieved 13.75% on Terminal-Bench
                (#19, beats Stanford's Qwen3-235B MoE)
              </p>
              <p>
                - I tested training to work stably on 32x H100s distributed
                across 4 bare metal nodes
              </p>
              <p>
                - I created a mini-eval framework for LLM-judge performance.
                Sonnet-4 won.
              </p>
              <p>
                - ~£30-50k needed for full training run of 1000 epochs (I could
                only afford testing )
              </p>
              <p>*Technical details*:</p>
              <p>
                - The synthetic dataset ranges from easy to extremely hard
                tasks. An example hard task's prompt:
              </p>
              <p>
                "I found this mystery program at `/app/program` and I'm
                completely stumped. It's a stripped binary, so I have no idea
                what it does or how to run it properly. The program seems to
                expect some specific input and then produces an output, but I
                can't figure out what kind of input it needs. Could you help me
                figure out what this program requires?"
              </p>
              <p>
                - Simple config presets allow training to run on multiple
                hardware setups with minimal effort.
              </p>
              <p>
                - GRPO used with 16 rollouts per task, up to 32k tokens per
                rollout.
              </p>
              <p>- Agent uses XML/YAML format to structure tool calls</p>
              <p>*More details*:</p>
              <p>
                My Github repos open source it all (agent, data, code) and has
                way more technical details if you are interested!:
              </p>
              <p>- Terminal Agent RL repo</p>
              <p>- Multi-agent synthetic data pipeline repo</p>
              <p>
                I thought I would share this because I believe long-horizon RL
                is going to change everybody's lives, and so I feel it is
                important (and super fun!) for us all to share knowledge around
                this area, and also have enjoy exploring what is possible.
              </p>
              <p>Thanks for reading!</p>
              <p>Dan</p>
              <p>
                (Built using rLLM RL framework which was brilliant to work with,
                and evaluated and inspired by the great Terminal Bench
                benchmark)
              </p>
            </div>
          </section>
        </section>
        <section id="44721772">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/vpn-use-spike-age-verification-laws-uk/"
              >Age Verification Laws Send VPN Use Soaring–and Threaten the Open
              Internet</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 11:09:18</span
              ><span class="points-container"
                >Points: <span class="points">131</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44721772"
                  >Comments</a
                ><span class="descendants">: 108</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44721403">
          <h3>
            <a
              class="item"
              href="https://wikimediafoundation.org/news/2025/07/17/wikimedia-foundation-challenges-uk-online-safety-act-regulations/"
              >Wikimedia Foundation Challenges UK Online Safety Act
              Regulations</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 10:12:29</span
              ><span class="points-container"
                >Points: <span class="points">252</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44721403"
                  >Comments</a
                ><span class="descendants">: 105</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44721204">
          <h3>
            <a class="item" href="https://nothing-to-watch.port80.ch"
              >Nothing to watch – Experimental gallery visualizing 50k film
              posters</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 09:42:14</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44721204"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44719532">
          <h3>
            <a
              class="item"
              href="https://benjamin.computer/posts/2025-07-28-amiga40.html"
              >Modernising the Amiga at Forty</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 05:55:32</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44719532"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44719413">
          <h3>
            <a class="item" href="https://www.ponylang.io/discover/"
              >Pony: An actor-model, capabilities-secure, high-performance
              programming language</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-29 @ 05:34:15</span
              ><span class="points-container"
                >Points: <span class="points">209</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44719413"
                  >Comments</a
                ><span class="descendants">: 156</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44716414">
          <h3>
            <a class="item" href="https://www.pipervoice.com/"
              >Show HN: Companies use AI to take your calls. I built AI to make
              them for you</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 22:17:14</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44716414"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
            <div class="text">
              <p>
                So I built Piper: basically AI that makes phone calls for you.
                You tell it what you need (book appointment, check on an order,
                dispute some charge, whatever), and it handles the entire
                conversation while you do actual work. Right now it's a web app,
                Chrome extension is pending approval but soon you'll be able to
                click any phone number anywhere and just let Piper handle it.
              </p>
              <p>Technical stuff that was harder than expected:</p>
              <p>
                Latency - every millisecond counts in conversation, had to
                optimize around kv cache, got it down to ~1000ms to first word
                over PSTN for telephony, which feels pretty natural
              </p>
              <p>
                Keeping the voice agents on track - built custom context
                engineering logic that constantly updates the agent's
                situational awareness, so it knows when it's been transferred,
                when it's on hold, etc
              </p>
              <p>
                Done ~50 successful calls with early testers so far. Main
                failures are when they need complex verification or documents.
                Also had to take down our IVR navigation temporarily :/, found
                some edge cases that were causing unnecessary transfers but
                working on fixing that.
              </p>
              <p>
                I really think we're heading toward this world where AI talks to
                AI for most routine things, and phone calls might be the first
                real example of this happening at scale!
              </p>
              <p>
                you can check out the a voice demo on our website.
                <a href="https://pipervoice.com">https://pipervoice.com</a>
              </p>
            </div>
          </section>
        </section>
        <section id="44715166">
          <h3>
            <a class="item" href="https://underpassapp.com/news/2025/7/5.html"
              >Sign in with Google in Chrome</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 20:24:38</span
              ><span class="points-container"
                >Points: <span class="points">487</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44715166"
                  >Comments</a
                ><span class="descendants">: 238</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44714914">
          <h3>
            <a
              class="item"
              href="https://themaister.net/blog/2025/06/16/i-designed-my-own-ridiculously-fast-game-streaming-video-codec-pyrowave/"
              >I designed my own fast game streaming video codec – PyroWave</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 20:01:26</span
              ><span class="points-container"
                >Points: <span class="points">386</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44714914"
                  >Comments</a
                ><span class="descendants">: 117</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44714223">
          <h3>
            <a class="item" href="https://ianto-cannon.github.io/clock.html"
              >Different Clocks</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 19:05:47</span
              ><span class="points-container"
                >Points: <span class="points">216</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44714223"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44711519">
          <h3>
            <a class="item" href="https://github.com/9001/copyparty"
              >Copyparty – Turn almost any device into a file server</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 14:57:55</span
              ><span class="points-container"
                >Points: <span class="points">911</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44711519"
                  >Comments</a
                ><span class="descendants">: 142</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44711306">
          <h3>
            <a
              class="item"
              href="https://mathstodon.xyz/@tao/114915604830689046"
              >Tao on “blue team” vs. “red team” LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-28 @ 14:36:39</span
              ><span class="points-container"
                >Points: <span class="points">494</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44711306"
                  >Comments</a
                ><span class="descendants">: 156</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44695385">
          <h3>
            <a
              class="item"
              href="https://log.pfad.fr/2025/optimi-zig-sudoku-solving/"
              >Optimi-Zi(n)g Sudoku-Solving</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-26 @ 16:47:35</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44695385"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44690158">
          <h3>
            <a
              class="item"
              href="https://hologram.page/blog/hologram-v0-5-0-released"
              >Hologram v0.5.0</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-26 @ 00:27:54</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44690158"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44690117">
          <h3>
            <a
              class="item"
              href="https://github.com/tripplyons/cuda-fractal-renderer"
              >Show HN: CUDA Fractal Renderer</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-26 @ 00:22:07</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44690117"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44689778">
          <h3>
            <a
              class="item"
              href="https://yakubov.org/blogs/2025-07-25-variable-naming-impact-on-ai-code-completion"
              >Do variable names matter for AI code completion? (2025)</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-25 @ 23:35:25</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44689778"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44689453">
          <h3>
            <a class="item" href="https://en.wikipedia.org/wiki/Truchet_tiles"
              >Truchet Tiles</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-25 @ 22:53:50</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44689453"
                  >Comments</a
                ><span class="descendants">: 21</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44688738">
          <h3>
            <a
              class="item"
              href="https://www.washingtonpost.com/world/2025/07/25/tour-france-bikes-hidden-motors/"
              >Tour de France confronts a new threat: Are cyclists using tiny
              motors?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-25 @ 21:32:22</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44688738"
                  >Comments</a
                ><span class="descendants">: 245</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44686624">
          <h3>
            <a
              class="item"
              href="https://www.shellshore.com/review-rotring-600-ballpoint-pen/"
              >Rotring 600 Ballpoint Pen</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-25 @ 18:35:22</span
              ><span class="points-container"
                >Points: <span class="points">152</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44686624"
                  >Comments</a
                ><span class="descendants">: 143</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44682450">
          <h3>
            <a
              class="item"
              href="https://blog.trailofbits.com/2025/07/25/exploiting-zero-days-in-abandoned-hardware/"
              >Exploiting zero days in abandoned hardware</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-07-25 @ 12:38:30</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44682450"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
