<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38788788">
          <h3>
            <a
              class="item"
              href="https://www.ramijames.com/thoughts/docs-deserve-more-respect"
              >Docs Deserve More Respect</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-28 @ 01:03:49</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38788788"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38788776">
          <h3>
            <a class="item" href="https://getjerry.com/careers"
              >Jerry (YC S17) Is Hiring PMs, Engineers, Data Roles (Remote)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-28 @ 01:01:39</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38788552">
          <h3>
            <a class="item" href="https://game-icons.net/"
              >Game-icons.net: Free icons for your games</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-28 @ 00:28:21</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38788552"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38788360">
          <h3>
            <a
              class="item"
              href="https://streaming.media.ccc.de/37c3/relive/12142"
              >Breaking "DRM" in Polish trains [video] – 37c3 presentation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 23:56:37</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38788360"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38788326">
          <h3>
            <a class="item" href="https://valetudo.cloud/"
              >Valetudo – Cloud replacement for vacuum robots enabling
              local-only operation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 23:51:24</span
              ><span class="points-container"
                >Points: <span class="points">91</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38788326"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38788273">
          <h3>
            <a
              class="item"
              href="https://joshua.hu/apple-ios-patched-unpatched-vulnerabilities"
              >No new iPhone? No secure iOS: Looking at an unfixed iOS
              vulnerability</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 23:43:42</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38788273"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38787892">
          <h3>
            <a class="item" href="https://github.com/jasonjmcghee/rem"
              >Show HN: Rem: Remember Everything (open source)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 22:56:22</span
              ><span class="points-container"
                >Points: <span class="points">114</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38787892"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
            <div class="text">
              <p>
                Note: Relies on Apple Silicon, and configured to only produce
                Apple Silicon builds.
              </p>
              <p>
                I think the idea of recording everything you see has the
                potential to change how we interact with our computers, and
                believe it should be open source.
              </p>
              <p>
                Also, from a privacy / security perspective, this is like...
                pretty scary stuff, and I want the code open so we know for
                certain that nothing is leaving your laptop. Even logging to
                Sentry has the potential to leak private info.
              </p>
            </div>
          </section>
        </section>
        <section id="38787005">
          <h3>
            <a class="item" href="https://lwn.net/Articles/956187/"
              >Debian Statement on the Cyber Resilience Act</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 21:32:22</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38787005"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38786581">
          <h3>
            <a
              class="item"
              href="https://satoshi7190.github.io/Shinjuku-indoor-threejs-demo/"
              >3D Map of Shinjuku Station in Three.js</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 20:50:04</span
              ><span class="points-container"
                >Points: <span class="points">373</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38786581"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38785468">
          <h3>
            <a
              class="item"
              href="https://www.eia.gov/todayinenergy/detail.php?id=61106"
              >First new U.S. nuclear reactor since 2016 is now in operation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 19:19:37</span
              ><span class="points-container"
                >Points: <span class="points">522</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38785468"
                  >Comments</a
                ><span class="descendants">: 464</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38785386">
          <h3>
            <a class="item" href="https://cloudevents.io/"
              >CloudEvents Event Specification</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 19:10:26</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38785386"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38785317">
          <h3>
            <a class="item" href="https://webdevelopmenthistory.com/index/"
              >Web Development History – Internet history for the technically
              curious</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 19:04:52</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38785317"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38784817">
          <h3>
            <a
              class="item"
              href="http://zenorogue.blogspot.com/2023/12/hyperrogue-130.html"
              >HyperRogue, a open-source non-Euclidean roguelike: new weapons</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 18:20:17</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38784817"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38784797">
          <h3>
            <a
              class="item"
              href="https://www.bitecode.dev/p/whats-up-python-epic-cpython-commit"
              >What's up Python? Epic CPython commit, Django 5 and 2FA for
              PyPI</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 18:18:36</span
              ><span class="points-container"
                >Points: <span class="points">133</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38784797"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38784188">
          <h3>
            <a class="item" href="https://pluto-lang.org/"
              >Pluto, a Modern Lua Dialect</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 17:25:53</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38784188"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38784073">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/security/2023/12/exploit-used-in-mass-iphone-infection-campaign-targeted-secret-hardware-feature/"
              >4-year campaign backdoored iPhones using advanced exploit</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 17:15:54</span
              ><span class="points-container"
                >Points: <span class="points">374</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38784073"
                  >Comments</a
                ><span class="descendants">: 220</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38783500">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/12/27/bruce_perens_post_open/"
              >What comes after open source? Bruce Perens is working on it</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 16:25:33</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38783500"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38783112">
          <h3>
            <a
              class="item"
              href="https://securelist.com/operation-triangulation-the-last-hardware-mystery/111669/"
              >Operation Triangulation: What You Get When Attack iPhones of
              Researchers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 15:47:55</span
              ><span class="points-container"
                >Points: <span class="points">264</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38783112"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38782954">
          <h3>
            <a
              class="item"
              href="https://www.lrb.co.uk/the-paper/v45/n23/jonah-goodman/a-national-evil"
              >The curse of the goitre in Switzerland</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 15:34:21</span
              ><span class="points-container"
                >Points: <span class="points">454</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38782954"
                  >Comments</a
                ><span class="descendants">: 218</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38782948">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=38782948"
              >Ask HN: Questions for two 40 year IBM Mainframe repair and
              programmers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 15:33:44</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38782948"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
            <div class="text">
              <p>
                His friend is coming to visit who was a programmer for these
                computers at a Goodyear plant that had 3000+ employees starting
                in the mid 1960s until around 2000. He started in the mail room
                and volunteered to become a programmer, back when IBM had
                training programs for companies to learn to use and program
                their their equipment. After the year 2000 he moved to a Life
                Insurance company as a programmer for another 10 years. During
                his career he programmed on punch cards, in assembly language,
                and later FORTRAN and COBOL.
              </p>
              <p>
                There are all kinds of debugging in the field stories, such as
                when a magnetic drum memory at an airfield kept having issues,
                and finally they figured out when the radar from the tower
                pointed just right at the drum it’d flip some of the memory, or
                when fumes from the Goodyear plant were found to be eating
                through solder joints, making the mainframe at that plant the
                2nd worst for IBM to maintain in North America (the worst was a
                tire plant in Canada, those fumes!).
              </p>
              <p>
                What questions do you have for two ~80 year old computer
                professionals in small town Alabama who started work back when
                you could walk into the computers, and ended their career in the
                2000s?
              </p>
              <p>
                They are coming in about 4 hours from this post, and I’ll record
                the whole thing and do my best to answer your questions in
                replies on this thread!
              </p>
            </div>
          </section>
        </section>
        <section id="38782944">
          <h3>
            <a
              class="item"
              href="https://www.theatlantic.com/podcasts/archive/2023/11/cockroach-bait-invention-combat/676167/"
              >We turned the tide in the roach wars</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 15:33:29</span
              ><span class="points-container"
                >Points: <span class="points">255</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38782944"
                  >Comments</a
                ><span class="descendants">: 198</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38782859">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/science-nature/reindeer-sleep-and-eat-simultaneously-saving-precious-time-in-the-short-arctic-summer-180983495/"
              >Reindeer Sleep and Eat Simultaneously</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 15:25:44</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38782859"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38782678">
          <h3>
            <a
              class="item"
              href="https://minimaxir.com/2023/12/chatgpt-structured-data/"
              >Pushing ChatGPT's Structured Data Support to Its Limits</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 15:09:19</span
              ><span class="points-container"
                >Points: <span class="points">243</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38782678"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38782482">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/taiwan-epicenter-of-world-myopia-epidemic/"
              >High myopia is now the leading cause of blindness in Japan,
              China, and Taiwan</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 14:52:37</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38782482"
                  >Comments</a
                ><span class="descendants">: 123</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38781484">
          <h3>
            <a
              class="item"
              href="https://www.dwarkeshpatel.com/p/will-scaling-work"
              >Will scaling work?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 12:54:38</span
              ><span class="points-container"
                >Points: <span class="points">205</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38781484"
                  >Comments</a
                ><span class="descendants">: 231</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38781273">
          <h3>
            <a class="item" href="https://github.com/chipsalliance/chisel"
              >Chisel: A Modern Hardware Design Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 12:18:38</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38781273"
                  >Comments</a
                ><span class="descendants">: 66</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38780919">
          <h3>
            <a
              class="item"
              href="https://www.solipsys.co.uk/new/SeventyVersusOneHundred.html?wk27hn"
              >Seventy versus One Hundred</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 11:14:49</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38780919"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38780519">
          <h3>
            <a class="item" href="https://github.com/hrvach/deskhop"
              >DeskHop – Fast Desktop Switching</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-27 @ 09:53:20</span
              ><span class="points-container"
                >Points: <span class="points">989</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38780519"
                  >Comments</a
                ><span class="descendants">: 224</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38773991">
          <h3>
            <a
              class="item"
              href="https://wattenberger.com/thoughts/evolving-the-infinite-canvas"
              >Evolving the Infinite Canvas</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-26 @ 17:49:57</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38773991"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38771119">
          <h3>
            <a class="item" href="https://16colo.rs/pack/badapple/BADAPPLE.ANS"
              >Bad Apple as MS-DOS Escape Sequences</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-26 @ 12:12:22</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38771119"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
