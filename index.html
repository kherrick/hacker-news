<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39727857">
          <h3>
            <a
              class="item"
              href="https://jacobin.com/2024/03/rachel-corrie-death-anniversary-rafah-gaza-idf"
              >Rachel Corrie Gave Her Life for Rafah</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-16 @ 17:40:09</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39727752">
          <h3>
            <a
              class="item"
              href="https://restofworld.org/2024/3-minutes-with-odun-eweniyi/"
              >Why African startups don't always need to expand across the
              continent</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-16 @ 17:25:32</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39727752"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39727735">
          <h3>
            <a
              class="item"
              href="https://www.tti.com/content/ttiinc/en/resources/blog/10-best-electronic-inventions-from-the-70.html"
              >Ten Best Electronic Inventions from the 70s</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-16 @ 17:23:46</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39727735"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39727726">
          <h3>
            <a
              class="item"
              href="https://www.cnbc.com/2024/03/16/himss-2024-ambient-clinical-documentation-steals-the-show.html"
              >Doctors are turning medical generative AI into a booming
              business</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-16 @ 17:22:38</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39727726"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39727651">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=e_94q9TCCDY"
              >TV Station Launches Multiple 4K Broadcasts OTA on ATSC 1.0
              [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-16 @ 17:12:39</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39727651"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39727610">
          <h3>
            <a class="item" href="https://arxiv.org/abs/math/0209244"
              >Georg Cantor and His Heritage</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-16 @ 17:09:20</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39727610"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39727587">
          <h3>
            <a
              class="item"
              href="https://www.credit-suisse.com/media/assets/corporate/docs/about-us/research/publications/csri-future-of-the-monetary-system.pdf"
              >The Future of the Monetary System [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-16 @ 17:07:21</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39727587"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39727568">
          <h3>
            <a
              class="item"
              href="https://www.tandfonline.com/doi/full/10.1080/27697061.2023.2300441"
              >Chewing Gum Is Associated with Better Diet Quality but Not Oral
              Health Measures</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-16 @ 17:05:40</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39727568"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39727529">
          <h3>
            <a
              class="item"
              href="https://uwaterloo.ca/news/media/research-shows-people-who-bs-are-more-likely-fall-bs"
              >Research shows that people who BS are more likely to fall for BS
              (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-16 @ 17:01:34</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39727529"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39727376">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39727376"
              >Ask HN: Why can't image generation models spell?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-16 @ 16:43:34</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39727376"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
            <div class="text">
              I’ve tried using the various state of the art commercially
              available models to generate artwork for my kids room, with his
              name in letters. None can render an image with his name properly
              spelled, and even after long chats where I explain the problem the
              models fail to spell correctly. It’s a common five letter name.
              What can’t the models spell?
            </div>
          </section>
        </section>
        <section id="39726781">
          <h3>
            <a
              class="item"
              href="https://github.com/tspeterkim/flash-attention-minimal"
              >Show HN: Flash Attention in ~100 lines of CUDA</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-16 @ 15:31:59</span
              ><span class="points-container"
                >Points: <span class="points">81</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39726781"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39726656">
          <h3>
            <a
              class="item"
              href="https://ibhof.blogspot.com/2020/01/the-economics-of-pirate-radio.html"
              >The Economics of Pirate Radio</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-16 @ 15:17:42</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39726656"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39726020">
          <h3>
            <a
              class="item"
              href="https://caseyhandmer.wordpress.com/2024/03/12/how-to-feed-the-ais/"
              >How to feed all the power-hungry AI data centers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-16 @ 14:04:19</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39726020"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39725678">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/plaintext-y-combinator-michael-seibel-startup-whisperer/"
              >Y Combinator's Chief Startup Whisperer Is Demoting Himself</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-16 @ 13:24:12</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39725678"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39725303">
          <h3>
            <a
              class="item"
              href="https://www.netcraft.com/blog/cloudflare-loses-22-of-its-domains-in-freenom-tk-shutdown/"
              >Cloudflare loses 22% of its domains in Freenom .tk shutdown</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-16 @ 12:24:54</span
              ><span class="points-container"
                >Points: <span class="points">174</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39725303"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39725057">
          <h3>
            <a
              class="item"
              href="https://awesomekling.substack.com/p/fuzzing-ladybird-with-tools-from"
              >Fuzzing Ladybird with tools from Google Project Zero</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-16 @ 11:49:57</span
              ><span class="points-container"
                >Points: <span class="points">249</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39725057"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39724966">
          <h3>
            <a
              class="item"
              href="https://semiengineering.com/the-rising-price-of-power-in-chips/"
              >The Rising Price of Power in Chips</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-16 @ 11:35:39</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39724966"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39724312">
          <h3>
            <a
              class="item"
              href="https://jacquesmattheij.com/refreshablebraille/BrailleDisplayProject.html"
              >Affordable Wheel Based Refreshable Braille Display</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-16 @ 08:52:48</span
              ><span class="points-container"
                >Points: <span class="points">171</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39724312"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39724206">
          <h3>
            <a
              class="item"
              href="https://susam.net/self-printing-machine-code.html"
              >Self-Printing Machine Code (2005)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-16 @ 08:22:12</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39724206"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39724161">
          <h3>
            <a
              class="item"
              href="https://retrocomputing.stackexchange.com/questions/29676/what-is-this-large-device-labelled-telefunken-datenspeicher-and-how-does-it-wo"
              >Telefunken Datenspeicher</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-16 @ 08:11:18</span
              ><span class="points-container"
                >Points: <span class="points">115</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39724161"
                  >Comments</a
                ><span class="descendants">: 54</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39724132">
          <h3>
            <a
              class="item"
              href="https://github.com/fpgmaas/deptry/releases/tag/0.14.0"
              >Show HN: deptry 0.14.0 – detect unused Python dependencies up to
              10 times faster</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-16 @ 08:04:54</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39724132"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
            <div class="text">
              <p>
                For those unfamiliar with deptry; deptry is a command line tool
                to check for issues with dependencies in a Python project, such
                as unused or missing dependencies.
              </p>
              <p>
                GitHub:
                <a href="https://github.com/fpgmaas/deptry"
                  >https://github.com/fpgmaas/deptry</a
                >
              </p>
              <p>
                For some benchmarks of the new release, see the release notes:
              </p>
              <p>
                <a href="https://github.com/fpgmaas/deptry/releases/tag/0.14.0"
                  >https://github.com/fpgmaas/deptry/releases/tag/0.14.0</a
                >
              </p>
              <p>
                The performance improvement was achieved by leveraging Rust to
                parse the AST and extract the import statements from .py files,
                rather than using Python's ast module.
              </p>
              <p>
                The addition of Rust to the project also opens up doors for more
                optimizations in the future, so stay tuned!
              </p>
            </div>
          </section>
        </section>
        <section id="39724045">
          <h3>
            <a
              class="item"
              href="https://abcnews.go.com/US/wireStory/libraries-struggle-afford-demand-books-seek-new-state-108035200"
              >Libraries struggle to afford e-books, seek new laws in fight with
              publishers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-16 @ 07:47:11</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39724045"
                  >Comments</a
                ><span class="descendants">: 96</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39723704">
          <h3>
            <a
              class="item"
              href="https://jamanetwork.com/journals/jama/fullarticle/2816616"
              >Brain waves appear to wash out waste during sleep in mice</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-16 @ 06:01:07</span
              ><span class="points-container"
                >Points: <span class="points">305</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39723704"
                  >Comments</a
                ><span class="descendants">: 165</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39722498">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2403.09611"
              >MM1: Methods, Analysis and Insights from Multimodal LLM
              Pre-training</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-16 @ 01:27:14</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39722498"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39721526">
          <h3>
            <a class="item" href="https://www.workatastartup.com/jobs/55496"
              >Doola (YC S20) Is Hiring a Director of Finance</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-15 @ 22:54:02</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39715793">
          <h3>
            <a class="item" href="https://github.com/robjinman/richard"
              >Show HN: Richard – A CNN written in C++ and Vulkan (no ML or math
              libs)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-15 @ 13:58:14</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39715793"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
            <div class="text">
              <p>
                I don't see many other people using Vulkan for GPGPU, and there
                may be many good reasons for that, but I wanted to try something
                a bit different.
              </p>
              <p>
                I've made every attempt to make the code very clean and readable
                and I've written up the math in documentation/math.pdf, so
                hopefully this is a useful learning resource for anyone
                interested in how neural nets work under the hood.
              </p>
              <p>
                I'll be continuing to add new features over the coming months.
              </p>
            </div>
          </section>
        </section>
        <section id="39712211">
          <h3>
            <a class="item" href="https://github.com/ossc-db/pg_hint_plan"
              >Pg_hint_plan: Force PostgreSQL to execute query plans the way you
              want</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-15 @ 05:02:24</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39712211"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39711725">
          <h3>
            <a class="item" href="https://hugo.blog/2024/03/11/vision-pro/"
              >Vision Pro: What we got wrong at Oculus that Apple got right</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-15 @ 03:15:36</span
              ><span class="points-container"
                >Points: <span class="points">709</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39711725"
                  >Comments</a
                ><span class="descendants">: 698</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39700655">
          <h3>
            <a
              class="item"
              href="https://museum.seiko.co.jp/en/knowledge/trivia02/"
              >On clock faces, 4 is Expressed as IIII, not IV</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-14 @ 04:40:12</span
              ><span class="points-container"
                >Points: <span class="points">307</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39700655"
                  >Comments</a
                ><span class="descendants">: 215</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39688120">
          <h3>
            <a
              class="item"
              href="https://sseh.uchicago.edu/doc/von_Neumann_1955.pdf"
              >Can We Survive Technology? (1955) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-13 @ 04:28:58</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39688120"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
