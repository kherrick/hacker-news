<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="45315746">
          <h3>
            <a
              class="item"
              href="https://learn.microsoft.com/en-us/answers/questions/5561465/the-llm-lobotomy"
              >The LLM Lobotomy</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-20 @ 18:07:28</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45315746"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45315312">
          <h3>
            <a class="item" href="https://jasonspielman.com/notebooklm"
              >Designing NotebookLM</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-20 @ 17:25:58</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45315312"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45314592">
          <h3>
            <a class="item" href="https://seattleultrasonics.com/"
              >Seattle Ultrasonics: Ultrasonic Chef's Knife</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-20 @ 16:12:56</span
              ><span class="points-container"
                >Points: <span class="points">49</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45314592"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45314432">
          <h3>
            <a
              class="item"
              href="https://www.economist.com/science-and-technology/2025/09/19/are-touchscreens-in-cars-dangerous"
              >Are touchscreens in cars dangerous?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-20 @ 15:57:52</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45314432"
                  >Comments</a
                ><span class="descendants">: 79</span></span
              >
            </h4>
            <div class="text">
              <a href="https://archive.ph/u1OqX">https://archive.ph/u1OqX</a>
            </div>
          </section>
        </section>
        <section id="45314157">
          <h3>
            <a
              class="item"
              href="https://utcc.utoronto.ca/~cks/space/blog/linux/SystemdCanBeRestrictionCause"
              >Systemd can be a cause of restrictions on daemons</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-20 @ 15:26:50</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45314157"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45313597">
          <h3>
            <a
              class="item"
              href="https://www.openmymind.net/Is-Zigs-New-Io-Unsafe/"
              >Is Zig's New Writer Unsafe?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-20 @ 14:12:30</span
              ><span class="points-container"
                >Points: <span class="points">106</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45313597"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45313557">
          <h3>
            <a class="item" href="https://gwern.net/doc/science/2019-savage.pdf"
              >Cormac McCarthy's tips on how to write a science paper (2019)
              [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-20 @ 14:08:24</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45313557"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45313418">
          <h3>
            <a
              class="item"
              href="https://www.cell.com/cell-reports-physical-science/fulltext/S2666-3864(25)00409-6"
              >Living microbial cement supercapacitors with reactivatable energy
              storage</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-20 @ 13:51:12</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45313418"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45313415">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/iphone-17-pro-vapor-chamber"
              >Vapor chamber tech keeps iPhone 17 Pro cool</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-20 @ 13:50:58</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45313415"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45313194">
          <h3>
            <a
              class="item"
              href="https://asawicki.info/news_1790_bezier_curve_as_easing_function_in_c"
              >Bezier Curve as Easing Function in C++</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-20 @ 13:27:29</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45313194"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45313127">
          <h3>
            <a
              class="item"
              href="https://www.economist.com/leaders/2025/09/18/chinas-200m-gig-workers-are-a-warning-for-the-world"
              >China's 200M gig workers are a warning for the world</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-20 @ 13:18:16</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45313127"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45312877">
          <h3>
            <a
              class="item"
              href="https://timesofindia.indiatimes.com/technology/tech-news/microsoft-has-a-24-hour-deadline-warning-for-indian-and-other-foreign-employees-after-h1-b-visa-fees-hike-to-100000-strongly-recommend-h1b-visa-holders-/articleshow/124010245.cms"
              >Visa holders on vacation have 15 hours to return to US or pay
              $100k fee</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-20 @ 12:40:34</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45312877"
                  >Comments</a
                ><span class="descendants">: 249</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45312696">
          <h3>
            <a
              class="item"
              href="https://lore.kernel.org/git/20250904-b4-pks-rust-breaking-change-v1-0-3af1d25e0be9@pks.im/"
              >Git: Introduce Rust and announce that it will become mandatory</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-20 @ 12:17:33</span
              ><span class="points-container"
                >Points: <span class="points">237</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45312696"
                  >Comments</a
                ><span class="descendants">: 198</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45312515">
          <h3>
            <a class="item" href="https://dgl.cx/2025/09/images-over-dns"
              >Images over DNS</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-20 @ 11:50:15</span
              ><span class="points-container"
                >Points: <span class="points">115</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45312515"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45311247">
          <h3>
            <a class="item" href="https://focusstream.media"
              >Show HN: FocusStream – Focused, distraction-free YouTube for
              learners</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-20 @ 07:25:03</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45311247"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
            <div class="text">
              <p>
                With FocusStream, just enter your topic and get only the
                relevant YouTube videos—no unrelated suggestions or autoplay.
              </p>
              <p>It’s free, minimal. Would love your feedback!</p>
              <p>
                Try it:
                <a href="https://focusstream.media"
                  >https://focusstream.media</a
                >
                Demo video:
                <a
                  href="https://drive.google.com/file/d/1fCvOJ6kRs9jn7O_hIGgP6wBuq4fzFAOT/view?usp=drive_link"
                  >https://drive.google.com/file/d/1fCvOJ6kRs9jn7O_hIGgP6wBuq4f...</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="45311115">
          <h3>
            <a
              class="item"
              href="https://www.scalarlm.com/blog/llm-deflate-extracting-llms-into-datasets/"
              >LLM-Deflate: Extracting LLMs into Datasets</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-20 @ 06:59:54</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45311115"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45307242">
          <h3>
            <a class="item" href="https://obsidian.md/blog/less-is-safer/"
              >Less is safer: How Obsidian reduces the risk of supply chain
              attacks</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-19 @ 22:02:29</span
              ><span class="points-container"
                >Points: <span class="points">472</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45307242"
                  >Comments</a
                ><span class="descendants">: 222</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45307166">
          <h3>
            <a class="item" href="https://github.com/barddoo/zedis"
              >Show HN: Zedis – A Redis clone I'm writing in Zig</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-19 @ 21:55:43</span
              ><span class="points-container"
                >Points: <span class="points">143</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45307166"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
            <div class="text">Writing Redis from scratch in Zig.</div>
          </section>
        </section>
        <section id="45300865">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/smart-news/these-ant-queens-seem-to-defy-biology-they-lay-eggs-that-hatch-into-another-species-180987292/"
              >Ants that seem to defy biology – They lay eggs that hatch into
              another species</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-19 @ 12:25:50</span
              ><span class="points-container"
                >Points: <span class="points">454</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45300865"
                  >Comments</a
                ><span class="descendants">: 146</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45300810">
          <h3>
            <a
              class="item"
              href="https://windowsread.me/p/best-youtube-downloaders"
              >The best YouTube downloaders, and how Google silenced the
              press</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-19 @ 12:20:10</span
              ><span class="points-container"
                >Points: <span class="points">492</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45300810"
                  >Comments</a
                ><span class="descendants">: 215</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45293012">
          <h3>
            <a class="item" href="https://github.com/rastapasta/mapscii"
              >MapSCII – World Map in Terminal</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-18 @ 18:12:58</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45293012"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45287474">
          <h3>
            <a class="item" href="https://sethmlarson.dev/scream-cipher"
              >Scream cipher</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-18 @ 09:22:39</span
              ><span class="points-container"
                >Points: <span class="points">209</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45287474"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45285711">
          <h3>
            <a
              class="item"
              href="https://github.com/huggingface/evaluation-guidebook/blob/main/yearly_dives/2025-evaluations-for-useful-models.md"
              >Evals in 2025: benchmarks to build models people can use</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-18 @ 05:16:48</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45285711"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45282411">
          <h3>
            <a
              class="item"
              href="https://felipepepe.medium.com/the-gentrification-of-video-game-history-dfe11f1e08ae"
              >The Gentrification of Videogame History</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-17 @ 22:53:44</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45282411"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45276501">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=45276501"
              >Show HN: Math2Tex – Convert handwritten math and complex notes to
              LaTeX text</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-17 @ 14:46:18</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45276501"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
            <div class="text">
              <p>
                I’m the creator of Math2Tex. I was a PhD student, I spend a huge
                amount of my time working with LaTeX, especially when dealing
                with lecture notes, academic papers, and homework. I built
                *Math2Tex*, a lightweight tool that converts handwritten or
                printed academic content — especially math formulas — into LaTeX
                or text
              </p>
              <p>The Problem:</p>
              <p>
                I've always found it incredibly tedious to manually type out
                mathematical formulas, especially complex, multi-line equations
                from my handwritten notes or from a textbook. It's slow, boring,
                and I always make syntax errors. I tried some existing tools,
                but they often struggled with my handwriting or couldn't handle
                mixed content (text and formulas together).
              </p>
              <p>The Solution:</p>
              <p>
                So, I built Math2Tex to solve my own problem. It’s a
                straightforward, single-page web app: you upload an image (a
                photo of your notebook, a screenshot of a PDF, etc.), and it
                converts the academic content into clean LaTeX code or plain
                text. You get a real-time preview and can copy the result with
                one click. My goal was to make the workflow as fast as possible:
                Snap. Convert. Done.
              </p>
              <p>
                You can try it here: [<a href="https://math2tex.com"
                  >https://math2tex.com</a
                >](<a href="https://math2tex.com/">https://math2tex.com/</a>)
              </p>
              <p>
                How is it different from general AI tools like GPT, Claude, etc?
              </p>
              <p>
                This is a fair question. While large models can handle this,
                they are often slow for such a specific task. I wanted something
                faster and more specialized. Math2Tex uses a lightweight model
                fine-tuned specifically for academic content recognition.
              </p>
              <p>
                In short, think of it as a specialized scalpel versus a Swiss
                Army knife. For this particular job, it's generally 3-5x faster
                and, in my experience, more reliable for complex notations.
              </p>
              <p>Tech Stack:</p>
              <p>
                The core OCR engine is a custom-trained model based on a
                transformer architecture, fine-tuned on a large dataset of both
                printed and handwritten academic material. It's all deployed on
                Vercel.
              </p>
              <p>
                *It's free to use.* This is still an early version, and I'm sure
                there are plenty of bugs and areas for improvement. The
                recognition might not be perfect, especially with very messy
                handwriting or some obscure symbols.
              </p>
              <p>
                I would be incredibly grateful for your feedback. Whether you’re
                a student, researcher, or someone who’s fought with LaTeX input.
                Feedback on both the tool and the approach would be really
                helpful.
              </p>
              <p>Thanks!</p>
            </div>
          </section>
        </section>
        <section id="45275058">
          <h3>
            <a
              class="item"
              href="https://www.galois.com/articles/claude-can-sometimes-prove-it"
              >Claude Can (Sometimes) Prove It</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-17 @ 12:30:58</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45275058"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45273032">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2025-09-scientists-ice-generates-electricity-bent.html"
              >Scientists find that ice generates electricity when bent</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-17 @ 07:46:36</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45273032"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45268084">
          <h3>
            <a
              class="item"
              href="https://blog.pypi.org/posts/2025-09-16-github-actions-token-exfiltration/"
              >PyPI Blog: Token Exfiltration Campaign via GitHub Actions
              Workflows</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-16 @ 21:09:47</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45268084"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45265688">
          <h3>
            <a class="item" href="https://www.bbc.com/news/uk-wales-44886585"
              >Escapee pregnancy test frogs colonised Wales for 50 years</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-16 @ 18:08:01</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45265688"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45259623">
          <h3>
            <a
              class="item"
              href="https://jtibs.substack.com/p/if-all-the-world-were-a-monorepo"
              >If all the world were a monorepo</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-09-16 @ 08:33:45</span
              ><span class="points-container"
                >Points: <span class="points">235</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45259623"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
