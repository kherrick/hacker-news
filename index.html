<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42127304">
          <h3>
            <a
              class="item"
              href="https://www.theverge.com/2024/11/13/24295454/grubhub-wonder-acquisition-just-eat-food-delivery-app"
              >Just Eat Is Selling Grubhub to Marc Lore's Wonder for $650M</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-13 @ 16:12:47</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42127304"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42127161">
          <h3>
            <a
              class="item"
              href="https://mattdpearce.substack.com/p/journalisms-fight-for-survival-in"
              >Journalism's fight for survival in a postliterate democracy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-13 @ 15:58:25</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42127161"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42127029">
          <h3>
            <a
              class="item"
              href="https://security.humanativaspa.it/fault-injection-down-the-rabbit-hole/"
              >Fault Injection – Down the Rabbit Hole</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-13 @ 15:46:41</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42127029"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42126984">
          <h3>
            <a
              class="item"
              href="https://news.mit.edu/2024/mit-engineers-make-converting-co2-into-products-more-practical-1113"
              >MIT engineers make converting CO2 into useful products more
              practical</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-13 @ 15:42:06</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42126984"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42126941">
          <h3>
            <a class="item" href="https://puzzlip.com/"
              >Show HN: A simple image puzzle generator</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-13 @ 15:37:22</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42126941"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
            <div class="text">
              <p>
                I built this simple puzzle generator to play around with wasm a
                bit.
              </p>
              <p>
                It's open source if anyone wants to play around with the code
                <a href="https://github.com/lnenad/puzzlip"
                  >https://github.com/lnenad/puzzlip</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="42125903">
          <h3>
            <a
              class="item"
              href="https://community.nodebb.org/topic/254c582c-b8f0-4fef-a746-b7a012e4dad5/elsevier-may-wish-they-had-checked-the-revision-a-bit-more-carefully."
              >Elsevier may wish they had checked the revision a bit more
              carefully</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-13 @ 13:30:34</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42125903"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42125863">
          <h3>
            <a
              class="item"
              href="https://github.com/bahaaador/bluetooth-usb-peripheral-relay"
              >Show HN: Bluetooth USB Peripheral Relay – Bridge Bluetooth
              Devices to USB</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-13 @ 13:24:41</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42125863"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
            <div class="text">
              <p>
                Why? My friend needed a way to use his Bluetooth mouse and
                keyboard on a PC with Bluetooth disabled due to policy
                restrictions. This tool acts as a bridge, relaying Bluetooth
                input over USB. It also lets you use Bluetooth peripherals with
                older devices that only support USB input.
              </p>
              <p>Tech: Written in Go, optimized for Raspberry Pi Zero W.</p>
              <p>
                I love HN’s community and often lurk here—I’m hoping this
                project is useful or at least sparks some interesting
                discussions. Feedback and contributions are welcome!
              </p>
            </div>
          </section>
        </section>
        <section id="42125434">
          <h3>
            <a
              class="item"
              href="https://restofworld.org/2024/grab-google-maps-southeast-asia/"
              >Grab built its own map in Southeast Asia, and is now going after
              Google</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-13 @ 12:20:30</span
              ><span class="points-container"
                >Points: <span class="points">67</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42125434"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42125291">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/hadrius/jobs/7pxGZTl-founding-engineer"
              >Hadrius (YC W23) is hiring engineers looking to grow into future
              founders</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-13 @ 12:00:46</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42125085">
          <h3>
            <a
              class="item"
              href="https://thebulletin.org/2021/11/the-untold-story-of-the-worlds-biggest-nuclear-bomb/"
              >An unearthly spectacle – The untold story of the biggest nuclear
              bomb (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-13 @ 11:26:17</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42125085"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42122690">
          <h3>
            <a
              class="item"
              href="https://blog.tealok.tech/post/docker-compose-isnt-enough/"
              >Docker Compose Isn't Enough</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-13 @ 03:42:43</span
              ><span class="points-container"
                >Points: <span class="points">101</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42122690"
                  >Comments</a
                ><span class="descendants">: 121</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42122642">
          <h3>
            <a
              class="item"
              href="https://github.com/rodneyknaap/atx-286at-v1-mainboard"
              >80286 ATX mainboard based on the IBM 5170 AT PC</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-13 @ 03:34:57</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42122642"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42122085">
          <h3>
            <a class="item" href="https://blog.transitapp.com/go-underground/"
              >No GPS required: our app can now locate underground trains</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-13 @ 01:46:20</span
              ><span class="points-container"
                >Points: <span class="points">686</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42122085"
                  >Comments</a
                ><span class="descendants">: 228</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42121957">
          <h3>
            <a
              class="item"
              href="https://openmw.org/2024/from-bsp-to-esp-how-s3ctor-abused-quake-editors-to-redefine-the-morrowind-modding-experience/"
              >From BSP to ESP – How S3ctor Abused Quake Editors to Redefine the
              Morrowind Mod</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-13 @ 01:23:37</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42121957"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42121345">
          <h3>
            <a
              class="item"
              href="https://cinemasojourns.com/2024/11/12/whats-your-favorite-invasive-species/"
              >Cane Toads: An Unnatural History (1988)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-12 @ 23:52:04</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42121345"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42120566">
          <h3>
            <a
              class="item"
              href="https://www.mathvalues.org/masterblog/a-mathematician-in-a-school-of-art-an-interview-with-edmund-harriss"
              >A Mathematician in a School of Art</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-12 @ 22:40:07</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42120566"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42120385">
          <h3>
            <a
              class="item"
              href="https://skatterbencher.com/2024/11/11/3600-mhz-raspberry-pi-5-with-liquid-nitrogen/"
              >3600 MHz Raspberry Pi 5 with Liquid Nitrogen</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-12 @ 22:18:43</span
              ><span class="points-container"
                >Points: <span class="points">173</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42120385"
                  >Comments</a
                ><span class="descendants">: 60</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42120090">
          <h3>
            <a
              class="item"
              href="https://buttondown.com/hillelwayne/archive/five-unusual-raku-features/"
              >Unusual Raku Features</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-12 @ 21:48:05</span
              ><span class="points-container"
                >Points: <span class="points">229</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42120090"
                  >Comments</a
                ><span class="descendants">: 118</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42118399">
          <h3>
            <a
              class="item"
              href="https://lagrangepoint.substack.com/p/airpods-hearing-aid-hacking"
              >Bypassing regulatory locks, hacking AirPods and Faraday cages</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-12 @ 18:50:45</span
              ><span class="points-container"
                >Points: <span class="points">520</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42118399"
                  >Comments</a
                ><span class="descendants">: 152</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42118286">
          <h3>
            <a
              class="item"
              href="https://community-scripts.github.io/ProxmoxVE/"
              >Show HN: Proxmox VE Helper Scripts</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-12 @ 18:37:17</span
              ><span class="points-container"
                >Points: <span class="points">208</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42118286"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42118039">
          <h3>
            <a class="item" href="https://stretchmytimeoff.com"
              >Show HN: Stretch My Time Off – An Algorithm to Optimize Your
              Vacation Days</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-12 @ 18:11:49</span
              ><span class="points-container"
                >Points: <span class="points">281</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42118039"
                  >Comments</a
                ><span class="descendants">: 142</span></span
              >
            </h4>
            <div class="text">
              <p>
                What it does: The site helps you get the most out of your
                vacation by suggesting optimal days to take off around national
                holidays, maximizing long breaks with minimal vacation days,
                anywhere in the world and for any calendar year.
              </p>
              <p>
                It's an idea I've had for a while, and building the algorithm
                with GPT was a fun challenge. Any feedback or ideas I'm all ears
                :)
              </p>
            </div>
          </section>
        </section>
        <section id="42115310">
          <h3>
            <a
              class="item"
              href="https://aidantr.github.io/files/AI_innovation.pdf"
              >Artificial Intelligence, Scientific Discovery, and Product
              Innovation [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-12 @ 13:29:30</span
              ><span class="points-container"
                >Points: <span class="points">163</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42115310"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42114990">
          <h3>
            <a
              class="item"
              href="https://www.wired.com/story/ecosia-qwant-eusp-take-on-google-search-index/"
              >Two upstart search engines are teaming up to take on Google</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-12 @ 12:27:52</span
              ><span class="points-container"
                >Points: <span class="points">174</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42114990"
                  >Comments</a
                ><span class="descendants">: 241</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42092453">
          <h3>
            <a
              class="item"
              href="https://allthatsinteresting.com/glyptodon-fossils"
              >Argentinian Farmer Finds Family of 20k-Year-Old Car-Sized
              Armadillos</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-09 @ 04:01:29</span
              ><span class="points-container"
                >Points: <span class="points">135</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42092453"
                  >Comments</a
                ><span class="descendants">: 59</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42087275">
          <h3>
            <a
              class="item"
              href="https://pushtoprod.substack.com/p/netflix-terrifying-concurrency-bug"
              >We Built a Self-Healing System to Survive a Concurrency Bug at
              Netflix</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-08 @ 14:52:48</span
              ><span class="points-container"
                >Points: <span class="points">252</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42087275"
                  >Comments</a
                ><span class="descendants">: 122</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42078555">
          <h3>
            <a class="item" href="https://c82.net/mineralogy/#"
              >British and Exotic Mineralogy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-07 @ 17:08:28</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42078555"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42077886">
          <h3>
            <a
              class="item"
              href="https://www.disruptingjapan.com/the-forgotten-mistake-that-killed-japans-software-industry/"
              >A mistake that killed Japan's software industry? (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-07 @ 16:08:15</span
              ><span class="points-container"
                >Points: <span class="points">234</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42077886"
                  >Comments</a
                ><span class="descendants">: 254</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42066358">
          <h3>
            <a
              class="item"
              href="https://rknight.me/blog/thinking-about-recipe-formats-more-than-anyone-should/"
              >Thinking about recipe formats more than anyone should</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-06 @ 17:57:55</span
              ><span class="points-container"
                >Points: <span class="points">96</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42066358"
                  >Comments</a
                ><span class="descendants">: 94</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42059639">
          <h3>
            <a class="item" href="https://github.com/Florents-Tselai/pgpdf"
              >PgPDF: Pdf Type and Functions for Postgres</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-06 @ 10:39:44</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42059639"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42055221">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-10-echolocating-acoustic-cognitive.html"
              >Study shows bats have acoustic cognitive maps</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-11-05 @ 21:14:18</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42055221"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
