<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41865511">
          <h3>
            <a
              class="item"
              href="https://vitalik.eth.limo/general/2024/10/17/futures2.html"
              >Possible futures for the Ethereum protocol, part 2: The Surge</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-17 @ 01:15:46</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41865511"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41864515">
          <h3>
            <a class="item" href="https://lotus3d.github.io/"
              >Lotus: Diffusion-Based Visual Foundation Model for High-Quality
              Dense Prediction</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 22:31:58</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41864515"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41863937">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/reflex/jobs/uBt9ZNP-senior-staff-engineer-infrastructure"
              >Reflex (YC W23) Hiring Senior/Staff Engineer – Infrastructure</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 21:17:35</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41863600">
          <h3>
            <a class="item" href="https://github.com/GreenmaskIO/greenmask"
              >Show HN: Greenmask 0.2 – Database anonymization tool</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 20:37:46</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41863600"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/GreenmaskIO/greenmask"
                >https://github.com/GreenmaskIO/greenmask</a
              >). Today Greenmask is almost 1 year and recently we published one
              of the most significant release with new features:
              <a
                href="https://github.com/GreenmaskIO/greenmask/releases/tag/v0.2.0"
                >https://github.com/GreenmaskIO/greenmask/releases/tag/v0.2.0</a
              >, as well as a new website at
              <a href="https://greenmask.io">https://greenmask.io</a>.
              <p>
                Before I describe Greenmask’s features, I want to share the
                story of how and why I started implementing it.
              </p>
              <p>
                Everyone strives to have their staging environment resemble
                production as closely as possible because it plays a critical
                role in ensuring quality and improving metrics like time to
                delivery. To achieve this, many teams have started migrating
                databases and data from production to staging environments.
                Obviously this requires anonymizing the data, and for this
                people use either custom scripts or existing anonymization
                software.
              </p>
              <p>
                Having worked as a database engineer for 8 years, I frequently
                struggled with routine tasks like setting up development
                environments—this was a common request. Initially, I used custom
                scripts to handle this, but things became increasingly complex
                as the number of services grew, especially with the rise of
                microservices architecture.
              </p>
              <p>
                When I began exploring tools to solve this issue, I listed my
                key expectations for such software: documentation; type safety
                (the tool should validate any changes to the data); streaming (I
                want the ability to stream the data while transformations are
                being applied); consistency (transformations must maintain
                constraints, functional dependencies, and more); reliability;
                customizability; interactivity and usability; simplicity.
              </p>
              <p>
                I found a few options, but none fully met my expectations. Two
                interesting tools I discovered were pganonymizer and replibyte.
                I liked the architecture of Replibyte, but when I tried it, it
                failed due to architectural limitations.
              </p>
              <p>
                With these thoughts in mind, I began developing Greenmask in
                mid-2023. My goal was to create a tool that meets all of these
                requirements, based on the design principles I laid out. Here
                are some key highlights:
              </p>
              <p>
                * It is a single utility - Greenmask delegates the schema dump
                to vendor utilities and takes responsibility only for data dumps
                and transformations.
              </p>
              <p>
                * Database Subset (<a
                  href="https://docs.greenmask.io/latest/database_subset"
                  >https://docs.greenmask.io/latest/database_subset</a
                >) - specify the subset condition and scale down size. We did a
                deep research in graph algorithms and now we can subset almost
                any complexity of database.
              </p>
              <p>
                * Database type safety - it uses the DBMS driver to decode and
                encode data into real types (such as int, float, etc.) in the
                stream. This guarantees consistency and almost eliminates the
                chance of corrupted dumps.
              </p>
              <p>
                * Deterministic engine (<a
                  href="https://docs.greenmask.io/latest/built_in_transformers/transformation_engines/#hash-engine"
                  >https://docs.greenmask.io/latest/built_in_transformers/trans...</a
                >) - generate data using the hash engine that produces
                consistent output for the same input.
              </p>
              <p>
                * Dynamic parameters for transformers (<a
                  href="https://docs.greenmask.io/latest/built_in_transformers/dynamic_parameters"
                  >https://docs.greenmask.io/latest/built_in_transformers/dynam...</a
                >) - imagine having created_at and updated_at dates with
                functional dependencies. Dynamic parameters ensure these dates
                are generated correctly.
              </p>
              <p>
                We are actively maintaining the current project and continuously
                improving it—our public roadmap at
                <a href="https://github.com/orgs/GreenmaskIO/projects/6"
                  >https://github.com/orgs/GreenmaskIO/projects/6</a
                >. Soon, we will release a Python library along with
                transformation collections to help users develop their own
                complex transformations and integrate them with any service. We
                have plans to support more database engines, with MySQL being
                the next one, and we are working on tools which will integrate
                seamlessly with your CI/CD systems.
              </p>
              <p>
                To get started, we’ve prepared a playground for you that can be
                easily set up using Docker Compose:
                <a href="https://docs.greenmask.io/latest/playground/"
                  >https://docs.greenmask.io/latest/playground/</a
                >
              </p>
              <p>I’d love to hear any questions or feedback from you!</p>
            </div>
          </section>
        </section>
        <section id="41863398">
          <h3>
            <a class="item" href="https://github.com/hugohadfield/kalmangrad"
              >Show HN: Automated smooth Nth order derivatives of noisy data</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 20:17:46</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41863398"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/hugohadfield/bayesfilter/"
                >https://github.com/hugohadfield/bayesfilter/</a
              >) so this felt like a fun and very useful first thing to try it
              out on! If people find kalmangrad useful I would be more than
              happy to add a few more features etc. and I would be very grateful
              if people sent in any bugs they spot.. Thanks!
            </div>
          </section>
        </section>
        <section id="41863278">
          <h3>
            <a
              class="item"
              href="https://citizenlab.ca/2024/10/should-we-chat-too-security-analysis-of-wechats-mmtls-encryption-protocol/"
              >Should We Chat, Too? Security Analysis of WeChat's Mmtls
              Encryption Protocol</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 20:06:58</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41863278"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41863061">
          <h3>
            <a
              class="item"
              href="https://github.com/usefulsensors/qc_npu_benchmark"
              >AI PCs Aren't Good at AI: The CPU Beats the NPU</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 19:44:02</span
              ><span class="points-container"
                >Points: <span class="points">289</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41863061"
                  >Comments</a
                ><span class="descendants">: 163</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41862028">
          <h3>
            <a
              class="item"
              href="https://mobeigi.com/blog/gaming/how-we-outsmarted-csgo-cheaters-with-identitylogger/"
              >We outsmarted CSGO cheaters with IdentityLogger</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 18:18:07</span
              ><span class="points-container"
                >Points: <span class="points">163</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41862028"
                  >Comments</a
                ><span class="descendants">: 180</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41861442">
          <h3>
            <a
              class="item"
              href="https://spidermonkey.dev/blog/2024/10/16/75x-faster-optimizing-the-ion-compiler-backend.html"
              >Optimizing the Ion compiler back end</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 17:15:24</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41861442"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41861056">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2024/10/winamp-really-whips-open-source-coders-into-frenzy-with-its-source-release/"
              >Winamp deletes entire GitHub source code repo after a rocky few
              weeks</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 16:34:15</span
              ><span class="points-container"
                >Points: <span class="points">335</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41861056"
                  >Comments</a
                ><span class="descendants">: 247</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41860909">
          <h3>
            <a
              class="item"
              href="https://docs.sweeting.me/s/archivebox-plugin-ecosystem-announcement"
              >ArchiveBox is evolving: the future of self-hosted internet
              archives</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 16:18:39</span
              ><span class="points-container"
                >Points: <span class="points">478</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41860909"
                  >Comments</a
                ><span class="descendants">: 116</span></span
              >
            </h4>
            <div class="text">
              We've been pushing really hard over the last 6mo to develop this
              release. I'd love to hear feedback from people who've worked on
              big plugin systems in the past, or anyone who's tried our betas!
            </div>
          </section>
        </section>
        <section id="41859968">
          <h3>
            <a
              class="item"
              href="https://youtubetranscriptoptimizer.com/blog/02_what_i_learned_making_the_python_backend_for_yto"
              >Making the Python back end for my new webapp</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 15:08:56</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41859968"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41859805">
          <h3>
            <a class="item" href="https://nvlabs.github.io/Sana/"
              >Efficient high-resolution image synthesis with linear diffusion
              transformer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 14:56:22</span
              ><span class="points-container"
                >Points: <span class="points">151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41859805"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41859466">
          <h3>
            <a class="item" href="https://mistral.ai/news/ministraux/"
              >Un Ministral, Des Ministraux</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 14:31:18</span
              ><span class="points-container"
                >Points: <span class="points">181</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41859466"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41859047">
          <h3>
            <a
              class="item"
              href="https://www.aboutamazon.com/news/devices/new-kindle-color-scribe-paperwhite-entry"
              >Amazon reveals first color Kindle, new Kindle Scribe, and more</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 13:52:55</span
              ><span class="points-container"
                >Points: <span class="points">171</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41859047"
                  >Comments</a
                ><span class="descendants">: 295</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41859012">
          <h3>
            <a
              class="item"
              href="https://azadux.blog/2024/10/08/traveling-with-apple-vision-pro/"
              >Traveling with Apple Vision Pro</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 13:48:51</span
              ><span class="points-container"
                >Points: <span class="points">352</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41859012"
                  >Comments</a
                ><span class="descendants">: 446</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41858975">
          <h3>
            <a class="item" href="https://gist.github.com/jackrusher/5139396"
              >Hofstadter on Lisp (1983)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 13:44:37</span
              ><span class="points-container"
                >Points: <span class="points">312</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41858975"
                  >Comments</a
                ><span class="descendants">: 126</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41858665">
          <h3>
            <a
              class="item"
              href="https://www.ftc.gov/news-events/news/press-releases/2024/10/federal-trade-commission-announces-final-click-cancel-rule-making-it-easier-consumers-end-recurring"
              >FTC announces "click-to-cancel" rule making it easier to cancel
              subscriptions</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 13:09:04</span
              ><span class="points-container"
                >Points: <span class="points">1307</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41858665"
                  >Comments</a
                ><span class="descendants">: 596</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41855307">
          <h3>
            <a
              class="item"
              href="https://www.backpacker.com/skills/outdoor-first-aid/are-those-stomach-troubles-celiac-or-giardia/"
              >Medical student's apparent celiac disease responded to giardiasis
              treatment</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 03:25:14</span
              ><span class="points-container"
                >Points: <span class="points">197</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41855307"
                  >Comments</a
                ><span class="descendants">: 109</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41855006">
          <h3>
            <a
              class="item"
              href="https://nabeelqu.substack.com/p/reflections-on-palantir"
              >Reflections on Palantir</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-16 @ 02:18:29</span
              ><span class="points-container"
                >Points: <span class="points">234</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41855006"
                  >Comments</a
                ><span class="descendants">: 228</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41849718">
          <h3>
            <a class="item" href="https://github.com/woct0rdho/triton"
              >Triton Fork for Windows Support</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 15:40:12</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41849718"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41847787">
          <h3>
            <a
              class="item"
              href="https://fidoalliance.org/fido-alliance-publishes-new-specifications-to-promote-user-choice-and-enhanced-ux-for-passkeys/"
              >FIDO Alliance publishes new spec to let users move passkeys
              across providers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 12:18:36</span
              ><span class="points-container"
                >Points: <span class="points">183</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41847787"
                  >Comments</a
                ><span class="descendants">: 164</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41847563">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2022-10-solar-gravitational-lens-humanity-powerful.html"
              >A solar gravitational lens will be humanity's most powerful
              telescope (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 11:52:48</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41847563"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41846623">
          <h3>
            <a class="item" href="https://speakmyvoice.com"
              >Show HN: SpeakMyVoice – App for people with vocal or speech
              difficulties</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 09:16:36</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41846623"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41846471">
          <h3>
            <a
              class="item"
              href="https://news.cnrs.fr/articles/why-birds-do-not-fall-while-sleeping"
              >Why birds do not fall while sleeping</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 08:56:03</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41846471"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41845669">
          <h3>
            <a
              class="item"
              href="https://jank-lang.org/blog/2024-10-14-llvm-ir/"
              >Jank development update – Moving to LLVM IR</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 06:50:51</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41845669"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41845256">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41845256"
              >Ask HN: How do you add guard rails in LLM response without
              breaking streaming?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 05:35:30</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41845256"
                  >Comments</a
                ><span class="descendants">: 17</span></span
              >
            </h4>
            <div class="text">
              Hi all, I am trying to build a simple LLM bot and want to add
              guard rails so that the LLM responses are constrained. I tried
              adjusting system prompt but the response does not always honour
              the instructions from prompt. I can manually add validation on the
              response but then it breaks streaming and hence is visibly slower
              in response. How are people handling this situation?
            </div>
          </section>
        </section>
        <section id="41845232">
          <h3>
            <a
              class="item"
              href="https://www.infoq.com/articles/cell-based-architecture-distributed-systems/"
              >Cell-Based Architecture Enhances Modern Distributed Systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-15 @ 05:30:09</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41845232"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41839686">
          <h3>
            <a class="item" href="https://github.com/homebrewltd/ichigo"
              >Ichigo: Local real-time voice AI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-14 @ 17:25:50</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41839686"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
            <div class="text">
              <a
                href="https://www.reddit.com/r/LocalLLaMA/comments/1g38e9s/ichigollama31_local_realtime_voice_ai/"
                >https://www.reddit.com/r/LocalLLaMA/comments/1g38e9s/ichigol...</a
              >
              <p>There were several links:</p>
              <p>
                - Blog for details:
                <a href="https://homebrew.ltd/blog/llama-learns-to-talk"
                  >https://homebrew.ltd/blog/llama-learns-to-talk</a
                >
              </p>
              <p>
                - Code:
                <a href="https://github.com/homebrewltd/ichigo"
                  >https://github.com/homebrewltd/ichigo</a
                >
              </p>
              <p>
                - Run locally:
                <a href="https://github.com/homebrewltd/ichigo-demo/tree/docker"
                  >https://github.com/homebrewltd/ichigo-demo/tree/docker</a
                >
              </p>
              <p>
                - Demo on a single 3090:
                <a href="https://ichigo.homebrew.ltd/"
                  >https://ichigo.homebrew.ltd/</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="41835957">
          <h3>
            <a
              class="item"
              href="https://donraab.medium.com/10-billion-integers-walk-into-an-array-37097386c964"
              >10B Integers Walk into an Array</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-14 @ 09:59:37</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41835957"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
