<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41741333">
          <h3>
            <a
              class="item"
              href="https://profmattstrassler.com/2024/10/01/why-is-the-speed-of-light-so-fast-part-1/"
              >Why Is the Speed of Light So Fast? (Part 1)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-04 @ 13:46:28</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41741333"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41741002">
          <h3>
            <a
              class="item"
              href="https://waymo.com/blog/2024/10/waymo-and-hyundai-enter-partnership/"
              >Waymo and Hyundai enter multi-year, strategic partnership</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-04 @ 13:08:18</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41741002"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41740965">
          <h3>
            <a
              class="item"
              href="https://ai.meta.com/research/movie-gen/?_fb_noscript=1"
              >AI at Meta: Movie Gen</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-04 @ 13:03:00</span
              ><span class="points-container"
                >Points: <span class="points">227</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41740965"
                  >Comments</a
                ><span class="descendants">: 154</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41740915">
          <h3>
            <a class="item" href="https://github.com/ravachol/kew"
              >Show HN: kew â€“ A Terminal Music Player for Linux</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-04 @ 12:56:54</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41740915"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
            <div class="text">
              <p>I created kew, a music player for the Linux terminal.</p>
              <p>
                This started when I asked myself: what if I could just type
                something like "play nirvana" in the terminal and have the rest
                taken care of automatically? That got the ball rolling and I
                kept adding stuff: covers in ascii and then as sixel images, a
                playlist view, a visualizer, a library view and finally search.
              </p>
              <p>
                While kew can be used as a commandline tool, it has evolved into
                a TUI app.
              </p>
              <p>Here are some example commands:</p>
              <p>kew nirvana # Plays all of your Nirvana songs, shuffled</p>
              <p>kew nevermind # Plays the "Nevermind" album in order</p>
              <p>kew spirit # Plays "Smells Like Teen Spirit"</p>
              <p>kew all # Plays all your music, shuffled</p>
              <p>
                kew albums # Plays one album after the other in random order
              </p>
              <p>
                It works best when your music library is organized like this:
                Artist/Album(s)/Track(s)
              </p>
              <p>kew is written in C and licensed under GPLv2.</p>
              <p>
                Source and screenshot:
                <a href="https://github.com/ravachol/kew"
                  >https://github.com/ravachol/kew</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="41740568">
          <h3>
            <a class="item" href="https://stuffmatic.com/chebyshev/"
              >Show HN: Chebyshev approximation calculator (open source web
              app)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-04 @ 12:09:18</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41740568"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
            <div class="text">
              <p>
                here's a web app I made that generates code for efficiently
                approximating mathematical functions. This is useful when
                performance matters more than perfect accuracy, for example in
                embedded systems.
              </p>
              <p>
                The app uses Chebyshev expansions, which despite their
                theoretical depth result in suprisingly compact and readable
                code in practice. This code is generated for you and using it
                does not require any knowledge of the underlying theory.
              </p>
              <p>
                Source code and more info:
                <a href="https://github.com/stuffmatic/chebyshev-calculator"
                  >https://github.com/stuffmatic/chebyshev-calculator</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="41740497">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/companies/nowadays"
              >Nowadays (YC S23) Is Hiring a Founding Engineer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-04 @ 12:00:03</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41740134">
          <h3>
            <a class="item" href="https://tiniuc.com/chord-chart-memo/"
              >Show HN: A tool for creating chord charts on the go</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-04 @ 11:00:33</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41740134"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41739578">
          <h3>
            <a class="item" href="https://www.c64os.com/c64os/programmersguide/"
              >C64 OS Programmer's Guide</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-04 @ 09:36:20</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41739578"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41738914">
          <h3>
            <a
              class="item"
              href="https://techcrunch.com/2024/10/04/159-employees-are-leaving-automattic-as-ceos-fight-with-wp-engine-escalates/"
              >Some Automattic employees accept severance package offer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-04 @ 07:55:49</span
              ><span class="points-container"
                >Points: <span class="points">187</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41738914"
                  >Comments</a
                ><span class="descendants">: 202</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41738552">
          <h3>
            <a class="item" href="https://nv1t.github.io/blog/kekz-headphones/"
              >Reverse Engineering and Dismantling Kekz Headphones</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-04 @ 06:55:58</span
              ><span class="points-container"
                >Points: <span class="points">109</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41738552"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41738502">
          <h3>
            <a
              class="item"
              href="https://szymonkaliski.com/projects/cartographist/"
              >Experimental web browser optimized for rabbit-holing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-04 @ 06:47:57</span
              ><span class="points-container"
                >Points: <span class="points">327</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41738502"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41738434">
          <h3>
            <a
              class="item"
              href="https://www.independent.co.uk/life-style/blue-zones-netflix-ignobel-prize-b2622952.html"
              >New research says blue zones can be explained by comically flawed
              data</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-04 @ 06:32:44</span
              ><span class="points-container"
                >Points: <span class="points">127</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41738434"
                  >Comments</a
                ><span class="descendants">: 82</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41737326">
          <h3>
            <a
              class="item"
              href="https://www.ycombinator.com/blog/correcting-the-record/"
              >Correcting the record for Continue and PearAI</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-04 @ 02:50:15</span
              ><span class="points-container"
                >Points: <span class="points">130</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41737326"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41737243">
          <h3>
            <a class="item" href="https://pthorpe92.dev/programming/magic/"
              >Magic Isn't Real</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-04 @ 02:33:14</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41737243"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41736903">
          <h3>
            <a
              class="item"
              href="https://unix.stackexchange.com/questions/405783/why-does-man-print-gimme-gimme-gimme-at-0030"
              >Why does man print "gimme gimme gimme" at 00:30? (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-04 @ 01:25:51</span
              ><span class="points-container"
                >Points: <span class="points">589</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41736903"
                  >Comments</a
                ><span class="descendants">: 246</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41736470">
          <h3>
            <a
              class="item"
              href="https://www.aquasec.com/blog/perfctl-a-stealthy-malware-targeting-millions-of-linux-servers/"
              >Perfctl: A Stealthy Malware Targeting Linux Servers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-04 @ 00:14:56</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41736470"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41735761">
          <h3>
            <a class="item" href="https://github.com/cxreiff/ttysvr"
              >Show HN: Screensavers for your terminal (Bevy/Ratatui)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-03 @ 22:29:23</span
              ><span class="points-container"
                >Points: <span class="points">72</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41735761"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41735544">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/in-memoriam-oct-2024"
              >Robert Dennard, DRAM Pioneer, has died</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-03 @ 22:03:27</span
              ><span class="points-container"
                >Points: <span class="points">288</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41735544"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41734047">
          <h3>
            <a
              class="item"
              href="https://ericnormand.me/article/the-heart-of-unix"
              >The Heart of Unix (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-03 @ 19:25:41</span
              ><span class="points-container"
                >Points: <span class="points">137</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41734047"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41733714">
          <h3>
            <a class="item" href="https://github.com/xroche/httrack"
              >HTTrack Website Copier</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-03 @ 18:53:35</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41733714"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41733659">
          <h3>
            <a
              class="item"
              href="https://myswamp.substack.com/p/improving-accessibility-using-vision"
              >Improving Accessibility Using Vision Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-03 @ 18:48:26</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41733659"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41732853">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2410.01201"
              >Were RNNs all we needed?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-03 @ 17:31:59</span
              ><span class="points-container"
                >Points: <span class="points">408</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41732853"
                  >Comments</a
                ><span class="descendants">: 198</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41732634">
          <h3>
            <a class="item" href="https://openai.com/index/introducing-canvas/"
              >Canvas is a new way to write and code with ChatGPT</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-03 @ 17:07:23</span
              ><span class="points-container"
                >Points: <span class="points">846</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41732634"
                  >Comments</a
                ><span class="descendants">: 619</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41732415">
          <h3>
            <a
              class="item"
              href="https://it-notes.dragas.net/2024/10/03/i-solve-problems-eurobsdcon/"
              >Why and how weâ€™re migrating many of our servers from Linux to the
              BSDs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-03 @ 16:45:05</span
              ><span class="points-container"
                >Points: <span class="points">241</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41732415"
                  >Comments</a
                ><span class="descendants">: 135</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41731769">
          <h3>
            <a class="item" href="https://mikrophone.net/"
              >MikroPhone: A privacy enhanced, simple and featured RISC-V mobile
              phone</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-03 @ 15:41:34</span
              ><span class="points-container"
                >Points: <span class="points">176</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41731769"
                  >Comments</a
                ><span class="descendants">: 53</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41730896">
          <h3>
            <a
              class="item"
              href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0196636"
              >Dance training superior to physical exercise in inducing brain
              plasticity (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-03 @ 14:01:23</span
              ><span class="points-container"
                >Points: <span class="points">279</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41730896"
                  >Comments</a
                ><span class="descendants">: 160</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41730415">
          <h3>
            <a
              class="item"
              href="https://blog.cloudflare.com/patent-troll-sable-pays-up/"
              >Patent troll Sable pays up, dedicates all its patents to the
              public</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-03 @ 13:05:16</span
              ><span class="points-container"
                >Points: <span class="points">1151</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41730415"
                  >Comments</a
                ><span class="descendants">: 341</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41719707">
          <h3>
            <a class="item" href="https://github.com/kellabyte/holocron"
              >Holocron is an object storage based leader election library</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-02 @ 12:09:53</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41719707"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41719335">
          <h3>
            <a
              class="item"
              href="https://www.w3.org/International/questions/qa-personal-names"
              >Personal Names Around the World (2011)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-10-02 @ 11:19:34</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41719335"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41701864">
          <h3>
            <a
              class="item"
              href="https://www.historytoday.com/archive/feature/secrets-silk-road"
              >The Silk Road (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-09-30 @ 20:43:04</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41701864"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
