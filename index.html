<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="41217313">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/information-technology/2024/08/chatgpt-unexpectedly-began-speaking-in-a-users-cloned-voice-during-testing/"
              >ChatGPT unexpectedly began speaking in a user's cloned voice
              during testing</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 16:28:39</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41217313"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41217109">
          <h3>
            <a class="item" href="https://grandmasword.com"
              >Show HN: My 70 year old grandma is learning to code and made a
              word game</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 16:01:50</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41217109"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41217037">
          <h3>
            <a
              class="item"
              href="https://twitter.com/singe/status/1822324795645575263"
              >CrowdStrike accepting the PwnieAwards for "most epic fail" at
              defcon</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 15:52:00</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41217037"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41216560">
          <h3>
            <a class="item" href="https://madebyevan.com/fsm/"
              >Finite State Machine Designer</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 14:48:26</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41216560"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41216083">
          <h3>
            <a
              class="item"
              href="https://iopscience.iop.org/article/10.1088/1367-2630/ac4921/meta"
              >A high energy hadron collider on the Moon</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 13:41:41</span
              ><span class="points-container"
                >Points: <span class="points">43</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41216083"
                  >Comments</a
                ><span class="descendants">: 49</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41215727">
          <h3>
            <a class="item" href="https://github.com/versotile-org/verso"
              >Verso – web browser built on top of the Servo web engine</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 12:34:41</span
              ><span class="points-container"
                >Points: <span class="points">307</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41215727"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41215724">
          <h3>
            <a class="item" href="https://louisabraham.github.io/chessviz/"
              >Show HN: Visualizing Chess Games</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 12:33:40</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41215724"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41215679">
          <h3>
            <a
              class="item"
              href="https://www.textualize.io/blog/7-things-ive-learned-building-a-modern-tui-framework/"
              >Things I've learned building a modern TUI Framework</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 12:22:50</span
              ><span class="points-container"
                >Points: <span class="points">66</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41215679"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41215593">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2407.16741"
              >OpenDevin: An Open Platform for AI Software Developers as
              Generalist Agents</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 12:02:55</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41215593"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41215489">
          <h3>
            <a
              class="item"
              href="https://www.pcmag.com/news/samsung-to-mass-produce-solid-state-batteries-for-super-premium-evs-by"
              >Samsung to Mass-Produce Solid-State Batteries for 'Super Premium'
              EVs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 11:35:16</span
              ><span class="points-container"
                >Points: <span class="points">76</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41215489"
                  >Comments</a
                ><span class="descendants">: 116</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41215201">
          <h3>
            <a
              class="item"
              href="https://seattledataguy.substack.com/p/why-your-data-stack-wont-last-and"
              >Building data infrastructure that will last</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 10:24:06</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41215201"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41214762">
          <h3>
            <a
              class="item"
              href="https://discuss.haiku-os.org/t/progress-on-porting-firefox/13493?page=7"
              >Firefox Browser Ported to HaikuOS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 08:23:43</span
              ><span class="points-container"
                >Points: <span class="points">289</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41214762"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41214307">
          <h3>
            <a class="item" href="https://github.com/Wren6991/Hazard3"
              >Hazard3: 3-stage RV32IMACZb* processor with debug</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 06:12:02</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41214307"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41214259">
          <h3>
            <a
              class="item"
              href="https://stevecoast.substack.com/p/the-days-are-long-but-the-years-are"
              >OpenStreetMap Is Turning 20</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 06:00:17</span
              ><span class="points-container"
                >Points: <span class="points">315</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41214259"
                  >Comments</a
                ><span class="descendants">: 89</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41214180">
          <h3>
            <a
              class="item"
              href="https://www.ribbonfarm.com/2009/10/07/the-gervais-principle-or-the-office-according-to-the-office/"
              >The Gervais Principle, or the Office According to “The Office”
              (2009)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 05:35:12</span
              ><span class="points-container"
                >Points: <span class="points">205</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41214180"
                  >Comments</a
                ><span class="descendants">: 124</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41213711">
          <h3>
            <a class="item" href="https://cjycode.com/posts/rust-ui-flutter/"
              >Show HN: Rust GUI Library via Flutter</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 02:55:20</span
              ><span class="points-container"
                >Points: <span class="points">226</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41213711"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
            <div class="text">
              <a href="https://github.com/fzyzcjy/flutter_rust_bridge"
                >https://github.com/fzyzcjy/flutter_rust_bridge</a
              >
              v2.0.0) between Flutter and Rust, which auto translates syntaxes
              like arbitrary types, &amp;mut, async, traits, results, closure
              (callback), lifetimes, etc. The goal is to make a bridge between
              the two, seamlessly as if working in one single language.
              <p>
                Then, as an example, I showed how to write Rust applications
                with GUI by utilizing Flutter. That is discussed in the link in
                details.
              </p>
              <p>
                To play with it, please visit the GitHub repo, or refer to the
                end of the article for detailed folders and commands.
              </p>
              <p>
                When I first released 1.0.0 years ago, it only contained few
                features compared to today. It is the result of the hard work of
                contributors and me, and many thanks to all the contributors!
              </p>
            </div>
          </section>
        </section>
        <section id="41213561">
          <h3>
            <a class="item" href="https://blog.isaacmiller.dev/posts/dspy"
              >Betting on DSPy for Systems of LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 02:11:47</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41213561"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41213442">
          <h3>
            <a class="item" href="https://www.rfc-editor.org/rfc/rfc9180.html"
              >RFC 9180: Hybrid Public Key Encryption (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-11 @ 01:41:18</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41213442"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41213053">
          <h3>
            <a class="item" href="https://chevyray.dev/blog/creating-175-fonts/"
              >I Created 175 Fonts Using Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 23:52:44</span
              ><span class="points-container"
                >Points: <span class="points">394</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41213053"
                  >Comments</a
                ><span class="descendants">: 72</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41212271">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/2024/08/10/amds-strix-point-zen-5-hits-mobile/"
              >AMD's Strix Point: Zen 5 Hits Mobile</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 21:18:51</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41212271"
                  >Comments</a
                ><span class="descendants">: 147</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41212193">
          <h3>
            <a
              class="item"
              href="https://blog.gingerbeardman.com/2024/08/10/stapler-i-remade-a-32-year-old-classic-macintosh-app/"
              >Stapler: I remade a 32 year old classic Macintosh app</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 21:03:04</span
              ><span class="points-container"
                >Points: <span class="points">173</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41212193"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41211540">
          <h3>
            <a
              class="item"
              href="https://www.science.org/content/blog-post/things-i-won-t-work-dimethylcadmium"
              >Things I Won't Work With: Dimethylcadmium (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 19:11:39</span
              ><span class="points-container"
                >Points: <span class="points">247</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41211540"
                  >Comments</a
                ><span class="descendants">: 147</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41209688">
          <h3>
            <a class="item" href="https://github.com/evilsocket/opensnitch"
              >OpenSnitch is a GNU/Linux interactive application firewall</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 14:15:52</span
              ><span class="points-container"
                >Points: <span class="points">360</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41209688"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41208988">
          <h3>
            <a class="item" href="https://roitman.io/blog/91"
              >A wonderful coincidence or an expected connection: why π² ≈ g</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-10 @ 12:24:54</span
              ><span class="points-container"
                >Points: <span class="points">452</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41208988"
                  >Comments</a
                ><span class="descendants">: 299</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41204368">
          <h3>
            <a
              class="item"
              href="https://www.collectorsweekly.com/articles/how-a-gang-of-harmonica-geeks-saved-the-soul-of-the-blues-harp/"
              >A gang of harmonica geeks saved the soul of the blues harp
              (2013)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-09 @ 18:48:32</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41204368"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41203269">
          <h3>
            <a class="item" href="https://www.nissin.com/en_jp/about/founder/"
              >Our Founder – Momofuku Ando</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-09 @ 16:24:28</span
              ><span class="points-container"
                >Points: <span class="points">146</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41203269"
                  >Comments</a
                ><span class="descendants">: 51</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41191369">
          <h3>
            <a
              class="item"
              href="https://www.penguin.co.uk/articles/2023/03/what-is-the-ideal-chapter-length"
              >What is the ideal chapter length? (2023)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-08 @ 13:39:38</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41191369"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41182109">
          <h3>
            <a
              class="item"
              href="https://journals.biologists.com/jeb/article/211/24/3836/18013/Limits-to-running-speed-in-dogs-horses-and-humans"
              >Limits to running speed in dogs, horses and human</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-07 @ 14:57:15</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41182109"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
          </section>
        </section>
        <section id="41180492">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=41180492"
              >Ask HN: How to Price a Product</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-07 @ 12:02:27</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41180492"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
            <div class="text">
              <p>
                I built a working concept that converts designs to interactive
                code. However, the tech is not usable at this stage, no
                documentation and looks bad, but works as expected.
              </p>
              <p>
                I'm aware of selling services as SAAS. I'd like to sell the tech
                as a product containing a software, product manual, usage
                instructions with samples.
              </p>
              <p>
                The target users are designers, initial feedbacks were some
                points to address and they are curious and interested.
              </p>
              <p>
                Having said that it's not SAAS, not subscription based, I'd like
                to know how to put a price on it as a product.
              </p>
            </div>
          </section>
        </section>
        <section id="41178388">
          <h3>
            <a
              class="item"
              href="https://www.cut-the-knot.org/blue/12CoinsInVerse.shtml#solution"
              >12 Coins in Verse: Genius solution of twelve balls and a scale
              problem</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-08-07 @ 05:05:34</span
              ><span class="points-container"
                >Points: <span class="points">4</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=41178388"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
