<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="36446289">
          <h3>
            <a
              class="item"
              href="https://www.timesofisrael.com/groundbreaking-ai-project-translates-5000-year-old-cuneiform-at-push-of-a-button/"
              >Groundbreaking AI project translates 5k-year-old cuneiform</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-23 @ 13:05:16</span
              ><span class="points-container"
                >Points: <span class="points">20</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36446289"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36446045">
          <h3>
            <a class="item" href="https://editor.vrite.io/"
              >Show HN: I've built open-source, collaborative, WYSIWYG Markdown
              editor</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-23 @ 12:40:12</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36446045"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
            <div class="text">
              <p>Some features worth highlighting:</p>
              <p>- Monaco editor and Prettier integration for code snippets</p>
              <p>- Tables (apparently the holy grail of WYSIWYG editing)</p>
              <p>
                - Embeds (for CodePen, CodeSandbox and YouTube, most useful for
                HTML or JSON exports)
              </p>
              <p>
                - Accepts Markdown paste-in, and "exports"/generates HTML,
                Markdown and JSON outputs
              </p>
              <p>
                - Collaboration (with real-time awareness and initial commenting
                system, available only when logged in)
              </p>
              <p>
                - GPT-3.5 integration (only when logged-in with the
                corresponding extension installed)
              </p>
              <p>Stack used: TipTap, Solid.js, HocusPocus, Fastify, tRPC.</p>
              <p>Some notable drawbacks:</p>
              <p>- No mobile support</p>
              <p>
                - Collaboration available only between signed-in users, in the
                same workspace;
              </p>
              <p>
                - I tried my best to support most common Markdown formatting,
                pasting and in-editor shortcuts, though there might still be
                room for improvement
              </p>
              <p>
                - Self-hosting isn't easy right now, though you should be able
                to figure it out from the source code
              </p>
              <p>
                The editor itself is a standalone app, extracted from the larger
                Vrite CMS project (<a href="https://github.com/vriteio/vrite"
                  >https://github.com/vriteio/vrite</a
                >) which you can also test out (only with sign-in) here:
                <a href="https://app.vrite.io/">https://app.vrite.io/</a>
              </p>
            </div>
          </section>
        </section>
        <section id="36445875">
          <h3>
            <a
              class="item"
              href="https://en.wikipedia.org/wiki/The_Most_Mysterious_Song_on_the_Internet"
              >The Most Mysterious Song on the Internet</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-23 @ 12:24:47</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36445875"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36445693">
          <h3>
            <a
              class="item"
              href="https://responsiblestatecraft.org/2023/06/20/the-pentagons-52000-trash-can/"
              >The Pentagon’s $52k trash can</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-23 @ 12:04:44</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36445693"
                  >Comments</a
                ><span class="descendants">: 208</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36445656">
          <h3>
            <a
              class="item"
              href="https://jobs.lever.co/givecampus/44af3199-546a-404a-95fd-a097ef37e915"
              >GiveCampus (YC S15) hiring rails engineers passionate about
              education</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-23 @ 12:01:16</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36445625">
          <h3>
            <a
              class="item"
              href="https://ohwr.org/project/white-rabbit/wikis/home"
              >White Rabbit Project (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-23 @ 11:57:05</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36445625"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36445278">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2023-06-23/fdic-insured-billions-in-deposits-for-sequoia-other-top-svb-customers"
              >Big VC, Tech Got Backstop for Billions in Uninsured SVB
              Deposits</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-23 @ 11:10:05</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36445278"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36445093">
          <h3>
            <a
              class="item"
              href="https://computeradsfromthepast.substack.com/p/byte-interview-with-the-creators"
              >Byte Interview with the Creators of the Macintosh from 1984</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-23 @ 10:44:13</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36445093"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36444839">
          <h3>
            <a
              class="item"
              href="https://docs.github.com/en/get-started/privacy-on-github/about-githubs-use-of-your-data"
              >About GitHub’s use of your data</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-23 @ 10:04:44</span
              ><span class="points-container"
                >Points: <span class="points">309</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36444839"
                  >Comments</a
                ><span class="descendants">: 222</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36443977">
          <h3>
            <a
              class="item"
              href="https://dl.acm.org/doi/proceedings/10.1145/3593856"
              >Proceedings of the 19th Workshop on Hot Topics in Operating
              Systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-23 @ 07:42:42</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36443977"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36443747">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=Kcohq313q00"
              >Amazon cancels my account after exposing account lockout for
              “racist doorbell” [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-23 @ 07:06:41</span
              ><span class="points-container"
                >Points: <span class="points">545</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36443747"
                  >Comments</a
                ><span class="descendants">: 306</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36443676">
          <h3>
            <a
              class="item"
              href="https://google-research.github.io/seanet/audiopalm/examples/"
              >AudioPaLM: A Large Language Model That Can Speak and Listen</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-23 @ 06:54:10</span
              ><span class="points-container"
                >Points: <span class="points">54</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36443676"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36443596">
          <h3>
            <a class="item" href="https://fly.io/ruby-dispatch/smooth-fly-dev/"
              >Around the World with SQLite3 and Rsync</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-23 @ 06:40:43</span
              ><span class="points-container"
                >Points: <span class="points">61</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36443596"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36443398">
          <h3>
            <a
              class="item"
              href="https://www.suse.com/c/closing-the-leap-gap-src/"
              >Closing the Leap Gap (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-23 @ 06:07:47</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36443398"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36442274">
          <h3>
            <a class="item" href="https://animejs.com/"
              >Anime.js – A lightweight JavaScript animation library</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-23 @ 02:56:19</span
              ><span class="points-container"
                >Points: <span class="points">421</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36442274"
                  >Comments</a
                ><span class="descendants">: 96</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36442209">
          <h3>
            <a
              class="item"
              href="https://courses.cs.washington.edu/courses/cse391/23sp/"
              >UW CSE 391 – System and Software Tools</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-23 @ 02:46:13</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36442209"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36441537">
          <h3>
            <a
              class="item"
              href="https://www.statnews.com/2023/06/21/cryogenic-organ-preservation-transplants/"
              >Scientists unfroze rat organs and transplanted them</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-23 @ 01:15:25</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36441537"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36441266">
          <h3>
            <a
              class="item"
              href="http://www.cmyr.net/blog/gui-framework-ingredients.html"
              >So you want to write a GUI framework (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-23 @ 00:44:58</span
              ><span class="points-container"
                >Points: <span class="points">168</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36441266"
                  >Comments</a
                ><span class="descendants">: 97</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36440980">
          <h3>
            <a
              class="item"
              href="https://www.fda.gov/news-events/press-announcements/fda-approves-first-gene-therapy-treatment-certain-patients-duchenne-muscular-dystrophy"
              >FDA approves first gene therapy treatment of Duchenne muscular
              dystrophy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-23 @ 00:05:06</span
              ><span class="points-container"
                >Points: <span class="points">207</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36440980"
                  >Comments</a
                ><span class="descendants">: 64</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36440911">
          <h3>
            <a
              class="item"
              href="https://www.uclahealth.org/news/eating-microwave-popcorn-increases-the-level-of-pfas-in-body"
              >Eating microwave popcorn increases the level of PFAS in body
              (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 23:56:42</span
              ><span class="points-container"
                >Points: <span class="points">288</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36440911"
                  >Comments</a
                ><span class="descendants">: 320</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36431004">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=36431004"
              >Launch HN: OpenMeter (YC W23) – Real-Time, Open Source Usage
              Metering</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 12:19:44</span
              ><span class="points-container"
                >Points: <span class="points">154</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36431004"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
            <div class="text">
              <a href="http://openmeter.io">http://openmeter.io</a>). We are
              building an open-source project to help engineers to meter and
              attribute AI and compute usage for billing and analytics use
              cases. Our GitHub is at
              <a href="https://github.com/openmeterio/openmeter"
                >https://github.com/openmeterio/openmeter</a
              >, and there’s a demo video here:
              <a
                href="https://www.loom.com/share/bc1cfa1b7ed94e65bd3a82f9f0334d04"
                >https://www.loom.com/share/bc1cfa1b7ed94e65bd3a82f9f0334d04</a
              >.
              <p>
                Why? Companies are increasingly adopting usage-based pricing
                models, requiring accurate metering. In addition, many SaaS
                products are expected to offer AI capabilities. To effectively
                cover costs and stay profitable, these companies must meter AI
                usage and attribute it to their customers.
              </p>
              <p>
                When I worked at Stripe, my job was to price and attribute
                database usage to product teams. You can think about it like
                internal usage-based pricing to keep teams accountable and the
                business in the margins. This was when I realized that it’s
                challenging to extract usage data from various cloud
                infrastructure components (execution time, bytes stored, query
                complexity, backup size, etc.), meter it accurately, and handle
                failure scenarios like backfills and meter resets. I was
                frustrated that no standard exists to meter cloud
                infrastructure, and we had to do this on our own.
              </p>
              <p>
                Usage metering requires accurately processing large volumes of
                events in real-time to power billing use cases and modern
                data-intensive applications. Imagine you want to meter and bill
                workload execution on a per-second granularity or meter the
                number of API calls you make to a third party and act instantly
                on events like a user hitting a billing threshold. The real-time
                aspect requires instant aggregations and queries; scalability
                means to able to ingest and process millions of usage events per
                second; it must be accurate—billing requires precise metering;
                and it must be fault tolerant, with built-in idempotency, event
                backfills, and meter resets.
              </p>
              <p>
                This is challenging to build out, and the obvious approaches
                don’t work well: writing to a database for each usage event is
                expensive; monitoring systems are cheaper but inaccurate and
                lack idempotency (distributed systems use at-least-once
                delivery); batch processing in the data warehouse has
                unacceptable latency.
              </p>
              <p>
                Companies also need to extract usage data from cloud
                infrastructure (Kubernetes, AWS, etc.), vendors (OpenAI, Twilio,
                etc.), and hardware components to attribute metered usage to
                their customers. Collecting usage in many cases requires writing
                custom code like measuring execution duration, listening to
                lifecycle events, scraping APIs periodically, parsing log
                streams, and attributing usage of shared and multi-tenant
                resources.
              </p>
              <p>
                OpenMeter leverages stream processing to be able to update
                meters in real-time while processing large volumes of events
                simultaneously. The core is written in Go and uses the
                CloudEvents format to describe usage, Kafka to ingest events,
                and ksqlDB to dedupe and aggregate meters. We are also working
                on a Postgres sink for long-term storage. Check out our GitHub
                to learn more:
                <a href="https://github.com/openmeterio/openmeter"
                  >https://github.com/openmeterio/openmeter</a
                >
              </p>
              <p>
                Other companies in the usage-based billing space are focused on
                payments and basically want to be Stripe replacements. With
                OpenMeter, we’re focusing instead on the engineering challenge
                of collecting usage data from cloud infrastructure and balancing
                tradeoffs between cost, scale, accuracy, and staleness. We’re
                not trying to be a payment platform—rather, we want to empower
                engineers to provide fresh and accurate usage data to Product,
                Sales, and Finance, helping them with billing, analytics, and
                revenue use cases.
              </p>
              <p>
                We’re building OpenMeter as an open-source project (Apache 2.0),
                with the goal of making it the standard to collect and share
                usage across many solutions and providers. In the future, we’ll
                offer a hosted / cloud version of OpenMeter with high
                availability guarantees and easy integrations to payment, CRM,
                and analytics solutions.
              </p>
              <p>
                What usage metering issues or experiences do you have? We would
                love to hear your feedback on OpenMeter and to learn from which
                sources you need to extract usage and how the metered data is
                leveraged. Looking forward to your comments!
              </p>
            </div>
          </section>
        </section>
        <section id="36427546">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/smart-news/at-long-last-mathematicians-have-found-a-shape-with-a-pattern-that-never-repeats-180981899/"
              >Mathematicians Have Found a Shape with a Pattern That Never
              Repeats</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 03:03:48</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36427546"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36427385">
          <h3>
            <a
              class="item"
              href="https://www.eveonline.com/news/view/information-is-power-excel-release"
              >EVE Online: Add-in for MS Excel</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-22 @ 02:36:49</span
              ><span class="points-container"
                >Points: <span class="points">156</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36427385"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36421143">
          <h3>
            <a
              class="item"
              href="https://www.ncausa.org/about-coffee/history-of-coffee"
              >The History of Coffee</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-21 @ 16:58:19</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36421143"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36421014">
          <h3>
            <a
              class="item"
              href="https://tedunderwood.com/2023/03/19/using-gpt-4-to-measure-the-passage-of-time-in-fiction/"
              >Using GPT-4 to measure the passage of time in fiction</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-21 @ 16:49:31</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36421014"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36420995">
          <h3>
            <a class="item" href="https://macwright.com/projects/"
              >Tom MacWright's Projects</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-21 @ 16:47:55</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36420995"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36420890">
          <h3>
            <a
              class="item"
              href="https://nanovms.com/dev/tutorials/running-postgres-as-a-unikernel"
              >Running Postgres as a Unikernel</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-21 @ 16:41:14</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36420890"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36420287">
          <h3>
            <a class="item" href="https://magvit.cs.cmu.edu/"
              >Magvit: Masked Generative Video Transformer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-21 @ 16:02:24</span
              ><span class="points-container"
                >Points: <span class="points">108</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36420287"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36418539">
          <h3>
            <a
              class="item"
              href="https://ilyasergey.net/assets/pdf/papers/sisyphus-pldi23.pdf"
              >Mostly Automated Proof Repair for Verified Libraries [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-21 @ 13:58:10</span
              ><span class="points-container"
                >Points: <span class="points">26</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36418539"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="36418364">
          <h3>
            <a class="item" href="https://physics.aps.org/articles/v16/102"
              >Controlling the Bounce of a Bottle</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-06-21 @ 13:45:06</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=36418364"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
