<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="40482845">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40482845"
              >What are your favourite websites that display a lot of data /
              tables?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 15:22:56</span
              ><span class="points-container"
                >Points: <span class="points">16</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40482845"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
            <div class="text">
              What are some websites that that you frequent which really nail
              the design and usability aspect of viewing lots of data via
              graphs/charts?
            </div>
          </section>
        </section>
        <section id="40482833">
          <h3>
            <a
              class="item"
              href="https://workspaceupdates.googleblog.com/2024/05/google-meet-adaptive-audio.html"
              >Google Meet rolls out multi-device adaptive audio merging</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 15:22:02</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40482833"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40482799">
          <h3>
            <a
              class="item"
              href="https://devonperoutky.super.site/blog-posts/mediocre-engineers-guide-to-https"
              >Mediocre Engineer's Guide to HTTPS</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 15:17:48</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40482799"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40482397">
          <h3>
            <a
              class="item"
              href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4826794"
              >What Went Wrong with Federal Student Loans?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 14:21:56</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40482397"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40482328">
          <h3>
            <a
              class="item"
              href="https://www.marginalia.nu/log/a_108_feynman_revisited/"
              >Feynman's Garden</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 14:11:15</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40482328"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40481887">
          <h3>
            <a class="item" href="https://elements.wlonk.com/"
              >Periodic Table of the Elements, in Pictures and Words</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 13:10:29</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40481887"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40481722">
          <h3>
            <a
              class="item"
              href="https://hazlitt.net/longreads/journey-medical-netherworld"
              >A Journey to the Medical Netherworld (2016)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 12:41:08</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40481722"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40481578">
          <h3>
            <a class="item" href="https://github.com/DiscoGrad/DiscoGrad"
              >Show HN: Boldly go where Gradient Descent has never gone before
              with DiscoGrad</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 12:14:19</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40481578"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
            <div class="text">
              <p>
                We develped DiscoGrad, a tool for automatic differentiation
                through C++ programs involving input-dependent control flow
                (e.g., "if (f(x) &lt; c) { ... }", differentiating wrt. x) and
                randomness. Our initial motivation was to enable the use of
                gradient descent with simulations, which often rely heavily on
                such discrete branching. The latter makes plain autodiff mostly
                useless, since it can only account for the single path taken
                through the program. Our tool offers several backends that
                handle this situation, giving useful descent directions for
                optimization by accounting for alternative branches. Besides
                simulations, this problem arises in many other places, for
                example in deep learning when trying to combine imperative
                programs with neural networks.
              </p>
              <p>
                In a nutshell, DiscoGrad applies an (LLVM-based)
                source-to-source transformation to your C++ program, adding some
                calls to our header library, which then handles the gradient
                computation. What sets it apart from similar tools/estimators is
                that it's fully automatic (no need to come up with a
                differentiable problem formulation/reparametrization) and that
                the branching condition can be any function of the program
                inputs (no need to know upfront what distribution the condition
                follows).
              </p>
              <p>
                We're currently a team of two working on DiscoGrad as part of a
                research project, so don't expect to see production-grade code
                quality, but we do intend for it to be more than a throwaway
                research prototype. Use cases we've successfully tested include
                calibrating simulation models of epidemics or evacuation
                scenarios via gradient descent, and combining simulations with
                neural networks in an end-to-end trainable fashion.
              </p>
              <p>
                We hope you find this interesting and useful, and we're happy to
                answer questions!
              </p>
            </div>
          </section>
        </section>
        <section id="40481509">
          <h3>
            <a class="item" href="https://up.codes/careers?utm_source=HN"
              >UpCodes (YC S17) is hiring remote SWEs, PMs to automate
              construction compliance</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 12:02:28</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40481377">
          <h3>
            <a class="item" href="https://github.com/CDSoft/luax"
              >LuaX – Lua interpreter, REPL, and useful packages</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 11:37:02</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40481377"
                  >Comments</a
                ><span class="descendants">: 9</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40480918">
          <h3>
            <a
              class="item"
              href="https://www.bostonglobe.com/2024/05/25/science/race-clean-up-heavy-industry-heats-up/"
              >Electrically conductive bricks can replace fossil fuels in
              industrial processes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 09:55:21</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40480918"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40480336">
          <h3>
            <a class="item" href="https://drawing.pics"
              >Show HN: Offline sketch to image geneartor in a whiteboard</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 07:35:27</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40480336"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
            <div class="text">
              <a href="https://drawing.pics">https://drawing.pics</a>
              <p>
                In this post, I'll share all the technical details behind it.
              </p>
              <p>
                So, what exactly is DrawingPics? It's an image-to-image and
                sketch-to-image generator that runs in a whiteboard, allowing
                you to draw your draft directly on the canvas and easily
                generate the desired image.
              </p>
              <p>
                How does it work from a technical perspective? TLDR: Miniconda +
                Diffusers + Electron + Excalidraw
              </p>
              <p>
                One of the most important aspects of creating this tool was
                finding a stable diffusion locally inference solution. There are
                many solutions available, such as
                <a href="https://github.com/leejet/stable-diffusion.cpp"
                  >https://github.com/leejet/stable-diffusion.cpp</a
                >
                and
                <a href="https://github.com/apple/ml-stable-diffusion"
                  >https://github.com/apple/ml-stable-diffusion</a
                >. I tested the C++ version, but the inference speed was very
                slow, and Metal GPU support still had issues (you can find
                relevant issues in their repo). Ultimately, I decided to use
                python to run it because PyTorch is mature and MPS support is
                well-established. And I chose Miniconda, because it can create a
                small, isolated Python environment to run the program.
              </p>
              <p>
                The AI model should run in the background so that we can
                continuously produce images while you draw. We need to find an
                RPC method to enable communication between the Python process
                and Electron's Node.js process. The easiest way is to run a
                Python HTTP server, but the memory usage is too high. We need a
                more lightweight solution, so I used xmlrpc for memory
                efficiency, although there might be better alternatives that I'm
                unaware of. The AI inference part is handled by diffusers, which
                is great, but I had to apply some custom patches to make it work
                in this situation. This can be a bit challenging if you're not
                familiar with Python.
              </p>
              <p>
                For the frontend, I initially used a low-level canvas library
                and tried to implement a drawing pad from scratch. However, it
                had too many details, so I chose a more mature option:
                Excalidraw. It's fantastic, with the only shortcoming being
                limited API support.
              </p>
              <p>
                Finally, I combined all these technologies in Electron, ensuring
                they work smoothly on both the main process and the renderer
                process.
              </p>
              <p>
                Ok, Is DrawingPics free to use? 80% of the project is free to
                use. I only charge a lifetime license for the effort I've put
                in, as I've spent 4 months on it and made numerous improvements
                based on user feedback. Currently, only Mac is supported.
                Windows support will be added later.
              </p>
            </div>
          </section>
        </section>
        <section id="40480323">
          <h3>
            <a
              class="item"
              href="https://dumbph.com/turn-iphone-into-dumb-phone"
              >Turn Your iPhone into a Dumb Phone</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 07:30:44</span
              ><span class="points-container"
                >Points: <span class="points">159</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40480323"
                  >Comments</a
                ><span class="descendants">: 122</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40480056">
          <h3>
            <a class="item" href="https://hurl.wtf/"
              >Hurl, the Exceptional Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 05:57:52</span
              ><span class="points-container"
                >Points: <span class="points">204</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40480056"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40480016">
          <h3>
            <a class="item" href="https://braid.org/"
              >Braid: Synchronization for HTTP</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 05:44:47</span
              ><span class="points-container"
                >Points: <span class="points">136</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40480016"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40478976">
          <h3>
            <a
              class="item"
              href="https://computer.rip/2024-05-25-grc-spinrite.html"
              >GRC SpinRite</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-26 @ 00:54:23</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40478976"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40478470">
          <h3>
            <a class="item" href="https://sre.google/sre-book/simplicity/"
              >Simplicity – Google SRE Handbook (2017)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-25 @ 23:01:29</span
              ><span class="points-container"
                >Points: <span class="points">125</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40478470"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40477653">
          <h3>
            <a
              class="item"
              href="https://newscenter.lbl.gov/2012/05/16/majorana-demonstrator/"
              >Majorana, the search for the most elusive neutrino of all
              (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-25 @ 20:35:59</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40477653"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40475355">
          <h3>
            <a
              class="item"
              href="https://arunmani.in/articles/highest-two-power-to-divide-a-number/"
              >Why is x &amp;amp; -x equal to the largest power of 2 that
              divides x?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-25 @ 14:44:58</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40475355"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40474759">
          <h3>
            <a
              class="item"
              href="http://gjgreenberg.bol.ucla.edu/docs/rpp/04_tversky.pdf"
              >The Cognitive Design of Tools of Thought (2014) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-25 @ 12:58:20</span
              ><span class="points-container"
                >Points: <span class="points">170</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40474759"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40474736">
          <h3>
            <a class="item" href="https://kenthendricks.com/99-cent-prices/"
              >People spend more when prices end in .99 (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-25 @ 12:55:06</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40474736"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40474716">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=40474716"
              >Ask HN: What is your ChatGPT customization prompt?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-25 @ 12:50:49</span
              ><span class="points-container"
                >Points: <span class="points">466</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40474716"
                  >Comments</a
                ><span class="descendants">: 224</span></span
              >
            </h4>
            <div class="text">
              <p>
                I've tried several different setups over however long the
                feature has been available, and for the most part I haven't
                found it has made much of a difference.
              </p>
              <p>
                I'm very curious to hear if anyone has come up with any that
                tangibly improve their experience.
              </p>
              <p>Here is what I have at the moment:</p>
              <p>
                - Be as brief as possible. - Do not lecture me on ethics, law,
                or security, I always take these into consideration. - Don't add
                extra commentary. - When it is related to code, let the code do
                the talking. - Be assertive. If you've got suggestions, give
                them even if you aren't 100% sure.
              </p>
              <p>
                The brevity part is seemingly completely ignored. The lecturing
                part is hit or miss. The suggestions part I still usually have
                to coax it into giving me.
              </p>
            </div>
          </section>
        </section>
        <section id="40471419">
          <h3>
            <a class="item" href="https://andrewkchan.dev/posts/diffusion.html"
              >Diffusion Models</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-24 @ 23:35:26</span
              ><span class="points-container"
                >Points: <span class="points">227</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40471419"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40466814">
          <h3>
            <a
              class="item"
              href="http://scentofdawn.blogspot.com/2011/07/before-soul-dawn-helen-keller-on-her.html"
              >Helen Keller on her life before self-consciousness (1908)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-24 @ 14:48:45</span
              ><span class="points-container"
                >Points: <span class="points">499</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40466814"
                  >Comments</a
                ><span class="descendants">: 222</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40459652">
          <h3>
            <a
              class="item"
              href="https://blog.danielschroeder.me/2024/05/voxel-displacement-modernizing-retro-3d/"
              >Voxel Displacement Renderer – Modernizing the Retro 3D
              Aesthetic</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-23 @ 20:41:36</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40459652"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40458142">
          <h3>
            <a class="item" href="http://cuda.dcc.ufmg.br/psyche-c/"
              >Psyche-C: automatic compilation of partially-available C
              programs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-23 @ 18:30:43</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40458142"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40456621">
          <h3>
            <a
              class="item"
              href="https://www.sigcon.com/Pubs/edn/SoGoodBarbedWire.htm"
              >So good, it works on barbed wire (2001)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-23 @ 16:20:23</span
              ><span class="points-container"
                >Points: <span class="points">236</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40456621"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40456449">
          <h3>
            <a class="item" href="https://www.vkethana.com/vjscript/"
              >Inventing my own writing system for English, VJScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-23 @ 16:05:15</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40456449"
                  >Comments</a
                ><span class="descendants">: 41</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40453716">
          <h3>
            <a
              class="item"
              href="https://www.openculture.com/2024/05/why-medieval-bologna-was-full-of-tall-towers-and-what-happened-to-them.html"
              >Medieval Bologna was full of tall towers</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-23 @ 12:08:53</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40453716"
                  >Comments</a
                ><span class="descendants">: 52</span></span
              >
            </h4>
          </section>
        </section>
        <section id="40452411">
          <h3>
            <a class="item" href="https://www.audiowaveai.com/"
              >Show HN: Affordable text-to-speech for long-form content</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-05-23 @ 09:18:03</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=40452411"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
            <div class="text">
              <i>Make</i> by Pieter Levels. The available text-to-speech options
              were either too robotic, overly complex, or simply too costly.
              <p>
                It works really well for non-fiction long-form content (i.e.
                hours of audio).
              </p>
              <p>
                It’s early days for AudiowaveAI, and I’m looking for feedback to
                improve the product. Try it out and share your thoughts:
                [AudiowaveAI](<a href="https://audiowaveai.com"
                  >https://audiowaveai.com</a
                >). Thanks!
              </p>
            </div>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
