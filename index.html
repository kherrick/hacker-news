<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37676500">
          <h3>
            <a
              class="item"
              href="https://www.usatoday.com/story/money/cars/2023/09/27/kia-hyundai-recall/70978487007/"
              >Kia, Hyundai recall over 3.3M vehicles for potential fire-related
              issues</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 15:51:09</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37676500"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37676393">
          <h3>
            <a
              class="item"
              href="https://headlineshq.substack.com/p/issue-no-029-live-near-your-friends"
              >Live near your friends</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 15:45:58</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37676393"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37676263">
          <h3>
            <a class="item" href="https://nucor.com/news-release/20126"
              >Nucor and Helion to Develop 500 MW Fusion Power Plant by 2030</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 15:38:00</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37676263"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37675989">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=37675989"
              >Ask HN: I spent months building an app and now I don't know how
              to get users</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 15:22:39</span
              ><span class="points-container"
                >Points: <span class="points">38</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37675989"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
            <div class="text">
              <p>But let's start from the beginning...</p>
              <p>
                It all started almost 2 years ago when inflation began to kick
                in. Prices of everything started to rise, from groceries and
                bills to rent. At the same time, salaries didn't keep up with
                inflation, and more and more people started to struggle
                financially. Many started using food banks to get through the
                month. Even for working people, it got harder and harder to keep
                up, especially for single parents. Some people even lost their
                homes because they couldn't afford to pay their rent anymore.
              </p>
              <p>
                And that got me thinking: there should be a way for people to
                raise funds quickly in those dark moments when they need it the
                most, whether to keep a roof over their heads, pay bills, buy
                groceries, or cover educational expenses.
              </p>
              <p>
                At some point, as I'm a developer, I came up with an idea for an
                app - an app that would enable people to raise funds by offering
                services to their community. Services like tutoring,
                babysitting, pet sitting, transportation, home repair, and
                various other tasks they could carry out after their working
                hours.
              </p>
              <p>
                I believed that this could be genuinely helpful to many people
                so I started working on it. I called the app Taskwer. So, how
                does it work?
              </p>
              <p>
                People who want to raise funds are called creators. They start
                by creating their campaigns, where they set their funding goal,
                share their story, introduce themselves, explain why they're
                raising funds, and what kind of services are they offering. Once
                their campaign is all set, they can launch it and share it with
                their friends on social media, just like on Kickstarter.
              </p>
              <p>
                After the campaign is launched, creators can begin receiving
                orders from their supporters, discuss details, create customized
                offers, and more. On an agreed-upon date, creators would
                complete their tasks, the supporter would confirm that the task
                has been completed, and creators would get paid. They could
                receive payment in cash from their supporters, or if the service
                is paid by card, they could withdraw funds from the app. There
                are no fees on cash payments. And in case of any issues, there
                is a support system in place.
              </p>
              <p>
                I knew that I should start looking for potential users as soon
                as possible, even before I started building the app, to
                understand what they really want and need. However, there was
                just one problem; I'm an introvert. I have a small group of
                friends, I work remotely, and I don't use social media like
                Facebook, Instagram, Twitter or LinkedIn. As a result, I kept
                postponing reaching out to people. And there was always a new
                feature to add, or a bug to fix so that was always a good
                excuse. I ended up sticking to what I was comfortable with and
                avoided talking to people for as long as possible.
              </p>
              <p>
                Now, I have an MVP, and most of the features have been
                implemented, but I have no users. I don't know if this idea is
                any good, is it something people would even want to use. I
                believe it's not a bad idea, but my opinion doesn't matter here;
                it's the opinion of potential users that matters. The lack of a
                network and the inability to get users made me feel voiceless,
                like I'm a complete nobody. Over the past couple of weeks there
                have been numerous times when I've thought about giving up on
                this project.
              </p>
              <p>
                So I came here today to ask for your help. I don't have a
                marketing budget unfortunately. What would you do in my place?
                What would be the best way to get my first 10 users, get some
                unbiased feedback and see if this project is even worth
                pursuing?
              </p>
              <p>Here's the link: https://www.taskwer.com</p>
            </div>
          </section>
        </section>
        <section id="37675864">
          <h3>
            <a
              class="item"
              href="https://forgottenfiles.substack.com/p/accidents-happen-c1890s"
              >Accidents Happen: Sketches of misfortune in an insurance trade
              card c. 1890s</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 15:16:22</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37675864"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37675831">
          <h3>
            <a
              class="item"
              href="https://www.eurekalert.org/news-releases/1002811"
              >Desalination system could produce freshwater that is cheaper than
              tap water</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 15:14:03</span
              ><span class="points-container"
                >Points: <span class="points">55</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37675831"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37675496">
          <h3>
            <a
              class="item"
              href="https://mistral.ai/news/announcing-mistral-7b/"
              >Mistral 7B: The best 7B model to date, Apache 2.0</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 14:52:46</span
              ><span class="points-container"
                >Points: <span class="points">263</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37675496"
                  >Comments</a
                ><span class="descendants">: 146</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37674967">
          <h3>
            <a
              class="item"
              href="https://clickhouse.com/blog/clickhouse-keeper-a-zookeeper-alternative-written-in-cpp"
              >ClickHouse Keeper: A ZooKeeper alternative written in C++</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 14:14:30</span
              ><span class="points-container"
                >Points: <span class="points">69</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37674967"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37674752">
          <h3>
            <a class="item" href="https://deno.com/blog/queues">Deno Queues</a>
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 13:58:58</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37674752"
                  >Comments</a
                ><span class="descendants">: 38</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37674640">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/cars/2023/09/mercedes-benzs-level-3-autonomous-driving-system-takes-over-in-heavy-traffic/"
              >We try out the first legal level 3 automated driving system in
              the US</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 13:50:09</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37674640"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37674519">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/09/27/servo_returns/"
              >Rusty revenant Servo returns to render once more</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 13:40:25</span
              ><span class="points-container"
                >Points: <span class="points">115</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37674519"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37674342">
          <h3>
            <a
              class="item"
              href="https://www.gutenberg.org/files/38065/38065-h/38065-h.htm"
              >Eight or Nine Wise Words about Letter-Writing by Lewis Carroll</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 13:26:46</span
              ><span class="points-container"
                >Points: <span class="points">6</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37674342"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37674139">
          <h3>
            <a
              class="item"
              href="https://programming.guide/worlds-most-copied-so-snippet.html"
              >The most copied StackOverflow snippet of all time is flawed
              (2019)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 13:10:03</span
              ><span class="points-container"
                >Points: <span class="points">245</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37674139"
                  >Comments</a
                ><span class="descendants">: 150</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37674097">
          <h3>
            <a class="item" href="https://blog.cloudflare.com/workers-ai/"
              >Workers AI: serverless GPU-powered inference on Cloudflare’s
              global network</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 13:06:47</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37674097"
                  >Comments</a
                ><span class="descendants">: 42</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37673999">
          <h3>
            <a
              class="item"
              href="https://blog.cloudflare.com/webgpu-in-workers/"
              >You can now use WebGPU in Cloudflare Workers</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 13:00:24</span
              ><span class="points-container"
                >Points: <span class="points">87</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37673999"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37673539">
          <h3>
            <a
              class="item"
              href="https://nltimes.nl/2023/09/27/philips-allegedly-hid-3700-complaints-sleep-apnea-machines-us-authority"
              >Philips allegedly hid 3700 complaints about sleep apnea machines
              from U.S.</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 12:14:45</span
              ><span class="points-container"
                >Points: <span class="points">78</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37673539"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37673413">
          <h3>
            <a
              class="item"
              href="https://www.bloomberg.com/news/articles/2023-09-26/google-judge-rules-trial-documents-can-be-posted-by-us-online"
              >Google judge rules trial documents can be posted by U.S.
              online</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 12:01:43</span
              ><span class="points-container"
                >Points: <span class="points">123</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37673413"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37673300">
          <h3>
            <a
              class="item"
              href="https://www.bemyeyes.com/blog/announcing-be-my-ai"
              >Be My Eyes’ AI assistant starts rolling out</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 11:48:36</span
              ><span class="points-container"
                >Points: <span class="points">209</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37673300"
                  >Comments</a
                ><span class="descendants">: 127</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37672692">
          <h3>
            <a
              class="item"
              href="https://blog.appsignal.com/2023/09/27/an-introduction-to-litestack-for-ruby-on-rails.html"
              >An Introduction to LiteStack for Ruby on Rails</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 10:21:57</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37672692"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37671991">
          <h3>
            <a
              class="item"
              href="https://ariel-miculas.github.io/How-I-got-robbed-of-my-first-kernel-contribution/"
              >I got robbed of my first kernel contribution</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 08:58:04</span
              ><span class="points-container"
                >Points: <span class="points">525</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37671991"
                  >Comments</a
                ><span class="descendants">: 468</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37671419">
          <h3>
            <a class="item" href="https://nakst.gitlab.io/essence"
              >Essence: A desktop OS built from scratch, for control and
              simplicity</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 07:44:37</span
              ><span class="points-container"
                >Points: <span class="points">258</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37671419"
                  >Comments</a
                ><span class="descendants">: 84</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37671341">
          <h3>
            <a class="item" href="https://github.com/laurentpayot/verticalize"
              >Show HN: A JavaScript function that looks and behaves like a pipe
              operator</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 07:31:43</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37671341"
                  >Comments</a
                ><span class="descendants">: 116</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37670938">
          <h3>
            <a
              class="item"
              href="https://www.timdbg.com/posts/writing-a-debugger-from-scratch-part-5/"
              >Writing a debugger from scratch: Breakpoints</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 06:31:25</span
              ><span class="points-container"
                >Points: <span class="points">221</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37670938"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37670740">
          <h3>
            <a class="item" href="https://nullprogram.com/blog/2023/09/27/"
              >Arena allocator tips and tricks</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 05:59:55</span
              ><span class="points-container"
                >Points: <span class="points">229</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37670740"
                  >Comments</a
                ><span class="descendants">: 68</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37667981">
          <h3>
            <a class="item" href="https://www.ifte.de/books/eda/index.html"
              >VLSI Physical Design</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-27 @ 00:29:13</span
              ><span class="points-container"
                >Points: <span class="points">9</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37667981"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37664082">
          <h3>
            <a
              class="item"
              href="https://thonyc.wordpress.com/2023/09/21/incorrect-casual-assumptions/"
              >Incorrect casual assumptions in the history of science</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 18:53:49</span
              ><span class="points-container"
                >Points: <span class="points">30</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37664082"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37658208">
          <h3>
            <a
              class="item"
              href="https://jackevansevo.github.io/my-unhealthy-relationship-with-keyboards.html"
              >My Unhealthy Relationship with Keyboards</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 12:22:21</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37658208"
                  >Comments</a
                ><span class="descendants">: 216</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37654361">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2023/09/25/science/pangolins-new-species-scales.html"
              >A mystery species was discovered in trafficked pangolin scales</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-26 @ 04:27:26</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37654361"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37650402">
          <h3>
            <a
              class="item"
              href="https://www.cambridgeblog.org/2023/05/a-journey-into-the-shaken-baby-syndrome-abusive-head-trauma-controversy/"
              >A journey into the shaken baby syndrome/abusive head trauma
              controversy</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 20:49:09</span
              ><span class="points-container"
                >Points: <span class="points">761</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37650402"
                  >Comments</a
                ><span class="descendants">: 437</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37639945">
          <h3>
            <a class="item" href="http://www.erikyyy.de/tempest/"
              >Tempest: Transmit Radio Waves via a PC Video Card with No Extra
              Hardware</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-25 @ 05:29:34</span
              ><span class="points-container"
                >Points: <span class="points">65</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37639945"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
