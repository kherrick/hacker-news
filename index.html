<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="35464933">
          <h3>
            <a
              class="item"
              href="https://www.ignorance.ai/p/analyzing-over-100-ai-startups-from-yc"
              >Over 40% of the latest YC batch are AI/ML startups</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-06 @ 06:33:01</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35464933"
                  >Comments</a
                ><span class="descendants">: 83</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35464152">
          <h3>
            <a
              class="item"
              href="https://awesomekling.github.io/MutexProtected-A-C++-Pattern-for-Easier-Concurrency/"
              >MutexProtected: A C++ Pattern for Easier Concurrency</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-06 @ 04:31:41</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35464152"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35463182">
          <h3>
            <a
              class="item"
              href="https://www.economist.com/technology-quarterly/2023/04/05/adding-capacity-to-the-electricity-grid-is-not-a-simple-task"
              >Adding capacity to the electricity grid is not a simple task</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-06 @ 02:01:47</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35463182"
                  >Comments</a
                ><span class="descendants">: 22</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35462784">
          <h3>
            <a class="item" href="https://github.com/eval/deps-try"
              >Try out Clojure libraries via rebel-readline</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-06 @ 01:10:44</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35462784"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35461777">
          <h3>
            <a class="item" href="https://galaxym.ovh/">Galaxy Simulation</a>
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 23:11:59</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35461777"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35461596">
          <h3>
            <a
              class="item"
              href="https://coryd.dev/posts/2023/i-dont-want-streaming-music/"
              >I don't want streaming music, I just want to stream my music</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 22:54:18</span
              ><span class="points-container"
                >Points: <span class="points">299</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35461596"
                  >Comments</a
                ><span class="descendants">: 234</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35461011">
          <h3>
            <a
              class="item"
              href="https://waxy.org/2023/04/the-bitcoin-whitepaper-is-hidden-in-every-modern-copy-of-macos/"
              >The Bitcoin whitepaper is hidden in every copy of macOS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 22:03:38</span
              ><span class="points-container"
                >Points: <span class="points">594</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35461011"
                  >Comments</a
                ><span class="descendants">: 287</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35460732">
          <h3>
            <a class="item" href="https://news.ycombinator.com/user?id=dang"
              >Dang is going to have 65,535 karma points soon</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 21:38:55</span
              ><span class="points-container"
                >Points: <span class="points">508</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35460732"
                  >Comments</a
                ><span class="descendants">: 295</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35460432">
          <h3>
            <a class="item" href="https://www.pdfa.org/sponsored-standards/"
              >No-cost access to the latest PDF standard: ISO 32000-2 (PDF
              2.0)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 21:10:35</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35460432"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35460375">
          <h3>
            <a
              class="item"
              href="https://www.indiehackers.com/product/indie-hackers/indie-hackers-is-indie-again--NSIAlb7LggSjzTavQZb"
              >Indie Hackers is indie again</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 21:05:51</span
              ><span class="points-container"
                >Points: <span class="points">104</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35460375"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35459333">
          <h3>
            <a
              class="item"
              href="https://contextkeeper.io/blog/the-real-cost-of-an-interruption-and-context-switching/"
              >Programmer interrupted: The cost of interruption and context
              switching (2022)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 19:37:11</span
              ><span class="points-container"
                >Points: <span class="points">339</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35459333"
                  >Comments</a
                ><span class="descendants">: 137</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35459031">
          <h3>
            <a class="item" href="https://karpathy.ai/zero-to-hero.html"
              >Neural Networks: Zero to Hero</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 19:12:09</span
              ><span class="points-container"
                >Points: <span class="points">471</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35459031"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35458974">
          <h3>
            <a class="item" href="https://telemetry.timseverien.com/"
              >Telemetry in Front-End Tools</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 19:07:27</span
              ><span class="points-container"
                >Points: <span class="points">105</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35458974"
                  >Comments</a
                ><span class="descendants">: 91</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35458746">
          <h3>
            <a
              class="item"
              href="https://bugzilla.mozilla.org/show_bug.cgi?id=1441918#c82"
              >Firefox engineers discover a Windows Defender bug that causes
              high CPU usage</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 18:48:25</span
              ><span class="points-container"
                >Points: <span class="points">513</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35458746"
                  >Comments</a
                ><span class="descendants">: 179</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35458644">
          <h3>
            <a class="item" href="https://jobs.lever.co/jitxinc"
              >Jitx (YC S18) Is Hiring: Hardware, Software, Mathematician,
              Technical Writer</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 18:39:52</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35458596">
          <h3>
            <a class="item" href="https://www.apt-browse.org/"
              >APT Browse: A web browser for the contents of Debian (and Ubuntu)
              packages</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 18:37:01</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35458596"
                  >Comments</a
                ><span class="descendants">: 37</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35457384">
          <h3>
            <a
              class="item"
              href="https://www.bitsaboutmoney.com/archive/deposit-insurance-maximization-as-a-service/"
              >Deposit insurance maximization as a service</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 17:14:34</span
              ><span class="points-container"
                >Points: <span class="points">92</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35457384"
                  >Comments</a
                ><span class="descendants">: 75</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35457341">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=35457341"
              >Remembering Bob Lee</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 17:11:56</span
              ><span class="points-container"
                >Points: <span class="points">1820</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35457341"
                  >Comments</a
                ><span class="descendants">: 186</span></span
              >
            </h4>
            <div class="text">
              <p>
                Please share your stories featuring Bob Lee, who I'm sure would
                like to be remembered for his contributions rather than as a
                victim of this unfortunate awful event.
              </p>
            </div>
          </section>
        </section>
        <section id="35456984">
          <h3>
            <a
              class="item"
              href="https://worldcoin.org/blog/engineering/intro-to-zkml"
              >An introduction to zero-knowledge machine learning</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 16:47:10</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35456984"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35456509">
          <h3>
            <a class="item" href="https://www.quadratichq.com/"
              >Show HN: Quadratic – Open-Source Spreadsheet with Python, AI
              (WASM and WebGL)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 16:13:59</span
              ><span class="points-container"
                >Points: <span class="points">169</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35456509"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
            <div class="text">
              <a href="https://QuadraticHQ.com">https://QuadraticHQ.com</a>), an
              open-source spreadsheet application that supports Python, SQL
              (coming soon), AI Prompts, and classic Formulas.
              <p>
                Unlike other spreadsheets, Quadratic has an infinite canvas
                (like Figma). As a result, you can pinch and zoom to navigate
                large data sets, and everything renders smoothly at 60fps.
              </p>
              <p>
                Our vision is to build a place where your team can collaborate
                on data analysis. You can write Python, AI Prompts, and Formulas
                in one spreadsheet feeding each other data and updating
                automatically.
              </p>
              <p>
                Quadratic is built using WebGL and Rust WASM. To render a large
                grid of cells smoothly, we tile the spreadsheet similar to
                google maps. If you are interested in the technical details,
                check us out on GitHub (<a
                  href="https://github.com/quadratichq/quadratic/"
                  >https://github.com/quadratichq/quadratic/</a
                >)
              </p>
              <p>
                You can use AI to help you write Python and then run the code
                directly in Quadratic. Then, we feed the result back to the AI
                model so it can follow along, help you debug, and modify your
                existing code.
              </p>
              <p>
                AI can also be used to directly generate data onto the sheet
                with prompts. It knows the context of what's on the sheet and
                how the data it's inserting fits in. Try it out.
              </p>
              <p>SQL is coming soon... stay tuned!</p>
            </div>
          </section>
        </section>
        <section id="35456059">
          <h3>
            <a class="item" href="https://census.dev/blog/an-on-ramp-to-flow"
              >A trick to reaching flow: Leave your work broken</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 15:44:12</span
              ><span class="points-container"
                >Points: <span class="points">432</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35456059"
                  >Comments</a
                ><span class="descendants">: 146</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35455770">
          <h3>
            <a class="item" href="https://alex.miller.garden/grid-world/"
              >Grid World</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 15:24:53</span
              ><span class="points-container"
                >Points: <span class="points">385</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35455770"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35455566">
          <h3>
            <a class="item" href="https://segment-anything.com/"
              >Segment Anything Model (SAM) can "cut out" any object in an
              image</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 15:11:50</span
              ><span class="points-container"
                >Points: <span class="points">570</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35455566"
                  >Comments</a
                ><span class="descendants">: 112</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35452963">
          <h3>
            <a
              class="item"
              href="https://kentindell.github.io/2023/04/03/can-injection/"
              >CAN Injection: Keyless car theft</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-05 @ 12:28:49</span
              ><span class="points-container"
                >Points: <span class="points">498</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35452963"
                  >Comments</a
                ><span class="descendants">: 273</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35445312">
          <h3>
            <a class="item" href="https://github.com/motiwari/BanditPAM"
              >Show HN: Want something better than k-means? Try BanditPAM</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-04 @ 20:16:33</span
              ><span class="points-container"
                >Points: <span class="points">230</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35445312"
                  >Comments</a
                ><span class="descendants">: 23</span></span
              >
            </h4>
            <div class="text">
              <p>
                k-means is one of the most widely-used algorithms to cluster
                data. However, it has several limitations: a) it requires the
                use of L2 distance for efficient clustering, which also b)
                restricts the data you're clustering to be vectors, and c)
                doesn't require the means to be datapoints in the dataset.
              </p>
              <p>
                Unlike in k-means, the k-medoids problem requires cluster
                centers to be actual datapoints, which permits greater
                interpretability of your cluster centers. k-medoids also works
                better with arbitrary distance metrics, so your clustering can
                be more robust to outliers if you're using metrics like L1.
                Despite these advantages, most people don't use k-medoids
                because prior algorithms were too slow.
              </p>
              <p>
                In our NeurIPS 2020 paper, BanditPAM, we sped up the best known
                algorithm from O(n^2) to O(nlogn) by using techniques from
                multi-armed bandits. We were inspired by prior research that
                demonstrated many algorithms can be sped up by sampling the data
                intelligently, instead of performing exhaustive computations.
              </p>
              <p>
                We've released our implementation, which is pip- and
                CRAN-installable. It's written in C++ for speed, but callable
                from Python and R. It also supports parallelization and
                intelligent caching at no extra complexity to end users. Its
                interface also matches the sklearn.cluster.KMeans interface, so
                minimal changes are necessary to existing code.
              </p>
              <p>
                PyPI:
                <a href="https://pypi.org/project/banditpam"
                  >https://pypi.org/project/banditpam</a
                >
              </p>
              <p>
                CRAN:
                <a
                  href="https://cran.r-project.org/web/packages/banditpam/index.html"
                  >https://cran.r-project.org/web/packages/banditpam/index.html</a
                >
              </p>
              <p>
                Repo:
                <a href="https://github.com/motiwari/BanditPAM"
                  >https://github.com/motiwari/BanditPAM</a
                >
              </p>
              <p>
                Paper:
                <a href="https://arxiv.org/abs/2006.06856"
                  >https://arxiv.org/abs/2006.06856</a
                >
              </p>
              <p>
                If you find our work valuable, please consider starring the repo
                or citing our work. These help us continue development on this
                project.
              </p>
              <p>
                I'm Mo Tiwari (motiwari.com), a PhD student in Computer Science
                at Stanford University. A special thanks to my collaborators on
                this project, Martin Jinye Zhang, James Mayclin, Sebastian
                Thrun, Chris Piech, and Ilan Shomorony, as well as the author of
                the R package, Balasubramanian Narasimhan.
              </p>
              <p>
                (This is my first time posting on HN; I've read the FAQ before
                posting, but please let me know if I broke any rules)
              </p>
            </div>
          </section>
        </section>
        <section id="35438072">
          <h3>
            <a
              class="item"
              href="http://www.nellaware.com/blog/acoustic-shadow-in-the-civil-war.html"
              >Acoustic Shadow in the Civil War</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-04 @ 11:43:30</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35438072"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35437473">
          <h3>
            <a
              class="item"
              href="https://hothardware.com/news/ddr5-mrdimms-standardized-up-to-17600"
              >AMD and Jedec Are Collaborating on DDR5 MRDIMMs at a Blistering
              17,600 MT/S</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-04 @ 10:29:10</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35437473"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35435431">
          <h3>
            <a
              class="item"
              href="https://publicdomainreview.org/collection/basohli-beetle-paintings"
              >Beetle Carapaces in Basohli Miniature Paintings (ca.
              1660–1700)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-04 @ 05:23:32</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35435431"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35427774">
          <h3>
            <a
              class="item"
              href="https://www.army.mil/article/242980/army_researchers_detect_broadest_frequencies_ever_with_novel_quantum_receiver"
              >Army researchers detect broadest frequencies ever with quantum
              receiver (2021)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-03 @ 17:24:45</span
              ><span class="points-container"
                >Points: <span class="points">27</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35427774"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="35427216">
          <h3>
            <a class="item" href="https://www.youtube.com/watch?v=nNpuiJitKwk"
              >A Brief History of Semiconductor Packaging [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-04-03 @ 16:54:02</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=35427216"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
