<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="44813905">
          <h3>
            <a class="item" href="https://github.com/berbyte/sinkzone"
              >Show HN: Sinkzone DNS forwarder that blocks everything except
              your allowlist</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-06 @ 16:08:23</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44813905"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
            <div class="text">
              <p>
                I wanted the opposite: allowlist‑only browsing. Block everything
                by default, and explicitly allow only what I need.
              </p>
              <p>So I built Sinkzone: a local DNS forwarder with two modes:</p>
              <p>
                Monitor mode: lets all traffic through, but logs every domain so
                you can decide what to allow.
              </p>
              <p>
                Focus mode: only allowlisted domains resolve; everything else is
                blocked (NXDOMAIN).
              </p>
              <p>
                It’s open source, written in Go, and runs locally on macOS,
                Linux, and Windows. Works a bit like Pi‑hole, but instead of
                blocking ads, it blocks everything unless you say otherwise.
              </p>
              <p>
                I’m curious if this would be useful in your workflow. If you try
                it, please let me know what breaks, what works well, and what
                you’d improve.
              </p>
            </div>
          </section>
        </section>
        <section id="44813789">
          <h3>
            <a
              class="item"
              href="https://www.collabora.com/news-and-blog/blog/2025/08/06/writing-a-rust-gpu-kernel-driver-a-brief-introduction-on-how-gpu-drivers-work/"
              >Writing a Rust GPU kernel driver: a brief introduction on how GPU
              drivers work</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-06 @ 16:00:54</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44813789"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44813627">
          <h3>
            <a
              class="item"
              href="https://huggingface.co/Qwen/Qwen3-4B-Thinking-2507"
              >Qwen3-4B-Thinking-2507</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-06 @ 15:50:47</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44813627"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44813110">
          <h3>
            <a
              class="item"
              href="https://netbird.io/knowledge-hub/netbird-agpl-announcement"
              >NetBird Is Embracing the AGPLv3 License</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-06 @ 15:13:30</span
              ><span class="points-container"
                >Points: <span class="points">48</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44813110"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44812985">
          <h3>
            <a class="item" href="https://glfmn.io/posts/zig-error-patterns/"
              >Zig-Error-Patterns</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-06 @ 15:03:19</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44812985"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44812695">
          <h3>
            <a
              class="item"
              href="https://www.quantamagazine.org/new-method-is-the-fastest-way-to-find-the-best-routes-20250806/"
              >Breaking the sorting barrier for directed single-source shortest
              paths</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-06 @ 14:43:02</span
              ><span class="points-container"
                >Points: <span class="points">62</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44812695"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
            <div class="text">
              <a href="https://arxiv.org/abs/2504.17033"
                >https://arxiv.org/abs/2504.17033</a
              >
            </div>
          </section>
        </section>
        <section id="44812611">
          <h3>
            <a
              class="item"
              href="https://hamatti.org/posts/dotfiles-feel-too-intimate-and-personal-to-share/"
              >Dotfiles feel too intimate and personal to share</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-06 @ 14:36:01</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44812611"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44812297">
          <h3>
            <a
              class="item"
              href="https://openai.com/index/providing-chatgpt-to-the-entire-us-federal-workforce/"
              >Providing ChatGPT to the entire U.S. federal workforce</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-06 @ 14:12:09</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44812297"
                  >Comments</a
                ><span class="descendants">: 101</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44812198">
          <h3>
            <a
              class="item"
              href="https://www.bleepingcomputer.com/news/security/google-suffers-data-breach-in-ongoing-salesforce-data-theft-attacks/"
              >Google suffers data breach in ongoing Salesforce data theft
              attacks</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-06 @ 14:04:13</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44812198"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44811996">
          <h3>
            <a class="item" href="https://www.asimov.press/p/proteomics"
              >How to Scale Proteomics</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-06 @ 13:47:33</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44811996"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44811905">
          <h3>
            <a class="item" href="https://omarchy.org/"
              >Omarchy, a Linux Distribution by DHH</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-06 @ 13:41:46</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44811905"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44811567">
          <h3>
            <a
              class="item"
              href="https://github.com/manzaltu/claude-code-ide.el"
              >Claude Code IDE Integration for Emacs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-06 @ 13:17:38</span
              ><span class="points-container"
                >Points: <span class="points">278</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44811567"
                  >Comments</a
                ><span class="descendants">: 81</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44811387">
          <h3>
            <a class="item" href="https://github.com/shutootaki/bookwith"
              >Show HN: An Open-Source E-Book Reader for Conversational Reading
              with an LLM</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-06 @ 13:01:36</span
              ><span class="points-container"
                >Points: <span class="points">39</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44811387"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
            <div class="text">
              <p>
                The problem: Traditional e-readers are passive. When you
                encounter something unclear, you have to context-switch to
                search for it. Your highlights and notes remain isolated, and
                you can't easily connect ideas across different books.
              </p>
              <p>
                My solution: BookWith embeds an AI that maintains full context
                of what you're reading. It features:
              </p>
              <p>
                - Context-aware AI chat: Ask questions about the current
                page/chapter and get instant answers
              </p>
              <p>
                - AI podcast generation: Automatically converts book content
                into conversational podcasts using Google Cloud TTS
              </p>
              <p>
                - Multi-layer memory system: Short-term (last 5 conversations),
                mid-term (summarized every 20), and long-term (vector search)
                memory that maintains continuity across reading sessions
              </p>
              <p>
                - Smart annotations: 5-color highlighting system that AI can
                reference and analyze
              </p>
              <p>
                Technical stack: Built as a fork of Flow (epub reader), with
                added LLM integration and vector database for semantic search.
                Supports multiple LLMs and languages (EN/JA/ZH).
              </p>
            </div>
          </section>
        </section>
        <section id="44811280">
          <h3>
            <a class="item" href="https://303-gen-06a668.netlify.app/"
              >303Gen – 303 acid loops generator</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-06 @ 12:50:06</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44811280"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44810804">
          <h3>
            <a
              class="item"
              href="https://lithub.com/on-the-future-of-small-presses-in-the-aftermath-of-the-nea-grant-chaos/"
              >The Future of Small Presses in the Aftermath of the NEA Grant
              Chaos</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-06 @ 11:57:21</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44810804"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44810552">
          <h3>
            <a class="item" href="https://nautilustrader.io/"
              >NautilusTrader: Open-source algorithmic trading platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-06 @ 11:23:42</span
              ><span class="points-container"
                >Points: <span class="points">128</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44810552"
                  >Comments</a
                ><span class="descendants">: 55</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44810307">
          <h3>
            <a
              class="item"
              href="https://tratt.net/laurie/blog/2025/llm_inflation.html"
              >LLM Inflation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-06 @ 10:44:38</span
              ><span class="points-container"
                >Points: <span class="points">120</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44810307"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44810281">
          <h3>
            <a class="item" href="https://github.com/ventoy/Ventoy/issues/3224"
              >About the BLOBs in Ventoy</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-06 @ 10:41:01</span
              ><span class="points-container"
                >Points: <span class="points">82</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44810281"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44810061">
          <h3>
            <a
              class="item"
              href="https://open-web-advocacy.org/blog/japan-apple-must-lift-engine-ban-by-december/"
              >Japan: Apple Must Lift Browser Engine Ban by December</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-06 @ 10:07:40</span
              ><span class="points-container"
                >Points: <span class="points">319</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44810061"
                  >Comments</a
                ><span class="descendants">: 231</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44809387">
          <h3>
            <a
              class="item"
              href="https://lwn.net/SubscriberLink/1031707/73cb0cf917307a93/"
              >Python performance myths and fairy tales</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-06 @ 08:36:28</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44809387"
                  >Comments</a
                ><span class="descendants">: 116</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44808794">
          <h3>
            <a class="item" href="https://grell.dev/blog/ai_rejection"
              >I gave the AI arms and legs then it rejected me</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-06 @ 07:25:43</span
              ><span class="points-container"
                >Points: <span class="points">612</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44808794"
                  >Comments</a
                ><span class="descendants">: 288</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44808693">
          <h3>
            <a
              class="item"
              href="https://blog.computationalcomplexity.org/2025/08/some-thoughts-on-journals-refereeing.html"
              >Some thoughts on journals, refereeing, and the P vs NP problem</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-06 @ 07:12:08</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44808693"
                  >Comments</a
                ><span class="descendants">: 24</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44808542">
          <h3>
            <a
              class="item"
              href="https://acko.net/blog/html-is-dead-long-live-html/"
              >Rethinking DOM from first principles</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-06 @ 06:51:13</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44808542"
                  >Comments</a
                ><span class="descendants">: 106</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44807868">
          <h3>
            <a class="item" href="https://github.com/KittenML/KittenTTS"
              >Show HN: Kitten TTS – 25MB CPU-Only, Open-Source TTS Model</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-06 @ 05:04:36</span
              ><span class="points-container"
                >Points: <span class="points">614</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44807868"
                  >Comments</a
                ><span class="descendants">: 269</span></span
              >
            </h4>
            <div class="text">
              <p>
                This release supports English text-to-speech applications in
                eight voices: four male and four female. The model is quantized
                to int8 + fp16, and it uses onnx for runtime. The model is
                designed to run literally anywhere eg. raspberry pi, low-end
                smartphones, wearables, browsers etc. No GPU required!
              </p>
              <p>
                We're releasing this to give early users a sense of the latency
                and voices that will be available in our next release (hopefully
                next week). We'd love your feedback! Just FYI, this model is an
                early checkpoint trained on less than 10% of our total data.
              </p>
              <p>
                We started working on this because existing expressive OSS
                models require big GPUs to run them on-device and the cloud
                alternatives are too expensive for high frequency use. We think
                there's a need for frontier open-source models that are tiny
                enough to run on edge devices!
              </p>
            </div>
          </section>
        </section>
        <section id="44807210">
          <h3>
            <a
              class="item"
              href="https://github.com/Picocrypt/Picocrypt/issues/134"
              >I'm Archiving Picocrypt</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-06 @ 03:14:22</span
              ><span class="points-container"
                >Points: <span class="points">202</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44807210"
                  >Comments</a
                ><span class="descendants">: 120</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44807002">
          <h3>
            <a class="item" href="https://permacomputing.net/software_rot/"
              >Software Rot</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-06 @ 02:35:19</span
              ><span class="points-container"
                >Points: <span class="points">185</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44807002"
                  >Comments</a
                ><span class="descendants">: 157</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44800746">
          <h3>
            <a class="item" href="https://openai.com/open-models/"
              >Open models by OpenAI</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-05 @ 17:02:02</span
              ><span class="points-container"
                >Points: <span class="points">2006</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44800746"
                  >Comments</a
                ><span class="descendants">: 784</span></span
              >
            </h4>
            <div class="text">
              <a href="https://openai.com/index/introducing-gpt-oss/"
                >https://openai.com/index/introducing-gpt-oss/</a
              >
            </div>
          </section>
        </section>
        <section id="44779240">
          <h3>
            <a class="item" href="https://andreas-kupries.github.io/critcl/"
              >Critcl – C Runtime in Tcl</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-03 @ 19:58:55</span
              ><span class="points-container"
                >Points: <span class="points">41</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44779240"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44778772">
          <h3>
            <a
              class="item"
              href="https://books.open.tudelft.nl/home/catalog/book/11"
              >The 1090 Megahertz Riddle: A Guide to Decoding Mode S and ADS-B
              Signals</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-03 @ 18:54:34</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44778772"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="44777086">
          <h3>
            <a class="item" href="https://automerge.org/blog/automerge-3/"
              >Automerge 3.0</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-08-03 @ 15:08:58</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=44777086"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
