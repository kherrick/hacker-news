<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="37597931">
          <h3>
            <a
              class="item"
              href="https://www.statnews.com/2023/09/21/als-gene-carrier-riluzole-toferson/"
              >They have genetic ALS. What should clinicians do?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 14:14:25</span
              ><span class="points-container"
                >Points: <span class="points">15</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37597931"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37597207">
          <h3>
            <a
              class="item"
              href="https://apnews.com/article/google-maps-lawsuit-north-carolina-death-f4707247ee3295bf51bbcb37bd0eb6c8"
              >Google sued for negligence after man died following map
              directions</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 13:19:26</span
              ><span class="points-container"
                >Points: <span class="points">28</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37597207"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37597201">
          <h3>
            <a class="item" href="https://github.com/memgraph/odin"
              >Show HN: Odin – the integration of LLMs with Obsidian note
              taking</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 13:18:58</span
              ><span class="points-container"
                >Points: <span class="points">45</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37597201"
                  >Comments</a
                ><span class="descendants">: 26</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37597165">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/education/2023/sep/21/calls-to-shut-down-bristol-schools-use-of-think-family-education-app-pupils-and-families"
              >Call to shut down Bristol schools’ use of app to ‘monitor’ pupils
              and families</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 13:16:09</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37597165"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37596788">
          <h3>
            <a
              class="item"
              href="https://www.catsuka.com/breves/2023-09-21/nippon-television-rachete-le-studio-ghibli"
              >Nippon Television has just acquired Studio Ghibli</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 12:44:11</span
              ><span class="points-container"
                >Points: <span class="points">233</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37596788"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37596776">
          <h3>
            <a
              class="item"
              href="https://andreyor.st/posts/2023-09-20-why-kakoune/"
              >Why Kakoune</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 12:42:44</span
              ><span class="points-container"
                >Points: <span class="points">36</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37596776"
                  >Comments</a
                ><span class="descendants">: 7</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37596755">
          <h3>
            <a
              class="item"
              href="https://www.theatlantic.com/ideas/archive/2023/09/airlines-banks-mileage-programs/675374/"
              >Airlines Are Just Banks Now</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 12:40:58</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37596755"
                  >Comments</a
                ><span class="descendants">: 86</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37596738">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/09/19/intel_pcs_nvidia/"
              >Intel slaps forehead, says I got it: AI PCs. Sell them AI PCs</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 12:39:47</span
              ><span class="points-container"
                >Points: <span class="points">40</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37596738"
                  >Comments</a
                ><span class="descendants">: 27</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37596498">
          <h3>
            <a
              class="item"
              href="https://www.paypal-status.com/incident/production"
              >BrainTree has been down for more than 7 hours now</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 12:15:19</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37596498"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37596497">
          <h3>
            <a
              class="item"
              href="https://www.splunk.com/en_us/blog/leadership/splunk-and-cisco-unite-to-accelerate-digital-resilience-as-one-of-the-leading-global-software-companies.html"
              >Cisco Acquires Splunk</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 12:15:19</span
              ><span class="points-container"
                >Points: <span class="points">310</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37596497"
                  >Comments</a
                ><span class="descendants">: 163</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37596253">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=37596253"
              >Launch HN: Loops (YC W22) – Email for SaaS Companies</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 11:48:51</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37596253"
                  >Comments</a
                ><span class="descendants">: 35</span></span
              >
            </h4>
            <div class="text">
              <a href="https://loops.so">https://loops.so</a>), a platform aimed
              at simplifying the email experience for SaaS companies. We support
              creating and sending marketing, product, and transactional email.
              <p>
                Email is important but painful to manage. If you've ever dealt
                with the frustration of coding emails by hand, testing them
                across multiple clients, or integrating them into various SaaS
                tools, you might find our approach interesting.
              </p>
              <p>
                We make it simple to design and send email to your users either
                manually in the app, via API or triggered via an integration. We
                offer unlimited team seats, so your product team can help align
                copy, your marketing team can send newsletters, your revenue
                team can work on dunning and your engineers can have a solid API
                to help orchestrate the sends.
              </p>
              <p>
                Most of our competitors use email editors that are licensed from
                a third party. Our editor is built from the ground up on the
                Lexical text editor from Meta, extended beyond just text nodes.
                It supports mobile editing and dark mode, and it autosaves your
                changes.
              </p>
              <p>
                Our REST API is straightforward, and we have integrations with
                tools like Segment and Census. Documentation is available at
                <a href="https://loops.so/docs">https://loops.so/docs</a>. On
                our homepage, right under the fold, we list endpoints and sample
                payloads.
              </p>
              <p>
                One issue we've worked hard to address is email compatibility
                across devices and platforms. It's a problem full of edge cases
                that we've mitigated by extending MJML, a markup language
                designed for responsive email, to be even more compliant across
                different platforms. We don't think you should have to code and
                test your emails. Email copy shouldn't live in your codebase.
              </p>
              <p>
                If you're concerned about spam, we are too. We educate our users
                on CAN-SPAM rules and automatically add compliant footers to
                emails. We actively monitor to ensure our platform isn't used
                for spam, and we do not allow cold sales emails.
              </p>
              <p>
                Our pricing is upfront and available on our website. You can try
                the platform for free without a credit card. We launched
                publicly a week ago. We're really interested in any technical
                feedback you have, as we aim to make this tool as
                developer-friendly as possible.
              </p>
              <p>Looking forward to hearing your thoughts!</p>
            </div>
          </section>
        </section>
        <section id="37596068">
          <h3>
            <a
              class="item"
              href="https://maritime-executive.com/article/crowley-partners-with-bwxt-to-develop-nuclear-power-generation-vessels"
              >BWXT and Crowley Developing Nuclear Power Generation Ships</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 11:27:56</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37596068"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37595766">
          <h3>
            <a
              class="item"
              href="https://github.com/madmurphy/libconfini/wiki/An-INI-critique-of-TOML"
              >An INI Critique of TOML</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 10:41:02</span
              ><span class="points-container"
                >Points: <span class="points">70</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37595766"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37595322">
          <h3>
            <a
              class="item"
              href="https://successfulsoftware.net/2023/09/19/ship-of-fools/"
              >Ship of Fools</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 09:36:21</span
              ><span class="points-container"
                >Points: <span class="points">90</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37595322"
                  >Comments</a
                ><span class="descendants">: 40</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37594855">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/09/21/india_cybercrime_trends_report/"
              >India's biggest tech centers named as cyber crime hotspots</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 08:39:30</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37594855"
                  >Comments</a
                ><span class="descendants">: 99</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37594525">
          <h3>
            <a
              class="item"
              href="https://erlangforums.com/t/erlang-otp-26-1-released/2886"
              >Erlang/OTP 26.1 Released</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 07:56:14</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37594525"
                  >Comments</a
                ><span class="descendants">: 45</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37594365">
          <h3>
            <a
              class="item"
              href="https://www.undeadly.org/cgi?action=article;sid=20230921073556"
              >OpenBSD/ARM64 on Hetzner Cloud</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 07:36:31</span
              ><span class="points-container"
                >Points: <span class="points">161</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37594365"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37593967">
          <h3>
            <a
              class="item"
              href="https://elixir-lang.org/blog/2023/09/20/strong-arrows-gradual-typing/"
              >Strong arrows: a new approach to gradual typing</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 06:39:03</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37593967"
                  >Comments</a
                ><span class="descendants">: 34</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37593459">
          <h3>
            <a
              class="item"
              href="https://christitus.com/install-windows-the-arch-linux-way/"
              >Install Windows the Arch Linux Way</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 05:15:25</span
              ><span class="points-container"
                >Points: <span class="points">275</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37593459"
                  >Comments</a
                ><span class="descendants">: 120</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37592934">
          <h3>
            <a
              class="item"
              href="https://blog.0x7d0.dev/history/how-equifax-was-breached-in-2017/"
              >How Equifax Was Breached in 2017</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 03:35:43</span
              ><span class="points-container"
                >Points: <span class="points">207</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37592934"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37592699">
          <h3>
            <a
              class="item"
              href="https://www.eff.org/deeplinks/2023/09/today-uk-parliament-undermined-privacy-security-and-freedom-all-internet-users"
              >UK Parliament undermined the privacy, security, freedom of all
              internet users</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 02:51:08</span
              ><span class="points-container"
                >Points: <span class="points">565</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37592699"
                  >Comments</a
                ><span class="descendants">: 329</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37591652">
          <h3>
            <a
              class="item"
              href="https://web.math.princeton.edu/generals/tao_terence"
              >Terry Tao's generals (2012)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-21 @ 00:00:28</span
              ><span class="points-container"
                >Points: <span class="points">269</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37591652"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37587233">
          <h3>
            <a
              class="item"
              href="https://jensrantil.github.io/posts/fast-aggregate-queries-on-dynamic-data/"
              >Fine-grained caching strategies of dynamic queries</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 17:42:24</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37587233"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37586285">
          <h3>
            <a
              class="item"
              href="https://machines-reading-maps.github.io/rumsey/"
              >Guide to Searching and Annotating Text on Maps</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 16:32:06</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37586285"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37584399">
          <h3>
            <a
              class="item"
              href="http://www.cs.cmu.edu/~wkw/humour/carproblems.txt"
              >Car allergic to vanilla ice cream (2000)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 14:14:12</span
              ><span class="points-container"
                >Points: <span class="points">1539</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37584399"
                  >Comments</a
                ><span class="descendants">: 458</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37582632">
          <h3>
            <a
              class="item"
              href="https://developers.redhat.com/blog/2018/10/22/introduction-to-linux-interfaces-for-virtual-networking"
              >Introduction to Linux interfaces for virtual networking (2018)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 10:48:36</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37582632"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37582599">
          <h3>
            <a
              class="item"
              href="https://iximiuz.com/en/posts/container-networking-is-simple/"
              >How Container Networking Works: Practical Explanation</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 10:42:46</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37582599"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37581646">
          <h3>
            <a
              class="item"
              href="https://www.macarthur.me/posts/more-aggressive-cache-headers"
              >Cache headers could probably be more aggressive</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 08:01:44</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37581646"
                  >Comments</a
                ><span class="descendants">: 46</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37580981">
          <h3>
            <a
              class="item"
              href="http://peter.eisentraut.org/blog/2023/09/20/grouping-digits-in-sql"
              >Grouping digits in SQL</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-20 @ 06:20:11</span
              ><span class="points-container"
                >Points: <span class="points">85</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37580981"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="37570889">
          <h3>
            <a
              class="item"
              href="https://www.servethehome.com/intel-xeon-max-9480-deep-dive-intel-has-64gb-hbm2e-onboard-like-a-gpu-or-ai-accelerator/"
              >Intel Xeon Max 9480 Deep-Dive 64GB HBM2e Onboard Like a GPU or AI
              Accelerator</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-09-19 @ 15:00:40</span
              ><span class="points-container"
                >Points: <span class="points">73</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=37570889"
                  >Comments</a
                ><span class="descendants">: 33</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
