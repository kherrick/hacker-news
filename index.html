<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="45666327">
          <h3>
            <a class="item" href="https://github.com/FarisZR/knocker"
              >Knocker, a knock based access control system for your homelab</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-22 @ 08:37:31</span
              ><span class="points-container"
                >Points: <span class="points">11</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45666327"
                  >Comments</a
                ><span class="descendants">: 18</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45665796">
          <h3>
            <a
              class="item"
              href="https://www.dagens.com/technology/greenland-ditches-starlink-for-french-satellite-service"
              >Greenland Ditches Starlink for French Satellite Service</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-22 @ 07:14:40</span
              ><span class="points-container"
                >Points: <span class="points">275</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45665796"
                  >Comments</a
                ><span class="descendants">: 132</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45665452">
          <h3>
            <a class="item" href="https://github.com/minio/minio/issues/21647"
              >MinIO (apparently) becomes source-only</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-22 @ 06:17:18</span
              ><span class="points-container"
                >Points: <span class="points">113</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45665452"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45665311">
          <h3>
            <a
              class="item"
              href="https://www.bbc.com/news/articles/cvgkm2j0xelo"
              >French ex-president Sarkozy begins jail sentence</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-22 @ 05:49:58</span
              ><span class="points-container"
                >Points: <span class="points">129</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45665311"
                  >Comments</a
                ><span class="descendants">: 150</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45664848">
          <h3>
            <a
              class="item"
              href="https://chipsandcheese.com/p/evaluating-the-infinity-cache-in"
              >Evaluating the Infinity Cache in AMD Strix Halo</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-22 @ 04:20:09</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45664848"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45664147">
          <h3>
            <a
              class="item"
              href="https://cdn.openbsd.org/pub/OpenBSD/7.8/ANNOUNCEMENT"
              >OpenBSD 7.8</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-22 @ 02:02:58</span
              ><span class="points-container"
                >Points: <span class="points">204</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45664147"
                  >Comments</a
                ><span class="descendants">: 69</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45662668">
          <h3>
            <a
              class="item"
              href="https://practical.engineering/blog/2025/10/21/the-hidden-engineering-of-niagara-falls"
              >The Hidden Engineering of Niagara Falls</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-21 @ 22:43:07</span
              ><span class="points-container"
                >Points: <span class="points">118</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45662668"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45661638">
          <h3>
            <a
              class="item"
              href="https://github.com/raysan5/raylib/blob/master/src/external/rlsw.h"
              >rlsw – Raylib software OpenGL renderer in less than 5k LOC</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-21 @ 21:00:10</span
              ><span class="points-container"
                >Points: <span class="points">192</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45661638"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45661462">
          <h3>
            <a
              class="item"
              href="https://hudsonreview.com/2025/10/the-gypsy-life-of-robert-louis-stevenson/"
              >The Gypsy Life of Robert Louis Stevenson</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-21 @ 20:44:39</span
              ><span class="points-container"
                >Points: <span class="points">33</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45661462"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45661306">
          <h3>
            <a class="item" href="https://www.erowid.org"
              >Erowid - Documenting the Complex Relationship Between Humans and
              Psychoactives</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-21 @ 20:31:47</span
              ><span class="points-container"
                >Points: <span class="points">107</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45661306"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45661253">
          <h3>
            <a
              class="item"
              href="https://disco.cloud/blog/how-idealistorg-replaced-a-3000mo-heroku-bill-with-a-55-server/"
              >Replacing a $3000/mo Heroku bill with a $55/mo server</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-21 @ 20:28:15</span
              ><span class="points-container"
                >Points: <span class="points">658</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45661253"
                  >Comments</a
                ><span class="descendants">: 444</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45659883">
          <h3>
            <a
              class="item"
              href="https://newatlas.com/disease/butt-breathing-ignobel-prize/"
              >Researchers complete first human trial on viability of enteral
              ventilation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-21 @ 18:44:39</span
              ><span class="points-container"
                >Points: <span class="points">60</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45659883"
                  >Comments</a
                ><span class="descendants">: 56</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45658479">
          <h3>
            <a class="item" href="https://chatgpt.com/atlas">ChatGPT Atlas</a>
          </h3>
          <section>
            <h4>
              <span>2025-10-21 @ 17:18:13</span
              ><span class="points-container"
                >Points: <span class="points">688</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45658479"
                  >Comments</a
                ><span class="descendants">: 653</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45657827">
          <h3>
            <a class="item" href="https://www.nan.fyi/database"
              >Build your own database</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-21 @ 16:31:51</span
              ><span class="points-container"
                >Points: <span class="points">498</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45657827"
                  >Comments</a
                ><span class="descendants">: 78</span></span
              >
            </h4>
            <div class="text">
              <a
                href="https://www.oreilly.com/library/view/designing-data-intensive-applications/9781491903063/"
                >https://www.oreilly.com/library/view/designing-data-intensiv...</a
              >
            </div>
          </section>
        </section>
        <section id="45657345">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=45657345"
              >Ask HN: Our AWS account got compromised after their outage</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-21 @ 15:55:41</span
              ><span class="points-container"
                >Points: <span class="points">312</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45657345"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
            <div class="text">
              <p>Here is what happened:</p>
              <p>
                Some 600 instances were spawned within 3 hours before AWS
                flagged it off and sent us a health event. There were numerous
                domains verified and we could see SES quota increase request was
                made.
              </p>
              <p>
                We are still investigating the vulnerability at our end. our
                initial suspect list has 2 suspects. api key or console access
                where MFA wasn’t enabled.
              </p>
            </div>
          </section>
        </section>
        <section id="45656223">
          <h3>
            <a class="item" href="https://llm-brain-rot.github.io/"
              >LLMs can get "brain rot"</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-21 @ 14:24:26</span
              ><span class="points-container"
                >Points: <span class="points">386</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45656223"
                  >Comments</a
                ><span class="descendants">: 230</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45655188">
          <h3>
            <a
              class="item"
              href="https://www.cnn.com/2025/10/20/science/nasa-spacex-moon-landing-contract-sean-duffy"
              >NASA chief suggests SpaceX may be booted from moon mission</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-21 @ 12:58:43</span
              ><span class="points-container"
                >Points: <span class="points">318</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45655188"
                  >Comments</a
                ><span class="descendants">: 853</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45655161">
          <h3>
            <a class="item" href="https://kyutai.org/next/codec-explainer"
              >Neural audio codecs: how to get audio into LLMs</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-21 @ 12:55:59</span
              ><span class="points-container"
                >Points: <span class="points">385</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45655161"
                  >Comments</a
                ><span class="descendants">: 112</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45649510">
          <h3>
            <a
              class="item"
              href="https://buttondown.com/jaffray/archive/the-death-of-thread-per-core/"
              >The death of thread per core</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-20 @ 21:19:19</span
              ><span class="points-container"
                >Points: <span class="points">122</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45649510"
                  >Comments</a
                ><span class="descendants">: 50</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45646559">
          <h3>
            <a
              class="item"
              href="https://simonwillison.net/2025/Oct/20/deepseek-ocr-claude-code/"
              >Getting DeepSeek-OCR working on an Nvidia Spark via brute force
              with Claude Code</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-20 @ 17:24:49</span
              ><span class="points-container"
                >Points: <span class="points">170</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45646559"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45646414">
          <h3>
            <a
              class="item"
              href="https://www.universetoday.com/articles/what-do-we-do-if-seti-is-successful"
              >What do we do if SETI is successful?</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-20 @ 17:13:44</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45646414"
                  >Comments</a
                ><span class="descendants">: 278</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45606853">
          <h3>
            <a
              class="item"
              href="https://www.newscientist.com/article/2499647-mathematicians-have-found-a-hidden-reset-button-for-undoing-rotation/"
              >Mathematicians have found a hidden 'reset button' for undoing
              rotation</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 15:47:17</span
              ><span class="points-container"
                >Points: <span class="points">148</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45606853"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45605556">
          <h3>
            <a
              class="item"
              href="https://www.edn.com/poe-basics-and-beyond-what-every-engineer-should-know/"
              >Power over Ethernet (PoE) basics and beyond</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 14:09:21</span
              ><span class="points-container"
                >Points: <span class="points">164</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45605556"
                  >Comments</a
                ><span class="descendants">: 113</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45604013">
          <h3>
            <a class="item" href="https://github.com/joouha/modshim"
              >Show HN: Modshim – A new alternative to monkey-patching in
              Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-16 @ 11:17:56</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45604013"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
            <div class="text">
              <p>
                It's a bit like OverlayFS for Python modules - it allows you
                write modifications for a target module (lower) in a new module
                (upper), and have these combined in a new virtual module
                (mount).
              </p>
              <p>
                It works by rewriting imports using AST transformations, then
                running both the lower and upper module's code in the new Python
                module.
              </p>
              <p>
                This prevents polluting the global namespace when
                monkey-patching, and means if you want to make changes to a
                third-party package, you don't have to take on the maintenance
                burden of forking, you can package and distribute just your
                changes.
              </p>
            </div>
          </section>
        </section>
        <section id="45588752">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2504.17121"
              >Evaluating Argon2 Adoption and Effectiveness in Real-World
              Software</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-15 @ 06:29:18</span
              ><span class="points-container"
                >Points: <span class="points">5</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45588752"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45580683">
          <h3>
            <a
              class="item"
              href="https://danglingpointers.substack.com/p/principles-and-methodologies-for"
              >Principles and Methodologies for Serial Performance
              Optimization</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-14 @ 14:43:45</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45580683"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45566730">
          <h3>
            <a class="item" href="https://cadenceguitar.com/"
              >Show HN: Cadence – A Guitar Theory App</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-13 @ 10:18:29</span
              ><span class="points-container"
                >Points: <span class="points">44</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45566730"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
            <div class="text">
              <p>
                The idea was to make something for the eternally "intermediate"
                guitarist (myself included). There are a lot of beginner apps
                which rely on learning songs, toolkits which give you a bunch of
                stuff with no explanation but not many in-between apps to
                actually learn and practice more generic and somewhat advanced
                stuff.
              </p>
              <p>
                The app contains short lessons, recaps and most importantly
                challenges (visual, audio and pure theory) along with a very
                complete library.
              </p>
              <p>
                The challenges are made for practicing, they will get
                increasingly harder and getting to the max score is supposed to
                be quite hard. The idea being that you have to repeat them
                regularly until your brain has integrated the info and it flows
                naturally rather than being a one time quick dopamine shot. This
                is partly inspired by how language learning apps work.
              </p>
              <p>
                It has no ads, a lifetime purchase option and you can use it
                without an account if you don't care about multi-device sync or
                backing up your progress.
              </p>
              <p>
                Android:
                <a
                  href="https://play.google.com/store/apps/details?id=com.apizon.cadence.android"
                  >https://play.google.com/store/apps/details?id=com.apizon.cad...</a
                >
              </p>
              <p>
                iOS:
                <a
                  href="https://apps.apple.com/us/app/cadence-guitar-theory/id6747011447?platform=iphone"
                  >https://apps.apple.com/us/app/cadence-guitar-theory/id674701...</a
                >
              </p>
              <p>
                (This is my second and last post about this sorry for spam. My
                first post a few weeks ago didn't get any views and posting on a
                saturday might not have helped...)
              </p>
            </div>
          </section>
        </section>
        <section id="45565793">
          <h3>
            <a
              class="item"
              href="https://harrisoncramer.me/15-go-sublteties-you-may-not-already-know/"
              >Go Subtleties You May Not Know</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-13 @ 07:42:43</span
              ><span class="points-container"
                >Points: <span class="points">46</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45565793"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45564821">
          <h3>
            <a
              class="item"
              href="https://home.csulb.edu/~cwallis/382/readings/482/searle.minds.brains.programs.bbs.1980.pdf"
              >Minds, brains, and programs (1980) [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-13 @ 05:01:11</span
              ><span class="points-container"
                >Points: <span class="points">83</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45564821"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="45557599">
          <h3>
            <a class="item" href="https://community.kde.org/KDEConnect"
              >KDE Connect: Enabling communication between all your devices</a
            >
          </h3>
          <section>
            <h4>
              <span>2025-10-12 @ 12:04:51</span
              ><span class="points-container"
                >Points: <span class="points">452</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=45557599"
                  >Comments</a
                ><span class="descendants">: 181</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2025/index.md"
              >2025</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
