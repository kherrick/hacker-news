<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="42532441">
          <h3>
            <a
              class="item"
              href="https://chuckwnelson.com/blog/google-search-results-infested-open-ai-using-google-playbook"
              >Google's Results Are Infested, Open AI Is Using Their Playbook
              from the 2000s</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-28 @ 17:06:40</span
              ><span class="points-container"
                >Points: <span class="points">206</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42532441"
                  >Comments</a
                ><span class="descendants">: 213</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42532157">
          <h3>
            <a
              class="item"
              href="https://yosefk.com/blog/my-history-with-forth-stack-machines.html"
              >My history with Forth and stack machines (2010)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-28 @ 16:34:24</span
              ><span class="points-container"
                >Points: <span class="points">25</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42532157"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42531874">
          <h3>
            <a
              class="item"
              href="https://btiffin.users.sourceforge.net/up/unicon.html"
              >The Unicon Programming Language</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-28 @ 15:55:46</span
              ><span class="points-container"
                >Points: <span class="points">34</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42531874"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42531830">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=42531830"
              >Ask HN: Are you unable to find employment?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-28 @ 15:48:02</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42531830"
                  >Comments</a
                ><span class="descendants">: 136</span></span
              >
            </h4>
            <div class="text">
              <p>
                I am attempting to gain some insight into the issue. My
                situation is somewhat unique in that I am self-taught without a
                CS degree. I'm a very experienced, diligent worker, etc, but an
                algorithm doesn't care about this and so getting through the
                filters is difficult.
              </p>
              <p>
                However I see many discussions being posted (primarily on X)
                stating that it is nearly impossible for people with CS degrees
                (especially white males) to get an interview let alone a job.
                There have been mass layoffs, less money being invested etc.
                Many people have claimed AI is taking jobs, or that there aren't
                as many jobs available, yet at the same time, Elon Musk and
                others claim there is an engineer shortage and we must increase
                the number of H-1B visas in order to fill this gap. When I apply
                to a position on linkedin I can see that even the most Jr
                positions have over 100 applicants.
              </p>
              <p>
                I know that X can be slanted, and really anything posted online
                must be taken with a grain of salt - but I'm seeing many people
                claiming to be in the same situation as myself, and most of them
                claim to be white males.
              </p>
              <p>
                Furthermore, in the last two years I experienced two layoffs. In
                both situations it was white males let go in favor of Indian and
                KZ foreigners. Again - this is anecdotal and could be a
                coincidence, but its awfully telling that Vivek and Elon are
                calling American tech workers uncultured, lazy and stupid in the
                wake of these experiences and those that I've read about online.
              </p>
              <p>
                I don't want to start a war here on hackernews, but I'm looking
                for people's personal experiences. Do they match up? Are you
                having a hard time finding employment? Have you been fired in
                favor of foreign workers? Is this racism / ageism / sexism at
                play or is that being overblown by political actors?
              </p>
            </div>
          </section>
        </section>
        <section id="42531695">
          <h3>
            <a
              class="item"
              href="https://blog.daviddodda.com/how-i-automated-my-job-application-process-part-1"
              >I Automated My Job Application Process</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-28 @ 15:26:31</span
              ><span class="points-container"
                >Points: <span class="points">63</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42531695"
                  >Comments</a
                ><span class="descendants">: 141</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42531217">
          <h3>
            <a
              class="item"
              href="https://sachachua.com/blog/2024/12/emacsconf-2024-notes/"
              >EmacsConf 2024 Notes</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-28 @ 14:22:30</span
              ><span class="points-container"
                >Points: <span class="points">155</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42531217"
                  >Comments</a
                ><span class="descendants">: 29</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42530991">
          <h3>
            <a
              class="item"
              href="https://ptrtojoel.dev/posts/so-you-want-to-write-java-in-neovim/"
              >So You Want to Write Java in Neovim</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-28 @ 13:41:48</span
              ><span class="points-container"
                >Points: <span class="points">97</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42530991"
                  >Comments</a
                ><span class="descendants">: 58</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42530418">
          <h3>
            <a
              class="item"
              href="https://jobs.ashbyhq.com/permitflow?departmentId=d33195eb-8978-4439-abc6-5a8a072de808"
              >PermitFlow (YC W22) Is Hiring Senior/Staff Engineers in NYC</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-28 @ 12:01:27</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42530410">
          <h3>
            <a
              class="item"
              href="https://www.digitalmusicnews.com/2024/12/23/billionaire-daniel-ek-shuts-down-spotify-unwrapped-calculator/"
              >Spotify Shuts Down ‘Unwrapped’ Artist Royalty Calculator with
              Legal Threats</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-28 @ 12:00:09</span
              ><span class="points-container"
                >Points: <span class="points">132</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42530410"
                  >Comments</a
                ><span class="descendants">: 175</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42530332">
          <h3>
            <a class="item" href="https://www.chronotrains.com/en"
              >Where can you go in Europe by train in 8h?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-28 @ 11:43:15</span
              ><span class="points-container"
                >Points: <span class="points">242</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42530332"
                  >Comments</a
                ><span class="descendants">: 162</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42529756">
          <h3>
            <a
              class="item"
              href="https://www.nplusonemag.com/issue-49/essays/casual-viewing/"
              >Casual Viewing – Why Netflix looks like that</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-28 @ 09:32:32</span
              ><span class="points-container"
                >Points: <span class="points">234</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42529756"
                  >Comments</a
                ><span class="descendants">: 273</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42529023">
          <h3>
            <a
              class="item"
              href="https://www.ams.org/notices/202501/rnoti-p6.pdf"
              >Machine-Assisted Proof [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-28 @ 06:20:38</span
              ><span class="points-container"
                >Points: <span class="points">165</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42529023"
                  >Comments</a
                ><span class="descendants">: 90</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42528302">
          <h3>
            <a class="item" href="https://nytpu.com/gemlog/2024-12-27"
              >Ada's dependent types, and its types as a whole</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-28 @ 03:22:29</span
              ><span class="points-container"
                >Points: <span class="points">201</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42528302"
                  >Comments</a
                ><span class="descendants">: 103</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42528216">
          <h3>
            <a
              class="item"
              href="https://forum.level1techs.com/t/bizarre-pcie-trouble-with-4tb-crucial-t500-nvme-ssd/222915"
              >PCIe trouble with 4TB Crucial T500 NVMe SSD for &amp;gt;1 power
              cycle on MSI PRO X670-P</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-28 @ 03:04:08</span
              ><span class="points-container"
                >Points: <span class="points">126</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42528216"
                  >Comments</a
                ><span class="descendants">: 65</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42527743">
          <h3>
            <a
              class="item"
              href="https://www.bmj.com/content/387/bmj-2024-081814"
              >Dexterity assessment of hospital workers: prospective comparative
              study</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-28 @ 01:28:12</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42527743"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42527572">
          <h3>
            <a
              class="item"
              href="https://www.timesnownews.com/sports/magnus-carlsen-disqualified-from-world-rapid-and-blitz-championship-for-wearing-jeans-article-116727852"
              >Carlsen disqualified from World Rapid and Blitz championship for
              wearing jeans</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-28 @ 00:54:06</span
              ><span class="points-container"
                >Points: <span class="points">102</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42527572"
                  >Comments</a
                ><span class="descendants">: 195</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42527496">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2404.01332"
              >Explaining Large Language Models Decisions Using Shapley
              Values</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-28 @ 00:44:18</span
              ><span class="points-container"
                >Points: <span class="points">75</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42527496"
                  >Comments</a
                ><span class="descendants">: 15</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42527265">
          <h3>
            <a
              class="item"
              href="https://media.ccc.de/v/38c3-liberating-wi-fi-on-the-esp32"
              >Liberating Wi-Fi on the ESP32 [video]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-28 @ 00:03:05</span
              ><span class="points-container"
                >Points: <span class="points">283</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42527265"
                  >Comments</a
                ><span class="descendants">: 100</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42525633">
          <h3>
            <a class="item" href="https://www.plasticlist.org/report"
              >Plasticlist Report – Data on plastic chemicals in Bay Area
              foods</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-27 @ 20:15:44</span
              ><span class="points-container"
                >Points: <span class="points">541</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42525633"
                  >Comments</a
                ><span class="descendants">: 169</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42525384">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/tsmc-arizona"
              >TSMC's Arizona Plant to Start Making Advanced Chips</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-27 @ 19:43:23</span
              ><span class="points-container"
                >Points: <span class="points">288</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42525384"
                  >Comments</a
                ><span class="descendants">: 119</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42524174">
          <h3>
            <a
              class="item"
              href="https://www.lloydslist.com/LL1151955/Russia-linked-cable-cutting-tanker-seized-by-Finland-was-loaded-with-spying-equipment"
              >Cable-cutting tanker seized by Finland 'was loaded with spying
              equipment'</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-27 @ 17:36:50</span
              ><span class="points-container"
                >Points: <span class="points">471</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42524174"
                  >Comments</a
                ><span class="descendants">: 337</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42523745">
          <h3>
            <a class="item" href="https://www.lucaiaconistewart.com/model-777"
              >Scale Model of Boeing 777-300ER, Made from Manila Folders</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-27 @ 16:53:33</span
              ><span class="points-container"
                >Points: <span class="points">520</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42523745"
                  >Comments</a
                ><span class="descendants">: 98</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42515638">
          <h3>
            <a
              class="item"
              href="https://www.smithsonianmag.com/smart-news/notre-dame-to-get-a-colorful-update-with-new-stained-glass-by-claire-tabouret-180985731/"
              >Get a Colorful Sneak Peek of Notre-Dame's New Stained Glass
              Designs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-26 @ 15:08:25</span
              ><span class="points-container"
                >Points: <span class="points">22</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42515638"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42515584">
          <h3>
            <a
              class="item"
              href="https://phys.org/news/2024-12-ancient-genomes-word-indo-european.html"
              >Ancient genomes provide final word in Indo-European linguistic
              origins</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-26 @ 15:00:27</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42515584"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42515315">
          <h3>
            <a class="item" href="https://www.christo.sh/numbers-are-leaves/"
              >Numbers Are Leaves</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-26 @ 14:23:30</span
              ><span class="points-container"
                >Points: <span class="points">110</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42515315"
                  >Comments</a
                ><span class="descendants">: 25</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42515238">
          <h3>
            <a
              class="item"
              href="https://pieces.app/blog/phi-3-mini-integrations"
              >Exploring Microsoft's Phi-3-Mini and its integration with tool
              like Ollama</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-26 @ 14:09:37</span
              ><span class="points-container"
                >Points: <span class="points">18</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42515238"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42514105">
          <h3>
            <a
              class="item"
              href="https://www.architecturaldigest.com/story/should-more-of-us-be-moving-to-live-near-friends"
              >Should more of us be moving to live near friends?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-26 @ 09:23:08</span
              ><span class="points-container"
                >Points: <span class="points">476</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42514105"
                  >Comments</a
                ><span class="descendants">: 341</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42513331">
          <h3>
            <a
              class="item"
              href="https://www.sonair.com/journal/building-for-safety-with-rust"
              >Building a 3D safety sensor with Rust</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-26 @ 05:29:17</span
              ><span class="points-container"
                >Points: <span class="points">52</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42513331"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42507932">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/gadgets/2022/03/the-ars-technica-guide-to-mechanical-keyboards/"
              >Ars Technica guide to mechanical keyboards</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 09:47:38</span
              ><span class="points-container"
                >Points: <span class="points">12</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42507932"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="42506984">
          <h3>
            <a
              class="item"
              href="https://fhur.me/posts/2024/thats-not-an-abstraction"
              >That's not an abstraction, that's a layer of indirection</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-12-25 @ 05:06:58</span
              ><span class="points-container"
                >Points: <span class="points">458</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=42506984"
                  >Comments</a
                ><span class="descendants">: 189</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
