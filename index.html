<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="38775579">
          <h3>
            <a class="item" href="https://github.com/macos-fuse-t/fuse-t"
              >FUSE-T is a kext-less implementation of FUSE for macOS that uses
              NFSv4</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-26 @ 20:13:48</span
              ><span class="points-container"
                >Points: <span class="points">42</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38775579"
                  >Comments</a
                ><span class="descendants">: 13</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38775439">
          <h3>
            <a
              class="item"
              href="https://www.freethink.com/health/cancer-vaccine"
              >Moderna's mRNA cancer vaccine works even better than thought</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-26 @ 19:58:41</span
              ><span class="points-container"
                >Points: <span class="points">71</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38775439"
                  >Comments</a
                ><span class="descendants">: 14</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38775323">
          <h3>
            <a
              class="item"
              href="https://www.theguardian.com/media/2023/nov/18/giulia-carla-rossi-british-library-digital-curator-preserving-internet-publications"
              >There is a misconception that if something's on the internet
              it'll last for</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-26 @ 19:46:45</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38775323"
                  >Comments</a
                ><span class="descendants">: 10</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38775017">
          <h3>
            <a
              class="item"
              href="https://gamerant.com/baldurs-gate-3-jaheira-tracy-wiles-youtube-banned-why/"
              >YouTube Bans Baldur's Gate 3 Jaheira Actor</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-26 @ 19:20:46</span
              ><span class="points-container"
                >Points: <span class="points">23</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38775017"
                  >Comments</a
                ><span class="descendants">: 11</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38774792">
          <h3>
            <a class="item" href="https://danq.me/2022/09/27/freshrss-xpath/"
              >XPath Scraping with FreshRSS</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-26 @ 19:02:18</span
              ><span class="points-container"
                >Points: <span class="points">14</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38774792"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38774165">
          <h3>
            <a class="item" href="https://text.causal.agency/001-make.txt"
              >Using Make – writing less Makefile</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-26 @ 18:05:54</span
              ><span class="points-container"
                >Points: <span class="points">99</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38774165"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38774026">
          <h3>
            <a class="item" href="https://vram.asmirnov.xyz/"
              >Show HN: I made a GPU VRAM calculator for transformer-based
              models</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-26 @ 17:53:56</span
              ><span class="points-container"
                >Points: <span class="points">21</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38774026"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38773957">
          <h3>
            <a
              class="item"
              href="https://github.com/minimaxir/hacker-news-undocumented/blob/master/README.md"
              >A list of Hacker News's undocumented features and behaviors</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-26 @ 17:47:27</span
              ><span class="points-container"
                >Points: <span class="points">224</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38773957"
                  >Comments</a
                ><span class="descendants">: 95</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38773669">
          <h3>
            <a
              class="item"
              href="https://shop.invisible-computers.com/products/invisible-calendar"
              >The Invisible Screen – An E-Paper Smart Display</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-26 @ 17:18:20</span
              ><span class="points-container"
                >Points: <span class="points">57</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38773669"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38773662">
          <h3>
            <a
              class="item"
              href="https://www.gapminder.org/news/100-positive-news-from-2023/"
              >Positive news from 2023</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-26 @ 17:17:45</span
              ><span class="points-container"
                >Points: <span class="points">159</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38773662"
                  >Comments</a
                ><span class="descendants">: 93</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38773533">
          <h3>
            <a
              class="item"
              href="https://events.ccc.de/congress/2023/infos/startpage.html"
              >37C3 Unlocked (37th Chaos Communication Congress)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-26 @ 17:05:38</span
              ><span class="points-container"
                >Points: <span class="points">50</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38773533"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38773429">
          <h3>
            <a
              class="item"
              href="https://asia.nikkei.com/Business/Technology/Japan-to-crack-down-on-Apple-and-Google-app-store-monopolies"
              >Japan to crack down on Apple and Google app store monopolies</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-26 @ 16:54:31</span
              ><span class="points-container"
                >Points: <span class="points">312</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38773429"
                  >Comments</a
                ><span class="descendants">: 135</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38773203">
          <h3>
            <a class="item" href="https://gitroom.com/blog/run-hackathons-2024"
              >How to Run Hackathons in 2024</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-26 @ 16:32:17</span
              ><span class="points-container"
                >Points: <span class="points">31</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38773203"
                  >Comments</a
                ><span class="descendants">: 30</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38773049">
          <h3>
            <a class="item" href="https://compilers.iecc.com/crenshaw/"
              >Let's Build a Compiler</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-26 @ 16:18:33</span
              ><span class="points-container"
                >Points: <span class="points">32</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38773049"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38773037">
          <h3>
            <a
              class="item"
              href="https://arstechnica.com/apple/2023/12/no-last-minute-reprieve-us-ban-on-some-apple-watch-sales-now-in-effect/"
              >US ban on some Apple Watch sales now in effect</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-26 @ 16:17:31</span
              ><span class="points-container"
                >Points: <span class="points">111</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38773037"
                  >Comments</a
                ><span class="descendants">: 87</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38772980">
          <h3>
            <a
              class="item"
              href="https://www.theregister.com/2023/12/26/thermal_management_is_changing/"
              >How thermal management is changing in the age of the kilowatt
              chip</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-26 @ 16:10:44</span
              ><span class="points-container"
                >Points: <span class="points">103</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38772980"
                  >Comments</a
                ><span class="descendants">: 70</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38772862">
          <h3>
            <a class="item" href="https://www.devever.net/~hl/ortega"
              >Adventures in reverse engineering Broadcom NIC firmware</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-26 @ 15:57:43</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38772862"
                  >Comments</a
                ><span class="descendants">: 8</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38772754">
          <h3>
            <a
              class="item"
              href="https://www.averylaird.com/programming/the%20text%20editor/2017/09/30/the-piece-table.html"
              >Text Editor: Data Structures</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-26 @ 15:48:15</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38772754"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38772382">
          <h3>
            <a class="item" href="https://www.whataaabout.com/"
              >Show HN: Whataaabout.com – unique activity ideas for the holiday
              break</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-26 @ 15:13:08</span
              ><span class="points-container"
                >Points: <span class="points">121</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38772382"
                  >Comments</a
                ><span class="descendants">: 44</span></span
              >
            </h4>
            <div class="text">
              <p>
                I hope you like it, and I’d be happy to hear your thoughts, as
                well as any cool activity ideas you might have. Cheers!
              </p>
            </div>
          </section>
        </section>
        <section id="38772039">
          <h3>
            <a class="item" href="https://github.com/jstrieb/just.sh"
              >Show HN: Just.sh – compiler that turns Justfiles into portable
              shell scripts</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-26 @ 14:30:05</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38772039"
                  >Comments</a
                ><span class="descendants">: 12</span></span
              >
            </h4>
            <div class="text">
              <p>
                When I first learned about Just, I realized that parsing
                arguments and running commands is exactly what shell scripts do,
                and there probably isn't much Just does that sh doesn't. This
                project proves that hypothesis by compiling Justfiles to
                portable (POSIX-compatible) shell scripts.
              </p>
              <p>
                just.sh is particularly useful for running Justfiles in esoteric
                environments where Just may not be straightforward to install,
                such as some CI/CD pipeline environments.
              </p>
            </div>
          </section>
        </section>
        <section id="38771513">
          <h3>
            <a
              class="item"
              href="https://www.openmymind.net/Your-Website-Search-Hurts-My-Feelings/"
              >Website search hurts my feelings</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-26 @ 13:18:43</span
              ><span class="points-container"
                >Points: <span class="points">307</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38771513"
                  >Comments</a
                ><span class="descendants">: 175</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38770168">
          <h3>
            <a
              class="item"
              href="https://despairlabs.com/blog/posts/2023-12-25-openzfs-data-corruption-bug/"
              >A data corruption bug in OpenZFS?</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-26 @ 09:21:11</span
              ><span class="points-container"
                >Points: <span class="points">181</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38770168"
                  >Comments</a
                ><span class="descendants">: 80</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38769874">
          <h3>
            <a class="item" href="https://github.com/python/cpython/pull/113465"
              >A copy-and-patch JIT compiler for CPython</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-26 @ 08:26:52</span
              ><span class="points-container"
                >Points: <span class="points">235</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38769874"
                  >Comments</a
                ><span class="descendants">: 48</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38769850">
          <h3>
            <a class="item" href="https://rampantgames.com/blog/?p=7745"
              >Black Triangles (2014)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-26 @ 08:21:45</span
              ><span class="points-container"
                >Points: <span class="points">198</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38769850"
                  >Comments</a
                ><span class="descendants">: 47</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38769700">
          <h3>
            <a
              class="item"
              href="https://sambleckley.com/writing/lab-notebooks.html"
              >Lab Notebooks (2020)</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-26 @ 07:53:25</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38769700"
                  >Comments</a
                ><span class="descendants">: 43</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38768779">
          <h3>
            <a
              class="item"
              href="https://interlisp.org/project/status/2023medleyannualreport/"
              >2023 Medley Interlisp Project Annual Report</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-26 @ 03:53:44</span
              ><span class="points-container"
                >Points: <span class="points">35</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38768779"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38765525">
          <h3>
            <a
              class="item"
              href="https://blog.datawrapper.de/roman-roads-tabula-peutingeriana/"
              >A closer look at the Tabula Peutingeriana</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-25 @ 19:50:32</span
              ><span class="points-container"
                >Points: <span class="points">124</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38765525"
                  >Comments</a
                ><span class="descendants">: 62</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38764063">
          <h3>
            <a
              class="item"
              href="https://merrillmarkoe.substack.com/p/dylans-christmas-lights-a-scholarly"
              >Bob Dylan's Christmas Lights: A Scholarly Treatise</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-25 @ 16:53:19</span
              ><span class="points-container"
                >Points: <span class="points">29</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38764063"
                  >Comments</a
                ><span class="descendants">: 5</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38762272">
          <h3>
            <a class="item" href="https://spectrum.ieee.org/kelp-farm-carbon"
              >Researchers are scaling up solar-powered kelp farms</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-25 @ 13:03:28</span
              ><span class="points-container"
                >Points: <span class="points">59</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38762272"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="38759549">
          <h3>
            <a class="item" href="http://yowasp.org/"
              >YoWASP aims to distribute up-to-date FOSS FPGA tools compiled to
              WebAssembly</a
            >
          </h3>
          <section>
            <h4>
              <span>2023-12-25 @ 03:52:47</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=38759549"
                  >Comments</a
                ><span class="descendants">: 2</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
