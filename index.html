<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
      name="viewport"
    />
    <meta name="description" content="Hacker News" />
    <meta name="theme-color" content="#fff" />
    <title>Hacker News</title>
    <link rel="manifest" href="manifest.json" />
    <link
      href="data:image/x-icon;base64,AAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQECAAEAAQA4AAAAFgAAACgAAAABAAAAAgAAAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <link
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAAA1BMVEUAAACnej3aAAAANklEQVR42u3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8G4IAAAFjdVCkAAAAAElFTkSuQmCC"
      rel="apple-touch-icon"
    />
    <style>
      /*<!--*/
      body {
        color: rgb(25, 25, 25);
        font-family: Verdana, Geneva, sans-serif;
        margin: 0;
      }

      a {
        text-decoration: none;
      }

      a:link,
      a:focus,
      a:hover,
      a:active {
        color: rgb(75, 75, 125);
      }

      a:visited {
        color: rgb(25, 25, 25);
      }

      h1 > a,
      h1 > a:link,
      h1 > a:focus,
      h1 > a:hover,
      h1 > a:active,
      h1 > a:visited,
      h2 > a,
      h2 > a:link,
      h2 > a:focus,
      h2 > a:hover,
      h2 > a:active,
      h2 > a:visited {
        color: rgb(25, 25, 25);
      }

      h1 {
        background-color: rgb(255, 102, 0);
        margin: 0;
        padding: 1rem;
      }

      h2 {
        background-color: rgb(200, 200, 200);
        margin: 1rem 0;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }

      #latest > section,
      #archives > section {
        margin: 0 1rem 1rem 1rem;
        padding-bottom: 1rem;
      }

      #latest > section:not(:last-child),
      #archives > section:not(:last-child) {
        border-bottom: 1px dotted rgb(200, 200, 200);
      }

      section > h3 {
        margin: 0 0 0.5rem 0;
      }

      section > h4 {
        font-weight: normal;
        margin: 0 0 0 1rem;
      }

      .descendants-container,
      .points-container {
        align-items: center;
        border-left: 1px solid #333;
        display: inline-flex;
        margin-left: 0.5rem;
        padding-left: 0.5rem;
        text-align: center;
      }

      .points {
        align-items: center;
        display: inline-flex;
        height: 1rem;
        margin-left: 1ch;
        min-width: 3ch;
      }

      .text {
        line-height: 1.5rem;
        margin: 1rem 1rem 0 1rem;
        overflow: auto;
      }

      .text > p:first-child {
        margin-top: 1rem;
      }

      .text > p:last-child {
        margin-bottom: 0;
      }
      /*-->*/
    </style>
  </head>

  <body>
    <main>
      <h1><a href="https://kherrick.github.io/hacker-news/">Hacker News</a></h1>
      <section id="latest">
        <h2>Latest</h2>
        <section id="39563618">
          <h3>
            <a
              class="item"
              href="https://appleinsider.com/articles/24/03/01/apple-reverses-course-on-death-of-progressive-web-apps-in-eu"
              >Apple reverses course on death of Progressive Web Apps in EU</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 16:48:45</span
              ><span class="points-container"
                >Points: <span class="points">94</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39563618"
                  >Comments</a
                ><span class="descendants">: 36</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39562986">
          <h3>
            <a class="item" href="https://news.ycombinator.com/item?id=39562986"
              >Ask HN: Who is hiring? (March 2024)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 16:00:03</span
              ><span class="points-container"
                >Points: <span class="points">84</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39562986"
                  >Comments</a
                ><span class="descendants">: 76</span></span
              >
            </h4>
            <div class="text">
              <i>not</i> an option, include ONSITE.
              <p>
                Please only post if you personally are part of the hiring
                company—no recruiting firms or job boards. One post per company.
                If it isn't a household name, explain what your company does.
              </p>
              <p>
                Commenters: please don't reply to job posts to complain about
                something. It's off topic here.
              </p>
              <p>
                Readers: please only email if you are personally interested in
                the job.
              </p>
              <p>
                Searchers: try
                <a href="https://www.remotenbs.com">https://www.remotenbs.com</a
                >,
                <a href="https://hnjobs.u-turn.dev">https://hnjobs.u-turn.dev</a
                >,
                <a href="https://hnresumetojobs.com"
                  >https://hnresumetojobs.com</a
                >,
                <a href="https://hnhired.fly.dev">https://hnhired.fly.dev</a>,
                <a href="https://kennytilton.github.io/whoishiring/"
                  >https://kennytilton.github.io/whoishiring/</a
                >,
                <a href="https://hnjobs.emilburzo.com"
                  >https://hnjobs.emilburzo.com</a
                >.
              </p>
              <p>Don't miss these other fine threads:</p>
              <p>
                <i>Who wants to be hired?</i>
                <a href="https://news.ycombinator.com/item?id=39562984"
                  >https://news.ycombinator.com/item?id=39562984</a
                >
              </p>
              <p>
                <i>Freelancer? Seeking freelancer?</i>
                <a href="https://news.ycombinator.com/item?id=39562985"
                  >https://news.ycombinator.com/item?id=39562985</a
                >
              </p>
            </div>
          </section>
        </section>
        <section id="39562760">
          <h3>
            <a
              class="item"
              href="https://www.npr.org/2024/02/27/1234271434/4-day-workweek-successful-a-year-later-in-uk"
              >Study: 61 UK firms tried a 4-day workweek and after a year, they
              still love it</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 15:39:40</span
              ><span class="points-container"
                >Points: <span class="points">56</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39562760"
                  >Comments</a
                ><span class="descendants">: 31</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39562685">
          <h3>
            <a
              class="item"
              href="https://www.reuters.com/technology/meta-rebuffed-google-proposal-virtual-reality-tie-up-information-reports-2024-03-01/"
              >Meta rebuffs Google's virtual reality tie-up proposal</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 15:31:28</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39562685"
                  >Comments</a
                ><span class="descendants">: 20</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39562610">
          <h3>
            <a
              class="item"
              href="https://spectrum.ieee.org/history-of-power-grid"
              >Clock Made Power Grids Possible</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 15:24:09</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39562610"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39562530">
          <h3>
            <a class="item" href="https://hullworks.com/wood/"
              >Old vs. New Growth Trees and the Wood Products They Make</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 15:15:13</span
              ><span class="points-container"
                >Points: <span class="points">86</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39562530"
                  >Comments</a
                ><span class="descendants">: 67</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39562467">
          <h3>
            <a
              class="item"
              href="https://blog.trailofbits.com/2024/03/01/toward-more-effective-curl-fuzzing/"
              >How we applied advanced fuzzing techniques to cURL</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 15:09:54</span
              ><span class="points-container"
                >Points: <span class="points">64</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39562467"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39562254">
          <h3>
            <a class="item" href="https://arxiv.org/abs/2402.12330"
              >On the Ocean Conditions of Hycean Worlds</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 14:44:51</span
              ><span class="points-container"
                >Points: <span class="points">8</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39562254"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39562194">
          <h3>
            <a
              class="item"
              href="https://johnnysswlab.com/a-story-of-a-very-large-loop-with-a-long-instruction-dependency-chain/"
              >A story of a large loop with a long instruction dependency
              chain</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 14:38:23</span
              ><span class="points-container"
                >Points: <span class="points">7</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39562194"
                  >Comments</a
                ><span class="descendants">: 3</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39561799">
          <h3>
            <a
              class="item"
              href="https://www.brendangregg.com/ColonyGraphs/cloud.html"
              >Colony Graphs: Visualizing the Cloud</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 13:57:30</span
              ><span class="points-container"
                >Points: <span class="points">37</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39561799"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39561656">
          <h3>
            <a
              class="item"
              href="https://academic.oup.com/mnras/article/528/4/6568/7596572"
              >Seismology of rubble-pile asteroids in binary systems</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 13:41:30</span
              ><span class="points-container"
                >Points: <span class="points">17</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39561656"
                  >Comments</a
                ><span class="descendants">: 1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39561594">
          <h3>
            <a class="item" href="https://jsr.io"
              >JSR: The JavaScript Registry</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 13:33:23</span
              ><span class="points-container"
                >Points: <span class="points">165</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39561594"
                  >Comments</a
                ><span class="descendants">: 110</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39561492">
          <h3>
            <a
              class="item"
              href="https://www.nytimes.com/2024/03/01/science/daddy-long-legs-eyes.html"
              >A daddy-longlegs possesses six eyes, including two vestigial
              pairs</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 13:21:19</span
              ><span class="points-container"
                >Points: <span class="points">68</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39561492"
                  >Comments</a
                ><span class="descendants">: 63</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39561356">
          <h3>
            <a
              class="item"
              href="https://www.wabe.org/the-atlanta-magnet-man-is-saving-our-car-tires-one-bike-ride-at-a-time/"
              >The 'Atlanta Magnet Man' is saving our car tires, one bike ride
              at a time</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 13:01:50</span
              ><span class="points-container"
                >Points: <span class="points">186</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39561356"
                  >Comments</a
                ><span class="descendants">: 92</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39561021">
          <h3>
            <a class="item" href="https://theins.ru/en/politics/269612"
              >Fugitive Wirecard COO Jan Marsalek exposed as decade-long GRU
              spy</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 12:13:31</span
              ><span class="points-container"
                >Points: <span class="points">318</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39561021"
                  >Comments</a
                ><span class="descendants">: 135</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39560887">
          <h3>
            <a
              class="item"
              href="https://www.mistys-internet.website/blog/blog/2024/03/01/that-time-i-accidentally-deleted-a-game-from-mame/"
              >I Accidentally Deleted a Game from MAME</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 11:51:11</span
              ><span class="points-container"
                >Points: <span class="points">134</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39560887"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39560862">
          <h3>
            <a
              class="item"
              href="https://cgad.ski/blog/where-is-noethers-principle-in-machine-learning.html"
              >Where Is Noether's Principle in Machine Learning?</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 11:47:30</span
              ><span class="points-container"
                >Points: <span class="points">116</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39560862"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39560250">
          <h3>
            <a
              class="item"
              href="https://jobs.lever.co/photoroom/fb70ca3c-632f-4b1b-b6e2-004f0240011d?lever-origin=applied&amp;lever-source%5B%5D=yc"
              >Photoroom (YC S20) Is Hiring a Frontend State Architect in Paris
              (Mobx, React)</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 09:50:20</span
              ><span class="points-container"
                >Points: <span class="points">1</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39560180">
          <h3>
            <a
              class="item"
              href="https://lamplightdev.com/blog/2024/01/10/streaming-html-out-of-order-without-javascript/"
              >Streaming HTML out of order without JavaScript</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 09:37:08</span
              ><span class="points-container"
                >Points: <span class="points">139</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39560180"
                  >Comments</a
                ><span class="descendants">: 57</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39559966">
          <h3>
            <a
              class="item"
              href="https://www.courthousenews.com/wp-content/uploads/2024/02/musk-v-altman-openai-complaint-sf.pdf"
              >Elon Musk sues Sam Altman, Greg Brockman, and OpenAI [pdf]</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 08:56:05</span
              ><span class="points-container"
                >Points: <span class="points">417</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39559966"
                  >Comments</a
                ><span class="descendants">: 357</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39559411">
          <h3>
            <a
              class="item"
              href="https://cacm.acm.org/news/cacm-is-now-open-access-2/"
              >CACM Is Now Open Access</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 07:19:15</span
              ><span class="points-container"
                >Points: <span class="points">271</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39559411"
                  >Comments</a
                ><span class="descendants">: 39</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39559281">
          <h3>
            <a
              class="item"
              href="https://cloudinary.com/blog/jpeg-xl-and-the-pareto-front"
              >JPEG XL and the Pareto Front</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 06:55:59</span
              ><span class="points-container"
                >Points: <span class="points">342</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39559281"
                  >Comments</a
                ><span class="descendants">: 199</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39557188">
          <h3>
            <a
              class="item"
              href="https://struct.ai/blog/introducing-the-struct-chat-platform"
              >Show HN: Struct – A Feed-Centric Chat Platform</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-03-01 @ 00:49:07</span
              ><span class="points-container"
                >Points: <span class="points">268</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39557188"
                  >Comments</a
                ><span class="descendants">: 120</span></span
              >
            </h4>
            <div class="text">
              <p>
                At Struct, we're frustrated by the clutter, distractions, and
                inefficiencies plaguing existing chat platforms like Slack and
                Discord.
              </p>
              <p>
                We've built a radical new chat platform that leverages threads,
                feeds, and AI to help alleviate these problems, and give you
                back more time in your day.
              </p>
              <p>
                Struct uses a thread-first approach to keep conversations
                on-topic. It applies AI-generated titles and summaries to help
                you decide what's worth your attention. Threads are then
                organized in a real-time feed, keeping all your conversations
                up-to-date and at the ready, eliminating the need for channel
                hopping.
              </p>
              <p>
                Comprehensive search tools make finding things a breeze, and
                Strucbot, our AI assistant can answer questions based on what
                it’s learned from prior threads. It can even proactively respond
                when it notices repeat requests, providing quick answers so you
                don’t have to. Structbot is fully GPT-4 enabled, so you can riff
                with Chat GPT and your peers (generate code, ask questions, all
                the good stuff) without ever switching apps.
              </p>
              <p>
                Struct is available on Linux, Windows, Mac, and even works as a
                Slack interface. Give us a try and let us know what you think.
              </p>
            </div>
          </section>
        </section>
        <section id="39548403">
          <h3>
            <a
              class="item"
              href="https://hakaimagazine.com/features/the-butterfly-redemption/"
              >The Butterfly Redemption</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 12:17:34</span
              ><span class="points-container"
                >Points: <span class="points">10</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39548403"
                  >Comments</a
                ><span class="descendants">: 0</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39548130">
          <h3>
            <a class="item" href="https://github.com/Eventual-Inc/Daft"
              >Daft: Distributed DataFrame for Python</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 11:40:18</span
              ><span class="points-container"
                >Points: <span class="points">93</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39548130"
                  >Comments</a
                ><span class="descendants">: 32</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39548050">
          <h3>
            <a
              class="item"
              href="https://ff8isthe.best/2024/02/the-game-magazine-that-spent-two-years-taunting-a-final-fantasy-viii-hater/"
              >The game magazine that spent two years taunting a Final Fantasy
              VIII hater</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 11:10:55</span
              ><span class="points-container"
                >Points: <span class="points">144</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39548050"
                  >Comments</a
                ><span class="descendants">: 28</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39547971">
          <h3>
            <a
              class="item"
              href="https://www.collabora.com/news-and-blog/news-and-events/nvk-is-now-ready-for-prime-time.html"
              >NVK is now ready for prime time</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 10:31:35</span
              ><span class="points-container"
                >Points: <span class="points">89</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39547971"
                  >Comments</a
                ><span class="descendants">: 19</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39547332">
          <h3>
            <a
              class="item"
              href="https://tratt.net/laurie/blog/2024/some_reflections_on_writing_unix_daemons.html"
              >Some Reflections on Writing Unix Daemon</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 08:05:28</span
              ><span class="points-container"
                >Points: <span class="points">51</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39547332"
                  >Comments</a
                ><span class="descendants">: 16</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39546497">
          <h3>
            <a
              class="item"
              href="https://www.historytoday.com/archive/out-margins/beware-lides-march"
              >Beware the Lides of March</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-29 @ 04:53:09</span
              ><span class="points-container"
                >Points: <span class="points">24</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39546497"
                  >Comments</a
                ><span class="descendants">: 4</span></span
              >
            </h4>
          </section>
        </section>
        <section id="39542127">
          <h3>
            <a
              class="item"
              href="https://community.intel.com/t5/Blogs/Tech-Innovation/Tools/Why-do-we-need-a-Undefined-Behavior-Annex-for-the-C-standard/post/1574397"
              >Why do we need for an Undefined Behavior Annex to C++</a
            >
          </h3>
          <section>
            <h4>
              <span>2024-02-28 @ 18:51:43</span
              ><span class="points-container"
                >Points: <span class="points">19</span></span
              ><span class="descendants-container"
                ><a href="https://news.ycombinator.com/item?id=39542127"
                  >Comments</a
                ><span class="descendants">: 6</span></span
              >
            </h4>
          </section>
        </section>
      </section>
      <section id="archives">
        <h2>
          <a
            href="https://github.com/kherrick/hacker-news/blob/main/archives/index.md"
            >Archives</a
          >
        </h2>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2024/index.md"
              >2024</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2023/index.md"
              >2023</a
            >
          </h3>
        </section>
        <section>
          <h3>
            <a
              href="https://github.com/kherrick/hacker-news/blob/main/archives/2022/index.md"
              >2022</a
            >
          </h3>
        </section>
      </section>
    </main>
    <script type="module">
      import { buildDescendants } from "./lib/build-html-descendants.js";
      import { buildNextItem } from "./lib/build-html-next-item.js";
      import { getNextDateTime } from "./lib/date-time.js";

      const updateSectionById = (id) =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(
          (result) =>
            result.json().then(({ descendants, id, score, text, type }) => {
              const currentItem = document.getElementById(id);

              if (score) {
                currentItem.querySelector(".points").textContent = score;
              }

              if (descendants && (type === "poll" || type === "story")) {
                const currentDescendants =
                  currentItem.querySelector(".descendants");

                if (currentDescendants) {
                  currentDescendants.textContent = `: ${descendants}`;
                } else {
                  const comments = buildDescendants(
                    document,
                    descendants,
                    `https://news.ycombinator.com/item?id=${id}`
                  );

                  currentItem.querySelector("h4").appendChild(comments);
                }
              }

              if (text) {
                const currentText = currentItem.querySelector(".text");

                if (currentText) {
                  currentText.innerHTML = text.replace(/\0/g, "");
                } else {
                  const content = document.createElement("div");
                  content.innerHTML = text.replace(/\0/g, "");
                  content.setAttribute("class", "text");

                  currentItem.appendChild(content);
                }
              }
            })
        );

      class UpdateQueue {
        constructor() {
          this._ids = [];
          this._isUpdating = false;
        }

        addItemById(id) {
          this._ids.push(id);
        }

        async flush() {
          const id = this._ids.shift();

          if (id) {
            this._isUpdating = true;

            await updateSectionById(id);
            await this.flush();
          } else {
            this._isUpdating = false;

            setTimeout(async () => {
              if (!this._isUpdating && this._ids && this._ids.length) {
                await this.flush();
              }
            }, 0);
          }
        }
      }

      // get latest data
      const latestSection = document.getElementById("latest");

      for (let item of latestSection.querySelectorAll("section[id]")) {
        updateSectionById(item.getAttribute("id"));
      }

      if ("IntersectionObserver" in window) {
        window.hackerNewsState = { index: [], nextTimeIndex: -1 };

        const addNewsItem = async (newsItem, queue) => {
          try {
            const { date, time, itemComments, itemTitle, itemLink } = newsItem;
            const section = await buildNextItem({
              document,
              dateTime: `${date}, ${time}`,
              itemComments,
              itemLink,
              itemTitle: new DOMParser().parseFromString(
                itemTitle.replace(/\\/g, ""),
                "text/html"
              ).documentElement.textContent,
              fetchItemDetails: false,
            });

            // display loading indicator for section
            section.querySelector(".points-container").innerHTML =
              'Points: <span class="points"><img style="height: 100%;" src="lib/images/loading.svg" /></span>';

            const id = section.getAttribute("id");
            if (!document.getElementById(id)) {
              document.getElementById("latest").appendChild(section);

              queue.addItemById(id);
            }
          } catch (error) {}
        };

        const buildArchiveIndex = async (lastDateTime) => {
          const nextDate = lastDateTime.slice(0, 10);
          const nextYear = nextDate.slice(0, 4);

          return (
            await (
              await fetch(
                `https://raw.githubusercontent.com/kherrick/hacker-news/main/archives/${nextYear}/${nextDate}/index.md`
              )
            ).text()
          )
            .split("\n")
            .filter((line) => line.match(new RegExp("^\\* \\[")))
            .map((line) => {
              const segment = line.replace("* ", "").split("](");
              const pubDate = segment[0].slice(1);

              const itemComments = segment[1].split(") - [")[0];
              const itemTitle = segment[1].split(") - [")[1];
              const itemLink = segment[2].slice(0, -1);
              const date = pubDate.slice(0, 10);
              const time = pubDate.slice(-8);

              return {
                date,
                itemComments,
                itemLink,
                itemTitle,
                time,
              };
            });
        };

        const handleIntersectingEntry = async (entry, queue) => {
          if (entry.isIntersecting) {
            const lastDateTime = document
              .getElementById("latest")
              .querySelector(
                "section:last-child > section > h4 > span"
              ).textContent;

            const nextDateTime = getNextDateTime(lastDateTime ?? "", -1);
            const archiveIndex = await buildArchiveIndex(nextDateTime);
            const nextTimeIndex = archiveIndex.findIndex(
              ({ time }) => time === nextDateTime.slice(-8)
            );

            const handleIndexUpdate = (index, existingIndexValues = []) => {
              index.forEach((i) => {
                existingIndexValues.push(i);
              });
              return existingIndexValues;
            };

            window.hackerNewsState = {
              index: handleIndexUpdate(
                archiveIndex,
                window.hackerNewsState.index
              ),
              nextTimeIndex,
            };

            let currentTimeIndex = nextTimeIndex + 1;
            const items = Object.values(window.hackerNewsState.index);
            for (let item of items) {
              if (currentTimeIndex < window.hackerNewsState.index.length) {
                addNewsItem(items[currentTimeIndex], queue);

                currentTimeIndex = currentTimeIndex + 1;
              }
            }

            queue.flush();
          }
        };

        const archives = document.getElementById("archives");
        const archivesObserver = new IntersectionObserver(
          (entries) => {
            const queue = new UpdateQueue();

            entries.forEach((entry) => handleIntersectingEntry(entry, queue));
          },
          {
            root: null,
            rootMargin: "0px",
            threshold: 0,
          }
        );

        archivesObserver.observe(archives);

        let latestSectionsExpanded = true;
        const handleLatestHeaderClick = () => {
          latestSectionsExpanded = !latestSectionsExpanded;

          if (latestSectionsExpanded) {
            archivesObserver.observe(archives);
          } else {
            archivesObserver.disconnect(archives);
          }

          for (let section of document.querySelectorAll("#latest > section")) {
            section.style.display = latestSectionsExpanded ? "block" : "none";
          }
        };

        const latestHeader = document.querySelector("#latest > h2");
        latestHeader.style.cursor = "pointer";
        latestHeader.addEventListener("click", handleLatestHeaderClick);
      }
    </script>
    <script type="module">
      import { Workbox } from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

      if ("serviceWorker" in navigator) {
        const base = document.querySelector("base");
        const serviceWorkerPath = `${
          base ? base.href.replace(/\/$/, "") : ""
        }/service-worker.js`;

        const wb = new Workbox(serviceWorkerPath);

        // setup event listeners
        wb.addEventListener("waiting", (event) => {
          wb.addEventListener("controlling", () => {
            window.location.reload();
          });

          wb.messageSkipWaiting();
        });

        wb.register();
      }
    </script>
  </body>
</html>
